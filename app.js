(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./src/javascript/game.js":[function(require,module,exports){
Quintus = require('quintus')

var Q = window.Q = Quintus().include("Sprites, Scenes, Input, 2D, Anim, Touch, UI, TMX")
Q.SPRITE_PLAYER = 2;
Q.SPRITE_WEAPON = 4;
Q.SPRITE_NPC = 8;
Q.SPRITE_INTERACTIVE = 16;

Q.setup({ maximize: true }).touch(Q.SPRITE_ALL);

Q.input.keyboardControls({
  LEFT: "left",
  RIGHT: "right",
  UP: "up",
  DOWN: "down",
  A: "left",
  D: "right",
  W: "up",
  S: "down",
  SPACE: "action"
});


require('./character')
require('./interactive')
require('./decoration')
require('./tmx')

},{"./character":"/Volumes/spaaaaaace/git/ld32/src/javascript/character.js","./decoration":"/Volumes/spaaaaaace/git/ld32/src/javascript/decoration.js","./interactive":"/Volumes/spaaaaaace/git/ld32/src/javascript/interactive.js","./tmx":"/Volumes/spaaaaaace/git/ld32/src/javascript/tmx.js","quintus":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/index.js"}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/extra/quintus_dom.js":[function(require,module,exports){
/*global Quintus:false */
/*global $:false */

module.exports = function(Q) {
  
  Q.setupDOM = function(id,options) {
    options = options || {};
    id = id || "quintus";
    Q.el = $(Q._isString(id) ? "#" + id : id);
    if(Q.el.length === 0) {
      Q.el = $("<div>")
                .attr('id',id)
                .css({width: 320, height:420 })
                .appendTo("body");
    }
    if(options.maximize) {
      var w = $(window).width();
      var h = $(window).height();
      Q.el.css({width:w,height:h});
    }
   Q.wrapper = Q.el
                 .wrap("<div id='" + id + "_container'/>")
                 .parent()
                 .css({ width: Q.el.width(),
                        height: Q.el.height(),
                        margin: '0 auto' });
    Q.el.css({ position:'relative', overflow: 'hidden' });
    Q.width = Q.el.width();
    Q.height = Q.el.height();
    setTimeout(function() { window.scrollTo(0,1); }, 0);
    $(window).bind('orientationchange',function() {
      setTimeout(function() { window.scrollTo(0,1); }, 0);
    });
    return Q;
  };

(function() { 
    function translateBuilder(attribute) {
      return function(dom,x,y) {
        dom.style[attribute] = 
        "translate(" + Math.floor(x) + "px," +
        Math.floor(y) + "px)";
      };
    }
    function translate3DBuilder(attribute) {
      return function(dom,x,y) {
        dom.style[attribute] = 
        "translate3d(" + Math.floor(x) + "px," +
        Math.floor(y) + "px,0px)";
      };
    }
    function scaleBuilder(attribute) {
      return function(dom,scale) {
        dom.style[attribute + 'Origin'] = "0% 0%";
        dom.style[attribute] = "scale(" + scale + ")";
      };
    }
    function fallbackTranslate(dom,x,y) {
      dom.style.left = x + "px";
      dom.style.top = y + "px";
    }
    var has3d =  ('WebKitCSSMatrix' in window && 
                  'm11' in new window.WebKitCSSMatrix());
    var dummyStyle = $("<div>")[0].style;
    var transformMethods = ['transform',
                            'webkitTransform',
                            'MozTransform',
                            'msTransform' ];
    for(var i=0;i<transformMethods.length;i++) {
      var transformName = transformMethods[i];
      if(!Q._isUndefined(dummyStyle[transformName])) {
        if(has3d) {
          Q.positionDOM = translate3DBuilder(transformName);
        } else {
          Q.positionDOM = translateBuilder(transformName); 
        }
        Q.scaleDOM = scaleBuilder(transformName);
        break;
      }
    }
    Q.positionDOM = Q.positionDOM || fallbackTranslate;
    Q.scaleDOM = Q.scaleDOM || function(scale) {};
  }());

  (function() {
     function transitionBuilder(attribute,prefix){
      return function(dom,property,sec,easing) {
        easing = easing || "";
        if(property === 'transform') {
          property = prefix + property;
        }
        sec = sec || "1s";
        dom.style[attribute] = property + " " + sec + " " + easing;
      };
    }
    // Dummy method
    function fallbackTransition() { }
    var dummyStyle = $("<div>")[0].style;
    var transitionMethods = ['transition',
                            'webkitTransition',
                            'MozTransition',
                            'msTransition' ];
    var prefixNames = [ '', '-webkit-', '-moz-', '-ms-' ];
    for(var i=0;i<transitionMethods.length;i++) {
      var transitionName = transitionMethods[i];
      var prefixName = prefixNames[i];
      if(!Q._isUndefined(dummyStyle[transitionName])) {
        Q.transitionDOM = transitionBuilder(transitionName,prefixName); 
        break;
      }
    }
    Q.transitionDOM = Q.transitionDOM || fallbackTransition;
  }());

  Q.DOMSprite = Q.Sprite.extend({
    init: function(props) {
      this._super(props);
      this.el = $("<div>").css({
        width: this.p.w,
        height: this.p.h,
        zIndex: this.p.z || 0,
        position: 'absolute'
      });
      this.dom = this.el[0];
      this.rp = {};
      this.setImage();
      this.setTransform();
    },
  
    setImage: function() {
      var asset;
      if(this.sheet()) {
        asset = Q.asset(this.sheet().asset);
      } else {
        asset = this.asset();
      }
      if(asset) {
        this.dom.style.backgroundImage = "url(" + asset.src + ")";
      }
    },
  
    setTransform: function() {
      var p = this.p;
      var rp = this.rp;
      if(rp.frame !== p.frame) {
        if(p.sheet) {
          this.dom.style.backgroundPosition = 
              (-this.sheet().fx(p.frame)) + "px " + 
              (-this.sheet().fy(p.frame)) + "px";
        } else {
          this.dom.style.backgroundPosition = "0px 0px";
        }
        rp.frame = p.frame;
      }
      if(rp.x !== p.x || rp.y !== p.y) {
        Q.positionDOM(this.dom,p.x,p.y);
        rp.x = p.x;
        rp.y = p.y;
      } 
    },

    hide: function() {
      this.dom.style.display = 'none';
    },

    show: function() {
      this.dom.style.display = 'block';
    },

    draw: function(ctx) {
      this.trigger('draw');
    },

    step: function(dt) {
      this.trigger('step',dt);
      this.setTransform();
    },

    destroy: function() {
      if(this.destroyed) { return false; }
      this._super();
      this.el.remove();
    }
  });
  

  if(Q.Stage) {
    Q.DOMStage = Q.Stage.extend({
      init: function(scene) {
        this.el = $("<div>").css({
          top:0,
          position:'relative'
        }).appendTo(Q.el);
        this.dom = this.el[0];
        this.wrapper = this.el.wrap('<div>').parent().css({
          position:'absolute',
          left:0,
          top:0
        });
        this.scale = 1;
        this.wrapper_dom = this.wrapper[0];
        this._super(scene);
      },

      insert: function(itm) {
        if(itm.dom) { this.dom.appendChild(itm.dom); }
        return this._super(itm);
      },

      destroy: function() {
        this.wrapper.remove();
        this._super();
      },

      rescale: function(scale) {
        this.scale = scale;
        Q.scaleDOM(this.wrapper_dom,scale);
      },

      centerOn: function(x,y) {
        this.x = Q.width/2/this.scale -  x;
        this.y = Q.height/2/this.scale - y;
        Q.positionDOM(this.dom,this.x,this.y);
      }
    });
  }

  Q.domOnly = function() {
    Q.Stage = Q.DOMStage;
    Q.setup = Q.setupDOM;
    Q.Sprite = Q.DOMSprite;
    return Q;
  };
  
  Q.DOMTileMap = Q.DOMSprite.extend({
    // Expects a sprite sheet, along with cols and rows properties
    init:function(props) {
      var sheet = Q.sheet(props.sheet);
      this._super(Q._extend(props,{
        w: props.cols * sheet.tilew,
        h: props.rows * sheet.tileh,
        tilew: sheet.tilew,
        tileh: sheet.tileh
      }));
      this.shown = [];
      this.domTiles = [];
    },

    setImage: function() { },
  
    setup: function(tiles,hide) {
      this.tiles = tiles;
      for(var y=0,height=tiles.length;y<height;y++) {
        this.domTiles.push([]);
        this.shown.push([]);
        for(var x=0,width=tiles[0].length;x<width;x++) {
          var domTile = this._addTile(tiles[y][x]);
          if(hide) { domTile.style.visibility = 'hidden'; }
          this.shown.push(hide ? false : true);
          this.domTiles[y].push(domTile);
        }
      }
    },

    _addTile: function(frame) {
      var p = this.p;
      var div = document.createElement('div');
      div.style.width = p.tilew + "px";
      div.style.height = p.tileh + "px";
      div.style.styleFloat = div.style.cssFloat = 'left';
      this._setTile(div,frame);
      this.dom.appendChild(div);
      return div;
    },

    _setTile: function(dom,frame) {
      var asset = Q.asset(this.sheet().asset);
      dom.style.backgroundImage = "url(" + asset.src + ")";
      dom.style.backgroundPosition = (-this.sheet().fx(frame)) +"px " + (-this.sheet().fy(frame)) + "px";
    },

    validTile: function(x,y) {
      return (y >= 0 && y < this.p.rows) && 
             (x >= 0 && x < this.p.cols);
    },

    get: function(x,y) { return this.validTile(x,y) ? 
                                this.tiles[y][x] : null; },

    getDom: function(x,y) { return this.validTile(x,y) ? 
                                   this.domTiles[y][x] : null; },
    set: function(x,y,frame) {
      if(!this.validTile(x,y)) { return; }
      this.tiles[y][x] = frame;
      var domTile = this.getDom(x,y);
      this._setFile(domTile,frame);
    },

    show: function(x,y) {
      if(!this.validTile(x,y)) { return; }
      if(this.shown[y][x]) { return; }
      this.getDom(x,y).style.visibility = 'visible';
      this.shown[y][x] = true;
    },

    hide: function(x,y) {
      if(!this.validTile(x,y)) { return; }
      if(!this.shown[y][x]) { return; }
      this.getDom(x,y).style.visibility = 'hidden';
      this.shown[y][x] = false;
    }
  }); 




};


},{}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/extra/quintus_physics.js":[function(require,module,exports){
/*global Quintus:false */
/*global Box2D:false */

var Box2D = require('box2dweb')

module.exports = function(Q) {
  var B2d = Q.B2d = {
      World: Box2D.Dynamics.b2World,
      Vec: Box2D.Common.Math.b2Vec2,
      BodyDef: Box2D.Dynamics.b2BodyDef,
      Body: Box2D.Dynamics.b2Body,
      FixtureDef: Box2D.Dynamics.b2FixtureDef,
      Fixture: Box2D.Dynamics.b2Fixture,
      PolygonShape: Box2D.Collision.Shapes.b2PolygonShape,
      CircleShape: Box2D.Collision.Shapes.b2CircleShape,
      Listener:  Box2D.Dynamics.b2ContactListener
    };

  var defOpts = Q.PhysicsDefaults = {
    gravityX: 0,
    gravityY: 9.8,
    scale: 30,
    velocityIterations: 8,
    positionIterations: 3
  };

  Q.component('world',{
    added: function() {
      this.opts = Q._extend({},defOpts);
      this._gravity = new B2d.Vec(this.opts.gravityX,
                                 this.opts.gravityY);
      this._world = new B2d.World(this._gravity, true);

      var physics = this,
          boundBegin = function(contact) { physics.beginContact(contact); },
          boundEnd = function(contact) { physics.endContact(contact); },
          boundPostSolve = function(contact,impulse) { physics.postSolve(contact,impulse); };
  
      this._listener = new B2d.Listener();
      this._listener.BeginContact = boundBegin;
      this._listener.EndContact = boundEnd;
      this._listener.PostSolve = boundPostSolve;
      this._world.SetContactListener(this._listener);
      
      this.col = {};
      this.scale = this.opts.scale;
      this.entity.on('step',this,'boxStep');
    },

    setCollisionData: function(contact,impulse) {
      var spriteA = contact.GetFixtureA().GetBody().GetUserData(),
          spriteB = contact.GetFixtureB().GetBody().GetUserData();
       
      this.col["a"] = spriteA;
      this.col["b"] = spriteB;
      this.col["impulse"] = impulse;
      this.col["sprite"] = null;
    },

    beginContact: function(contact) {
      this.setCollisionData(contact,null);
      this.col.a.trigger("contact",this.col.b);
      this.col.b.trigger("contact",this.col.a);
      this.entity.trigger("contact",this.col);
    },

    endContact: function(contact) {
      this.setCollisionData(contact,null);
      this.col.a.trigger("endContact",this.col.b);
      this.col.b.trigger("endContact",this.col.a);
      this.entity.trigger("endContact",this.col);
    },

    postSolve: function(contact, impulse) {
      this.setCollisionData(contact,impulse);
      this.col["sprite"] = this.col.b;
      this.col.a.trigger("impulse",this.col);
      this.col["sprite"] = this.col.a;
      this.col.b.trigger("impulse",this.col);
      this.entity.trigger("impulse",this.col);
    },

    createBody: function(def) {
      return this._world.CreateBody(def);
    },

    destroyBody: function(body) {
      return this._world.DestroyBody(body);
    },

    boxStep: function(dt) {
      if(dt > 1/20) { dt = 1/20; }
      this._world.Step(dt, 
                      this.opts.velocityIterations,
                      this.opts.positionIterations);
    }
  });

  var entityDefaults = Q.PhysicsEntityDefaults = {
    density: 1,
    friction: 1,
    restitution: 0.1
  };

  Q.component('physics',{
    added: function() {
      if(this.entity.stage) {
        this.inserted();
      } else {
        this.entity.on('inserted',this,'inserted');
      }
      this.entity.on('step',this,'step');
      this.entity.on('removed',this,'removed');
    },

    position: function(x,y) {
      var stage = this.entity.stage;
      this._body.SetAwake(true);
      this._body.SetPosition(new B2d.Vec(x / stage.world.scale,
                                         y / stage.world.scale));
    },

    angle: function(angle) {
      this._body.SetAngle(angle / 180 * Math.PI);
    },

    velocity: function(x,y) {
      var stage = this.entity.stage;
      this._body.SetAwake(true);
      this._body.SetLinearVelocity(new B2d.Vec(x / stage.world.scale,
                                               y / stage.world.scale));
    },
 
    inserted: function() {
      var entity = this.entity,
          stage = entity.stage,
          scale = stage.world.scale,
          p = entity.p,
          ops = entityDefaults,
          def = this._def = new B2d.BodyDef(),
          fixtureDef = this._fixture = new B2d.FixtureDef();
            
      def.position.x = p.x / scale;
      def.position.y = p.y / scale;
      def.type = p.type === 'static' ? 
                 B2d.Body.b2_staticBody :
                 B2d.Body.b2_dynamicBody;
      def.active = true;
      
      this._body = stage.world.createBody(def); 
      this._body.SetUserData(entity);
      fixtureDef.density = p.density || ops.density;
      fixtureDef.friction = p.friction || ops.friction;
      fixtureDef.restitution = p.restitution || ops.restitution;
      
      switch(p.shape) {
        case "block":
          fixtureDef.shape = new B2d.PolygonShape();
          fixtureDef.shape.SetAsBox(p.w/2/scale, p.h/2/scale);
          break;
        case "circle":
          fixtureDef.shape = new B2d.CircleShape(p.r/scale);
          break;
        case "polygon":
          fixtureDef.shape = new B2d.PolygonShape();
          var pointsObj = Q._map(p.points,function(pt) {
            return { x: pt[0] / scale, y: pt[1] / scale };
          });
          fixtureDef.shape.SetAsArray(pointsObj, p.points.length);
          break;
      }
      
      this._body.CreateFixture(fixtureDef);
      this._body._bbid = p.id;
    },

    removed: function() {
      var entity = this.entity,
          stage = entity.parent;
      stage.world.destroyBody(this._body);
    },

    step: function() {
      var p = this.entity.p,
          stage = this.entity.stage,
          pos = this._body.GetPosition(),
          angle = this._body.GetAngle();
      p.x = pos.x * stage.world.scale;
      p.y = pos.y * stage.world.scale;
      p.angle = angle / Math.PI * 180;
    }
  });


};

},{"box2dweb":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/node_modules/box2dweb/box2d.js"}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/extra/quintus_svg.js":[function(require,module,exports){
/*global Quintus:false */
/*global $:false */

module.exports = function(Q) {
  var SVG_NS ="http://www.w3.org/2000/svg"; 
  Q.setupSVG = function(id,options) {
    options = options || {};
    id = id || "quintus";
    Q.svg =Q._isString(id) ? document.getElementById(id) : id;
    
    if(!Q.svg) {
      Q.svg = document.createElementNS(SVG_NS,'svg');
      Q.svg.setAttribute('width',320);
      Q.svg.setAttribute('height',420);
      document.body.appendChild(Q.svg);
    }

    if(options.maximize) {
      var w = window.innerWidth-1;
      var h = window.innerHeight-10;
      Q.svg.setAttribute('width',w);
      Q.svg.setAttribute('height',h);
    }
	Q.width = Q.svg.getAttribute('width');
    Q.height = Q.svg.getAttribute('height');
    var parent=Q.svg.parentNode;
    var container=document.createElement('div');
    container.setAttribute('id',id+'_container');
    container.style.width=Q.width;
    container.style.height=Q.height;
    container.style.margin='0 auto';
    container.appendChild(Q.svg);
    parent.appendChild(container);
    Q.wrapper=container;
 
    setTimeout(function() { window.scrollTo(0,1); }, 0);
    window.addEventListener('orientationchange',function() {
      setTimeout(function() { window.scrollTo(0,1); }, 0);
    });
    return Q;
  };

  Q.Sprite.extend("SVGSprite",{
    init: function(props) {
      this._super(Q._defaults(props,{
        shape: 'block',
        color: 'black',
        angle: 0,
        active: true,
        cx: 0,
        cy: 0
      }));
      this.createShape();
      this.svg.sprite = this;
      this.rp = {};
      this.setTransform();
    },

    set: function(attr) {
      Q._each(attr,function(value,key) {
        this.svg.setAttribute(key,value);
      },this);
    },
    
    createShape: function() {
      var p = this.p;
      switch(p.shape) {
        case 'block':
          this.svg = document.createElementNS(SVG_NS,'rect');
          Q._extend(p,{ cx: p.w/2, cy: p.h/2 });
          this.set({ width: p.w, height: p.h });
          break;
        case 'circle':
          this.svg = document.createElementNS(SVG_NS,'circle');
          this.set({ r: p.r, cx: 0, cy: 0 });
          break;
        case 'polygon':
          this.svg = document.createElementNS(SVG_NS,'polygon');
          var pts = Q._map(p.points, 
                          function(pt) { 
                            return pt[0] + "," + pt[1];
                          }).join(" ");
          this.set({ points: pts });
          break;
          
      }
      this.set({ fill: p.color });
      if(p.outline) {
        this.set({
          stroke: p.outline,
          "stroke-width": p.outlineWidth || 1
        });
      }
    },

    setTransform: function() {
      var p = this.p;
      var rp = this.rp;
      if(rp.x !== p.x || 
         rp.y !== p.y || 
         rp.angle !== p.angle ) {
        var transform = "translate(" + (p.x - p.cx) + "," +
                                       (p.y - p.cy) + ") " +
                        "rotate(" + p.angle + 
                                "," + p.cx +
                                "," + p.cy +
                                ")";
        this.svg.setAttribute('transform',transform);
        rp.angle = p.angle;
        rp.x = p.x;
        rp.y = p.y;
      } 
    },
    render: function(ctx) {
    	
    	this.trigger('predraw',ctx);
    	this.trigger('beforedraw',ctx);
    	this.draw(ctx);
    	this.trigger('beforedraw',ctx);
    },
    draw: function(ctx) {
    },

    step: function(dt) {
      this.trigger('step',dt);
      this.setTransform();
    }
  });


  Q.Stage.extend("SVGStage",{
    init: function(scene) {
      this.svg = document.createElementNS(SVG_NS,'svg');
      this.svg.setAttribute('width',Q.width);
      this.svg.setAttribute('height',Q.height);
      Q.svg.appendChild(this.svg);
      
      this.viewBox = { x: 0, y: 0, w: Q.width, h: Q.height };
      this._super(scene);
    },
    remove:function(itm){
	  if(itm.svg) { this.svg.removeChild(itm.svg); }
	  return this._super(itm);
    },
    insert: function(itm) {
      if(itm.svg) { this.svg.appendChild(itm.svg); }
      return this._super(itm);
    },

    destroy: function() {
      Q.svg.removeChild(this.svg);
      this._super();
    },

    viewport: function(w,h) {
      this.viewBox.w = w;
      this.viewBox.h = h;
      if(this.viewBox.cx || this.viewBox.cy) {
        this.centerOn(this.viewBox.cx,
                      this.viewBox.cy);
      } else {
        this.setViewBox();
      }
    },

    centerOn: function(x,y) {
      this.viewBox.cx = x;
      this.viewBox.cy = y;
      this.viewBox.x = x - this.viewBox.w/2;
      this.viewBox.y = y - this.viewBox.h/2;
      this.setViewBox();
    },

    setViewBox: function() {
      this.svg.setAttribute('viewBox',
                            this.viewBox.x + " " + this.viewBox.y + " " +
                            this.viewBox.w + " " + this.viewBox.h);
    },

    browserToWorld: function(x,y) {
      var m = this.svg.getScreenCTM();
      var p = this.svg.createSVGPoint();
      p.x = x; p.y = y;
      return p.matrixTransform(m.inverse());
    }
  });

  Q.svgOnly = function() {
    Q.Stage = Q.SVGStage;
    Q.setup = Q.setupSVG;
    Q.Sprite = Q.SVGSprite;
    return Q;
  };


};


},{}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/index.js":[function(require,module,exports){
module.exports = require('./lib/quintus')
},{"./lib/quintus":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus.js"}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus.js":[function(require,module,exports){
//     Quintus Game Engine
//     (c) 2012 Pascal Rettig, Cykod LLC
//     Quintus may be freely distributed under the MIT license or GPLv2 License.
//     For all details and documentation:
//     http://html5quintus.com
//
/**
Quintus HTML5 Game Engine 

The code in `quintus.js` defines the base `Quintus()` method
which create an instance of the engine. The basic engine doesn't
do a whole lot - it provides an architecture for extension, a
game loop, and a method for creating or binding to an exsiting
canvas context. The engine has dependencies on Underscore.js and jQuery,
although the jQuery dependency will be removed in the future.

Most of the game-specific functionality is in the 
various other modules:

* `quintus_input.js` - `Input` module, which allows for user input via keyboard and touchscreen
* `quintus_sprites.js` - `Sprites` module, which defines a basic `Q.Sprite` class along with spritesheet support in `Q.SpriteSheet`.
* `quintus_scenes.js` - `Scenes` module. It defines the `Q.Scene` class, which allows creation of reusable scenes, and the `Q.Stage` class, which handles managing a number of sprites at once.
* `quintus_anim.js` - `Anim` module, which adds in support for animations on sprites along with a `viewport` component to follow the player around and a `Q.Repeater` class that can create a repeating, scrolling background.

@module Quintus
*/

/**
 Top-level Quintus engine factory wrapper, 
 creates new instances of the engine by calling:

      var Q = Quintus({  ...  });

 Any initial setup methods also all return the `Q` object, allowing any initial 
 setup calls to be chained together.

      var Q = Quintus()
              .include("Input, Sprites, Scenes")
              .setup('quintus', { maximize: true })
              .controls();
                       
 `Q` is used internally as the object name, and is used in most of the examples, 
 but multiple instances of the engine on the same page can have different names.

     var Game1 = Quintus(), Game2 = Quintus();

@class Quintus
**/

module.exports = Quintus;

Quintus['2D'] = require('./quintus_2d')
Quintus.Anim = require('./quintus_anim')
Quintus.Audio = require('./quintus_audio')
Quintus.Input = require('./quintus_input')
Quintus.Scenes = require('./quintus_scenes')
Quintus.Sprites = require('./quintus_sprites')
Quintus.TMX = require('./quintus_tmx')
Quintus.Touch = require('./quintus_touch')
Quintus.UI = require('./quintus_ui')
Quintus.DOM = require('../extra/quintus_dom')
Quintus.Physics = require('../extra/quintus_physics')
Quintus.SVG = require('../extra/quintus_svg')

function Quintus(opts) {

  /**
   A la jQuery - the returned `Q` object is actually
   a method that calls `Q.select`. `Q.select` doesn't do anything
   initially, but can be overridden by a module to allow
   selection of game objects. The `Scenes` module adds in 
   the select method which selects from the default stage.
  
       var Q = Quintus().include("Sprites, Scenes");
       ... Game Code ...
       // Set the angry property on all Enemy1 class objects to true
       Q("Enemy1").p({ angry: true });
    
    @method Q
    @for Quintus
  */  
  var Q = function(selector,scope,options) {   
    return Q.select(selector,scope,options);
  };

  /**
   Default no-op select method. Replaced with the Quintus.Scene class

   @method Q.select
   @for Quintus
  */
  Q.select = function() { /* No-op */ };

  /**
   Default no-op select method. Replaced with the Quintus.Scene class


   Syntax for including other modules into quintus, can accept a comma-separated
   list of strings, an array of strings, or an array of actual objects. Example:
  
       Q.include("Input, Sprites, Scenes")

   @method Q.include
   @param {String} mod - A comma separated list of module names
   @return {Quintus} returns Quintus instance for chaining.
   @for Quintus
  */
  Q.modules = {}

  Q.include = function(mod) {
    Q._each(Q._normalizeArg(mod),function(name) {
      var m = Quintus[name] || name;
      if(!Q._isFunction(m)) { throw "Invalid Module:" + name; }
      Q.modules[name] = m;
      m(Q)
    });
    return Q;
  };

  /**
   An internal utility method (utility methods are prefixed with underscores)
   It's used to take a string of comma separated names and turn it into an `Array`
   of names. If an array of names is passed in, it's left as is. Example usage:
  
       Q._normalizeArg("Sprites, Scenes, Physics   ");
       // returns [ "Sprites", "Scenes", "Physics" ]
  
   Used by `Q.include` and `Q.Sprite.add` to add modules and components, respectively.

   Most of these utility methods are a subset of Underscore.js,
   Most are pulled directly from underscore and some are
   occasionally optimized for speed and memory usage in lieu of flexibility.

   Underscore.js is (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.

   Underscore is freely distributable under the MIT license.

   http://underscorejs.org

   @method Q._normalizeArg
   @param {String or Array} arg - Either a comma separated string or an array
   @return {Array} array of normalized names
   @for Quintus
  */
  Q._normalizeArg = function(arg) {
    if(Q._isString(arg)) {
      arg = arg.replace(/\s+/g,'').split(",");
    }
    if(!Q._isArray(arg)) {
      arg = [ arg ];
    }
    return arg;
  };


  /**
   Extends a destination object with a source object (modifies destination object)

   @method Q._extend
   @param {Object} dest - destination object
   @param {Object} source - source object
   @return {Object} returns the dest object
   @for Quintus
  */
  Q._extend = function(dest,source) {
    if(!source) { return dest; }
    for (var prop in source) {
      dest[prop] = source[prop];
    }
    return dest;
  };

  /**
   Return a shallow copy of an object. Sub-objects (and sub-arrays) are not cloned. (uses extend internally)

   @method Q._clone
   @param {Object} obj - object to clone
   @return {Object} cloned object 
   @for Quintus
  */
  Q._clone = function(obj) {
    return Q._extend({},obj);
  };

   /**
    Method that adds default properties onto an object only if the key on dest is undefined

   @method Q._defaults
   @param {Object} dest - destination object
   @param {Object} source - source object
   @return {Object} returns the dest object
   @for Quintus
  */
  Q._defaults = function(dest,source) {
    if(!source) { return dest; }
    for (var prop in source) {
      if(dest[prop] === void 0) {
        dest[prop] = source[prop];
      }
    }
    return dest;
  };

  /**
   Shortcut for hasOwnProperty

   @method Q._defaults
   @param {Object} object - destination object
   @param {String} key - key to check for
   @return {Boolean} 
   @for Quintus
  */ 
  Q._has = function(obj, key) {
    return Object.prototype.hasOwnProperty.call(obj, key);
  };

   /**
   Check if something is a string

   NOTE: this fails for non-primitives

   @method Q._isString
   @param {Var} obj - object to check 
   @return {Boolean} 
   @for Quintus
  */
  Q._isString = function(obj) {
    return typeof obj === "string";
  };

  /**
   Check if something is a number

   @method Q._isNumber
   @param {Var} obj - object to check 
   @return {Boolean} 
   @for Quintus
  */
  Q._isNumber = function(obj) {
    return Object.prototype.toString.call(obj) === '[object Number]';
  };

  /**
   Check if something is a function

   @method Q._isFunction
   @param {Var} obj - object to check 
   @return {Boolean} 
   @for Quintus
  */
  Q._isFunction = function(obj) {
    return Object.prototype.toString.call(obj) === '[object Function]';
  };

   /**
   Check if something is an Object

   @method Q._isObject
   @param {Var} obj - object to check 
   @return {Boolean} 
   @for Quintus
  */ 
  Q._isObject = function(obj) {
    return Object.prototype.toString.call(obj) === '[object Object]';
  };

  /**
   Check if something is an Array

   @method Q._isArray
   @param {Var} obj - object to check 
   @return {Boolean} 
   @for Quintus
  */ 
  Q._isArray = function(obj) {
    return Object.prototype.toString.call(obj) === '[object Array]';
  };

  /**
   Check if something is undefined

   @method Q._isUndefined
   @param {Var} obj - object to check 
   @return {Boolean} 
   @for Quintus
  */ 
  Q._isUndefined = function(obj) {
    return obj === void 0;
  };

  /**
   Removes a property from an object and returns it if it exists

   @method Q._popProperty
   @param {Object} obj 
   @param {String} property - property to pop off the object
   @return {Var} popped property
   @for Quintus
  */ 
  Q._popProperty = function(obj,property) {
    var val = obj[property];
    delete obj[property];
    return val;
  };

  /**
   Basic iteration method. This can often be a performance
   handicap when the callback iterator is created inline,
   as this leads to lots of functions that need to be GC'd.
   Better is to define the iterator as a private method so.
   Uses the built in `forEach` method

   @method Q._each
   @param {Array or Object} obj 
   @param {Function iterator function, `this` is used for each object
   @for Quintus
  */ 
  Q._each = function(obj,iterator,context) {
    if (obj == null) { return; }
    if (obj.forEach) {
      obj.forEach(iterator,context);
    } else if (obj.length === +obj.length) {
      for (var i = 0, l = obj.length; i < l; i++) {
        iterator.call(context, obj[i], i, obj);
      }
    } else {
      for (var key in obj) {
        iterator.call(context, obj[key], key, obj);
      }
    }
  };

  /**
   Invoke the named property on each element of the array

   @method Q._invoke
   @param {Array} arr 
   @param {String} property - property to invoke
   @param {Var} [arg1]
   @param {Var} [arg2]
   @for Quintus
  */ 
  Q._invoke = function(arr,property,arg1,arg2) {
    if (arr == null) { return; }
    for (var i = 0, l = arr.length; i < l; i++) {
      arr[i][property](arg1,arg2);
    }
  };



  /**
   Basic detection method, returns the first instance where the
   iterator returns truthy. 

   @method Q._detect
   @param {Array or Object} obj
   @param {Function} iterator 
   @param {Object} context
   @param {Var} [arg1]
   @param {Var} [arg2]
   @returns {Var} first truthy value
   @for Quintus
  */
  Q._detect = function(obj,iterator,context,arg1,arg2) {
    var result;
    if (obj == null) { return; }
    if (obj.length === +obj.length) {
      for (var i = 0, l = obj.length; i < l; i++) {
        result = iterator.call(context, obj[i], i, arg1,arg2);
        if(result) { return result; }
      }
      return false;
    } else {
      for (var key in obj) {
        result = iterator.call(context, obj[key], key, arg1,arg2);
        if(result) { return result; }
      }
      return false;
    }
  };

  /**
   Returns a new Array with entries set to the return value of the iterator.

   @method Q._detect
   @param {Array or Object} obj
   @param {Function} iterator 
   @param {Object} context
   @returns {Array}
   @for Quintus
  */
  Q._map = function(obj, iterator, context) {
    var results = [];
    if (obj == null) { return results; }
    if (obj.map) { return obj.map(iterator, context); }
    Q._each(obj, function(value, index, list) {
      results[results.length] = iterator.call(context, value, index, list);
    });
    if (obj.length === +obj.length) { results.length = obj.length; }
    return results;
  };

  /**
   Returns a sorted copy of unique array elements with null removed

   @method Q._uniq
   @param {Array} arr
   @returns {Array} uniq'd sorted copy of array
   @for Quintus
  */
  Q._uniq = function(arr) {
    arr = arr.slice().sort();

    var output = [];

    var last = null;
    for(var i=0;i<arr.length;i++) {
      if(arr[i] !== void 0 && last !== arr[i]) {
        output.push(arr[i]);
      }
      last = arr[i];
    }
    return output;
  };

  /**
   Returns a new array with the same entries as the source but in a random order.

   @method Q._shuffle
   @param {Array} arr
   @returns {Array} copy or arr in shuffled order
   @for Quintus
  */
  Q._shuffle = function(obj) {
    var shuffled = [], rand;
    Q._each(obj, function(value, index, list) {
      rand = Math.floor(Math.random() * (index + 1));
      shuffled[index] = shuffled[rand];
      shuffled[rand] = value;
    });
    return shuffled;
  };


  /**
   Return an object's keys as a new Array

   @method Q._keys
   @param {Object} obj
   @returns {Array}
   @for Quintus
  */
  Q._keys = Object.keys || function(obj) {
    if(Q._isObject(obj)) { throw new TypeError('Invalid object'); }
    var keys = [];
    for (var key in obj) { if (Q._has(obj, key)) { keys[keys.length] = key; } } 
    return keys;
  };


  /**
   Return an array in the range from start to stop 

   @method Q._range
   @param {Integer} start
   @param {Integer} stop
   @param {Integer} [step]
   @returns {Array}
   @for Quintus
  */
  Q._range = function(start,stop,step) {
    step = step || 1;

    var len = Math.max(Math.ceil((stop - start) / step), 0);
    var idx = 0;
    var range = new Array(len);

    while(idx < len) {
      range[idx++] = start;
      start += step;
    }

    return range;

  };

  var idIndex = 0;
  /**
   Return a new unique identifier

   @method Q._uniqueId
   @returns {Integer}
   @for Quintus
  */
  Q._uniqueId = function() {
    return idIndex++;
  };



  /**
   Options
  
   Default engine options defining the paths 
   where images, audio and other data files should be found
   relative to the base HTML file. As well as a couple of other
   options.
  
   These can be overriden by passing in options to the `Quintus()` 
   factory method, for example:
  
       // Override the imagePath to default to /assets/images/
       var Q = Quintus({ imagePath: "/assets/images/" });
  
   If you follow the default convention from the examples, however,
   you should be able to call `Quintus()` without any options.

   Default Options

       {
        imagePath: "images/",
        audioPath: "audio/",
        dataPath:  "data/",
        audioSupported: [ 'mp3','ogg' ],
        sound: true,
        frameTimeLimit: 100
       }

   @property Q.options
   @type Object
   @for Quintus
  */
  Q.options = {
    imagePath: "images/",
    audioPath: "audio/",
    dataPath:  "data/",
    audioSupported: [ 'mp3','ogg' ],
    sound: true,
    frameTimeLimit: 100,
    autoFocus: true
  };
  if(opts) { Q._extend(Q.options,opts); }


  /**
   Game Loop support

   By default the engine doesn't start a game loop until you actually tell it to.
   Usually the loop is started the first time you call `Q.stageScene`, but if you 
   aren't using the `Scenes` module you can explicitly start the game loop yourself
   and control **exactly** what the engine does each cycle. For example:
  
       var Q = Quintus().setup();
  
       var ball = new Q.Sprite({ .. });
  
       Q.gameLoop(function(dt) {
         Q.clear(); 
         ball.step(dt);
         ball.draw(Q.ctx);
       });
  
   The callback will be called with fraction of a second that has elapsed since 
   the last call to the loop method.

   @method Q.gameLoop
   @param {Function} callback
   @for Quintus
  */
  Q.gameLoop = function(callback) {
    Q.lastGameLoopFrame = new Date().getTime();

    // Short circuit the loop check in case multiple scenes
    // are staged immediately
    Q.loop = true; 

    // Keep track of the frame we are on (so that animations can be synced
    // to the next frame)
    Q._loopFrame = 0;

    // Wrap the callback to save it and standardize the passed
    // in time. 
    Q.gameLoopCallbackWrapper = function() {
      var now = new Date().getTime();
      Q._loopFrame++;
      Q.loop = window.requestAnimationFrame(Q.gameLoopCallbackWrapper);
      var dt = now - Q.lastGameLoopFrame;
      /* Prevent fast-forwarding by limiting the length of a single frame. */
      if(dt > Q.options.frameTimeLimit) { dt = Q.options.frameTimeLimit; }
      callback.apply(Q,[dt / 1000]);  
      Q.lastGameLoopFrame = now;
    };

    window.requestAnimationFrame(Q.gameLoopCallbackWrapper);
    return Q;
  };

  /**
   Pause the entire game by canceling the requestAnimationFrame call. If you use setTimeout or
   setInterval in your game, those will, of course, keep on rolling...

    @method Q.pauseGame
    @for Quintus
  */
  Q.pauseGame = function() {
    if(Q.loop) {
      window.cancelAnimationFrame(Q.loop); 
    }
    Q.loop = null;
  };

  /**
   Unpause the game by restarting the requestAnimationFrame-based loop.
   Pause the entire game by canceling the requestAnimationFrame call. If you use setTimeout or
   setInterval in your game, those will, of course, keep on rolling...

    @method Q.pauseGame
    @for Quintus
  */
  Q.unpauseGame = function() {
    if(!Q.loop) {
      Q.lastGameLoopFrame = new Date().getTime();
      Q.loop = window.requestAnimationFrame(Q.gameLoopCallbackWrapper);
    }
  };


  /**
   The base Class object
  
   Quintus uses the Simple JavaScript inheritance Class object, created by
   John Resig and described on his blog: 
  
   [http://ejohn.org/blog/simple-javascript-inheritance/](http://ejohn.org/blog/simple-javascript-inheritance/)
  
   The class is used wholesale, with the only differences being that instead
   of appearing in a top-level namespace, the `Class` object is available as 
   `Q.Class` and a second argument on the `extend` method allows for adding
   class level methods and the class name is passed in a parameter for introspection
   purposes.
  
   Classes can be created by calling `Q.Class.extend(name,{ .. })`, although most of the time
   you'll want to use one of the derivitive classes, `Q.Evented` or `Q.GameObject` which
   have a little bit of functionality built-in. `Q.Evented` adds event binding and 
   triggering support and `Q.GameObject` adds support for components and a destroy method.
  
   The main things Q.Class get you are easy inheritance, a constructor method called `init()`,
   dynamic addition of a this._super method when a method is overloaded (be careful with 
   this as it adds some overhead to method calls.) Calls to `instanceof` also all 
   work as you'd hope.
  
   By convention, classes should be added onto to the `Q` object and capitalized, so if 
   you wanted to create a new class for your game, you'd write:
  
       Q.Class.extend("MyClass",{ ... });
  
   Examples:
  
       Q.Class.extend("Bird",{ 
         init: function(name) { this.name = name; },
         speak: function() { console.log(this.name); },
         fly: function()   { console.log("Flying"); }
       });
  
       Q.Bird.extend("Penguin",{
         speak: function() { console.log(this.name + " the penguin"); },
         fly: function()   { console.log("Can't fly, sorry..."); }
       });
  
       var randomBird = new Q.Bird("Frank"),
           pengy      = new Q.Penguin("Pengy");
  
       randomBird.fly(); // Logs "Flying"
       pengy.fly();      // Logs "Can't fly,sorry..."
  
       randomBird.speak(); // Logs "Frank"
       pengy.speak();      // Logs "Pengy the penguin"
  
       console.log(randomBird instanceof Q.Bird);    // true 
       console.log(randomBird instanceof Q.Penguin); // false
       console.log(pengy instanceof Q.Bird);         // true 
       console.log(pengy instanceof Q.Penguin);      // true 

  Simple JavaScript Inheritance
  By John Resig http://ejohn.org/
  MIT Licensed.
  
  Inspired by base2 and Prototype
  @class Q.Class
  @for Quintus
  */
  (function(){
    var initializing = false, 
        fnTest = /xyz/.test(function(){ var xyz;}) ? /\b_super\b/ : /.*/;
    /** The base Class implementation (does nothing) 
     *
     * @constructor
     * @for Q.Class
     */
    Q.Class = function(){};

    /**
     * See if a object is a specific class
     *
     * @method isA
     * @param {String} className - class to check against
     */
    Q.Class.prototype.isA = function(className) {
      return this.className === className;
    };
    
    /**
     * Create a new Class that inherits from this class 
     *
     * @method extend
     * @param {String} className
     * @param {Object} properties - hash of properties (init will be the constructor)
     * @param {Object} [classMethods] - optional class methods to add to the class
     */
    Q.Class.extend = function(className, prop, classMethods) {
      /* No name, don't add onto Q */
      if(!Q._isString(className)) {
        classMethods = prop;
        prop = className;
        className = null;
      }
      var _super = this.prototype,
          ThisClass = this;
      
      /* Instantiate a base class (but only create the instance, */
      /* don't run the init constructor) */
      initializing = true;
      var prototype = new ThisClass();
      initializing = false;

      function _superFactory(name,fn) {
        return function() {
          var tmp = this._super;

          /* Add a new ._super() method that is the same method */
          /* but on the super-class */
          this._super = _super[name];

          /* The method only need to be bound temporarily, so we */
          /* remove it when we're done executing */
          var ret = fn.apply(this, arguments);        
          this._super = tmp;

          return ret;
        };
      }

      /* Copy the properties over onto the new prototype */
      for (var name in prop) {
        /* Check if we're overwriting an existing function */
        prototype[name] = typeof prop[name] === "function" && 
          typeof _super[name] === "function" && 
            fnTest.test(prop[name]) ? 
              _superFactory(name,prop[name]) : 
              prop[name];
      }
      
      /* The dummy class constructor */
      function Class() {
        /* All construction is actually done in the init method */
        if ( !initializing && this.init ) {
          this.init.apply(this, arguments);
        }
      }
      
      /* Populate our constructed prototype object */
      Class.prototype = prototype;
      
      /* Enforce the constructor to be what we expect */
      Class.prototype.constructor = Class;
      /* And make this class extendable */
      Class.extend = Q.Class.extend;
      
      /* If there are class-level Methods, add them to the class */
      if(classMethods) {
        Q._extend(Class,classMethods);
      }

      if(className) { 
        /* Save the class onto Q */
        Q[className] = Class;

        /* Let the class know its name */
        Class.prototype.className = className;
        Class.className = className;
      }
      
      return Class;
    };
  }());
    

  // Event Handling
  // ==============

  /**
   The `Q.Evented` class adds event handling onto the base `Q.Class` 
   class. Q.Evented objects can trigger events and other objects can
   bind to those events.

   @class Q.Evented
   @extends Q.Class
   @for Quintus
  */
  Q.Class.extend("Evented",{

    /**
    Binds a callback to an event on this object. If you provide a
    `target` object, that object will add this event to it's list of
    binds, allowing it to automatically remove it when it is destroyed.

    @method on
    @for Q.Evented
    @param {String} event - name or comma separated list of events
    @param {Object} [target] - optional context for callback, defaults to the Evented
    @param {Function} [callback] - callback (optional - defaults to name of event on context
    */
    on: function(event,target,callback) {
      if(Q._isArray(event) || event.indexOf(",") !== -1) {
        event = Q._normalizeArg(event);
        for(var i=0;i<event.length;i++) {
          this.on(event[i],target,callback);
        }
        return;
      }

      // Handle the case where there is no target provided,
      // swapping the target and callback parameters.
      if(!callback) {
        callback = target;
        target = null;
      }

      // If there's still no callback, default to the event name
      if(!callback) {
        callback = event;
      }
      // Handle case for callback that is a string, this will
      // pull the callback from the target object or from this
      // object.
      if(Q._isString(callback)) {
        callback = (target || this)[callback];
      }

      // To keep `Q.Evented` objects from needing a constructor,
      // the `listeners` object is created on the fly as needed.
      // `listeners` keeps a list of callbacks indexed by event name
      // for quick lookup. 
      this.listeners = this.listeners || {};
      this.listeners[event] = this.listeners[event] || [];
      this.listeners[event].push([ target || this, callback]);

      // With a provided target, the target object keeps track of
      // the events it is bound to, which allows for automatic 
      // unbinding on destroy.
      if(target) {
        if(!target.binds) { target.binds = []; }
        target.binds.push([this,event,callback]);
      }
    },

    /**
     Triggers an event, passing in some optional additional data about
     the event. 

    @method trigger
    @for Q.Evented
    @param {String} event - name of event
    @param {Object} [data] - optional data to pass to the callback
    */
    trigger: function(event,data) {
      // First make sure there are any listeners, then check for any listeners
      // on this specific event, if not, early out.
      if(this.listeners && this.listeners[event]) {
        // Call each listener in the context of either the target passed into
        // `on` or the object itself.
        for(var i=0,len = this.listeners[event].length;i<len;i++) {
          var listener = this.listeners[event][i];
          listener[1].call(listener[0],data);
        }
      }
    },
    
    /**
      Unbinds an event. Can be called with 1, 2, or 3 parameters, each 
       of which unbinds a more specific listener.

    @method off
    @for Q.Evented
    @param {String} event - name of event
    @param {Object} [target] - optionally limit to a specific target
    @param {Function} [callback] - optionally limit to one specific callback
    */
    off: function(event,target,callback) {
      // Without a target, remove all teh listeners.
      if(!target) {
        if(this.listeners[event]) {
          delete this.listeners[event];
        }
      } else {
        // If the callback is a string, find a method of the
        // same name on the target.
        if(Q._isString(callback) && target[callback]) {
          callback = target[callback];
        }
        var l = this.listeners && this.listeners[event];
        if(l) {
          // Loop from the end to the beginning, which allows us
          // to remove elements without having to affect the loop.
          for(var i = l.length-1;i>=0;i--) {
            if(l[i][0] === target) {
              if(!callback || callback === l[i][1]) {
                this.listeners[event].splice(i,1);
              }
            }
          }
        }
      }
    },

    /** 
     `debind` is called to remove any listeners an object had
     on other objects. The most common case is when an object is
     destroyed you'll want all the event listeners to be removed
     for you.

    @method debind
    @for Q.Evented
    */
    debind: function() {
       if(this.binds) {
         for(var i=0,len=this.binds.length;i<len;i++) {
           var boundEvent = this.binds[i],
               source = boundEvent[0],
               event = boundEvent[1];
           source.off(event,this);
         }
       }
     }

   });


   


  /**
   The master list of registered components, indexed in an object by name.

   @property Q.components
   @type Object
   @for Quintus
  */
  Q.components = {};

  /**
   Components
   ==============
  
   Components are self-contained pieces of functionality that can be added onto and removed
   from objects. The allow for a more dynamic functionality tree than using inheritance (i.e.
   by favoring composition over inheritance) and are added and removed on the fly at runtime.
   (yes, I know everything in JS is at runtime, but you know what I mean, geez)
  
   Combining components with events makes it easy to create reusable pieces of
   functionality that can be decoupled from each other.

   The base class for components. These are usually not derived directly but are instead
   created by calling `Q.register` to register a new component given a set of methods the 
   component supports. Components are created automatically when they are added to a 
   `Q.GameObject` with the `add` method.
  
   Many components also define an `added` method, which is called automatically by the
   `init` constructor after a component has been added to an object. This is a good time
   to add event listeners on the object.

   @class Q.Component
   @events Q.Evented
   @for Quintus
  */
  Q.Evented.extend("Component",{

    // Components are created when they are added onto a `Q.GameObject` entity. The entity
    // is directly extended with any methods inside of an `extend` property and then the 
    // component itself is added onto the entity as well. 
    init: function(entity) {
      this.entity = entity;
      if(this.extend) { Q._extend(entity,this.extend);   }
      entity[this.name] = this;

      entity.activeComponents.push(this.componentName);

      if(entity.stage && entity.stage.addToList) {
        entity.stage.addToList(this.componentName,entity);
      }
      if(this.added) { this.added(); }    
    },

    /**
     `destroy` is called automatically when a component is removed from an entity. It is 
     not called, however, when an entity is destroyed (for performance reasons).
     
     It's job is to remove any methods that were added with `extend` and then remove and
     debind itself from the entity. It will also call `destroyed` if the component has
     a method by that name.

     @method destroy
     @for Q.Component
    */
    destroy: function() {
      if(this.extend) {
        var extensions = Q._keys(this.extend);
        for(var i=0,len=extensions.length;i<len;i++) {
          delete this.entity[extensions[i]];
        }
      }
      delete this.entity[this.name];
      var idx = this.entity.activeComponents.indexOf(this.componentName);
      if(idx !== -1) { 
        this.entity.activeComponents.splice(idx,1);

        if(this.entity.stage && this.entity.stage.addToList) {
          this.entity.stage.addToLists(this.componentName,this.entity);
        }
      }
      this.debind();
      if(this.destroyed) { this.destroyed(); }
    }
  });

  /**
   
    Game Objects
    ============

   This is the base class most Quintus objects are derived from, it extends 
   `Q.Evented` and adds component support to an object, allowing components to
   be added and removed from an object. It also defines a destroyed method
   which will debind the object, remove it from it's parent (usually a scene)
   if it has one, and trigger a destroyed event.

   @class Q.GameObject
   @extends Q.Evented
   @for Quintus
  */
  Q.Evented.extend("GameObject",{

    /**
     Simple check to see if a component already exists
     on an object by searching for a property of the same name.

     @method has
     @for Q.GameObject
     @param {String} component - name of component to test against
     @returns {Boolean}
    */
    has: function(component) {
      return this[component] ? true : false; 
    },

    /**
     Adds one or more components to an object. Accepts either 
     a comma separated string or an array of strings that map
     to component names.
    
     Instantiates a new component object of the correct type
     (if the component exists) and then triggers an addComponent
     event.

     For example:

         this.add("2d, aiBounce")
    
     Returns the object to allow chaining.

     @for Q.GameObject
     @method add
     @param {String} components - comma separated list of components to add
     @return {Object} returns this for chaining purposes
    */
    add: function(components) {
      components = Q._normalizeArg(components);
      if(!this.activeComponents) { this.activeComponents = []; }
      for(var i=0,len=components.length;i<len;i++) {
        var name = components[i],
            Comp = Q.components[name];
        if(!this.has(name) && Comp) { 
          var c = new Comp(this); 
          this.trigger('addComponent',c);
        }
      }
      return this;
    }, 

    /**
     Removes one or more components from an object. Accepts the
     same style of parameters as `add`. Triggers a delComponent event
     and and calls destroy on the component.
    
     Returns the element to allow chaining.

     @for Q.GameObject
     @method del
     @param {String} components - comma separated list of components to remove
     @return {Object} returns this for chaining purposes
    */
    del: function(components) {
      components = Q._normalizeArg(components);
      for(var i=0,len=components.length;i<len;i++) {
        var name = components[i];
        if(name && this.has(name)) { 
          this.trigger('delComponent',this[name]);
          this[name].destroy(); 
        }
      }
      return this;
    },

    /**
     Destroys the object by calling debind and removing the
     object from it's parent. Will trigger a destroyed event
     callback.

     @for Q.GameObject
     @method del
     @param {String} components - comma separated list of components to remove
     @return {Object} returns this for chaining purposes
    */
    destroy: function() {
      if(this.isDestroyed) { return; }
      this.trigger('destroyed');
      this.debind();
      if(this.stage && this.stage.remove) {
        this.stage.remove(this);
      }
      this.isDestroyed = true;
      if(this.destroyed) { this.destroyed(); }
    }
  });

  /**
   Registers a component with the engine, making it available to `Q.GameObject`'s 
   This creates a new descendent class of `Q.Component` with new methods added in.

   @for Quintus
   @method Q.component
   @param {String} name - component name
   @param {Object} metehods - hash of methods for the component
  */
  Q.component = function(name,methods) {
    if(!methods) { return Q.components[name]; }
    methods.name = name;
    methods.componentName = "." + name;
    return (Q.components[name] = Q.Component.extend(name + "Component",methods));
  };


  /**
   Generic Game State object that can be used to
   track of the current state of the Game, for example when the player starts
   a new game you might want to keep track of their score and remaining lives:
  
       Q.reset({ score: 0, lives: 2 });
  
   Then in your game might want to add to the score:
       
        Q.state.inc("score",50);
  
   In your hud, you can listen for change events on the state to update your 
   display:
  
        Q.state.on("change.score",function() { .. update the score display .. });
  
  @class Q.GameState
  @extends Q.GameObject
  */
  Q.GameObject.extend("GameState",{
    init: function(p) {
      this.p = Q._extend({},p);
      this.listeners = {};
    },


    /**
     Resets the state to value p, triggers a reset event.

     @method reset
     @param {Object} p - properties to reinitialize to
    */
    reset: function(p) { this.init(p); this.trigger("reset"); },
    
    // Internal helper method to set an individual property
    _triggerProperty: function(value,key) {
      if(this.p[key] !== value) {
        this.p[key] = value;
        this.trigger("change." + key,value);
      }
    },

    /**
     Set one or more properties, trigger events on those
     properties changing.

     @example
        Q.state.set({ lives: 5, hitPoints: 4 });
        // Triggers 3 events: change.lives, change.hitPoints, change


        Q.state.set("lives",5);
        // Triggers 2 events: change.lives, change

    @method set
    @param {Object or String} properties - hash of properties to set, or property name
    @param {Var} [value] - if setting 1 property, the value of that property
    */
    set: function(properties,value) {
      if(Q._isObject(properties)) {
        Q._each(properties,this._triggerProperty,this);
      } else {
        this._triggerProperty(value,properties);
      }
      this.trigger("change");
    },

    /**
     Increment an individual property by amount, uses set internally

     @method inc
     @param {String} property
     @param {Integer} amount - amount to increment by
    */
    inc: function(property,amount) {
      this.set(property,this.get(property) + amount);
    },

    /**

     Increment an individual property by amount, uses set internally

     @method dec
     @param {String} property
     @param {Integer} amount - amount to decrement by
    */
    dec: function(property,amount) {
      this.set(property,this.get(property) - amount);
    },

    /**

     Return an individual property

     @method get
     @param {String} property 
     @return {Var} value of the property
    */
    get: function(property) {
      return this.p[property];
    }
  });

  /**
   Top-level `Q.GameState` instance, generally used for global state in the game

   @for Quintus
   @property Q.state
   @type Q.GameState
  */
  Q.state = new Q.GameState();

  /** 
   Reset the global game state

   @for Quintus
   @method Q.reset
  */
  Q.reset = function() { Q.state.reset(); };




  Q.touchDevice = ('ontouchstart' in document);

  /**
  
   Canvas Methods
   
   The `setup` and `clear` method are the only two canvas-specific methods in 
   the core of Quintus. `imageData`  also uses canvas but it can be used in
   any type of game.

   Setup will either create a new canvas element and append it
   to the body of the document or use an existing one. It will then
   pull out the width and height of the canvas for engine use.
  
   It also adds a wrapper container around the element.
  
   If the `maximize` is set to true, the canvas element is maximized
   on the page and the scroll trick is used to try to get the address bar away.
  
   The engine will also resample the game to CSS dimensions at twice pixel
   dimensions if the `resampleWidth` or `resampleHeight` options are set.
  
   TODO: add support for auto-resize w/ engine event notifications

   Available options:

       {
        width: 320,  // width of created canvas
        height: 420, // height of created canvas
        maximize: false // set to true to maximize to screen, "touch" to maximize on touch devices
       }

   @for Quintus
   @method Q.setup
   @param {String} [id="quintus"] - id of the canvas element to trigger quintus on
   @param {Object} [options] - options hash

  */
  Q.setup = function(id, options) {
    if(Q._isObject(id)) {
      options = id;
      id = null;
    }
    options = options || {};
    id = id || "quintus";

    if(Q._isString(id)) {
      Q.el = document.getElementById(id);
    } else {
      Q.el = id;
    }

    if(!Q.el) {
      Q.el = document.createElement("canvas");
      Q.el.width = options.width || 320;
      Q.el.height = options.height || 420;
      Q.el.id = id;

      document.body.appendChild(Q.el);
    }

    var w = parseInt(Q.el.width,10),
        h = parseInt(Q.el.height,10);

    var maxWidth = options.maxWidth || 5000,
        maxHeight = options.maxHeight || 5000,
        resampleWidth = options.resampleWidth,
        resampleHeight = options.resampleHeight,
        upsampleWidth = options.upsampleWidth,
        upsampleHeight = options.upsampleHeight;

    if(options.maximize === true || (Q.touchDevice && options.maximize === 'touch'))  {
      document.body.style.padding = 0;
      document.body.style.margin = 0;

      w = options.width || Math.min(window.innerWidth,maxWidth) - ((options.pagescroll)?17:0);
      h = options.height || Math.min(window.innerHeight - 5,maxHeight);

      if(Q.touchDevice) {
        Q.el.style.height = (h*2) + "px";
        window.scrollTo(0,1);

        w = Math.min(window.innerWidth,maxWidth);
        h = Math.min(window.innerHeight,maxHeight);
      }
    } else if(Q.touchDevice) {
      window.scrollTo(0,1);
    }

    if((upsampleWidth && w <= upsampleWidth) ||
       (upsampleHeight && h <= upsampleHeight)) {
      Q.el.style.height = h + "px";
      Q.el.style.width = w + "px";
      Q.el.width = w * 2;
      Q.el.height = h * 2;
    }
    else if(((resampleWidth && w > resampleWidth) ||
        (resampleHeight && h > resampleHeight)) && 
       Q.touchDevice) { 
      Q.el.style.height = h + "px";
      Q.el.style.width = w + "px";
      Q.el.width = w / 2;
      Q.el.height = h / 2;
    } else {
      Q.el.style.height = h + "px";
      Q.el.style.width = w + "px";
      Q.el.width = w;
      Q.el.height = h;
    }

    var elParent = Q.el.parentNode;

    if(elParent) {
      Q.wrapper = document.createElement("div");
      Q.wrapper.id = Q.el.id + '_container';
      Q.wrapper.style.width = w + "px";
      Q.wrapper.style.margin = "0 auto";
      Q.wrapper.style.position = "relative";


      elParent.insertBefore(Q.wrapper,Q.el);
      Q.wrapper.appendChild(Q.el);
    }
    
    Q.el.style.position = 'relative';

    Q.ctx = Q.el.getContext && 
            Q.el.getContext("2d");


    Q.width = parseInt(Q.el.width,10);
    Q.height = parseInt(Q.el.height,10);
    Q.cssWidth = w;
    Q.cssHeight = h;

    //scale to fit
    if(options.scaleToFit) {
      var factor = 1;

      var winW = window.innerWidth*factor;
      var winH = window.innerHeight*factor;
      var winRatio = winW/winH;    
      var gameRatio = Q.el.width/Q.el.height;
      var scaleRatio = gameRatio < winRatio ? winH/Q.el.height : winW/Q.el.width;
      var scaledW = Q.el.width * scaleRatio;
      var scaledH = Q.el.height * scaleRatio;

      Q.el.style.width = scaledW + "px"; 
      Q.el.style.height = scaledH + "px"; 

      if(Q.el.parentNode) {
        Q.el.parentNode.style.width = scaledW + "px"; 
        Q.el.parentNode.style.height = scaledH + "px"; 
      }
            
      Q.cssWidth = parseInt(scaledW,10);
      Q.cssHeight = parseInt(scaledH,10);     

      //center vertically when adjusting to width
      if(gameRatio > winRatio) {
        var topPos = (winH - scaledH)/2;          
        Q.el.style.top = topPos+'px';
      }
    }   

    window.addEventListener('orientationchange',function() {
      setTimeout(function() { window.scrollTo(0,1); }, 0);
    });

    return Q;
  };


  /**
   Clear the canvas completely.

   If you want it cleared to a specific color - set `Q.clearColor` to that color

   @method Q.clear
   @for Quintus
  */
  Q.clear = function() {
    if(Q.clearColor) {
      Q.ctx.globalAlpha = 1;
      Q.ctx.fillStyle = Q.clearColor;
      Q.ctx.fillRect(0,0,Q.width,Q.height);
    } else {
      Q.ctx.clearRect(0,0,Q.width,Q.height);
    }
  };
  
  Q.setImageSmoothing = function(enabled) {
    Q.ctx.mozImageSmoothingEnabled = enabled;
    Q.ctx.webkitImageSmoothingEnabled = enabled;
    Q.ctx.msImageSmoothingEnabled = enabled;
    Q.ctx.imageSmoothingEnabled = enabled;
  };

  /**
   Return canvas image data given an Image object.

   @method Q.imageData
   @for Quintus
   @param {Image} img - image to get image datda for
  */
  Q.imageData = function(img) {
    var canvas = document.createElement("canvas");
    
    canvas.width = img.width;
    canvas.height = img.height;

    var ctx = canvas.getContext("2d");
    ctx.drawImage(img,0,0);

    return ctx.getImageData(0,0,img.width,img.height);
  };

  
  /**
   Asset Loading Support
  
   The engine supports loading assets of different types using
   `load` or `preload`. Assets are stored by their name so the 
   same asset won't be loaded twice if it already exists.

   Augmentable list of asset types, loads a specific asset 
   type if the file type matches, otherwise defaults to a Ajax
   load of the data.
  
   You can new types of assets based on file extension by
   adding to `assetTypes` and adding a method called
   loadAssetTYPENAME where TYPENAME is the name of the
   type you added in.

   Default bindings are:

     * png, jpg, gif, jpeg -> Image
     * ogg, wav, m4a, mp3 -> Audio
     * Everything else -> Data
    
   To add a new file extension in to an existing type you can just add it to asset types:

       Q.assetTypes['bmp'] = "Image";

   To add in a new loader, you'll need to define a method for that type and add to the `Q.assetTypes` object, e.g.:

       Q.loadAssetVideo = function(key,src,callback,errorCallback) {
          var vid = new Video();
          vid.addEventListener("canplaythrough",function() {  callback(key,vid); });
          vid.onerror = errorCallback;
          vid.src = Q.assetUrl(Q.options.imagePath,src);
       };

       Q.assetTypes['mp4'] = 'Video'


   @for Quintus
   @property Q.assetTypes
   @type Object
  */
  Q.assetTypes = { 
    png: 'Image', jpg: 'Image', gif: 'Image', jpeg: 'Image',
    ogg: 'Audio', wav: 'Audio', m4a: 'Audio', mp3: 'Audio'
  };


  /**
   Return the file extension of a filename

   @for Quintus
   @method Q._fileExtension
   @param {String} filename
   @return {String} lowercased extension
  */
  Q._fileExtension = function(filename) {
    var fileParts = filename.split("."),
        fileExt = fileParts[fileParts.length-1].toLowerCase();
    return fileExt;
  };

  /**
   Determine the type of asset based on the `Q.assetTypes` lookup table

   @for Quintus
   @method Q.assetType
   @param {String} asset
  */
  Q.assetType = function(asset) {
    /* Determine the lowercase extension of the file */
    var fileExt = Q._fileExtension(asset);

    // Use the web audio loader instead of the regular loader
    // if it's supported.
    var fileType =  Q.assetTypes[fileExt];
    if(fileType === 'Audio' && Q.audio && Q.audio.type === "WebAudio") {
      fileType = 'WebAudio';
    }

    /* Lookup the asset in the assetTypes hash, or return other */
    return fileType || 'Other';
  };

  /**
   Either return an absolute URL, or add a base to a relative URL

   @for Quintus
   @method Q.assetUrl
   @param {String} base - base for relative paths
   @param {String} url - url to resolve to asset url
   @return {String} resolved url
  */
  Q.assetUrl = function(base,url) {
    var timestamp = "";
    if(Q.options.development) {
      timestamp = (/\?/.test(url) ? "&" : "?") + "_t=" +new Date().getTime();
    }
    if(/^https?:\/\//.test(url) || url[0] === "/") {
      return url + timestamp;
    } else {
      return base + url + timestamp;
    }
  };

  /** 
  Loader for Images, creates a new `Image` object and uses the 
  load callback to determine the image has been loaded

  @for Quintus
  @method Q.loadAssetImage
  @param {String} key
  @param {String} src
  @param {Function} callback
  @param {Function} errorCallback
  */
  Q.loadAssetImage = function(key,src,callback,errorCallback) {
    var img = new Image();
    img.onload = function() {  callback(key,img); };
    img.onerror = errorCallback;
    img.src = Q.assetUrl(Q.options.imagePath,src);
  };


  // List of mime types given an audio file extension, used to 
  // determine what sound types the browser can play using the 
  // built-in `Sound.canPlayType`
  Q.audioMimeTypes = { mp3: 'audio/mpeg', 
                       ogg: 'audio/ogg; codecs="vorbis"',
                       m4a: 'audio/m4a',
                       wav: 'audio/wav' };


  Q._audioAssetExtension = function() {
    if(Q._audioAssetPreferredExtension) { return Q._audioAssetPreferredExtension; }

    var snd = new Audio();

    /* Find a supported type */
    return Q._audioAssetPreferredExtension = 
      Q._detect(Q.options.audioSupported,
         function(extension) {
         return snd.canPlayType(Q.audioMimeTypes[extension]) ? 
                                extension : null;
      });
  };


  /** 
   Loader for Audio assets. By default chops off the extension and 
   will automatically determine which of the supported types is 
   playable by the browser and load that type.
  
   Which types are available are determined by the file extensions
   listed in the Quintus `options.audioSupported`


  @for Quintus
  @method Q.loadAssetAudio
  @param {String} key
  @param {String} src
  @param {Function} callback
  @param {Function} errorCallback
  */
  Q.loadAssetAudio = function(key,src,callback,errorCallback) {
    if(!document.createElement("audio").play || !Q.options.sound) {
      callback(key,null);
      return;
    }

    var baseName = Q._removeExtension(src),
        extension = Q._audioAssetExtension(),
        filename = null,
        snd = new Audio();

    /* No supported audio = trigger ok callback anyway */
    if(!extension) {
      callback(key,null);
      return;
    }

    snd.addEventListener("error",errorCallback);

    // Don't wait for canplaythrough on mobile
    if(!Q.touchDevice) { 
      snd.addEventListener('canplaythrough',function() { 
        callback(key,snd); 
      });
    }
    snd.src =  Q.assetUrl(Q.options.audioPath,baseName + "." + extension);
    snd.load();

    if(Q.touchDevice) {
      callback(key,snd);
    }
  };

  /**
   Asset loader for Audio files if using the WebAudio API engine

  @for Quintus
  @method Q.loadAssetWebAudio
  @param {String} key
  @param {String} src
  @param {Function} callback
  @param {Function} errorCallback
  */
  Q.loadAssetWebAudio = function(key,src,callback,errorCallback) {
    var request = new XMLHttpRequest(),
        baseName = Q._removeExtension(src),
        extension = Q._audioAssetExtension();

    request.open("GET", Q.assetUrl(Q.options.audioPath,baseName + "." + extension), true);
    request.responseType = "arraybuffer";

    // Our asynchronous callback
    request.onload = function() {
      var audioData = request.response;

      Q.audioContext.decodeAudioData(request.response, function(buffer) {
        callback(key,buffer);
      }, errorCallback);
    };
    request.send();

  };

  /**
   Loader for other file types, just stores the data returned from an Ajax call.

   Just makes a Ajax request for all other file types

  @for Quintus
  @method Q.loadAssetOther
  @param {String} key
  @param {String} src
  @param {Function} callback
  @param {Function} errorCallback
  */
  Q.loadAssetOther = function(key,src,callback,errorCallback) {
    var request = new XMLHttpRequest();

    var fileParts = src.split("."),
        fileExt = fileParts[fileParts.length-1].toLowerCase();

    request.onreadystatechange = function() {
      if(request.readyState === 4) {
        if(request.status === 200) {
          if(fileExt === 'json') {
            callback(key,JSON.parse(request.responseText));
          } else {
            callback(key,request.responseText);
          }
        } else {
          errorCallback();
        }
      }
    };

    request.open("GET", Q.assetUrl(Q.options.dataPath,src), true);
    request.send(null);
  };

  /**
   Helper method to return a name without an extension

   @for Quintus
   @method _removeExtension
   @param {String} filename
   @return {String} filename without an extension
  */
  Q._removeExtension = function(filename) {
    return filename.replace(/\.(\w{3,4})$/,"");
  };

  // Asset hash storing any loaded assets
  Q.assets = {};

  /**
   Getter method to return an asset by its name.
  
   Asset names default to their filenames, but can be overridden
   by passing a hash to `load` to set different names.

   @for Quintus
   @method asset
   @param {String} name - name of asset to lookup
  */
  Q.asset = function(name) {
    return Q.assets[name];
  };

  /**
   Load assets, and call our callback when done.
  
   Also optionally takes a `progressCallback` which will be called 
   with the number of assets loaded and the total number of assets
   to allow showing of a progress. 
  
   Assets can be passed in as an array of file names, and Quintus
   will use the file names as the name for reference, or as a hash of 
   `{ name: filename }`. 
  
   Example usage:
       Q.load(['sprites.png','sprites.,json'],function() {
          Q.stageScene("level1"); // or something to start the game.
       });

  @for Quintus
  @method Q.load
  @param {String, Array or Array} assets - comma separated string, array or Object hash of assets to load
  @param {Function} callback - called when done loading
  @param {Object} options
  */
  Q.load = function(assets,callback,options) {
    var assetObj = {};

    /* Make sure we have an options hash to work with */
    if(!options) { options = {}; }

    /* Get our progressCallback if we have one */
    var progressCallback = options.progressCallback;

    var errors = false,
        errorCallback = function(itm) {
          errors = true;
          (options.errorCallback  ||
           function(itm) { throw("Error Loading: " + itm ); })(itm);
        };

    /* Convert to an array if it's a string */
    if(Q._isString(assets)) {
      assets = Q._normalizeArg(assets);
    }

    /* If the user passed in an array, convert it */
    /* to a hash with lookups by filename */
    if(Q._isArray(assets)) { 
      Q._each(assets,function(itm) {
        if(Q._isObject(itm)) {
          Q._extend(assetObj,itm);
        } else {
          assetObj[itm] = itm;
        }
      });
    } else {
      /* Otherwise just use the assets as is */
      assetObj = assets;
    }

    /* Find the # of assets we're loading */
    var assetsTotal = Q._keys(assetObj).length,
        assetsRemaining = assetsTotal;

    /* Closure'd per-asset callback gets called */
    /* each time an asset is successfully loadded */
    var loadedCallback = function(key,obj,force) {
      if(errors) { return; }

      // Prevent double callbacks (I'm looking at you Firefox, canplaythrough
      if(!Q.assets[key]||force) {

        /* Add the object to our asset list */
        Q.assets[key] = obj;

        /* We've got one less asset to load */
        assetsRemaining--;

        /* Update our progress if we have it */
        if(progressCallback) { 
           progressCallback(assetsTotal - assetsRemaining,assetsTotal); 
        }
      }

      /* If we're out of assets, call our full callback */
      /* if there is one */
      if(assetsRemaining === 0 && callback) {
        /* if we haven't set up our canvas element yet, */
        /* assume we're using a canvas with id 'quintus' */
        callback.apply(Q); 
      }
    };

    /* Now actually load each asset */
    Q._each(assetObj,function(itm,key) {

      /* Determine the type of the asset */
      var assetType = Q.assetType(itm);

      /* If we already have the asset loaded, */
      /* don't load it again */
      if(Q.assets[key]) {
        loadedCallback(key,Q.assets[key],true);
      } else {
        /* Call the appropriate loader function */
        /* passing in our per-asset callback */
        /* Dropping our asset by name into Q.assets */
        Q["loadAsset" + assetType](key,itm,
                                   loadedCallback,
                                   function() { errorCallback(itm); });
      }
    });

  };

  // Array to store any assets that need to be 
  // preloaded
  Q.preloads = [];
  
  /**
   Let us gather assets to load at a later time,
   and then preload them all at the same time with
   a single callback. Options are passed through to the
   Q.load method if used.
  
   Example usage:
        Q.preload("sprites.png");
        ...
        Q.preload("sprites.json");
        ...
  
        Q.preload(function() {
           Q.stageScene("level1"); // or something to start the game
        });
  @for Quintus
  @method Q.preload
  @param {String or Function} arg - comma separated string of assets to load, or callback
  @param {Object} [options] - options to pass to load
  */
  Q.preload = function(arg,options) {
    if(Q._isFunction(arg)) {
      Q.load(Q._uniq(Q.preloads),arg,options);
      Q.preloads = [];
    } else {
      Q.preloads = Q.preloads.concat(arg);
    }
  };


  // Math Methods
  // ==============
  //
  // Math methods, for rotating and scaling points

  // A list of matrices available
  Q.matrices2d = [];

  Q.matrix2d = function() {
    return Q.matrices2d.length > 0 ? Q.matrices2d.pop().identity() : new Q.Matrix2D();
  };

  /**
   A 2D matrix class, optimized for 2D points,
   where the last row of the matrix will always be 0,0,1 

   Do not call `new Q.Matrix2D` - use the provided Q.matrix2D factory function for GC happiness

        var matrix = Q.matrix2d();

   Good Docs here: https://github.com/heygrady/transform/wiki/calculating-2d-matrices

   Used internally by Quintus for all transforms / collision detection. Most of the methods modify the matrix they are called upon and are chainable.

   @class Q.Matrix2D
   @for Quintus
   @extends Q.Class
  */
  Q.Matrix2D = Q.Class.extend({
    /**
     Initialize a matrix from a source or with the identify matrix

     @constructor
     @for Q.Matrix2D
    */
    init: function(source) {
      if(source) {
        this.m = [];
        this.clone(source);
      } else {
        this.m = [1,0,0,0,1,0];
      }
    },

    /**
     Turn this matrix into the identity

     @for Q.Matrix2D
     @method identity
     @chainable
    */
    identity: function() {
      var m = this.m;
      m[0] = 1; m[1] = 0; m[2] = 0;
      m[3] = 0; m[4] = 1; m[5] = 0;
      return this;
    },

    /** 

     Clone another matrix into this one

     @for Q.Matrix2D
     @method clone
     @param {Q.Matrix2D} matrix - matrix to clone
     @chainable
    */
    clone: function(matrix) {
      var d = this.m, s = matrix.m;
      d[0]=s[0]; d[1]=s[1]; d[2] = s[2];
      d[3]=s[3]; d[4]=s[4]; d[5] = s[5];
      return this;
    },

    /**
     multiply two matrices (leaving the result in this)

        a * b = 
           [ [ a11*b11 + a12*b21 ], [ a11*b12 + a12*b22 ], [ a11*b31 + a12*b32 + a13 ] ,
           [ a21*b11 + a22*b21 ], [ a21*b12 + a22*b22 ], [ a21*b31 + a22*b32 + a23 ] ]

     @for Q.Matrix2D
     @method clone
     @param {Q.Matrix2D} matrix - matrix to multiply by
     @chainable
   */
    multiply: function(matrix) {
      var a = this.m, b = matrix.m;

      var m11 = a[0]*b[0] + a[1]*b[3];
      var m12 = a[0]*b[1] + a[1]*b[4];
      var m13 = a[0]*b[2] + a[1]*b[5] + a[2];

      var m21 = a[3]*b[0] + a[4]*b[3];
      var m22 = a[3]*b[1] + a[4]*b[4];
      var m23 = a[3]*b[2] + a[4]*b[5] + a[5];

      a[0]=m11; a[1]=m12; a[2] = m13;
      a[3]=m21; a[4]=m22; a[5] = m23;
      return this;
    },

    /** 
     
     Multiply this matrix by a rotation matrix rotated radians radians 

    @for Q.Matrix2D
    @method rotate
    @param {Float} radians - angle to rotate by
    @chainable
    */
    rotate: function(radians) {
      if(radians === 0) { return this; }
      var cos = Math.cos(radians),
          sin = Math.sin(radians),
          m = this.m;

      var m11 = m[0]*cos  + m[1]*sin;
      var m12 = m[0]*-sin + m[1]*cos;

      var m21 = m[3]*cos  + m[4]*sin;
      var m22 = m[3]*-sin + m[4]*cos;

      m[0] = m11; m[1] = m12; // m[2] == m[2]
      m[3] = m21; m[4] = m22; // m[5] == m[5]
      return this;
    },

    /**

     Helper method to rotate by a set number of degrees (calls rotate internally)

     @for Q.Matrix2D
     @method rotateDeg
     @param {Float} degrees
     @chainable
    */
    rotateDeg: function(degrees) {
      if(degrees === 0) { return this; }
      return this.rotate(Math.PI * degrees / 180);
    },

    /**

     Multiply this matrix by a scaling matrix scaling sx and sy
     @for Q.Matrix2D
     @method scale
     @param {Float} sx - scale in x dimension (scaling is uniform unless `sy` is provided)
     @param {Float} [sy] - scale in the y dimension
     @chainable
    */
    scale: function(sx,sy) {
      var m = this.m;
      if(sy === void 0) { sy = sx; }

      m[0] *= sx;
      m[1] *= sy;
      m[3] *= sx;
      m[4] *= sy;
      return this;
    },


    /** 
     Multiply this matrix by a translation matrix translate by tx and ty

     @for Q.Matrix2D
     @method translate
     @param {Float} tx
     @param {Float} ty
     @chainable
    */
    translate: function(tx,ty) {
      var m = this.m;

      m[2] += m[0]*tx + m[1]*ty;
      m[5] += m[3]*tx + m[4]*ty;
      return this;
    },


    /**
     Transform x and y coordinates by this matrix
     Memory Hoggy version, returns a new Array

     @for Q.Matrix2D
     @method transform
     @param {Float} x
     @param {Float} y

     */
    transform: function(x,y) {
      return [ x * this.m[0] + y * this.m[1] + this.m[2], 
               x * this.m[3] + y * this.m[4] + this.m[5] ];
    },

    /**
     Transform an object with an x and y property by this Matrix
     @for Q.Matrix2D
     @method transformPt
     @param {Object} obj
     @return {Object} obj
    */
    transformPt: function(obj) {
      var x = obj.x, y = obj.y;

      obj.x = x * this.m[0] + y * this.m[1] + this.m[2];
      obj.y = x * this.m[3] + y * this.m[4] + this.m[5];

      return obj;
    },

    /**
     Transform an array with an x and y elements by this Matrix and put the result in 
     the outArr

     @for Q.Matrix2D
     @method transformArr
     @param {Array} inArr - input array
     @param {Array} outArr - output array
     @return {Object} obj
    */
    transformArr: function(inArr,outArr) {
      var x = inArr[0], y = inArr[1];
      
      outArr[0] = x * this.m[0] + y * this.m[1] + this.m[2];
      outArr[1] = x * this.m[3] + y * this.m[4] + this.m[5];

      return outArr;
    },


    /**
     Return just the x coordinate transformed by this Matrix

     @for Q.Matrix2D
     @method transformX
     @param {Float} x
     @param {Float} y
     @return {Float} x transformed
    */
    transformX: function(x,y) {
      return x * this.m[0] + y * this.m[1] + this.m[2];
    },

    /**
     Return just the y coordinate transformed by this Matrix

     @for Q.Matrix2D
     @method transformY
     @param {Float} x
     @param {Float} y
     @return {Float} y transformed
    */
    transformY: function(x,y) {
      return x * this.m[3] + y * this.m[4] + this.m[5];
    },

    /**
     Release this Matrix to be reused

     @for Q.Matrix2D
     @method release
    */
    release: function() {
      Q.matrices2d.push(this);
      return null;
    },

    /**
     Set the complete transform on a Canvas 2D context

     @for Q.Matrix2D
     @method setContextTransform
     @param {Context2D} ctx - 2D canvs context
     */  
     setContextTransform: function(ctx) {
      var m = this.m;
      // source:
      //  m[0] m[1] m[2]
      //  m[3] m[4] m[5]
      //  0     0   1
      //
      // destination:
      //  m11  m21  dx
      //  m12  m22  dy
      //  0    0    1
      //  setTransform(m11, m12, m21, m22, dx, dy)
      ctx.transform(m[0],m[3],m[1],m[4],m[2],m[5]);
    }

  });

  // And that's it..
  // ===============
  //
  // Return the `Q` object from the `Quintus()` factory method. Create awesome games. Repeat.
  return Q;
};

// Lastly, add in the `requestAnimationFrame` shim, if necessary. Does nothing 
// if `requestAnimationFrame` is already on the `window` object.
(function() {
    var lastTime = 0;
    var vendors = ['ms', 'moz', 'webkit', 'o'];
    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
        window.cancelAnimationFrame = 
          window[vendors[x]+'CancelAnimationFrame'] || window[vendors[x]+'CancelRequestAnimationFrame'];
    }
 
    if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function() { callback(currTime + timeToCall); }, 
              timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
    }
 
    if (!window.cancelAnimationFrame) {
        window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
    }
}());



},{"../extra/quintus_dom":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/extra/quintus_dom.js","../extra/quintus_physics":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/extra/quintus_physics.js","../extra/quintus_svg":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/extra/quintus_svg.js","./quintus_2d":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_2d.js","./quintus_anim":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_anim.js","./quintus_audio":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_audio.js","./quintus_input":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_input.js","./quintus_scenes":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_scenes.js","./quintus_sprites":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_sprites.js","./quintus_tmx":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_tmx.js","./quintus_touch":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_touch.js","./quintus_ui":"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_ui.js"}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_2d.js":[function(require,module,exports){
/*global Quintus:false */

module.exports = function(Q) {

  Q.component('viewport',{
    added: function() {
      this.entity.on('prerender',this,'prerender');
      this.entity.on('render',this,'postrender');
      this.x = 0;
      this.y = 0;
      this.offsetX = 0;
      this.offsetY = 0;
      this.centerX = Q.width/2;
      this.centerY = Q.height/2;
      this.scale = 1;
    },

    extend: {
      follow: function(sprite,directions,boundingBox) {
        this.off('poststep',this.viewport,'follow');
        this.viewport.directions = directions || { x: true, y: true };
        this.viewport.following = sprite;
        this.viewport.boundingBox = boundingBox;
        this.on('poststep',this.viewport,'follow');
        this.viewport.follow(true);
      },

      unfollow: function() {
        this.off('poststep',this.viewport,'follow');
      },

      centerOn: function(x,y) {
        this.viewport.centerOn(x,y);
      },

      moveTo: function(x,y) {
        return this.viewport.moveTo(x,y);
      }
    },

    follow: function(first) {
      var followX = Q._isFunction(this.directions.x) ? this.directions.x(this.following) : this.directions.x;
      var followY = Q._isFunction(this.directions.y) ? this.directions.y(this.following) : this.directions.y;

      this[first === true ? 'centerOn' : 'softCenterOn'](
                    followX ? 
                      this.following.p.x + this.following.p.w/2 - this.offsetX :
                      undefined,
                    followY ?
                     this.following.p.y + this.following.p.h/2 - this.offsetY :
                     undefined
                  );
    },

    offset: function(x,y) {
      this.offsetX = x;
      this.offsetY = y;
    },

    softCenterOn: function(x,y) {
      if(x !== void 0) {        
        var dx = (x - Q.width / 2 / this.scale - this.x)/3;
        if(this.boundingBox) {
          if(this.x + dx < this.boundingBox.minX) {
            this.x = this.boundingBox.minX / this.scale;
          }
          else if(this.x + dx > (this.boundingBox.maxX - Q.width) / this.scale) {
            this.x = (this.boundingBox.maxX - Q.width) / this.scale;
          }
          else {
            this.x += dx;
          }            
        }
        else {
          this.x += dx;
        }
      }
      if(y !== void 0) { 
        var dy = (y - Q.height / 2 / this.scale - this.y)/3;
        if(this.boundingBox) {
          if(this.y + dy < this.boundingBox.minY) {
            this.y = this.boundingBox.minY / this.scale;
          }
          else if(this.y + dy > (this.boundingBox.maxY - Q.height) / this.scale) {
            this.y = (this.boundingBox.maxY - Q.height) / this.scale;
          }
          else {
            this.y += dy;
          }            
        }
        else {
          this.y += dy;
        }
      }

    },
    centerOn: function(x,y) {
      if(x !== void 0) {
        this.x = x - Q.width / 2 / this.scale;
      }
      if(y !== void 0) { 
        this.y = y - Q.height / 2 / this.scale;
      }

    },

    moveTo: function(x,y) {
      if(x !== void 0) {
        this.x = x;
      }
      if(y !== void 0) { 
        this.y = y;
      }
      return this.entity;

    },

    prerender: function() {
      this.centerX = this.x + Q.width / 2 /this.scale;
      this.centerY = this.y + Q.height / 2 /this.scale;
      Q.ctx.save();
      Q.ctx.translate(Math.floor(Q.width/2),Math.floor(Q.height/2));
      Q.ctx.scale(this.scale,this.scale);
      Q.ctx.translate(-Math.floor(this.centerX), -Math.floor(this.centerY));
    },

    postrender: function() {
      Q.ctx.restore();
    }
  });


 Q.Sprite.extend("TileLayer",{

    init: function(props) {
      this._super(props,{
        tileW: 32,
        tileH: 32,
        blockTileW: 10,
        blockTileH: 10,
        type: 1,
        renderAlways: true
      });
      if(this.p.dataAsset) {
        this.load(this.p.dataAsset);
      }

      this.setDimensions();

      this.blocks = [];
      this.p.blockW = this.p.tileW * this.p.blockTileW;
      this.p.blockH = this.p.tileH * this.p.blockTileH;
      this.colBounds = {}; 
      this.directions = [ 'top','left','right','bottom'];
      this.tileProperties = {};

      this.collisionObject = { 
        p: {
          w: this.p.tileW,
          h: this.p.tileH,
          cx: this.p.tileW/2,
          cy: this.p.tileH/2
        }
      };
      
      this.tileCollisionObjects = {};      

      this.collisionNormal = { separate: []};

      this._generateCollisionObjects();
    },

    // Generate the tileCollisionObject overrides where needed
    _generateCollisionObjects: function() {
      var self = this;

      function returnPoint(pt) {
        return [ pt[0] * self.p.tileW - self.p.tileW/2,
                 pt[1] * self.p.tileH - self.p.tileH/2
               ];
      }

      if(this.sheet() && this.sheet().frameProperties) {
        var frameProperties = this.sheet().frameProperties;
        for(var k in frameProperties) { 
          var colObj = this.tileCollisionObjects[k] = { p: Q._clone(this.collisionObject.p) };
          Q._extend(colObj.p,frameProperties[k]);

          if(colObj.p.points) {
            colObj.p.points = Q._map(colObj.p.points, returnPoint);
          }

          this.tileCollisionObjects[k] = colObj;
        }
      }

    },

    load: function(dataAsset) {
      var fileParts = dataAsset.split("."),
          fileExt = fileParts[fileParts.length-1].toLowerCase(),
          data;

      if (fileExt === "json") {  
        data = Q._isString(dataAsset) ?  Q.asset(dataAsset) : dataAsset;
      }
      else {
        throw "file type not supported";
      }
      this.p.tiles = data;
    },

    setDimensions: function() {
      var tiles = this.p.tiles;

      if(tiles) { 
        this.p.rows = tiles.length;
        this.p.cols = tiles[0].length;
        this.p.w = this.p.cols * this.p.tileW;
        this.p.h = this.p.rows * this.p.tileH;
      }
    },

    getTile: function(tileX,tileY) {
      return this.p.tiles[tileY] && this.p.tiles[tileY][tileX];
    },
    
    getTileProperty: function(tile, prop) {
      if(this.tileProperties[tile] !== undefined) {
        return this.tileProperties[tile][prop];          
      } else {
        return;
      }      
    },
    
    getTileProperties: function(tile) {
      if(this.tileProperties[tile] !== undefined) {
        return this.tileProperties[tile];          
      } else {
        return {};
      }
    },
    
    getTilePropertyAt: function(tileX, tileY, prop) {
      return this.getTileProperty(this.getTile(tileX, tileY), prop);
    },
    
    getTilePropertiesAt: function(tileX, tileY) {
      return this.getTileProperties(this.getTile(tileX, tileY));
    },
    
    tileHasProperty: function(tile, prop) {
      return(this.getTileProperty(tile, prop) !== undefined);
    },    

    setTile: function(x,y,tile) {
      var p = this.p,
          blockX = Math.floor(x/p.blockTileW),
          blockY = Math.floor(y/p.blockTileH);

      if(x >= 0 && x < this.p.cols &&
         y >= 0 && y < this.p.rows) { 

        this.p.tiles[y][x] = tile;

        if(this.blocks[blockY]) {
          this.blocks[blockY][blockX] = null;
        }
      }
    },

    tilePresent: function(tileX,tileY) {
      return this.p.tiles[tileY] && this.collidableTile(this.p.tiles[tileY][tileX]);
    },

    // Overload this method to draw tiles at frame 0 or not draw
    // tiles at higher number frames
    drawableTile: function(tileNum) {
      return tileNum > 0;
    },

    // Overload this method to control which tiles trigger a collision
    // (defaults to all tiles > number 0)
    collidableTile: function(tileNum) {
      return tileNum > 0;
    },
    
    getCollisionObject: function(tileX, tileY) {
      var p = this.p,
          tile = this.getTile(tileX, tileY),
          colObj;
      
      colObj = (this.tileCollisionObjects[tile] !== undefined) ? 
        this.tileCollisionObjects[tile] : this.collisionObject;     
      
      colObj.p.x = tileX * p.tileW + p.x + p.tileW/2;
      colObj.p.y = tileY * p.tileH + p.y + p.tileH/2;
      
      return colObj;
    },

    collide: function(obj) {
      var p = this.p,
          objP = obj.c || obj.p, 
          tileStartX = Math.floor((objP.x - objP.cx - p.x) / p.tileW),
          tileStartY = Math.floor((objP.y - objP.cy - p.y) / p.tileH),
          tileEndX =  Math.ceil((objP.x - objP.cx + objP.w - p.x) / p.tileW),
          tileEndY =  Math.ceil((objP.y - objP.cy + objP.h - p.y) / p.tileH),
          normal = this.collisionNormal,
          col, colObj;
  
      normal.collided = false;

      for(var tileY = tileStartY; tileY<=tileEndY; tileY++) {
        for(var tileX = tileStartX; tileX<=tileEndX; tileX++) {
          if(this.tilePresent(tileX,tileY)) {
            colObj = this.getCollisionObject(tileX, tileY);

            col = Q.collision(obj,colObj);
      
            if(col && col.magnitude > 0) {
              if(colObj.p.sensor) {
                colObj.tile = this.getTile(tileX,tileY);
                if(obj.trigger) { 
                  obj.trigger('sensor.tile',colObj); 
                }
              } else if(!normal.collided || normal.magnitude < col.magnitude ) {
                 normal.collided = true;
                 normal.separate[0] = col.separate[0];
                 normal.separate[1] = col.separate[1];
                 normal.magnitude = col.magnitude;
                 normal.distance = col.distance;
                 normal.normalX = col.normalX;
                 normal.normalY = col.normalY;
                 normal.tileX = tileX;
                 normal.tileY = tileY;
                 normal.tile = this.getTile(tileX,tileY);
                 if(obj.p.collisions !== undefined) {
                   obj.p.collisions.push(normal);               
                 }
              }
            }
          }
        }
      }

      return normal.collided ? normal : false;
    },

    prerenderBlock: function(blockX,blockY) {
      var p = this.p,
          tiles = p.tiles,
          sheet = this.sheet(),
          blockOffsetX = blockX*p.blockTileW,
          blockOffsetY = blockY*p.blockTileH;

      if(blockOffsetX < 0 || blockOffsetX >= this.p.cols ||
         blockOffsetY < 0 || blockOffsetY >= this.p.rows) {
           return;
      }

      var canvas = document.createElement('canvas'),
          ctx = canvas.getContext('2d');

      canvas.width = p.blockW;
      canvas.height= p.blockH;
      this.blocks[blockY] = this.blocks[blockY] || {};
      this.blocks[blockY][blockX] = canvas;

      for(var y=0;y<p.blockTileH;y++) {
        if(tiles[y+blockOffsetY]) {
          for(var x=0;x<p.blockTileW;x++) {
            if(this.drawableTile(tiles[y+blockOffsetY][x+blockOffsetX])) {
              sheet.draw(ctx,
                         x*p.tileW,
                         y*p.tileH,
                         tiles[y+blockOffsetY][x+blockOffsetX]);
            }
          }
        }
      }
    },

    drawBlock: function(ctx, blockX, blockY) {
      var p = this.p,
          startX = Math.floor(blockX * p.blockW + p.x),
          startY = Math.floor(blockY * p.blockH + p.y);

      if(!this.blocks[blockY] || !this.blocks[blockY][blockX]) {
        this.prerenderBlock(blockX,blockY);
      }

      if(this.blocks[blockY]  && this.blocks[blockY][blockX]) {
        ctx.drawImage(this.blocks[blockY][blockX],startX,startY);
      }
    },

    draw: function(ctx) {
      var p = this.p,
          viewport = this.stage.viewport,
          scale = viewport ? viewport.scale : 1,
          x = viewport ? viewport.x : 0,
          y = viewport ? viewport.y : 0,
          viewW = Q.width / scale,
          viewH = Q.height / scale,
          startBlockX = Math.floor((x - p.x) / p.blockW),
          startBlockY = Math.floor((y - p.y) / p.blockH),
          endBlockX = Math.floor((x + viewW - p.x) / p.blockW),
          endBlockY = Math.floor((y + viewH - p.y) / p.blockH);

      for(var iy=startBlockY;iy<=endBlockY;iy++) {
        for(var ix=startBlockX;ix<=endBlockX;ix++) {
          this.drawBlock(ctx,ix,iy);
        }
      }
    }
  });

  Q.gravityY = 9.8*100;
  Q.gravityX = 0;

  Q.component('2d',{
    added: function() {
      var entity = this.entity;
      Q._defaults(entity.p,{
        vx: 0,
        vy: 0,
        ax: 0,
        ay: 0,
        gravity: 1,
        collisionMask: Q.SPRITE_DEFAULT
      });
      entity.on('step',this,"step");
      entity.on('hit',this,'collision');
    },

    collision: function(col,last) {
      var entity = this.entity,
          p = entity.p,
          magnitude = 0;

      if(col.obj.p && col.obj.p.sensor) {
        col.obj.trigger("sensor",entity);
        return;
      }

      col.impact = 0;
      var impactX = Math.abs(p.vx);
      var impactY = Math.abs(p.vy);

      p.x -= col.separate[0];
      p.y -= col.separate[1];

      // Top collision
      if(col.normalY < -0.3) { 
        if(!p.skipCollide && p.vy > 0) { p.vy = 0; }
        col.impact = impactY;
        entity.trigger("bump.bottom",col);
      }
      if(col.normalY > 0.3) {
        if(!p.skipCollide && p.vy < 0) { p.vy = 0; }
        col.impact = impactY;

        entity.trigger("bump.top",col);
      }

      if(col.normalX < -0.3) { 
        if(!p.skipCollide && p.vx > 0) { p.vx = 0;  }
        col.impact = impactX;
        entity.trigger("bump.right",col);
      }
      if(col.normalX > 0.3) { 
        if(!p.skipCollide && p.vx < 0) { p.vx = 0; }
        col.impact = impactX;

        entity.trigger("bump.left",col);
      }
    },

    step: function(dt) {
      var p = this.entity.p,
          dtStep = dt;
      // TODO: check the entity's magnitude of vx and vy,
      // reduce the max dtStep if necessary to prevent 
      // skipping through objects.
      while(dtStep > 0) {
        dt = Math.min(1/30,dtStep);
        // Updated based on the velocity and acceleration
        p.vx += p.ax * dt + (p.gravityX === void 0 ? Q.gravityX : p.gravityX) * dt * p.gravity;
        p.vy += p.ay * dt + (p.gravityY === void 0 ? Q.gravityY : p.gravityY) * dt * p.gravity;
        p.x += p.vx * dt;
        p.y += p.vy * dt;

        this.entity.stage.collide(this.entity);
        dtStep -= dt;
      }
    }
  });

  Q.component('aiBounce', {
    added: function() {
      this.entity.on("bump.right",this,"goLeft");
      this.entity.on("bump.left",this,"goRight");
    },

    goLeft: function(col) {
      this.entity.p.vx = -col.impact;      
      if(this.entity.p.defaultDirection === 'right') {
          this.entity.p.flip = 'x';
      }
      else {
          this.entity.p.flip = false;
      }
    },

    goRight: function(col) {
      this.entity.p.vx = col.impact;
      if(this.entity.p.defaultDirection === 'left') {
          this.entity.p.flip = 'x';
      }
      else {
          this.entity.p.flip = false;
      }
    }
  });

};

},{}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_anim.js":[function(require,module,exports){
/*global Quintus:false */

module.exports = function(Q) {

  Q._animations = {};
  Q.animations = function(sprite,animations) {
    if(!Q._animations[sprite]) { Q._animations[sprite] = {}; }
    Q._extend(Q._animations[sprite],animations);
  };

  Q.animation = function(sprite,name) {
    return Q._animations[sprite] && Q._animations[sprite][name];
  };

  Q.component('animation',{
    added: function() {
      var p = this.entity.p;
      p.animation = null;
      p.animationPriority = -1;
      p.animationFrame = 0;
      p.animationTime = 0;
      this.entity.on("step",this,"step");
    },
    extend: {
      play: function(name,priority,resetFrame) {
        this.animation.play(name,priority,resetFrame);
      }
    },
    step: function(dt) {
      var entity = this.entity,
          p = entity.p;
      if(p.animation) {
        var anim = Q.animation(p.sprite,p.animation),
            rate = anim.rate || p.rate,
            stepped = 0;
        p.animationTime += dt;
        if(p.animationChanged) {
          p.animationChanged = false;
        } else { 
          p.animationTime += dt;
          if(p.animationTime > rate) {
            stepped = Math.floor(p.animationTime / rate);
            p.animationTime -= stepped * rate;
            p.animationFrame += stepped;
          }
        }
        if(stepped > 0) {
          if(p.animationFrame >= anim.frames.length) {
            if(anim.loop === false || anim.next) {
              p.animationFrame = anim.frames.length - 1;
              entity.trigger('animEnd');
              entity.trigger('animEnd.' + p.animation);
              p.animation = null;
              p.animationPriority = -1;
              if(anim.trigger) {  
                entity.trigger(anim.trigger,anim.triggerData);
              }
              if(anim.next) { this.play(anim.next,anim.nextPriority); }
              return;
            } else {
              entity.trigger('animLoop');
              entity.trigger('animLoop.' + p.animation);
              p.animationFrame = p.animationFrame % anim.frames.length;
            }
          }
          entity.trigger("animFrame");
        }
        p.sheet = anim.sheet || p.sheet;
        p.frame = anim.frames[p.animationFrame];
        if(anim.hasOwnProperty("flip")) { p.flip  = anim.flip; }
      }
    },

    play: function(name,priority,resetFrame) {
      var entity = this.entity,
          p = entity.p;
      priority = priority || 0;
      if(name !== p.animation && priority >= p.animationPriority) {
        if(resetFrame === undefined) {
          resetFrame = true;
        }
        p.animation = name;
        if(resetFrame) {
          p.animationChanged = true;
          p.animationTime = 0;          
          p.animationFrame = 0;
        }        
        p.animationPriority = priority;
        entity.trigger('anim');
        entity.trigger('anim.' + p.animation);
      }
    }
  
  });


  Q.Sprite.extend("Repeater",{
    init: function(props) {
      this._super(Q._defaults(props,{
        speedX: 1,
        speedY: 1,
        repeatY: true,
        repeatX: true,
        renderAlways: true,
        type: 0
      }));
      this.p.repeatW = this.p.repeatW || this.p.w;
      this.p.repeatH = this.p.repeatH || this.p.h;
    },

    draw: function(ctx) {
      var p = this.p,
          asset = this.asset(),
          sheet = this.sheet(),
          scale = this.stage.viewport ? this.stage.viewport.scale : 1,
          viewX = Math.floor(this.stage.viewport ? this.stage.viewport.x : 0),
          viewY = Math.floor(this.stage.viewport ? this.stage.viewport.y : 0),
          offsetX = Math.floor(p.x + viewX * this.p.speedX),
          offsetY = Math.floor(p.y + viewY * this.p.speedY),
          curX, curY, startX;
      if(p.repeatX) {
        curX = -offsetX % p.repeatW;
        if(curX > 0) { curX -= p.repeatW; }
      } else {
        curX = p.x - viewX;
      }
      if(p.repeatY) {
        curY = -offsetY % p.repeatH;
        if(curY > 0) { curY -= p.repeatH; }
      } else {
        curY = p.y - viewY;
      }

      startX = curX;
      while(curY < Q.height / scale) {
        curX = startX;
        while(curX < Q.width / scale) {
          if(sheet) {
            sheet.draw(ctx,curX + viewX,curY + viewY,p.frame);
          } else {
            ctx.drawImage(asset,curX + viewX,curY + viewY);
          }
          curX += p.repeatW;
          if(!p.repeatX) { break; }
        }
        curY += p.repeatH;
        if(!p.repeatY) { break; }
      }
    }
  });

  Q.Tween = Q.Class.extend({
    init: function(entity,properties,duration,easing,options) {
      if(Q._isObject(easing)) { options = easing; easing = Q.Easing.Linear; }
      if(Q._isObject(duration)) { options = duration; duration = 1; }

      this.entity = entity;
      //this.p = (entity instanceof Q.Stage) ? entity.viewport : entity.p;
      this.duration = duration || 1;
      this.time = 0;
      this.options = options || {};
      this.delay = this.options.delay || 0;
      this.easing = easing || this.options.easing || Q.Easing.Linear;

      this.startFrame = Q._loopFrame + 1;
      this.properties = properties;
      this.start = {};
      this.diff = {};
    },

    step: function(dt) {
      var property;

      if(this.startFrame > Q._loopFrame) { return true; }
      if(this.delay >= dt) {
        this.delay -= dt;
        return true;
      }

      if(this.delay > 0) {
        dt -= this.delay;
        this.delay = 0;
      }

      if(this.time === 0) {
        // first time running? Initialize the properties to chaining correctly.
        var entity = this.entity, properties = this.properties;
        this.p = (entity instanceof Q.Stage) ? entity.viewport : entity.p;
        for(property in properties) {
          this.start[property] = this.p[property];
          if(!Q._isUndefined(this.start[property])) {
            this.diff[property] = properties[property] - this.start[property];
          }
        }
      }
      this.time += dt;

      var progress = Math.min(1,this.time / this.duration),
          location = this.easing(progress);

      for(property in this.start) {
        if(!Q._isUndefined(this.p[property])) {
          this.p[property] = this.start[property] + this.diff[property] * location;
        }
      }

      if(progress >= 1) {
        if(this.options.callback) { 
          this.options.callback.apply(this.entity);
        }
      }
      return progress < 1;
    }
  });

  // Code ripped directly from Tween.js
  // https://github.com/sole/tween.js/blob/master/src/Tween.js
  Q.Easing = {
    Linear: function (k) { return k; },

    Quadratic: {
      In: function ( k )  { return k * k; },
      Out: function ( k ) {return k * ( 2 - k ); },
      InOut: function ( k ) {
        if ((k *= 2 ) < 1) { return 0.5 * k * k; }
        return -0.5 * (--k * (k - 2) - 1);
      }
    }
  };

  Q.component('tween',{
    added: function() {
      this._tweens = [];
      this.entity.on("step",this,"step");
    },
    extend: {
      animate: function(properties,duration,easing,options) {
        this.tween._tweens.push(new Q.Tween(this,properties,duration,easing,options));
        return this;
      },

      chain: function(properties,duration,easing,options) {
        if(Q._isObject(easing)) { options = easing; easing = Q.Easing.Linear; }
        // Chain an animation to the end
        var tweenCnt = this.tween._tweens.length;
        if(tweenCnt > 0) {
          var lastTween = this.tween._tweens[tweenCnt - 1];
          options = options || {};
          options['delay'] = lastTween.duration - lastTween.time + lastTween.delay;
        } 

        this.animate(properties,duration,easing,options);
        return this;
      },

      stop: function() {
        this.tween._tweens.length = 0;
        return this;
      }
    },

    step: function(dt) {
      for(var i=0; i < this._tweens.length; i++) {
        if(!this._tweens[i].step(dt)) {
          this._tweens.splice(i,1);
          i--;
        }
      }
    }
  });


};


},{}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_audio.js":[function(require,module,exports){
/*global Quintus:false, AudioContext:false, window:false */

module.exports = function(Q) {

  Q.audio = {
    channels: [],
    channelMax:  Q.options.channelMax || 10,
    active: {},
    play: function() {}
  };


  Q.hasWebAudio = (typeof AudioContext !== "undefined") || (typeof webkitAudioContext !== "undefined");

  if(Q.hasWebAudio) { 
    if(typeof AudioContext !== "undefined") {
      Q.audioContext = new AudioContext();
    } else {
      Q.audioContext = new window.webkitAudioContext();
    }
  }

  Q.enableSound = function() {
    var hasTouch =  !!('ontouchstart' in window);

    if(Q.hasWebAudio) {
      Q.audio.enableWebAudioSound();
    } else {
      Q.audio.enableHTML5Sound();
    }
    return Q;
  };

  Q.audio.enableWebAudioSound = function() {
    Q.audio.type = "WebAudio";

    Q.audio.soundID = 0;

    Q.audio.playingSounds = {};

    Q.audio.removeSound = function(soundID) {
      delete Q.audio.playingSounds[soundID];
    };

    // Play a single sound, optionally debounced 
    // to prevent repeated plays in a short time
    Q.audio.play = function(s,options) {
      var now = new Date().getTime();

      // See if this audio file is currently being debounced, if 
      // it is, don't do anything and just return
      if(Q.audio.active[s] && Q.audio.active[s] > now) { return; }

      // If any options were passed in, check for a debounce,
      // which is the number of milliseconds to debounce this sound
      if(options && options['debounce']) {
        Q.audio.active[s] = now + options['debounce'];
      } else {
        delete Q.audio.active[s];
      }

      var soundID = Q.audio.soundID++;

      var source = Q.audioContext.createBufferSource();
      source.buffer = Q.asset(s);
      source.connect(Q.audioContext.destination);
      if(options && options['loop']) {
        source.loop = true;
      } else {
        setTimeout(function() {
          Q.audio.removeSound(soundID);
        },source.buffer.duration * 1000);
      }
      source.assetName = s;
      if(source.start) { source.start(0); } else { source.noteOn(0); }

      Q.audio.playingSounds[soundID] = source;


    };

    Q.audio.stop = function(s) {
      for(var key in Q.audio.playingSounds) {
        var snd = Q.audio.playingSounds[key];
        if(!s || s === snd.assetName) {
          if(snd.stop) { snd.stop(0);  } else {  snd.noteOff(0); }
        }
      }
    };

  };

  Q.audio.enableHTML5Sound = function() {
    Q.audio.type = "HTML5";

    for (var i=0;i<Q.audio.channelMax;i++) {	
      Q.audio.channels[i] = {};
      Q.audio.channels[i]['channel'] = new Audio(); 
      Q.audio.channels[i]['finished'] = -1;	
    }

    // Play a single sound, optionally debounced 
    // to prevent repeated plays in a short time
    Q.audio.play = function(s,options) {
      var now = new Date().getTime();

      // See if this audio file is currently being debounced, if 
      // it is, don't do anything and just return
      if(Q.audio.active[s] && Q.audio.active[s] > now) { return; }

      // If any options were passed in, check for a debounce,
      // which is the number of milliseconds to debounce this sound
      if(options && options['debounce']) {
        Q.audio.active[s] = now + options['debounce'];
      } else {
        delete Q.audio.active[s];
      }

      // Find a free audio channel and play the sound
      for (var i=0;i<Q.audio.channels.length;i++) {
        // Check the channel is either finished or not looping
        if (!Q.audio.channels[i]['loop'] && Q.audio.channels[i]['finished'] < now) {	

          Q.audio.channels[i]['channel'].src = Q.asset(s).src;

          // If we're looping - just set loop to true to prevent this channcel
          // from being used.
          if(options && options['loop']) { 
            Q.audio.channels[i]['loop'] = true;
            Q.audio.channels[i]['channel'].loop = true;
          } else {
            Q.audio.channels[i]['finished'] = now + Q.asset(s).duration*1000;
          }
          Q.audio.channels[i]['channel'].load();
          Q.audio.channels[i]['channel'].play();
          break;
        }
      }
    };

    // Stop a single sound asset or stop all sounds currently playing
    Q.audio.stop = function(s) {
      var src = s ? Q.asset(s).src : null;
      var tm = new Date().getTime();
      for (var i=0;i<Q.audio.channels.length;i++) {
        if ((!src || Q.audio.channels[i]['channel'].src === src) && 
            (Q.audio.channels[i]['loop'] || Q.audio.channels[i]['finished'] >= tm)) {
          Q.audio.channels[i]['channel'].pause();
          Q.audio.channels[i]['loop'] = false;
        }
      }
    };

  };

};
  

},{}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_input.js":[function(require,module,exports){
/*global Quintus:false */
/**
Quintus HTML5 Game Engine - Input Module

The code in `quintus_input.js` defines the `Quintus.Input` module, which
concerns itself with game-type (pretty anything besides touchscreen input)

@module Quintus.Input
*/

/**
 * Quintus Input Module
 *
 * @class Quintus.Input
 */
module.exports = function(Q) {
  /**
   * Provided key names mapped to key codes - add more names and key codes as necessary
   *
   * @for Quintus.Input
   * @property KEY_NAMES
   * @type Object
   * @static
   */
  var KEY_NAMES = Q.KEY_NAMES = {
    LEFT: 37, RIGHT: 39,
    UP: 38, DOWN: 40,
    SPACE: 32,
    Z: 90,
    X: 88,
    ENTER: 13,
    ESC: 27,
    P: 80,
    S: 83
  };

  var DEFAULT_KEYS = {
    LEFT: 'left', RIGHT: 'right',
    UP: 'up',     DOWN: 'down',
    SPACE: 'fire',
    Z: 'fire',
    X: 'action',
    ENTER: 'confirm',
    ESC: 'esc',
    P: 'P',
    S: 'S'
  };

  var DEFAULT_TOUCH_CONTROLS  = [ ['left','<' ],
                            ['right','>' ],
                            [],
                            ['action','b'],
                            ['fire', 'a' ]];

  // Clockwise from midnight (a la CSS)
  var DEFAULT_JOYPAD_INPUTS =  [ 'up','right','down','left'];

  /**
   * Current state of bound inputs
   *
   * @for Quintus.Input
   * @property Q.inputs
   * @type Object
   */
  Q.inputs = {};
  Q.joypad = {};

  var hasTouch =  !!('ontouchstart' in window);


  /**
   *
   * Convert a canvas point to a stage point, x dimension
   *
   * @method Q.canvasToStageX
   * @for Quintus.Input
   * @param {Float} x
   * @param {Q.Stage} stage
   * @returns {Integer} x
   */
  Q.canvasToStageX = function(x,stage) {
    x = x / Q.cssWidth * Q.width;
    if(stage.viewport) {
      x /= stage.viewport.scale;
      x += stage.viewport.x;
    }

    return x;
  };

  /**
   *
   * Convert a canvas point to a stage point, y dimension
   *
   * @method Q.canvasToStageY
   * @param {Float} y
   * @param {Q.Stage} stage
   * @returns {Integer} y
   */
  Q.canvasToStageY = function(y,stage) {
      y = y / Q.cssWidth * Q.width;
      if(stage.viewport) {
        y /= stage.viewport.scale;
        y += stage.viewport.y;
      }

      return y;
  };



  /**
   *
   * Button and mouse input subsystem for Quintus.
   * An instance of this class is auto-created as {{#crossLink "Q.input"}}{{/crossLink}}
   *
   * @class Q.InputSystem
   * @extends Q.Evented
   * @for Quintus.Input
   */
  Q.InputSystem = Q.Evented.extend({
    keys: {},
    keypad: {},
    keyboardEnabled: false,
    touchEnabled: false,
    joypadEnabled: false,

    /**
     * Bind a key name or keycode to an action name (used by `keyboardControls`)
     *
     * @method bindKey
     * @for Q.InputSystem
     * @param {String or Integer} key - name or integer keycode for to bind
     * @param {String} name - name of action to bind to
     */
    bindKey: function(key,name) {
      Q.input.keys[KEY_NAMES[key] || key] = name;
    },

    /**
     * Enable keyboard controls by binding to events
     *
     * @for Q.InputSystem
     * @method enableKeyboard
     */
    enableKeyboard: function() {
      if(this.keyboardEnabled) { return false; }

      // Make selectable and remove an :focus outline
      Q.el.tabIndex = 0;
      Q.el.style.outline = 0;

      Q.el.addEventListener("keydown",function(e) {
        if(Q.input.keys[e.keyCode]) {
          var actionName = Q.input.keys[e.keyCode];
          Q.inputs[actionName] = true;
          Q.input.trigger(actionName);
          Q.input.trigger('keydown',e.keyCode);
        }
        e.preventDefault();
      },false);

      Q.el.addEventListener("keyup",function(e) {
        if(Q.input.keys[e.keyCode]) {
          var actionName = Q.input.keys[e.keyCode];
          Q.inputs[actionName] = false;
          Q.input.trigger(actionName + "Up");
          Q.input.trigger('keyup',e.keyCode);
        }
        e.preventDefault();
      },false);

      if(Q.options.autoFocus) {  Q.el.focus(); }
      this.keyboardEnabled = true;
    },


    /**
     * Convenience method to activate keyboard controls (call `bindKey` and `enableKeyboard` internally)
      *
     * @method keyboardControls
     * @for Q.InputSystem
     * @param {Object} [keys] - hash of key names or codes to actions
     */
    keyboardControls: function(keys) {
      keys = keys || DEFAULT_KEYS;
      Q._each(keys,function(name,key) {
       this.bindKey(key,name);
      },Q.input);
      this.enableKeyboard();
    },

    _containerOffset: function() {
      Q.input.offsetX = 0;
      Q.input.offsetY = 0;
      var el = Q.el;
      do {
        Q.input.offsetX += el.offsetLeft;
        Q.input.offsetY += el.offsetTop;
      } while(el = el.offsetParent);
    },

    touchLocation: function(touch) {
      var el = Q.el, 
        posX = touch.offsetX,
        posY = touch.offsetY,
        touchX, touchY;

      if(Q._isUndefined(posX) || Q._isUndefined(posY)) {
        posX = touch.layerX;
        posY = touch.layerY;
      }

      if(Q._isUndefined(posX) || Q._isUndefined(posY)) {
        if(Q.input.offsetX === void 0) { Q.input._containerOffset(); }
        posX = touch.pageX - Q.input.offsetX;
        posY = touch.pageY - Q.input.offsetY;
      }

      touchX = Q.width * posX / Q.cssWidth;
      touchY = Q.height * posY / Q.cssHeight;


      return { x: touchX, y: touchY };
    },

    /**
     * Activate touch button controls - pass in an options hash to override
     *
     * Default Options:
     *
     *     {
     *        left: 0,
     *        gutter:10,
     *        controls: DEFAULT_TOUCH_CONTROLS,
     *        width: Q.width,
     *        bottom: Q.height
     *      }
     *
     * Default controls are left and right buttons, a space, and 'a' and 'b' buttons, as defined as an Array of Arrays below:
     *
     *      [ ['left','<' ],
     *        ['right','>' ],
     *        [],  // use an empty array as a spacer
     *        ['action','b'],
     *        ['fire', 'a' ]]
     *
     * @method touchControls
     * @for Q.InputSystem
     * @param {Object} [opts] - Options hash
     */
    touchControls: function(opts) {
      if(this.touchEnabled) { return false; }
      if(!hasTouch) { return false; }

      Q.input.keypad = opts = Q._extend({
        left: 0,
        gutter:10,
        controls: DEFAULT_TOUCH_CONTROLS,
        width: Q.width,
        bottom: Q.height,
        fullHeight: false
      },opts);

      opts.unit = (opts.width / opts.controls.length);
      opts.size = opts.unit - 2 * opts.gutter;

      function getKey(touch) {
        var pos = Q.input.touchLocation(touch),
            minY = opts.bottom - opts.unit;
        for(var i=0,len=opts.controls.length;i<len;i++) {
          var minX = opts.left + i * opts.unit + i * opts.gutter;
          if(pos.x >=  minX && pos.x <= (minX+opts.unit) && (opts.fullHeight || (pos.y >= minY && pos.y <= (minY+opts.unit)))) {
            return opts.controls[i][0];
          }
        }
      }

      function touchDispatch(event) {
        var wasOn = {},
            i, len, tch, key, actionName;

        // Reset all the actions bound to controls
        // but keep track of all the actions that were on
        for(i=0,len = opts.controls.length;i<len;i++) {
          actionName = opts.controls[i][0];
          if(Q.inputs[actionName]) { wasOn[actionName] = true; }
          Q.inputs[actionName] = false;
        }

        var touches = event.touches ? event.touches : [ event ];

        for(i=0,len=touches.length;i<len;i++) {
          tch = touches[i];
          key = getKey(tch);

          if(key) {
            // Mark this input as on
            Q.inputs[key] = true;

            // Either trigger a new action
            // or remove from wasOn list
            if(!wasOn[key]) {
              Q.input.trigger(key);
            } else {
              delete wasOn[key];
            }
          }
        }

        // Any remaining were on the last frame
        // and need to trigger an up action
        for(actionName in wasOn) {
          Q.input.trigger(actionName + "Up");
        }

        return null;
      }

      this.touchDispatchHandler = function(e) {
        touchDispatch(e);
        e.preventDefault();
      };


      Q._each(["touchstart","touchend","touchmove","touchcancel"],function(evt) {
        Q.el.addEventListener(evt,this.touchDispatchHandler);
      },this);

      this.touchEnabled = true;
    },

    /**
     * Turn off touch (buytton and joypad) controls and remove event listeners
     *
     * @method disableTouchControls
     * @for Q.InputSystem
     */
    disableTouchControls: function() {
      Q._each(["touchstart","touchend","touchmove","touchcancel"],function(evt) {
        Q.el.removeEventListener(evt,this.touchDispatchHandler);
      },this);

      Q.el.removeEventListener('touchstart',this.joypadStart);
      Q.el.removeEventListener('touchmove',this.joypadMove);
      Q.el.removeEventListener('touchend',this.joypadEnd);
      Q.el.removeEventListener('touchcancel',this.joypadEnd);
      this.touchEnabled = false;

      // clear existing inputs
      for(var input in Q.inputs) {
        Q.inputs[input] = false;
      }
    },

    /** 
     * Activate joypad controls (i.e. 4-way touch controls)
     *
     * Lots of options, defaults are:
     * 
     *     {
     *      size: 50,
     *      trigger: 20,
     *      center: 25,
     *      color: "#CCC",
     *      background: "#000",
     *      alpha: 0.5,
     *      zone: Q.width / 2,
     *      inputs: DEFAULT_JOYPAD_INPUTS
     *    }
     *
     *  Default joypad controls is an array that defines the inputs to bind to:
     *
     *       // Clockwise from midnight (a la CSS)
     *       var DEFAULT_JOYPAD_INPUTS =  [ 'up','right','down','left'];
     *
     * @method joypadControls
     * @for Q.InputSystem
     * @param {Object} [opts] -  joypad options
     */
   joypadControls: function(opts) {
      if(this.joypadEnabled) { return false; }
      if(!hasTouch) { return false; }

      var joypad = Q.joypad = Q._defaults(opts || {},{
        size: 50,
        trigger: 20,
        center: 25,
        color: "#CCC",
        background: "#000",
        alpha: 0.5,
        zone: Q.width / 2,
        joypadTouch: null,
        inputs: DEFAULT_JOYPAD_INPUTS,
        triggers: []
      });

      this.joypadStart = function(evt) {
        if(joypad.joypadTouch === null) {
          var touch = evt.changedTouches[0],
              loc = Q.input.touchLocation(touch);

          if(loc.x < joypad.zone) {
            joypad.joypadTouch = touch.identifier;
            joypad.centerX = loc.x;
            joypad.centerY = loc.y; 
            joypad.x = null;
            joypad.y = null;
          }
        }
      };

      
      this.joypadMove = function(e) {
        if(joypad.joypadTouch !== null) {
          var evt = e;

          for(var i=0,len=evt.changedTouches.length;i<len;i++) {
            var touch = evt.changedTouches[i];

            if(touch.identifier === joypad.joypadTouch) {
              var loc = Q.input.touchLocation(touch),
                  dx = loc.x - joypad.centerX,
                  dy = loc.y - joypad.centerY,
                  dist = Math.sqrt(dx * dx + dy * dy),
                  overage = Math.max(1,dist / joypad.size),
                  ang =  Math.atan2(dx,dy);

              if(overage > 1) {
                dx /= overage;
                dy /= overage;
                dist /= overage;
              }

              var triggers = [
                dy < -joypad.trigger,
                dx > joypad.trigger,
                dy > joypad.trigger,
                dx < -joypad.trigger
              ];

              for(var k=0;k<triggers.length;k++) {
                var actionName = joypad.inputs[k];
                if(triggers[k]) {
                  Q.inputs[actionName] = true;

                  if(!joypad.triggers[k]) { 
                    Q.input.trigger(actionName);
                  }
                } else {
                  Q.inputs[actionName] = false;
                  if(joypad.triggers[k]) { 
                    Q.input.trigger(actionName + "Up");
                  }
                }
              }

              Q._extend(joypad, {
                dx: dx, dy: dy,
                x: joypad.centerX + dx,
                y: joypad.centerY + dy,
                dist: dist,
                ang: ang,
                triggers: triggers
              });

              break;
            }
          }
        }
        e.preventDefault();
      };

      this.joypadEnd = function(e) { 
          var evt = e;

          if(joypad.joypadTouch !== null) {
            for(var i=0,len=evt.changedTouches.length;i<len;i++) { 
            var touch = evt.changedTouches[i];
              if(touch.identifier === joypad.joypadTouch) {
                for(var k=0;k<joypad.triggers.length;k++) {
                  var actionName = joypad.inputs[k];
                  Q.inputs[actionName] = false;
                    if(joypad.triggers[k]) {
                        Q.input.trigger(actionName + "Up");
                    }
                }
                joypad.joypadTouch = null;
                break;
              }
            }
          }
          e.preventDefault();
      };

      Q.el.addEventListener("touchstart",this.joypadStart);
      Q.el.addEventListener("touchmove",this.joypadMove);
      Q.el.addEventListener("touchend",this.joypadEnd);
      Q.el.addEventListener("touchcancel",this.joypadEnd);

      this.joypadEnabled = true;
    },

    /**
     * Activate mouse controls - mouse controls don't trigger events, but just set `Q.inputs['mouseX']` & `Q.inputs['mouseY']` on each frame.
     *
     * Default options:
     *
     *     {
     *       stageNum: 0,
     *       mouseX: "mouseX",
     *       mouseY: "mouseY",
     *       cursor: "off"
     *     }
     *
     * @method mouseControls
     * @for Q.InputSystem
     * @param {Object} [options] - override default options
     */
    mouseControls: function(options) {
      options = options || {};

      var stageNum = options.stageNum || 0;
      var mouseInputX = options.mouseX || "mouseX";
      var mouseInputY = options.mouseY || "mouseY";
      var cursor = options.cursor || "off";

      var mouseMoveObj = {};

      if(cursor !== "on") {
          if(cursor === "off") {
              Q.el.style.cursor = 'none';
          }
          else {
              Q.el.style.cursor = cursor;
          }
      }

      Q.inputs[mouseInputX] = 0;
      Q.inputs[mouseInputY] = 0;

      Q._mouseMove = function(e) {
        e.preventDefault();
        var touch = e.touches ? e.touches[0] : e;
        var el = Q.el, 
            posX = touch.offsetX,
            posY = touch.offsetY,
            eX, eY,
            stage = Q.stage(stageNum);

        if(Q._isUndefined(posX) || Q._isUndefined(posY)) {
          posX = touch.layerX;
          posY = touch.layerY;
        }

        if(Q._isUndefined(posX) || Q._isUndefined(posY)) {
          if(Q.input.offsetX === void 0) { Q.input._containerOffset(); }
          posX = touch.pageX - Q.input.offsetX;
          posY = touch.pageY - Q.input.offsetY;
        }

        if(stage) {
          mouseMoveObj.x= Q.canvasToStageX(posX,stage);
          mouseMoveObj.y= Q.canvasToStageY(posY,stage);

          Q.inputs[mouseInputX] = mouseMoveObj.x;
          Q.inputs[mouseInputY] = mouseMoveObj.y;

          Q.input.trigger('mouseMove',mouseMoveObj);
        }
      };

      Q.el.addEventListener('mousemove',Q._mouseMove,true);
      Q.el.addEventListener('touchstart',Q._mouseMove,true);
      Q.el.addEventListener('touchmove',Q._mouseMove,true);
    },

    /**
     * Turn off mouse controls
     *
     * @method disableMouseControls
     * @for Q.InputSystem
     */
    disableMouseControls: function() {
      if(Q._mouseMove) {
        Q.el.removeEventListener("mousemove",Q._mouseMove, true);
        Q.el.style.cursor = 'inherit';
        Q._mouseMove = null;
      }
    },

    /** 
     * Draw the touch buttons on the screen
     *
     * overload this to change how buttons are drawn
     *
     * @method drawButtons
     * @for Q.InputSystem
     */
    drawButtons: function() {
      var keypad = Q.input.keypad,
          ctx = Q.ctx;

      ctx.save();
      ctx.textAlign = "center"; 
      ctx.textBaseline = "middle";

      for(var i=0;i<keypad.controls.length;i++) {
        var control = keypad.controls[i];

        if(control[0]) {
          ctx.font = "bold " + (keypad.size/2) + "px arial";
          var x = keypad.left + i * keypad.unit + keypad.gutter,
              y = keypad.bottom - keypad.unit,
              key = Q.inputs[control[0]];

          ctx.fillStyle = keypad.color || "#FFFFFF";
          ctx.globalAlpha = key ? 1.0 : 0.5;
          ctx.fillRect(x,y,keypad.size,keypad.size);

          ctx.fillStyle = keypad.text || "#000000";
          ctx.fillText(control[1],
                       x+keypad.size/2,
                       y+keypad.size/2);
        }
      }

      ctx.restore();
    },

    drawCircle: function(x,y,color,size) {
      var ctx = Q.ctx,
          joypad = Q.joypad;

      ctx.save();
      ctx.beginPath();
      ctx.globalAlpha=joypad.alpha;
      ctx.fillStyle = color;
      ctx.arc(x, y, size, 0, Math.PI*2, true); 
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    },



    /** 
     * Draw the joypad on the screen
     *
     * overload this to change how joypad is drawn
     *
     * @method drawJoypad
     * @for Q.InputSystem
     */
    drawJoypad: function() {
      var joypad = Q.joypad;
      if(joypad.joypadTouch !== null) {
        Q.input.drawCircle(joypad.centerX,
                           joypad.centerY,
                           joypad.background,
                           joypad.size);

        if(joypad.x !== null) {
          Q.input.drawCircle(joypad.x,
                           joypad.y,
                           joypad.color,
                           joypad.center);
        }
      }

    },

    /** 
     * Called each frame by the stage game loop to render any onscreen UI
     *
     * calls `drawJoypad` and `drawButtons` if enabled
     *
     * @method drawCanvas
     * @for Q.InputSystem
     */
    drawCanvas: function() {
      if(this.touchEnabled) {
        this.drawButtons();
      }

      if(this.joypadEnabled) {
        this.drawJoypad();
      }
    }


  });
  
  /**
   * Instance of the input subsytem that is actually used during gameplay
   *
   * @property Q.input
   * @for Quintus.Input
   * @type Q.InputSystem
   */
  Q.input = new Q.InputSystem();

  /**
   * Helper method to activate controls with default options
   *
   * @for Quintus.Input
   * @method Q.controls
   * @param {Boolean} joypad - enable 4-way joypad (true) or just left, right controls (false, undefined)
   */
  Q.controls = function(joypad) {
    Q.input.keyboardControls();

    if(joypad) {
      Q.input.touchControls({
        controls: [ [],[],[],['action','b'],['fire','a']]
      });
      Q.input.joypadControls();
    } else {
      Q.input.touchControls();
    }

    return Q;
  };
  

  /**
   * Platformer Control Component
   *
   * Adds 2D platformer controls onto a Sprite
   *
   * Platformer controls bind to left, and right and allow the player to jump. 
   *
   * Adds the following properties to the entity to control speed and jumping:
   *
   *      { 
   *        speed: 200,
   *        jumpSpeed: -300
   *      }
   *
   *
   * @class platformerControls
   * @for Quintus.Input
   */
  Q.component("platformerControls", {
    defaults: {
      speed: 200,
      jumpSpeed: -300,
      collisions: []
    },

    added: function() {
      var p = this.entity.p;

      Q._defaults(p,this.defaults);

      this.entity.on("step",this,"step");
      this.entity.on("bump.bottom",this,"landed");

      p.landed = 0;
      p.direction ='right';
    },

    landed: function(col) {
      var p = this.entity.p;
      p.landed = 1/5;
    },

    step: function(dt) {
      var p = this.entity.p;
      
      if(p.ignoreControls === undefined || !p.ignoreControls) {
        var collision = null;
        
        // Follow along the current slope, if possible.
        if(p.collisions !== undefined && p.collisions.length > 0 && (Q.inputs['left'] || Q.inputs['right'] || p.landed > 0)) {
          if(p.collisions.length === 1) {
            collision = p.collisions[0];
          } else {
            // If there's more than one possible slope, follow slope with negative Y normal
            collision = null;

            for(var i = 0; i < p.collisions.length; i++) {
              if(p.collisions[i].normalY < 0) {
                collision = p.collisions[i];
              }
            }          
          }
          
          // Don't climb up walls.      
          if(collision !== null && collision.normalY > -0.3 && collision.normalY < 0.3) {        
            collision = null;
          }        
        }      

        if(Q.inputs['left']) {
          p.direction = 'left';
          if(collision && p.landed > 0) {
            p.vx = p.speed * collision.normalY;
            p.vy = -p.speed * collision.normalX;
          } else {
            p.vx = -p.speed;
          }        
        } else if(Q.inputs['right']) {
          p.direction = 'right';
          if(collision && p.landed > 0) {
            p.vx = -p.speed * collision.normalY;
            p.vy = p.speed * collision.normalX;          
          } else {
            p.vx = p.speed;
          }
        } else {
          p.vx = 0;
          if(collision && p.landed > 0) {
            p.vy = 0;
          }
        }
        
        if(p.landed > 0 && (Q.inputs['up'] || Q.inputs['action']) && !p.jumping) {
          p.vy = p.jumpSpeed;
          p.landed = -dt;
          p.jumping = true;
        } else if(Q.inputs['up'] || Q.inputs['action']) {
          this.entity.trigger('jump', this.entity);
          p.jumping = true;
        }
        
        if(p.jumping && !(Q.inputs['up'] || Q.inputs['action'])) {
          p.jumping = false;
          this.entity.trigger('jumped', this.entity);
          if(p.vy < p.jumpSpeed / 3) {
            p.vy = p.jumpSpeed / 3;
          }
        }
      }
      p.landed -= dt;
    }
  });


  /**
   * Step Controls component
   *
   * Adds Step (square grid based) 4-ways controls onto a Sprite
   *
   * Adds the following properties to the entity:
   *
   *      { 
   *        stepDistance: 32, // should be tile size
   *        stepDelay: 0.2  // seconds to delay before next step
   *      }
   *
   *
   * @class stepControls
   * @for Quintus.Input
   */
  Q.component("stepControls", {

    added: function() {
      var p = this.entity.p;

      if(!p.stepDistance) { p.stepDistance = 32; }
      if(!p.stepDelay) { p.stepDelay = 0.2; }

      p.stepWait = 0;
      this.entity.on("step",this,"step");
      this.entity.on("hit", this,"collision");
    },

    collision: function(col) {
      var p = this.entity.p;

      if(p.stepping) {
        p.stepping = false;
        p.x = p.origX;
        p.y = p.origY;
      }

    },

    step: function(dt) {
      var p = this.entity.p,
          moved = false;
      p.stepWait -= dt;

      if(p.stepping) {
        p.x += p.diffX * dt / p.stepDelay;
        p.y += p.diffY * dt / p.stepDelay;
      }

      if(p.stepWait > 0) { return; }
      if(p.stepping) {
        p.x = p.destX;
        p.y = p.destY;
      }
      p.stepping = false;

      p.diffX = 0;
      p.diffY = 0;

      if(Q.inputs['left']) {
        p.diffX = -p.stepDistance;
      } else if(Q.inputs['right']) {
        p.diffX = p.stepDistance;
      }

      if(Q.inputs['up']) {
        p.diffY = -p.stepDistance;
      } else if(Q.inputs['down']) {
        p.diffY = p.stepDistance;
      }

      if(p.diffY || p.diffX ) { 
        p.stepping = true;
        p.origX = p.x;
        p.origY = p.y;
        p.destX = p.x + p.diffX;
        p.destY = p.y + p.diffY;
        p.stepWait = p.stepDelay; 
      }

    }

  });
};


},{}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_scenes.js":[function(require,module,exports){
/*global Quintus:false */

/**
Quintus HTML5 Game Engine - Scenes Module

The code in `quintus_scenes.js` defines the `Quintus.Scenes` module, which
adds in support for Scenes and Stages into Quintus. 

Depends on the `Quintus.Sprite` module.

Scenes let you create reusable definitions for setting up levels and screens.

Stages are the primary container object in Quintus, handling Sprite management,
stepping, rendering and collision detection.

@module Quintus.Scenes
*/

/** 
 * Quintus Scenes Module Class
 *
 * @class Quintus.Scenes
 */
module.exports = function(Q) {

  Q.scenes = {};
  Q.stages = [];


  /** 
   Basic scene class, consisting primarily of a scene function 
   and some options that are passed to the stage.

   Should be instantiated by calling `Q.scene` not new

   @class Q.Scene
   @for Quintus.Scenes
  */
  Q.Class.extend('Scene',{
    init: function(sceneFunc,opts) {
      this.opts = opts || {};
      this.sceneFunc = sceneFunc;
    }
  });

  /**
   Set up a new scene or return an existing scene. If you don't pass in `sceneFunc`, 
   it'll return a scene otherwise it'll create a new one.

   @method Q.scene
   @for Quintus.Scenes
   @param {String} name - name of scene to create or return
   @param {Function} [sceneFunc] - scene function: `function(stage) { .. }` that sets up the stage
  */
  Q.scene = function(name,sceneFunc,opts) {
    if(sceneFunc === void 0) {
      return Q.scenes[name];
    } else {
      if(Q._isFunction(sceneFunc)) {
        sceneFunc = new Q.Scene(sceneFunc,opts);
        sceneFunc.name = name;
      }
      Q.scenes[name] = sceneFunc;
      return sceneFunc;
    }
  };

  Q._nullContainer = {
    c: {
      x: 0,
      y: 0,
      angle: 0,
      scale: 1
    },
    matrix: Q.matrix2d()
  };

 
  /**
   SAT collision detection between two objects
   Thanks to doc's at: http://www.sevenson.com.au/actionscript/sat/

   This is sort of a black box - use the methods on stage like `search` and `collide` to
   run the collision system.

   @property Q.collision
   @for Quintus.Scenes
  */
  Q.collision = (function() { 
    var normalX, normalY,
        offset = [ 0,0 ],
        result1 = { separate: [] },
        result2 = { separate: [] };

    function calculateNormal(points,idx) {
      var pt1 = points[idx],
          pt2 = points[idx+1] || points[0];

      normalX = -(pt2[1] - pt1[1]);
      normalY = pt2[0] - pt1[0];

      var dist = Math.sqrt(normalX*normalX + normalY*normalY);
      if(dist > 0) {
        normalX /= dist;
        normalY /= dist;
      }
    }

    function dotProductAgainstNormal(point) {
      return (normalX * point[0]) + (normalY * point[1]);

    }

    function collide(o1,o2,flip) {
      var min1,max1,
          min2,max2,
          d1, d2,
          offsetLength,
          tmp, i, j,
          minDist, minDistAbs,
          shortestDist = Number.POSITIVE_INFINITY,
          collided = false,
          p1, p2;

      var result = flip ? result2 : result1;

      offset[0] = 0; //o1.x + o1.cx - o2.x - o2.cx;
      offset[1] = 0; //o1.y + o1.cy - o2.y - o2.cy;

      // If we have a position matrix, just use those points,
      if(o1.c) {
        p1 = o1.c.points;
      } else {
        p1 = o1.p.points;
        offset[0] += o1.p.x;
        offset[1] += o1.p.y;
      }

      if(o2.c) {
        p2 = o2.c.points;
      } else {
        p2 = o2.p.points;
        offset[0] += -o2.p.x;
        offset[1] += -o2.p.y; 
      }

      o1 = o1.p;
      o2 = o2.p;


      for(i = 0;i<p1.length;i++) {
        calculateNormal(p1,i);

        min1 = dotProductAgainstNormal(p1[0]);
        max1 = min1;

        for(j = 1; j<p1.length;j++) {
          tmp = dotProductAgainstNormal(p1[j]);
          if(tmp < min1) { min1 = tmp; }
          if(tmp > max1) { max1 = tmp; }
        }

        min2 = dotProductAgainstNormal(p2[0]);
        max2 = min2;

        for(j = 1;j<p2.length;j++) {
          tmp = dotProductAgainstNormal(p2[j]);
          if(tmp < min2) { min2 = tmp; }
          if(tmp > max2) { max2 = tmp; }
        }

        offsetLength = dotProductAgainstNormal(offset);
        min1 += offsetLength;
        max1 += offsetLength;

        d1 = min1 - max2;
        d2 = min2 - max1;

        if(d1 > 0 || d2 > 0) { return null; }

        minDist = (max2 - min1) * -1;
        if(flip) { minDist *= -1; }

        minDistAbs = Math.abs(minDist);

        if(minDistAbs < shortestDist) {
          result.distance = minDist;
          result.magnitude = minDistAbs;
          result.normalX = normalX;
          result.normalY = normalY;

          if(result.distance > 0) {
            result.distance *= -1;
            result.normalX *= -1;
            result.normalY *= -1;
          }

          collided = true;
          shortestDist = minDistAbs;
        }
      }

      // Do return the actual collision
      return collided ? result : null;
    }

    function satCollision(o1,o2) {
      var result1, result2, result;

      if(!o1.p.points) { Q._generatePoints(o1); }
      if(!o2.p.points) { Q._generatePoints(o2); }

      result1 = collide(o1,o2);
      if(!result1) { return false; }

      result2 = collide(o2,o1,true);
      if(!result2) { return false; }

      result = (result2.magnitude < result1.magnitude) ? result2 : result1;

      if(result.magnitude === 0) { return false; }
      result.separate[0] = result.distance * result.normalX;
      result.separate[1] = result.distance * result.normalY;

      return result;
    }

    return satCollision;
  }());


  /**
   Check for the overlap of the boudning boxes of two Sprites

   @method Q.overlap
   @for Quintus.Scenes
   @param {Q.Sprite} o1
   @param {Q.Sprite} o2
   @returns {Boolean}
  */
  Q.overlap = function(o1,o2) {
    var c1 = o1.c || o1.p || o1;
    var c2 = o2.c || o2.p || o2;

    var o1x = c1.x - (c1.cx || 0),
        o1y = c1.y - (c1.cy || 0);
    var o2x = c2.x - (c2.cx || 0),
        o2y = c2.y - (c2.cy || 0);

    return !((o1y+c1.h<o2y) || (o1y>o2y+c2.h) ||
             (o1x+c1.w<o2x) || (o1x>o2x+c2.w));
  };

  /**
   Base stage class, responsible for managing sets of sprites.

   `Q.Stage`'s aren't generally instantiated directly, but rather are created
   automatically when you call `Q.stageScene('sceneName')`

   @class Q.Stage
   @extends Q.GameObject
   @for Quintus.Scenes
  */
  Q.Stage = Q.GameObject.extend({
    // Should know whether or not the stage is paused
    defaults: {
      sort: false,
      gridW: 400,
      gridH: 400,
      x: 0,
      y: 0
    },

    init: function(scene,opts) {
      this.scene = scene;
      this.items = [];
      this.lists = {};
      this.index = {};
      this.removeList = [];
      this.grid = {};
      this._collisionLayers = [];

      this.time = 0;

      this.defaults['w'] = Q.width;
      this.defaults['h'] = Q.height;

      this.options = Q._extend({},this.defaults);
      if(this.scene)  { 
        Q._extend(this.options,scene.opts);
      }
      if(opts) { Q._extend(this.options,opts); }


      if(this.options.sort && !Q._isFunction(this.options.sort)) {
          this.options.sort = function(a,b) { return ((a.p && a.p.z) || -1) - ((b.p && b.p.z) || -1); };
      }
    },

    destroyed: function() {
      this.invoke("debind");
      this.trigger("destroyed");
    },

    // Needs to be separated out so the current stage can be set
    loadScene: function() {
      if(this.scene)  { 
        this.scene.sceneFunc(this);
      }
    },

    /**
      Load an array of assets of the form:

          [ [ "Player", { x: 15, y: 54 } ],
            [ "Enemy",  { x: 54, y: 42 } ] ]

      Either pass in the array or a string of asset name

     @method loadAssets
     @param {Array or String} asset - Array of assets or a string of asset name
     @for Q.Stage
    */
    // Load an array of assets of the form:
    // [ [ "Player", { x: 15, y: 54 } ],
    //   [ "Enemy",  { x: 54, y: 42 } ] ]
    // Either pass in the array or a string of asset name
    loadAssets: function(asset) {
      var assetArray = Q._isArray(asset) ? asset : Q.asset(asset);
      for(var i=0;i<assetArray.length;i++) {
        var spriteClass = assetArray[i][0];
        var spriteProps = assetArray[i][1];
        this.insert(new Q[spriteClass](spriteProps));
      }
    },

    /**
     executes the callback for each item in the scene

     @method each
     @param {function} callback
     @for Q.Stage
    */
    each: function(callback) {
      for(var i=0,len=this.items.length;i<len;i++) {
        callback.call(this.items[i],arguments[1],arguments[2]);
      }
    },

    /**
     invokes a functioncall for each item in the scene

     @method invoke
     @param {function} funcName
     @for Q.Stage
    */
    invoke: function(funcName) {
      for(var i=0,len=this.items.length;i<len;i++) {              
        this.items[i][funcName].call(
          this.items[i],arguments[1],arguments[2]
        );
      }
    },

    /**

     @method detect
     @param {function} func
     @for Q.Stage
    */
    detect: function(func) {
      for(var i = this.items.length-1;i >= 0; i--) {
        if(func.call(this.items[i],arguments[1],arguments[2],arguments[3])) {
          return this.items[i];
        }
      }
      return false;
    },


    /**

     @method identify
     @param {function} func
     @for Q.Stage
    */
    identify: function(func) {
      var result;
      for(var i = this.items.length-1;i >= 0; i--) {
        if(result = func.call(this.items[i],arguments[1],arguments[2],arguments[3])) {
          return result;
        }
      }
      return false;
    },

    /**

     @method find
     @param {Number or String} id
     @for Q.Stage
    */
    find: function(id) {
      return this.index[id];
    },

    addToLists: function(lists,object) {
      for(var i=0;i<lists.length;i++) {
        this.addToList(lists[i],object);
      }
    },

    addToList: function(list, itm) {
      if(!this.lists[list]) { this.lists[list] = []; }
      this.lists[list].push(itm);
    },


    removeFromLists: function(lists, itm) {
      for(var i=0;i<lists.length;i++) {
        this.removeFromList(lists[i],itm);
      }
    },

    removeFromList: function(list, itm) {
      var listIndex = this.lists[list].indexOf(itm);
      if(listIndex !== -1) { 
        this.lists[list].splice(listIndex,1);
      }
    },

    /**
     Inserts an item directly into the scene, or inside a container.
     The object can later accessed via `children` property of the scene or the container.

     @method insert
     @for Q.Stage
     @param {Q.GameObject} itm - the Item to insert
     @param [container] - `container` to add the item to
     @return the inserted object for chaining
    */
    insert: function(itm,container) {
      this.items.push(itm);
      itm.stage = this;
      itm.container = container;
      if(container) {
        container.children.push(itm);
      }

      itm.grid = {};


      // Make sure we have a square of collision points
      Q._generatePoints(itm);
      Q._generateCollisionPoints(itm);

      
      if(itm.className) { this.addToList(itm.className, itm); }
      if(itm.activeComponents) { this.addToLists(itm.activeComponents, itm); }

      if(itm.p) {
        this.index[itm.p.id] = itm;
      }
      this.trigger('inserted',itm);
      itm.trigger('inserted',this);

      this.regrid(itm);
      return itm;
    },

    /**
     Removes an item from the scene.

     @method remove
     @param {Q.GameObject} itm - the Item to remove
     @for Q.Stage
    */
    remove: function(itm) {
      this.delGrid(itm);
      this.removeList.push(itm);
    },

    forceRemove: function(itm) {
      var idx =  this.items.indexOf(itm);
      if(idx !== -1) { 
        this.items.splice(idx,1);

        if(itm.className) { this.removeFromList(itm.className,itm); }
        if(itm.activeComponents) { this.removeFromLists(itm.activeComponents,itm); }
        if(itm.container) {
          var containerIdx = itm.container.children.indexOf(itm);
          if(containerIdx !== -1) {
            itm.container.children.splice(containerIdx,1);
          }
        }

        if(itm.destroy) { itm.destroy(); }
        if(itm.p.id) {
          delete this.index[itm.p.id];
        }
        this.trigger('removed',itm);
      }
    },

    /**
     Pauses the scene, sprites will no longer be stepped but still rendered.

     @method pause
     @for Q.Stage
    */
    pause: function() {
      this.paused = true;
    },

    /**
     Unpauses the scene.

     @method unpause
     @for Q.Stage
    */
    unpause: function() {
      this.paused = false;
    },

    _gridCellCheck: function(type,id,obj,collisionMask) {
      if(Q._isUndefined(collisionMask) || collisionMask & type) {
        var obj2 = this.index[id];
        if(obj2 && obj2 !== obj && Q.overlap(obj,obj2)) {
          var col= Q.collision(obj,obj2);
          if(col) {
            col.obj = obj2;
            return col;
          } else {
            return false;
          }
        }
      }
    },

    gridTest: function(obj,collisionMask) {
      var grid = obj.grid, gridCell, col;

      for(var y = grid.Y1;y <= grid.Y2;y++) {
        if(this.grid[y]) {
          for(var x = grid.X1;x <= grid.X2;x++) {
            gridCell = this.grid[y][x];
            if(gridCell) { 
              col = Q._detect(gridCell,this._gridCellCheck,this,obj,collisionMask);
              if(col) { return col; }
            }
          }
        }
      }
      return false;
    },

    collisionLayer: function(layer) {
      this._collisionLayers.push(layer);
      layer.collisionLayer = true;
      return this.insert(layer);
    },
    
    _collideCollisionLayer: function(obj,collisionMask) {
      var col;

      for(var i = 0,max = this._collisionLayers.length;i < max;i++) {
        var layer = this._collisionLayers[i];
        if(layer.p.type & collisionMask) {
          col = layer.collide(obj);
          if(col) { col.obj = layer;  return col; }
        }
      }
      return false;
    },

    /**
     Searches the scene for an object.

     @method search
     @param obj
     @param [collisionMask] -
     @for Q.Stage
    */
    search: function(obj,collisionMask) {
      var col;

      // If the object doesn't have a grid, regrid it
      // so we know where to search
      // and skip adding it to the grid only if it's not on this stage
      if(!obj.grid) { this.regrid(obj,obj.stage !== this); }

      collisionMask = Q._isUndefined(collisionMask) ? (obj.p && obj.p.collisionMask) : collisionMask;

      col = this._collideCollisionLayer(obj,collisionMask);
      col =  col || this.gridTest(obj,collisionMask);
      return col;
    },

    _locateObj: {
      p: { 
        x: 0,
        y: 0,
        cx: 0,
        cy: 0,
        w: 1,
        h: 1
      }, grid: {}
    },

    /**
     Finds any object that collides with the point x,y on the stage (not on the canvas).
     If `collisionMask` is used, only checks for collisions with sprites of that type.

     @method locate
     @param {number} x
     @param {number} y
     @param [collisionMask] - type of the sprite
     @return the object if one is found or false
     @for Q.Stage
    */
    locate: function(x,y,collisionMask) {
      var col = null;

      this._locateObj.p.x = x;
      this._locateObj.p.y = y;

      this.regrid(this._locateObj,true);

      col = this._collideCollisionLayer(this._locateObj,collisionMask);
      col =  col || this.gridTest(this._locateObj,collisionMask);

      if(col && col.obj) {
        return col.obj;
      } else {
        return false;
      }

    },

    /**
     calculates if the given object collides with anything in the scene

     @method collide
     @param {Object} obj - the object on that the collisions should be checked
     @param {Object} [options] - collisionsMask, maxCol, skipEvents to overwrite from obj
     @return col2 || col
     @for Q.Stage
    */
    collide: function(obj,options) {
      var col, col2, collisionMask, 
          maxCol, curCol, skipEvents;
      if(Q._isObject(options)) {
        collisionMask = options.collisionMask;
        maxCol = options.maxCol;
        skipEvents = options.skipEvents;
      } else {
        collisionMask = options;
      }
      collisionMask = Q._isUndefined(collisionMask) ? (obj.p && obj.p.collisionMask) : collisionMask;
      maxCol = maxCol || 3;


      Q._generateCollisionPoints(obj);
      this.regrid(obj);

      curCol = maxCol;
      while(curCol > 0 && (col = this._collideCollisionLayer(obj,collisionMask))) {
        if(!skipEvents) { 
          obj.trigger('hit',col);
          obj.trigger('hit.collision',col);
        }
        Q._generateCollisionPoints(obj);
        this.regrid(obj);
        curCol--;
      }

      curCol = maxCol;
      while(curCol > 0 && (col2 = this.gridTest(obj,collisionMask))) {
        obj.trigger('hit',col2);
        obj.trigger('hit.sprite',col2);

        // Do the recipricol collision
        // TODO: extract
        if(!skipEvents) { 
          var obj2 = col2.obj;
          col2.obj = obj;
          col2.normalX *= -1;
          col2.normalY *= -1;
          col2.distance = 0;
          col2.magnitude = 0;
          col2.separate[0] = 0;
          col2.separate[1] = 0;

          
          obj2.trigger('hit',col2);
          obj2.trigger('hit.sprite',col2);
        }

        Q._generateCollisionPoints(obj);
        this.regrid(obj);
        curCol--;
      }

      return col2 || col;
    },

    delGrid: function(item) {
      var grid = item.grid;

      for(var y = grid.Y1;y <= grid.Y2;y++) {
        if(this.grid[y]) {
          for(var x = grid.X1;x <= grid.X2;x++) {
            if(this.grid[y][x]) {
            delete this.grid[y][x][item.p.id];
            }
          }
        }
      }
    },

    addGrid: function(item) {
      var grid = item.grid;

      for(var y = grid.Y1;y <= grid.Y2;y++) {
        if(!this.grid[y]) { this.grid[y] = {}; }
        for(var x = grid.X1;x <= grid.X2;x++) {
          if(!this.grid[y][x]) { this.grid[y][x] = {}; }
          this.grid[y][x][item.p.id] = item.p.type;
        }
      }

    },

    // Add an item into the collision detection grid,
    // Ignore collision layers
    regrid: function(item,skipAdd) {
      if(item.collisionLayer) { return; }
      item.grid = item.grid || {};

      var c = item.c || item.p;

      var gridX1 = Math.floor((c.x - c.cx) / this.options.gridW),
          gridY1 = Math.floor((c.y - c.cy) / this.options.gridH),
          gridX2 = Math.floor((c.x - c.cx + c.w) / this.options.gridW),
          gridY2 = Math.floor((c.y - c.cy + c.h) / this.options.gridH),
          grid = item.grid;

      if(grid.X1 !== gridX1 || grid.X2 !== gridX2 || 
         grid.Y1 !== gridY1 || grid.Y2 !== gridY2) {

         if(grid.X1 !== void 0) { this.delGrid(item); }
         grid.X1 = gridX1;
         grid.X2 = gridX2;
         grid.Y1 = gridY1;
         grid.Y2 = gridY2;

         if(!skipAdd) { this.addGrid(item); }
      }
    },
    
    markSprites: function(items,time) {
      var viewport = this.viewport,
          scale = viewport ? viewport.scale : 1,
          x = viewport ? viewport.x : 0,
          y = viewport ? viewport.y : 0,
          viewW = Q.width / scale,
          viewH = Q.height / scale,
          gridX1 = Math.floor(x / this.options.gridW),
          gridY1 = Math.floor(y / this.options.gridH),
          gridX2 = Math.floor((x + viewW) / this.options.gridW),
          gridY2 = Math.floor((y + viewH) / this.options.gridH),
          gridRow, gridBlock;

      for(var iy=gridY1; iy<=gridY2; iy++) {
        if((gridRow = this.grid[iy])) { 
          for(var ix=gridX1; ix<=gridX2; ix++) {
            if((gridBlock = gridRow[ix])) {
              for(var id in gridBlock) {
                if(this.index[id]) {
                  this.index[id].mark = time;
                  if(this.index[id].container) { this.index[id].container.mark = time; }
                }
              }
            }
          }
        }
      }
    },

    updateSprites: function(items,dt,isContainer) {
      var item;

      for(var i=0,len=items.length;i<len;i++) {              
        item = items[i];
        // If set to visible only, don't step if set to visibleOnly
        if(!isContainer && (item.p.visibleOnly && (!item.mark || item.mark < this.time))) { continue; }

        if(isContainer || !item.container) { 
          item.update(dt);
          Q._generateCollisionPoints(item);
          this.regrid(item);
        }
      }
    },



    step:function(dt) {
      if(this.paused) { return false; }

      this.time += dt;
      this.markSprites(this.items,this.time);

      this.trigger("prestep",dt);
      this.updateSprites(this.items,dt);
      this.trigger("step",dt);

      if(this.removeList.length > 0) {
        for(var i=0,len=this.removeList.length;i<len;i++) {
          this.forceRemove(this.removeList[i]);
        }
        this.removeList.length = 0;
      }

      this.trigger('poststep',dt);
    },

    /**
     Hides the scene.

     @method hide
     @for Q.Stage
    */
    hide: function() {
      this.hidden = true;
    },

    /**
     Unhides the scene.

     @method show
     @for Q.Stage
    */
    show: function() {
      this.hidden = false;
    },

    /**
     Stops the scene (hides and pauses).

     @method stop
     @for Q.Stage
    */
    stop: function() {
      this.hide();
      this.pause();
    },

    /**
     Starts the scene (shows and unpauses).

     @method start
     @for Q.Stage
    */
    start: function() {
      this.show();
      this.unpause();
    },

    render: function(ctx) {
      if(this.hidden) { return false; }
      if(this.options.sort) {
        this.items.sort(this.options.sort);
      }
      this.trigger("prerender",ctx);
      this.trigger("beforerender",ctx);

      for(var i=0,len=this.items.length;i<len;i++) {              
        var item = this.items[i];
        // Don't render sprites with containers (sprites do that themselves)
        // Also don't render if not onscreen
        if(!item.container && (item.p.renderAlways || item.mark >= this.time)) {
          item.render(ctx);
        }
      }
      this.trigger("render",ctx);
      this.trigger("postrender",ctx);
    }
  });

  Q.activeStage = 0;

  Q.StageSelector = Q.Class.extend({
    emptyList: [],

    init: function(stage,selector) {
      this.stage = stage;
      this.selector = selector;

      // Generate an object list from the selector
      // TODO: handle array selectors
      this.items = this.stage.lists[this.selector] || this.emptyList;
      this.length = this.items.length;
    },

    each: function(callback) {
      for(var i=0,len=this.items.length;i<len;i++) {
        callback.call(this.items[i],arguments[1],arguments[2]);
      }
      return this;
    },

    invoke: function(funcName) {
      for(var i=0,len=this.items.length;i<len;i++) {              
        this.items[i][funcName].call(
          this.items[i],arguments[1],arguments[2]
        );
      }
      return this;
    },

    trigger: function(name,params) {
      this.invoke("trigger",name,params);
    },

    destroy: function() {
      this.invoke("destroy");
    },

    detect: function(func) {
      for(var i = 0,val=null, len=this.items.length; i < len; i++) {
        if(func.call(this.items[i],arguments[1],arguments[2])) {
          return this.items[i];
        }
      }
      return false;
    },

    identify: function(func) {
      var result = null;
      for(var i = 0,val=null, len=this.items.length; i < len; i++) {
        if(result = func.call(this.items[i],arguments[1],arguments[2])) {
          return result;
        }
      }
      return false;

    },

    // This hidden utility method extends
    // and object's properties with a source object.
    // Used by the p method to set properties.
    _pObject: function(source) {
      Q._extend(this.p,source);
    },

    _pSingle: function(property,value) {
      this.p[property] = value;
    },

    set: function(property, value) {
      // Is value undefined
      if(value === void 0) {
        this.each(this._pObject,property);
      } else {
        this.each(this._pSingle,property,value);
      }

      return this;
    },

    at: function(idx) {
      return this.items[idx];
    },

    first: function() {
      return this.items[0];
    },

    last: function() {
      return this.items[this.items.length-1];
    }

  });

  // Maybe add support for different types
  // entity - active collision detection
  //  particle - no collision detection, no adding components to lists / etc
  //

  // Q("Player").invoke("shimmer); - needs to return a selector
  // Q(".happy").invoke("sasdfa",'fdsafas',"fasdfas");
  // Q("Enemy").p({ a: "asdfasf"  });

  Q.select = function(selector,scope) {
    scope = (scope === void 0) ? Q.activeStage : scope;
    scope = Q.stage(scope);
    if(Q._isNumber(selector)) {
      return scope.index[selector];
    } else {
      return new Q.StageSelector(scope,selector);
      // check if is array
      // check is has any commas
         // split into arrays
      // find each of the classes
      // find all the instances of a specific class
    }
  };

  /**
   Returns the default or currently active stage.
   If called from a sprites step() returns the stage that the sprite is member of
   If a number is passed in, this stages is returned
   *Warning* might return `undefined` if that stage doesnt exist!

   @method Q.stage
   @for Q
   @param {Number} num - number of the stage
   @return {Q.Stage} current, active, or numbered stage
  */
  Q.stage = function(num) {
    // Use activeStage is num is undefined
    num = (num === void 0) ? Q.activeStage : num;
    return Q.stages[num];
  };

  /**
   Stages a scene. `num` is like a z-index. Higher numbered stages render on top
   of lower numbered stages!

   @method Q.stageScene
   @param {Q.Scene or String} scene - a Q.Scene or the string for name of a scene
   @param {number} [num] - index
   @param {Object} options - some options
   @for Quintus
   */
  Q.stageScene = function(scene,num,options) {
    // If it's a string, find a registered scene by that name
    if(Q._isString(scene)) {
      scene = Q.scene(scene);
    }

    // If the user skipped the num arg and went straight to options,
    // swap the two and grab a default for num
    if(Q._isObject(num)) {
      options = num;
      num = Q._popProperty(options,"stage") || (scene && scene.opts.stage) || 0;
    }

    // Clone the options arg to prevent modification
    options = Q._clone(options);

    // Grab the stage class, pulling from options, the scene default, or use
    // the default stage
    var StageClass = (Q._popProperty(options,"stageClass")) || 
                     (scene && scene.opts.stageClass) || Q.Stage;

    // Figure out which stage to use
    num = Q._isUndefined(num) ? ((scene && scene.opts.stage) || 0) : num;

    // Clean up an existing stage if necessary
    if(Q.stages[num]) {
      Q.stages[num].destroy();
    }

    // Make this this the active stage and initialize the stage,
    // calling loadScene to popuplate the stage if we have a scene.
    Q.activeStage = num;
    var stage = Q.stages[num] = new StageClass(scene,options);

    // Load an assets object array
    if(stage.options.asset) {
      stage.loadAssets(stage.options.asset);
    }

    if(scene) {
      stage.loadScene();
    }
    Q.activeStage = 0;

    // If there's no loop active, run the default stageGameLoop
    if(!Q.loop) {
      Q.gameLoop(Q.stageGameLoop);
    }

    // Finally return the stage to the user for use if needed
    return stage;
  };

  Q.stageGameLoop = function(dt) {
    var i,len,stage;


    if(dt < 0) { dt = 1.0/60; }
    if(dt > 1/15) { dt  = 1.0/15; }

    for(i =0,len=Q.stages.length;i<len;i++) {
      Q.activeStage = i;
      stage = Q.stage();
      if(stage) {
        stage.step(dt);
      }
    }

    if(Q.ctx) { Q.clear(); }

    for(i =0,len=Q.stages.length;i<len;i++) {
      Q.activeStage = i;
      stage = Q.stage();
      if(stage) {
        stage.render(Q.ctx);
      }
    }

    Q.activeStage = 0;

    if(Q.input && Q.ctx) { Q.input.drawCanvas(Q.ctx); }
  };

  /**
   Destroys the stage with index `num`.

   @method clearStage
   @param {Number} num
   @for Q
  */
  Q.clearStage = function(num) {
    if(Q.stages[num]) { 
      Q.stages[num].destroy(); 
      Q.stages[num] = null;
    }
  };

  /**
   Destroys all stages.

   @method clearStages
   @for Q
  */
  Q.clearStages = function() {
    for(var i=0,len=Q.stages.length;i<len;i++) {
      if(Q.stages[i]) { Q.stages[i].destroy(); }
    }
    Q.stages.length = 0;
  };


};


},{}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_sprites.js":[function(require,module,exports){
/*global Quintus:false */
/**
Quintus HTML5 Game Engine - Sprites Module

The code in `quintus_sprites.js` defines the `Quintus.Sprites` module, which
add support for sprite sheets and the base sprite class.

Most games will include at a minimum `Quintus.Sprites` and `Quintus.Scenes`

@module Quintus.Sprites
*/


/**
 * Quintus Sprites Module Class
 *
 * @class Quintus.Sprites
 */
module.exports = function(Q) {
 
  /**

  Sprite sheet class - generally instantiated with `Q.sheet` new `new`


  @class Q.SpriteSheet
  @extends Q.Class
  @for Quintus.Sprites
  */
  Q.Class.extend("SpriteSheet",{

    /**
    constructor

    Options:

      * tileW - tile width
      * tileH - tile height
      * w     - width of the sprite block
      * h     - height of the sprite block
      * sx    - start x
      * sy    - start y
      * spacingX - spacing between each tile x (after 1st)
      * spacingY - spacing between each tile y
      * marginX - margin around each tile x 
      * marginY - margin around each tile y
      * cols  - number of columns per row
    
    @constructor
    @for Q.SpriteSheet
    @method init
    @param {String} name
    @param {String} asset 
    @param {Object} options
    */
    init: function(name, asset,options) {
      if(!Q.asset(asset)) { throw "Invalid Asset:" + asset; }
      Q._extend(this,{
        name: name,
        asset: asset,
        w: Q.asset(asset).width,
        h: Q.asset(asset).height,
        tileW: 64,
        tileH: 64,
        sx: 0,
        sy: 0,
        spacingX: 0,
        spacingY: 0,
        frameProperties: {}
        });
      if(options) { Q._extend(this,options); }
      // fix for old tilew instead of tileW
      if(this.tilew) { 
        this.tileW = this.tilew; 
        delete this['tilew']; 
      }
      if(this.tileh) { 
        this.tileH = this.tileh; 
        delete this['tileh']; 
      }

      this.cols = this.cols || 
                  Math.floor(this.w / (this.tileW + this.spacingX));

      this.frames = this.cols * (Math.floor(this.h/(this.tileH + this.spacingY)));
    },

    /**
     Returns the starting x position of a single frame

     @method fx
     @for Q.SpriteSheet
     @param {Integer} frame
    */
    fx: function(frame) {
      return Math.floor((frame % this.cols) * (this.tileW + this.spacingX) + this.sx);
    },

    /**
     Returns the starting y position of a single frame

     @method fy
     @for Q.SpriteSheet
     @param {Integer} frame
    */
    fy: function(frame) {
      return Math.floor(Math.floor(frame / this.cols) * (this.tileH + this.spacingY) + this.sy);
    },

    /** 
     Draw a single frame at x,y on the provided context

     @method draw
     @for Q.SpriteSheet
     @param {Context2D} ctx
     @param {Float} x
     @param {Float} y
     @param {Integer} frame
    */
    draw: function(ctx, x, y, frame) {
      if(!ctx) { ctx = Q.ctx; }
      ctx.drawImage(Q.asset(this.asset),
                    this.fx(frame),this.fy(frame),
                    this.tileW, this.tileH,
                    Math.floor(x),Math.floor(y),
                    this.tileW, this.tileH);

    }

  });


  Q.sheets = {};

  /**
   Return a `Q.SpriteSheet` or  create a new sprite sheet

   @method Q.sheet
   @for Quintus.Sprites
   @param {String} name - name of sheet to return or create
   @param {String} [asset] - if provided, will create a sprite sheet using this asset
   @param {Object} [options] - if provided, will be passed as options to `Q.SpriteSheet`
  */
  Q.sheet = function(name,asset,options) {
    if(asset) {
      Q.sheets[name] = new Q.SpriteSheet(name,asset,options);
    } else {
      return Q.sheets[name];
    }
  };

  /**
   Create a number of `Q.SpriteSheet` objects from an image asset and a sprite data JSON asset

   @method Q.compileSheets
   @for Quintus.Sprites
   @param {String} imageAsset 
   @param {String spriteDataAsset
  */
  Q.compileSheets = function(imageAsset,spriteDataAsset) {
    var data = Q.asset(spriteDataAsset);
    Q._each(data,function(spriteData,name) {
      Q.sheet(name,imageAsset,spriteData);
    });
  };


  /**
   Bitmask 0 to indicate no sprites

   @property Q.SPRITE_NONE
   @for Quintus.Sprites
   @final
  */
  Q.SPRITE_NONE     = 0;

  /**
   default sprite type 1

   @property Q.SPRITE_DEFAULT
   @for Quintus.Sprites
   @final
  */
  Q.SPRITE_DEFAULT  = 1;

  /**
   particle sprite type 2

   @property Q.SPRITE_PARTICLE
   @for Quintus.Sprites
   @final
  */
  Q.SPRITE_PARTICLE = 2;

  /**
   active sprite type 4

   @property Q.SPRITE_ACTIVE
   @for Quintus.Sprites
   @final
  */
  Q.SPRITE_ACTIVE   = 4;

  /**
   friendly sprite type 8

   @property Q.SPRITE_FRIENDLY
   @for Quintus.Sprites
   @final
  */
  Q.SPRITE_FRIENDLY = 8;

  /**
   enemy sprite type 16

   @property Q.SPRITE_ENEMY
   @for Quintus.Sprites
   @final
  */
  Q.SPRITE_ENEMY    = 16;


  /**
   powerup sprite type 32

   @property Q.SPRITE_POWERUP
   @for Quintus.Sprites
   @final
  */
  Q.SPRITE_POWERUP  = 32;


  /**
   UI sprite type 64

   @property Q.SPRITE_UI
   @for Quintus.Sprites
   @final
  */
  Q.SPRITE_UI       = 64;

  /** 
   all sprite type - 0xFFFF

   @property Q.SPRITE_ALL
   @for Quintus.Sprites
   @final
  */
  Q.SPRITE_ALL   = 0xFFFF;


  /**
   generate a square set of  `p.points` on an object from `p.w` and `p.h`

   `p.points` represent the collision points for an object in object coordinates.


    @method q._generatePoints
    @for Quintus.Sprites
    @param {Q.Sprite} obj - object to add points to
    @param {Boolean} force - if set to true, will regenerate `p.points` even if it already exists, otherwise  if p.points exist it'll be left alone
  */
  Q._generatePoints = function(obj,force) {
    if(obj.p.points && !force) { return; }
    var p = obj.p,
        halfW = p.w/2,
        halfH = p.h/2;

    p.points = [ 
      [ -halfW, -halfH ],
      [  halfW, -halfH ],
      [  halfW,  halfH ],
      [ -halfW,  halfH ]
      ];
  };


  /**
   Generate a square set of  `c.points` on an object from the object transform matrix and `p.points`

   `c.points` represents the collision points of an sprite in world coordinates, scaled, rotate and taking into account any parent transforms.


    @method Q._generateCollisionPoints
    @for Quintus.Sprites
    @param {q.sprite} obj - object to add collision points to
  */
 Q._generateCollisionPoints = function(obj) {
    if(!obj.matrix && !obj.refreshMatrix) { return; }
    if(!obj.c) { obj.c = { points: [] }; }
    var p = obj.p, c = obj.c;

    if(!p.moved && 
       c.origX === p.x &&
       c.origY === p.y &&
       c.origScale === p.scale &&
       c.origAngle === p.angle) { 
        return;
    }

    c.origX = p.x;
    c.origY = p.y;
    c.origScale = p.scale;
    c.origAngle = p.angle;

    obj.refreshMatrix();

    var i;

    // Early out if we don't need to rotate / scale / deal with a container
    if(!obj.container && (!p.scale || p.scale === 1) && p.angle === 0) {
      for(i=0;i<obj.p.points.length;i++) {
        obj.c.points[i] = obj.c.points[i] || [];
        obj.c.points[i][0] = p.x + obj.p.points[i][0];
        obj.c.points[i][1] = p.y + obj.p.points[i][1];
      }
      c.x = p.x; c.y = p.y;
      c.cx = p.cx; c.cy = p.cy;
      c.w = p.w; c.h = p.h;
      return;
    }
    var container = obj.container || Q._nullContainer;

    c.x = container.matrix.transformX(p.x,p.y);
    c.y = container.matrix.transformY(p.x,p.y);
    c.angle = p.angle + container.c.angle;
    c.scale = (container.c.scale || 1) * (p.scale || 1);

    var minX = Infinity,
        minY = Infinity,
        maxX = -Infinity,
        maxY = -Infinity;

    for(i=0;i<obj.p.points.length;i++) {
      if(!obj.c.points[i]) {
        obj.c.points[i] = [];
      }
      obj.matrix.transformArr(obj.p.points[i],obj.c.points[i]);
      var x = obj.c.points[i][0],
          y = obj.c.points[i][1];

          if(x < minX) { minX = x; }
          if(x > maxX) { maxX = x; }
          if(y < minY) { minY = y; }
          if(y > maxY) { maxY = y; }
    }

    if(minX === maxX) { maxX+=1; }
    if(minY === maxY) { maxY+=1; }

    c.cx = c.x - minX;
    c.cy = c.y - minY;

    c.w = maxX - minX;
    c.h = maxY - minY;

    // TODO: Invoke moved on children
  };
  
  
  /**
   
   Basic sprite class - will render either and asset or a frame from a sprite sheet.

   Auto sets the width and height (`p.w` and `p.h`) from the provided image asset and
   centers the sprite so 0,0 is the center of the provide image.

   Most of the times you'll sub-class `Q.Sprite` 

   @extends Q.GameObject
   @class Q.Sprite
   @for Quintus.Sprites
  */
  Q.GameObject.extend("Sprite",{

    /**
     
      Default sprite constructor, takes in a set of properties and a set of default properties (useful when you create a subclass of sprite)
     
      Default properties:

           {
            asset: null,  // asset to use
            sheet: null,  // sprite sheet to use (overrides asset)
            x: 0,
            y: 0,
            z: 0,
            w: 0,         // width, set from p.asset or p.sheet
            h: 0,         // height, set from p.asset or p.sheet
            cx: w/2,      // center x, defaults to center of the asset or sheet
            cy: h/2,      // center y, default same as cx
            // points defines the collision shape, override to customer the collision shape,
            // must be a convex polygon in clockwise order
            points: [  [ -w/2, -h/2 ], [  w/2, -h/2 ], [  w/2,  h/2 ], [ -w/2,  h/2 ] ],
            opacity: 1,
            angle: 0,
            frame: 0
            type:  Q.SPRITE_DEFAULT | Q.SPRITE_ACTIVE,
            name: '',
            sort: false,   // set to true to force children to be sorted by theier p.z,
            hidden: false,  // set to true to hide the sprite
            flip: ""       // set to "x", "y", or "xy" to flip sprite over that dimension
           }

      @method init
      @for Q.Sprite
      @param {Object} props - property has that will be turned into `p`
      @param {Object} [defaultProps] - default properties that are assigned only if there's not a corresponding value in `props`
    */
    init: function(props,defaultProps) {
      this.p = Q._extend({ 
        x: 0,
        y: 0,
        z: 0,
        opacity: 1,
        angle: 0,
        frame: 0,
        type: Q.SPRITE_DEFAULT | Q.SPRITE_ACTIVE,
        name: '',
        spriteProperties: {}
      },defaultProps);

      this.matrix = new Q.Matrix2D();
      this.children = [];

      Q._extend(this.p,props); 

      this.size();
      this.p.id = this.p.id || Q._uniqueId();

      this.refreshMatrix();
    },

    /**
    Resets the width, height and center based on the
     asset or sprite sheet

    @method size
    @for Q.Sprite
    @param {Boolean} force - force a reset (call if w or h changes)
    */
    size: function(force) {
      if(force || (!this.p.w || !this.p.h)) { 
        if(this.asset()) {
          this.p.w = this.asset().width;
          this.p.h = this.asset().height;
        } else if(this.sheet()) {
          this.p.w = this.sheet().tileW;
          this.p.h = this.sheet().tileH;
        }
      } 

      this.p.cx = (force || this.p.cx === void 0) ? (this.p.w / 2) : this.p.cx;
      this.p.cy = (force || this.p.cy === void 0) ? (this.p.h / 2) : this.p.cy;
    },

    /**
    Get or set the asset associate with this sprite

    @method asset
    @for Q.Sprite
    @param {String} [name] - leave empty to return the asset, add to set the asset
    @param {Boolean} [resize] - force a call to `size()` and `_generatePoints`
    */
    asset: function(name,resize) {
      if(!name) { return Q.asset(this.p.asset); }

      this.p.asset = name;
      if(resize) {
        this.size(true);
        Q._generatePoints(this,true);
      }
    },

    /**

     Get or set the sheet associate with this sprite

     @method sheet
     @for Q.Sprite
     @param {String} [name] - leave empty to return the sprite sheet, add to resize
     @param {Boolean} [resize] - force a resize
    */
    sheet: function(name,resize) {
      if(!name) { return Q.sheet(this.p.sheet); }

      this.p.sheet = name;
      if(resize) { 
        this.size(true);
        Q._generatePoints(this,true);
      }
    },

    /**
     Hide the sprite (render returns without rendering)

     @method hide
     @for Q.Sprite
    */
    hide: function() {
      this.p.hidden = true;
    },

    /**
     Show the sprite 

     @method show
     @for Q.Sprite
    */
    show: function() {
      this.p.hidden = false;
    },

    /**
     Set a set of `p` properties on a Sprite

     @method set
     @for Q.Sprite
     @param {Object} properties - hash of properties to set
    */
    set: function(properties) {
      Q._extend(this.p,properties);
      return this;
    },

    _sortChild: function(a,b) {
      return ((a.p && a.p.z) || -1) - ((b.p && b.p.z) || -1);
    },

    _flipArgs: {
      "x":  [ -1,  1],
      "y":  [  1, -1],
      "xy": [ -1, -1]
    },

    /** 
     Default render method for the sprite. Don't overload this unless you want to
     handle all the transform and scale stuff yourself. Rather overload the `draw` method.

     @method render
     @for Q.Sprite
     @param {Context2D} ctx - context to render to
    */
    render: function(ctx) {
      var p = this.p;

      if(p.hidden) { return; }
      if(!ctx) { ctx = Q.ctx; }

      this.trigger('predraw',ctx);

      ctx.save();

        if(this.p.opacity !== void 0 && this.p.opacity !== 1) {
          ctx.globalAlpha = this.p.opacity;
        }

        this.matrix.setContextTransform(ctx);

        if(this.p.flip) { ctx.scale.apply(ctx,this._flipArgs[this.p.flip]); }

        this.trigger('beforedraw',ctx);
        this.draw(ctx);
        this.trigger('draw',ctx);

      ctx.restore();
      
      // Children set up their own complete matrix
      // from the base stage matrix
      if(this.p.sort) { this.children.sort(this._sortChild); }
      Q._invoke(this.children,"render",ctx);
      
      this.trigger('postdraw',ctx);

      if(Q.debug) { this.debugRender(ctx); }

    },

    /**
     Center sprite inside of it's container (or the stage)

     @method center
     @for Q.Sprite
    */
    center: function() {
      if(this.container) {
        this.p.x = this.container.p.w / 2;
        this.p.y = this.container.p.h / 2;
      } else {
        this.p.x = Q.width / 2;
        this.p.y = Q.height / 2;
      }

    },

    /**
     Draw the asset on the stage. the context passed in is alreay transformed.

     All you need to do is a draw the sprite centered at 0,0

     @method draw
     @for Q.Sprite
     @param {Context2D} ctx
    */
    draw: function(ctx) {
      var p = this.p;
      if(p.sheet) {
        this.sheet().draw(ctx,-p.cx,-p.cy,p.frame);
      } else if(p.asset) {
        ctx.drawImage(Q.asset(p.asset),-p.cx,-p.cy);
      } else if(p.color) {
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.cx,-p.cy,p.w,p.h);
      }
    },

    debugRender: function(ctx) {
      if(!this.p.points) {
        Q._generatePoints(this);
      }
      ctx.save();
      this.matrix.setContextTransform(ctx);
      ctx.beginPath();
      ctx.fillStyle = this.p.hit ? "blue" : "red";
      ctx.strokeStyle = "#FF0000";
      ctx.fillStyle = "rgba(0,0,0,0.5)";

      ctx.moveTo(this.p.points[0][0],this.p.points[0][1]);
      for(var i=0;i<this.p.points.length;i++) {
        ctx.lineTo(this.p.points[i][0],this.p.points[i][1]);
      }
      ctx.lineTo(this.p.points[0][0],this.p.points[0][1]);
      ctx.stroke();
      if(Q.debugFill) { ctx.fill(); }

      ctx.restore();

      if(this.c) { 
        var c = this.c;
        ctx.save();
          ctx.globalAlpha = 1;
          ctx.lineWidth = 2;
          ctx.strokeStyle = "#FF00FF";
          ctx.beginPath();
          ctx.moveTo(c.x - c.cx,       c.y - c.cy);
          ctx.lineTo(c.x - c.cx + c.w, c.y - c.cy);
          ctx.lineTo(c.x - c.cx + c.w, c.y - c.cy + c.h);
          ctx.lineTo(c.x - c.cx      , c.y - c.cy + c.h);
          ctx.lineTo(c.x - c.cx,       c.y - c.cy);
          ctx.stroke();
        ctx.restore();
      }
    },

    /** 
     Update method is called each step with the time elapsed since the last step.

     Doesn't do anything other than trigger events, call a `step` method if defined
     and run update on all its children.

     Generally leave this method alone and define a `step` method that will be called

     @method update
     @for Q.Sprite
     @param {Float} dt - time elapsed since last call
    */
    update: function(dt) {
      this.trigger('prestep',dt);
      if(this.step) { this.step(dt); }
      this.trigger('step',dt);
      this.refreshMatrix();

      // Ugly coupling to stage - workaround?
      if(this.stage && this.children.length > 0) {
        this.stage.updateSprites(this.children,dt,true);
      }
      
      // Reset collisions if we're tracking them
      if(this.p.collisions) { this.p.collisions = []; }
    },

    /* 
     Regenerates this sprite's transformation matrix

     @method refreshMatrix
     @for Q.Sprite
    */
    refreshMatrix: function() {
      var p = this.p;
      this.matrix.identity();

      if(this.container) { this.matrix.multiply(this.container.matrix); }
      
      this.matrix.translate(p.x,p.y);

      if(p.scale) { this.matrix.scale(p.scale,p.scale); }

      this.matrix.rotateDeg(p.angle);
    }
  });

  /**
   Simple sprite that adds in basic newtonian physics on each step:

       p.vx += p.ax * dt;
       p.vy += p.ay * dt;

       p.x += p.vx * dt;
       p.y += p.vy * dt;

   @class Q.MovingSprite
   @extends Q.Sprite
   @for Quintus.Sprites
  */
  Q.Sprite.extend("MovingSprite",{
    init: function(props,defaultProps) {
      this._super(Q._extend({
        vx: 0,
        vy: 0,
        ax: 0,
        ay: 0
      },props),defaultProps);
   },

   step: function(dt) {
     var p = this.p;

     p.vx += p.ax * dt;
     p.vy += p.ay * dt;

     p.x += p.vx * dt;
     p.y += p.vy * dt;
   }
 });




  return Q;
};


},{}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_tmx.js":[function(require,module,exports){
/*global Quintus:false */

/*global Quintus:false */
/**
Quintus HTML5 Game Engine - TMX Loader module

Module responsible for loading Tiled TMX files

@module Quintus.Input
*/

/**
 * Quintus TMX Loading module
 *
 * @class Quintus.TMX
 */
module.exports = function(Q) {


 // Add TMX file loading support to Quintus
 Q.assetTypes['tmx'] = 'TMX';

 // Load a TMX file as a parsed XML DOM
 Q.loadAssetTMX =  function(key,src,callback,errorCallback) {

   // Piggyback on loadAssetOther's AJAX call
   Q.loadAssetOther(key,src,function(key,responseText) {
     var parser = new DOMParser();
     var doc = parser.parseFromString(responseText, "application/xml");
     // save the asset as the parsed doc
     callback(key,doc);
   }, errorCallback);

 };

 Q._tmxExtractAssetName = function(result) {
   var source = result.getAttribute("source"),
   sourceParts = source.split("/");
   // only return the last part of the asset string
   return sourceParts[sourceParts.length - 1];
 };


 Q._tmxExtractSources = function(asset) {
   var results = asset.querySelectorAll("[source]");
   return Q._map(results,Q._tmxExtractAssetName);

 };
 

 Q.loadTMX = function(files,callback,options) {
   if(Q._isString(files)) {
     files = Q._normalizeArg(files);
   }

   var tmxFiles = [];
   Q._each(files,function(file) {
     if(Q._fileExtension(file) === 'tmx') {
        tmxFiles.push(file);
     }
   });

   var additionalAssets = [];

   Q.load(files,function() {
     Q._each(tmxFiles,function(tmxFile) {
       var sources = Q._tmxExtractSources(Q.asset(tmxFile));
       additionalAssets = additionalAssets.concat(sources);
     });

     if(additionalAssets.length > 0) {
       Q.load(additionalAssets,callback,options);
     } else {
       callback();
     }
   });

 };



 function attr(elem,atr) {
   var value = elem.getAttribute(atr);
   return isNaN(value) ? value : +value;
 }

 function parseProperties(elem) {
   var propElems = elem.querySelectorAll("property"),
       props = {};

   for(var i = 0; i < propElems.length; i++) {
     var propElem = propElems[i];
     props[attr(propElem,'name')] = attr(propElem,'value');
   }
   return props;
 }

 Q._tmxLoadTilesets = function(tilesets, tileProperties) {
   var gidMap = [];

   function parsePoint(pt) {
     var pts = pt.split(",");
     return [ parseFloat(pts[0]), parseFloat(pts[1]) ];
   }

   for(var t = 0; t < tilesets.length;t++) {
     var tileset = tilesets[t],
         sheetName = attr(tileset,"name"),
         gid = attr(tileset,"firstgid"),
         assetName = Q._tmxExtractAssetName(tileset.querySelector("image")),
         tilesetTileProps = {},
         tilesetProps = { tileW: attr(tileset,"tilewidth"),
                          tileH: attr(tileset,"tileheight"),
                          spacingX: attr(tileset,"spacing"),
                          spacingY: attr(tileset,"spacing")
                        };

     var tiles = tileset.querySelectorAll("tile");
     for(var i = 0;i < tiles.length;i++) {
       var tile = tiles[i];
       var tileId = attr(tile,"id");
       var tileGid = gid + tileId;

       var properties = parseProperties(tile);

       if(properties.points) {
         properties.points = Q._map(properties.points.split(" "),parsePoint);
       }

       // save the properties indexed by GID for creating objects
       tileProperties[tileGid] = properties;

       // save the properties indexed by tile number for the frame properties
       tilesetTileProps[tileId] = properties;
     }
     tilesetProps.frameProperties = tilesetTileProps;
     gidMap.push([ gid, sheetName ]);
     Q.sheet(sheetName, assetName,  tilesetProps);

   }
   return gidMap;
 };

 Q._tmxProcessImageLayer = function(stage,gidMap,tileProperties,layer) {
   var assetName = Q._tmxExtractAssetName(layer.querySelector("image"));
   var properties = parseProperties(layer);
   properties.asset = assetName;

   stage.insert(new Q.Repeater(properties));
 };

 // get the first entry in the gid map that gives
 // a gid offset
 Q._lookupGid = function(gid,gidMap) {
   var idx = 0;

   while(gidMap[idx+1] && gid >= gidMap[idx+1][0]) {
     idx++;
   }
   return gidMap[idx];
 };

 Q._tmxProcessTileLayer = function(stage,gidMap,tileProperties,layer) {
   var tiles = layer.querySelectorAll("tile"),
       width = attr(layer,'width'),
       height = attr(layer,'height');

       
   var gidDetails,gidOffset, sheetName;

   var data = [], idx=0;
   for(var y=0;y<height;y++) {
     data[y] = [];
     for(var x=0;x<width;x++) {
       var gid = attr(tiles[idx],"gid");
       if(gid === 0) {
         data[y].push(null);
       } else {
         // If we don't know what tileset this map is associated with
         // figure it out by looking up the gid of the tile w/
         // and match to the tilesef
         if(!gidOffset) {
           gidDetails = Q._lookupGid(attr(tiles[idx],"gid"),gidMap);
           gidOffset = gidDetails[0];
           sheetName = gidDetails[1];
         }
         data[y].push(gid - gidOffset);
       }
       idx++;
     }
   }

   var tileLayerProperties = Q._extend({   
     tileW: Q.sheet(sheetName).tileW,
     tileH: Q.sheet(sheetName).tileH,
     sheet: sheetName,
     tiles: data
     },parseProperties(layer));

   var TileLayerClass = tileLayerProperties.Class || 'TileLayer';

   if(tileLayerProperties['collision']) {
     stage.collisionLayer(new Q[TileLayerClass](tileLayerProperties));
   } else {
     stage.insert(new Q[TileLayerClass](tileLayerProperties));
   }
 };

 Q._tmxProcessObjectLayer = function(stage,gidMap,tileProperties,layer) {
   var objects = layer.querySelectorAll("object");
   for(var i=0;i < objects.length;i++) {
     var obj = objects[i],
         gid = attr(obj,"gid"),
         x = attr(obj,'x'),
         y = attr(obj,'y'),
         properties = tileProperties[gid],
         overrideProperties = parseProperties(obj);

     if(!properties) { throw "Invalid TMX Object: missing properties for GID:" + gid; }
     if(!properties['Class']) { throw "Invalid TMX Object: missing Class for GID:" + gid; }

     var className = properties['Class'];
     if(!className) { throw "Invalid TMX Object Class: " + className + " GID:" + gid; }

     var p = Q._extend(Q._extend({ x: x, y: y }, properties), overrideProperties);

     // Offset the sprite
     var sprite = new Q[className](p);
     sprite.p.x += sprite.p.w/2;
     sprite.p.y -= sprite.p.h/2;

     stage.insert(sprite);
   }

 };

 Q._tmxProcessors = { 'objectgroup': Q._tmxProcessObjectLayer,
                      'layer': Q._tmxProcessTileLayer,
                      'imagelayer': Q._tmxProcessImageLayer };

 Q.stageTMX = function(dataAsset,stage) {
    var data = Q._isString(dataAsset) ?  Q.asset(dataAsset) : dataAsset;

    var tileProperties = {};

    // Load Tilesets
    var tilesets = data.getElementsByTagName("tileset");
    var gidMap = Q._tmxLoadTilesets(tilesets,tileProperties);

    // Go through each of the layers
    Q._each(data.documentElement.childNodes,function(layer) {
      var layerType = layer.tagName;
      if(Q._tmxProcessors[layerType]) {
        Q._tmxProcessors[layerType](stage, gidMap, tileProperties, layer);
      }
    });
  };

};


},{}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_touch.js":[function(require,module,exports){
/*global Quintus:false */

module.exports = function(Q) {
  if(Q._isUndefined(Q.modules.Sprites)) {
    throw "Quintus.Touch requires Quintus.Sprites Module";
  }

  var hasTouch =  !!('ontouchstart' in window);

  var touchStage = [0];
  var touchType = 0;

  Q.Evented.extend("TouchSystem",{

    init: function() {
      var touchSystem = this;

      this.boundTouch = function(e) { touchSystem.touch(e); };
      this.boundDrag = function(e) { touchSystem.drag(e); };
      this.boundEnd = function(e) { touchSystem.touchEnd(e); };

      Q.el.addEventListener('touchstart',this.boundTouch);
      Q.el.addEventListener('mousedown',this.boundTouch);

      Q.el.addEventListener('touchmove',this.boundDrag);
      Q.el.addEventListener('mousemove',this.boundDrag);

      Q.el.addEventListener('touchend',this.boundEnd);
      Q.el.addEventListener('mouseup',this.boundEnd);
      Q.el.addEventListener('touchcancel',this.boundEnd);

      this.touchPos = new Q.Evented();
      this.touchPos.grid = {};
      this.touchPos.p = { w:1, h:1, cx: 0, cy: 0 };
      this.activeTouches = {};
      this.touchedObjects = {};
    },

    destroy: function() {
      Q.el.removeEventListener('touchstart',this.boundTouch);
      Q.el.removeEventListener('mousedown',this.boundTouch);

      Q.el.removeEventListener('touchmove',this.boundDrag);
      Q.el.removeEventListener('mousemove',this.boundDrag);

      Q.el.removeEventListener('touchend',this.boundEnd);
      Q.el.removeEventListener('mouseup',this.boundEnd);
      Q.el.removeEventListener('touchcancel',this.boundEnd);
    },

    normalizeTouch: function(touch,stage) {
      var canvasPosX = touch.offsetX,
          canvasPosY = touch.offsetY;
         

      if(Q._isUndefined(canvasPosX) || Q._isUndefined(canvasPosY)) {
        canvasPosX = touch.layerX;
        canvasPosY = touch.layerY;
      }

      if(Q._isUndefined(canvasPosX) || Q._isUndefined(canvasPosY)) {
        if(Q.touch.offsetX === void 0) {
          Q.touch.offsetX = 0;
          Q.touch.offsetY = 0;
          var el = Q.el;
          do {
            Q.touch.offsetX += el.offsetLeft;
            Q.touch.offsetY += el.offsetTop;
          } while(el = el.offsetParent);
        }
        canvasPosX = touch.pageX - Q.touch.offsetX;
        canvasPosY = touch.pageY - Q.touch.offsetY;
      }


      this.touchPos.p.ox = this.touchPos.p.px = canvasPosX / Q.cssWidth * Q.width;
      this.touchPos.p.oy = this.touchPos.p.py = canvasPosY / Q.cssHeight * Q.height;
      
      if(stage.viewport) {
        this.touchPos.p.px /= stage.viewport.scale;
        this.touchPos.p.py /= stage.viewport.scale;
        this.touchPos.p.px += stage.viewport.x;
        this.touchPos.p.py += stage.viewport.y;
      }

      this.touchPos.p.x = this.touchPos.p.px;
      this.touchPos.p.y = this.touchPos.p.py;

      this.touchPos.obj = null;
      return this.touchPos;
    },

    touch: function(e) {
      var touches = e.changedTouches || [ e ];

      for(var i=0;i<touches.length;i++) {

        for(var stageIdx=0;stageIdx < touchStage.length;stageIdx++) {
          var touch = touches[i],
              stage = Q.stage(touchStage[stageIdx]);

          if(!stage) { continue; }

          touch.identifier = touch.identifier || 0;
          var pos = this.normalizeTouch(touch,stage);

          stage.regrid(pos,true);
          var col = stage.search(pos,touchType), obj;

          if(col || stageIdx === touchStage.length - 1) {
            obj = col && col.obj;
            pos.obj = obj;
            this.trigger("touch",pos);
          }

          if(obj && !this.touchedObjects[obj]) {
            this.activeTouches[touch.identifier] = {
              x: pos.p.px,
              y: pos.p.py,
              origX: obj.p.x,
              origY: obj.p.y,
              sx: pos.p.ox,
              sy: pos.p.oy,
              identifier: touch.identifier,
              obj: obj,
              stage: stage
            };
            this.touchedObjects[obj.p.id] = true;
            obj.trigger('touch', this.activeTouches[touch.identifier]);
            break;
          }

        }

      }
      //e.preventDefault();
    },

    drag: function(e) {
      var touches = e.changedTouches || [ e ];

      for(var i=0;i<touches.length;i++) {
        var touch = touches[i];
        touch.identifier = touch.identifier || 0;

        var active = this.activeTouches[touch.identifier],
            stage = active && active.stage;

        if(active) {
          var pos = this.normalizeTouch(touch,stage);
          active.x = pos.p.px;
          active.y = pos.p.py;
          active.dx = pos.p.ox - active.sx;
          active.dy = pos.p.oy - active.sy;

          active.obj.trigger('drag', active);
        }
      }
      e.preventDefault();
    },

    touchEnd: function(e) {
      var touches = e.changedTouches || [ e ];

      for(var i=0;i<touches.length;i++) {
        var touch = touches[i];

        touch.identifier = touch.identifier || 0;

        var active = this.activeTouches[touch.identifier];

        if(active) {
          active.obj.trigger('touchEnd', active);
          delete this.touchedObjects[active.obj.p.id];
          this.activeTouches[touch.identifier] = null;
        }
      }
      e.preventDefault();
    }

  });

  Q.touch = function(type,stage) {
    Q.untouch();
    touchType = type || Q.SPRITE_UI;
    touchStage = stage || [2,1,0];
    if(!Q._isArray(touchStage)) {
      touchStage = [touchStage];
    }

    if(!Q._touch) {
      Q.touchInput = new Q.TouchSystem();
    }
    return Q;
  };

  Q.untouch = function() {
    if(Q.touchInput) {
      Q.touchInput.destroy();
      delete Q['touchInput'];
    }
    return Q;
  };

};

},{}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/lib/quintus_ui.js":[function(require,module,exports){
/*global Quintus:false */


/**
Quintus HTML5 Game Engine - UI Module

The code in `quintus_ui.js` defines the `Quintus.UI` module, which
adds in some easily accessible UI elements into Quintus.

Depends on the `Quintus.Sprite` module.

UI lets you create UI elements like containers, buttons and text elements.

@module Quintus.UI
*/

/**
 * Quintus UI Module Class
 *
 * @class Quintus.UI
 */
module.exports = function(Q) {
  if(Q._isUndefined(Q.modules.Touch)) {
    throw "Quintus.UI requires Quintus.Touch Module";
  }

  Q.UI = {};

  /**
   Draws a rounded rectangle centered on 0,0

   Options for `rect`

     * radius - radius of the rounded corners
     * w      - width of the rect
     * h      - height of the rect
     * cx     - X coordinate of top left corner
     * cy     - Y coordinate of top left corner

   @method roundRect
   @for Q.UI
   @param {canvas context} ctx
   @param {Object} rect -
   */
  Q.UI.roundRect = function(ctx, rect) {
    ctx.beginPath();
    ctx.moveTo(-rect.cx + rect.radius, -rect.cy);
    ctx.lineTo(-rect.cx + rect.w - rect.radius, -rect.cy);
    ctx.quadraticCurveTo(-rect.cx + rect.w, -rect.cy, -rect.cx + rect.w, -rect.cy + rect.radius);
    ctx.lineTo(-rect.cx + rect.w, -rect.cy + rect.h - rect.radius);
    ctx.quadraticCurveTo(-rect.cx + rect.w,
                         -rect.cy + rect.h,
                         -rect.cx + rect.w - rect.radius,
                         -rect.cy + rect.h);
    ctx.lineTo(-rect.cx + rect.radius, -rect.cy + rect.h);
    ctx.quadraticCurveTo(-rect.cx, -rect.cy + rect.h, -rect.cx, -rect.cy + rect.h - rect.radius);
    ctx.lineTo(-rect.cx, -rect.cy + rect.radius);
    ctx.quadraticCurveTo(-rect.cx, -rect.cy, -rect.cx + rect.radius, -rect.cy);
    ctx.closePath();
  };

  /**
   Creates a container for UI elements.

   Options for `p` are very similar to the ones for Q.Sprite.

     * border - width of the border [0] (no border)
     * radius - radius of the rounded border [5]
     * stroke - color of the border [#000]
     * w      - width of the container
     * h      - height of the container
     * x      - X coordinate of top left corner
     * y      - Y coordinate of top left corner
     * fill   - background color [null]
     * shadow - if the container should have a shadow[false]
     * shadowColor - `rgb` value of the shadow [false]

   @class Q.UI.Container
   @extends Q.Sprite
   @for Q.UI
   @param {Object} p - as described above
   */
  Q.UI.Container = Q.Sprite.extend("UI.Container", {
    init: function(p,defaults) {
      var adjustedP = Q._clone(p||{}),
          match;

      if(p && Q._isString(p.w) && (match = p.w.match(/^[0-9]+%$/))) {
        adjustedP.w = parseInt(p.w,10) * Q.width / 100;
        adjustedP.x = Q.width/2 - adjustedP.w/2;
      }

      if(p && Q._isString(p.h) && (match = p.h.match(/^[0-9]+%$/))) {
        adjustedP.h = parseInt(p.h,10) * Q.height / 100;
        adjustedP.y = Q.height /2 - adjustedP.h/2;
      }

      this._super(Q._defaults(adjustedP,defaults),{
        opacity: 1,
        hidden: false, // Set to true to not show the container
        fill:   null, // Set to color to add background
        highlight:   null, // Set to color to for button
        radius: 5, // Border radius
        stroke: "#000",
        border: false, // Set to a width to show a border
        shadow: false, // Set to true or a shadow offest
        shadowColor: false, // Set to a rgba value for the shadow
        outlineWidth: false, // Set to a width to outline text
        outlineColor: "#000",
        type: Q.SPRITE_NONE
      });

    },

    /**
     Inserts an object into the container.
     The object can later accessed via `children` property of the container.

     @method insert
     @for Q.UI.Container
     @param {Q.GameObject} obj - the Item to insert
     @return the inserted object for chaining
    */
    insert: function(obj) {
      this.stage.insert(obj,this);
      return obj;
    },

    /**
     Fits the containers size depending on its children.

     @method fit
     @for Q.UI.Container
     @param {Number} paddingY - vertical padding
     @param {Number} paddingX - horizontal padding
     @return the inserted object for chaining
    */
    fit: function(paddingY,paddingX) {
      if(this.children.length === 0) { return; }

      if(paddingY === void 0) { paddingY = 0; }
      if(paddingX === void 0) { paddingX = paddingY; }

      var minX = Infinity,
          minY = Infinity,
          maxX = -Infinity,
          maxY = -Infinity;

      for(var i =0;i < this.children.length;i++) {
        var obj = this.children[i];
        var minObjX = obj.p.x - obj.p.cx,
            minObjY = obj.p.y - obj.p.cy,
            maxObjX = obj.p.x - obj.p.cx + obj.p.w,
            maxObjY = obj.p.y - obj.p.cy + obj.p.h;

        if(minObjX < minX) { minX = minObjX; }
        if(minObjY < minY) { minY = minObjY; }

        if(maxObjX > maxX) { maxX = maxObjX; }
        if(maxObjY > maxY) { maxY = maxObjY; }

      }

      this.p.cx = -minX + paddingX;
      this.p.cy = -minY + paddingY;
      this.p.w = maxX - minX + paddingX * 2;
      this.p.h = maxY - minY + paddingY * 2;
    },

    /**
     Adds the shadow specified in `p` to the container.

     @method addShadow
     @param {canvas context} ctx - the canvas context
     @for Q.UI.Container
    */
    addShadow: function(ctx) {
      if(this.p.shadow) {
        var shadowAmount = Q._isNumber(this.p.shadow) ? this.p.shadow : 5;
        ctx.shadowOffsetX=shadowAmount;
        ctx.shadowOffsetY=shadowAmount;
        ctx.shadowColor = this.p.shadowColor || "rgba(0,0,50,0.1)";
      }
    },

    /**
     Sets the shadows color to `transparent`.

     @method clearShadow
     @param {canvas context} ctx - the canvas context
     @for Q.UI.Container
    */
    clearShadow: function(ctx) {
      ctx.shadowColor = "transparent";
    },

    /**
     (re)Draws the roundedRect with shadow and border of the container.

     @method drawRadius
     @param {canvas context} ctx - the canvas context
     @for Q.UI.Container
    */
    drawRadius: function(ctx) {
      Q.UI.roundRect(ctx,this.p);
      this.addShadow(ctx);
      ctx.fill();
      if(this.p.border) {
        this.clearShadow(ctx);
        ctx.lineWidth = this.p.border;
        ctx.stroke();
      }
    },

    drawSquare: function(ctx) {
      this.addShadow(ctx);
      if(this.p.fill) {
        ctx.fillRect(-this.p.cx,-this.p.cy,
                      this.p.w,this.p.h);
      }

      if(this.p.border) {
        this.clearShadow(ctx);
        ctx.lineWidth = this.p.border;
        ctx.strokeRect(-this.p.cx,-this.p.cy,
                        this.p.w,this.p.h);
      }
    },

    draw: function(ctx) {
      if(this.p.hidden) { return false; }
      if(!this.p.border && !this.p.fill) { return; }

      ctx.globalAlpha = this.p.opacity;
      if(this.p.frame === 1 && this.p.highlight) {
        ctx.fillStyle = this.p.highlight;
      } else {
        ctx.fillStyle = this.p.fill;
      }
      ctx.strokeStyle = this.p.stroke;

      if(this.p.radius > 0) {
        this.drawRadius(ctx);
      } else {
        this.drawSquare(ctx);
      }

    }
  });


  /**
   Creates a Text-UI element.

   Options for `p` are very similar to the ones for Q.Sprite.

     * label        - text to display
     * weight       - weight of the text [800]
     * size         - size of the text in px [24]
     * align        - horizontal alignment of the text [left]
     * family       - font family [Arial]
     * color        - color of the text [black]
     * outline      - outline color of the text [black]
     * outlineWidth - thickness of the outline [0]

   @class Q.UI.Text
   @extends Q.Sprite
   @for Q.UI
   @param {Object} p - as described above
   */
  Q.UI.Text = Q.Sprite.extend("UI.Text", {
    init: function(p,defaultProps) {
      this._super(Q._defaults(p||{},defaultProps),{
        type: Q.SPRITE_UI,
        size: 24
      });

      //this.el = document.createElement("canvas");
      //this.ctx = this.el.getContext("2d");

      if(this.p.label) {
        this.calcSize();
      }

      //this.prerender();
    },

    calcSize: function() {
      this.setFont(Q.ctx);
      this.splitLabel = this.p.label.split("\n");
      var maxLabel = "";
      for(var i = 0;i < this.splitLabel.length;i++) {
        if(this.splitLabel[i].length > maxLabel.length) {
          maxLabel = this.splitLabel[i];
        }
      }

      var metrics = Q.ctx.measureText(maxLabel);
      this.p.h = (this.p.size || 24) * this.splitLabel.length * 1.2;
      this.p.w = metrics.width;
      this.p.cx = this.p.w / 2;
      this.p.cy = this.p.h / 2;
    },

    prerender: function() {
      if(this.p.oldLabel === this.p.label) { return; }
      this.p.oldLabel = this.p.label;
      this.calcSize();
      this.el.width = this.p.w;
      this.el.height = this.p.h * 4;
      this.ctx.clearRect(0,0,this.p.w,this.p.h);

      this.ctx.fillStyle = "#FF0";
      this.ctx.fillRect(0,0,this.p.w,this.p.h/2);
      this.setFont(this.ctx);

      this.ctx.fillText(this.p.label,0,0);
    },

    draw: function(ctx) {
       //this.prerender();
      if(this.p.opacity === 0) { return; }

      if(this.p.oldLabel !== this.p.label) { this.calcSize(); }

      this.setFont(ctx);
      if(this.p.opacity !== void 0) { ctx.globalAlpha = this.p.opacity; }
      for(var i =0;i<this.splitLabel.length;i++) {
        if(this.p.align === 'center') {
          if(this.p.outlineWidth) {
            ctx.strokeText(this.splitLabel[i],0,-this.p.cy + i * this.p.size * 1.2);
          }
          ctx.fillText(this.splitLabel[i],0,-this.p.cy + i * this.p.size * 1.2);
        } else if(this.p.align === 'right') {
          if(this.p.outlineWidth) {
            ctx.strokeText(this.splitLabel[i],this.p.cx,-this.p.cy + i * this.p.size * 1.2);
          }
          ctx.fillText(this.splitLabel[i],this.p.cx,-this.p.cy + i * this.p.size * 1.2);
        } else {
          if(this.p.outlineWidth) {
            ctx.strokeText(this.splitLabel[i],-this.p.cx,-this.p.cy +i * this.p.size * 1.2);
          }
          ctx.fillText(this.splitLabel[i],-this.p.cx,-this.p.cy +i * this.p.size * 1.2);
        }
      }
    },

    /**
     Returns the asset of the element

     @method asset
     @for Q.UI.Text
    */
    asset: function() {
      return this.el;
    },

    /**
     Sets the textfont using parameters of `p`.
     Defaults: see Class description!

     @method setFont
     @for Q.UI.Text
    */
    setFont: function(ctx) {
      ctx.textBaseline = "top";
      ctx.font= this.font();
      ctx.fillStyle = this.p.color || "black";
      ctx.textAlign = this.p.align || "left";
      ctx.strokeStyle = this.p.outlineColor || "black";
      ctx.lineWidth = this.p.outlineWidth || 0;
    },

    font: function() {
      if(this.fontString) { return this.fontString; }

      this.fontString = (this.p.weight || "800") + " " +
                        (this.p.size || 24) + "px " +
                        (this.p.family || "Arial");

      return this.fontString;
    }

  });


  /**
   Creates a Button-UI element that can be pressed/touched.
   When `touch` starts, it is highlighted.
   When `touchEnd` is triggered, the button calls the `callback` function and triggers a `click` event.
   Can be given a `keyActionName`. If so, the button listens for `keydown`-triggers of this key.

   Options for `p` are very similar to the ones for Q.UI.Container and Q.UI.Text.

     * label         - text to display
     * keyActionName - _see above_
     * font          - font for text [weigth: 400, size: 24px, family: arial]

   @class Q.UI.Button
   @extends Q.Container
   @for Q.UI
   @param {Object} p - as described above
   @param {function} callback - function to be called on `push` or `touch`
   @param {Object} defaultProps - could be used to overwrite default properties, otherwise uses the ones of Q.Sprite
   */
  Q.UI.Button = Q.UI.Container.extend("UI.Button", {
    init: function(p, callback, defaultProps) {
      this._super(Q._defaults(p||{},defaultProps),{
        type: Q.SPRITE_UI | Q.SPRITE_DEFAULT,
        keyActionName: null
      });
      if(this.p.label && (!this.p.w || !this.p.h)) {
        Q.ctx.save();
        this.setFont(Q.ctx);
        var metrics = Q.ctx.measureText(this.p.label);
        Q.ctx.restore();
        if(!this.p.h) {  this.p.h = 24 + 20; }
        if(!this.p.w) { this.p.w = metrics.width + 20; }
      }

      if(isNaN(this.p.cx)) { this.p.cx = this.p.w / 2; }
      if(isNaN(this.p.cy)) { this.p.cy = this.p.h / 2; }
      this.callback = callback;
      this.on('touch',this,"highlight");
      this.on('touchEnd',this,"push");
      if(this.p.keyActionName) {
        Q.input.on(this.p.keyActionName,this,"push");
      }
    },

    highlight: function() {
      if(typeof this.sheet() !== 'undefined' && this.sheet().frames > 1) {
        this.p.frame = 1;
      }
    },

    push: function() {
      this.p.frame = 0;
      if(this.callback) { this.callback(); }
      this.trigger('click');
    },

    draw: function(ctx) {
      this._super(ctx);

      if(this.p.asset || this.p.sheet) {
        Q.Sprite.prototype.draw.call(this,ctx);
      }

      if(this.p.label) {
        ctx.save();
        this.setFont(ctx);
        ctx.fillText(this.p.label,0,0);
        ctx.restore();
      }
    },

    /**
     Sets the textfont using parameters of `p`.
     Defaults: see Class description!

     @method setFont
     @for Q.UI.Button
    */
    setFont: function(ctx) {
      ctx.textBaseline = "middle";
      ctx.font = this.p.font || "400 24px arial";
      ctx.fillStyle = this.p.fontColor || "black";
      ctx.textAlign = "center";
    }

  });

  /**
   Creates a html-iframe in the html-document.
   It has all other capabilities of Q.Sprite.
   (default) Properties of the html-element:

     * style.position: aboslute
     * style.zIndex: 500
     * Attribute frameborder: 0

   Options via `p`:

     * url - src for iframe
     * w   - width of the iframe
     * h   - height of the iframe

   @class Q.UI.IFrame
   @extends Q.Sprite
   @for Q.UI
   */
  Q.UI.IFrame = Q.Sprite.extend("UI.IFrame", {
    init: function(p) {
      this._super(p, { opacity: 1, type: Q.SPRITE_UI | Q.SPRITE_DEFAULT });

      Q.wrapper.style.overflow = "hidden";

      this.iframe = document.createElement("IFRAME");
      this.iframe.setAttribute("src",this.p.url);
      this.iframe.style.position = "absolute";
      this.iframe.style.zIndex = 500;
      this.iframe.setAttribute("width",this.p.w);
      this.iframe.setAttribute("height",this.p.h);
      this.iframe.setAttribute("frameborder",0);

      if(this.p.background) {
        this.iframe.style.backgroundColor = this.p.background;
      }

      Q.wrapper.appendChild(this.iframe);
      this.on("inserted",function(parent) {
        this.positionIFrame();
        parent.on("destroyed",this,"remove");
      });
    },

    positionIFrame: function() {
      var x = this.p.x;
      var y = this.p.y;
      if(this.stage.viewport) {
        x -= this.stage.viewport.x;
        y -= this.stage.viewport.y;
      }

      if(this.oldX !== x || this.oldY !== y || this.oldOpacity !== this.p.opacity) {

        this.iframe.style.top = (y - this.p.cy) + "px";
        this.iframe.style.left = (x - this.p.cx) + "px";
        this.iframe.style.opacity = this.p.opacity;

        this.oldX = x;
        this.oldY = y;
        this.oldOpacity = this.p.opacity;
      }
    },

    step: function(dt) {
      this._super(dt);
      this.positionIFrame();
    },

    remove: function() {
      if(this.iframe) {
        Q.wrapper.removeChild(this.iframe);
        this.iframe = null;
      }
    }
  });

  /**
   Creates a div-Helement in the html-document with given innerHTML.
   It has all other capabilities of Q.Sprite.

   Option via `p`:

     * html - innerHTML of the div

   @class Q.UI.HTMLElement
   @extends Q.Sprite
   @for Q.UI
   */
  Q.UI.HTMLElement = Q.Sprite.extend("UI.HTMLElement", {
    init: function(p) {
      this._super(p, { opacity: 1, type: Q.SPRITE_UI  });

      Q.wrapper.style.overflow = "hidden";

      this.el = document.createElement("div");
      this.el.innerHTML = this.p.html;

      Q.wrapper.appendChild(this.el);
      this.on("inserted",function(parent) {
        this.position();
        parent.on("destroyed",this,"remove");
        parent.on("clear",this,"remove");
      });
    },

    position: function() {
    },

    step: function(dt) {
      this._super(dt);
      this.position();
    },

    remove: function() {
      if(this.el) {
        Q.wrapper.removeChild(this.el);
        this.el= null;
      }
    }
  });

  Q.UI.VerticalLayout = Q.Sprite.extend("UI.VerticalLayout",{


    init: function(p) {
      this.children = [];
      this._super(p, { type: 0 });
    },

    insert: function(sprite) {
      this.stage.insert(sprite,this);
      this.relayout();
      // Bind to destroy
      return sprite;
    },

    relayout: function() {
      var totalHeight = 0;
      for(var i=0;i<this.children.length;i++) {
        totalHeight += this.children[i].p.h || 0;
      }

      // Center?
      var totalSepartion = this.p.h - totalHeight;

      // Make sure all elements have the same space between them
    }
  });



};

},{}],"/Volumes/spaaaaaace/git/ld32/node_modules/quintus/node_modules/box2dweb/box2d.js":[function(require,module,exports){
/*
* Copyright (c) 2006-2007 Erin Catto http://www.gphysics.com
*
* This software is provided 'as-is', without any express or implied
* warranty.  In no event will the authors be held liable for any damages
* arising from the use of this software.
* Permission is granted to anyone to use this software for any purpose,
* including commercial applications, and to alter it and redistribute it
* freely, subject to the following restrictions:
* 1. The origin of this software must not be misrepresented; you must not
* claim that you wrote the original software. If you use this software
* in a product, an acknowledgment in the product documentation would be
* appreciated but is not required.
* 2. Altered source versions must be plainly marked as such, and must not be
* misrepresented as being the original software.
* 3. This notice may not be removed or altered from any source distribution.
*/
"use strict"

var Box2D = {};

(function (a2j, undefined) {
   
   function emptyFn() {};
   a2j.inherit = function(cls, base) {
      var tmpCtr = cls;
      emptyFn.prototype = base.prototype;
      cls.prototype = new emptyFn;
      cls.prototype.constructor = tmpCtr;
   };
   
   a2j.generateCallback = function generateCallback(context, cb) {
      return function () {
         cb.apply(context, arguments);
      };
   };
   
   a2j.NVector = function NVector(length) {
      if (length === undefined) length = 0;
      var tmp = new Array(length || 0);
      for (var i = 0; i < length; ++i)
      tmp[i] = 0;
      return tmp;
   };
   
   a2j.is = function is(o1, o2) {
      if (o1 === null) return false;
      if ((o2 instanceof Function) && (o1 instanceof o2)) return true;
      if ((o1.constructor.__implements != undefined) && (o1.constructor.__implements[o2])) return true;
      return false;
   };
   
   a2j.parseUInt = function(v) {
      return Math.abs(parseInt(v));
   }
   
})(Box2D);

//#TODO remove assignments from global namespace
var Vector = Array;
var Vector_a2j_Number = Box2D.NVector;
//package structure
if (typeof(Box2D) === "undefined") Box2D = {};
if (typeof(Box2D.Collision) === "undefined") Box2D.Collision = {};
if (typeof(Box2D.Collision.Shapes) === "undefined") Box2D.Collision.Shapes = {};
if (typeof(Box2D.Common) === "undefined") Box2D.Common = {};
if (typeof(Box2D.Common.Math) === "undefined") Box2D.Common.Math = {};
if (typeof(Box2D.Dynamics) === "undefined") Box2D.Dynamics = {};
if (typeof(Box2D.Dynamics.Contacts) === "undefined") Box2D.Dynamics.Contacts = {};
if (typeof(Box2D.Dynamics.Controllers) === "undefined") Box2D.Dynamics.Controllers = {};
if (typeof(Box2D.Dynamics.Joints) === "undefined") Box2D.Dynamics.Joints = {};
//pre-definitions
(function () {
   Box2D.Collision.IBroadPhase = 'Box2D.Collision.IBroadPhase';

   function b2AABB() {
      b2AABB.b2AABB.apply(this, arguments);
   };
   Box2D.Collision.b2AABB = b2AABB;

   function b2Bound() {
      b2Bound.b2Bound.apply(this, arguments);
   };
   Box2D.Collision.b2Bound = b2Bound;

   function b2BoundValues() {
      b2BoundValues.b2BoundValues.apply(this, arguments);
      if (this.constructor === b2BoundValues) this.b2BoundValues.apply(this, arguments);
   };
   Box2D.Collision.b2BoundValues = b2BoundValues;

   function b2Collision() {
      b2Collision.b2Collision.apply(this, arguments);
   };
   Box2D.Collision.b2Collision = b2Collision;

   function b2ContactID() {
      b2ContactID.b2ContactID.apply(this, arguments);
      if (this.constructor === b2ContactID) this.b2ContactID.apply(this, arguments);
   };
   Box2D.Collision.b2ContactID = b2ContactID;

   function b2ContactPoint() {
      b2ContactPoint.b2ContactPoint.apply(this, arguments);
   };
   Box2D.Collision.b2ContactPoint = b2ContactPoint;

   function b2Distance() {
      b2Distance.b2Distance.apply(this, arguments);
   };
   Box2D.Collision.b2Distance = b2Distance;

   function b2DistanceInput() {
      b2DistanceInput.b2DistanceInput.apply(this, arguments);
   };
   Box2D.Collision.b2DistanceInput = b2DistanceInput;

   function b2DistanceOutput() {
      b2DistanceOutput.b2DistanceOutput.apply(this, arguments);
   };
   Box2D.Collision.b2DistanceOutput = b2DistanceOutput;

   function b2DistanceProxy() {
      b2DistanceProxy.b2DistanceProxy.apply(this, arguments);
   };
   Box2D.Collision.b2DistanceProxy = b2DistanceProxy;

   function b2DynamicTree() {
      b2DynamicTree.b2DynamicTree.apply(this, arguments);
      if (this.constructor === b2DynamicTree) this.b2DynamicTree.apply(this, arguments);
   };
   Box2D.Collision.b2DynamicTree = b2DynamicTree;

   function b2DynamicTreeBroadPhase() {
      b2DynamicTreeBroadPhase.b2DynamicTreeBroadPhase.apply(this, arguments);
   };
   Box2D.Collision.b2DynamicTreeBroadPhase = b2DynamicTreeBroadPhase;

   function b2DynamicTreeNode() {
      b2DynamicTreeNode.b2DynamicTreeNode.apply(this, arguments);
   };
   Box2D.Collision.b2DynamicTreeNode = b2DynamicTreeNode;

   function b2DynamicTreePair() {
      b2DynamicTreePair.b2DynamicTreePair.apply(this, arguments);
   };
   Box2D.Collision.b2DynamicTreePair = b2DynamicTreePair;

   function b2Manifold() {
      b2Manifold.b2Manifold.apply(this, arguments);
      if (this.constructor === b2Manifold) this.b2Manifold.apply(this, arguments);
   };
   Box2D.Collision.b2Manifold = b2Manifold;

   function b2ManifoldPoint() {
      b2ManifoldPoint.b2ManifoldPoint.apply(this, arguments);
      if (this.constructor === b2ManifoldPoint) this.b2ManifoldPoint.apply(this, arguments);
   };
   Box2D.Collision.b2ManifoldPoint = b2ManifoldPoint;

   function b2Point() {
      b2Point.b2Point.apply(this, arguments);
   };
   Box2D.Collision.b2Point = b2Point;

   function b2RayCastInput() {
      b2RayCastInput.b2RayCastInput.apply(this, arguments);
      if (this.constructor === b2RayCastInput) this.b2RayCastInput.apply(this, arguments);
   };
   Box2D.Collision.b2RayCastInput = b2RayCastInput;

   function b2RayCastOutput() {
      b2RayCastOutput.b2RayCastOutput.apply(this, arguments);
   };
   Box2D.Collision.b2RayCastOutput = b2RayCastOutput;

   function b2Segment() {
      b2Segment.b2Segment.apply(this, arguments);
   };
   Box2D.Collision.b2Segment = b2Segment;

   function b2SeparationFunction() {
      b2SeparationFunction.b2SeparationFunction.apply(this, arguments);
   };
   Box2D.Collision.b2SeparationFunction = b2SeparationFunction;

   function b2Simplex() {
      b2Simplex.b2Simplex.apply(this, arguments);
      if (this.constructor === b2Simplex) this.b2Simplex.apply(this, arguments);
   };
   Box2D.Collision.b2Simplex = b2Simplex;

   function b2SimplexCache() {
      b2SimplexCache.b2SimplexCache.apply(this, arguments);
   };
   Box2D.Collision.b2SimplexCache = b2SimplexCache;

   function b2SimplexVertex() {
      b2SimplexVertex.b2SimplexVertex.apply(this, arguments);
   };
   Box2D.Collision.b2SimplexVertex = b2SimplexVertex;

   function b2TimeOfImpact() {
      b2TimeOfImpact.b2TimeOfImpact.apply(this, arguments);
   };
   Box2D.Collision.b2TimeOfImpact = b2TimeOfImpact;

   function b2TOIInput() {
      b2TOIInput.b2TOIInput.apply(this, arguments);
   };
   Box2D.Collision.b2TOIInput = b2TOIInput;

   function b2WorldManifold() {
      b2WorldManifold.b2WorldManifold.apply(this, arguments);
      if (this.constructor === b2WorldManifold) this.b2WorldManifold.apply(this, arguments);
   };
   Box2D.Collision.b2WorldManifold = b2WorldManifold;

   function ClipVertex() {
      ClipVertex.ClipVertex.apply(this, arguments);
   };
   Box2D.Collision.ClipVertex = ClipVertex;

   function Features() {
      Features.Features.apply(this, arguments);
   };
   Box2D.Collision.Features = Features;

   function b2CircleShape() {
      b2CircleShape.b2CircleShape.apply(this, arguments);
      if (this.constructor === b2CircleShape) this.b2CircleShape.apply(this, arguments);
   };
   Box2D.Collision.Shapes.b2CircleShape = b2CircleShape;

   function b2EdgeChainDef() {
      b2EdgeChainDef.b2EdgeChainDef.apply(this, arguments);
      if (this.constructor === b2EdgeChainDef) this.b2EdgeChainDef.apply(this, arguments);
   };
   Box2D.Collision.Shapes.b2EdgeChainDef = b2EdgeChainDef;

   function b2EdgeShape() {
      b2EdgeShape.b2EdgeShape.apply(this, arguments);
      if (this.constructor === b2EdgeShape) this.b2EdgeShape.apply(this, arguments);
   };
   Box2D.Collision.Shapes.b2EdgeShape = b2EdgeShape;

   function b2MassData() {
      b2MassData.b2MassData.apply(this, arguments);
   };
   Box2D.Collision.Shapes.b2MassData = b2MassData;

   function b2PolygonShape() {
      b2PolygonShape.b2PolygonShape.apply(this, arguments);
      if (this.constructor === b2PolygonShape) this.b2PolygonShape.apply(this, arguments);
   };
   Box2D.Collision.Shapes.b2PolygonShape = b2PolygonShape;

   function b2Shape() {
      b2Shape.b2Shape.apply(this, arguments);
      if (this.constructor === b2Shape) this.b2Shape.apply(this, arguments);
   };
   Box2D.Collision.Shapes.b2Shape = b2Shape;
   Box2D.Common.b2internal = 'Box2D.Common.b2internal';

   function b2Color() {
      b2Color.b2Color.apply(this, arguments);
      if (this.constructor === b2Color) this.b2Color.apply(this, arguments);
   };
   Box2D.Common.b2Color = b2Color;

   function b2Settings() {
      b2Settings.b2Settings.apply(this, arguments);
   };
   Box2D.Common.b2Settings = b2Settings;

   function b2Mat22() {
      b2Mat22.b2Mat22.apply(this, arguments);
      if (this.constructor === b2Mat22) this.b2Mat22.apply(this, arguments);
   };
   Box2D.Common.Math.b2Mat22 = b2Mat22;

   function b2Mat33() {
      b2Mat33.b2Mat33.apply(this, arguments);
      if (this.constructor === b2Mat33) this.b2Mat33.apply(this, arguments);
   };
   Box2D.Common.Math.b2Mat33 = b2Mat33;

   function b2Math() {
      b2Math.b2Math.apply(this, arguments);
   };
   Box2D.Common.Math.b2Math = b2Math;

   function b2Sweep() {
      b2Sweep.b2Sweep.apply(this, arguments);
   };
   Box2D.Common.Math.b2Sweep = b2Sweep;

   function b2Transform() {
      b2Transform.b2Transform.apply(this, arguments);
      if (this.constructor === b2Transform) this.b2Transform.apply(this, arguments);
   };
   Box2D.Common.Math.b2Transform = b2Transform;

   function b2Vec2() {
      b2Vec2.b2Vec2.apply(this, arguments);
      if (this.constructor === b2Vec2) this.b2Vec2.apply(this, arguments);
   };
   Box2D.Common.Math.b2Vec2 = b2Vec2;

   function b2Vec3() {
      b2Vec3.b2Vec3.apply(this, arguments);
      if (this.constructor === b2Vec3) this.b2Vec3.apply(this, arguments);
   };
   Box2D.Common.Math.b2Vec3 = b2Vec3;

   function b2Body() {
      b2Body.b2Body.apply(this, arguments);
      if (this.constructor === b2Body) this.b2Body.apply(this, arguments);
   };
   Box2D.Dynamics.b2Body = b2Body;

   function b2BodyDef() {
      b2BodyDef.b2BodyDef.apply(this, arguments);
      if (this.constructor === b2BodyDef) this.b2BodyDef.apply(this, arguments);
   };
   Box2D.Dynamics.b2BodyDef = b2BodyDef;

   function b2ContactFilter() {
      b2ContactFilter.b2ContactFilter.apply(this, arguments);
   };
   Box2D.Dynamics.b2ContactFilter = b2ContactFilter;

   function b2ContactImpulse() {
      b2ContactImpulse.b2ContactImpulse.apply(this, arguments);
   };
   Box2D.Dynamics.b2ContactImpulse = b2ContactImpulse;

   function b2ContactListener() {
      b2ContactListener.b2ContactListener.apply(this, arguments);
   };
   Box2D.Dynamics.b2ContactListener = b2ContactListener;

   function b2ContactManager() {
      b2ContactManager.b2ContactManager.apply(this, arguments);
      if (this.constructor === b2ContactManager) this.b2ContactManager.apply(this, arguments);
   };
   Box2D.Dynamics.b2ContactManager = b2ContactManager;

   function b2DebugDraw() {
      b2DebugDraw.b2DebugDraw.apply(this, arguments);
      if (this.constructor === b2DebugDraw) this.b2DebugDraw.apply(this, arguments);
   };
   Box2D.Dynamics.b2DebugDraw = b2DebugDraw;

   function b2DestructionListener() {
      b2DestructionListener.b2DestructionListener.apply(this, arguments);
   };
   Box2D.Dynamics.b2DestructionListener = b2DestructionListener;

   function b2FilterData() {
      b2FilterData.b2FilterData.apply(this, arguments);
   };
   Box2D.Dynamics.b2FilterData = b2FilterData;

   function b2Fixture() {
      b2Fixture.b2Fixture.apply(this, arguments);
      if (this.constructor === b2Fixture) this.b2Fixture.apply(this, arguments);
   };
   Box2D.Dynamics.b2Fixture = b2Fixture;

   function b2FixtureDef() {
      b2FixtureDef.b2FixtureDef.apply(this, arguments);
      if (this.constructor === b2FixtureDef) this.b2FixtureDef.apply(this, arguments);
   };
   Box2D.Dynamics.b2FixtureDef = b2FixtureDef;

   function b2Island() {
      b2Island.b2Island.apply(this, arguments);
      if (this.constructor === b2Island) this.b2Island.apply(this, arguments);
   };
   Box2D.Dynamics.b2Island = b2Island;

   function b2TimeStep() {
      b2TimeStep.b2TimeStep.apply(this, arguments);
   };
   Box2D.Dynamics.b2TimeStep = b2TimeStep;

   function b2World() {
      b2World.b2World.apply(this, arguments);
      if (this.constructor === b2World) this.b2World.apply(this, arguments);
   };
   Box2D.Dynamics.b2World = b2World;

   function b2CircleContact() {
      b2CircleContact.b2CircleContact.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2CircleContact = b2CircleContact;

   function b2Contact() {
      b2Contact.b2Contact.apply(this, arguments);
      if (this.constructor === b2Contact) this.b2Contact.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2Contact = b2Contact;

   function b2ContactConstraint() {
      b2ContactConstraint.b2ContactConstraint.apply(this, arguments);
      if (this.constructor === b2ContactConstraint) this.b2ContactConstraint.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2ContactConstraint = b2ContactConstraint;

   function b2ContactConstraintPoint() {
      b2ContactConstraintPoint.b2ContactConstraintPoint.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2ContactConstraintPoint = b2ContactConstraintPoint;

   function b2ContactEdge() {
      b2ContactEdge.b2ContactEdge.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2ContactEdge = b2ContactEdge;

   function b2ContactFactory() {
      b2ContactFactory.b2ContactFactory.apply(this, arguments);
      if (this.constructor === b2ContactFactory) this.b2ContactFactory.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2ContactFactory = b2ContactFactory;

   function b2ContactRegister() {
      b2ContactRegister.b2ContactRegister.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2ContactRegister = b2ContactRegister;

   function b2ContactResult() {
      b2ContactResult.b2ContactResult.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2ContactResult = b2ContactResult;

   function b2ContactSolver() {
      b2ContactSolver.b2ContactSolver.apply(this, arguments);
      if (this.constructor === b2ContactSolver) this.b2ContactSolver.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2ContactSolver = b2ContactSolver;

   function b2EdgeAndCircleContact() {
      b2EdgeAndCircleContact.b2EdgeAndCircleContact.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2EdgeAndCircleContact = b2EdgeAndCircleContact;

   function b2NullContact() {
      b2NullContact.b2NullContact.apply(this, arguments);
      if (this.constructor === b2NullContact) this.b2NullContact.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2NullContact = b2NullContact;

   function b2PolyAndCircleContact() {
      b2PolyAndCircleContact.b2PolyAndCircleContact.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2PolyAndCircleContact = b2PolyAndCircleContact;

   function b2PolyAndEdgeContact() {
      b2PolyAndEdgeContact.b2PolyAndEdgeContact.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2PolyAndEdgeContact = b2PolyAndEdgeContact;

   function b2PolygonContact() {
      b2PolygonContact.b2PolygonContact.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2PolygonContact = b2PolygonContact;

   function b2PositionSolverManifold() {
      b2PositionSolverManifold.b2PositionSolverManifold.apply(this, arguments);
      if (this.constructor === b2PositionSolverManifold) this.b2PositionSolverManifold.apply(this, arguments);
   };
   Box2D.Dynamics.Contacts.b2PositionSolverManifold = b2PositionSolverManifold;

   function b2BuoyancyController() {
      b2BuoyancyController.b2BuoyancyController.apply(this, arguments);
   };
   Box2D.Dynamics.Controllers.b2BuoyancyController = b2BuoyancyController;

   function b2ConstantAccelController() {
      b2ConstantAccelController.b2ConstantAccelController.apply(this, arguments);
   };
   Box2D.Dynamics.Controllers.b2ConstantAccelController = b2ConstantAccelController;

   function b2ConstantForceController() {
      b2ConstantForceController.b2ConstantForceController.apply(this, arguments);
   };
   Box2D.Dynamics.Controllers.b2ConstantForceController = b2ConstantForceController;

   function b2Controller() {
      b2Controller.b2Controller.apply(this, arguments);
   };
   Box2D.Dynamics.Controllers.b2Controller = b2Controller;

   function b2ControllerEdge() {
      b2ControllerEdge.b2ControllerEdge.apply(this, arguments);
   };
   Box2D.Dynamics.Controllers.b2ControllerEdge = b2ControllerEdge;

   function b2GravityController() {
      b2GravityController.b2GravityController.apply(this, arguments);
   };
   Box2D.Dynamics.Controllers.b2GravityController = b2GravityController;

   function b2TensorDampingController() {
      b2TensorDampingController.b2TensorDampingController.apply(this, arguments);
   };
   Box2D.Dynamics.Controllers.b2TensorDampingController = b2TensorDampingController;

   function b2DistanceJoint() {
      b2DistanceJoint.b2DistanceJoint.apply(this, arguments);
      if (this.constructor === b2DistanceJoint) this.b2DistanceJoint.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2DistanceJoint = b2DistanceJoint;

   function b2DistanceJointDef() {
      b2DistanceJointDef.b2DistanceJointDef.apply(this, arguments);
      if (this.constructor === b2DistanceJointDef) this.b2DistanceJointDef.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2DistanceJointDef = b2DistanceJointDef;

   function b2FrictionJoint() {
      b2FrictionJoint.b2FrictionJoint.apply(this, arguments);
      if (this.constructor === b2FrictionJoint) this.b2FrictionJoint.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2FrictionJoint = b2FrictionJoint;

   function b2FrictionJointDef() {
      b2FrictionJointDef.b2FrictionJointDef.apply(this, arguments);
      if (this.constructor === b2FrictionJointDef) this.b2FrictionJointDef.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2FrictionJointDef = b2FrictionJointDef;

   function b2GearJoint() {
      b2GearJoint.b2GearJoint.apply(this, arguments);
      if (this.constructor === b2GearJoint) this.b2GearJoint.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2GearJoint = b2GearJoint;

   function b2GearJointDef() {
      b2GearJointDef.b2GearJointDef.apply(this, arguments);
      if (this.constructor === b2GearJointDef) this.b2GearJointDef.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2GearJointDef = b2GearJointDef;

   function b2Jacobian() {
      b2Jacobian.b2Jacobian.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2Jacobian = b2Jacobian;

   function b2Joint() {
      b2Joint.b2Joint.apply(this, arguments);
      if (this.constructor === b2Joint) this.b2Joint.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2Joint = b2Joint;

   function b2JointDef() {
      b2JointDef.b2JointDef.apply(this, arguments);
      if (this.constructor === b2JointDef) this.b2JointDef.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2JointDef = b2JointDef;

   function b2JointEdge() {
      b2JointEdge.b2JointEdge.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2JointEdge = b2JointEdge;

   function b2LineJoint() {
      b2LineJoint.b2LineJoint.apply(this, arguments);
      if (this.constructor === b2LineJoint) this.b2LineJoint.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2LineJoint = b2LineJoint;

   function b2LineJointDef() {
      b2LineJointDef.b2LineJointDef.apply(this, arguments);
      if (this.constructor === b2LineJointDef) this.b2LineJointDef.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2LineJointDef = b2LineJointDef;

   function b2MouseJoint() {
      b2MouseJoint.b2MouseJoint.apply(this, arguments);
      if (this.constructor === b2MouseJoint) this.b2MouseJoint.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2MouseJoint = b2MouseJoint;

   function b2MouseJointDef() {
      b2MouseJointDef.b2MouseJointDef.apply(this, arguments);
      if (this.constructor === b2MouseJointDef) this.b2MouseJointDef.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2MouseJointDef = b2MouseJointDef;

   function b2PrismaticJoint() {
      b2PrismaticJoint.b2PrismaticJoint.apply(this, arguments);
      if (this.constructor === b2PrismaticJoint) this.b2PrismaticJoint.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2PrismaticJoint = b2PrismaticJoint;

   function b2PrismaticJointDef() {
      b2PrismaticJointDef.b2PrismaticJointDef.apply(this, arguments);
      if (this.constructor === b2PrismaticJointDef) this.b2PrismaticJointDef.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2PrismaticJointDef = b2PrismaticJointDef;

   function b2PulleyJoint() {
      b2PulleyJoint.b2PulleyJoint.apply(this, arguments);
      if (this.constructor === b2PulleyJoint) this.b2PulleyJoint.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2PulleyJoint = b2PulleyJoint;

   function b2PulleyJointDef() {
      b2PulleyJointDef.b2PulleyJointDef.apply(this, arguments);
      if (this.constructor === b2PulleyJointDef) this.b2PulleyJointDef.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2PulleyJointDef = b2PulleyJointDef;

   function b2RevoluteJoint() {
      b2RevoluteJoint.b2RevoluteJoint.apply(this, arguments);
      if (this.constructor === b2RevoluteJoint) this.b2RevoluteJoint.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2RevoluteJoint = b2RevoluteJoint;

   function b2RevoluteJointDef() {
      b2RevoluteJointDef.b2RevoluteJointDef.apply(this, arguments);
      if (this.constructor === b2RevoluteJointDef) this.b2RevoluteJointDef.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2RevoluteJointDef = b2RevoluteJointDef;

   function b2WeldJoint() {
      b2WeldJoint.b2WeldJoint.apply(this, arguments);
      if (this.constructor === b2WeldJoint) this.b2WeldJoint.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2WeldJoint = b2WeldJoint;

   function b2WeldJointDef() {
      b2WeldJointDef.b2WeldJointDef.apply(this, arguments);
      if (this.constructor === b2WeldJointDef) this.b2WeldJointDef.apply(this, arguments);
   };
   Box2D.Dynamics.Joints.b2WeldJointDef = b2WeldJointDef;
})(); //definitions
Box2D.postDefs = [];
(function () {
   var b2CircleShape = Box2D.Collision.Shapes.b2CircleShape,
      b2EdgeChainDef = Box2D.Collision.Shapes.b2EdgeChainDef,
      b2EdgeShape = Box2D.Collision.Shapes.b2EdgeShape,
      b2MassData = Box2D.Collision.Shapes.b2MassData,
      b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape,
      b2Shape = Box2D.Collision.Shapes.b2Shape,
      b2Color = Box2D.Common.b2Color,
      b2internal = Box2D.Common.b2internal,
      b2Settings = Box2D.Common.b2Settings,
      b2Mat22 = Box2D.Common.Math.b2Mat22,
      b2Mat33 = Box2D.Common.Math.b2Mat33,
      b2Math = Box2D.Common.Math.b2Math,
      b2Sweep = Box2D.Common.Math.b2Sweep,
      b2Transform = Box2D.Common.Math.b2Transform,
      b2Vec2 = Box2D.Common.Math.b2Vec2,
      b2Vec3 = Box2D.Common.Math.b2Vec3,
      b2AABB = Box2D.Collision.b2AABB,
      b2Bound = Box2D.Collision.b2Bound,
      b2BoundValues = Box2D.Collision.b2BoundValues,
      b2Collision = Box2D.Collision.b2Collision,
      b2ContactID = Box2D.Collision.b2ContactID,
      b2ContactPoint = Box2D.Collision.b2ContactPoint,
      b2Distance = Box2D.Collision.b2Distance,
      b2DistanceInput = Box2D.Collision.b2DistanceInput,
      b2DistanceOutput = Box2D.Collision.b2DistanceOutput,
      b2DistanceProxy = Box2D.Collision.b2DistanceProxy,
      b2DynamicTree = Box2D.Collision.b2DynamicTree,
      b2DynamicTreeBroadPhase = Box2D.Collision.b2DynamicTreeBroadPhase,
      b2DynamicTreeNode = Box2D.Collision.b2DynamicTreeNode,
      b2DynamicTreePair = Box2D.Collision.b2DynamicTreePair,
      b2Manifold = Box2D.Collision.b2Manifold,
      b2ManifoldPoint = Box2D.Collision.b2ManifoldPoint,
      b2Point = Box2D.Collision.b2Point,
      b2RayCastInput = Box2D.Collision.b2RayCastInput,
      b2RayCastOutput = Box2D.Collision.b2RayCastOutput,
      b2Segment = Box2D.Collision.b2Segment,
      b2SeparationFunction = Box2D.Collision.b2SeparationFunction,
      b2Simplex = Box2D.Collision.b2Simplex,
      b2SimplexCache = Box2D.Collision.b2SimplexCache,
      b2SimplexVertex = Box2D.Collision.b2SimplexVertex,
      b2TimeOfImpact = Box2D.Collision.b2TimeOfImpact,
      b2TOIInput = Box2D.Collision.b2TOIInput,
      b2WorldManifold = Box2D.Collision.b2WorldManifold,
      ClipVertex = Box2D.Collision.ClipVertex,
      Features = Box2D.Collision.Features,
      IBroadPhase = Box2D.Collision.IBroadPhase;

   b2AABB.b2AABB = function () {
      this.lowerBound = new b2Vec2();
      this.upperBound = new b2Vec2();
   };
   b2AABB.prototype.IsValid = function () {
      var dX = this.upperBound.x - this.lowerBound.x;
      var dY = this.upperBound.y - this.lowerBound.y;
      var valid = dX >= 0.0 && dY >= 0.0;
      valid = valid && this.lowerBound.IsValid() && this.upperBound.IsValid();
      return valid;
   }
   b2AABB.prototype.GetCenter = function () {
      return new b2Vec2((this.lowerBound.x + this.upperBound.x) / 2, (this.lowerBound.y + this.upperBound.y) / 2);
   }
   b2AABB.prototype.GetExtents = function () {
      return new b2Vec2((this.upperBound.x - this.lowerBound.x) / 2, (this.upperBound.y - this.lowerBound.y) / 2);
   }
   b2AABB.prototype.Contains = function (aabb) {
      var result = true;
      result = result && this.lowerBound.x <= aabb.lowerBound.x;
      result = result && this.lowerBound.y <= aabb.lowerBound.y;
      result = result && aabb.upperBound.x <= this.upperBound.x;
      result = result && aabb.upperBound.y <= this.upperBound.y;
      return result;
   }
   b2AABB.prototype.RayCast = function (output, input) {
      var tmin = (-Number.MAX_VALUE);
      var tmax = Number.MAX_VALUE;
      var pX = input.p1.x;
      var pY = input.p1.y;
      var dX = input.p2.x - input.p1.x;
      var dY = input.p2.y - input.p1.y;
      var absDX = Math.abs(dX);
      var absDY = Math.abs(dY);
      var normal = output.normal;
      var inv_d = 0;
      var t1 = 0;
      var t2 = 0;
      var t3 = 0;
      var s = 0; {
         if (absDX < Number.MIN_VALUE) {
            if (pX < this.lowerBound.x || this.upperBound.x < pX) return false;
         }
         else {
            inv_d = 1.0 / dX;
            t1 = (this.lowerBound.x - pX) * inv_d;
            t2 = (this.upperBound.x - pX) * inv_d;
            s = (-1.0);
            if (t1 > t2) {
               t3 = t1;
               t1 = t2;
               t2 = t3;
               s = 1.0;
            }
            if (t1 > tmin) {
               normal.x = s;
               normal.y = 0;
               tmin = t1;
            }
            tmax = Math.min(tmax, t2);
            if (tmin > tmax) return false;
         }
      } {
         if (absDY < Number.MIN_VALUE) {
            if (pY < this.lowerBound.y || this.upperBound.y < pY) return false;
         }
         else {
            inv_d = 1.0 / dY;
            t1 = (this.lowerBound.y - pY) * inv_d;
            t2 = (this.upperBound.y - pY) * inv_d;
            s = (-1.0);
            if (t1 > t2) {
               t3 = t1;
               t1 = t2;
               t2 = t3;
               s = 1.0;
            }
            if (t1 > tmin) {
               normal.y = s;
               normal.x = 0;
               tmin = t1;
            }
            tmax = Math.min(tmax, t2);
            if (tmin > tmax) return false;
         }
      }
      output.fraction = tmin;
      return true;
   }
   b2AABB.prototype.TestOverlap = function (other) {
      var d1X = other.lowerBound.x - this.upperBound.x;
      var d1Y = other.lowerBound.y - this.upperBound.y;
      var d2X = this.lowerBound.x - other.upperBound.x;
      var d2Y = this.lowerBound.y - other.upperBound.y;
      if (d1X > 0.0 || d1Y > 0.0) return false;
      if (d2X > 0.0 || d2Y > 0.0) return false;
      return true;
   }
   b2AABB.Combine = function (aabb1, aabb2) {
      var aabb = new b2AABB();
      aabb.Combine(aabb1, aabb2);
      return aabb;
   }
   b2AABB.prototype.Combine = function (aabb1, aabb2) {
      this.lowerBound.x = Math.min(aabb1.lowerBound.x, aabb2.lowerBound.x);
      this.lowerBound.y = Math.min(aabb1.lowerBound.y, aabb2.lowerBound.y);
      this.upperBound.x = Math.max(aabb1.upperBound.x, aabb2.upperBound.x);
      this.upperBound.y = Math.max(aabb1.upperBound.y, aabb2.upperBound.y);
   }
   b2Bound.b2Bound = function () {};
   b2Bound.prototype.IsLower = function () {
      return (this.value & 1) == 0;
   }
   b2Bound.prototype.IsUpper = function () {
      return (this.value & 1) == 1;
   }
   b2Bound.prototype.Swap = function (b) {
      var tempValue = this.value;
      var tempProxy = this.proxy;
      var tempStabbingCount = this.stabbingCount;
      this.value = b.value;
      this.proxy = b.proxy;
      this.stabbingCount = b.stabbingCount;
      b.value = tempValue;
      b.proxy = tempProxy;
      b.stabbingCount = tempStabbingCount;
   }
   b2BoundValues.b2BoundValues = function () {};
   b2BoundValues.prototype.b2BoundValues = function () {
      this.lowerValues = new Vector_a2j_Number();
      this.lowerValues[0] = 0.0;
      this.lowerValues[1] = 0.0;
      this.upperValues = new Vector_a2j_Number();
      this.upperValues[0] = 0.0;
      this.upperValues[1] = 0.0;
   }
   b2Collision.b2Collision = function () {};
   b2Collision.ClipSegmentToLine = function (vOut, vIn, normal, offset) {
      if (offset === undefined) offset = 0;
      var cv;
      var numOut = 0;
      cv = vIn[0];
      var vIn0 = cv.v;
      cv = vIn[1];
      var vIn1 = cv.v;
      var distance0 = normal.x * vIn0.x + normal.y * vIn0.y - offset;
      var distance1 = normal.x * vIn1.x + normal.y * vIn1.y - offset;
      if (distance0 <= 0.0) vOut[numOut++].Set(vIn[0]);
      if (distance1 <= 0.0) vOut[numOut++].Set(vIn[1]);
      if (distance0 * distance1 < 0.0) {
         var interp = distance0 / (distance0 - distance1);
         cv = vOut[numOut];
         var tVec = cv.v;
         tVec.x = vIn0.x + interp * (vIn1.x - vIn0.x);
         tVec.y = vIn0.y + interp * (vIn1.y - vIn0.y);
         cv = vOut[numOut];
         var cv2;
         if (distance0 > 0.0) {
            cv2 = vIn[0];
            cv.id = cv2.id;
         }
         else {
            cv2 = vIn[1];
            cv.id = cv2.id;
         }++numOut;
      }
      return numOut;
   }
   b2Collision.EdgeSeparation = function (poly1, xf1, edge1, poly2, xf2) {
      if (edge1 === undefined) edge1 = 0;
      var count1 = parseInt(poly1.m_vertexCount);
      var vertices1 = poly1.m_vertices;
      var normals1 = poly1.m_normals;
      var count2 = parseInt(poly2.m_vertexCount);
      var vertices2 = poly2.m_vertices;
      var tMat;
      var tVec;
      tMat = xf1.R;
      tVec = normals1[edge1];
      var normal1WorldX = (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      var normal1WorldY = (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      tMat = xf2.R;
      var normal1X = (tMat.col1.x * normal1WorldX + tMat.col1.y * normal1WorldY);
      var normal1Y = (tMat.col2.x * normal1WorldX + tMat.col2.y * normal1WorldY);
      var index = 0;
      var minDot = Number.MAX_VALUE;
      for (var i = 0; i < count2; ++i) {
         tVec = vertices2[i];
         var dot = tVec.x * normal1X + tVec.y * normal1Y;
         if (dot < minDot) {
            minDot = dot;
            index = i;
         }
      }
      tVec = vertices1[edge1];
      tMat = xf1.R;
      var v1X = xf1.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      var v1Y = xf1.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      tVec = vertices2[index];
      tMat = xf2.R;
      var v2X = xf2.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      var v2Y = xf2.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      v2X -= v1X;
      v2Y -= v1Y;
      var separation = v2X * normal1WorldX + v2Y * normal1WorldY;
      return separation;
   }
   b2Collision.FindMaxSeparation = function (edgeIndex, poly1, xf1, poly2, xf2) {
      var count1 = parseInt(poly1.m_vertexCount);
      var normals1 = poly1.m_normals;
      var tVec;
      var tMat;
      tMat = xf2.R;
      tVec = poly2.m_centroid;
      var dX = xf2.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      var dY = xf2.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      tMat = xf1.R;
      tVec = poly1.m_centroid;
      dX -= xf1.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      dY -= xf1.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      var dLocal1X = (dX * xf1.R.col1.x + dY * xf1.R.col1.y);
      var dLocal1Y = (dX * xf1.R.col2.x + dY * xf1.R.col2.y);
      var edge = 0;
      var maxDot = (-Number.MAX_VALUE);
      for (var i = 0; i < count1; ++i) {
         tVec = normals1[i];
         var dot = (tVec.x * dLocal1X + tVec.y * dLocal1Y);
         if (dot > maxDot) {
            maxDot = dot;
            edge = i;
         }
      }
      var s = b2Collision.EdgeSeparation(poly1, xf1, edge, poly2, xf2);
      var prevEdge = parseInt(edge - 1 >= 0 ? edge - 1 : count1 - 1);
      var sPrev = b2Collision.EdgeSeparation(poly1, xf1, prevEdge, poly2, xf2);
      var nextEdge = parseInt(edge + 1 < count1 ? edge + 1 : 0);
      var sNext = b2Collision.EdgeSeparation(poly1, xf1, nextEdge, poly2, xf2);
      var bestEdge = 0;
      var bestSeparation = 0;
      var increment = 0;
      if (sPrev > s && sPrev > sNext) {
         increment = (-1);
         bestEdge = prevEdge;
         bestSeparation = sPrev;
      }
      else if (sNext > s) {
         increment = 1;
         bestEdge = nextEdge;
         bestSeparation = sNext;
      }
      else {
         edgeIndex[0] = edge;
         return s;
      }
      while (true) {
         if (increment == (-1)) edge = bestEdge - 1 >= 0 ? bestEdge - 1 : count1 - 1;
         else edge = bestEdge + 1 < count1 ? bestEdge + 1 : 0;s = b2Collision.EdgeSeparation(poly1, xf1, edge, poly2, xf2);
         if (s > bestSeparation) {
            bestEdge = edge;
            bestSeparation = s;
         }
         else {
            break;
         }
      }
      edgeIndex[0] = bestEdge;
      return bestSeparation;
   }
   b2Collision.FindIncidentEdge = function (c, poly1, xf1, edge1, poly2, xf2) {
      if (edge1 === undefined) edge1 = 0;
      var count1 = parseInt(poly1.m_vertexCount);
      var normals1 = poly1.m_normals;
      var count2 = parseInt(poly2.m_vertexCount);
      var vertices2 = poly2.m_vertices;
      var normals2 = poly2.m_normals;
      var tMat;
      var tVec;
      tMat = xf1.R;
      tVec = normals1[edge1];
      var normal1X = (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      var normal1Y = (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      tMat = xf2.R;
      var tX = (tMat.col1.x * normal1X + tMat.col1.y * normal1Y);
      normal1Y = (tMat.col2.x * normal1X + tMat.col2.y * normal1Y);
      normal1X = tX;
      var index = 0;
      var minDot = Number.MAX_VALUE;
      for (var i = 0; i < count2; ++i) {
         tVec = normals2[i];
         var dot = (normal1X * tVec.x + normal1Y * tVec.y);
         if (dot < minDot) {
            minDot = dot;
            index = i;
         }
      }
      var tClip;
      var i1 = parseInt(index);
      var i2 = parseInt(i1 + 1 < count2 ? i1 + 1 : 0);
      tClip = c[0];
      tVec = vertices2[i1];
      tMat = xf2.R;
      tClip.v.x = xf2.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      tClip.v.y = xf2.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      tClip.id.features.referenceEdge = edge1;
      tClip.id.features.incidentEdge = i1;
      tClip.id.features.incidentVertex = 0;
      tClip = c[1];
      tVec = vertices2[i2];
      tMat = xf2.R;
      tClip.v.x = xf2.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      tClip.v.y = xf2.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      tClip.id.features.referenceEdge = edge1;
      tClip.id.features.incidentEdge = i2;
      tClip.id.features.incidentVertex = 1;
   }
   b2Collision.MakeClipPointVector = function () {
      var r = new Vector(2);
      r[0] = new ClipVertex();
      r[1] = new ClipVertex();
      return r;
   }
   b2Collision.CollidePolygons = function (manifold, polyA, xfA, polyB, xfB) {
      var cv;
      manifold.m_pointCount = 0;
      var totalRadius = polyA.m_radius + polyB.m_radius;
      var edgeA = 0;
      b2Collision.s_edgeAO[0] = edgeA;
      var separationA = b2Collision.FindMaxSeparation(b2Collision.s_edgeAO, polyA, xfA, polyB, xfB);
      edgeA = b2Collision.s_edgeAO[0];
      if (separationA > totalRadius) return;
      var edgeB = 0;
      b2Collision.s_edgeBO[0] = edgeB;
      var separationB = b2Collision.FindMaxSeparation(b2Collision.s_edgeBO, polyB, xfB, polyA, xfA);
      edgeB = b2Collision.s_edgeBO[0];
      if (separationB > totalRadius) return;
      var poly1;
      var poly2;
      var xf1;
      var xf2;
      var edge1 = 0;
      var flip = 0;
      var k_relativeTol = 0.98;
      var k_absoluteTol = 0.001;
      var tMat;
      if (separationB > k_relativeTol * separationA + k_absoluteTol) {
         poly1 = polyB;
         poly2 = polyA;
         xf1 = xfB;
         xf2 = xfA;
         edge1 = edgeB;
         manifold.m_type = b2Manifold.e_faceB;
         flip = 1;
      }
      else {
         poly1 = polyA;
         poly2 = polyB;
         xf1 = xfA;
         xf2 = xfB;
         edge1 = edgeA;
         manifold.m_type = b2Manifold.e_faceA;
         flip = 0;
      }
      var incidentEdge = b2Collision.s_incidentEdge;
      b2Collision.FindIncidentEdge(incidentEdge, poly1, xf1, edge1, poly2, xf2);
      var count1 = parseInt(poly1.m_vertexCount);
      var vertices1 = poly1.m_vertices;
      var local_v11 = vertices1[edge1];
      var local_v12;
      if (edge1 + 1 < count1) {
         local_v12 = vertices1[parseInt(edge1 + 1)];
      }
      else {
         local_v12 = vertices1[0];
      }
      var localTangent = b2Collision.s_localTangent;
      localTangent.Set(local_v12.x - local_v11.x, local_v12.y - local_v11.y);
      localTangent.Normalize();
      var localNormal = b2Collision.s_localNormal;
      localNormal.x = localTangent.y;
      localNormal.y = (-localTangent.x);
      var planePoint = b2Collision.s_planePoint;
      planePoint.Set(0.5 * (local_v11.x + local_v12.x), 0.5 * (local_v11.y + local_v12.y));
      var tangent = b2Collision.s_tangent;
      tMat = xf1.R;
      tangent.x = (tMat.col1.x * localTangent.x + tMat.col2.x * localTangent.y);
      tangent.y = (tMat.col1.y * localTangent.x + tMat.col2.y * localTangent.y);
      var tangent2 = b2Collision.s_tangent2;
      tangent2.x = (-tangent.x);
      tangent2.y = (-tangent.y);
      var normal = b2Collision.s_normal;
      normal.x = tangent.y;
      normal.y = (-tangent.x);
      var v11 = b2Collision.s_v11;
      var v12 = b2Collision.s_v12;
      v11.x = xf1.position.x + (tMat.col1.x * local_v11.x + tMat.col2.x * local_v11.y);
      v11.y = xf1.position.y + (tMat.col1.y * local_v11.x + tMat.col2.y * local_v11.y);
      v12.x = xf1.position.x + (tMat.col1.x * local_v12.x + tMat.col2.x * local_v12.y);
      v12.y = xf1.position.y + (tMat.col1.y * local_v12.x + tMat.col2.y * local_v12.y);
      var frontOffset = normal.x * v11.x + normal.y * v11.y;
      var sideOffset1 = (-tangent.x * v11.x) - tangent.y * v11.y + totalRadius;
      var sideOffset2 = tangent.x * v12.x + tangent.y * v12.y + totalRadius;
      var clipPoints1 = b2Collision.s_clipPoints1;
      var clipPoints2 = b2Collision.s_clipPoints2;
      var np = 0;
      np = b2Collision.ClipSegmentToLine(clipPoints1, incidentEdge, tangent2, sideOffset1);
      if (np < 2) return;
      np = b2Collision.ClipSegmentToLine(clipPoints2, clipPoints1, tangent, sideOffset2);
      if (np < 2) return;
      manifold.m_localPlaneNormal.SetV(localNormal);
      manifold.m_localPoint.SetV(planePoint);
      var pointCount = 0;
      for (var i = 0; i < b2Settings.b2_maxManifoldPoints; ++i) {
         cv = clipPoints2[i];
         var separation = normal.x * cv.v.x + normal.y * cv.v.y - frontOffset;
         if (separation <= totalRadius) {
            var cp = manifold.m_points[pointCount];
            tMat = xf2.R;
            var tX = cv.v.x - xf2.position.x;
            var tY = cv.v.y - xf2.position.y;
            cp.m_localPoint.x = (tX * tMat.col1.x + tY * tMat.col1.y);
            cp.m_localPoint.y = (tX * tMat.col2.x + tY * tMat.col2.y);
            cp.m_id.Set(cv.id);
            cp.m_id.features.flip = flip;
            ++pointCount;
         }
      }
      manifold.m_pointCount = pointCount;
   }
   b2Collision.CollideCircles = function (manifold, circle1, xf1, circle2, xf2) {
      manifold.m_pointCount = 0;
      var tMat;
      var tVec;
      tMat = xf1.R;
      tVec = circle1.m_p;
      var p1X = xf1.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      var p1Y = xf1.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      tMat = xf2.R;
      tVec = circle2.m_p;
      var p2X = xf2.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      var p2Y = xf2.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      var dX = p2X - p1X;
      var dY = p2Y - p1Y;
      var distSqr = dX * dX + dY * dY;
      var radius = circle1.m_radius + circle2.m_radius;
      if (distSqr > radius * radius) {
         return;
      }
      manifold.m_type = b2Manifold.e_circles;
      manifold.m_localPoint.SetV(circle1.m_p);
      manifold.m_localPlaneNormal.SetZero();
      manifold.m_pointCount = 1;
      manifold.m_points[0].m_localPoint.SetV(circle2.m_p);
      manifold.m_points[0].m_id.key = 0;
   }
   b2Collision.CollidePolygonAndCircle = function (manifold, polygon, xf1, circle, xf2) {
      manifold.m_pointCount = 0;
      var tPoint;
      var dX = 0;
      var dY = 0;
      var positionX = 0;
      var positionY = 0;
      var tVec;
      var tMat;
      tMat = xf2.R;
      tVec = circle.m_p;
      var cX = xf2.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      var cY = xf2.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      dX = cX - xf1.position.x;
      dY = cY - xf1.position.y;
      tMat = xf1.R;
      var cLocalX = (dX * tMat.col1.x + dY * tMat.col1.y);
      var cLocalY = (dX * tMat.col2.x + dY * tMat.col2.y);
      var dist = 0;
      var normalIndex = 0;
      var separation = (-Number.MAX_VALUE);
      var radius = polygon.m_radius + circle.m_radius;
      var vertexCount = parseInt(polygon.m_vertexCount);
      var vertices = polygon.m_vertices;
      var normals = polygon.m_normals;
      for (var i = 0; i < vertexCount; ++i) {
         tVec = vertices[i];
         dX = cLocalX - tVec.x;
         dY = cLocalY - tVec.y;
         tVec = normals[i];
         var s = tVec.x * dX + tVec.y * dY;
         if (s > radius) {
            return;
         }
         if (s > separation) {
            separation = s;
            normalIndex = i;
         }
      }
      var vertIndex1 = parseInt(normalIndex);
      var vertIndex2 = parseInt(vertIndex1 + 1 < vertexCount ? vertIndex1 + 1 : 0);
      var v1 = vertices[vertIndex1];
      var v2 = vertices[vertIndex2];
      if (separation < Number.MIN_VALUE) {
         manifold.m_pointCount = 1;
         manifold.m_type = b2Manifold.e_faceA;
         manifold.m_localPlaneNormal.SetV(normals[normalIndex]);
         manifold.m_localPoint.x = 0.5 * (v1.x + v2.x);
         manifold.m_localPoint.y = 0.5 * (v1.y + v2.y);
         manifold.m_points[0].m_localPoint.SetV(circle.m_p);
         manifold.m_points[0].m_id.key = 0;
         return;
      }
      var u1 = (cLocalX - v1.x) * (v2.x - v1.x) + (cLocalY - v1.y) * (v2.y - v1.y);
      var u2 = (cLocalX - v2.x) * (v1.x - v2.x) + (cLocalY - v2.y) * (v1.y - v2.y);
      if (u1 <= 0.0) {
         if ((cLocalX - v1.x) * (cLocalX - v1.x) + (cLocalY - v1.y) * (cLocalY - v1.y) > radius * radius) return;
         manifold.m_pointCount = 1;
         manifold.m_type = b2Manifold.e_faceA;
         manifold.m_localPlaneNormal.x = cLocalX - v1.x;
         manifold.m_localPlaneNormal.y = cLocalY - v1.y;
         manifold.m_localPlaneNormal.Normalize();
         manifold.m_localPoint.SetV(v1);
         manifold.m_points[0].m_localPoint.SetV(circle.m_p);
         manifold.m_points[0].m_id.key = 0;
      }
      else if (u2 <= 0) {
         if ((cLocalX - v2.x) * (cLocalX - v2.x) + (cLocalY - v2.y) * (cLocalY - v2.y) > radius * radius) return;
         manifold.m_pointCount = 1;
         manifold.m_type = b2Manifold.e_faceA;
         manifold.m_localPlaneNormal.x = cLocalX - v2.x;
         manifold.m_localPlaneNormal.y = cLocalY - v2.y;
         manifold.m_localPlaneNormal.Normalize();
         manifold.m_localPoint.SetV(v2);
         manifold.m_points[0].m_localPoint.SetV(circle.m_p);
         manifold.m_points[0].m_id.key = 0;
      }
      else {
         var faceCenterX = 0.5 * (v1.x + v2.x);
         var faceCenterY = 0.5 * (v1.y + v2.y);
         separation = (cLocalX - faceCenterX) * normals[vertIndex1].x + (cLocalY - faceCenterY) * normals[vertIndex1].y;
         if (separation > radius) return;
         manifold.m_pointCount = 1;
         manifold.m_type = b2Manifold.e_faceA;
         manifold.m_localPlaneNormal.x = normals[vertIndex1].x;
         manifold.m_localPlaneNormal.y = normals[vertIndex1].y;
         manifold.m_localPlaneNormal.Normalize();
         manifold.m_localPoint.Set(faceCenterX, faceCenterY);
         manifold.m_points[0].m_localPoint.SetV(circle.m_p);
         manifold.m_points[0].m_id.key = 0;
      }
   }
   b2Collision.TestOverlap = function (a, b) {
      var t1 = b.lowerBound;
      var t2 = a.upperBound;
      var d1X = t1.x - t2.x;
      var d1Y = t1.y - t2.y;
      t1 = a.lowerBound;
      t2 = b.upperBound;
      var d2X = t1.x - t2.x;
      var d2Y = t1.y - t2.y;
      if (d1X > 0.0 || d1Y > 0.0) return false;
      if (d2X > 0.0 || d2Y > 0.0) return false;
      return true;
   }
   Box2D.postDefs.push(function () {
      Box2D.Collision.b2Collision.s_incidentEdge = b2Collision.MakeClipPointVector();
      Box2D.Collision.b2Collision.s_clipPoints1 = b2Collision.MakeClipPointVector();
      Box2D.Collision.b2Collision.s_clipPoints2 = b2Collision.MakeClipPointVector();
      Box2D.Collision.b2Collision.s_edgeAO = new Vector_a2j_Number(1);
      Box2D.Collision.b2Collision.s_edgeBO = new Vector_a2j_Number(1);
      Box2D.Collision.b2Collision.s_localTangent = new b2Vec2();
      Box2D.Collision.b2Collision.s_localNormal = new b2Vec2();
      Box2D.Collision.b2Collision.s_planePoint = new b2Vec2();
      Box2D.Collision.b2Collision.s_normal = new b2Vec2();
      Box2D.Collision.b2Collision.s_tangent = new b2Vec2();
      Box2D.Collision.b2Collision.s_tangent2 = new b2Vec2();
      Box2D.Collision.b2Collision.s_v11 = new b2Vec2();
      Box2D.Collision.b2Collision.s_v12 = new b2Vec2();
      Box2D.Collision.b2Collision.b2CollidePolyTempVec = new b2Vec2();
      Box2D.Collision.b2Collision.b2_nullFeature = 0x000000ff;
   });
   b2ContactID.b2ContactID = function () {
      this.features = new Features();
   };
   b2ContactID.prototype.b2ContactID = function () {
      this.features._m_id = this;
   }
   b2ContactID.prototype.Set = function (id) {
      this.key = id._key;
   }
   b2ContactID.prototype.Copy = function () {
      var id = new b2ContactID();
      id.key = this.key;
      return id;
   }
   Object.defineProperty(b2ContactID.prototype, 'key', {
      enumerable: false,
      configurable: true,
      get: function () {
         return this._key;
      }
   });
   Object.defineProperty(b2ContactID.prototype, 'key', {
      enumerable: false,
      configurable: true,
      set: function (value) {
         if (value === undefined) value = 0;
         this._key = value;
         this.features._referenceEdge = this._key & 0x000000ff;
         this.features._incidentEdge = ((this._key & 0x0000ff00) >> 8) & 0x000000ff;
         this.features._incidentVertex = ((this._key & 0x00ff0000) >> 16) & 0x000000ff;
         this.features._flip = ((this._key & 0xff000000) >> 24) & 0x000000ff;
      }
   });
   b2ContactPoint.b2ContactPoint = function () {
      this.position = new b2Vec2();
      this.velocity = new b2Vec2();
      this.normal = new b2Vec2();
      this.id = new b2ContactID();
   };
   b2Distance.b2Distance = function () {};
   b2Distance.Distance = function (output, cache, input) {
      ++b2Distance.b2_gjkCalls;
      var proxyA = input.proxyA;
      var proxyB = input.proxyB;
      var transformA = input.transformA;
      var transformB = input.transformB;
      var simplex = b2Distance.s_simplex;
      simplex.ReadCache(cache, proxyA, transformA, proxyB, transformB);
      var vertices = simplex.m_vertices;
      var k_maxIters = 20;
      var saveA = b2Distance.s_saveA;
      var saveB = b2Distance.s_saveB;
      var saveCount = 0;
      var closestPoint = simplex.GetClosestPoint();
      var distanceSqr1 = closestPoint.LengthSquared();
      var distanceSqr2 = distanceSqr1;
      var i = 0;
      var p;
      var iter = 0;
      while (iter < k_maxIters) {
         saveCount = simplex.m_count;
         for (i = 0;
         i < saveCount; i++) {
            saveA[i] = vertices[i].indexA;
            saveB[i] = vertices[i].indexB;
         }
         switch (simplex.m_count) {
         case 1:
            break;
         case 2:
            simplex.Solve2();
            break;
         case 3:
            simplex.Solve3();
            break;
         default:
            b2Settings.b2Assert(false);
         }
         if (simplex.m_count == 3) {
            break;
         }
         p = simplex.GetClosestPoint();
         distanceSqr2 = p.LengthSquared();
         if (distanceSqr2 > distanceSqr1) {}
         distanceSqr1 = distanceSqr2;
         var d = simplex.GetSearchDirection();
         if (d.LengthSquared() < Number.MIN_VALUE * Number.MIN_VALUE) {
            break;
         }
         var vertex = vertices[simplex.m_count];
         vertex.indexA = proxyA.GetSupport(b2Math.MulTMV(transformA.R, d.GetNegative()));
         vertex.wA = b2Math.MulX(transformA, proxyA.GetVertex(vertex.indexA));
         vertex.indexB = proxyB.GetSupport(b2Math.MulTMV(transformB.R, d));
         vertex.wB = b2Math.MulX(transformB, proxyB.GetVertex(vertex.indexB));
         vertex.w = b2Math.SubtractVV(vertex.wB, vertex.wA);
         ++iter;
         ++b2Distance.b2_gjkIters;
         var duplicate = false;
         for (i = 0;
         i < saveCount; i++) {
            if (vertex.indexA == saveA[i] && vertex.indexB == saveB[i]) {
               duplicate = true;
               break;
            }
         }
         if (duplicate) {
            break;
         }++simplex.m_count;
      }
      b2Distance.b2_gjkMaxIters = b2Math.Max(b2Distance.b2_gjkMaxIters, iter);
      simplex.GetWitnessPoints(output.pointA, output.pointB);
      output.distance = b2Math.SubtractVV(output.pointA, output.pointB).Length();
      output.iterations = iter;
      simplex.WriteCache(cache);
      if (input.useRadii) {
         var rA = proxyA.m_radius;
         var rB = proxyB.m_radius;
         if (output.distance > rA + rB && output.distance > Number.MIN_VALUE) {
            output.distance -= rA + rB;
            var normal = b2Math.SubtractVV(output.pointB, output.pointA);
            normal.Normalize();
            output.pointA.x += rA * normal.x;
            output.pointA.y += rA * normal.y;
            output.pointB.x -= rB * normal.x;
            output.pointB.y -= rB * normal.y;
         }
         else {
            p = new b2Vec2();
            p.x = .5 * (output.pointA.x + output.pointB.x);
            p.y = .5 * (output.pointA.y + output.pointB.y);
            output.pointA.x = output.pointB.x = p.x;
            output.pointA.y = output.pointB.y = p.y;
            output.distance = 0.0;
         }
      }
   }
   Box2D.postDefs.push(function () {
      Box2D.Collision.b2Distance.s_simplex = new b2Simplex();
      Box2D.Collision.b2Distance.s_saveA = new Vector_a2j_Number(3);
      Box2D.Collision.b2Distance.s_saveB = new Vector_a2j_Number(3);
   });
   b2DistanceInput.b2DistanceInput = function () {};
   b2DistanceOutput.b2DistanceOutput = function () {
      this.pointA = new b2Vec2();
      this.pointB = new b2Vec2();
   };
   b2DistanceProxy.b2DistanceProxy = function () {};
   b2DistanceProxy.prototype.Set = function (shape) {
      switch (shape.GetType()) {
      case b2Shape.e_circleShape:
         {
            var circle = (shape instanceof b2CircleShape ? shape : null);
            this.m_vertices = new Vector(1, true);
            this.m_vertices[0] = circle.m_p;
            this.m_count = 1;
            this.m_radius = circle.m_radius;
         }
         break;
      case b2Shape.e_polygonShape:
         {
            var polygon = (shape instanceof b2PolygonShape ? shape : null);
            this.m_vertices = polygon.m_vertices;
            this.m_count = polygon.m_vertexCount;
            this.m_radius = polygon.m_radius;
         }
         break;
      default:
         b2Settings.b2Assert(false);
      }
   }
   b2DistanceProxy.prototype.GetSupport = function (d) {
      var bestIndex = 0;
      var bestValue = this.m_vertices[0].x * d.x + this.m_vertices[0].y * d.y;
      for (var i = 1; i < this.m_count; ++i) {
         var value = this.m_vertices[i].x * d.x + this.m_vertices[i].y * d.y;
         if (value > bestValue) {
            bestIndex = i;
            bestValue = value;
         }
      }
      return bestIndex;
   }
   b2DistanceProxy.prototype.GetSupportVertex = function (d) {
      var bestIndex = 0;
      var bestValue = this.m_vertices[0].x * d.x + this.m_vertices[0].y * d.y;
      for (var i = 1; i < this.m_count; ++i) {
         var value = this.m_vertices[i].x * d.x + this.m_vertices[i].y * d.y;
         if (value > bestValue) {
            bestIndex = i;
            bestValue = value;
         }
      }
      return this.m_vertices[bestIndex];
   }
   b2DistanceProxy.prototype.GetVertexCount = function () {
      return this.m_count;
   }
   b2DistanceProxy.prototype.GetVertex = function (index) {
      if (index === undefined) index = 0;
      b2Settings.b2Assert(0 <= index && index < this.m_count);
      return this.m_vertices[index];
   }
   b2DynamicTree.b2DynamicTree = function () {};
   b2DynamicTree.prototype.b2DynamicTree = function () {
      this.m_root = null;
      this.m_freeList = null;
      this.m_path = 0;
      this.m_insertionCount = 0;
   }
   b2DynamicTree.prototype.CreateProxy = function (aabb, userData) {
      var node = this.AllocateNode();
      var extendX = b2Settings.b2_aabbExtension;
      var extendY = b2Settings.b2_aabbExtension;
      node.aabb.lowerBound.x = aabb.lowerBound.x - extendX;
      node.aabb.lowerBound.y = aabb.lowerBound.y - extendY;
      node.aabb.upperBound.x = aabb.upperBound.x + extendX;
      node.aabb.upperBound.y = aabb.upperBound.y + extendY;
      node.userData = userData;
      this.InsertLeaf(node);
      return node;
   }
   b2DynamicTree.prototype.DestroyProxy = function (proxy) {
      this.RemoveLeaf(proxy);
      this.FreeNode(proxy);
   }
   b2DynamicTree.prototype.MoveProxy = function (proxy, aabb, displacement) {
      b2Settings.b2Assert(proxy.IsLeaf());
      if (proxy.aabb.Contains(aabb)) {
         return false;
      }
      this.RemoveLeaf(proxy);
      var extendX = b2Settings.b2_aabbExtension + b2Settings.b2_aabbMultiplier * (displacement.x > 0 ? displacement.x : (-displacement.x));
      var extendY = b2Settings.b2_aabbExtension + b2Settings.b2_aabbMultiplier * (displacement.y > 0 ? displacement.y : (-displacement.y));
      proxy.aabb.lowerBound.x = aabb.lowerBound.x - extendX;
      proxy.aabb.lowerBound.y = aabb.lowerBound.y - extendY;
      proxy.aabb.upperBound.x = aabb.upperBound.x + extendX;
      proxy.aabb.upperBound.y = aabb.upperBound.y + extendY;
      this.InsertLeaf(proxy);
      return true;
   }
   b2DynamicTree.prototype.Rebalance = function (iterations) {
      if (iterations === undefined) iterations = 0;
      if (this.m_root == null) return;
      for (var i = 0; i < iterations; i++) {
         var node = this.m_root;
         var bit = 0;
         while (node.IsLeaf() == false) {
            node = (this.m_path >> bit) & 1 ? node.child2 : node.child1;
            bit = (bit + 1) & 31;
         }++this.m_path;
         this.RemoveLeaf(node);
         this.InsertLeaf(node);
      }
   }
   b2DynamicTree.prototype.GetFatAABB = function (proxy) {
      return proxy.aabb;
   }
   b2DynamicTree.prototype.GetUserData = function (proxy) {
      return proxy.userData;
   }
   b2DynamicTree.prototype.Query = function (callback, aabb) {
      if (this.m_root == null) return;
      var stack = new Vector();
      var count = 0;
      stack[count++] = this.m_root;
      while (count > 0) {
         var node = stack[--count];
         if (node.aabb.TestOverlap(aabb)) {
            if (node.IsLeaf()) {
               var proceed = callback(node);
               if (!proceed) return;
            }
            else {
               stack[count++] = node.child1;
               stack[count++] = node.child2;
            }
         }
      }
   }
   b2DynamicTree.prototype.RayCast = function (callback, input) {
      if (this.m_root == null) return;
      var p1 = input.p1;
      var p2 = input.p2;
      var r = b2Math.SubtractVV(p1, p2);
      r.Normalize();
      var v = b2Math.CrossFV(1.0, r);
      var abs_v = b2Math.AbsV(v);
      var maxFraction = input.maxFraction;
      var segmentAABB = new b2AABB();
      var tX = 0;
      var tY = 0; {
         tX = p1.x + maxFraction * (p2.x - p1.x);
         tY = p1.y + maxFraction * (p2.y - p1.y);
         segmentAABB.lowerBound.x = Math.min(p1.x, tX);
         segmentAABB.lowerBound.y = Math.min(p1.y, tY);
         segmentAABB.upperBound.x = Math.max(p1.x, tX);
         segmentAABB.upperBound.y = Math.max(p1.y, tY);
      }
      var stack = new Vector();
      var count = 0;
      stack[count++] = this.m_root;
      while (count > 0) {
         var node = stack[--count];
         if (node.aabb.TestOverlap(segmentAABB) == false) {
            continue;
         }
         var c = node.aabb.GetCenter();
         var h = node.aabb.GetExtents();
         var separation = Math.abs(v.x * (p1.x - c.x) + v.y * (p1.y - c.y)) - abs_v.x * h.x - abs_v.y * h.y;
         if (separation > 0.0) continue;
         if (node.IsLeaf()) {
            var subInput = new b2RayCastInput();
            subInput.p1 = input.p1;
            subInput.p2 = input.p2;
            subInput.maxFraction = input.maxFraction;
            maxFraction = callback(subInput, node);
            if (maxFraction == 0.0) return;
            if (maxFraction > 0.0) {
               tX = p1.x + maxFraction * (p2.x - p1.x);
               tY = p1.y + maxFraction * (p2.y - p1.y);
               segmentAABB.lowerBound.x = Math.min(p1.x, tX);
               segmentAABB.lowerBound.y = Math.min(p1.y, tY);
               segmentAABB.upperBound.x = Math.max(p1.x, tX);
               segmentAABB.upperBound.y = Math.max(p1.y, tY);
            }
         }
         else {
            stack[count++] = node.child1;
            stack[count++] = node.child2;
         }
      }
   }
   b2DynamicTree.prototype.AllocateNode = function () {
      if (this.m_freeList) {
         var node = this.m_freeList;
         this.m_freeList = node.parent;
         node.parent = null;
         node.child1 = null;
         node.child2 = null;
         return node;
      }
      return new b2DynamicTreeNode();
   }
   b2DynamicTree.prototype.FreeNode = function (node) {
      node.parent = this.m_freeList;
      this.m_freeList = node;
   }
   b2DynamicTree.prototype.InsertLeaf = function (leaf) {
      ++this.m_insertionCount;
      if (this.m_root == null) {
         this.m_root = leaf;
         this.m_root.parent = null;
         return;
      }
      var center = leaf.aabb.GetCenter();
      var sibling = this.m_root;
      if (sibling.IsLeaf() == false) {
         do {
            var child1 = sibling.child1;
            var child2 = sibling.child2;
            var norm1 = Math.abs((child1.aabb.lowerBound.x + child1.aabb.upperBound.x) / 2 - center.x) + Math.abs((child1.aabb.lowerBound.y + child1.aabb.upperBound.y) / 2 - center.y);
            var norm2 = Math.abs((child2.aabb.lowerBound.x + child2.aabb.upperBound.x) / 2 - center.x) + Math.abs((child2.aabb.lowerBound.y + child2.aabb.upperBound.y) / 2 - center.y);
            if (norm1 < norm2) {
               sibling = child1;
            }
            else {
               sibling = child2;
            }
         }
         while (sibling.IsLeaf() == false)
      }
      var node1 = sibling.parent;
      var node2 = this.AllocateNode();
      node2.parent = node1;
      node2.userData = null;
      node2.aabb.Combine(leaf.aabb, sibling.aabb);
      if (node1) {
         if (sibling.parent.child1 == sibling) {
            node1.child1 = node2;
         }
         else {
            node1.child2 = node2;
         }
         node2.child1 = sibling;
         node2.child2 = leaf;
         sibling.parent = node2;
         leaf.parent = node2;
         do {
            if (node1.aabb.Contains(node2.aabb)) break;
            node1.aabb.Combine(node1.child1.aabb, node1.child2.aabb);
            node2 = node1;
            node1 = node1.parent;
         }
         while (node1)
      }
      else {
         node2.child1 = sibling;
         node2.child2 = leaf;
         sibling.parent = node2;
         leaf.parent = node2;
         this.m_root = node2;
      }
   }
   b2DynamicTree.prototype.RemoveLeaf = function (leaf) {
      if (leaf == this.m_root) {
         this.m_root = null;
         return;
      }
      var node2 = leaf.parent;
      var node1 = node2.parent;
      var sibling;
      if (node2.child1 == leaf) {
         sibling = node2.child2;
      }
      else {
         sibling = node2.child1;
      }
      if (node1) {
         if (node1.child1 == node2) {
            node1.child1 = sibling;
         }
         else {
            node1.child2 = sibling;
         }
         sibling.parent = node1;
         this.FreeNode(node2);
         while (node1) {
            var oldAABB = node1.aabb;
            node1.aabb = b2AABB.Combine(node1.child1.aabb, node1.child2.aabb);
            if (oldAABB.Contains(node1.aabb)) break;
            node1 = node1.parent;
         }
      }
      else {
         this.m_root = sibling;
         sibling.parent = null;
         this.FreeNode(node2);
      }
   }
   b2DynamicTreeBroadPhase.b2DynamicTreeBroadPhase = function () {
      this.m_tree = new b2DynamicTree();
      this.m_moveBuffer = new Vector();
      this.m_pairBuffer = new Vector();
      this.m_pairCount = 0;
   };
   b2DynamicTreeBroadPhase.prototype.CreateProxy = function (aabb, userData) {
      var proxy = this.m_tree.CreateProxy(aabb, userData);
      ++this.m_proxyCount;
      this.BufferMove(proxy);
      return proxy;
   }
   b2DynamicTreeBroadPhase.prototype.DestroyProxy = function (proxy) {
      this.UnBufferMove(proxy);
      --this.m_proxyCount;
      this.m_tree.DestroyProxy(proxy);
   }
   b2DynamicTreeBroadPhase.prototype.MoveProxy = function (proxy, aabb, displacement) {
      var buffer = this.m_tree.MoveProxy(proxy, aabb, displacement);
      if (buffer) {
         this.BufferMove(proxy);
      }
   }
   b2DynamicTreeBroadPhase.prototype.TestOverlap = function (proxyA, proxyB) {
      var aabbA = this.m_tree.GetFatAABB(proxyA);
      var aabbB = this.m_tree.GetFatAABB(proxyB);
      return aabbA.TestOverlap(aabbB);
   }
   b2DynamicTreeBroadPhase.prototype.GetUserData = function (proxy) {
      return this.m_tree.GetUserData(proxy);
   }
   b2DynamicTreeBroadPhase.prototype.GetFatAABB = function (proxy) {
      return this.m_tree.GetFatAABB(proxy);
   }
   b2DynamicTreeBroadPhase.prototype.GetProxyCount = function () {
      return this.m_proxyCount;
   }
   b2DynamicTreeBroadPhase.prototype.UpdatePairs = function (callback) {
      var __this = this;
      __this.m_pairCount = 0;
      var i = 0,
         queryProxy;
       function QueryCallback(proxy) {
          if (proxy == queryProxy) return true;
          if (__this.m_pairCount == __this.m_pairBuffer.length) {
             __this.m_pairBuffer[__this.m_pairCount] = new b2DynamicTreePair();
          }
          var pair = __this.m_pairBuffer[__this.m_pairCount];
          pair.proxyA = proxy < queryProxy ? proxy : queryProxy;
          pair.proxyB = proxy >= queryProxy ? proxy : queryProxy;++__this.m_pairCount;
          return true;
       };
      for (i = 0;
      i < __this.m_moveBuffer.length; ++i) {
         queryProxy = __this.m_moveBuffer[i];
         var fatAABB = __this.m_tree.GetFatAABB(queryProxy);
         __this.m_tree.Query(QueryCallback, fatAABB);
      }
      __this.m_moveBuffer.length = 0;
      for (var i = 0; i < __this.m_pairCount;) {
         var primaryPair = __this.m_pairBuffer[i];
         var userDataA = __this.m_tree.GetUserData(primaryPair.proxyA);
         var userDataB = __this.m_tree.GetUserData(primaryPair.proxyB);
         callback(userDataA, userDataB);
         ++i;
         while (i < __this.m_pairCount) {
            var pair = __this.m_pairBuffer[i];
            if (pair.proxyA != primaryPair.proxyA || pair.proxyB != primaryPair.proxyB) {
               break;
            }++i;
         }
      }
   }
   b2DynamicTreeBroadPhase.prototype.Query = function (callback, aabb) {
      this.m_tree.Query(callback, aabb);
   }
   b2DynamicTreeBroadPhase.prototype.RayCast = function (callback, input) {
      this.m_tree.RayCast(callback, input);
   }
   b2DynamicTreeBroadPhase.prototype.Validate = function () {}
   b2DynamicTreeBroadPhase.prototype.Rebalance = function (iterations) {
      if (iterations === undefined) iterations = 0;
      this.m_tree.Rebalance(iterations);
   }
   b2DynamicTreeBroadPhase.prototype.BufferMove = function (proxy) {
      this.m_moveBuffer[this.m_moveBuffer.length] = proxy;
   }
   b2DynamicTreeBroadPhase.prototype.UnBufferMove = function (proxy) {
      var i = parseInt(this.m_moveBuffer.indexOf(proxy));
      this.m_moveBuffer.splice(i, 1);
   }
   b2DynamicTreeBroadPhase.prototype.ComparePairs = function (pair1, pair2) {
      return 0;
   }
   b2DynamicTreeBroadPhase.__implements = {};
   b2DynamicTreeBroadPhase.__implements[IBroadPhase] = true;
   b2DynamicTreeNode.b2DynamicTreeNode = function () {
      this.aabb = new b2AABB();
   };
   b2DynamicTreeNode.prototype.IsLeaf = function () {
      return this.child1 == null;
   }
   b2DynamicTreePair.b2DynamicTreePair = function () {};
   b2Manifold.b2Manifold = function () {
      this.m_pointCount = 0;
   };
   b2Manifold.prototype.b2Manifold = function () {
      this.m_points = new Vector(b2Settings.b2_maxManifoldPoints);
      for (var i = 0; i < b2Settings.b2_maxManifoldPoints; i++) {
         this.m_points[i] = new b2ManifoldPoint();
      }
      this.m_localPlaneNormal = new b2Vec2();
      this.m_localPoint = new b2Vec2();
   }
   b2Manifold.prototype.Reset = function () {
      for (var i = 0; i < b2Settings.b2_maxManifoldPoints; i++) {
         ((this.m_points[i] instanceof b2ManifoldPoint ? this.m_points[i] : null)).Reset();
      }
      this.m_localPlaneNormal.SetZero();
      this.m_localPoint.SetZero();
      this.m_type = 0;
      this.m_pointCount = 0;
   }
   b2Manifold.prototype.Set = function (m) {
      this.m_pointCount = m.m_pointCount;
      for (var i = 0; i < b2Settings.b2_maxManifoldPoints; i++) {
         ((this.m_points[i] instanceof b2ManifoldPoint ? this.m_points[i] : null)).Set(m.m_points[i]);
      }
      this.m_localPlaneNormal.SetV(m.m_localPlaneNormal);
      this.m_localPoint.SetV(m.m_localPoint);
      this.m_type = m.m_type;
   }
   b2Manifold.prototype.Copy = function () {
      var copy = new b2Manifold();
      copy.Set(this);
      return copy;
   }
   Box2D.postDefs.push(function () {
      Box2D.Collision.b2Manifold.e_circles = 0x0001;
      Box2D.Collision.b2Manifold.e_faceA = 0x0002;
      Box2D.Collision.b2Manifold.e_faceB = 0x0004;
   });
   b2ManifoldPoint.b2ManifoldPoint = function () {
      this.m_localPoint = new b2Vec2();
      this.m_id = new b2ContactID();
   };
   b2ManifoldPoint.prototype.b2ManifoldPoint = function () {
      this.Reset();
   }
   b2ManifoldPoint.prototype.Reset = function () {
      this.m_localPoint.SetZero();
      this.m_normalImpulse = 0.0;
      this.m_tangentImpulse = 0.0;
      this.m_id.key = 0;
   }
   b2ManifoldPoint.prototype.Set = function (m) {
      this.m_localPoint.SetV(m.m_localPoint);
      this.m_normalImpulse = m.m_normalImpulse;
      this.m_tangentImpulse = m.m_tangentImpulse;
      this.m_id.Set(m.m_id);
   }
   b2Point.b2Point = function () {
      this.p = new b2Vec2();
   };
   b2Point.prototype.Support = function (xf, vX, vY) {
      if (vX === undefined) vX = 0;
      if (vY === undefined) vY = 0;
      return this.p;
   }
   b2Point.prototype.GetFirstVertex = function (xf) {
      return this.p;
   }
   b2RayCastInput.b2RayCastInput = function () {
      this.p1 = new b2Vec2();
      this.p2 = new b2Vec2();
   };
   b2RayCastInput.prototype.b2RayCastInput = function (p1, p2, maxFraction) {
      if (p1 === undefined) p1 = null;
      if (p2 === undefined) p2 = null;
      if (maxFraction === undefined) maxFraction = 1;
      if (p1) this.p1.SetV(p1);
      if (p2) this.p2.SetV(p2);
      this.maxFraction = maxFraction;
   }
   b2RayCastOutput.b2RayCastOutput = function () {
      this.normal = new b2Vec2();
   };
   b2Segment.b2Segment = function () {
      this.p1 = new b2Vec2();
      this.p2 = new b2Vec2();
   };
   b2Segment.prototype.TestSegment = function (lambda, normal, segment, maxLambda) {
      if (maxLambda === undefined) maxLambda = 0;
      var s = segment.p1;
      var rX = segment.p2.x - s.x;
      var rY = segment.p2.y - s.y;
      var dX = this.p2.x - this.p1.x;
      var dY = this.p2.y - this.p1.y;
      var nX = dY;
      var nY = (-dX);
      var k_slop = 100.0 * Number.MIN_VALUE;
      var denom = (-(rX * nX + rY * nY));
      if (denom > k_slop) {
         var bX = s.x - this.p1.x;
         var bY = s.y - this.p1.y;
         var a = (bX * nX + bY * nY);
         if (0.0 <= a && a <= maxLambda * denom) {
            var mu2 = (-rX * bY) + rY * bX;
            if ((-k_slop * denom) <= mu2 && mu2 <= denom * (1.0 + k_slop)) {
               a /= denom;
               var nLen = Math.sqrt(nX * nX + nY * nY);
               nX /= nLen;
               nY /= nLen;
               lambda[0] = a;
               normal.Set(nX, nY);
               return true;
            }
         }
      }
      return false;
   }
   b2Segment.prototype.Extend = function (aabb) {
      this.ExtendForward(aabb);
      this.ExtendBackward(aabb);
   }
   b2Segment.prototype.ExtendForward = function (aabb) {
      var dX = this.p2.x - this.p1.x;
      var dY = this.p2.y - this.p1.y;
      var lambda = Math.min(dX > 0 ? (aabb.upperBound.x - this.p1.x) / dX : dX < 0 ? (aabb.lowerBound.x - this.p1.x) / dX : Number.POSITIVE_INFINITY,
      dY > 0 ? (aabb.upperBound.y - this.p1.y) / dY : dY < 0 ? (aabb.lowerBound.y - this.p1.y) / dY : Number.POSITIVE_INFINITY);
      this.p2.x = this.p1.x + dX * lambda;
      this.p2.y = this.p1.y + dY * lambda;
   }
   b2Segment.prototype.ExtendBackward = function (aabb) {
      var dX = (-this.p2.x) + this.p1.x;
      var dY = (-this.p2.y) + this.p1.y;
      var lambda = Math.min(dX > 0 ? (aabb.upperBound.x - this.p2.x) / dX : dX < 0 ? (aabb.lowerBound.x - this.p2.x) / dX : Number.POSITIVE_INFINITY,
      dY > 0 ? (aabb.upperBound.y - this.p2.y) / dY : dY < 0 ? (aabb.lowerBound.y - this.p2.y) / dY : Number.POSITIVE_INFINITY);
      this.p1.x = this.p2.x + dX * lambda;
      this.p1.y = this.p2.y + dY * lambda;
   }
   b2SeparationFunction.b2SeparationFunction = function () {
      this.m_localPoint = new b2Vec2();
      this.m_axis = new b2Vec2();
   };
   b2SeparationFunction.prototype.Initialize = function (cache, proxyA, transformA, proxyB, transformB) {
      this.m_proxyA = proxyA;
      this.m_proxyB = proxyB;
      var count = parseInt(cache.count);
      b2Settings.b2Assert(0 < count && count < 3);
      var localPointA;
      var localPointA1;
      var localPointA2;
      var localPointB;
      var localPointB1;
      var localPointB2;
      var pointAX = 0;
      var pointAY = 0;
      var pointBX = 0;
      var pointBY = 0;
      var normalX = 0;
      var normalY = 0;
      var tMat;
      var tVec;
      var s = 0;
      var sgn = 0;
      if (count == 1) {
         this.m_type = b2SeparationFunction.e_points;
         localPointA = this.m_proxyA.GetVertex(cache.indexA[0]);
         localPointB = this.m_proxyB.GetVertex(cache.indexB[0]);
         tVec = localPointA;
         tMat = transformA.R;
         pointAX = transformA.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
         pointAY = transformA.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
         tVec = localPointB;
         tMat = transformB.R;
         pointBX = transformB.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
         pointBY = transformB.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
         this.m_axis.x = pointBX - pointAX;
         this.m_axis.y = pointBY - pointAY;
         this.m_axis.Normalize();
      }
      else if (cache.indexB[0] == cache.indexB[1]) {
         this.m_type = b2SeparationFunction.e_faceA;
         localPointA1 = this.m_proxyA.GetVertex(cache.indexA[0]);
         localPointA2 = this.m_proxyA.GetVertex(cache.indexA[1]);
         localPointB = this.m_proxyB.GetVertex(cache.indexB[0]);
         this.m_localPoint.x = 0.5 * (localPointA1.x + localPointA2.x);
         this.m_localPoint.y = 0.5 * (localPointA1.y + localPointA2.y);
         this.m_axis = b2Math.CrossVF(b2Math.SubtractVV(localPointA2, localPointA1), 1.0);
         this.m_axis.Normalize();
         tVec = this.m_axis;
         tMat = transformA.R;
         normalX = tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
         normalY = tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
         tVec = this.m_localPoint;
         tMat = transformA.R;
         pointAX = transformA.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
         pointAY = transformA.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
         tVec = localPointB;
         tMat = transformB.R;
         pointBX = transformB.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
         pointBY = transformB.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
         s = (pointBX - pointAX) * normalX + (pointBY - pointAY) * normalY;
         if (s < 0.0) {
            this.m_axis.NegativeSelf();
         }
      }
      else if (cache.indexA[0] == cache.indexA[0]) {
         this.m_type = b2SeparationFunction.e_faceB;
         localPointB1 = this.m_proxyB.GetVertex(cache.indexB[0]);
         localPointB2 = this.m_proxyB.GetVertex(cache.indexB[1]);
         localPointA = this.m_proxyA.GetVertex(cache.indexA[0]);
         this.m_localPoint.x = 0.5 * (localPointB1.x + localPointB2.x);
         this.m_localPoint.y = 0.5 * (localPointB1.y + localPointB2.y);
         this.m_axis = b2Math.CrossVF(b2Math.SubtractVV(localPointB2, localPointB1), 1.0);
         this.m_axis.Normalize();
         tVec = this.m_axis;
         tMat = transformB.R;
         normalX = tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
         normalY = tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
         tVec = this.m_localPoint;
         tMat = transformB.R;
         pointBX = transformB.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
         pointBY = transformB.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
         tVec = localPointA;
         tMat = transformA.R;
         pointAX = transformA.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
         pointAY = transformA.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
         s = (pointAX - pointBX) * normalX + (pointAY - pointBY) * normalY;
         if (s < 0.0) {
            this.m_axis.NegativeSelf();
         }
      }
      else {
         localPointA1 = this.m_proxyA.GetVertex(cache.indexA[0]);
         localPointA2 = this.m_proxyA.GetVertex(cache.indexA[1]);
         localPointB1 = this.m_proxyB.GetVertex(cache.indexB[0]);
         localPointB2 = this.m_proxyB.GetVertex(cache.indexB[1]);
         var pA = b2Math.MulX(transformA, localPointA);
         var dA = b2Math.MulMV(transformA.R, b2Math.SubtractVV(localPointA2, localPointA1));
         var pB = b2Math.MulX(transformB, localPointB);
         var dB = b2Math.MulMV(transformB.R, b2Math.SubtractVV(localPointB2, localPointB1));
         var a = dA.x * dA.x + dA.y * dA.y;
         var e = dB.x * dB.x + dB.y * dB.y;
         var r = b2Math.SubtractVV(dB, dA);
         var c = dA.x * r.x + dA.y * r.y;
         var f = dB.x * r.x + dB.y * r.y;
         var b = dA.x * dB.x + dA.y * dB.y;
         var denom = a * e - b * b;
         s = 0.0;
         if (denom != 0.0) {
            s = b2Math.Clamp((b * f - c * e) / denom, 0.0, 1.0);
         }
         var t = (b * s + f) / e;
         if (t < 0.0) {
            t = 0.0;
            s = b2Math.Clamp((b - c) / a, 0.0, 1.0);
         }
         localPointA = new b2Vec2();
         localPointA.x = localPointA1.x + s * (localPointA2.x - localPointA1.x);
         localPointA.y = localPointA1.y + s * (localPointA2.y - localPointA1.y);
         localPointB = new b2Vec2();
         localPointB.x = localPointB1.x + s * (localPointB2.x - localPointB1.x);
         localPointB.y = localPointB1.y + s * (localPointB2.y - localPointB1.y);
         if (s == 0.0 || s == 1.0) {
            this.m_type = b2SeparationFunction.e_faceB;
            this.m_axis = b2Math.CrossVF(b2Math.SubtractVV(localPointB2, localPointB1), 1.0);
            this.m_axis.Normalize();
            this.m_localPoint = localPointB;
            tVec = this.m_axis;
            tMat = transformB.R;
            normalX = tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
            normalY = tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
            tVec = this.m_localPoint;
            tMat = transformB.R;
            pointBX = transformB.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
            pointBY = transformB.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
            tVec = localPointA;
            tMat = transformA.R;
            pointAX = transformA.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
            pointAY = transformA.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
            sgn = (pointAX - pointBX) * normalX + (pointAY - pointBY) * normalY;
            if (s < 0.0) {
               this.m_axis.NegativeSelf();
            }
         }
         else {
            this.m_type = b2SeparationFunction.e_faceA;
            this.m_axis = b2Math.CrossVF(b2Math.SubtractVV(localPointA2, localPointA1), 1.0);
            this.m_localPoint = localPointA;
            tVec = this.m_axis;
            tMat = transformA.R;
            normalX = tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
            normalY = tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
            tVec = this.m_localPoint;
            tMat = transformA.R;
            pointAX = transformA.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
            pointAY = transformA.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
            tVec = localPointB;
            tMat = transformB.R;
            pointBX = transformB.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
            pointBY = transformB.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
            sgn = (pointBX - pointAX) * normalX + (pointBY - pointAY) * normalY;
            if (s < 0.0) {
               this.m_axis.NegativeSelf();
            }
         }
      }
   }
   b2SeparationFunction.prototype.Evaluate = function (transformA, transformB) {
      var axisA;
      var axisB;
      var localPointA;
      var localPointB;
      var pointA;
      var pointB;
      var seperation = 0;
      var normal;
      switch (this.m_type) {
      case b2SeparationFunction.e_points:
         {
            axisA = b2Math.MulTMV(transformA.R, this.m_axis);
            axisB = b2Math.MulTMV(transformB.R, this.m_axis.GetNegative());
            localPointA = this.m_proxyA.GetSupportVertex(axisA);
            localPointB = this.m_proxyB.GetSupportVertex(axisB);
            pointA = b2Math.MulX(transformA, localPointA);
            pointB = b2Math.MulX(transformB, localPointB);
            seperation = (pointB.x - pointA.x) * this.m_axis.x + (pointB.y - pointA.y) * this.m_axis.y;
            return seperation;
         }
      case b2SeparationFunction.e_faceA:
         {
            normal = b2Math.MulMV(transformA.R, this.m_axis);
            pointA = b2Math.MulX(transformA, this.m_localPoint);
            axisB = b2Math.MulTMV(transformB.R, normal.GetNegative());
            localPointB = this.m_proxyB.GetSupportVertex(axisB);
            pointB = b2Math.MulX(transformB, localPointB);
            seperation = (pointB.x - pointA.x) * normal.x + (pointB.y - pointA.y) * normal.y;
            return seperation;
         }
      case b2SeparationFunction.e_faceB:
         {
            normal = b2Math.MulMV(transformB.R, this.m_axis);
            pointB = b2Math.MulX(transformB, this.m_localPoint);
            axisA = b2Math.MulTMV(transformA.R, normal.GetNegative());
            localPointA = this.m_proxyA.GetSupportVertex(axisA);
            pointA = b2Math.MulX(transformA, localPointA);
            seperation = (pointA.x - pointB.x) * normal.x + (pointA.y - pointB.y) * normal.y;
            return seperation;
         }
      default:
         b2Settings.b2Assert(false);
         return 0.0;
      }
   }
   Box2D.postDefs.push(function () {
      Box2D.Collision.b2SeparationFunction.e_points = 0x01;
      Box2D.Collision.b2SeparationFunction.e_faceA = 0x02;
      Box2D.Collision.b2SeparationFunction.e_faceB = 0x04;
   });
   b2Simplex.b2Simplex = function () {
      this.m_v1 = new b2SimplexVertex();
      this.m_v2 = new b2SimplexVertex();
      this.m_v3 = new b2SimplexVertex();
      this.m_vertices = new Vector(3);
   };
   b2Simplex.prototype.b2Simplex = function () {
      this.m_vertices[0] = this.m_v1;
      this.m_vertices[1] = this.m_v2;
      this.m_vertices[2] = this.m_v3;
   }
   b2Simplex.prototype.ReadCache = function (cache, proxyA, transformA, proxyB, transformB) {
      b2Settings.b2Assert(0 <= cache.count && cache.count <= 3);
      var wALocal;
      var wBLocal;
      this.m_count = cache.count;
      var vertices = this.m_vertices;
      for (var i = 0; i < this.m_count; i++) {
         var v = vertices[i];
         v.indexA = cache.indexA[i];
         v.indexB = cache.indexB[i];
         wALocal = proxyA.GetVertex(v.indexA);
         wBLocal = proxyB.GetVertex(v.indexB);
         v.wA = b2Math.MulX(transformA, wALocal);
         v.wB = b2Math.MulX(transformB, wBLocal);
         v.w = b2Math.SubtractVV(v.wB, v.wA);
         v.a = 0;
      }
      if (this.m_count > 1) {
         var metric1 = cache.metric;
         var metric2 = this.GetMetric();
         if (metric2 < .5 * metric1 || 2.0 * metric1 < metric2 || metric2 < Number.MIN_VALUE) {
            this.m_count = 0;
         }
      }
      if (this.m_count == 0) {
         v = vertices[0];
         v.indexA = 0;
         v.indexB = 0;
         wALocal = proxyA.GetVertex(0);
         wBLocal = proxyB.GetVertex(0);
         v.wA = b2Math.MulX(transformA, wALocal);
         v.wB = b2Math.MulX(transformB, wBLocal);
         v.w = b2Math.SubtractVV(v.wB, v.wA);
         this.m_count = 1;
      }
   }
   b2Simplex.prototype.WriteCache = function (cache) {
      cache.metric = this.GetMetric();
      cache.count = Box2D.parseUInt(this.m_count);
      var vertices = this.m_vertices;
      for (var i = 0; i < this.m_count; i++) {
         cache.indexA[i] = Box2D.parseUInt(vertices[i].indexA);
         cache.indexB[i] = Box2D.parseUInt(vertices[i].indexB);
      }
   }
   b2Simplex.prototype.GetSearchDirection = function () {
      switch (this.m_count) {
      case 1:
         return this.m_v1.w.GetNegative();
      case 2:
         {
            var e12 = b2Math.SubtractVV(this.m_v2.w, this.m_v1.w);
            var sgn = b2Math.CrossVV(e12, this.m_v1.w.GetNegative());
            if (sgn > 0.0) {
               return b2Math.CrossFV(1.0, e12);
            }
            else {
               return b2Math.CrossVF(e12, 1.0);
            }
         }
      default:
         b2Settings.b2Assert(false);
         return new b2Vec2();
      }
   }
   b2Simplex.prototype.GetClosestPoint = function () {
      switch (this.m_count) {
      case 0:
         b2Settings.b2Assert(false);
         return new b2Vec2();
      case 1:
         return this.m_v1.w;
      case 2:
         return new b2Vec2(this.m_v1.a * this.m_v1.w.x + this.m_v2.a * this.m_v2.w.x, this.m_v1.a * this.m_v1.w.y + this.m_v2.a * this.m_v2.w.y);
      default:
         b2Settings.b2Assert(false);
         return new b2Vec2();
      }
   }
   b2Simplex.prototype.GetWitnessPoints = function (pA, pB) {
      switch (this.m_count) {
      case 0:
         b2Settings.b2Assert(false);
         break;
      case 1:
         pA.SetV(this.m_v1.wA);
         pB.SetV(this.m_v1.wB);
         break;
      case 2:
         pA.x = this.m_v1.a * this.m_v1.wA.x + this.m_v2.a * this.m_v2.wA.x;
         pA.y = this.m_v1.a * this.m_v1.wA.y + this.m_v2.a * this.m_v2.wA.y;
         pB.x = this.m_v1.a * this.m_v1.wB.x + this.m_v2.a * this.m_v2.wB.x;
         pB.y = this.m_v1.a * this.m_v1.wB.y + this.m_v2.a * this.m_v2.wB.y;
         break;
      case 3:
         pB.x = pA.x = this.m_v1.a * this.m_v1.wA.x + this.m_v2.a * this.m_v2.wA.x + this.m_v3.a * this.m_v3.wA.x;
         pB.y = pA.y = this.m_v1.a * this.m_v1.wA.y + this.m_v2.a * this.m_v2.wA.y + this.m_v3.a * this.m_v3.wA.y;
         break;
      default:
         b2Settings.b2Assert(false);
         break;
      }
   }
   b2Simplex.prototype.GetMetric = function () {
      switch (this.m_count) {
      case 0:
         b2Settings.b2Assert(false);
         return 0.0;
      case 1:
         return 0.0;
      case 2:
         return b2Math.SubtractVV(this.m_v1.w, this.m_v2.w).Length();
      case 3:
         return b2Math.CrossVV(b2Math.SubtractVV(this.m_v2.w, this.m_v1.w), b2Math.SubtractVV(this.m_v3.w, this.m_v1.w));
      default:
         b2Settings.b2Assert(false);
         return 0.0;
      }
   }
   b2Simplex.prototype.Solve2 = function () {
      var w1 = this.m_v1.w;
      var w2 = this.m_v2.w;
      var e12 = b2Math.SubtractVV(w2, w1);
      var d12_2 = (-(w1.x * e12.x + w1.y * e12.y));
      if (d12_2 <= 0.0) {
         this.m_v1.a = 1.0;
         this.m_count = 1;
         return;
      }
      var d12_1 = (w2.x * e12.x + w2.y * e12.y);
      if (d12_1 <= 0.0) {
         this.m_v2.a = 1.0;
         this.m_count = 1;
         this.m_v1.Set(this.m_v2);
         return;
      }
      var inv_d12 = 1.0 / (d12_1 + d12_2);
      this.m_v1.a = d12_1 * inv_d12;
      this.m_v2.a = d12_2 * inv_d12;
      this.m_count = 2;
   }
   b2Simplex.prototype.Solve3 = function () {
      var w1 = this.m_v1.w;
      var w2 = this.m_v2.w;
      var w3 = this.m_v3.w;
      var e12 = b2Math.SubtractVV(w2, w1);
      var w1e12 = b2Math.Dot(w1, e12);
      var w2e12 = b2Math.Dot(w2, e12);
      var d12_1 = w2e12;
      var d12_2 = (-w1e12);
      var e13 = b2Math.SubtractVV(w3, w1);
      var w1e13 = b2Math.Dot(w1, e13);
      var w3e13 = b2Math.Dot(w3, e13);
      var d13_1 = w3e13;
      var d13_2 = (-w1e13);
      var e23 = b2Math.SubtractVV(w3, w2);
      var w2e23 = b2Math.Dot(w2, e23);
      var w3e23 = b2Math.Dot(w3, e23);
      var d23_1 = w3e23;
      var d23_2 = (-w2e23);
      var n123 = b2Math.CrossVV(e12, e13);
      var d123_1 = n123 * b2Math.CrossVV(w2, w3);
      var d123_2 = n123 * b2Math.CrossVV(w3, w1);
      var d123_3 = n123 * b2Math.CrossVV(w1, w2);
      if (d12_2 <= 0.0 && d13_2 <= 0.0) {
         this.m_v1.a = 1.0;
         this.m_count = 1;
         return;
      }
      if (d12_1 > 0.0 && d12_2 > 0.0 && d123_3 <= 0.0) {
         var inv_d12 = 1.0 / (d12_1 + d12_2);
         this.m_v1.a = d12_1 * inv_d12;
         this.m_v2.a = d12_2 * inv_d12;
         this.m_count = 2;
         return;
      }
      if (d13_1 > 0.0 && d13_2 > 0.0 && d123_2 <= 0.0) {
         var inv_d13 = 1.0 / (d13_1 + d13_2);
         this.m_v1.a = d13_1 * inv_d13;
         this.m_v3.a = d13_2 * inv_d13;
         this.m_count = 2;
         this.m_v2.Set(this.m_v3);
         return;
      }
      if (d12_1 <= 0.0 && d23_2 <= 0.0) {
         this.m_v2.a = 1.0;
         this.m_count = 1;
         this.m_v1.Set(this.m_v2);
         return;
      }
      if (d13_1 <= 0.0 && d23_1 <= 0.0) {
         this.m_v3.a = 1.0;
         this.m_count = 1;
         this.m_v1.Set(this.m_v3);
         return;
      }
      if (d23_1 > 0.0 && d23_2 > 0.0 && d123_1 <= 0.0) {
         var inv_d23 = 1.0 / (d23_1 + d23_2);
         this.m_v2.a = d23_1 * inv_d23;
         this.m_v3.a = d23_2 * inv_d23;
         this.m_count = 2;
         this.m_v1.Set(this.m_v3);
         return;
      }
      var inv_d123 = 1.0 / (d123_1 + d123_2 + d123_3);
      this.m_v1.a = d123_1 * inv_d123;
      this.m_v2.a = d123_2 * inv_d123;
      this.m_v3.a = d123_3 * inv_d123;
      this.m_count = 3;
   }
   b2SimplexCache.b2SimplexCache = function () {
      this.indexA = new Vector_a2j_Number(3);
      this.indexB = new Vector_a2j_Number(3);
   };
   b2SimplexVertex.b2SimplexVertex = function () {};
   b2SimplexVertex.prototype.Set = function (other) {
      this.wA.SetV(other.wA);
      this.wB.SetV(other.wB);
      this.w.SetV(other.w);
      this.a = other.a;
      this.indexA = other.indexA;
      this.indexB = other.indexB;
   }
   b2TimeOfImpact.b2TimeOfImpact = function () {};
   b2TimeOfImpact.TimeOfImpact = function (input) {
      ++b2TimeOfImpact.b2_toiCalls;
      var proxyA = input.proxyA;
      var proxyB = input.proxyB;
      var sweepA = input.sweepA;
      var sweepB = input.sweepB;
      b2Settings.b2Assert(sweepA.t0 == sweepB.t0);
      b2Settings.b2Assert(1.0 - sweepA.t0 > Number.MIN_VALUE);
      var radius = proxyA.m_radius + proxyB.m_radius;
      var tolerance = input.tolerance;
      var alpha = 0.0;
      var k_maxIterations = 1000;
      var iter = 0;
      var target = 0.0;
      b2TimeOfImpact.s_cache.count = 0;
      b2TimeOfImpact.s_distanceInput.useRadii = false;
      for (;;) {
         sweepA.GetTransform(b2TimeOfImpact.s_xfA, alpha);
         sweepB.GetTransform(b2TimeOfImpact.s_xfB, alpha);
         b2TimeOfImpact.s_distanceInput.proxyA = proxyA;
         b2TimeOfImpact.s_distanceInput.proxyB = proxyB;
         b2TimeOfImpact.s_distanceInput.transformA = b2TimeOfImpact.s_xfA;
         b2TimeOfImpact.s_distanceInput.transformB = b2TimeOfImpact.s_xfB;
         b2Distance.Distance(b2TimeOfImpact.s_distanceOutput, b2TimeOfImpact.s_cache, b2TimeOfImpact.s_distanceInput);
         if (b2TimeOfImpact.s_distanceOutput.distance <= 0.0) {
            alpha = 1.0;
            break;
         }
         b2TimeOfImpact.s_fcn.Initialize(b2TimeOfImpact.s_cache, proxyA, b2TimeOfImpact.s_xfA, proxyB, b2TimeOfImpact.s_xfB);
         var separation = b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA, b2TimeOfImpact.s_xfB);
         if (separation <= 0.0) {
            alpha = 1.0;
            break;
         }
         if (iter == 0) {
            if (separation > radius) {
               target = b2Math.Max(radius - tolerance, 0.75 * radius);
            }
            else {
               target = b2Math.Max(separation - tolerance, 0.02 * radius);
            }
         }
         if (separation - target < 0.5 * tolerance) {
            if (iter == 0) {
               alpha = 1.0;
               break;
            }
            break;
         }
         var newAlpha = alpha; {
            var x1 = alpha;
            var x2 = 1.0;
            var f1 = separation;
            sweepA.GetTransform(b2TimeOfImpact.s_xfA, x2);
            sweepB.GetTransform(b2TimeOfImpact.s_xfB, x2);
            var f2 = b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA, b2TimeOfImpact.s_xfB);
            if (f2 >= target) {
               alpha = 1.0;
               break;
            }
            var rootIterCount = 0;
            for (;;) {
               var x = 0;
               if (rootIterCount & 1) {
                  x = x1 + (target - f1) * (x2 - x1) / (f2 - f1);
               }
               else {
                  x = 0.5 * (x1 + x2);
               }
               sweepA.GetTransform(b2TimeOfImpact.s_xfA, x);
               sweepB.GetTransform(b2TimeOfImpact.s_xfB, x);
               var f = b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA, b2TimeOfImpact.s_xfB);
               if (b2Math.Abs(f - target) < 0.025 * tolerance) {
                  newAlpha = x;
                  break;
               }
               if (f > target) {
                  x1 = x;
                  f1 = f;
               }
               else {
                  x2 = x;
                  f2 = f;
               }++rootIterCount;
               ++b2TimeOfImpact.b2_toiRootIters;
               if (rootIterCount == 50) {
                  break;
               }
            }
            b2TimeOfImpact.b2_toiMaxRootIters = b2Math.Max(b2TimeOfImpact.b2_toiMaxRootIters, rootIterCount);
         }
         if (newAlpha < (1.0 + 100.0 * Number.MIN_VALUE) * alpha) {
            break;
         }
         alpha = newAlpha;
         iter++;
         ++b2TimeOfImpact.b2_toiIters;
         if (iter == k_maxIterations) {
            break;
         }
      }
      b2TimeOfImpact.b2_toiMaxIters = b2Math.Max(b2TimeOfImpact.b2_toiMaxIters, iter);
      return alpha;
   }
   Box2D.postDefs.push(function () {
      Box2D.Collision.b2TimeOfImpact.b2_toiCalls = 0;
      Box2D.Collision.b2TimeOfImpact.b2_toiIters = 0;
      Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters = 0;
      Box2D.Collision.b2TimeOfImpact.b2_toiRootIters = 0;
      Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters = 0;
      Box2D.Collision.b2TimeOfImpact.s_cache = new b2SimplexCache();
      Box2D.Collision.b2TimeOfImpact.s_distanceInput = new b2DistanceInput();
      Box2D.Collision.b2TimeOfImpact.s_xfA = new b2Transform();
      Box2D.Collision.b2TimeOfImpact.s_xfB = new b2Transform();
      Box2D.Collision.b2TimeOfImpact.s_fcn = new b2SeparationFunction();
      Box2D.Collision.b2TimeOfImpact.s_distanceOutput = new b2DistanceOutput();
   });
   b2TOIInput.b2TOIInput = function () {
      this.proxyA = new b2DistanceProxy();
      this.proxyB = new b2DistanceProxy();
      this.sweepA = new b2Sweep();
      this.sweepB = new b2Sweep();
   };
   b2WorldManifold.b2WorldManifold = function () {
      this.m_normal = new b2Vec2();
   };
   b2WorldManifold.prototype.b2WorldManifold = function () {
      this.m_points = new Vector(b2Settings.b2_maxManifoldPoints);
      for (var i = 0; i < b2Settings.b2_maxManifoldPoints; i++) {
         this.m_points[i] = new b2Vec2();
      }
   }
   b2WorldManifold.prototype.Initialize = function (manifold, xfA, radiusA, xfB, radiusB) {
      if (radiusA === undefined) radiusA = 0;
      if (radiusB === undefined) radiusB = 0;
      if (manifold.m_pointCount == 0) {
         return;
      }
      var i = 0;
      var tVec;
      var tMat;
      var normalX = 0;
      var normalY = 0;
      var planePointX = 0;
      var planePointY = 0;
      var clipPointX = 0;
      var clipPointY = 0;
      switch (manifold.m_type) {
      case b2Manifold.e_circles:
         {
            tMat = xfA.R;
            tVec = manifold.m_localPoint;
            var pointAX = xfA.position.x + tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
            var pointAY = xfA.position.y + tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
            tMat = xfB.R;
            tVec = manifold.m_points[0].m_localPoint;
            var pointBX = xfB.position.x + tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
            var pointBY = xfB.position.y + tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
            var dX = pointBX - pointAX;
            var dY = pointBY - pointAY;
            var d2 = dX * dX + dY * dY;
            if (d2 > Number.MIN_VALUE * Number.MIN_VALUE) {
               var d = Math.sqrt(d2);
               this.m_normal.x = dX / d;
               this.m_normal.y = dY / d;
            }
            else {
               this.m_normal.x = 1;
               this.m_normal.y = 0;
            }
            var cAX = pointAX + radiusA * this.m_normal.x;
            var cAY = pointAY + radiusA * this.m_normal.y;
            var cBX = pointBX - radiusB * this.m_normal.x;
            var cBY = pointBY - radiusB * this.m_normal.y;
            this.m_points[0].x = 0.5 * (cAX + cBX);
            this.m_points[0].y = 0.5 * (cAY + cBY);
         }
         break;
      case b2Manifold.e_faceA:
         {
            tMat = xfA.R;
            tVec = manifold.m_localPlaneNormal;
            normalX = tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
            normalY = tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
            tMat = xfA.R;
            tVec = manifold.m_localPoint;
            planePointX = xfA.position.x + tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
            planePointY = xfA.position.y + tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
            this.m_normal.x = normalX;
            this.m_normal.y = normalY;
            for (i = 0;
            i < manifold.m_pointCount; i++) {
               tMat = xfB.R;
               tVec = manifold.m_points[i].m_localPoint;
               clipPointX = xfB.position.x + tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
               clipPointY = xfB.position.y + tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
               this.m_points[i].x = clipPointX + 0.5 * (radiusA - (clipPointX - planePointX) * normalX - (clipPointY - planePointY) * normalY - radiusB) * normalX;
               this.m_points[i].y = clipPointY + 0.5 * (radiusA - (clipPointX - planePointX) * normalX - (clipPointY - planePointY) * normalY - radiusB) * normalY;
            }
         }
         break;
      case b2Manifold.e_faceB:
         {
            tMat = xfB.R;
            tVec = manifold.m_localPlaneNormal;
            normalX = tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
            normalY = tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
            tMat = xfB.R;
            tVec = manifold.m_localPoint;
            planePointX = xfB.position.x + tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
            planePointY = xfB.position.y + tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
            this.m_normal.x = (-normalX);
            this.m_normal.y = (-normalY);
            for (i = 0;
            i < manifold.m_pointCount; i++) {
               tMat = xfA.R;
               tVec = manifold.m_points[i].m_localPoint;
               clipPointX = xfA.position.x + tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
               clipPointY = xfA.position.y + tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
               this.m_points[i].x = clipPointX + 0.5 * (radiusB - (clipPointX - planePointX) * normalX - (clipPointY - planePointY) * normalY - radiusA) * normalX;
               this.m_points[i].y = clipPointY + 0.5 * (radiusB - (clipPointX - planePointX) * normalX - (clipPointY - planePointY) * normalY - radiusA) * normalY;
            }
         }
         break;
      }
   }
   ClipVertex.ClipVertex = function () {
      this.v = new b2Vec2();
      this.id = new b2ContactID();
   };
   ClipVertex.prototype.Set = function (other) {
      this.v.SetV(other.v);
      this.id.Set(other.id);
   }
   Features.Features = function () {};
   Object.defineProperty(Features.prototype, 'referenceEdge', {
      enumerable: false,
      configurable: true,
      get: function () {
         return this._referenceEdge;
      }
   });
   Object.defineProperty(Features.prototype, 'referenceEdge', {
      enumerable: false,
      configurable: true,
      set: function (value) {
         if (value === undefined) value = 0;
         this._referenceEdge = value;
         this._m_id._key = (this._m_id._key & 0xffffff00) | (this._referenceEdge & 0x000000ff);
      }
   });
   Object.defineProperty(Features.prototype, 'incidentEdge', {
      enumerable: false,
      configurable: true,
      get: function () {
         return this._incidentEdge;
      }
   });
   Object.defineProperty(Features.prototype, 'incidentEdge', {
      enumerable: false,
      configurable: true,
      set: function (value) {
         if (value === undefined) value = 0;
         this._incidentEdge = value;
         this._m_id._key = (this._m_id._key & 0xffff00ff) | ((this._incidentEdge << 8) & 0x0000ff00);
      }
   });
   Object.defineProperty(Features.prototype, 'incidentVertex', {
      enumerable: false,
      configurable: true,
      get: function () {
         return this._incidentVertex;
      }
   });
   Object.defineProperty(Features.prototype, 'incidentVertex', {
      enumerable: false,
      configurable: true,
      set: function (value) {
         if (value === undefined) value = 0;
         this._incidentVertex = value;
         this._m_id._key = (this._m_id._key & 0xff00ffff) | ((this._incidentVertex << 16) & 0x00ff0000);
      }
   });
   Object.defineProperty(Features.prototype, 'flip', {
      enumerable: false,
      configurable: true,
      get: function () {
         return this._flip;
      }
   });
   Object.defineProperty(Features.prototype, 'flip', {
      enumerable: false,
      configurable: true,
      set: function (value) {
         if (value === undefined) value = 0;
         this._flip = value;
         this._m_id._key = (this._m_id._key & 0x00ffffff) | ((this._flip << 24) & 0xff000000);
      }
   });
})();
(function () {
   var b2Color = Box2D.Common.b2Color,
      b2internal = Box2D.Common.b2internal,
      b2Settings = Box2D.Common.b2Settings,
      b2CircleShape = Box2D.Collision.Shapes.b2CircleShape,
      b2EdgeChainDef = Box2D.Collision.Shapes.b2EdgeChainDef,
      b2EdgeShape = Box2D.Collision.Shapes.b2EdgeShape,
      b2MassData = Box2D.Collision.Shapes.b2MassData,
      b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape,
      b2Shape = Box2D.Collision.Shapes.b2Shape,
      b2Mat22 = Box2D.Common.Math.b2Mat22,
      b2Mat33 = Box2D.Common.Math.b2Mat33,
      b2Math = Box2D.Common.Math.b2Math,
      b2Sweep = Box2D.Common.Math.b2Sweep,
      b2Transform = Box2D.Common.Math.b2Transform,
      b2Vec2 = Box2D.Common.Math.b2Vec2,
      b2Vec3 = Box2D.Common.Math.b2Vec3,
      b2Body = Box2D.Dynamics.b2Body,
      b2BodyDef = Box2D.Dynamics.b2BodyDef,
      b2ContactFilter = Box2D.Dynamics.b2ContactFilter,
      b2ContactImpulse = Box2D.Dynamics.b2ContactImpulse,
      b2ContactListener = Box2D.Dynamics.b2ContactListener,
      b2ContactManager = Box2D.Dynamics.b2ContactManager,
      b2DebugDraw = Box2D.Dynamics.b2DebugDraw,
      b2DestructionListener = Box2D.Dynamics.b2DestructionListener,
      b2FilterData = Box2D.Dynamics.b2FilterData,
      b2Fixture = Box2D.Dynamics.b2Fixture,
      b2FixtureDef = Box2D.Dynamics.b2FixtureDef,
      b2Island = Box2D.Dynamics.b2Island,
      b2TimeStep = Box2D.Dynamics.b2TimeStep,
      b2World = Box2D.Dynamics.b2World,
      b2AABB = Box2D.Collision.b2AABB,
      b2Bound = Box2D.Collision.b2Bound,
      b2BoundValues = Box2D.Collision.b2BoundValues,
      b2Collision = Box2D.Collision.b2Collision,
      b2ContactID = Box2D.Collision.b2ContactID,
      b2ContactPoint = Box2D.Collision.b2ContactPoint,
      b2Distance = Box2D.Collision.b2Distance,
      b2DistanceInput = Box2D.Collision.b2DistanceInput,
      b2DistanceOutput = Box2D.Collision.b2DistanceOutput,
      b2DistanceProxy = Box2D.Collision.b2DistanceProxy,
      b2DynamicTree = Box2D.Collision.b2DynamicTree,
      b2DynamicTreeBroadPhase = Box2D.Collision.b2DynamicTreeBroadPhase,
      b2DynamicTreeNode = Box2D.Collision.b2DynamicTreeNode,
      b2DynamicTreePair = Box2D.Collision.b2DynamicTreePair,
      b2Manifold = Box2D.Collision.b2Manifold,
      b2ManifoldPoint = Box2D.Collision.b2ManifoldPoint,
      b2Point = Box2D.Collision.b2Point,
      b2RayCastInput = Box2D.Collision.b2RayCastInput,
      b2RayCastOutput = Box2D.Collision.b2RayCastOutput,
      b2Segment = Box2D.Collision.b2Segment,
      b2SeparationFunction = Box2D.Collision.b2SeparationFunction,
      b2Simplex = Box2D.Collision.b2Simplex,
      b2SimplexCache = Box2D.Collision.b2SimplexCache,
      b2SimplexVertex = Box2D.Collision.b2SimplexVertex,
      b2TimeOfImpact = Box2D.Collision.b2TimeOfImpact,
      b2TOIInput = Box2D.Collision.b2TOIInput,
      b2WorldManifold = Box2D.Collision.b2WorldManifold,
      ClipVertex = Box2D.Collision.ClipVertex,
      Features = Box2D.Collision.Features,
      IBroadPhase = Box2D.Collision.IBroadPhase;

   Box2D.inherit(b2CircleShape, Box2D.Collision.Shapes.b2Shape);
   b2CircleShape.prototype.__super = Box2D.Collision.Shapes.b2Shape.prototype;
   b2CircleShape.b2CircleShape = function () {
      Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this, arguments);
      this.m_p = new b2Vec2();
   };
   b2CircleShape.prototype.Copy = function () {
      var s = new b2CircleShape();
      s.Set(this);
      return s;
   }
   b2CircleShape.prototype.Set = function (other) {
      this.__super.Set.call(this, other);
      if (Box2D.is(other, b2CircleShape)) {
         var other2 = (other instanceof b2CircleShape ? other : null);
         this.m_p.SetV(other2.m_p);
      }
   }
   b2CircleShape.prototype.TestPoint = function (transform, p) {
      var tMat = transform.R;
      var dX = transform.position.x + (tMat.col1.x * this.m_p.x + tMat.col2.x * this.m_p.y);
      var dY = transform.position.y + (tMat.col1.y * this.m_p.x + tMat.col2.y * this.m_p.y);
      dX = p.x - dX;
      dY = p.y - dY;
      return (dX * dX + dY * dY) <= this.m_radius * this.m_radius;
   }
   b2CircleShape.prototype.RayCast = function (output, input, transform) {
      var tMat = transform.R;
      var positionX = transform.position.x + (tMat.col1.x * this.m_p.x + tMat.col2.x * this.m_p.y);
      var positionY = transform.position.y + (tMat.col1.y * this.m_p.x + tMat.col2.y * this.m_p.y);
      var sX = input.p1.x - positionX;
      var sY = input.p1.y - positionY;
      var b = (sX * sX + sY * sY) - this.m_radius * this.m_radius;
      var rX = input.p2.x - input.p1.x;
      var rY = input.p2.y - input.p1.y;
      var c = (sX * rX + sY * rY);
      var rr = (rX * rX + rY * rY);
      var sigma = c * c - rr * b;
      if (sigma < 0.0 || rr < Number.MIN_VALUE) {
         return false;
      }
      var a = (-(c + Math.sqrt(sigma)));
      if (0.0 <= a && a <= input.maxFraction * rr) {
         a /= rr;
         output.fraction = a;
         output.normal.x = sX + a * rX;
         output.normal.y = sY + a * rY;
         output.normal.Normalize();
         return true;
      }
      return false;
   }
   b2CircleShape.prototype.ComputeAABB = function (aabb, transform) {
      var tMat = transform.R;
      var pX = transform.position.x + (tMat.col1.x * this.m_p.x + tMat.col2.x * this.m_p.y);
      var pY = transform.position.y + (tMat.col1.y * this.m_p.x + tMat.col2.y * this.m_p.y);
      aabb.lowerBound.Set(pX - this.m_radius, pY - this.m_radius);
      aabb.upperBound.Set(pX + this.m_radius, pY + this.m_radius);
   }
   b2CircleShape.prototype.ComputeMass = function (massData, density) {
      if (density === undefined) density = 0;
      massData.mass = density * b2Settings.b2_pi * this.m_radius * this.m_radius;
      massData.center.SetV(this.m_p);
      massData.I = massData.mass * (0.5 * this.m_radius * this.m_radius + (this.m_p.x * this.m_p.x + this.m_p.y * this.m_p.y));
   }
   b2CircleShape.prototype.ComputeSubmergedArea = function (normal, offset, xf, c) {
      if (offset === undefined) offset = 0;
      var p = b2Math.MulX(xf, this.m_p);
      var l = (-(b2Math.Dot(normal, p) - offset));
      if (l < (-this.m_radius) + Number.MIN_VALUE) {
         return 0;
      }
      if (l > this.m_radius) {
         c.SetV(p);
         return Math.PI * this.m_radius * this.m_radius;
      }
      var r2 = this.m_radius * this.m_radius;
      var l2 = l * l;
      var area = r2 * (Math.asin(l / this.m_radius) + Math.PI / 2) + l * Math.sqrt(r2 - l2);
      var com = (-2 / 3 * Math.pow(r2 - l2, 1.5) / area);
      c.x = p.x + normal.x * com;
      c.y = p.y + normal.y * com;
      return area;
   }
   b2CircleShape.prototype.GetLocalPosition = function () {
      return this.m_p;
   }
   b2CircleShape.prototype.SetLocalPosition = function (position) {
      this.m_p.SetV(position);
   }
   b2CircleShape.prototype.GetRadius = function () {
      return this.m_radius;
   }
   b2CircleShape.prototype.SetRadius = function (radius) {
      if (radius === undefined) radius = 0;
      this.m_radius = radius;
   }
   b2CircleShape.prototype.b2CircleShape = function (radius) {
      if (radius === undefined) radius = 0;
      this.__super.b2Shape.call(this);
      this.m_type = b2Shape.e_circleShape;
      this.m_radius = radius;
   }
   b2EdgeChainDef.b2EdgeChainDef = function () {};
   b2EdgeChainDef.prototype.b2EdgeChainDef = function () {
      this.vertexCount = 0;
      this.isALoop = true;
      this.vertices = [];
   }
   Box2D.inherit(b2EdgeShape, Box2D.Collision.Shapes.b2Shape);
   b2EdgeShape.prototype.__super = Box2D.Collision.Shapes.b2Shape.prototype;
   b2EdgeShape.b2EdgeShape = function () {
      Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this, arguments);
      this.s_supportVec = new b2Vec2();
      this.m_v1 = new b2Vec2();
      this.m_v2 = new b2Vec2();
      this.m_coreV1 = new b2Vec2();
      this.m_coreV2 = new b2Vec2();
      this.m_normal = new b2Vec2();
      this.m_direction = new b2Vec2();
      this.m_cornerDir1 = new b2Vec2();
      this.m_cornerDir2 = new b2Vec2();
   };
   b2EdgeShape.prototype.TestPoint = function (transform, p) {
      return false;
   }
   b2EdgeShape.prototype.RayCast = function (output, input, transform) {
      var tMat;
      var rX = input.p2.x - input.p1.x;
      var rY = input.p2.y - input.p1.y;
      tMat = transform.R;
      var v1X = transform.position.x + (tMat.col1.x * this.m_v1.x + tMat.col2.x * this.m_v1.y);
      var v1Y = transform.position.y + (tMat.col1.y * this.m_v1.x + tMat.col2.y * this.m_v1.y);
      var nX = transform.position.y + (tMat.col1.y * this.m_v2.x + tMat.col2.y * this.m_v2.y) - v1Y;
      var nY = (-(transform.position.x + (tMat.col1.x * this.m_v2.x + tMat.col2.x * this.m_v2.y) - v1X));
      var k_slop = 100.0 * Number.MIN_VALUE;
      var denom = (-(rX * nX + rY * nY));
      if (denom > k_slop) {
         var bX = input.p1.x - v1X;
         var bY = input.p1.y - v1Y;
         var a = (bX * nX + bY * nY);
         if (0.0 <= a && a <= input.maxFraction * denom) {
            var mu2 = (-rX * bY) + rY * bX;
            if ((-k_slop * denom) <= mu2 && mu2 <= denom * (1.0 + k_slop)) {
               a /= denom;
               output.fraction = a;
               var nLen = Math.sqrt(nX * nX + nY * nY);
               output.normal.x = nX / nLen;
               output.normal.y = nY / nLen;
               return true;
            }
         }
      }
      return false;
   }
   b2EdgeShape.prototype.ComputeAABB = function (aabb, transform) {
      var tMat = transform.R;
      var v1X = transform.position.x + (tMat.col1.x * this.m_v1.x + tMat.col2.x * this.m_v1.y);
      var v1Y = transform.position.y + (tMat.col1.y * this.m_v1.x + tMat.col2.y * this.m_v1.y);
      var v2X = transform.position.x + (tMat.col1.x * this.m_v2.x + tMat.col2.x * this.m_v2.y);
      var v2Y = transform.position.y + (tMat.col1.y * this.m_v2.x + tMat.col2.y * this.m_v2.y);
      if (v1X < v2X) {
         aabb.lowerBound.x = v1X;
         aabb.upperBound.x = v2X;
      }
      else {
         aabb.lowerBound.x = v2X;
         aabb.upperBound.x = v1X;
      }
      if (v1Y < v2Y) {
         aabb.lowerBound.y = v1Y;
         aabb.upperBound.y = v2Y;
      }
      else {
         aabb.lowerBound.y = v2Y;
         aabb.upperBound.y = v1Y;
      }
   }
   b2EdgeShape.prototype.ComputeMass = function (massData, density) {
      if (density === undefined) density = 0;
      massData.mass = 0;
      massData.center.SetV(this.m_v1);
      massData.I = 0;
   }
   b2EdgeShape.prototype.ComputeSubmergedArea = function (normal, offset, xf, c) {
      if (offset === undefined) offset = 0;
      var v0 = new b2Vec2(normal.x * offset, normal.y * offset);
      var v1 = b2Math.MulX(xf, this.m_v1);
      var v2 = b2Math.MulX(xf, this.m_v2);
      var d1 = b2Math.Dot(normal, v1) - offset;
      var d2 = b2Math.Dot(normal, v2) - offset;
      if (d1 > 0) {
         if (d2 > 0) {
            return 0;
         }
         else {
            v1.x = (-d2 / (d1 - d2) * v1.x) + d1 / (d1 - d2) * v2.x;
            v1.y = (-d2 / (d1 - d2) * v1.y) + d1 / (d1 - d2) * v2.y;
         }
      }
      else {
         if (d2 > 0) {
            v2.x = (-d2 / (d1 - d2) * v1.x) + d1 / (d1 - d2) * v2.x;
            v2.y = (-d2 / (d1 - d2) * v1.y) + d1 / (d1 - d2) * v2.y;
         }
         else {}
      }
      c.x = (v0.x + v1.x + v2.x) / 3;
      c.y = (v0.y + v1.y + v2.y) / 3;
      return 0.5 * ((v1.x - v0.x) * (v2.y - v0.y) - (v1.y - v0.y) * (v2.x - v0.x));
   }
   b2EdgeShape.prototype.GetLength = function () {
      return this.m_length;
   }
   b2EdgeShape.prototype.GetVertex1 = function () {
      return this.m_v1;
   }
   b2EdgeShape.prototype.GetVertex2 = function () {
      return this.m_v2;
   }
   b2EdgeShape.prototype.GetCoreVertex1 = function () {
      return this.m_coreV1;
   }
   b2EdgeShape.prototype.GetCoreVertex2 = function () {
      return this.m_coreV2;
   }
   b2EdgeShape.prototype.GetNormalVector = function () {
      return this.m_normal;
   }
   b2EdgeShape.prototype.GetDirectionVector = function () {
      return this.m_direction;
   }
   b2EdgeShape.prototype.GetCorner1Vector = function () {
      return this.m_cornerDir1;
   }
   b2EdgeShape.prototype.GetCorner2Vector = function () {
      return this.m_cornerDir2;
   }
   b2EdgeShape.prototype.Corner1IsConvex = function () {
      return this.m_cornerConvex1;
   }
   b2EdgeShape.prototype.Corner2IsConvex = function () {
      return this.m_cornerConvex2;
   }
   b2EdgeShape.prototype.GetFirstVertex = function (xf) {
      var tMat = xf.R;
      return new b2Vec2(xf.position.x + (tMat.col1.x * this.m_coreV1.x + tMat.col2.x * this.m_coreV1.y), xf.position.y + (tMat.col1.y * this.m_coreV1.x + tMat.col2.y * this.m_coreV1.y));
   }
   b2EdgeShape.prototype.GetNextEdge = function () {
      return this.m_nextEdge;
   }
   b2EdgeShape.prototype.GetPrevEdge = function () {
      return this.m_prevEdge;
   }
   b2EdgeShape.prototype.Support = function (xf, dX, dY) {
      if (dX === undefined) dX = 0;
      if (dY === undefined) dY = 0;
      var tMat = xf.R;
      var v1X = xf.position.x + (tMat.col1.x * this.m_coreV1.x + tMat.col2.x * this.m_coreV1.y);
      var v1Y = xf.position.y + (tMat.col1.y * this.m_coreV1.x + tMat.col2.y * this.m_coreV1.y);
      var v2X = xf.position.x + (tMat.col1.x * this.m_coreV2.x + tMat.col2.x * this.m_coreV2.y);
      var v2Y = xf.position.y + (tMat.col1.y * this.m_coreV2.x + tMat.col2.y * this.m_coreV2.y);
      if ((v1X * dX + v1Y * dY) > (v2X * dX + v2Y * dY)) {
         this.s_supportVec.x = v1X;
         this.s_supportVec.y = v1Y;
      }
      else {
         this.s_supportVec.x = v2X;
         this.s_supportVec.y = v2Y;
      }
      return this.s_supportVec;
   }
   b2EdgeShape.prototype.b2EdgeShape = function (v1, v2) {
      this.__super.b2Shape.call(this);
      this.m_type = b2Shape.e_edgeShape;
      this.m_prevEdge = null;
      this.m_nextEdge = null;
      this.m_v1 = v1;
      this.m_v2 = v2;
      this.m_direction.Set(this.m_v2.x - this.m_v1.x, this.m_v2.y - this.m_v1.y);
      this.m_length = this.m_direction.Normalize();
      this.m_normal.Set(this.m_direction.y, (-this.m_direction.x));
      this.m_coreV1.Set((-b2Settings.b2_toiSlop * (this.m_normal.x - this.m_direction.x)) + this.m_v1.x, (-b2Settings.b2_toiSlop * (this.m_normal.y - this.m_direction.y)) + this.m_v1.y);
      this.m_coreV2.Set((-b2Settings.b2_toiSlop * (this.m_normal.x + this.m_direction.x)) + this.m_v2.x, (-b2Settings.b2_toiSlop * (this.m_normal.y + this.m_direction.y)) + this.m_v2.y);
      this.m_cornerDir1 = this.m_normal;
      this.m_cornerDir2.Set((-this.m_normal.x), (-this.m_normal.y));
   }
   b2EdgeShape.prototype.SetPrevEdge = function (edge, core, cornerDir, convex) {
      this.m_prevEdge = edge;
      this.m_coreV1 = core;
      this.m_cornerDir1 = cornerDir;
      this.m_cornerConvex1 = convex;
   }
   b2EdgeShape.prototype.SetNextEdge = function (edge, core, cornerDir, convex) {
      this.m_nextEdge = edge;
      this.m_coreV2 = core;
      this.m_cornerDir2 = cornerDir;
      this.m_cornerConvex2 = convex;
   }
   b2MassData.b2MassData = function () {
      this.mass = 0.0;
      this.center = new b2Vec2(0, 0);
      this.I = 0.0;
   };
   Box2D.inherit(b2PolygonShape, Box2D.Collision.Shapes.b2Shape);
   b2PolygonShape.prototype.__super = Box2D.Collision.Shapes.b2Shape.prototype;
   b2PolygonShape.b2PolygonShape = function () {
      Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this, arguments);
   };
   b2PolygonShape.prototype.Copy = function () {
      var s = new b2PolygonShape();
      s.Set(this);
      return s;
   }
   b2PolygonShape.prototype.Set = function (other) {
      this.__super.Set.call(this, other);
      if (Box2D.is(other, b2PolygonShape)) {
         var other2 = (other instanceof b2PolygonShape ? other : null);
         this.m_centroid.SetV(other2.m_centroid);
         this.m_vertexCount = other2.m_vertexCount;
         this.Reserve(this.m_vertexCount);
         for (var i = 0; i < this.m_vertexCount; i++) {
            this.m_vertices[i].SetV(other2.m_vertices[i]);
            this.m_normals[i].SetV(other2.m_normals[i]);
         }
      }
   }
   b2PolygonShape.prototype.SetAsArray = function (vertices, vertexCount) {
      if (vertexCount === undefined) vertexCount = 0;
      var v = new Vector();
      var i = 0,
         tVec;
      for (i = 0;
      i < vertices.length; ++i) {
         tVec = vertices[i];
         v.push(tVec);
      }
      this.SetAsVector(v, vertexCount);
   }
   b2PolygonShape.AsArray = function (vertices, vertexCount) {
      if (vertexCount === undefined) vertexCount = 0;
      var polygonShape = new b2PolygonShape();
      polygonShape.SetAsArray(vertices, vertexCount);
      return polygonShape;
   }
   b2PolygonShape.prototype.SetAsVector = function (vertices, vertexCount) {
      if (vertexCount === undefined) vertexCount = 0;
      if (vertexCount == 0) vertexCount = vertices.length;
      b2Settings.b2Assert(2 <= vertexCount);
      this.m_vertexCount = vertexCount;
      this.Reserve(vertexCount);
      var i = 0;
      for (i = 0;
      i < this.m_vertexCount; i++) {
         this.m_vertices[i].SetV(vertices[i]);
      }
      for (i = 0;
      i < this.m_vertexCount; ++i) {
         var i1 = parseInt(i);
         var i2 = parseInt(i + 1 < this.m_vertexCount ? i + 1 : 0);
         var edge = b2Math.SubtractVV(this.m_vertices[i2], this.m_vertices[i1]);
         b2Settings.b2Assert(edge.LengthSquared() > Number.MIN_VALUE);
         this.m_normals[i].SetV(b2Math.CrossVF(edge, 1.0));
         this.m_normals[i].Normalize();
      }
      this.m_centroid = b2PolygonShape.ComputeCentroid(this.m_vertices, this.m_vertexCount);
   }
   b2PolygonShape.AsVector = function (vertices, vertexCount) {
      if (vertexCount === undefined) vertexCount = 0;
      var polygonShape = new b2PolygonShape();
      polygonShape.SetAsVector(vertices, vertexCount);
      return polygonShape;
   }
   b2PolygonShape.prototype.SetAsBox = function (hx, hy) {
      if (hx === undefined) hx = 0;
      if (hy === undefined) hy = 0;
      this.m_vertexCount = 4;
      this.Reserve(4);
      this.m_vertices[0].Set((-hx), (-hy));
      this.m_vertices[1].Set(hx, (-hy));
      this.m_vertices[2].Set(hx, hy);
      this.m_vertices[3].Set((-hx), hy);
      this.m_normals[0].Set(0.0, (-1.0));
      this.m_normals[1].Set(1.0, 0.0);
      this.m_normals[2].Set(0.0, 1.0);
      this.m_normals[3].Set((-1.0), 0.0);
      this.m_centroid.SetZero();
   }
   b2PolygonShape.AsBox = function (hx, hy) {
      if (hx === undefined) hx = 0;
      if (hy === undefined) hy = 0;
      var polygonShape = new b2PolygonShape();
      polygonShape.SetAsBox(hx, hy);
      return polygonShape;
   }
   b2PolygonShape.prototype.SetAsOrientedBox = function (hx, hy, center, angle) {
      if (hx === undefined) hx = 0;
      if (hy === undefined) hy = 0;
      if (center === undefined) center = null;
      if (angle === undefined) angle = 0.0;
      this.m_vertexCount = 4;
      this.Reserve(4);
      this.m_vertices[0].Set((-hx), (-hy));
      this.m_vertices[1].Set(hx, (-hy));
      this.m_vertices[2].Set(hx, hy);
      this.m_vertices[3].Set((-hx), hy);
      this.m_normals[0].Set(0.0, (-1.0));
      this.m_normals[1].Set(1.0, 0.0);
      this.m_normals[2].Set(0.0, 1.0);
      this.m_normals[3].Set((-1.0), 0.0);
      this.m_centroid = center;
      var xf = new b2Transform();
      xf.position = center;
      xf.R.Set(angle);
      for (var i = 0; i < this.m_vertexCount; ++i) {
         this.m_vertices[i] = b2Math.MulX(xf, this.m_vertices[i]);
         this.m_normals[i] = b2Math.MulMV(xf.R, this.m_normals[i]);
      }
   }
   b2PolygonShape.AsOrientedBox = function (hx, hy, center, angle) {
      if (hx === undefined) hx = 0;
      if (hy === undefined) hy = 0;
      if (center === undefined) center = null;
      if (angle === undefined) angle = 0.0;
      var polygonShape = new b2PolygonShape();
      polygonShape.SetAsOrientedBox(hx, hy, center, angle);
      return polygonShape;
   }
   b2PolygonShape.prototype.SetAsEdge = function (v1, v2) {
      this.m_vertexCount = 2;
      this.Reserve(2);
      this.m_vertices[0].SetV(v1);
      this.m_vertices[1].SetV(v2);
      this.m_centroid.x = 0.5 * (v1.x + v2.x);
      this.m_centroid.y = 0.5 * (v1.y + v2.y);
      this.m_normals[0] = b2Math.CrossVF(b2Math.SubtractVV(v2, v1), 1.0);
      this.m_normals[0].Normalize();
      this.m_normals[1].x = (-this.m_normals[0].x);
      this.m_normals[1].y = (-this.m_normals[0].y);
   }
   b2PolygonShape.AsEdge = function (v1, v2) {
      var polygonShape = new b2PolygonShape();
      polygonShape.SetAsEdge(v1, v2);
      return polygonShape;
   }
   b2PolygonShape.prototype.TestPoint = function (xf, p) {
      var tVec;
      var tMat = xf.R;
      var tX = p.x - xf.position.x;
      var tY = p.y - xf.position.y;
      var pLocalX = (tX * tMat.col1.x + tY * tMat.col1.y);
      var pLocalY = (tX * tMat.col2.x + tY * tMat.col2.y);
      for (var i = 0; i < this.m_vertexCount; ++i) {
         tVec = this.m_vertices[i];
         tX = pLocalX - tVec.x;
         tY = pLocalY - tVec.y;
         tVec = this.m_normals[i];
         var dot = (tVec.x * tX + tVec.y * tY);
         if (dot > 0.0) {
            return false;
         }
      }
      return true;
   }
   b2PolygonShape.prototype.RayCast = function (output, input, transform) {
      var lower = 0.0;
      var upper = input.maxFraction;
      var tX = 0;
      var tY = 0;
      var tMat;
      var tVec;
      tX = input.p1.x - transform.position.x;
      tY = input.p1.y - transform.position.y;
      tMat = transform.R;
      var p1X = (tX * tMat.col1.x + tY * tMat.col1.y);
      var p1Y = (tX * tMat.col2.x + tY * tMat.col2.y);
      tX = input.p2.x - transform.position.x;
      tY = input.p2.y - transform.position.y;
      tMat = transform.R;
      var p2X = (tX * tMat.col1.x + tY * tMat.col1.y);
      var p2Y = (tX * tMat.col2.x + tY * tMat.col2.y);
      var dX = p2X - p1X;
      var dY = p2Y - p1Y;
      var index = parseInt((-1));
      for (var i = 0; i < this.m_vertexCount; ++i) {
         tVec = this.m_vertices[i];
         tX = tVec.x - p1X;
         tY = tVec.y - p1Y;
         tVec = this.m_normals[i];
         var numerator = (tVec.x * tX + tVec.y * tY);
         var denominator = (tVec.x * dX + tVec.y * dY);
         if (denominator == 0.0) {
            if (numerator < 0.0) {
               return false;
            }
         }
         else {
            if (denominator < 0.0 && numerator < lower * denominator) {
               lower = numerator / denominator;
               index = i;
            }
            else if (denominator > 0.0 && numerator < upper * denominator) {
               upper = numerator / denominator;
            }
         }
         if (upper < lower - Number.MIN_VALUE) {
            return false;
         }
      }
      if (index >= 0) {
         output.fraction = lower;
         tMat = transform.R;
         tVec = this.m_normals[index];
         output.normal.x = (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
         output.normal.y = (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
         return true;
      }
      return false;
   }
   b2PolygonShape.prototype.ComputeAABB = function (aabb, xf) {
      var tMat = xf.R;
      var tVec = this.m_vertices[0];
      var lowerX = xf.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      var lowerY = xf.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      var upperX = lowerX;
      var upperY = lowerY;
      for (var i = 1; i < this.m_vertexCount; ++i) {
         tVec = this.m_vertices[i];
         var vX = xf.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
         var vY = xf.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
         lowerX = lowerX < vX ? lowerX : vX;
         lowerY = lowerY < vY ? lowerY : vY;
         upperX = upperX > vX ? upperX : vX;
         upperY = upperY > vY ? upperY : vY;
      }
      aabb.lowerBound.x = lowerX - this.m_radius;
      aabb.lowerBound.y = lowerY - this.m_radius;
      aabb.upperBound.x = upperX + this.m_radius;
      aabb.upperBound.y = upperY + this.m_radius;
   }
   b2PolygonShape.prototype.ComputeMass = function (massData, density) {
      if (density === undefined) density = 0;
      if (this.m_vertexCount == 2) {
         massData.center.x = 0.5 * (this.m_vertices[0].x + this.m_vertices[1].x);
         massData.center.y = 0.5 * (this.m_vertices[0].y + this.m_vertices[1].y);
         massData.mass = 0.0;
         massData.I = 0.0;
         return;
      }
      var centerX = 0.0;
      var centerY = 0.0;
      var area = 0.0;
      var I = 0.0;
      var p1X = 0.0;
      var p1Y = 0.0;
      var k_inv3 = 1.0 / 3.0;
      for (var i = 0; i < this.m_vertexCount; ++i) {
         var p2 = this.m_vertices[i];
         var p3 = i + 1 < this.m_vertexCount ? this.m_vertices[parseInt(i + 1)] : this.m_vertices[0];
         var e1X = p2.x - p1X;
         var e1Y = p2.y - p1Y;
         var e2X = p3.x - p1X;
         var e2Y = p3.y - p1Y;
         var D = e1X * e2Y - e1Y * e2X;
         var triangleArea = 0.5 * D;area += triangleArea;
         centerX += triangleArea * k_inv3 * (p1X + p2.x + p3.x);
         centerY += triangleArea * k_inv3 * (p1Y + p2.y + p3.y);
         var px = p1X;
         var py = p1Y;
         var ex1 = e1X;
         var ey1 = e1Y;
         var ex2 = e2X;
         var ey2 = e2Y;
         var intx2 = k_inv3 * (0.25 * (ex1 * ex1 + ex2 * ex1 + ex2 * ex2) + (px * ex1 + px * ex2)) + 0.5 * px * px;
         var inty2 = k_inv3 * (0.25 * (ey1 * ey1 + ey2 * ey1 + ey2 * ey2) + (py * ey1 + py * ey2)) + 0.5 * py * py;I += D * (intx2 + inty2);
      }
      massData.mass = density * area;
      centerX *= 1.0 / area;
      centerY *= 1.0 / area;
      massData.center.Set(centerX, centerY);
      massData.I = density * I;
   }
   b2PolygonShape.prototype.ComputeSubmergedArea = function (normal, offset, xf, c) {
      if (offset === undefined) offset = 0;
      var normalL = b2Math.MulTMV(xf.R, normal);
      var offsetL = offset - b2Math.Dot(normal, xf.position);
      var depths = new Vector_a2j_Number();
      var diveCount = 0;
      var intoIndex = parseInt((-1));
      var outoIndex = parseInt((-1));
      var lastSubmerged = false;
      var i = 0;
      for (i = 0;
      i < this.m_vertexCount; ++i) {
         depths[i] = b2Math.Dot(normalL, this.m_vertices[i]) - offsetL;
         var isSubmerged = depths[i] < (-Number.MIN_VALUE);
         if (i > 0) {
            if (isSubmerged) {
               if (!lastSubmerged) {
                  intoIndex = i - 1;
                  diveCount++;
               }
            }
            else {
               if (lastSubmerged) {
                  outoIndex = i - 1;
                  diveCount++;
               }
            }
         }
         lastSubmerged = isSubmerged;
      }
      switch (diveCount) {
      case 0:
         if (lastSubmerged) {
            var md = new b2MassData();
            this.ComputeMass(md, 1);
            c.SetV(b2Math.MulX(xf, md.center));
            return md.mass;
         }
         else {
            return 0;
         }
         break;
      case 1:
         if (intoIndex == (-1)) {
            intoIndex = this.m_vertexCount - 1;
         }
         else {
            outoIndex = this.m_vertexCount - 1;
         }
         break;
      }
      var intoIndex2 = parseInt((intoIndex + 1) % this.m_vertexCount);
      var outoIndex2 = parseInt((outoIndex + 1) % this.m_vertexCount);
      var intoLamdda = (0 - depths[intoIndex]) / (depths[intoIndex2] - depths[intoIndex]);
      var outoLamdda = (0 - depths[outoIndex]) / (depths[outoIndex2] - depths[outoIndex]);
      var intoVec = new b2Vec2(this.m_vertices[intoIndex].x * (1 - intoLamdda) + this.m_vertices[intoIndex2].x * intoLamdda, this.m_vertices[intoIndex].y * (1 - intoLamdda) + this.m_vertices[intoIndex2].y * intoLamdda);
      var outoVec = new b2Vec2(this.m_vertices[outoIndex].x * (1 - outoLamdda) + this.m_vertices[outoIndex2].x * outoLamdda, this.m_vertices[outoIndex].y * (1 - outoLamdda) + this.m_vertices[outoIndex2].y * outoLamdda);
      var area = 0;
      var center = new b2Vec2();
      var p2 = this.m_vertices[intoIndex2];
      var p3;
      i = intoIndex2;
      while (i != outoIndex2) {
         i = (i + 1) % this.m_vertexCount;
         if (i == outoIndex2) p3 = outoVec;
         else p3 = this.m_vertices[i];
         var triangleArea = 0.5 * ((p2.x - intoVec.x) * (p3.y - intoVec.y) - (p2.y - intoVec.y) * (p3.x - intoVec.x));
         area += triangleArea;
         center.x += triangleArea * (intoVec.x + p2.x + p3.x) / 3;
         center.y += triangleArea * (intoVec.y + p2.y + p3.y) / 3;
         p2 = p3;
      }
      center.Multiply(1 / area);
      c.SetV(b2Math.MulX(xf, center));
      return area;
   }
   b2PolygonShape.prototype.GetVertexCount = function () {
      return this.m_vertexCount;
   }
   b2PolygonShape.prototype.GetVertices = function () {
      return this.m_vertices;
   }
   b2PolygonShape.prototype.GetNormals = function () {
      return this.m_normals;
   }
   b2PolygonShape.prototype.GetSupport = function (d) {
      var bestIndex = 0;
      var bestValue = this.m_vertices[0].x * d.x + this.m_vertices[0].y * d.y;
      for (var i = 1; i < this.m_vertexCount; ++i) {
         var value = this.m_vertices[i].x * d.x + this.m_vertices[i].y * d.y;
         if (value > bestValue) {
            bestIndex = i;
            bestValue = value;
         }
      }
      return bestIndex;
   }
   b2PolygonShape.prototype.GetSupportVertex = function (d) {
      var bestIndex = 0;
      var bestValue = this.m_vertices[0].x * d.x + this.m_vertices[0].y * d.y;
      for (var i = 1; i < this.m_vertexCount; ++i) {
         var value = this.m_vertices[i].x * d.x + this.m_vertices[i].y * d.y;
         if (value > bestValue) {
            bestIndex = i;
            bestValue = value;
         }
      }
      return this.m_vertices[bestIndex];
   }
   b2PolygonShape.prototype.Validate = function () {
      return false;
   }
   b2PolygonShape.prototype.b2PolygonShape = function () {
      this.__super.b2Shape.call(this);
      this.m_type = b2Shape.e_polygonShape;
      this.m_centroid = new b2Vec2();
      this.m_vertices = new Vector();
      this.m_normals = new Vector();
   }
   b2PolygonShape.prototype.Reserve = function (count) {
      if (count === undefined) count = 0;
      for (var i = parseInt(this.m_vertices.length); i < count; i++) {
         this.m_vertices[i] = new b2Vec2();
         this.m_normals[i] = new b2Vec2();
      }
   }
   b2PolygonShape.ComputeCentroid = function (vs, count) {
      if (count === undefined) count = 0;
      var c = new b2Vec2();
      var area = 0.0;
      var p1X = 0.0;
      var p1Y = 0.0;
      var inv3 = 1.0 / 3.0;
      for (var i = 0; i < count; ++i) {
         var p2 = vs[i];
         var p3 = i + 1 < count ? vs[parseInt(i + 1)] : vs[0];
         var e1X = p2.x - p1X;
         var e1Y = p2.y - p1Y;
         var e2X = p3.x - p1X;
         var e2Y = p3.y - p1Y;
         var D = (e1X * e2Y - e1Y * e2X);
         var triangleArea = 0.5 * D;area += triangleArea;
         c.x += triangleArea * inv3 * (p1X + p2.x + p3.x);
         c.y += triangleArea * inv3 * (p1Y + p2.y + p3.y);
      }
      c.x *= 1.0 / area;
      c.y *= 1.0 / area;
      return c;
   }
   b2PolygonShape.ComputeOBB = function (obb, vs, count) {
      if (count === undefined) count = 0;
      var i = 0;
      var p = new Vector(count + 1);
      for (i = 0;
      i < count; ++i) {
         p[i] = vs[i];
      }
      p[count] = p[0];
      var minArea = Number.MAX_VALUE;
      for (i = 1;
      i <= count; ++i) {
         var root = p[parseInt(i - 1)];
         var uxX = p[i].x - root.x;
         var uxY = p[i].y - root.y;
         var length = Math.sqrt(uxX * uxX + uxY * uxY);
         uxX /= length;
         uxY /= length;
         var uyX = (-uxY);
         var uyY = uxX;
         var lowerX = Number.MAX_VALUE;
         var lowerY = Number.MAX_VALUE;
         var upperX = (-Number.MAX_VALUE);
         var upperY = (-Number.MAX_VALUE);
         for (var j = 0; j < count; ++j) {
            var dX = p[j].x - root.x;
            var dY = p[j].y - root.y;
            var rX = (uxX * dX + uxY * dY);
            var rY = (uyX * dX + uyY * dY);
            if (rX < lowerX) lowerX = rX;
            if (rY < lowerY) lowerY = rY;
            if (rX > upperX) upperX = rX;
            if (rY > upperY) upperY = rY;
         }
         var area = (upperX - lowerX) * (upperY - lowerY);
         if (area < 0.95 * minArea) {
            minArea = area;
            obb.R.col1.x = uxX;
            obb.R.col1.y = uxY;
            obb.R.col2.x = uyX;
            obb.R.col2.y = uyY;
            var centerX = 0.5 * (lowerX + upperX);
            var centerY = 0.5 * (lowerY + upperY);
            var tMat = obb.R;
            obb.center.x = root.x + (tMat.col1.x * centerX + tMat.col2.x * centerY);
            obb.center.y = root.y + (tMat.col1.y * centerX + tMat.col2.y * centerY);
            obb.extents.x = 0.5 * (upperX - lowerX);
            obb.extents.y = 0.5 * (upperY - lowerY);
         }
      }
   }
   Box2D.postDefs.push(function () {
      Box2D.Collision.Shapes.b2PolygonShape.s_mat = new b2Mat22();
   });
   b2Shape.b2Shape = function () {};
   b2Shape.prototype.Copy = function () {
      return null;
   }
   b2Shape.prototype.Set = function (other) {
      this.m_radius = other.m_radius;
   }
   b2Shape.prototype.GetType = function () {
      return this.m_type;
   }
   b2Shape.prototype.TestPoint = function (xf, p) {
      return false;
   }
   b2Shape.prototype.RayCast = function (output, input, transform) {
      return false;
   }
   b2Shape.prototype.ComputeAABB = function (aabb, xf) {}
   b2Shape.prototype.ComputeMass = function (massData, density) {
      if (density === undefined) density = 0;
   }
   b2Shape.prototype.ComputeSubmergedArea = function (normal, offset, xf, c) {
      if (offset === undefined) offset = 0;
      return 0;
   }
   b2Shape.TestOverlap = function (shape1, transform1, shape2, transform2) {
      var input = new b2DistanceInput();
      input.proxyA = new b2DistanceProxy();
      input.proxyA.Set(shape1);
      input.proxyB = new b2DistanceProxy();
      input.proxyB.Set(shape2);
      input.transformA = transform1;
      input.transformB = transform2;
      input.useRadii = true;
      var simplexCache = new b2SimplexCache();
      simplexCache.count = 0;
      var output = new b2DistanceOutput();
      b2Distance.Distance(output, simplexCache, input);
      return output.distance < 10.0 * Number.MIN_VALUE;
   }
   b2Shape.prototype.b2Shape = function () {
      this.m_type = b2Shape.e_unknownShape;
      this.m_radius = b2Settings.b2_linearSlop;
   }
   Box2D.postDefs.push(function () {
      Box2D.Collision.Shapes.b2Shape.e_unknownShape = parseInt((-1));
      Box2D.Collision.Shapes.b2Shape.e_circleShape = 0;
      Box2D.Collision.Shapes.b2Shape.e_polygonShape = 1;
      Box2D.Collision.Shapes.b2Shape.e_edgeShape = 2;
      Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount = 3;
      Box2D.Collision.Shapes.b2Shape.e_hitCollide = 1;
      Box2D.Collision.Shapes.b2Shape.e_missCollide = 0;
      Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide = parseInt((-1));
   });
})();
(function () {
   var b2Color = Box2D.Common.b2Color,
      b2internal = Box2D.Common.b2internal,
      b2Settings = Box2D.Common.b2Settings,
      b2Mat22 = Box2D.Common.Math.b2Mat22,
      b2Mat33 = Box2D.Common.Math.b2Mat33,
      b2Math = Box2D.Common.Math.b2Math,
      b2Sweep = Box2D.Common.Math.b2Sweep,
      b2Transform = Box2D.Common.Math.b2Transform,
      b2Vec2 = Box2D.Common.Math.b2Vec2,
      b2Vec3 = Box2D.Common.Math.b2Vec3;

   b2Color.b2Color = function () {
      this._r = 0;
      this._g = 0;
      this._b = 0;
   };
   b2Color.prototype.b2Color = function (rr, gg, bb) {
      if (rr === undefined) rr = 0;
      if (gg === undefined) gg = 0;
      if (bb === undefined) bb = 0;
      this._r = Box2D.parseUInt(255 * b2Math.Clamp(rr, 0.0, 1.0));
      this._g = Box2D.parseUInt(255 * b2Math.Clamp(gg, 0.0, 1.0));
      this._b = Box2D.parseUInt(255 * b2Math.Clamp(bb, 0.0, 1.0));
   }
   b2Color.prototype.Set = function (rr, gg, bb) {
      if (rr === undefined) rr = 0;
      if (gg === undefined) gg = 0;
      if (bb === undefined) bb = 0;
      this._r = Box2D.parseUInt(255 * b2Math.Clamp(rr, 0.0, 1.0));
      this._g = Box2D.parseUInt(255 * b2Math.Clamp(gg, 0.0, 1.0));
      this._b = Box2D.parseUInt(255 * b2Math.Clamp(bb, 0.0, 1.0));
   }
   Object.defineProperty(b2Color.prototype, 'r', {
      enumerable: false,
      configurable: true,
      set: function (rr) {
         if (rr === undefined) rr = 0;
         this._r = Box2D.parseUInt(255 * b2Math.Clamp(rr, 0.0, 1.0));
      }
   });
   Object.defineProperty(b2Color.prototype, 'g', {
      enumerable: false,
      configurable: true,
      set: function (gg) {
         if (gg === undefined) gg = 0;
         this._g = Box2D.parseUInt(255 * b2Math.Clamp(gg, 0.0, 1.0));
      }
   });
   Object.defineProperty(b2Color.prototype, 'b', {
      enumerable: false,
      configurable: true,
      set: function (bb) {
         if (bb === undefined) bb = 0;
         this._b = Box2D.parseUInt(255 * b2Math.Clamp(bb, 0.0, 1.0));
      }
   });
   Object.defineProperty(b2Color.prototype, 'color', {
      enumerable: false,
      configurable: true,
      get: function () {
         return (this._r << 16) | (this._g << 8) | (this._b);
      }
   });
   b2Settings.b2Settings = function () {};
   b2Settings.b2MixFriction = function (friction1, friction2) {
      if (friction1 === undefined) friction1 = 0;
      if (friction2 === undefined) friction2 = 0;
      return Math.sqrt(friction1 * friction2);
   }
   b2Settings.b2MixRestitution = function (restitution1, restitution2) {
      if (restitution1 === undefined) restitution1 = 0;
      if (restitution2 === undefined) restitution2 = 0;
      return restitution1 > restitution2 ? restitution1 : restitution2;
   }
   b2Settings.b2Assert = function (a) {
      if (!a) {
         throw "Assertion Failed";
      }
   }
   Box2D.postDefs.push(function () {
      Box2D.Common.b2Settings.VERSION = "2.1alpha";
      Box2D.Common.b2Settings.USHRT_MAX = 0x0000ffff;
      Box2D.Common.b2Settings.b2_pi = Math.PI;
      Box2D.Common.b2Settings.b2_maxManifoldPoints = 2;
      Box2D.Common.b2Settings.b2_aabbExtension = 0.1;
      Box2D.Common.b2Settings.b2_aabbMultiplier = 2.0;
      Box2D.Common.b2Settings.b2_polygonRadius = 2.0 * b2Settings.b2_linearSlop;
      Box2D.Common.b2Settings.b2_linearSlop = 0.005;
      Box2D.Common.b2Settings.b2_angularSlop = 2.0 / 180.0 * b2Settings.b2_pi;
      Box2D.Common.b2Settings.b2_toiSlop = 8.0 * b2Settings.b2_linearSlop;
      Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland = 32;
      Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland = 32;
      Box2D.Common.b2Settings.b2_velocityThreshold = 1.0;
      Box2D.Common.b2Settings.b2_maxLinearCorrection = 0.2;
      Box2D.Common.b2Settings.b2_maxAngularCorrection = 8.0 / 180.0 * b2Settings.b2_pi;
      Box2D.Common.b2Settings.b2_maxTranslation = 2.0;
      Box2D.Common.b2Settings.b2_maxTranslationSquared = b2Settings.b2_maxTranslation * b2Settings.b2_maxTranslation;
      Box2D.Common.b2Settings.b2_maxRotation = 0.5 * b2Settings.b2_pi;
      Box2D.Common.b2Settings.b2_maxRotationSquared = b2Settings.b2_maxRotation * b2Settings.b2_maxRotation;
      Box2D.Common.b2Settings.b2_contactBaumgarte = 0.2;
      Box2D.Common.b2Settings.b2_timeToSleep = 0.5;
      Box2D.Common.b2Settings.b2_linearSleepTolerance = 0.01;
      Box2D.Common.b2Settings.b2_angularSleepTolerance = 2.0 / 180.0 * b2Settings.b2_pi;
   });
})();
(function () {
   var b2AABB = Box2D.Collision.b2AABB,
      b2Color = Box2D.Common.b2Color,
      b2internal = Box2D.Common.b2internal,
      b2Settings = Box2D.Common.b2Settings,
      b2Mat22 = Box2D.Common.Math.b2Mat22,
      b2Mat33 = Box2D.Common.Math.b2Mat33,
      b2Math = Box2D.Common.Math.b2Math,
      b2Sweep = Box2D.Common.Math.b2Sweep,
      b2Transform = Box2D.Common.Math.b2Transform,
      b2Vec2 = Box2D.Common.Math.b2Vec2,
      b2Vec3 = Box2D.Common.Math.b2Vec3;

   b2Mat22.b2Mat22 = function () {
      this.col1 = new b2Vec2();
      this.col2 = new b2Vec2();
   };
   b2Mat22.prototype.b2Mat22 = function () {
      this.SetIdentity();
   }
   b2Mat22.FromAngle = function (angle) {
      if (angle === undefined) angle = 0;
      var mat = new b2Mat22();
      mat.Set(angle);
      return mat;
   }
   b2Mat22.FromVV = function (c1, c2) {
      var mat = new b2Mat22();
      mat.SetVV(c1, c2);
      return mat;
   }
   b2Mat22.prototype.Set = function (angle) {
      if (angle === undefined) angle = 0;
      var c = Math.cos(angle);
      var s = Math.sin(angle);
      this.col1.x = c;
      this.col2.x = (-s);
      this.col1.y = s;
      this.col2.y = c;
   }
   b2Mat22.prototype.SetVV = function (c1, c2) {
      this.col1.SetV(c1);
      this.col2.SetV(c2);
   }
   b2Mat22.prototype.Copy = function () {
      var mat = new b2Mat22();
      mat.SetM(this);
      return mat;
   }
   b2Mat22.prototype.SetM = function (m) {
      this.col1.SetV(m.col1);
      this.col2.SetV(m.col2);
   }
   b2Mat22.prototype.AddM = function (m) {
      this.col1.x += m.col1.x;
      this.col1.y += m.col1.y;
      this.col2.x += m.col2.x;
      this.col2.y += m.col2.y;
   }
   b2Mat22.prototype.SetIdentity = function () {
      this.col1.x = 1.0;
      this.col2.x = 0.0;
      this.col1.y = 0.0;
      this.col2.y = 1.0;
   }
   b2Mat22.prototype.SetZero = function () {
      this.col1.x = 0.0;
      this.col2.x = 0.0;
      this.col1.y = 0.0;
      this.col2.y = 0.0;
   }
   b2Mat22.prototype.GetAngle = function () {
      return Math.atan2(this.col1.y, this.col1.x);
   }
   b2Mat22.prototype.GetInverse = function (out) {
      var a = this.col1.x;
      var b = this.col2.x;
      var c = this.col1.y;
      var d = this.col2.y;
      var det = a * d - b * c;
      if (det != 0.0) {
         det = 1.0 / det;
      }
      out.col1.x = det * d;
      out.col2.x = (-det * b);
      out.col1.y = (-det * c);
      out.col2.y = det * a;
      return out;
   }
   b2Mat22.prototype.Solve = function (out, bX, bY) {
      if (bX === undefined) bX = 0;
      if (bY === undefined) bY = 0;
      var a11 = this.col1.x;
      var a12 = this.col2.x;
      var a21 = this.col1.y;
      var a22 = this.col2.y;
      var det = a11 * a22 - a12 * a21;
      if (det != 0.0) {
         det = 1.0 / det;
      }
      out.x = det * (a22 * bX - a12 * bY);
      out.y = det * (a11 * bY - a21 * bX);
      return out;
   }
   b2Mat22.prototype.Abs = function () {
      this.col1.Abs();
      this.col2.Abs();
   }
   b2Mat33.b2Mat33 = function () {
      this.col1 = new b2Vec3();
      this.col2 = new b2Vec3();
      this.col3 = new b2Vec3();
   };
   b2Mat33.prototype.b2Mat33 = function (c1, c2, c3) {
      if (c1 === undefined) c1 = null;
      if (c2 === undefined) c2 = null;
      if (c3 === undefined) c3 = null;
      if (!c1 && !c2 && !c3) {
         this.col1.SetZero();
         this.col2.SetZero();
         this.col3.SetZero();
      }
      else {
         this.col1.SetV(c1);
         this.col2.SetV(c2);
         this.col3.SetV(c3);
      }
   }
   b2Mat33.prototype.SetVVV = function (c1, c2, c3) {
      this.col1.SetV(c1);
      this.col2.SetV(c2);
      this.col3.SetV(c3);
   }
   b2Mat33.prototype.Copy = function () {
      return new b2Mat33(this.col1, this.col2, this.col3);
   }
   b2Mat33.prototype.SetM = function (m) {
      this.col1.SetV(m.col1);
      this.col2.SetV(m.col2);
      this.col3.SetV(m.col3);
   }
   b2Mat33.prototype.AddM = function (m) {
      this.col1.x += m.col1.x;
      this.col1.y += m.col1.y;
      this.col1.z += m.col1.z;
      this.col2.x += m.col2.x;
      this.col2.y += m.col2.y;
      this.col2.z += m.col2.z;
      this.col3.x += m.col3.x;
      this.col3.y += m.col3.y;
      this.col3.z += m.col3.z;
   }
   b2Mat33.prototype.SetIdentity = function () {
      this.col1.x = 1.0;
      this.col2.x = 0.0;
      this.col3.x = 0.0;
      this.col1.y = 0.0;
      this.col2.y = 1.0;
      this.col3.y = 0.0;
      this.col1.z = 0.0;
      this.col2.z = 0.0;
      this.col3.z = 1.0;
   }
   b2Mat33.prototype.SetZero = function () {
      this.col1.x = 0.0;
      this.col2.x = 0.0;
      this.col3.x = 0.0;
      this.col1.y = 0.0;
      this.col2.y = 0.0;
      this.col3.y = 0.0;
      this.col1.z = 0.0;
      this.col2.z = 0.0;
      this.col3.z = 0.0;
   }
   b2Mat33.prototype.Solve22 = function (out, bX, bY) {
      if (bX === undefined) bX = 0;
      if (bY === undefined) bY = 0;
      var a11 = this.col1.x;
      var a12 = this.col2.x;
      var a21 = this.col1.y;
      var a22 = this.col2.y;
      var det = a11 * a22 - a12 * a21;
      if (det != 0.0) {
         det = 1.0 / det;
      }
      out.x = det * (a22 * bX - a12 * bY);
      out.y = det * (a11 * bY - a21 * bX);
      return out;
   }
   b2Mat33.prototype.Solve33 = function (out, bX, bY, bZ) {
      if (bX === undefined) bX = 0;
      if (bY === undefined) bY = 0;
      if (bZ === undefined) bZ = 0;
      var a11 = this.col1.x;
      var a21 = this.col1.y;
      var a31 = this.col1.z;
      var a12 = this.col2.x;
      var a22 = this.col2.y;
      var a32 = this.col2.z;
      var a13 = this.col3.x;
      var a23 = this.col3.y;
      var a33 = this.col3.z;
      var det = a11 * (a22 * a33 - a32 * a23) + a21 * (a32 * a13 - a12 * a33) + a31 * (a12 * a23 - a22 * a13);
      if (det != 0.0) {
         det = 1.0 / det;
      }
      out.x = det * (bX * (a22 * a33 - a32 * a23) + bY * (a32 * a13 - a12 * a33) + bZ * (a12 * a23 - a22 * a13));
      out.y = det * (a11 * (bY * a33 - bZ * a23) + a21 * (bZ * a13 - bX * a33) + a31 * (bX * a23 - bY * a13));
      out.z = det * (a11 * (a22 * bZ - a32 * bY) + a21 * (a32 * bX - a12 * bZ) + a31 * (a12 * bY - a22 * bX));
      return out;
   }
   b2Math.b2Math = function () {};
   b2Math.IsValid = function (x) {
      if (x === undefined) x = 0;
      return isFinite(x);
   }
   b2Math.Dot = function (a, b) {
      return a.x * b.x + a.y * b.y;
   }
   b2Math.CrossVV = function (a, b) {
      return a.x * b.y - a.y * b.x;
   }
   b2Math.CrossVF = function (a, s) {
      if (s === undefined) s = 0;
      var v = new b2Vec2(s * a.y, (-s * a.x));
      return v;
   }
   b2Math.CrossFV = function (s, a) {
      if (s === undefined) s = 0;
      var v = new b2Vec2((-s * a.y), s * a.x);
      return v;
   }
   b2Math.MulMV = function (A, v) {
      var u = new b2Vec2(A.col1.x * v.x + A.col2.x * v.y, A.col1.y * v.x + A.col2.y * v.y);
      return u;
   }
   b2Math.MulTMV = function (A, v) {
      var u = new b2Vec2(b2Math.Dot(v, A.col1), b2Math.Dot(v, A.col2));
      return u;
   }
   b2Math.MulX = function (T, v) {
      var a = b2Math.MulMV(T.R, v);
      a.x += T.position.x;
      a.y += T.position.y;
      return a;
   }
   b2Math.MulXT = function (T, v) {
      var a = b2Math.SubtractVV(v, T.position);
      var tX = (a.x * T.R.col1.x + a.y * T.R.col1.y);
      a.y = (a.x * T.R.col2.x + a.y * T.R.col2.y);
      a.x = tX;
      return a;
   }
   b2Math.AddVV = function (a, b) {
      var v = new b2Vec2(a.x + b.x, a.y + b.y);
      return v;
   }
   b2Math.SubtractVV = function (a, b) {
      var v = new b2Vec2(a.x - b.x, a.y - b.y);
      return v;
   }
   b2Math.Distance = function (a, b) {
      var cX = a.x - b.x;
      var cY = a.y - b.y;
      return Math.sqrt(cX * cX + cY * cY);
   }
   b2Math.DistanceSquared = function (a, b) {
      var cX = a.x - b.x;
      var cY = a.y - b.y;
      return (cX * cX + cY * cY);
   }
   b2Math.MulFV = function (s, a) {
      if (s === undefined) s = 0;
      var v = new b2Vec2(s * a.x, s * a.y);
      return v;
   }
   b2Math.AddMM = function (A, B) {
      var C = b2Mat22.FromVV(b2Math.AddVV(A.col1, B.col1), b2Math.AddVV(A.col2, B.col2));
      return C;
   }
   b2Math.MulMM = function (A, B) {
      var C = b2Mat22.FromVV(b2Math.MulMV(A, B.col1), b2Math.MulMV(A, B.col2));
      return C;
   }
   b2Math.MulTMM = function (A, B) {
      var c1 = new b2Vec2(b2Math.Dot(A.col1, B.col1), b2Math.Dot(A.col2, B.col1));
      var c2 = new b2Vec2(b2Math.Dot(A.col1, B.col2), b2Math.Dot(A.col2, B.col2));
      var C = b2Mat22.FromVV(c1, c2);
      return C;
   }
   b2Math.Abs = function (a) {
      if (a === undefined) a = 0;
      return a > 0.0 ? a : (-a);
   }
   b2Math.AbsV = function (a) {
      var b = new b2Vec2(b2Math.Abs(a.x), b2Math.Abs(a.y));
      return b;
   }
   b2Math.AbsM = function (A) {
      var B = b2Mat22.FromVV(b2Math.AbsV(A.col1), b2Math.AbsV(A.col2));
      return B;
   }
   b2Math.Min = function (a, b) {
      if (a === undefined) a = 0;
      if (b === undefined) b = 0;
      return a < b ? a : b;
   }
   b2Math.MinV = function (a, b) {
      var c = new b2Vec2(b2Math.Min(a.x, b.x), b2Math.Min(a.y, b.y));
      return c;
   }
   b2Math.Max = function (a, b) {
      if (a === undefined) a = 0;
      if (b === undefined) b = 0;
      return a > b ? a : b;
   }
   b2Math.MaxV = function (a, b) {
      var c = new b2Vec2(b2Math.Max(a.x, b.x), b2Math.Max(a.y, b.y));
      return c;
   }
   b2Math.Clamp = function (a, low, high) {
      if (a === undefined) a = 0;
      if (low === undefined) low = 0;
      if (high === undefined) high = 0;
      return a < low ? low : a > high ? high : a;
   }
   b2Math.ClampV = function (a, low, high) {
      return b2Math.MaxV(low, b2Math.MinV(a, high));
   }
   b2Math.Swap = function (a, b) {
      var tmp = a[0];
      a[0] = b[0];
      b[0] = tmp;
   }
   b2Math.Random = function () {
      return Math.random() * 2 - 1;
   }
   b2Math.RandomRange = function (lo, hi) {
      if (lo === undefined) lo = 0;
      if (hi === undefined) hi = 0;
      var r = Math.random();
      r = (hi - lo) * r + lo;
      return r;
   }
   b2Math.NextPowerOfTwo = function (x) {
      if (x === undefined) x = 0;
      x |= (x >> 1) & 0x7FFFFFFF;
      x |= (x >> 2) & 0x3FFFFFFF;
      x |= (x >> 4) & 0x0FFFFFFF;
      x |= (x >> 8) & 0x00FFFFFF;
      x |= (x >> 16) & 0x0000FFFF;
      return x + 1;
   }
   b2Math.IsPowerOfTwo = function (x) {
      if (x === undefined) x = 0;
      var result = x > 0 && (x & (x - 1)) == 0;
      return result;
   }
   Box2D.postDefs.push(function () {
      Box2D.Common.Math.b2Math.b2Vec2_zero = new b2Vec2(0.0, 0.0);
      Box2D.Common.Math.b2Math.b2Mat22_identity = b2Mat22.FromVV(new b2Vec2(1.0, 0.0), new b2Vec2(0.0, 1.0));
      Box2D.Common.Math.b2Math.b2Transform_identity = new b2Transform(b2Math.b2Vec2_zero, b2Math.b2Mat22_identity);
   });
   b2Sweep.b2Sweep = function () {
      this.localCenter = new b2Vec2();
      this.c0 = new b2Vec2;
      this.c = new b2Vec2();
   };
   b2Sweep.prototype.Set = function (other) {
      this.localCenter.SetV(other.localCenter);
      this.c0.SetV(other.c0);
      this.c.SetV(other.c);
      this.a0 = other.a0;
      this.a = other.a;
      this.t0 = other.t0;
   }
   b2Sweep.prototype.Copy = function () {
      var copy = new b2Sweep();
      copy.localCenter.SetV(this.localCenter);
      copy.c0.SetV(this.c0);
      copy.c.SetV(this.c);
      copy.a0 = this.a0;
      copy.a = this.a;
      copy.t0 = this.t0;
      return copy;
   }
   b2Sweep.prototype.GetTransform = function (xf, alpha) {
      if (alpha === undefined) alpha = 0;
      xf.position.x = (1.0 - alpha) * this.c0.x + alpha * this.c.x;
      xf.position.y = (1.0 - alpha) * this.c0.y + alpha * this.c.y;
      var angle = (1.0 - alpha) * this.a0 + alpha * this.a;
      xf.R.Set(angle);
      var tMat = xf.R;
      xf.position.x -= (tMat.col1.x * this.localCenter.x + tMat.col2.x * this.localCenter.y);
      xf.position.y -= (tMat.col1.y * this.localCenter.x + tMat.col2.y * this.localCenter.y);
   }
   b2Sweep.prototype.Advance = function (t) {
      if (t === undefined) t = 0;
      if (this.t0 < t && 1.0 - this.t0 > Number.MIN_VALUE) {
         var alpha = (t - this.t0) / (1.0 - this.t0);
         this.c0.x = (1.0 - alpha) * this.c0.x + alpha * this.c.x;
         this.c0.y = (1.0 - alpha) * this.c0.y + alpha * this.c.y;
         this.a0 = (1.0 - alpha) * this.a0 + alpha * this.a;
         this.t0 = t;
      }
   }
   b2Transform.b2Transform = function () {
      this.position = new b2Vec2;
      this.R = new b2Mat22();
   };
   b2Transform.prototype.b2Transform = function (pos, r) {
      if (pos === undefined) pos = null;
      if (r === undefined) r = null;
      if (pos) {
         this.position.SetV(pos);
         this.R.SetM(r);
      }
   }
   b2Transform.prototype.Initialize = function (pos, r) {
      this.position.SetV(pos);
      this.R.SetM(r);
   }
   b2Transform.prototype.SetIdentity = function () {
      this.position.SetZero();
      this.R.SetIdentity();
   }
   b2Transform.prototype.Set = function (x) {
      this.position.SetV(x.position);
      this.R.SetM(x.R);
   }
   b2Transform.prototype.GetAngle = function () {
      return Math.atan2(this.R.col1.y, this.R.col1.x);
   }
   b2Vec2.b2Vec2 = function () {};
   b2Vec2.prototype.b2Vec2 = function (x_, y_) {
      if (x_ === undefined) x_ = 0;
      if (y_ === undefined) y_ = 0;
      this.x = x_;
      this.y = y_;
   }
   b2Vec2.prototype.SetZero = function () {
      this.x = 0.0;
      this.y = 0.0;
   }
   b2Vec2.prototype.Set = function (x_, y_) {
      if (x_ === undefined) x_ = 0;
      if (y_ === undefined) y_ = 0;
      this.x = x_;
      this.y = y_;
   }
   b2Vec2.prototype.SetV = function (v) {
      this.x = v.x;
      this.y = v.y;
   }
   b2Vec2.prototype.GetNegative = function () {
      return new b2Vec2((-this.x), (-this.y));
   }
   b2Vec2.prototype.NegativeSelf = function () {
      this.x = (-this.x);
      this.y = (-this.y);
   }
   b2Vec2.Make = function (x_, y_) {
      if (x_ === undefined) x_ = 0;
      if (y_ === undefined) y_ = 0;
      return new b2Vec2(x_, y_);
   }
   b2Vec2.prototype.Copy = function () {
      return new b2Vec2(this.x, this.y);
   }
   b2Vec2.prototype.Add = function (v) {
      this.x += v.x;
      this.y += v.y;
   }
   b2Vec2.prototype.Subtract = function (v) {
      this.x -= v.x;
      this.y -= v.y;
   }
   b2Vec2.prototype.Multiply = function (a) {
      if (a === undefined) a = 0;
      this.x *= a;
      this.y *= a;
   }
   b2Vec2.prototype.MulM = function (A) {
      var tX = this.x;
      this.x = A.col1.x * tX + A.col2.x * this.y;
      this.y = A.col1.y * tX + A.col2.y * this.y;
   }
   b2Vec2.prototype.MulTM = function (A) {
      var tX = b2Math.Dot(this, A.col1);
      this.y = b2Math.Dot(this, A.col2);
      this.x = tX;
   }
   b2Vec2.prototype.CrossVF = function (s) {
      if (s === undefined) s = 0;
      var tX = this.x;
      this.x = s * this.y;
      this.y = (-s * tX);
   }
   b2Vec2.prototype.CrossFV = function (s) {
      if (s === undefined) s = 0;
      var tX = this.x;
      this.x = (-s * this.y);
      this.y = s * tX;
   }
   b2Vec2.prototype.MinV = function (b) {
      this.x = this.x < b.x ? this.x : b.x;
      this.y = this.y < b.y ? this.y : b.y;
   }
   b2Vec2.prototype.MaxV = function (b) {
      this.x = this.x > b.x ? this.x : b.x;
      this.y = this.y > b.y ? this.y : b.y;
   }
   b2Vec2.prototype.Abs = function () {
      if (this.x < 0) this.x = (-this.x);
      if (this.y < 0) this.y = (-this.y);
   }
   b2Vec2.prototype.Length = function () {
      return Math.sqrt(this.x * this.x + this.y * this.y);
   }
   b2Vec2.prototype.LengthSquared = function () {
      return (this.x * this.x + this.y * this.y);
   }
   b2Vec2.prototype.Normalize = function () {
      var length = Math.sqrt(this.x * this.x + this.y * this.y);
      if (length < Number.MIN_VALUE) {
         return 0.0;
      }
      var invLength = 1.0 / length;
      this.x *= invLength;
      this.y *= invLength;
      return length;
   }
   b2Vec2.prototype.IsValid = function () {
      return b2Math.IsValid(this.x) && b2Math.IsValid(this.y);
   }
   b2Vec3.b2Vec3 = function () {};
   b2Vec3.prototype.b2Vec3 = function (x, y, z) {
      if (x === undefined) x = 0;
      if (y === undefined) y = 0;
      if (z === undefined) z = 0;
      this.x = x;
      this.y = y;
      this.z = z;
   }
   b2Vec3.prototype.SetZero = function () {
      this.x = this.y = this.z = 0.0;
   }
   b2Vec3.prototype.Set = function (x, y, z) {
      if (x === undefined) x = 0;
      if (y === undefined) y = 0;
      if (z === undefined) z = 0;
      this.x = x;
      this.y = y;
      this.z = z;
   }
   b2Vec3.prototype.SetV = function (v) {
      this.x = v.x;
      this.y = v.y;
      this.z = v.z;
   }
   b2Vec3.prototype.GetNegative = function () {
      return new b2Vec3((-this.x), (-this.y), (-this.z));
   }
   b2Vec3.prototype.NegativeSelf = function () {
      this.x = (-this.x);
      this.y = (-this.y);
      this.z = (-this.z);
   }
   b2Vec3.prototype.Copy = function () {
      return new b2Vec3(this.x, this.y, this.z);
   }
   b2Vec3.prototype.Add = function (v) {
      this.x += v.x;
      this.y += v.y;
      this.z += v.z;
   }
   b2Vec3.prototype.Subtract = function (v) {
      this.x -= v.x;
      this.y -= v.y;
      this.z -= v.z;
   }
   b2Vec3.prototype.Multiply = function (a) {
      if (a === undefined) a = 0;
      this.x *= a;
      this.y *= a;
      this.z *= a;
   }
})();
(function () {
   var b2ControllerEdge = Box2D.Dynamics.Controllers.b2ControllerEdge,
      b2Mat22 = Box2D.Common.Math.b2Mat22,
      b2Mat33 = Box2D.Common.Math.b2Mat33,
      b2Math = Box2D.Common.Math.b2Math,
      b2Sweep = Box2D.Common.Math.b2Sweep,
      b2Transform = Box2D.Common.Math.b2Transform,
      b2Vec2 = Box2D.Common.Math.b2Vec2,
      b2Vec3 = Box2D.Common.Math.b2Vec3,
      b2Color = Box2D.Common.b2Color,
      b2internal = Box2D.Common.b2internal,
      b2Settings = Box2D.Common.b2Settings,
      b2AABB = Box2D.Collision.b2AABB,
      b2Bound = Box2D.Collision.b2Bound,
      b2BoundValues = Box2D.Collision.b2BoundValues,
      b2Collision = Box2D.Collision.b2Collision,
      b2ContactID = Box2D.Collision.b2ContactID,
      b2ContactPoint = Box2D.Collision.b2ContactPoint,
      b2Distance = Box2D.Collision.b2Distance,
      b2DistanceInput = Box2D.Collision.b2DistanceInput,
      b2DistanceOutput = Box2D.Collision.b2DistanceOutput,
      b2DistanceProxy = Box2D.Collision.b2DistanceProxy,
      b2DynamicTree = Box2D.Collision.b2DynamicTree,
      b2DynamicTreeBroadPhase = Box2D.Collision.b2DynamicTreeBroadPhase,
      b2DynamicTreeNode = Box2D.Collision.b2DynamicTreeNode,
      b2DynamicTreePair = Box2D.Collision.b2DynamicTreePair,
      b2Manifold = Box2D.Collision.b2Manifold,
      b2ManifoldPoint = Box2D.Collision.b2ManifoldPoint,
      b2Point = Box2D.Collision.b2Point,
      b2RayCastInput = Box2D.Collision.b2RayCastInput,
      b2RayCastOutput = Box2D.Collision.b2RayCastOutput,
      b2Segment = Box2D.Collision.b2Segment,
      b2SeparationFunction = Box2D.Collision.b2SeparationFunction,
      b2Simplex = Box2D.Collision.b2Simplex,
      b2SimplexCache = Box2D.Collision.b2SimplexCache,
      b2SimplexVertex = Box2D.Collision.b2SimplexVertex,
      b2TimeOfImpact = Box2D.Collision.b2TimeOfImpact,
      b2TOIInput = Box2D.Collision.b2TOIInput,
      b2WorldManifold = Box2D.Collision.b2WorldManifold,
      ClipVertex = Box2D.Collision.ClipVertex,
      Features = Box2D.Collision.Features,
      IBroadPhase = Box2D.Collision.IBroadPhase,
      b2CircleShape = Box2D.Collision.Shapes.b2CircleShape,
      b2EdgeChainDef = Box2D.Collision.Shapes.b2EdgeChainDef,
      b2EdgeShape = Box2D.Collision.Shapes.b2EdgeShape,
      b2MassData = Box2D.Collision.Shapes.b2MassData,
      b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape,
      b2Shape = Box2D.Collision.Shapes.b2Shape,
      b2Body = Box2D.Dynamics.b2Body,
      b2BodyDef = Box2D.Dynamics.b2BodyDef,
      b2ContactFilter = Box2D.Dynamics.b2ContactFilter,
      b2ContactImpulse = Box2D.Dynamics.b2ContactImpulse,
      b2ContactListener = Box2D.Dynamics.b2ContactListener,
      b2ContactManager = Box2D.Dynamics.b2ContactManager,
      b2DebugDraw = Box2D.Dynamics.b2DebugDraw,
      b2DestructionListener = Box2D.Dynamics.b2DestructionListener,
      b2FilterData = Box2D.Dynamics.b2FilterData,
      b2Fixture = Box2D.Dynamics.b2Fixture,
      b2FixtureDef = Box2D.Dynamics.b2FixtureDef,
      b2Island = Box2D.Dynamics.b2Island,
      b2TimeStep = Box2D.Dynamics.b2TimeStep,
      b2World = Box2D.Dynamics.b2World,
      b2CircleContact = Box2D.Dynamics.Contacts.b2CircleContact,
      b2Contact = Box2D.Dynamics.Contacts.b2Contact,
      b2ContactConstraint = Box2D.Dynamics.Contacts.b2ContactConstraint,
      b2ContactConstraintPoint = Box2D.Dynamics.Contacts.b2ContactConstraintPoint,
      b2ContactEdge = Box2D.Dynamics.Contacts.b2ContactEdge,
      b2ContactFactory = Box2D.Dynamics.Contacts.b2ContactFactory,
      b2ContactRegister = Box2D.Dynamics.Contacts.b2ContactRegister,
      b2ContactResult = Box2D.Dynamics.Contacts.b2ContactResult,
      b2ContactSolver = Box2D.Dynamics.Contacts.b2ContactSolver,
      b2EdgeAndCircleContact = Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,
      b2NullContact = Box2D.Dynamics.Contacts.b2NullContact,
      b2PolyAndCircleContact = Box2D.Dynamics.Contacts.b2PolyAndCircleContact,
      b2PolyAndEdgeContact = Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,
      b2PolygonContact = Box2D.Dynamics.Contacts.b2PolygonContact,
      b2PositionSolverManifold = Box2D.Dynamics.Contacts.b2PositionSolverManifold,
      b2Controller = Box2D.Dynamics.Controllers.b2Controller,
      b2DistanceJoint = Box2D.Dynamics.Joints.b2DistanceJoint,
      b2DistanceJointDef = Box2D.Dynamics.Joints.b2DistanceJointDef,
      b2FrictionJoint = Box2D.Dynamics.Joints.b2FrictionJoint,
      b2FrictionJointDef = Box2D.Dynamics.Joints.b2FrictionJointDef,
      b2GearJoint = Box2D.Dynamics.Joints.b2GearJoint,
      b2GearJointDef = Box2D.Dynamics.Joints.b2GearJointDef,
      b2Jacobian = Box2D.Dynamics.Joints.b2Jacobian,
      b2Joint = Box2D.Dynamics.Joints.b2Joint,
      b2JointDef = Box2D.Dynamics.Joints.b2JointDef,
      b2JointEdge = Box2D.Dynamics.Joints.b2JointEdge,
      b2LineJoint = Box2D.Dynamics.Joints.b2LineJoint,
      b2LineJointDef = Box2D.Dynamics.Joints.b2LineJointDef,
      b2MouseJoint = Box2D.Dynamics.Joints.b2MouseJoint,
      b2MouseJointDef = Box2D.Dynamics.Joints.b2MouseJointDef,
      b2PrismaticJoint = Box2D.Dynamics.Joints.b2PrismaticJoint,
      b2PrismaticJointDef = Box2D.Dynamics.Joints.b2PrismaticJointDef,
      b2PulleyJoint = Box2D.Dynamics.Joints.b2PulleyJoint,
      b2PulleyJointDef = Box2D.Dynamics.Joints.b2PulleyJointDef,
      b2RevoluteJoint = Box2D.Dynamics.Joints.b2RevoluteJoint,
      b2RevoluteJointDef = Box2D.Dynamics.Joints.b2RevoluteJointDef,
      b2WeldJoint = Box2D.Dynamics.Joints.b2WeldJoint,
      b2WeldJointDef = Box2D.Dynamics.Joints.b2WeldJointDef;

   b2Body.b2Body = function () {
      this.m_xf = new b2Transform();
      this.m_sweep = new b2Sweep();
      this.m_linearVelocity = new b2Vec2();
      this.m_force = new b2Vec2();
   };
   b2Body.prototype.connectEdges = function (s1, s2, angle1) {
      if (angle1 === undefined) angle1 = 0;
      var angle2 = Math.atan2(s2.GetDirectionVector().y, s2.GetDirectionVector().x);
      var coreOffset = Math.tan((angle2 - angle1) * 0.5);
      var core = b2Math.MulFV(coreOffset, s2.GetDirectionVector());
      core = b2Math.SubtractVV(core, s2.GetNormalVector());
      core = b2Math.MulFV(b2Settings.b2_toiSlop, core);
      core = b2Math.AddVV(core, s2.GetVertex1());
      var cornerDir = b2Math.AddVV(s1.GetDirectionVector(), s2.GetDirectionVector());
      cornerDir.Normalize();
      var convex = b2Math.Dot(s1.GetDirectionVector(), s2.GetNormalVector()) > 0.0;
      s1.SetNextEdge(s2, core, cornerDir, convex);
      s2.SetPrevEdge(s1, core, cornerDir, convex);
      return angle2;
   }
   b2Body.prototype.CreateFixture = function (def) {
      if (this.m_world.IsLocked() == true) {
         return null;
      }
      var fixture = new b2Fixture();
      fixture.Create(this, this.m_xf, def);
      if (this.m_flags & b2Body.e_activeFlag) {
         var broadPhase = this.m_world.m_contactManager.m_broadPhase;
         fixture.CreateProxy(broadPhase, this.m_xf);
      }
      fixture.m_next = this.m_fixtureList;
      this.m_fixtureList = fixture;
      ++this.m_fixtureCount;
      fixture.m_body = this;
      if (fixture.m_density > 0.0) {
         this.ResetMassData();
      }
      this.m_world.m_flags |= b2World.e_newFixture;
      return fixture;
   }
   b2Body.prototype.CreateFixture2 = function (shape, density) {
      if (density === undefined) density = 0.0;
      var def = new b2FixtureDef();
      def.shape = shape;
      def.density = density;
      return this.CreateFixture(def);
   }
   b2Body.prototype.DestroyFixture = function (fixture) {
      if (this.m_world.IsLocked() == true) {
         return;
      }
      var node = this.m_fixtureList;
      var ppF = null;
      var found = false;
      while (node != null) {
         if (node == fixture) {
            if (ppF) ppF.m_next = fixture.m_next;
            else this.m_fixtureList = fixture.m_next;
            found = true;
            break;
         }
         ppF = node;
         node = node.m_next;
      }
      var edge = this.m_contactList;
      while (edge) {
         var c = edge.contact;
         edge = edge.next;
         var fixtureA = c.GetFixtureA();
         var fixtureB = c.GetFixtureB();
         if (fixture == fixtureA || fixture == fixtureB) {
            this.m_world.m_contactManager.Destroy(c);
         }
      }
      if (this.m_flags & b2Body.e_activeFlag) {
         var broadPhase = this.m_world.m_contactManager.m_broadPhase;
         fixture.DestroyProxy(broadPhase);
      }
      else {}
      fixture.Destroy();
      fixture.m_body = null;
      fixture.m_next = null;
      --this.m_fixtureCount;
      this.ResetMassData();
   }
   b2Body.prototype.SetPositionAndAngle = function (position, angle) {
      if (angle === undefined) angle = 0;
      var f;
      if (this.m_world.IsLocked() == true) {
         return;
      }
      this.m_xf.R.Set(angle);
      this.m_xf.position.SetV(position);
      var tMat = this.m_xf.R;
      var tVec = this.m_sweep.localCenter;
      this.m_sweep.c.x = (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      this.m_sweep.c.y = (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      this.m_sweep.c.x += this.m_xf.position.x;
      this.m_sweep.c.y += this.m_xf.position.y;
      this.m_sweep.c0.SetV(this.m_sweep.c);
      this.m_sweep.a0 = this.m_sweep.a = angle;
      var broadPhase = this.m_world.m_contactManager.m_broadPhase;
      for (f = this.m_fixtureList;
      f; f = f.m_next) {
         f.Synchronize(broadPhase, this.m_xf, this.m_xf);
      }
      this.m_world.m_contactManager.FindNewContacts();
   }
   b2Body.prototype.SetTransform = function (xf) {
      this.SetPositionAndAngle(xf.position, xf.GetAngle());
   }
   b2Body.prototype.GetTransform = function () {
      return this.m_xf;
   }
   b2Body.prototype.GetPosition = function () {
      return this.m_xf.position;
   }
   b2Body.prototype.SetPosition = function (position) {
      this.SetPositionAndAngle(position, this.GetAngle());
   }
   b2Body.prototype.GetAngle = function () {
      return this.m_sweep.a;
   }
   b2Body.prototype.SetAngle = function (angle) {
      if (angle === undefined) angle = 0;
      this.SetPositionAndAngle(this.GetPosition(), angle);
   }
   b2Body.prototype.GetWorldCenter = function () {
      return this.m_sweep.c;
   }
   b2Body.prototype.GetLocalCenter = function () {
      return this.m_sweep.localCenter;
   }
   b2Body.prototype.SetLinearVelocity = function (v) {
      if (this.m_type == b2Body.b2_staticBody) {
         return;
      }
      this.m_linearVelocity.SetV(v);
   }
   b2Body.prototype.GetLinearVelocity = function () {
      return this.m_linearVelocity;
   }
   b2Body.prototype.SetAngularVelocity = function (omega) {
      if (omega === undefined) omega = 0;
      if (this.m_type == b2Body.b2_staticBody) {
         return;
      }
      this.m_angularVelocity = omega;
   }
   b2Body.prototype.GetAngularVelocity = function () {
      return this.m_angularVelocity;
   }
   b2Body.prototype.GetDefinition = function () {
      var bd = new b2BodyDef();
      bd.type = this.GetType();
      bd.allowSleep = (this.m_flags & b2Body.e_allowSleepFlag) == b2Body.e_allowSleepFlag;
      bd.angle = this.GetAngle();
      bd.angularDamping = this.m_angularDamping;
      bd.angularVelocity = this.m_angularVelocity;
      bd.fixedRotation = (this.m_flags & b2Body.e_fixedRotationFlag) == b2Body.e_fixedRotationFlag;
      bd.bullet = (this.m_flags & b2Body.e_bulletFlag) == b2Body.e_bulletFlag;
      bd.awake = (this.m_flags & b2Body.e_awakeFlag) == b2Body.e_awakeFlag;
      bd.linearDamping = this.m_linearDamping;
      bd.linearVelocity.SetV(this.GetLinearVelocity());
      bd.position = this.GetPosition();
      bd.userData = this.GetUserData();
      return bd;
   }
   b2Body.prototype.ApplyForce = function (force, point) {
      if (this.m_type != b2Body.b2_dynamicBody) {
         return;
      }
      if (this.IsAwake() == false) {
         this.SetAwake(true);
      }
      this.m_force.x += force.x;
      this.m_force.y += force.y;
      this.m_torque += ((point.x - this.m_sweep.c.x) * force.y - (point.y - this.m_sweep.c.y) * force.x);
   }
   b2Body.prototype.ApplyTorque = function (torque) {
      if (torque === undefined) torque = 0;
      if (this.m_type != b2Body.b2_dynamicBody) {
         return;
      }
      if (this.IsAwake() == false) {
         this.SetAwake(true);
      }
      this.m_torque += torque;
   }
   b2Body.prototype.ApplyImpulse = function (impulse, point) {
      if (this.m_type != b2Body.b2_dynamicBody) {
         return;
      }
      if (this.IsAwake() == false) {
         this.SetAwake(true);
      }
      this.m_linearVelocity.x += this.m_invMass * impulse.x;
      this.m_linearVelocity.y += this.m_invMass * impulse.y;
      this.m_angularVelocity += this.m_invI * ((point.x - this.m_sweep.c.x) * impulse.y - (point.y - this.m_sweep.c.y) * impulse.x);
   }
   b2Body.prototype.Split = function (callback) {
      var linearVelocity = this.GetLinearVelocity().Copy();
      var angularVelocity = this.GetAngularVelocity();
      var center = this.GetWorldCenter();
      var body1 = this;
      var body2 = this.m_world.CreateBody(this.GetDefinition());
      var prev;
      for (var f = body1.m_fixtureList; f;) {
         if (callback(f)) {
            var next = f.m_next;
            if (prev) {
               prev.m_next = next;
            }
            else {
               body1.m_fixtureList = next;
            }
            body1.m_fixtureCount--;
            f.m_next = body2.m_fixtureList;
            body2.m_fixtureList = f;
            body2.m_fixtureCount++;
            f.m_body = body2;
            f = next;
         }
         else {
            prev = f;
            f = f.m_next;
         }
      }
      body1.ResetMassData();
      body2.ResetMassData();
      var center1 = body1.GetWorldCenter();
      var center2 = body2.GetWorldCenter();
      var velocity1 = b2Math.AddVV(linearVelocity, b2Math.CrossFV(angularVelocity, b2Math.SubtractVV(center1, center)));
      var velocity2 = b2Math.AddVV(linearVelocity, b2Math.CrossFV(angularVelocity, b2Math.SubtractVV(center2, center)));
      body1.SetLinearVelocity(velocity1);
      body2.SetLinearVelocity(velocity2);
      body1.SetAngularVelocity(angularVelocity);
      body2.SetAngularVelocity(angularVelocity);
      body1.SynchronizeFixtures();
      body2.SynchronizeFixtures();
      return body2;
   }
   b2Body.prototype.Merge = function (other) {
      var f;
      for (f = other.m_fixtureList;
      f;) {
         var next = f.m_next;
         other.m_fixtureCount--;
         f.m_next = this.m_fixtureList;
         this.m_fixtureList = f;
         this.m_fixtureCount++;
         f.m_body = body2;
         f = next;
      }
      body1.m_fixtureCount = 0;
      var body1 = this;
      var body2 = other;
      var center1 = body1.GetWorldCenter();
      var center2 = body2.GetWorldCenter();
      var velocity1 = body1.GetLinearVelocity().Copy();
      var velocity2 = body2.GetLinearVelocity().Copy();
      var angular1 = body1.GetAngularVelocity();
      var angular = body2.GetAngularVelocity();
      body1.ResetMassData();
      this.SynchronizeFixtures();
   }
   b2Body.prototype.GetMass = function () {
      return this.m_mass;
   }
   b2Body.prototype.GetInertia = function () {
      return this.m_I;
   }
   b2Body.prototype.GetMassData = function (data) {
      data.mass = this.m_mass;
      data.I = this.m_I;
      data.center.SetV(this.m_sweep.localCenter);
   }
   b2Body.prototype.SetMassData = function (massData) {
      b2Settings.b2Assert(this.m_world.IsLocked() == false);
      if (this.m_world.IsLocked() == true) {
         return;
      }
      if (this.m_type != b2Body.b2_dynamicBody) {
         return;
      }
      this.m_invMass = 0.0;
      this.m_I = 0.0;
      this.m_invI = 0.0;
      this.m_mass = massData.mass;
      if (this.m_mass <= 0.0) {
         this.m_mass = 1.0;
      }
      this.m_invMass = 1.0 / this.m_mass;
      if (massData.I > 0.0 && (this.m_flags & b2Body.e_fixedRotationFlag) == 0) {
         this.m_I = massData.I - this.m_mass * (massData.center.x * massData.center.x + massData.center.y * massData.center.y);
         this.m_invI = 1.0 / this.m_I;
      }
      var oldCenter = this.m_sweep.c.Copy();
      this.m_sweep.localCenter.SetV(massData.center);
      this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf, this.m_sweep.localCenter));
      this.m_sweep.c.SetV(this.m_sweep.c0);
      this.m_linearVelocity.x += this.m_angularVelocity * (-(this.m_sweep.c.y - oldCenter.y));
      this.m_linearVelocity.y += this.m_angularVelocity * (+(this.m_sweep.c.x - oldCenter.x));
   }
   b2Body.prototype.ResetMassData = function () {
      this.m_mass = 0.0;
      this.m_invMass = 0.0;
      this.m_I = 0.0;
      this.m_invI = 0.0;
      this.m_sweep.localCenter.SetZero();
      if (this.m_type == b2Body.b2_staticBody || this.m_type == b2Body.b2_kinematicBody) {
         return;
      }
      var center = b2Vec2.Make(0, 0);
      for (var f = this.m_fixtureList; f; f = f.m_next) {
         if (f.m_density == 0.0) {
            continue;
         }
         var massData = f.GetMassData();
         this.m_mass += massData.mass;
         center.x += massData.center.x * massData.mass;
         center.y += massData.center.y * massData.mass;
         this.m_I += massData.I;
      }
      if (this.m_mass > 0.0) {
         this.m_invMass = 1.0 / this.m_mass;
         center.x *= this.m_invMass;
         center.y *= this.m_invMass;
      }
      else {
         this.m_mass = 1.0;
         this.m_invMass = 1.0;
      }
      if (this.m_I > 0.0 && (this.m_flags & b2Body.e_fixedRotationFlag) == 0) {
         this.m_I -= this.m_mass * (center.x * center.x + center.y * center.y);
         this.m_I *= this.m_inertiaScale;
         b2Settings.b2Assert(this.m_I > 0);
         this.m_invI = 1.0 / this.m_I;
      }
      else {
         this.m_I = 0.0;
         this.m_invI = 0.0;
      }
      var oldCenter = this.m_sweep.c.Copy();
      this.m_sweep.localCenter.SetV(center);
      this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf, this.m_sweep.localCenter));
      this.m_sweep.c.SetV(this.m_sweep.c0);
      this.m_linearVelocity.x += this.m_angularVelocity * (-(this.m_sweep.c.y - oldCenter.y));
      this.m_linearVelocity.y += this.m_angularVelocity * (+(this.m_sweep.c.x - oldCenter.x));
   }
   b2Body.prototype.GetWorldPoint = function (localPoint) {
      var A = this.m_xf.R;
      var u = new b2Vec2(A.col1.x * localPoint.x + A.col2.x * localPoint.y, A.col1.y * localPoint.x + A.col2.y * localPoint.y);
      u.x += this.m_xf.position.x;
      u.y += this.m_xf.position.y;
      return u;
   }
   b2Body.prototype.GetWorldVector = function (localVector) {
      return b2Math.MulMV(this.m_xf.R, localVector);
   }
   b2Body.prototype.GetLocalPoint = function (worldPoint) {
      return b2Math.MulXT(this.m_xf, worldPoint);
   }
   b2Body.prototype.GetLocalVector = function (worldVector) {
      return b2Math.MulTMV(this.m_xf.R, worldVector);
   }
   b2Body.prototype.GetLinearVelocityFromWorldPoint = function (worldPoint) {
      return new b2Vec2(this.m_linearVelocity.x - this.m_angularVelocity * (worldPoint.y - this.m_sweep.c.y), this.m_linearVelocity.y + this.m_angularVelocity * (worldPoint.x - this.m_sweep.c.x));
   }
   b2Body.prototype.GetLinearVelocityFromLocalPoint = function (localPoint) {
      var A = this.m_xf.R;
      var worldPoint = new b2Vec2(A.col1.x * localPoint.x + A.col2.x * localPoint.y, A.col1.y * localPoint.x + A.col2.y * localPoint.y);
      worldPoint.x += this.m_xf.position.x;
      worldPoint.y += this.m_xf.position.y;
      return new b2Vec2(this.m_linearVelocity.x - this.m_angularVelocity * (worldPoint.y - this.m_sweep.c.y), this.m_linearVelocity.y + this.m_angularVelocity * (worldPoint.x - this.m_sweep.c.x));
   }
   b2Body.prototype.GetLinearDamping = function () {
      return this.m_linearDamping;
   }
   b2Body.prototype.SetLinearDamping = function (linearDamping) {
      if (linearDamping === undefined) linearDamping = 0;
      this.m_linearDamping = linearDamping;
   }
   b2Body.prototype.GetAngularDamping = function () {
      return this.m_angularDamping;
   }
   b2Body.prototype.SetAngularDamping = function (angularDamping) {
      if (angularDamping === undefined) angularDamping = 0;
      this.m_angularDamping = angularDamping;
   }
   b2Body.prototype.SetType = function (type) {
      if (type === undefined) type = 0;
      if (this.m_type == type) {
         return;
      }
      this.m_type = type;
      this.ResetMassData();
      if (this.m_type == b2Body.b2_staticBody) {
         this.m_linearVelocity.SetZero();
         this.m_angularVelocity = 0.0;
      }
      this.SetAwake(true);
      this.m_force.SetZero();
      this.m_torque = 0.0;
      for (var ce = this.m_contactList; ce; ce = ce.next) {
         ce.contact.FlagForFiltering();
      }
   }
   b2Body.prototype.GetType = function () {
      return this.m_type;
   }
   b2Body.prototype.SetBullet = function (flag) {
      if (flag) {
         this.m_flags |= b2Body.e_bulletFlag;
      }
      else {
         this.m_flags &= ~b2Body.e_bulletFlag;
      }
   }
   b2Body.prototype.IsBullet = function () {
      return (this.m_flags & b2Body.e_bulletFlag) == b2Body.e_bulletFlag;
   }
   b2Body.prototype.SetSleepingAllowed = function (flag) {
      if (flag) {
         this.m_flags |= b2Body.e_allowSleepFlag;
      }
      else {
         this.m_flags &= ~b2Body.e_allowSleepFlag;
         this.SetAwake(true);
      }
   }
   b2Body.prototype.SetAwake = function (flag) {
      if (flag) {
         this.m_flags |= b2Body.e_awakeFlag;
         this.m_sleepTime = 0.0;
      }
      else {
         this.m_flags &= ~b2Body.e_awakeFlag;
         this.m_sleepTime = 0.0;
         this.m_linearVelocity.SetZero();
         this.m_angularVelocity = 0.0;
         this.m_force.SetZero();
         this.m_torque = 0.0;
      }
   }
   b2Body.prototype.IsAwake = function () {
      return (this.m_flags & b2Body.e_awakeFlag) == b2Body.e_awakeFlag;
   }
   b2Body.prototype.SetFixedRotation = function (fixed) {
      if (fixed) {
         this.m_flags |= b2Body.e_fixedRotationFlag;
      }
      else {
         this.m_flags &= ~b2Body.e_fixedRotationFlag;
      }
      this.ResetMassData();
   }
   b2Body.prototype.IsFixedRotation = function () {
      return (this.m_flags & b2Body.e_fixedRotationFlag) == b2Body.e_fixedRotationFlag;
   }
   b2Body.prototype.SetActive = function (flag) {
      if (flag == this.IsActive()) {
         return;
      }
      var broadPhase;
      var f;
      if (flag) {
         this.m_flags |= b2Body.e_activeFlag;
         broadPhase = this.m_world.m_contactManager.m_broadPhase;
         for (f = this.m_fixtureList;
         f; f = f.m_next) {
            f.CreateProxy(broadPhase, this.m_xf);
         }
      }
      else {
         this.m_flags &= ~b2Body.e_activeFlag;
         broadPhase = this.m_world.m_contactManager.m_broadPhase;
         for (f = this.m_fixtureList;
         f; f = f.m_next) {
            f.DestroyProxy(broadPhase);
         }
         var ce = this.m_contactList;
         while (ce) {
            var ce0 = ce;
            ce = ce.next;
            this.m_world.m_contactManager.Destroy(ce0.contact);
         }
         this.m_contactList = null;
      }
   }
   b2Body.prototype.IsActive = function () {
      return (this.m_flags & b2Body.e_activeFlag) == b2Body.e_activeFlag;
   }
   b2Body.prototype.IsSleepingAllowed = function () {
      return (this.m_flags & b2Body.e_allowSleepFlag) == b2Body.e_allowSleepFlag;
   }
   b2Body.prototype.GetFixtureList = function () {
      return this.m_fixtureList;
   }
   b2Body.prototype.GetJointList = function () {
      return this.m_jointList;
   }
   b2Body.prototype.GetControllerList = function () {
      return this.m_controllerList;
   }
   b2Body.prototype.GetContactList = function () {
      return this.m_contactList;
   }
   b2Body.prototype.GetNext = function () {
      return this.m_next;
   }
   b2Body.prototype.GetUserData = function () {
      return this.m_userData;
   }
   b2Body.prototype.SetUserData = function (data) {
      this.m_userData = data;
   }
   b2Body.prototype.GetWorld = function () {
      return this.m_world;
   }
   b2Body.prototype.b2Body = function (bd, world) {
      this.m_flags = 0;
      if (bd.bullet) {
         this.m_flags |= b2Body.e_bulletFlag;
      }
      if (bd.fixedRotation) {
         this.m_flags |= b2Body.e_fixedRotationFlag;
      }
      if (bd.allowSleep) {
         this.m_flags |= b2Body.e_allowSleepFlag;
      }
      if (bd.awake) {
         this.m_flags |= b2Body.e_awakeFlag;
      }
      if (bd.active) {
         this.m_flags |= b2Body.e_activeFlag;
      }
      this.m_world = world;
      this.m_xf.position.SetV(bd.position);
      this.m_xf.R.Set(bd.angle);
      this.m_sweep.localCenter.SetZero();
      this.m_sweep.t0 = 1.0;
      this.m_sweep.a0 = this.m_sweep.a = bd.angle;
      var tMat = this.m_xf.R;
      var tVec = this.m_sweep.localCenter;
      this.m_sweep.c.x = (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      this.m_sweep.c.y = (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      this.m_sweep.c.x += this.m_xf.position.x;
      this.m_sweep.c.y += this.m_xf.position.y;
      this.m_sweep.c0.SetV(this.m_sweep.c);
      this.m_jointList = null;
      this.m_controllerList = null;
      this.m_contactList = null;
      this.m_controllerCount = 0;
      this.m_prev = null;
      this.m_next = null;
      this.m_linearVelocity.SetV(bd.linearVelocity);
      this.m_angularVelocity = bd.angularVelocity;
      this.m_linearDamping = bd.linearDamping;
      this.m_angularDamping = bd.angularDamping;
      this.m_force.Set(0.0, 0.0);
      this.m_torque = 0.0;
      this.m_sleepTime = 0.0;
      this.m_type = bd.type;
      if (this.m_type == b2Body.b2_dynamicBody) {
         this.m_mass = 1.0;
         this.m_invMass = 1.0;
      }
      else {
         this.m_mass = 0.0;
         this.m_invMass = 0.0;
      }
      this.m_I = 0.0;
      this.m_invI = 0.0;
      this.m_inertiaScale = bd.inertiaScale;
      this.m_userData = bd.userData;
      this.m_fixtureList = null;
      this.m_fixtureCount = 0;
   }
   b2Body.prototype.SynchronizeFixtures = function () {
      var xf1 = b2Body.s_xf1;
      xf1.R.Set(this.m_sweep.a0);
      var tMat = xf1.R;
      var tVec = this.m_sweep.localCenter;
      xf1.position.x = this.m_sweep.c0.x - (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      xf1.position.y = this.m_sweep.c0.y - (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
      var f;
      var broadPhase = this.m_world.m_contactManager.m_broadPhase;
      for (f = this.m_fixtureList;
      f; f = f.m_next) {
         f.Synchronize(broadPhase, xf1, this.m_xf);
      }
   }
   b2Body.prototype.SynchronizeTransform = function () {
      this.m_xf.R.Set(this.m_sweep.a);
      var tMat = this.m_xf.R;
      var tVec = this.m_sweep.localCenter;
      this.m_xf.position.x = this.m_sweep.c.x - (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
      this.m_xf.position.y = this.m_sweep.c.y - (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
   }
   b2Body.prototype.ShouldCollide = function (other) {
      if (this.m_type != b2Body.b2_dynamicBody && other.m_type != b2Body.b2_dynamicBody) {
         return false;
      }
      for (var jn = this.m_jointList; jn; jn = jn.next) {
         if (jn.other == other) if (jn.joint.m_collideConnected == false) {
            return false;
         }
      }
      return true;
   }
   b2Body.prototype.Advance = function (t) {
      if (t === undefined) t = 0;
      this.m_sweep.Advance(t);
      this.m_sweep.c.SetV(this.m_sweep.c0);
      this.m_sweep.a = this.m_sweep.a0;
      this.SynchronizeTransform();
   }
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.b2Body.s_xf1 = new b2Transform();
      Box2D.Dynamics.b2Body.e_islandFlag = 0x0001;
      Box2D.Dynamics.b2Body.e_awakeFlag = 0x0002;
      Box2D.Dynamics.b2Body.e_allowSleepFlag = 0x0004;
      Box2D.Dynamics.b2Body.e_bulletFlag = 0x0008;
      Box2D.Dynamics.b2Body.e_fixedRotationFlag = 0x0010;
      Box2D.Dynamics.b2Body.e_activeFlag = 0x0020;
      Box2D.Dynamics.b2Body.b2_staticBody = 0;
      Box2D.Dynamics.b2Body.b2_kinematicBody = 1;
      Box2D.Dynamics.b2Body.b2_dynamicBody = 2;
   });
   b2BodyDef.b2BodyDef = function () {
      this.position = new b2Vec2();
      this.linearVelocity = new b2Vec2();
   };
   b2BodyDef.prototype.b2BodyDef = function () {
      this.userData = null;
      this.position.Set(0.0, 0.0);
      this.angle = 0.0;
      this.linearVelocity.Set(0, 0);
      this.angularVelocity = 0.0;
      this.linearDamping = 0.0;
      this.angularDamping = 0.0;
      this.allowSleep = true;
      this.awake = true;
      this.fixedRotation = false;
      this.bullet = false;
      this.type = b2Body.b2_staticBody;
      this.active = true;
      this.inertiaScale = 1.0;
   }
   b2ContactFilter.b2ContactFilter = function () {};
   b2ContactFilter.prototype.ShouldCollide = function (fixtureA, fixtureB) {
      var filter1 = fixtureA.GetFilterData();
      var filter2 = fixtureB.GetFilterData();
      if (filter1.groupIndex == filter2.groupIndex && filter1.groupIndex != 0) {
         return filter1.groupIndex > 0;
      }
      var collide = (filter1.maskBits & filter2.categoryBits) != 0 && (filter1.categoryBits & filter2.maskBits) != 0;
      return collide;
   }
   b2ContactFilter.prototype.RayCollide = function (userData, fixture) {
      if (!userData) return true;
      return this.ShouldCollide((userData instanceof b2Fixture ? userData : null), fixture);
   }
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.b2ContactFilter.b2_defaultFilter = new b2ContactFilter();
   });
   b2ContactImpulse.b2ContactImpulse = function () {
      this.normalImpulses = new Vector_a2j_Number(b2Settings.b2_maxManifoldPoints);
      this.tangentImpulses = new Vector_a2j_Number(b2Settings.b2_maxManifoldPoints);
   };
   b2ContactListener.b2ContactListener = function () {};
   b2ContactListener.prototype.BeginContact = function (contact) {}
   b2ContactListener.prototype.EndContact = function (contact) {}
   b2ContactListener.prototype.PreSolve = function (contact, oldManifold) {}
   b2ContactListener.prototype.PostSolve = function (contact, impulse) {}
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.b2ContactListener.b2_defaultListener = new b2ContactListener();
   });
   b2ContactManager.b2ContactManager = function () {};
   b2ContactManager.prototype.b2ContactManager = function () {
      this.m_world = null;
      this.m_contactCount = 0;
      this.m_contactFilter = b2ContactFilter.b2_defaultFilter;
      this.m_contactListener = b2ContactListener.b2_defaultListener;
      this.m_contactFactory = new b2ContactFactory(this.m_allocator);
      this.m_broadPhase = new b2DynamicTreeBroadPhase();
   }
   b2ContactManager.prototype.AddPair = function (proxyUserDataA, proxyUserDataB) {
      var fixtureA = (proxyUserDataA instanceof b2Fixture ? proxyUserDataA : null);
      var fixtureB = (proxyUserDataB instanceof b2Fixture ? proxyUserDataB : null);
      var bodyA = fixtureA.GetBody();
      var bodyB = fixtureB.GetBody();
      if (bodyA == bodyB) return;
      var edge = bodyB.GetContactList();
      while (edge) {
         if (edge.other == bodyA) {
            var fA = edge.contact.GetFixtureA();
            var fB = edge.contact.GetFixtureB();
            if (fA == fixtureA && fB == fixtureB) return;
            if (fA == fixtureB && fB == fixtureA) return;
         }
         edge = edge.next;
      }
      if (bodyB.ShouldCollide(bodyA) == false) {
         return;
      }
      if (this.m_contactFilter.ShouldCollide(fixtureA, fixtureB) == false) {
         return;
      }
      var c = this.m_contactFactory.Create(fixtureA, fixtureB);
      fixtureA = c.GetFixtureA();
      fixtureB = c.GetFixtureB();
      bodyA = fixtureA.m_body;
      bodyB = fixtureB.m_body;
      c.m_prev = null;
      c.m_next = this.m_world.m_contactList;
      if (this.m_world.m_contactList != null) {
         this.m_world.m_contactList.m_prev = c;
      }
      this.m_world.m_contactList = c;
      c.m_nodeA.contact = c;
      c.m_nodeA.other = bodyB;
      c.m_nodeA.prev = null;
      c.m_nodeA.next = bodyA.m_contactList;
      if (bodyA.m_contactList != null) {
         bodyA.m_contactList.prev = c.m_nodeA;
      }
      bodyA.m_contactList = c.m_nodeA;
      c.m_nodeB.contact = c;
      c.m_nodeB.other = bodyA;
      c.m_nodeB.prev = null;
      c.m_nodeB.next = bodyB.m_contactList;
      if (bodyB.m_contactList != null) {
         bodyB.m_contactList.prev = c.m_nodeB;
      }
      bodyB.m_contactList = c.m_nodeB;
      ++this.m_world.m_contactCount;
      return;
   }
   b2ContactManager.prototype.FindNewContacts = function () {
      this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this, this.AddPair));
   }
   b2ContactManager.prototype.Destroy = function (c) {
      var fixtureA = c.GetFixtureA();
      var fixtureB = c.GetFixtureB();
      var bodyA = fixtureA.GetBody();
      var bodyB = fixtureB.GetBody();
      if (c.IsTouching()) {
         this.m_contactListener.EndContact(c);
      }
      if (c.m_prev) {
         c.m_prev.m_next = c.m_next;
      }
      if (c.m_next) {
         c.m_next.m_prev = c.m_prev;
      }
      if (c == this.m_world.m_contactList) {
         this.m_world.m_contactList = c.m_next;
      }
      if (c.m_nodeA.prev) {
         c.m_nodeA.prev.next = c.m_nodeA.next;
      }
      if (c.m_nodeA.next) {
         c.m_nodeA.next.prev = c.m_nodeA.prev;
      }
      if (c.m_nodeA == bodyA.m_contactList) {
         bodyA.m_contactList = c.m_nodeA.next;
      }
      if (c.m_nodeB.prev) {
         c.m_nodeB.prev.next = c.m_nodeB.next;
      }
      if (c.m_nodeB.next) {
         c.m_nodeB.next.prev = c.m_nodeB.prev;
      }
      if (c.m_nodeB == bodyB.m_contactList) {
         bodyB.m_contactList = c.m_nodeB.next;
      }
      this.m_contactFactory.Destroy(c);
      --this.m_contactCount;
   }
   b2ContactManager.prototype.Collide = function () {
      var c = this.m_world.m_contactList;
      while (c) {
         var fixtureA = c.GetFixtureA();
         var fixtureB = c.GetFixtureB();
         var bodyA = fixtureA.GetBody();
         var bodyB = fixtureB.GetBody();
         if (bodyA.IsAwake() == false && bodyB.IsAwake() == false) {
            c = c.GetNext();
            continue;
         }
         if (c.m_flags & b2Contact.e_filterFlag) {
            if (bodyB.ShouldCollide(bodyA) == false) {
               var cNuke = c;
               c = cNuke.GetNext();
               this.Destroy(cNuke);
               continue;
            }
            if (this.m_contactFilter.ShouldCollide(fixtureA, fixtureB) == false) {
               cNuke = c;
               c = cNuke.GetNext();
               this.Destroy(cNuke);
               continue;
            }
            c.m_flags &= ~b2Contact.e_filterFlag;
         }
         var proxyA = fixtureA.m_proxy;
         var proxyB = fixtureB.m_proxy;
         var overlap = this.m_broadPhase.TestOverlap(proxyA, proxyB);
         if (overlap == false) {
            cNuke = c;
            c = cNuke.GetNext();
            this.Destroy(cNuke);
            continue;
         }
         c.Update(this.m_contactListener);
         c = c.GetNext();
      }
   }
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.b2ContactManager.s_evalCP = new b2ContactPoint();
   });
   b2DebugDraw.b2DebugDraw = function () {};
   b2DebugDraw.prototype.b2DebugDraw = function () {}
   b2DebugDraw.prototype.SetFlags = function (flags) {
      if (flags === undefined) flags = 0;
   }
   b2DebugDraw.prototype.GetFlags = function () {}
   b2DebugDraw.prototype.AppendFlags = function (flags) {
      if (flags === undefined) flags = 0;
   }
   b2DebugDraw.prototype.ClearFlags = function (flags) {
      if (flags === undefined) flags = 0;
   }
   b2DebugDraw.prototype.SetSprite = function (sprite) {}
   b2DebugDraw.prototype.GetSprite = function () {}
   b2DebugDraw.prototype.SetDrawScale = function (drawScale) {
      if (drawScale === undefined) drawScale = 0;
   }
   b2DebugDraw.prototype.GetDrawScale = function () {}
   b2DebugDraw.prototype.SetLineThickness = function (lineThickness) {
      if (lineThickness === undefined) lineThickness = 0;
   }
   b2DebugDraw.prototype.GetLineThickness = function () {}
   b2DebugDraw.prototype.SetAlpha = function (alpha) {
      if (alpha === undefined) alpha = 0;
   }
   b2DebugDraw.prototype.GetAlpha = function () {}
   b2DebugDraw.prototype.SetFillAlpha = function (alpha) {
      if (alpha === undefined) alpha = 0;
   }
   b2DebugDraw.prototype.GetFillAlpha = function () {}
   b2DebugDraw.prototype.SetXFormScale = function (xformScale) {
      if (xformScale === undefined) xformScale = 0;
   }
   b2DebugDraw.prototype.GetXFormScale = function () {}
   b2DebugDraw.prototype.DrawPolygon = function (vertices, vertexCount, color) {
      if (vertexCount === undefined) vertexCount = 0;
   }
   b2DebugDraw.prototype.DrawSolidPolygon = function (vertices, vertexCount, color) {
      if (vertexCount === undefined) vertexCount = 0;
   }
   b2DebugDraw.prototype.DrawCircle = function (center, radius, color) {
      if (radius === undefined) radius = 0;
   }
   b2DebugDraw.prototype.DrawSolidCircle = function (center, radius, axis, color) {
      if (radius === undefined) radius = 0;
   }
   b2DebugDraw.prototype.DrawSegment = function (p1, p2, color) {}
   b2DebugDraw.prototype.DrawTransform = function (xf) {}
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.b2DebugDraw.e_shapeBit = 0x0001;
      Box2D.Dynamics.b2DebugDraw.e_jointBit = 0x0002;
      Box2D.Dynamics.b2DebugDraw.e_aabbBit = 0x0004;
      Box2D.Dynamics.b2DebugDraw.e_pairBit = 0x0008;
      Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit = 0x0010;
      Box2D.Dynamics.b2DebugDraw.e_controllerBit = 0x0020;
   });
   b2DestructionListener.b2DestructionListener = function () {};
   b2DestructionListener.prototype.SayGoodbyeJoint = function (joint) {}
   b2DestructionListener.prototype.SayGoodbyeFixture = function (fixture) {}
   b2FilterData.b2FilterData = function () {
      this.categoryBits = 0x0001;
      this.maskBits = 0xFFFF;
      this.groupIndex = 0;
   };
   b2FilterData.prototype.Copy = function () {
      var copy = new b2FilterData();
      copy.categoryBits = this.categoryBits;
      copy.maskBits = this.maskBits;
      copy.groupIndex = this.groupIndex;
      return copy;
   }
   b2Fixture.b2Fixture = function () {
      this.m_filter = new b2FilterData();
   };
   b2Fixture.prototype.GetType = function () {
      return this.m_shape.GetType();
   }
   b2Fixture.prototype.GetShape = function () {
      return this.m_shape;
   }
   b2Fixture.prototype.SetSensor = function (sensor) {
      if (this.m_isSensor == sensor) return;
      this.m_isSensor = sensor;
      if (this.m_body == null) return;
      var edge = this.m_body.GetContactList();
      while (edge) {
         var contact = edge.contact;
         var fixtureA = contact.GetFixtureA();
         var fixtureB = contact.GetFixtureB();
         if (fixtureA == this || fixtureB == this) contact.SetSensor(fixtureA.IsSensor() || fixtureB.IsSensor());
         edge = edge.next;
      }
   }
   b2Fixture.prototype.IsSensor = function () {
      return this.m_isSensor;
   }
   b2Fixture.prototype.SetFilterData = function (filter) {
      this.m_filter = filter.Copy();
      if (this.m_body) return;
      var edge = this.m_body.GetContactList();
      while (edge) {
         var contact = edge.contact;
         var fixtureA = contact.GetFixtureA();
         var fixtureB = contact.GetFixtureB();
         if (fixtureA == this || fixtureB == this) contact.FlagForFiltering();
         edge = edge.next;
      }
   }
   b2Fixture.prototype.GetFilterData = function () {
      return this.m_filter.Copy();
   }
   b2Fixture.prototype.GetBody = function () {
      return this.m_body;
   }
   b2Fixture.prototype.GetNext = function () {
      return this.m_next;
   }
   b2Fixture.prototype.GetUserData = function () {
      return this.m_userData;
   }
   b2Fixture.prototype.SetUserData = function (data) {
      this.m_userData = data;
   }
   b2Fixture.prototype.TestPoint = function (p) {
      return this.m_shape.TestPoint(this.m_body.GetTransform(), p);
   }
   b2Fixture.prototype.RayCast = function (output, input) {
      return this.m_shape.RayCast(output, input, this.m_body.GetTransform());
   }
   b2Fixture.prototype.GetMassData = function (massData) {
      if (massData === undefined) massData = null;
      if (massData == null) {
         massData = new b2MassData();
      }
      this.m_shape.ComputeMass(massData, this.m_density);
      return massData;
   }
   b2Fixture.prototype.SetDensity = function (density) {
      if (density === undefined) density = 0;
      this.m_density = density;
   }
   b2Fixture.prototype.GetDensity = function () {
      return this.m_density;
   }
   b2Fixture.prototype.GetFriction = function () {
      return this.m_friction;
   }
   b2Fixture.prototype.SetFriction = function (friction) {
      if (friction === undefined) friction = 0;
      this.m_friction = friction;
   }
   b2Fixture.prototype.GetRestitution = function () {
      return this.m_restitution;
   }
   b2Fixture.prototype.SetRestitution = function (restitution) {
      if (restitution === undefined) restitution = 0;
      this.m_restitution = restitution;
   }
   b2Fixture.prototype.GetAABB = function () {
      return this.m_aabb;
   }
   b2Fixture.prototype.b2Fixture = function () {
      this.m_aabb = new b2AABB();
      this.m_userData = null;
      this.m_body = null;
      this.m_next = null;
      this.m_shape = null;
      this.m_density = 0.0;
      this.m_friction = 0.0;
      this.m_restitution = 0.0;
   }
   b2Fixture.prototype.Create = function (body, xf, def) {
      this.m_userData = def.userData;
      this.m_friction = def.friction;
      this.m_restitution = def.restitution;
      this.m_body = body;
      this.m_next = null;
      this.m_filter = def.filter.Copy();
      this.m_isSensor = def.isSensor;
      this.m_shape = def.shape.Copy();
      this.m_density = def.density;
   }
   b2Fixture.prototype.Destroy = function () {
      this.m_shape = null;
   }
   b2Fixture.prototype.CreateProxy = function (broadPhase, xf) {
      this.m_shape.ComputeAABB(this.m_aabb, xf);
      this.m_proxy = broadPhase.CreateProxy(this.m_aabb, this);
   }
   b2Fixture.prototype.DestroyProxy = function (broadPhase) {
      if (this.m_proxy == null) {
         return;
      }
      broadPhase.DestroyProxy(this.m_proxy);
      this.m_proxy = null;
   }
   b2Fixture.prototype.Synchronize = function (broadPhase, transform1, transform2) {
      if (!this.m_proxy) return;
      var aabb1 = new b2AABB();
      var aabb2 = new b2AABB();
      this.m_shape.ComputeAABB(aabb1, transform1);
      this.m_shape.ComputeAABB(aabb2, transform2);
      this.m_aabb.Combine(aabb1, aabb2);
      var displacement = b2Math.SubtractVV(transform2.position, transform1.position);
      broadPhase.MoveProxy(this.m_proxy, this.m_aabb, displacement);
   }
   b2FixtureDef.b2FixtureDef = function () {
      this.filter = new b2FilterData();
   };
   b2FixtureDef.prototype.b2FixtureDef = function () {
      this.shape = null;
      this.userData = null;
      this.friction = 0.2;
      this.restitution = 0.0;
      this.density = 0.0;
      this.filter.categoryBits = 0x0001;
      this.filter.maskBits = 0xFFFF;
      this.filter.groupIndex = 0;
      this.isSensor = false;
   }
   b2Island.b2Island = function () {};
   b2Island.prototype.b2Island = function () {
      this.m_bodies = new Vector();
      this.m_contacts = new Vector();
      this.m_joints = new Vector();
   }
   b2Island.prototype.Initialize = function (bodyCapacity, contactCapacity, jointCapacity, allocator, listener, contactSolver) {
      if (bodyCapacity === undefined) bodyCapacity = 0;
      if (contactCapacity === undefined) contactCapacity = 0;
      if (jointCapacity === undefined) jointCapacity = 0;
      var i = 0;
      this.m_bodyCapacity = bodyCapacity;
      this.m_contactCapacity = contactCapacity;
      this.m_jointCapacity = jointCapacity;
      this.m_bodyCount = 0;
      this.m_contactCount = 0;
      this.m_jointCount = 0;
      this.m_allocator = allocator;
      this.m_listener = listener;
      this.m_contactSolver = contactSolver;
      for (i = this.m_bodies.length;
      i < bodyCapacity; i++)
      this.m_bodies[i] = null;
      for (i = this.m_contacts.length;
      i < contactCapacity; i++)
      this.m_contacts[i] = null;
      for (i = this.m_joints.length;
      i < jointCapacity; i++)
      this.m_joints[i] = null;
   }
   b2Island.prototype.Clear = function () {
      this.m_bodyCount = 0;
      this.m_contactCount = 0;
      this.m_jointCount = 0;
   }
   b2Island.prototype.Solve = function (step, gravity, allowSleep) {
      var i = 0;
      var j = 0;
      var b;
      var joint;
      for (i = 0;
      i < this.m_bodyCount; ++i) {
         b = this.m_bodies[i];
         if (b.GetType() != b2Body.b2_dynamicBody) continue;
         b.m_linearVelocity.x += step.dt * (gravity.x + b.m_invMass * b.m_force.x);
         b.m_linearVelocity.y += step.dt * (gravity.y + b.m_invMass * b.m_force.y);
         b.m_angularVelocity += step.dt * b.m_invI * b.m_torque;
         b.m_linearVelocity.Multiply(b2Math.Clamp(1.0 - step.dt * b.m_linearDamping, 0.0, 1.0));
         b.m_angularVelocity *= b2Math.Clamp(1.0 - step.dt * b.m_angularDamping, 0.0, 1.0);
      }
      this.m_contactSolver.Initialize(step, this.m_contacts, this.m_contactCount, this.m_allocator);
      var contactSolver = this.m_contactSolver;
      contactSolver.InitVelocityConstraints(step);
      for (i = 0;
      i < this.m_jointCount; ++i) {
         joint = this.m_joints[i];
         joint.InitVelocityConstraints(step);
      }
      for (i = 0;
      i < step.velocityIterations; ++i) {
         for (j = 0;
         j < this.m_jointCount; ++j) {
            joint = this.m_joints[j];
            joint.SolveVelocityConstraints(step);
         }
         contactSolver.SolveVelocityConstraints();
      }
      for (i = 0;
      i < this.m_jointCount; ++i) {
         joint = this.m_joints[i];
         joint.FinalizeVelocityConstraints();
      }
      contactSolver.FinalizeVelocityConstraints();
      for (i = 0;
      i < this.m_bodyCount; ++i) {
         b = this.m_bodies[i];
         if (b.GetType() == b2Body.b2_staticBody) continue;
         var translationX = step.dt * b.m_linearVelocity.x;
         var translationY = step.dt * b.m_linearVelocity.y;
         if ((translationX * translationX + translationY * translationY) > b2Settings.b2_maxTranslationSquared) {
            b.m_linearVelocity.Normalize();
            b.m_linearVelocity.x *= b2Settings.b2_maxTranslation * step.inv_dt;
            b.m_linearVelocity.y *= b2Settings.b2_maxTranslation * step.inv_dt;
         }
         var rotation = step.dt * b.m_angularVelocity;
         if (rotation * rotation > b2Settings.b2_maxRotationSquared) {
            if (b.m_angularVelocity < 0.0) {
               b.m_angularVelocity = (-b2Settings.b2_maxRotation * step.inv_dt);
            }
            else {
               b.m_angularVelocity = b2Settings.b2_maxRotation * step.inv_dt;
            }
         }
         b.m_sweep.c0.SetV(b.m_sweep.c);
         b.m_sweep.a0 = b.m_sweep.a;
         b.m_sweep.c.x += step.dt * b.m_linearVelocity.x;
         b.m_sweep.c.y += step.dt * b.m_linearVelocity.y;
         b.m_sweep.a += step.dt * b.m_angularVelocity;
         b.SynchronizeTransform();
      }
      for (i = 0;
      i < step.positionIterations; ++i) {
         var contactsOkay = contactSolver.SolvePositionConstraints(b2Settings.b2_contactBaumgarte);
         var jointsOkay = true;
         for (j = 0;
         j < this.m_jointCount; ++j) {
            joint = this.m_joints[j];
            var jointOkay = joint.SolvePositionConstraints(b2Settings.b2_contactBaumgarte);
            jointsOkay = jointsOkay && jointOkay;
         }
         if (contactsOkay && jointsOkay) {
            break;
         }
      }
      this.Report(contactSolver.m_constraints);
      if (allowSleep) {
         var minSleepTime = Number.MAX_VALUE;
         var linTolSqr = b2Settings.b2_linearSleepTolerance * b2Settings.b2_linearSleepTolerance;
         var angTolSqr = b2Settings.b2_angularSleepTolerance * b2Settings.b2_angularSleepTolerance;
         for (i = 0;
         i < this.m_bodyCount; ++i) {
            b = this.m_bodies[i];
            if (b.GetType() == b2Body.b2_staticBody) {
               continue;
            }
            if ((b.m_flags & b2Body.e_allowSleepFlag) == 0) {
               b.m_sleepTime = 0.0;
               minSleepTime = 0.0;
            }
            if ((b.m_flags & b2Body.e_allowSleepFlag) == 0 || b.m_angularVelocity * b.m_angularVelocity > angTolSqr || b2Math.Dot(b.m_linearVelocity, b.m_linearVelocity) > linTolSqr) {
               b.m_sleepTime = 0.0;
               minSleepTime = 0.0;
            }
            else {
               b.m_sleepTime += step.dt;
               minSleepTime = b2Math.Min(minSleepTime, b.m_sleepTime);
            }
         }
         if (minSleepTime >= b2Settings.b2_timeToSleep) {
            for (i = 0;
            i < this.m_bodyCount; ++i) {
               b = this.m_bodies[i];
               b.SetAwake(false);
            }
         }
      }
   }
   b2Island.prototype.SolveTOI = function (subStep) {
      var i = 0;
      var j = 0;
      this.m_contactSolver.Initialize(subStep, this.m_contacts, this.m_contactCount, this.m_allocator);
      var contactSolver = this.m_contactSolver;
      for (i = 0;
      i < this.m_jointCount; ++i) {
         this.m_joints[i].InitVelocityConstraints(subStep);
      }
      for (i = 0;
      i < subStep.velocityIterations; ++i) {
         contactSolver.SolveVelocityConstraints();
         for (j = 0;
         j < this.m_jointCount; ++j) {
            this.m_joints[j].SolveVelocityConstraints(subStep);
         }
      }
      for (i = 0;
      i < this.m_bodyCount; ++i) {
         var b = this.m_bodies[i];
         if (b.GetType() == b2Body.b2_staticBody) continue;
         var translationX = subStep.dt * b.m_linearVelocity.x;
         var translationY = subStep.dt * b.m_linearVelocity.y;
         if ((translationX * translationX + translationY * translationY) > b2Settings.b2_maxTranslationSquared) {
            b.m_linearVelocity.Normalize();
            b.m_linearVelocity.x *= b2Settings.b2_maxTranslation * subStep.inv_dt;
            b.m_linearVelocity.y *= b2Settings.b2_maxTranslation * subStep.inv_dt;
         }
         var rotation = subStep.dt * b.m_angularVelocity;
         if (rotation * rotation > b2Settings.b2_maxRotationSquared) {
            if (b.m_angularVelocity < 0.0) {
               b.m_angularVelocity = (-b2Settings.b2_maxRotation * subStep.inv_dt);
            }
            else {
               b.m_angularVelocity = b2Settings.b2_maxRotation * subStep.inv_dt;
            }
         }
         b.m_sweep.c0.SetV(b.m_sweep.c);
         b.m_sweep.a0 = b.m_sweep.a;
         b.m_sweep.c.x += subStep.dt * b.m_linearVelocity.x;
         b.m_sweep.c.y += subStep.dt * b.m_linearVelocity.y;
         b.m_sweep.a += subStep.dt * b.m_angularVelocity;
         b.SynchronizeTransform();
      }
      var k_toiBaumgarte = 0.75;
      for (i = 0;
      i < subStep.positionIterations; ++i) {
         var contactsOkay = contactSolver.SolvePositionConstraints(k_toiBaumgarte);
         var jointsOkay = true;
         for (j = 0;
         j < this.m_jointCount; ++j) {
            var jointOkay = this.m_joints[j].SolvePositionConstraints(b2Settings.b2_contactBaumgarte);
            jointsOkay = jointsOkay && jointOkay;
         }
         if (contactsOkay && jointsOkay) {
            break;
         }
      }
      this.Report(contactSolver.m_constraints);
   }
   b2Island.prototype.Report = function (constraints) {
      if (this.m_listener == null) {
         return;
      }
      for (var i = 0; i < this.m_contactCount; ++i) {
         var c = this.m_contacts[i];
         var cc = constraints[i];
         for (var j = 0; j < cc.pointCount; ++j) {
            b2Island.s_impulse.normalImpulses[j] = cc.points[j].normalImpulse;
            b2Island.s_impulse.tangentImpulses[j] = cc.points[j].tangentImpulse;
         }
         this.m_listener.PostSolve(c, b2Island.s_impulse);
      }
   }
   b2Island.prototype.AddBody = function (body) {
      body.m_islandIndex = this.m_bodyCount;
      this.m_bodies[this.m_bodyCount++] = body;
   }
   b2Island.prototype.AddContact = function (contact) {
      this.m_contacts[this.m_contactCount++] = contact;
   }
   b2Island.prototype.AddJoint = function (joint) {
      this.m_joints[this.m_jointCount++] = joint;
   }
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.b2Island.s_impulse = new b2ContactImpulse();
   });
   b2TimeStep.b2TimeStep = function () {};
   b2TimeStep.prototype.Set = function (step) {
      this.dt = step.dt;
      this.inv_dt = step.inv_dt;
      this.positionIterations = step.positionIterations;
      this.velocityIterations = step.velocityIterations;
      this.warmStarting = step.warmStarting;
   }
   b2World.b2World = function () {
      this.s_stack = new Vector();
      this.m_contactManager = new b2ContactManager();
      this.m_contactSolver = new b2ContactSolver();
      this.m_island = new b2Island();
   };
   b2World.prototype.b2World = function (gravity, doSleep) {
      this.m_destructionListener = null;
      this.m_debugDraw = null;
      this.m_bodyList = null;
      this.m_contactList = null;
      this.m_jointList = null;
      this.m_controllerList = null;
      this.m_bodyCount = 0;
      this.m_contactCount = 0;
      this.m_jointCount = 0;
      this.m_controllerCount = 0;
      b2World.m_warmStarting = true;
      b2World.m_continuousPhysics = true;
      this.m_allowSleep = doSleep;
      this.m_gravity = gravity;
      this.m_inv_dt0 = 0.0;
      this.m_contactManager.m_world = this;
      var bd = new b2BodyDef();
      this.m_groundBody = this.CreateBody(bd);
   }
   b2World.prototype.SetDestructionListener = function (listener) {
      this.m_destructionListener = listener;
   }
   b2World.prototype.SetContactFilter = function (filter) {
      this.m_contactManager.m_contactFilter = filter;
   }
   b2World.prototype.SetContactListener = function (listener) {
      this.m_contactManager.m_contactListener = listener;
   }
   b2World.prototype.SetDebugDraw = function (debugDraw) {
      this.m_debugDraw = debugDraw;
   }
   b2World.prototype.SetBroadPhase = function (broadPhase) {
      var oldBroadPhase = this.m_contactManager.m_broadPhase;
      this.m_contactManager.m_broadPhase = broadPhase;
      for (var b = this.m_bodyList; b; b = b.m_next) {
         for (var f = b.m_fixtureList; f; f = f.m_next) {
            f.m_proxy = broadPhase.CreateProxy(oldBroadPhase.GetFatAABB(f.m_proxy), f);
         }
      }
   }
   b2World.prototype.Validate = function () {
      this.m_contactManager.m_broadPhase.Validate();
   }
   b2World.prototype.GetProxyCount = function () {
      return this.m_contactManager.m_broadPhase.GetProxyCount();
   }
   b2World.prototype.CreateBody = function (def) {
      if (this.IsLocked() == true) {
         return null;
      }
      var b = new b2Body(def, this);
      b.m_prev = null;
      b.m_next = this.m_bodyList;
      if (this.m_bodyList) {
         this.m_bodyList.m_prev = b;
      }
      this.m_bodyList = b;
      ++this.m_bodyCount;
      return b;
   }
   b2World.prototype.DestroyBody = function (b) {
      if (this.IsLocked() == true) {
         return;
      }
      var jn = b.m_jointList;
      while (jn) {
         var jn0 = jn;
         jn = jn.next;
         if (this.m_destructionListener) {
            this.m_destructionListener.SayGoodbyeJoint(jn0.joint);
         }
         this.DestroyJoint(jn0.joint);
      }
      var coe = b.m_controllerList;
      while (coe) {
         var coe0 = coe;
         coe = coe.nextController;
         coe0.controller.RemoveBody(b);
      }
      var ce = b.m_contactList;
      while (ce) {
         var ce0 = ce;
         ce = ce.next;
         this.m_contactManager.Destroy(ce0.contact);
      }
      b.m_contactList = null;
      var f = b.m_fixtureList;
      while (f) {
         var f0 = f;
         f = f.m_next;
         if (this.m_destructionListener) {
            this.m_destructionListener.SayGoodbyeFixture(f0);
         }
         f0.DestroyProxy(this.m_contactManager.m_broadPhase);
         f0.Destroy();
      }
      b.m_fixtureList = null;
      b.m_fixtureCount = 0;
      if (b.m_prev) {
         b.m_prev.m_next = b.m_next;
      }
      if (b.m_next) {
         b.m_next.m_prev = b.m_prev;
      }
      if (b == this.m_bodyList) {
         this.m_bodyList = b.m_next;
      }--this.m_bodyCount;
   }
   b2World.prototype.CreateJoint = function (def) {
      var j = b2Joint.Create(def, null);
      j.m_prev = null;
      j.m_next = this.m_jointList;
      if (this.m_jointList) {
         this.m_jointList.m_prev = j;
      }
      this.m_jointList = j;
      ++this.m_jointCount;
      j.m_edgeA.joint = j;
      j.m_edgeA.other = j.m_bodyB;
      j.m_edgeA.prev = null;
      j.m_edgeA.next = j.m_bodyA.m_jointList;
      if (j.m_bodyA.m_jointList) j.m_bodyA.m_jointList.prev = j.m_edgeA;
      j.m_bodyA.m_jointList = j.m_edgeA;
      j.m_edgeB.joint = j;
      j.m_edgeB.other = j.m_bodyA;
      j.m_edgeB.prev = null;
      j.m_edgeB.next = j.m_bodyB.m_jointList;
      if (j.m_bodyB.m_jointList) j.m_bodyB.m_jointList.prev = j.m_edgeB;
      j.m_bodyB.m_jointList = j.m_edgeB;
      var bodyA = def.bodyA;
      var bodyB = def.bodyB;
      if (def.collideConnected == false) {
         var edge = bodyB.GetContactList();
         while (edge) {
            if (edge.other == bodyA) {
               edge.contact.FlagForFiltering();
            }
            edge = edge.next;
         }
      }
      return j;
   }
   b2World.prototype.DestroyJoint = function (j) {
      var collideConnected = j.m_collideConnected;
      if (j.m_prev) {
         j.m_prev.m_next = j.m_next;
      }
      if (j.m_next) {
         j.m_next.m_prev = j.m_prev;
      }
      if (j == this.m_jointList) {
         this.m_jointList = j.m_next;
      }
      var bodyA = j.m_bodyA;
      var bodyB = j.m_bodyB;
      bodyA.SetAwake(true);
      bodyB.SetAwake(true);
      if (j.m_edgeA.prev) {
         j.m_edgeA.prev.next = j.m_edgeA.next;
      }
      if (j.m_edgeA.next) {
         j.m_edgeA.next.prev = j.m_edgeA.prev;
      }
      if (j.m_edgeA == bodyA.m_jointList) {
         bodyA.m_jointList = j.m_edgeA.next;
      }
      j.m_edgeA.prev = null;
      j.m_edgeA.next = null;
      if (j.m_edgeB.prev) {
         j.m_edgeB.prev.next = j.m_edgeB.next;
      }
      if (j.m_edgeB.next) {
         j.m_edgeB.next.prev = j.m_edgeB.prev;
      }
      if (j.m_edgeB == bodyB.m_jointList) {
         bodyB.m_jointList = j.m_edgeB.next;
      }
      j.m_edgeB.prev = null;
      j.m_edgeB.next = null;
      b2Joint.Destroy(j, null);
      --this.m_jointCount;
      if (collideConnected == false) {
         var edge = bodyB.GetContactList();
         while (edge) {
            if (edge.other == bodyA) {
               edge.contact.FlagForFiltering();
            }
            edge = edge.next;
         }
      }
   }
   b2World.prototype.AddController = function (c) {
      c.m_next = this.m_controllerList;
      c.m_prev = null;
      this.m_controllerList = c;
      c.m_world = this;
      this.m_controllerCount++;
      return c;
   }
   b2World.prototype.RemoveController = function (c) {
      if (c.m_prev) c.m_prev.m_next = c.m_next;
      if (c.m_next) c.m_next.m_prev = c.m_prev;
      if (this.m_controllerList == c) this.m_controllerList = c.m_next;
      this.m_controllerCount--;
   }
   b2World.prototype.CreateController = function (controller) {
      if (controller.m_world != this) throw new Error("Controller can only be a member of one world");
      controller.m_next = this.m_controllerList;
      controller.m_prev = null;
      if (this.m_controllerList) this.m_controllerList.m_prev = controller;
      this.m_controllerList = controller;
      ++this.m_controllerCount;
      controller.m_world = this;
      return controller;
   }
   b2World.prototype.DestroyController = function (controller) {
      controller.Clear();
      if (controller.m_next) controller.m_next.m_prev = controller.m_prev;
      if (controller.m_prev) controller.m_prev.m_next = controller.m_next;
      if (controller == this.m_controllerList) this.m_controllerList = controller.m_next;
      --this.m_controllerCount;
   }
   b2World.prototype.SetWarmStarting = function (flag) {
      b2World.m_warmStarting = flag;
   }
   b2World.prototype.SetContinuousPhysics = function (flag) {
      b2World.m_continuousPhysics = flag;
   }
   b2World.prototype.GetBodyCount = function () {
      return this.m_bodyCount;
   }
   b2World.prototype.GetJointCount = function () {
      return this.m_jointCount;
   }
   b2World.prototype.GetContactCount = function () {
      return this.m_contactCount;
   }
   b2World.prototype.SetGravity = function (gravity) {
      this.m_gravity = gravity;
   }
   b2World.prototype.GetGravity = function () {
      return this.m_gravity;
   }
   b2World.prototype.GetGroundBody = function () {
      return this.m_groundBody;
   }
   b2World.prototype.Step = function (dt, velocityIterations, positionIterations) {
      if (dt === undefined) dt = 0;
      if (velocityIterations === undefined) velocityIterations = 0;
      if (positionIterations === undefined) positionIterations = 0;
      if (this.m_flags & b2World.e_newFixture) {
         this.m_contactManager.FindNewContacts();
         this.m_flags &= ~b2World.e_newFixture;
      }
      this.m_flags |= b2World.e_locked;
      var step = b2World.s_timestep2;
      step.dt = dt;
      step.velocityIterations = velocityIterations;
      step.positionIterations = positionIterations;
      if (dt > 0.0) {
         step.inv_dt = 1.0 / dt;
      }
      else {
         step.inv_dt = 0.0;
      }
      step.dtRatio = this.m_inv_dt0 * dt;
      step.warmStarting = b2World.m_warmStarting;
      this.m_contactManager.Collide();
      if (step.dt > 0.0) {
         this.Solve(step);
      }
      if (b2World.m_continuousPhysics && step.dt > 0.0) {
         this.SolveTOI(step);
      }
      if (step.dt > 0.0) {
         this.m_inv_dt0 = step.inv_dt;
      }
      this.m_flags &= ~b2World.e_locked;
   }
   b2World.prototype.ClearForces = function () {
      for (var body = this.m_bodyList; body; body = body.m_next) {
         body.m_force.SetZero();
         body.m_torque = 0.0;
      }
   }
   b2World.prototype.DrawDebugData = function () {
      if (this.m_debugDraw == null) {
         return;
      }
      this.m_debugDraw.m_sprite.graphics.clear();
      var flags = this.m_debugDraw.GetFlags();
      var i = 0;
      var b;
      var f;
      var s;
      var j;
      var bp;
      var invQ = new b2Vec2;
      var x1 = new b2Vec2;
      var x2 = new b2Vec2;
      var xf;
      var b1 = new b2AABB();
      var b2 = new b2AABB();
      var vs = [new b2Vec2(), new b2Vec2(), new b2Vec2(), new b2Vec2()];
      var color = new b2Color(0, 0, 0);
      if (flags & b2DebugDraw.e_shapeBit) {
         for (b = this.m_bodyList;
         b; b = b.m_next) {
            xf = b.m_xf;
            for (f = b.GetFixtureList();
            f; f = f.m_next) {
               s = f.GetShape();
               if (b.IsActive() == false) {
                  color.Set(0.5, 0.5, 0.3);
                  this.DrawShape(s, xf, color);
               }
               else if (b.GetType() == b2Body.b2_staticBody) {
                  color.Set(0.5, 0.9, 0.5);
                  this.DrawShape(s, xf, color);
               }
               else if (b.GetType() == b2Body.b2_kinematicBody) {
                  color.Set(0.5, 0.5, 0.9);
                  this.DrawShape(s, xf, color);
               }
               else if (b.IsAwake() == false) {
                  color.Set(0.6, 0.6, 0.6);
                  this.DrawShape(s, xf, color);
               }
               else {
                  color.Set(0.9, 0.7, 0.7);
                  this.DrawShape(s, xf, color);
               }
            }
         }
      }
      if (flags & b2DebugDraw.e_jointBit) {
         for (j = this.m_jointList;
         j; j = j.m_next) {
            this.DrawJoint(j);
         }
      }
      if (flags & b2DebugDraw.e_controllerBit) {
         for (var c = this.m_controllerList; c; c = c.m_next) {
            c.Draw(this.m_debugDraw);
         }
      }
      if (flags & b2DebugDraw.e_pairBit) {
         color.Set(0.3, 0.9, 0.9);
         for (var contact = this.m_contactManager.m_contactList; contact; contact = contact.GetNext()) {
            var fixtureA = contact.GetFixtureA();
            var fixtureB = contact.GetFixtureB();
            var cA = fixtureA.GetAABB().GetCenter();
            var cB = fixtureB.GetAABB().GetCenter();
            this.m_debugDraw.DrawSegment(cA, cB, color);
         }
      }
      if (flags & b2DebugDraw.e_aabbBit) {
         bp = this.m_contactManager.m_broadPhase;
         vs = [new b2Vec2(), new b2Vec2(), new b2Vec2(), new b2Vec2()];
         for (b = this.m_bodyList;
         b; b = b.GetNext()) {
            if (b.IsActive() == false) {
               continue;
            }
            for (f = b.GetFixtureList();
            f; f = f.GetNext()) {
               var aabb = bp.GetFatAABB(f.m_proxy);
               vs[0].Set(aabb.lowerBound.x, aabb.lowerBound.y);
               vs[1].Set(aabb.upperBound.x, aabb.lowerBound.y);
               vs[2].Set(aabb.upperBound.x, aabb.upperBound.y);
               vs[3].Set(aabb.lowerBound.x, aabb.upperBound.y);
               this.m_debugDraw.DrawPolygon(vs, 4, color);
            }
         }
      }
      if (flags & b2DebugDraw.e_centerOfMassBit) {
         for (b = this.m_bodyList;
         b; b = b.m_next) {
            xf = b2World.s_xf;
            xf.R = b.m_xf.R;
            xf.position = b.GetWorldCenter();
            this.m_debugDraw.DrawTransform(xf);
         }
      }
   }
   b2World.prototype.QueryAABB = function (callback, aabb) {
      var __this = this;
      var broadPhase = __this.m_contactManager.m_broadPhase;

      function WorldQueryWrapper(proxy) {
         return callback(broadPhase.GetUserData(proxy));
      };
      broadPhase.Query(WorldQueryWrapper, aabb);
   }
   b2World.prototype.QueryShape = function (callback, shape, transform) {
      var __this = this;
      if (transform === undefined) transform = null;
      if (transform == null) {
         transform = new b2Transform();
         transform.SetIdentity();
      }
      var broadPhase = __this.m_contactManager.m_broadPhase;

      function WorldQueryWrapper(proxy) {
         var fixture = (broadPhase.GetUserData(proxy) instanceof b2Fixture ? broadPhase.GetUserData(proxy) : null);
         if (b2Shape.TestOverlap(shape, transform, fixture.GetShape(), fixture.GetBody().GetTransform())) return callback(fixture);
         return true;
      };
      var aabb = new b2AABB();
      shape.ComputeAABB(aabb, transform);
      broadPhase.Query(WorldQueryWrapper, aabb);
   }
   b2World.prototype.QueryPoint = function (callback, p) {
      var __this = this;
      var broadPhase = __this.m_contactManager.m_broadPhase;

      function WorldQueryWrapper(proxy) {
         var fixture = (broadPhase.GetUserData(proxy) instanceof b2Fixture ? broadPhase.GetUserData(proxy) : null);
         if (fixture.TestPoint(p)) return callback(fixture);
         return true;
      };
      var aabb = new b2AABB();
      aabb.lowerBound.Set(p.x - b2Settings.b2_linearSlop, p.y - b2Settings.b2_linearSlop);
      aabb.upperBound.Set(p.x + b2Settings.b2_linearSlop, p.y + b2Settings.b2_linearSlop);
      broadPhase.Query(WorldQueryWrapper, aabb);
   }
   b2World.prototype.RayCast = function (callback, point1, point2) {
      var __this = this;
      var broadPhase = __this.m_contactManager.m_broadPhase;
      var output = new b2RayCastOutput;

      function RayCastWrapper(input, proxy) {
         var userData = broadPhase.GetUserData(proxy);
         var fixture = (userData instanceof b2Fixture ? userData : null);
         var hit = fixture.RayCast(output, input);
         if (hit) {
            var fraction = output.fraction;
            var point = new b2Vec2((1.0 - fraction) * point1.x + fraction * point2.x, (1.0 - fraction) * point1.y + fraction * point2.y);
            return callback(fixture, point, output.normal, fraction);
         }
         return input.maxFraction;
      };
      var input = new b2RayCastInput(point1, point2);
      broadPhase.RayCast(RayCastWrapper, input);
   }
   b2World.prototype.RayCastOne = function (point1, point2) {
      var __this = this;
      var result;

      function RayCastOneWrapper(fixture, point, normal, fraction) {
         if (fraction === undefined) fraction = 0;
         result = fixture;
         return fraction;
      };
      __this.RayCast(RayCastOneWrapper, point1, point2);
      return result;
   }
   b2World.prototype.RayCastAll = function (point1, point2) {
      var __this = this;
      var result = new Vector();

      function RayCastAllWrapper(fixture, point, normal, fraction) {
         if (fraction === undefined) fraction = 0;
         result[result.length] = fixture;
         return 1;
      };
      __this.RayCast(RayCastAllWrapper, point1, point2);
      return result;
   }
   b2World.prototype.GetBodyList = function () {
      return this.m_bodyList;
   }
   b2World.prototype.GetJointList = function () {
      return this.m_jointList;
   }
   b2World.prototype.GetContactList = function () {
      return this.m_contactList;
   }
   b2World.prototype.IsLocked = function () {
      return (this.m_flags & b2World.e_locked) > 0;
   }
   b2World.prototype.Solve = function (step) {
      var b;
      for (var controller = this.m_controllerList; controller; controller = controller.m_next) {
         controller.Step(step);
      }
      var island = this.m_island;
      island.Initialize(this.m_bodyCount, this.m_contactCount, this.m_jointCount, null, this.m_contactManager.m_contactListener, this.m_contactSolver);
      for (b = this.m_bodyList;
      b; b = b.m_next) {
         b.m_flags &= ~b2Body.e_islandFlag;
      }
      for (var c = this.m_contactList; c; c = c.m_next) {
         c.m_flags &= ~b2Contact.e_islandFlag;
      }
      for (var j = this.m_jointList; j; j = j.m_next) {
         j.m_islandFlag = false;
      }
      var stackSize = parseInt(this.m_bodyCount);
      var stack = this.s_stack;
      for (var seed = this.m_bodyList; seed; seed = seed.m_next) {
         if (seed.m_flags & b2Body.e_islandFlag) {
            continue;
         }
         if (seed.IsAwake() == false || seed.IsActive() == false) {
            continue;
         }
         if (seed.GetType() == b2Body.b2_staticBody) {
            continue;
         }
         island.Clear();
         var stackCount = 0;
         stack[stackCount++] = seed;
         seed.m_flags |= b2Body.e_islandFlag;
         while (stackCount > 0) {
            b = stack[--stackCount];
            island.AddBody(b);
            if (b.IsAwake() == false) {
               b.SetAwake(true);
            }
            if (b.GetType() == b2Body.b2_staticBody) {
               continue;
            }
            var other;
            for (var ce = b.m_contactList; ce; ce = ce.next) {
               if (ce.contact.m_flags & b2Contact.e_islandFlag) {
                  continue;
               }
               if (ce.contact.IsSensor() == true || ce.contact.IsEnabled() == false || ce.contact.IsTouching() == false) {
                  continue;
               }
               island.AddContact(ce.contact);
               ce.contact.m_flags |= b2Contact.e_islandFlag;
               other = ce.other;
               if (other.m_flags & b2Body.e_islandFlag) {
                  continue;
               }
               stack[stackCount++] = other;
               other.m_flags |= b2Body.e_islandFlag;
            }
            for (var jn = b.m_jointList; jn; jn = jn.next) {
               if (jn.joint.m_islandFlag == true) {
                  continue;
               }
               other = jn.other;
               if (other.IsActive() == false) {
                  continue;
               }
               island.AddJoint(jn.joint);
               jn.joint.m_islandFlag = true;
               if (other.m_flags & b2Body.e_islandFlag) {
                  continue;
               }
               stack[stackCount++] = other;
               other.m_flags |= b2Body.e_islandFlag;
            }
         }
         island.Solve(step, this.m_gravity, this.m_allowSleep);
         for (var i = 0; i < island.m_bodyCount; ++i) {
            b = island.m_bodies[i];
            if (b.GetType() == b2Body.b2_staticBody) {
               b.m_flags &= ~b2Body.e_islandFlag;
            }
         }
      }
      for (i = 0;
      i < stack.length; ++i) {
         if (!stack[i]) break;
         stack[i] = null;
      }
      for (b = this.m_bodyList;
      b; b = b.m_next) {
         if (b.IsAwake() == false || b.IsActive() == false) {
            continue;
         }
         if (b.GetType() == b2Body.b2_staticBody) {
            continue;
         }
         b.SynchronizeFixtures();
      }
      this.m_contactManager.FindNewContacts();
   }
   b2World.prototype.SolveTOI = function (step) {
      var b;
      var fA;
      var fB;
      var bA;
      var bB;
      var cEdge;
      var j;
      var island = this.m_island;
      island.Initialize(this.m_bodyCount, b2Settings.b2_maxTOIContactsPerIsland, b2Settings.b2_maxTOIJointsPerIsland, null, this.m_contactManager.m_contactListener, this.m_contactSolver);
      var queue = b2World.s_queue;
      for (b = this.m_bodyList;
      b; b = b.m_next) {
         b.m_flags &= ~b2Body.e_islandFlag;
         b.m_sweep.t0 = 0.0;
      }
      var c;
      for (c = this.m_contactList;
      c; c = c.m_next) {
         c.m_flags &= ~ (b2Contact.e_toiFlag | b2Contact.e_islandFlag);
      }
      for (j = this.m_jointList;
      j; j = j.m_next) {
         j.m_islandFlag = false;
      }
      for (;;) {
         var minContact = null;
         var minTOI = 1.0;
         for (c = this.m_contactList;
         c; c = c.m_next) {
            if (c.IsSensor() == true || c.IsEnabled() == false || c.IsContinuous() == false) {
               continue;
            }
            var toi = 1.0;
            if (c.m_flags & b2Contact.e_toiFlag) {
               toi = c.m_toi;
            }
            else {
               fA = c.m_fixtureA;
               fB = c.m_fixtureB;
               bA = fA.m_body;
               bB = fB.m_body;
               if ((bA.GetType() != b2Body.b2_dynamicBody || bA.IsAwake() == false) && (bB.GetType() != b2Body.b2_dynamicBody || bB.IsAwake() == false)) {
                  continue;
               }
               var t0 = bA.m_sweep.t0;
               if (bA.m_sweep.t0 < bB.m_sweep.t0) {
                  t0 = bB.m_sweep.t0;
                  bA.m_sweep.Advance(t0);
               }
               else if (bB.m_sweep.t0 < bA.m_sweep.t0) {
                  t0 = bA.m_sweep.t0;
                  bB.m_sweep.Advance(t0);
               }
               toi = c.ComputeTOI(bA.m_sweep, bB.m_sweep);
               b2Settings.b2Assert(0.0 <= toi && toi <= 1.0);
               if (toi > 0.0 && toi < 1.0) {
                  toi = (1.0 - toi) * t0 + toi;
                  if (toi > 1) toi = 1;
               }
               c.m_toi = toi;
               c.m_flags |= b2Contact.e_toiFlag;
            }
            if (Number.MIN_VALUE < toi && toi < minTOI) {
               minContact = c;
               minTOI = toi;
            }
         }
         if (minContact == null || 1.0 - 100.0 * Number.MIN_VALUE < minTOI) {
            break;
         }
         fA = minContact.m_fixtureA;
         fB = minContact.m_fixtureB;
         bA = fA.m_body;
         bB = fB.m_body;
         b2World.s_backupA.Set(bA.m_sweep);
         b2World.s_backupB.Set(bB.m_sweep);
         bA.Advance(minTOI);
         bB.Advance(minTOI);
         minContact.Update(this.m_contactManager.m_contactListener);
         minContact.m_flags &= ~b2Contact.e_toiFlag;
         if (minContact.IsSensor() == true || minContact.IsEnabled() == false) {
            bA.m_sweep.Set(b2World.s_backupA);
            bB.m_sweep.Set(b2World.s_backupB);
            bA.SynchronizeTransform();
            bB.SynchronizeTransform();
            continue;
         }
         if (minContact.IsTouching() == false) {
            continue;
         }
         var seed = bA;
         if (seed.GetType() != b2Body.b2_dynamicBody) {
            seed = bB;
         }
         island.Clear();
         var queueStart = 0;
         var queueSize = 0;
         queue[queueStart + queueSize++] = seed;
         seed.m_flags |= b2Body.e_islandFlag;
         while (queueSize > 0) {
            b = queue[queueStart++];
            --queueSize;
            island.AddBody(b);
            if (b.IsAwake() == false) {
               b.SetAwake(true);
            }
            if (b.GetType() != b2Body.b2_dynamicBody) {
               continue;
            }
            for (cEdge = b.m_contactList;
            cEdge; cEdge = cEdge.next) {
               if (island.m_contactCount == island.m_contactCapacity) {
                  break;
               }
               if (cEdge.contact.m_flags & b2Contact.e_islandFlag) {
                  continue;
               }
               if (cEdge.contact.IsSensor() == true || cEdge.contact.IsEnabled() == false || cEdge.contact.IsTouching() == false) {
                  continue;
               }
               island.AddContact(cEdge.contact);
               cEdge.contact.m_flags |= b2Contact.e_islandFlag;
               var other = cEdge.other;
               if (other.m_flags & b2Body.e_islandFlag) {
                  continue;
               }
               if (other.GetType() != b2Body.b2_staticBody) {
                  other.Advance(minTOI);
                  other.SetAwake(true);
               }
               queue[queueStart + queueSize] = other;
               ++queueSize;
               other.m_flags |= b2Body.e_islandFlag;
            }
            for (var jEdge = b.m_jointList; jEdge; jEdge = jEdge.next) {
               if (island.m_jointCount == island.m_jointCapacity) continue;
               if (jEdge.joint.m_islandFlag == true) continue;
               other = jEdge.other;
               if (other.IsActive() == false) {
                  continue;
               }
               island.AddJoint(jEdge.joint);
               jEdge.joint.m_islandFlag = true;
               if (other.m_flags & b2Body.e_islandFlag) continue;
               if (other.GetType() != b2Body.b2_staticBody) {
                  other.Advance(minTOI);
                  other.SetAwake(true);
               }
               queue[queueStart + queueSize] = other;
               ++queueSize;
               other.m_flags |= b2Body.e_islandFlag;
            }
         }
         var subStep = b2World.s_timestep;
         subStep.warmStarting = false;
         subStep.dt = (1.0 - minTOI) * step.dt;
         subStep.inv_dt = 1.0 / subStep.dt;
         subStep.dtRatio = 0.0;
         subStep.velocityIterations = step.velocityIterations;
         subStep.positionIterations = step.positionIterations;
         island.SolveTOI(subStep);
         var i = 0;
         for (i = 0;
         i < island.m_bodyCount; ++i) {
            b = island.m_bodies[i];
            b.m_flags &= ~b2Body.e_islandFlag;
            if (b.IsAwake() == false) {
               continue;
            }
            if (b.GetType() != b2Body.b2_dynamicBody) {
               continue;
            }
            b.SynchronizeFixtures();
            for (cEdge = b.m_contactList;
            cEdge; cEdge = cEdge.next) {
               cEdge.contact.m_flags &= ~b2Contact.e_toiFlag;
            }
         }
         for (i = 0;
         i < island.m_contactCount; ++i) {
            c = island.m_contacts[i];
            c.m_flags &= ~ (b2Contact.e_toiFlag | b2Contact.e_islandFlag);
         }
         for (i = 0;
         i < island.m_jointCount; ++i) {
            j = island.m_joints[i];
            j.m_islandFlag = false;
         }
         this.m_contactManager.FindNewContacts();
      }
   }
   b2World.prototype.DrawJoint = function (joint) {
      var b1 = joint.GetBodyA();
      var b2 = joint.GetBodyB();
      var xf1 = b1.m_xf;
      var xf2 = b2.m_xf;
      var x1 = xf1.position;
      var x2 = xf2.position;
      var p1 = joint.GetAnchorA();
      var p2 = joint.GetAnchorB();
      var color = b2World.s_jointColor;
      switch (joint.m_type) {
      case b2Joint.e_distanceJoint:
         this.m_debugDraw.DrawSegment(p1, p2, color);
         break;
      case b2Joint.e_pulleyJoint:
         {
            var pulley = ((joint instanceof b2PulleyJoint ? joint : null));
            var s1 = pulley.GetGroundAnchorA();
            var s2 = pulley.GetGroundAnchorB();
            this.m_debugDraw.DrawSegment(s1, p1, color);
            this.m_debugDraw.DrawSegment(s2, p2, color);
            this.m_debugDraw.DrawSegment(s1, s2, color);
         }
         break;
      case b2Joint.e_mouseJoint:
         this.m_debugDraw.DrawSegment(p1, p2, color);
         break;
      default:
         if (b1 != this.m_groundBody) this.m_debugDraw.DrawSegment(x1, p1, color);
         this.m_debugDraw.DrawSegment(p1, p2, color);
         if (b2 != this.m_groundBody) this.m_debugDraw.DrawSegment(x2, p2, color);
      }
   }
   b2World.prototype.DrawShape = function (shape, xf, color) {
      switch (shape.m_type) {
      case b2Shape.e_circleShape:
         {
            var circle = ((shape instanceof b2CircleShape ? shape : null));
            var center = b2Math.MulX(xf, circle.m_p);
            var radius = circle.m_radius;
            var axis = xf.R.col1;
            this.m_debugDraw.DrawSolidCircle(center, radius, axis, color);
         }
         break;
      case b2Shape.e_polygonShape:
         {
            var i = 0;
            var poly = ((shape instanceof b2PolygonShape ? shape : null));
            var vertexCount = parseInt(poly.GetVertexCount());
            var localVertices = poly.GetVertices();
            var vertices = new Vector(vertexCount);
            for (i = 0;
            i < vertexCount; ++i) {
               vertices[i] = b2Math.MulX(xf, localVertices[i]);
            }
            this.m_debugDraw.DrawSolidPolygon(vertices, vertexCount, color);
         }
         break;
      case b2Shape.e_edgeShape:
         {
            var edge = (shape instanceof b2EdgeShape ? shape : null);
            this.m_debugDraw.DrawSegment(b2Math.MulX(xf, edge.GetVertex1()), b2Math.MulX(xf, edge.GetVertex2()), color);
         }
         break;
      }
   }
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.b2World.s_timestep2 = new b2TimeStep();
      Box2D.Dynamics.b2World.s_xf = new b2Transform();
      Box2D.Dynamics.b2World.s_backupA = new b2Sweep();
      Box2D.Dynamics.b2World.s_backupB = new b2Sweep();
      Box2D.Dynamics.b2World.s_timestep = new b2TimeStep();
      Box2D.Dynamics.b2World.s_queue = new Vector();
      Box2D.Dynamics.b2World.s_jointColor = new b2Color(0.5, 0.8, 0.8);
      Box2D.Dynamics.b2World.e_newFixture = 0x0001;
      Box2D.Dynamics.b2World.e_locked = 0x0002;
   });
})();
(function () {
   var b2CircleShape = Box2D.Collision.Shapes.b2CircleShape,
      b2EdgeChainDef = Box2D.Collision.Shapes.b2EdgeChainDef,
      b2EdgeShape = Box2D.Collision.Shapes.b2EdgeShape,
      b2MassData = Box2D.Collision.Shapes.b2MassData,
      b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape,
      b2Shape = Box2D.Collision.Shapes.b2Shape,
      b2CircleContact = Box2D.Dynamics.Contacts.b2CircleContact,
      b2Contact = Box2D.Dynamics.Contacts.b2Contact,
      b2ContactConstraint = Box2D.Dynamics.Contacts.b2ContactConstraint,
      b2ContactConstraintPoint = Box2D.Dynamics.Contacts.b2ContactConstraintPoint,
      b2ContactEdge = Box2D.Dynamics.Contacts.b2ContactEdge,
      b2ContactFactory = Box2D.Dynamics.Contacts.b2ContactFactory,
      b2ContactRegister = Box2D.Dynamics.Contacts.b2ContactRegister,
      b2ContactResult = Box2D.Dynamics.Contacts.b2ContactResult,
      b2ContactSolver = Box2D.Dynamics.Contacts.b2ContactSolver,
      b2EdgeAndCircleContact = Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,
      b2NullContact = Box2D.Dynamics.Contacts.b2NullContact,
      b2PolyAndCircleContact = Box2D.Dynamics.Contacts.b2PolyAndCircleContact,
      b2PolyAndEdgeContact = Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,
      b2PolygonContact = Box2D.Dynamics.Contacts.b2PolygonContact,
      b2PositionSolverManifold = Box2D.Dynamics.Contacts.b2PositionSolverManifold,
      b2Body = Box2D.Dynamics.b2Body,
      b2BodyDef = Box2D.Dynamics.b2BodyDef,
      b2ContactFilter = Box2D.Dynamics.b2ContactFilter,
      b2ContactImpulse = Box2D.Dynamics.b2ContactImpulse,
      b2ContactListener = Box2D.Dynamics.b2ContactListener,
      b2ContactManager = Box2D.Dynamics.b2ContactManager,
      b2DebugDraw = Box2D.Dynamics.b2DebugDraw,
      b2DestructionListener = Box2D.Dynamics.b2DestructionListener,
      b2FilterData = Box2D.Dynamics.b2FilterData,
      b2Fixture = Box2D.Dynamics.b2Fixture,
      b2FixtureDef = Box2D.Dynamics.b2FixtureDef,
      b2Island = Box2D.Dynamics.b2Island,
      b2TimeStep = Box2D.Dynamics.b2TimeStep,
      b2World = Box2D.Dynamics.b2World,
      b2Color = Box2D.Common.b2Color,
      b2internal = Box2D.Common.b2internal,
      b2Settings = Box2D.Common.b2Settings,
      b2Mat22 = Box2D.Common.Math.b2Mat22,
      b2Mat33 = Box2D.Common.Math.b2Mat33,
      b2Math = Box2D.Common.Math.b2Math,
      b2Sweep = Box2D.Common.Math.b2Sweep,
      b2Transform = Box2D.Common.Math.b2Transform,
      b2Vec2 = Box2D.Common.Math.b2Vec2,
      b2Vec3 = Box2D.Common.Math.b2Vec3,
      b2AABB = Box2D.Collision.b2AABB,
      b2Bound = Box2D.Collision.b2Bound,
      b2BoundValues = Box2D.Collision.b2BoundValues,
      b2Collision = Box2D.Collision.b2Collision,
      b2ContactID = Box2D.Collision.b2ContactID,
      b2ContactPoint = Box2D.Collision.b2ContactPoint,
      b2Distance = Box2D.Collision.b2Distance,
      b2DistanceInput = Box2D.Collision.b2DistanceInput,
      b2DistanceOutput = Box2D.Collision.b2DistanceOutput,
      b2DistanceProxy = Box2D.Collision.b2DistanceProxy,
      b2DynamicTree = Box2D.Collision.b2DynamicTree,
      b2DynamicTreeBroadPhase = Box2D.Collision.b2DynamicTreeBroadPhase,
      b2DynamicTreeNode = Box2D.Collision.b2DynamicTreeNode,
      b2DynamicTreePair = Box2D.Collision.b2DynamicTreePair,
      b2Manifold = Box2D.Collision.b2Manifold,
      b2ManifoldPoint = Box2D.Collision.b2ManifoldPoint,
      b2Point = Box2D.Collision.b2Point,
      b2RayCastInput = Box2D.Collision.b2RayCastInput,
      b2RayCastOutput = Box2D.Collision.b2RayCastOutput,
      b2Segment = Box2D.Collision.b2Segment,
      b2SeparationFunction = Box2D.Collision.b2SeparationFunction,
      b2Simplex = Box2D.Collision.b2Simplex,
      b2SimplexCache = Box2D.Collision.b2SimplexCache,
      b2SimplexVertex = Box2D.Collision.b2SimplexVertex,
      b2TimeOfImpact = Box2D.Collision.b2TimeOfImpact,
      b2TOIInput = Box2D.Collision.b2TOIInput,
      b2WorldManifold = Box2D.Collision.b2WorldManifold,
      ClipVertex = Box2D.Collision.ClipVertex,
      Features = Box2D.Collision.Features,
      IBroadPhase = Box2D.Collision.IBroadPhase;

   Box2D.inherit(b2CircleContact, Box2D.Dynamics.Contacts.b2Contact);
   b2CircleContact.prototype.__super = Box2D.Dynamics.Contacts.b2Contact.prototype;
   b2CircleContact.b2CircleContact = function () {
      Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this, arguments);
   };
   b2CircleContact.Create = function (allocator) {
      return new b2CircleContact();
   }
   b2CircleContact.Destroy = function (contact, allocator) {}
   b2CircleContact.prototype.Reset = function (fixtureA, fixtureB) {
      this.__super.Reset.call(this, fixtureA, fixtureB);
   }
   b2CircleContact.prototype.Evaluate = function () {
      var bA = this.m_fixtureA.GetBody();
      var bB = this.m_fixtureB.GetBody();
      b2Collision.CollideCircles(this.m_manifold, (this.m_fixtureA.GetShape() instanceof b2CircleShape ? this.m_fixtureA.GetShape() : null), bA.m_xf, (this.m_fixtureB.GetShape() instanceof b2CircleShape ? this.m_fixtureB.GetShape() : null), bB.m_xf);
   }
   b2Contact.b2Contact = function () {
      this.m_nodeA = new b2ContactEdge();
      this.m_nodeB = new b2ContactEdge();
      this.m_manifold = new b2Manifold();
      this.m_oldManifold = new b2Manifold();
   };
   b2Contact.prototype.GetManifold = function () {
      return this.m_manifold;
   }
   b2Contact.prototype.GetWorldManifold = function (worldManifold) {
      var bodyA = this.m_fixtureA.GetBody();
      var bodyB = this.m_fixtureB.GetBody();
      var shapeA = this.m_fixtureA.GetShape();
      var shapeB = this.m_fixtureB.GetShape();
      worldManifold.Initialize(this.m_manifold, bodyA.GetTransform(), shapeA.m_radius, bodyB.GetTransform(), shapeB.m_radius);
   }
   b2Contact.prototype.IsTouching = function () {
      return (this.m_flags & b2Contact.e_touchingFlag) == b2Contact.e_touchingFlag;
   }
   b2Contact.prototype.IsContinuous = function () {
      return (this.m_flags & b2Contact.e_continuousFlag) == b2Contact.e_continuousFlag;
   }
   b2Contact.prototype.SetSensor = function (sensor) {
      if (sensor) {
         this.m_flags |= b2Contact.e_sensorFlag;
      }
      else {
         this.m_flags &= ~b2Contact.e_sensorFlag;
      }
   }
   b2Contact.prototype.IsSensor = function () {
      return (this.m_flags & b2Contact.e_sensorFlag) == b2Contact.e_sensorFlag;
   }
   b2Contact.prototype.SetEnabled = function (flag) {
      if (flag) {
         this.m_flags |= b2Contact.e_enabledFlag;
      }
      else {
         this.m_flags &= ~b2Contact.e_enabledFlag;
      }
   }
   b2Contact.prototype.IsEnabled = function () {
      return (this.m_flags & b2Contact.e_enabledFlag) == b2Contact.e_enabledFlag;
   }
   b2Contact.prototype.GetNext = function () {
      return this.m_next;
   }
   b2Contact.prototype.GetFixtureA = function () {
      return this.m_fixtureA;
   }
   b2Contact.prototype.GetFixtureB = function () {
      return this.m_fixtureB;
   }
   b2Contact.prototype.FlagForFiltering = function () {
      this.m_flags |= b2Contact.e_filterFlag;
   }
   b2Contact.prototype.b2Contact = function () {}
   b2Contact.prototype.Reset = function (fixtureA, fixtureB) {
      if (fixtureA === undefined) fixtureA = null;
      if (fixtureB === undefined) fixtureB = null;
      this.m_flags = b2Contact.e_enabledFlag;
      if (!fixtureA || !fixtureB) {
         this.m_fixtureA = null;
         this.m_fixtureB = null;
         return;
      }
      if (fixtureA.IsSensor() || fixtureB.IsSensor()) {
         this.m_flags |= b2Contact.e_sensorFlag;
      }
      var bodyA = fixtureA.GetBody();
      var bodyB = fixtureB.GetBody();
      if (bodyA.GetType() != b2Body.b2_dynamicBody || bodyA.IsBullet() || bodyB.GetType() != b2Body.b2_dynamicBody || bodyB.IsBullet()) {
         this.m_flags |= b2Contact.e_continuousFlag;
      }
      this.m_fixtureA = fixtureA;
      this.m_fixtureB = fixtureB;
      this.m_manifold.m_pointCount = 0;
      this.m_prev = null;
      this.m_next = null;
      this.m_nodeA.contact = null;
      this.m_nodeA.prev = null;
      this.m_nodeA.next = null;
      this.m_nodeA.other = null;
      this.m_nodeB.contact = null;
      this.m_nodeB.prev = null;
      this.m_nodeB.next = null;
      this.m_nodeB.other = null;
   }
   b2Contact.prototype.Update = function (listener) {
      var tManifold = this.m_oldManifold;
      this.m_oldManifold = this.m_manifold;
      this.m_manifold = tManifold;
      this.m_flags |= b2Contact.e_enabledFlag;
      var touching = false;
      var wasTouching = (this.m_flags & b2Contact.e_touchingFlag) == b2Contact.e_touchingFlag;
      var bodyA = this.m_fixtureA.m_body;
      var bodyB = this.m_fixtureB.m_body;
      var aabbOverlap = this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);
      if (this.m_flags & b2Contact.e_sensorFlag) {
         if (aabbOverlap) {
            var shapeA = this.m_fixtureA.GetShape();
            var shapeB = this.m_fixtureB.GetShape();
            var xfA = bodyA.GetTransform();
            var xfB = bodyB.GetTransform();
            touching = b2Shape.TestOverlap(shapeA, xfA, shapeB, xfB);
         }
         this.m_manifold.m_pointCount = 0;
      }
      else {
         if (bodyA.GetType() != b2Body.b2_dynamicBody || bodyA.IsBullet() || bodyB.GetType() != b2Body.b2_dynamicBody || bodyB.IsBullet()) {
            this.m_flags |= b2Contact.e_continuousFlag;
         }
         else {
            this.m_flags &= ~b2Contact.e_continuousFlag;
         }
         if (aabbOverlap) {
            this.Evaluate();
            touching = this.m_manifold.m_pointCount > 0;
            for (var i = 0; i < this.m_manifold.m_pointCount; ++i) {
               var mp2 = this.m_manifold.m_points[i];
               mp2.m_normalImpulse = 0.0;
               mp2.m_tangentImpulse = 0.0;
               var id2 = mp2.m_id;
               for (var j = 0; j < this.m_oldManifold.m_pointCount; ++j) {
                  var mp1 = this.m_oldManifold.m_points[j];
                  if (mp1.m_id.key == id2.key) {
                     mp2.m_normalImpulse = mp1.m_normalImpulse;
                     mp2.m_tangentImpulse = mp1.m_tangentImpulse;
                     break;
                  }
               }
            }
         }
         else {
            this.m_manifold.m_pointCount = 0;
         }
         if (touching != wasTouching) {
            bodyA.SetAwake(true);
            bodyB.SetAwake(true);
         }
      }
      if (touching) {
         this.m_flags |= b2Contact.e_touchingFlag;
      }
      else {
         this.m_flags &= ~b2Contact.e_touchingFlag;
      }
      if (wasTouching == false && touching == true) {
         listener.BeginContact(this);
      }
      if (wasTouching == true && touching == false) {
         listener.EndContact(this);
      }
      if ((this.m_flags & b2Contact.e_sensorFlag) == 0) {
         listener.PreSolve(this, this.m_oldManifold);
      }
   }
   b2Contact.prototype.Evaluate = function () {}
   b2Contact.prototype.ComputeTOI = function (sweepA, sweepB) {
      b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape());
      b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape());
      b2Contact.s_input.sweepA = sweepA;
      b2Contact.s_input.sweepB = sweepB;
      b2Contact.s_input.tolerance = b2Settings.b2_linearSlop;
      return b2TimeOfImpact.TimeOfImpact(b2Contact.s_input);
   }
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag = 0x0001;
      Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag = 0x0002;
      Box2D.Dynamics.Contacts.b2Contact.e_islandFlag = 0x0004;
      Box2D.Dynamics.Contacts.b2Contact.e_toiFlag = 0x0008;
      Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag = 0x0010;
      Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag = 0x0020;
      Box2D.Dynamics.Contacts.b2Contact.e_filterFlag = 0x0040;
      Box2D.Dynamics.Contacts.b2Contact.s_input = new b2TOIInput();
   });
   b2ContactConstraint.b2ContactConstraint = function () {
      this.localPlaneNormal = new b2Vec2();
      this.localPoint = new b2Vec2();
      this.normal = new b2Vec2();
      this.normalMass = new b2Mat22();
      this.K = new b2Mat22();
   };
   b2ContactConstraint.prototype.b2ContactConstraint = function () {
      this.points = new Vector(b2Settings.b2_maxManifoldPoints);
      for (var i = 0; i < b2Settings.b2_maxManifoldPoints; i++) {
         this.points[i] = new b2ContactConstraintPoint();
      }
   }
   b2ContactConstraintPoint.b2ContactConstraintPoint = function () {
      this.localPoint = new b2Vec2();
      this.rA = new b2Vec2();
      this.rB = new b2Vec2();
   };
   b2ContactEdge.b2ContactEdge = function () {};
   b2ContactFactory.b2ContactFactory = function () {};
   b2ContactFactory.prototype.b2ContactFactory = function (allocator) {
      this.m_allocator = allocator;
      this.InitializeRegisters();
   }
   b2ContactFactory.prototype.AddType = function (createFcn, destroyFcn, type1, type2) {
      if (type1 === undefined) type1 = 0;
      if (type2 === undefined) type2 = 0;
      this.m_registers[type1][type2].createFcn = createFcn;
      this.m_registers[type1][type2].destroyFcn = destroyFcn;
      this.m_registers[type1][type2].primary = true;
      if (type1 != type2) {
         this.m_registers[type2][type1].createFcn = createFcn;
         this.m_registers[type2][type1].destroyFcn = destroyFcn;
         this.m_registers[type2][type1].primary = false;
      }
   }
   b2ContactFactory.prototype.InitializeRegisters = function () {
      this.m_registers = new Vector(b2Shape.e_shapeTypeCount);
      for (var i = 0; i < b2Shape.e_shapeTypeCount; i++) {
         this.m_registers[i] = new Vector(b2Shape.e_shapeTypeCount);
         for (var j = 0; j < b2Shape.e_shapeTypeCount; j++) {
            this.m_registers[i][j] = new b2ContactRegister();
         }
      }
      this.AddType(b2CircleContact.Create, b2CircleContact.Destroy, b2Shape.e_circleShape, b2Shape.e_circleShape);
      this.AddType(b2PolyAndCircleContact.Create, b2PolyAndCircleContact.Destroy, b2Shape.e_polygonShape, b2Shape.e_circleShape);
      this.AddType(b2PolygonContact.Create, b2PolygonContact.Destroy, b2Shape.e_polygonShape, b2Shape.e_polygonShape);
      this.AddType(b2EdgeAndCircleContact.Create, b2EdgeAndCircleContact.Destroy, b2Shape.e_edgeShape, b2Shape.e_circleShape);
      this.AddType(b2PolyAndEdgeContact.Create, b2PolyAndEdgeContact.Destroy, b2Shape.e_polygonShape, b2Shape.e_edgeShape);
   }
   b2ContactFactory.prototype.Create = function (fixtureA, fixtureB) {
      var type1 = parseInt(fixtureA.GetType());
      var type2 = parseInt(fixtureB.GetType());
      var reg = this.m_registers[type1][type2];
      var c;
      if (reg.pool) {
         c = reg.pool;
         reg.pool = c.m_next;
         reg.poolCount--;
         c.Reset(fixtureA, fixtureB);
         return c;
      }
      var createFcn = reg.createFcn;
      if (createFcn != null) {
         if (reg.primary) {
            c = createFcn(this.m_allocator);
            c.Reset(fixtureA, fixtureB);
            return c;
         }
         else {
            c = createFcn(this.m_allocator);
            c.Reset(fixtureB, fixtureA);
            return c;
         }
      }
      else {
         return null;
      }
   }
   b2ContactFactory.prototype.Destroy = function (contact) {
      if (contact.m_manifold.m_pointCount > 0) {
         contact.m_fixtureA.m_body.SetAwake(true);
         contact.m_fixtureB.m_body.SetAwake(true);
      }
      var type1 = parseInt(contact.m_fixtureA.GetType());
      var type2 = parseInt(contact.m_fixtureB.GetType());
      var reg = this.m_registers[type1][type2];
      if (true) {
         reg.poolCount++;
         contact.m_next = reg.pool;
         reg.pool = contact;
      }
      var destroyFcn = reg.destroyFcn;
      destroyFcn(contact, this.m_allocator);
   }
   b2ContactRegister.b2ContactRegister = function () {};
   b2ContactResult.b2ContactResult = function () {
      this.position = new b2Vec2();
      this.normal = new b2Vec2();
      this.id = new b2ContactID();
   };
   b2ContactSolver.b2ContactSolver = function () {
      this.m_step = new b2TimeStep();
      this.m_constraints = new Vector();
   };
   b2ContactSolver.prototype.b2ContactSolver = function () {}
   b2ContactSolver.prototype.Initialize = function (step, contacts, contactCount, allocator) {
      if (contactCount === undefined) contactCount = 0;
      var contact;
      this.m_step.Set(step);
      this.m_allocator = allocator;
      var i = 0;
      var tVec;
      var tMat;
      this.m_constraintCount = contactCount;
      while (this.m_constraints.length < this.m_constraintCount) {
         this.m_constraints[this.m_constraints.length] = new b2ContactConstraint();
      }
      for (i = 0;
      i < contactCount; ++i) {
         contact = contacts[i];
         var fixtureA = contact.m_fixtureA;
         var fixtureB = contact.m_fixtureB;
         var shapeA = fixtureA.m_shape;
         var shapeB = fixtureB.m_shape;
         var radiusA = shapeA.m_radius;
         var radiusB = shapeB.m_radius;
         var bodyA = fixtureA.m_body;
         var bodyB = fixtureB.m_body;
         var manifold = contact.GetManifold();
         var friction = b2Settings.b2MixFriction(fixtureA.GetFriction(), fixtureB.GetFriction());
         var restitution = b2Settings.b2MixRestitution(fixtureA.GetRestitution(), fixtureB.GetRestitution());
         var vAX = bodyA.m_linearVelocity.x;
         var vAY = bodyA.m_linearVelocity.y;
         var vBX = bodyB.m_linearVelocity.x;
         var vBY = bodyB.m_linearVelocity.y;
         var wA = bodyA.m_angularVelocity;
         var wB = bodyB.m_angularVelocity;
         b2Settings.b2Assert(manifold.m_pointCount > 0);
         b2ContactSolver.s_worldManifold.Initialize(manifold, bodyA.m_xf, radiusA, bodyB.m_xf, radiusB);
         var normalX = b2ContactSolver.s_worldManifold.m_normal.x;
         var normalY = b2ContactSolver.s_worldManifold.m_normal.y;
         var cc = this.m_constraints[i];
         cc.bodyA = bodyA;
         cc.bodyB = bodyB;
         cc.manifold = manifold;
         cc.normal.x = normalX;
         cc.normal.y = normalY;
         cc.pointCount = manifold.m_pointCount;
         cc.friction = friction;
         cc.restitution = restitution;
         cc.localPlaneNormal.x = manifold.m_localPlaneNormal.x;
         cc.localPlaneNormal.y = manifold.m_localPlaneNormal.y;
         cc.localPoint.x = manifold.m_localPoint.x;
         cc.localPoint.y = manifold.m_localPoint.y;
         cc.radius = radiusA + radiusB;
         cc.type = manifold.m_type;
         for (var k = 0; k < cc.pointCount; ++k) {
            var cp = manifold.m_points[k];
            var ccp = cc.points[k];
            ccp.normalImpulse = cp.m_normalImpulse;
            ccp.tangentImpulse = cp.m_tangentImpulse;
            ccp.localPoint.SetV(cp.m_localPoint);
            var rAX = ccp.rA.x = b2ContactSolver.s_worldManifold.m_points[k].x - bodyA.m_sweep.c.x;
            var rAY = ccp.rA.y = b2ContactSolver.s_worldManifold.m_points[k].y - bodyA.m_sweep.c.y;
            var rBX = ccp.rB.x = b2ContactSolver.s_worldManifold.m_points[k].x - bodyB.m_sweep.c.x;
            var rBY = ccp.rB.y = b2ContactSolver.s_worldManifold.m_points[k].y - bodyB.m_sweep.c.y;
            var rnA = rAX * normalY - rAY * normalX;
            var rnB = rBX * normalY - rBY * normalX;
            rnA *= rnA;
            rnB *= rnB;
            var kNormal = bodyA.m_invMass + bodyB.m_invMass + bodyA.m_invI * rnA + bodyB.m_invI * rnB;
            ccp.normalMass = 1.0 / kNormal;
            var kEqualized = bodyA.m_mass * bodyA.m_invMass + bodyB.m_mass * bodyB.m_invMass;
            kEqualized += bodyA.m_mass * bodyA.m_invI * rnA + bodyB.m_mass * bodyB.m_invI * rnB;
            ccp.equalizedMass = 1.0 / kEqualized;
            var tangentX = normalY;
            var tangentY = (-normalX);
            var rtA = rAX * tangentY - rAY * tangentX;
            var rtB = rBX * tangentY - rBY * tangentX;
            rtA *= rtA;
            rtB *= rtB;
            var kTangent = bodyA.m_invMass + bodyB.m_invMass + bodyA.m_invI * rtA + bodyB.m_invI * rtB;
            ccp.tangentMass = 1.0 / kTangent;
            ccp.velocityBias = 0.0;
            var tX = vBX + ((-wB * rBY)) - vAX - ((-wA * rAY));
            var tY = vBY + (wB * rBX) - vAY - (wA * rAX);
            var vRel = cc.normal.x * tX + cc.normal.y * tY;
            if (vRel < (-b2Settings.b2_velocityThreshold)) {
               ccp.velocityBias += (-cc.restitution * vRel);
            }
         }
         if (cc.pointCount == 2) {
            var ccp1 = cc.points[0];
            var ccp2 = cc.points[1];
            var invMassA = bodyA.m_invMass;
            var invIA = bodyA.m_invI;
            var invMassB = bodyB.m_invMass;
            var invIB = bodyB.m_invI;
            var rn1A = ccp1.rA.x * normalY - ccp1.rA.y * normalX;
            var rn1B = ccp1.rB.x * normalY - ccp1.rB.y * normalX;
            var rn2A = ccp2.rA.x * normalY - ccp2.rA.y * normalX;
            var rn2B = ccp2.rB.x * normalY - ccp2.rB.y * normalX;
            var k11 = invMassA + invMassB + invIA * rn1A * rn1A + invIB * rn1B * rn1B;
            var k22 = invMassA + invMassB + invIA * rn2A * rn2A + invIB * rn2B * rn2B;
            var k12 = invMassA + invMassB + invIA * rn1A * rn2A + invIB * rn1B * rn2B;
            var k_maxConditionNumber = 100.0;
            if (k11 * k11 < k_maxConditionNumber * (k11 * k22 - k12 * k12)) {
               cc.K.col1.Set(k11, k12);
               cc.K.col2.Set(k12, k22);
               cc.K.GetInverse(cc.normalMass);
            }
            else {
               cc.pointCount = 1;
            }
         }
      }
   }
   b2ContactSolver.prototype.InitVelocityConstraints = function (step) {
      var tVec;
      var tVec2;
      var tMat;
      for (var i = 0; i < this.m_constraintCount; ++i) {
         var c = this.m_constraints[i];
         var bodyA = c.bodyA;
         var bodyB = c.bodyB;
         var invMassA = bodyA.m_invMass;
         var invIA = bodyA.m_invI;
         var invMassB = bodyB.m_invMass;
         var invIB = bodyB.m_invI;
         var normalX = c.normal.x;
         var normalY = c.normal.y;
         var tangentX = normalY;
         var tangentY = (-normalX);
         var tX = 0;
         var j = 0;
         var tCount = 0;
         if (step.warmStarting) {
            tCount = c.pointCount;
            for (j = 0;
            j < tCount; ++j) {
               var ccp = c.points[j];
               ccp.normalImpulse *= step.dtRatio;
               ccp.tangentImpulse *= step.dtRatio;
               var PX = ccp.normalImpulse * normalX + ccp.tangentImpulse * tangentX;
               var PY = ccp.normalImpulse * normalY + ccp.tangentImpulse * tangentY;
               bodyA.m_angularVelocity -= invIA * (ccp.rA.x * PY - ccp.rA.y * PX);
               bodyA.m_linearVelocity.x -= invMassA * PX;
               bodyA.m_linearVelocity.y -= invMassA * PY;
               bodyB.m_angularVelocity += invIB * (ccp.rB.x * PY - ccp.rB.y * PX);
               bodyB.m_linearVelocity.x += invMassB * PX;
               bodyB.m_linearVelocity.y += invMassB * PY;
            }
         }
         else {
            tCount = c.pointCount;
            for (j = 0;
            j < tCount; ++j) {
               var ccp2 = c.points[j];
               ccp2.normalImpulse = 0.0;
               ccp2.tangentImpulse = 0.0;
            }
         }
      }
   }
   b2ContactSolver.prototype.SolveVelocityConstraints = function () {
      var j = 0;
      var ccp;
      var rAX = 0;
      var rAY = 0;
      var rBX = 0;
      var rBY = 0;
      var dvX = 0;
      var dvY = 0;
      var vn = 0;
      var vt = 0;
      var lambda = 0;
      var maxFriction = 0;
      var newImpulse = 0;
      var PX = 0;
      var PY = 0;
      var dX = 0;
      var dY = 0;
      var P1X = 0;
      var P1Y = 0;
      var P2X = 0;
      var P2Y = 0;
      var tMat;
      var tVec;
      for (var i = 0; i < this.m_constraintCount; ++i) {
         var c = this.m_constraints[i];
         var bodyA = c.bodyA;
         var bodyB = c.bodyB;
         var wA = bodyA.m_angularVelocity;
         var wB = bodyB.m_angularVelocity;
         var vA = bodyA.m_linearVelocity;
         var vB = bodyB.m_linearVelocity;
         var invMassA = bodyA.m_invMass;
         var invIA = bodyA.m_invI;
         var invMassB = bodyB.m_invMass;
         var invIB = bodyB.m_invI;
         var normalX = c.normal.x;
         var normalY = c.normal.y;
         var tangentX = normalY;
         var tangentY = (-normalX);
         var friction = c.friction;
         var tX = 0;
         for (j = 0;
         j < c.pointCount; j++) {
            ccp = c.points[j];
            dvX = vB.x - wB * ccp.rB.y - vA.x + wA * ccp.rA.y;
            dvY = vB.y + wB * ccp.rB.x - vA.y - wA * ccp.rA.x;
            vt = dvX * tangentX + dvY * tangentY;
            lambda = ccp.tangentMass * (-vt);
            maxFriction = friction * ccp.normalImpulse;
            newImpulse = b2Math.Clamp(ccp.tangentImpulse + lambda, (-maxFriction), maxFriction);
            lambda = newImpulse - ccp.tangentImpulse;
            PX = lambda * tangentX;
            PY = lambda * tangentY;
            vA.x -= invMassA * PX;
            vA.y -= invMassA * PY;
            wA -= invIA * (ccp.rA.x * PY - ccp.rA.y * PX);
            vB.x += invMassB * PX;
            vB.y += invMassB * PY;
            wB += invIB * (ccp.rB.x * PY - ccp.rB.y * PX);
            ccp.tangentImpulse = newImpulse;
         }
         var tCount = parseInt(c.pointCount);
         if (c.pointCount == 1) {
            ccp = c.points[0];
            dvX = vB.x + ((-wB * ccp.rB.y)) - vA.x - ((-wA * ccp.rA.y));
            dvY = vB.y + (wB * ccp.rB.x) - vA.y - (wA * ccp.rA.x);
            vn = dvX * normalX + dvY * normalY;
            lambda = (-ccp.normalMass * (vn - ccp.velocityBias));
            newImpulse = ccp.normalImpulse + lambda;
            newImpulse = newImpulse > 0 ? newImpulse : 0.0;
            lambda = newImpulse - ccp.normalImpulse;
            PX = lambda * normalX;
            PY = lambda * normalY;
            vA.x -= invMassA * PX;
            vA.y -= invMassA * PY;
            wA -= invIA * (ccp.rA.x * PY - ccp.rA.y * PX);
            vB.x += invMassB * PX;
            vB.y += invMassB * PY;
            wB += invIB * (ccp.rB.x * PY - ccp.rB.y * PX);
            ccp.normalImpulse = newImpulse;
         }
         else {
            var cp1 = c.points[0];
            var cp2 = c.points[1];
            var aX = cp1.normalImpulse;
            var aY = cp2.normalImpulse;
            var dv1X = vB.x - wB * cp1.rB.y - vA.x + wA * cp1.rA.y;
            var dv1Y = vB.y + wB * cp1.rB.x - vA.y - wA * cp1.rA.x;
            var dv2X = vB.x - wB * cp2.rB.y - vA.x + wA * cp2.rA.y;
            var dv2Y = vB.y + wB * cp2.rB.x - vA.y - wA * cp2.rA.x;
            var vn1 = dv1X * normalX + dv1Y * normalY;
            var vn2 = dv2X * normalX + dv2Y * normalY;
            var bX = vn1 - cp1.velocityBias;
            var bY = vn2 - cp2.velocityBias;
            tMat = c.K;
            bX -= tMat.col1.x * aX + tMat.col2.x * aY;
            bY -= tMat.col1.y * aX + tMat.col2.y * aY;
            var k_errorTol = 0.001;
            for (;;) {
               tMat = c.normalMass;
               var xX = (-(tMat.col1.x * bX + tMat.col2.x * bY));
               var xY = (-(tMat.col1.y * bX + tMat.col2.y * bY));
               if (xX >= 0.0 && xY >= 0.0) {
                  dX = xX - aX;
                  dY = xY - aY;
                  P1X = dX * normalX;
                  P1Y = dX * normalY;
                  P2X = dY * normalX;
                  P2Y = dY * normalY;
                  vA.x -= invMassA * (P1X + P2X);
                  vA.y -= invMassA * (P1Y + P2Y);
                  wA -= invIA * (cp1.rA.x * P1Y - cp1.rA.y * P1X + cp2.rA.x * P2Y - cp2.rA.y * P2X);
                  vB.x += invMassB * (P1X + P2X);
                  vB.y += invMassB * (P1Y + P2Y);
                  wB += invIB * (cp1.rB.x * P1Y - cp1.rB.y * P1X + cp2.rB.x * P2Y - cp2.rB.y * P2X);
                  cp1.normalImpulse = xX;
                  cp2.normalImpulse = xY;
                  break;
               }
               xX = (-cp1.normalMass * bX);
               xY = 0.0;
               vn1 = 0.0;
               vn2 = c.K.col1.y * xX + bY;
               if (xX >= 0.0 && vn2 >= 0.0) {
                  dX = xX - aX;
                  dY = xY - aY;
                  P1X = dX * normalX;
                  P1Y = dX * normalY;
                  P2X = dY * normalX;
                  P2Y = dY * normalY;
                  vA.x -= invMassA * (P1X + P2X);
                  vA.y -= invMassA * (P1Y + P2Y);
                  wA -= invIA * (cp1.rA.x * P1Y - cp1.rA.y * P1X + cp2.rA.x * P2Y - cp2.rA.y * P2X);
                  vB.x += invMassB * (P1X + P2X);
                  vB.y += invMassB * (P1Y + P2Y);
                  wB += invIB * (cp1.rB.x * P1Y - cp1.rB.y * P1X + cp2.rB.x * P2Y - cp2.rB.y * P2X);
                  cp1.normalImpulse = xX;
                  cp2.normalImpulse = xY;
                  break;
               }
               xX = 0.0;
               xY = (-cp2.normalMass * bY);
               vn1 = c.K.col2.x * xY + bX;
               vn2 = 0.0;
               if (xY >= 0.0 && vn1 >= 0.0) {
                  dX = xX - aX;
                  dY = xY - aY;
                  P1X = dX * normalX;
                  P1Y = dX * normalY;
                  P2X = dY * normalX;
                  P2Y = dY * normalY;
                  vA.x -= invMassA * (P1X + P2X);
                  vA.y -= invMassA * (P1Y + P2Y);
                  wA -= invIA * (cp1.rA.x * P1Y - cp1.rA.y * P1X + cp2.rA.x * P2Y - cp2.rA.y * P2X);
                  vB.x += invMassB * (P1X + P2X);
                  vB.y += invMassB * (P1Y + P2Y);
                  wB += invIB * (cp1.rB.x * P1Y - cp1.rB.y * P1X + cp2.rB.x * P2Y - cp2.rB.y * P2X);
                  cp1.normalImpulse = xX;
                  cp2.normalImpulse = xY;
                  break;
               }
               xX = 0.0;
               xY = 0.0;
               vn1 = bX;
               vn2 = bY;
               if (vn1 >= 0.0 && vn2 >= 0.0) {
                  dX = xX - aX;
                  dY = xY - aY;
                  P1X = dX * normalX;
                  P1Y = dX * normalY;
                  P2X = dY * normalX;
                  P2Y = dY * normalY;
                  vA.x -= invMassA * (P1X + P2X);
                  vA.y -= invMassA * (P1Y + P2Y);
                  wA -= invIA * (cp1.rA.x * P1Y - cp1.rA.y * P1X + cp2.rA.x * P2Y - cp2.rA.y * P2X);
                  vB.x += invMassB * (P1X + P2X);
                  vB.y += invMassB * (P1Y + P2Y);
                  wB += invIB * (cp1.rB.x * P1Y - cp1.rB.y * P1X + cp2.rB.x * P2Y - cp2.rB.y * P2X);
                  cp1.normalImpulse = xX;
                  cp2.normalImpulse = xY;
                  break;
               }
               break;
            }
         }
         bodyA.m_angularVelocity = wA;
         bodyB.m_angularVelocity = wB;
      }
   }
   b2ContactSolver.prototype.FinalizeVelocityConstraints = function () {
      for (var i = 0; i < this.m_constraintCount; ++i) {
         var c = this.m_constraints[i];
         var m = c.manifold;
         for (var j = 0; j < c.pointCount; ++j) {
            var point1 = m.m_points[j];
            var point2 = c.points[j];
            point1.m_normalImpulse = point2.normalImpulse;
            point1.m_tangentImpulse = point2.tangentImpulse;
         }
      }
   }
   b2ContactSolver.prototype.SolvePositionConstraints = function (baumgarte) {
      if (baumgarte === undefined) baumgarte = 0;
      var minSeparation = 0.0;
      for (var i = 0; i < this.m_constraintCount; i++) {
         var c = this.m_constraints[i];
         var bodyA = c.bodyA;
         var bodyB = c.bodyB;
         var invMassA = bodyA.m_mass * bodyA.m_invMass;
         var invIA = bodyA.m_mass * bodyA.m_invI;
         var invMassB = bodyB.m_mass * bodyB.m_invMass;
         var invIB = bodyB.m_mass * bodyB.m_invI;
         b2ContactSolver.s_psm.Initialize(c);
         var normal = b2ContactSolver.s_psm.m_normal;
         for (var j = 0; j < c.pointCount; j++) {
            var ccp = c.points[j];
            var point = b2ContactSolver.s_psm.m_points[j];
            var separation = b2ContactSolver.s_psm.m_separations[j];
            var rAX = point.x - bodyA.m_sweep.c.x;
            var rAY = point.y - bodyA.m_sweep.c.y;
            var rBX = point.x - bodyB.m_sweep.c.x;
            var rBY = point.y - bodyB.m_sweep.c.y;
            minSeparation = minSeparation < separation ? minSeparation : separation;
            var C = b2Math.Clamp(baumgarte * (separation + b2Settings.b2_linearSlop), (-b2Settings.b2_maxLinearCorrection), 0.0);
            var impulse = (-ccp.equalizedMass * C);
            var PX = impulse * normal.x;
            var PY = impulse * normal.y;bodyA.m_sweep.c.x -= invMassA * PX;
            bodyA.m_sweep.c.y -= invMassA * PY;
            bodyA.m_sweep.a -= invIA * (rAX * PY - rAY * PX);
            bodyA.SynchronizeTransform();
            bodyB.m_sweep.c.x += invMassB * PX;
            bodyB.m_sweep.c.y += invMassB * PY;
            bodyB.m_sweep.a += invIB * (rBX * PY - rBY * PX);
            bodyB.SynchronizeTransform();
         }
      }
      return minSeparation > (-1.5 * b2Settings.b2_linearSlop);
   }
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold = new b2WorldManifold();
      Box2D.Dynamics.Contacts.b2ContactSolver.s_psm = new b2PositionSolverManifold();
   });
   Box2D.inherit(b2EdgeAndCircleContact, Box2D.Dynamics.Contacts.b2Contact);
   b2EdgeAndCircleContact.prototype.__super = Box2D.Dynamics.Contacts.b2Contact.prototype;
   b2EdgeAndCircleContact.b2EdgeAndCircleContact = function () {
      Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this, arguments);
   };
   b2EdgeAndCircleContact.Create = function (allocator) {
      return new b2EdgeAndCircleContact();
   }
   b2EdgeAndCircleContact.Destroy = function (contact, allocator) {}
   b2EdgeAndCircleContact.prototype.Reset = function (fixtureA, fixtureB) {
      this.__super.Reset.call(this, fixtureA, fixtureB);
   }
   b2EdgeAndCircleContact.prototype.Evaluate = function () {
      var bA = this.m_fixtureA.GetBody();
      var bB = this.m_fixtureB.GetBody();
      this.b2CollideEdgeAndCircle(this.m_manifold, (this.m_fixtureA.GetShape() instanceof b2EdgeShape ? this.m_fixtureA.GetShape() : null), bA.m_xf, (this.m_fixtureB.GetShape() instanceof b2CircleShape ? this.m_fixtureB.GetShape() : null), bB.m_xf);
   }
   b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle = function (manifold, edge, xf1, circle, xf2) {}
   Box2D.inherit(b2NullContact, Box2D.Dynamics.Contacts.b2Contact);
   b2NullContact.prototype.__super = Box2D.Dynamics.Contacts.b2Contact.prototype;
   b2NullContact.b2NullContact = function () {
      Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this, arguments);
   };
   b2NullContact.prototype.b2NullContact = function () {
      this.__super.b2Contact.call(this);
   }
   b2NullContact.prototype.Evaluate = function () {}
   Box2D.inherit(b2PolyAndCircleContact, Box2D.Dynamics.Contacts.b2Contact);
   b2PolyAndCircleContact.prototype.__super = Box2D.Dynamics.Contacts.b2Contact.prototype;
   b2PolyAndCircleContact.b2PolyAndCircleContact = function () {
      Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this, arguments);
   };
   b2PolyAndCircleContact.Create = function (allocator) {
      return new b2PolyAndCircleContact();
   }
   b2PolyAndCircleContact.Destroy = function (contact, allocator) {}
   b2PolyAndCircleContact.prototype.Reset = function (fixtureA, fixtureB) {
      this.__super.Reset.call(this, fixtureA, fixtureB);
      b2Settings.b2Assert(fixtureA.GetType() == b2Shape.e_polygonShape);
      b2Settings.b2Assert(fixtureB.GetType() == b2Shape.e_circleShape);
   }
   b2PolyAndCircleContact.prototype.Evaluate = function () {
      var bA = this.m_fixtureA.m_body;
      var bB = this.m_fixtureB.m_body;
      b2Collision.CollidePolygonAndCircle(this.m_manifold, (this.m_fixtureA.GetShape() instanceof b2PolygonShape ? this.m_fixtureA.GetShape() : null), bA.m_xf, (this.m_fixtureB.GetShape() instanceof b2CircleShape ? this.m_fixtureB.GetShape() : null), bB.m_xf);
   }
   Box2D.inherit(b2PolyAndEdgeContact, Box2D.Dynamics.Contacts.b2Contact);
   b2PolyAndEdgeContact.prototype.__super = Box2D.Dynamics.Contacts.b2Contact.prototype;
   b2PolyAndEdgeContact.b2PolyAndEdgeContact = function () {
      Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this, arguments);
   };
   b2PolyAndEdgeContact.Create = function (allocator) {
      return new b2PolyAndEdgeContact();
   }
   b2PolyAndEdgeContact.Destroy = function (contact, allocator) {}
   b2PolyAndEdgeContact.prototype.Reset = function (fixtureA, fixtureB) {
      this.__super.Reset.call(this, fixtureA, fixtureB);
      b2Settings.b2Assert(fixtureA.GetType() == b2Shape.e_polygonShape);
      b2Settings.b2Assert(fixtureB.GetType() == b2Shape.e_edgeShape);
   }
   b2PolyAndEdgeContact.prototype.Evaluate = function () {
      var bA = this.m_fixtureA.GetBody();
      var bB = this.m_fixtureB.GetBody();
      this.b2CollidePolyAndEdge(this.m_manifold, (this.m_fixtureA.GetShape() instanceof b2PolygonShape ? this.m_fixtureA.GetShape() : null), bA.m_xf, (this.m_fixtureB.GetShape() instanceof b2EdgeShape ? this.m_fixtureB.GetShape() : null), bB.m_xf);
   }
   b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge = function (manifold, polygon, xf1, edge, xf2) {}
   Box2D.inherit(b2PolygonContact, Box2D.Dynamics.Contacts.b2Contact);
   b2PolygonContact.prototype.__super = Box2D.Dynamics.Contacts.b2Contact.prototype;
   b2PolygonContact.b2PolygonContact = function () {
      Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this, arguments);
   };
   b2PolygonContact.Create = function (allocator) {
      return new b2PolygonContact();
   }
   b2PolygonContact.Destroy = function (contact, allocator) {}
   b2PolygonContact.prototype.Reset = function (fixtureA, fixtureB) {
      this.__super.Reset.call(this, fixtureA, fixtureB);
   }
   b2PolygonContact.prototype.Evaluate = function () {
      var bA = this.m_fixtureA.GetBody();
      var bB = this.m_fixtureB.GetBody();
      b2Collision.CollidePolygons(this.m_manifold, (this.m_fixtureA.GetShape() instanceof b2PolygonShape ? this.m_fixtureA.GetShape() : null), bA.m_xf, (this.m_fixtureB.GetShape() instanceof b2PolygonShape ? this.m_fixtureB.GetShape() : null), bB.m_xf);
   }
   b2PositionSolverManifold.b2PositionSolverManifold = function () {};
   b2PositionSolverManifold.prototype.b2PositionSolverManifold = function () {
      this.m_normal = new b2Vec2();
      this.m_separations = new Vector_a2j_Number(b2Settings.b2_maxManifoldPoints);
      this.m_points = new Vector(b2Settings.b2_maxManifoldPoints);
      for (var i = 0; i < b2Settings.b2_maxManifoldPoints; i++) {
         this.m_points[i] = new b2Vec2();
      }
   }
   b2PositionSolverManifold.prototype.Initialize = function (cc) {
      b2Settings.b2Assert(cc.pointCount > 0);
      var i = 0;
      var clipPointX = 0;
      var clipPointY = 0;
      var tMat;
      var tVec;
      var planePointX = 0;
      var planePointY = 0;
      switch (cc.type) {
      case b2Manifold.e_circles:
         {
            tMat = cc.bodyA.m_xf.R;
            tVec = cc.localPoint;
            var pointAX = cc.bodyA.m_xf.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
            var pointAY = cc.bodyA.m_xf.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
            tMat = cc.bodyB.m_xf.R;
            tVec = cc.points[0].localPoint;
            var pointBX = cc.bodyB.m_xf.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
            var pointBY = cc.bodyB.m_xf.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
            var dX = pointBX - pointAX;
            var dY = pointBY - pointAY;
            var d2 = dX * dX + dY * dY;
            if (d2 > Number.MIN_VALUE * Number.MIN_VALUE) {
               var d = Math.sqrt(d2);
               this.m_normal.x = dX / d;
               this.m_normal.y = dY / d;
            }
            else {
               this.m_normal.x = 1.0;
               this.m_normal.y = 0.0;
            }
            this.m_points[0].x = 0.5 * (pointAX + pointBX);
            this.m_points[0].y = 0.5 * (pointAY + pointBY);
            this.m_separations[0] = dX * this.m_normal.x + dY * this.m_normal.y - cc.radius;
         }
         break;
      case b2Manifold.e_faceA:
         {
            tMat = cc.bodyA.m_xf.R;
            tVec = cc.localPlaneNormal;
            this.m_normal.x = tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
            this.m_normal.y = tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
            tMat = cc.bodyA.m_xf.R;
            tVec = cc.localPoint;
            planePointX = cc.bodyA.m_xf.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
            planePointY = cc.bodyA.m_xf.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
            tMat = cc.bodyB.m_xf.R;
            for (i = 0;
            i < cc.pointCount; ++i) {
               tVec = cc.points[i].localPoint;
               clipPointX = cc.bodyB.m_xf.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
               clipPointY = cc.bodyB.m_xf.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
               this.m_separations[i] = (clipPointX - planePointX) * this.m_normal.x + (clipPointY - planePointY) * this.m_normal.y - cc.radius;
               this.m_points[i].x = clipPointX;
               this.m_points[i].y = clipPointY;
            }
         }
         break;
      case b2Manifold.e_faceB:
         {
            tMat = cc.bodyB.m_xf.R;
            tVec = cc.localPlaneNormal;
            this.m_normal.x = tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
            this.m_normal.y = tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
            tMat = cc.bodyB.m_xf.R;
            tVec = cc.localPoint;
            planePointX = cc.bodyB.m_xf.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
            planePointY = cc.bodyB.m_xf.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
            tMat = cc.bodyA.m_xf.R;
            for (i = 0;
            i < cc.pointCount; ++i) {
               tVec = cc.points[i].localPoint;
               clipPointX = cc.bodyA.m_xf.position.x + (tMat.col1.x * tVec.x + tMat.col2.x * tVec.y);
               clipPointY = cc.bodyA.m_xf.position.y + (tMat.col1.y * tVec.x + tMat.col2.y * tVec.y);
               this.m_separations[i] = (clipPointX - planePointX) * this.m_normal.x + (clipPointY - planePointY) * this.m_normal.y - cc.radius;
               this.m_points[i].Set(clipPointX, clipPointY);
            }
            this.m_normal.x *= (-1);
            this.m_normal.y *= (-1);
         }
         break;
      }
   }
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA = new b2Vec2();
      Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB = new b2Vec2();
   });
})();
(function () {
   var b2Body = Box2D.Dynamics.b2Body,
      b2BodyDef = Box2D.Dynamics.b2BodyDef,
      b2ContactFilter = Box2D.Dynamics.b2ContactFilter,
      b2ContactImpulse = Box2D.Dynamics.b2ContactImpulse,
      b2ContactListener = Box2D.Dynamics.b2ContactListener,
      b2ContactManager = Box2D.Dynamics.b2ContactManager,
      b2DebugDraw = Box2D.Dynamics.b2DebugDraw,
      b2DestructionListener = Box2D.Dynamics.b2DestructionListener,
      b2FilterData = Box2D.Dynamics.b2FilterData,
      b2Fixture = Box2D.Dynamics.b2Fixture,
      b2FixtureDef = Box2D.Dynamics.b2FixtureDef,
      b2Island = Box2D.Dynamics.b2Island,
      b2TimeStep = Box2D.Dynamics.b2TimeStep,
      b2World = Box2D.Dynamics.b2World,
      b2Mat22 = Box2D.Common.Math.b2Mat22,
      b2Mat33 = Box2D.Common.Math.b2Mat33,
      b2Math = Box2D.Common.Math.b2Math,
      b2Sweep = Box2D.Common.Math.b2Sweep,
      b2Transform = Box2D.Common.Math.b2Transform,
      b2Vec2 = Box2D.Common.Math.b2Vec2,
      b2Vec3 = Box2D.Common.Math.b2Vec3,
      b2Color = Box2D.Common.b2Color,
      b2internal = Box2D.Common.b2internal,
      b2Settings = Box2D.Common.b2Settings,
      b2CircleShape = Box2D.Collision.Shapes.b2CircleShape,
      b2EdgeChainDef = Box2D.Collision.Shapes.b2EdgeChainDef,
      b2EdgeShape = Box2D.Collision.Shapes.b2EdgeShape,
      b2MassData = Box2D.Collision.Shapes.b2MassData,
      b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape,
      b2Shape = Box2D.Collision.Shapes.b2Shape,
      b2BuoyancyController = Box2D.Dynamics.Controllers.b2BuoyancyController,
      b2ConstantAccelController = Box2D.Dynamics.Controllers.b2ConstantAccelController,
      b2ConstantForceController = Box2D.Dynamics.Controllers.b2ConstantForceController,
      b2Controller = Box2D.Dynamics.Controllers.b2Controller,
      b2ControllerEdge = Box2D.Dynamics.Controllers.b2ControllerEdge,
      b2GravityController = Box2D.Dynamics.Controllers.b2GravityController,
      b2TensorDampingController = Box2D.Dynamics.Controllers.b2TensorDampingController;

   Box2D.inherit(b2BuoyancyController, Box2D.Dynamics.Controllers.b2Controller);
   b2BuoyancyController.prototype.__super = Box2D.Dynamics.Controllers.b2Controller.prototype;
   b2BuoyancyController.b2BuoyancyController = function () {
      Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this, arguments);
      this.normal = new b2Vec2(0, (-1));
      this.offset = 0;
      this.density = 0;
      this.velocity = new b2Vec2(0, 0);
      this.linearDrag = 2;
      this.angularDrag = 1;
      this.useDensity = false;
      this.useWorldGravity = true;
      this.gravity = null;
   };
   b2BuoyancyController.prototype.Step = function (step) {
      if (!this.m_bodyList) return;
      if (this.useWorldGravity) {
         this.gravity = this.GetWorld().GetGravity().Copy();
      }
      for (var i = this.m_bodyList; i; i = i.nextBody) {
         var body = i.body;
         if (body.IsAwake() == false) {
            continue;
         }
         var areac = new b2Vec2();
         var massc = new b2Vec2();
         var area = 0.0;
         var mass = 0.0;
         for (var fixture = body.GetFixtureList(); fixture; fixture = fixture.GetNext()) {
            var sc = new b2Vec2();
            var sarea = fixture.GetShape().ComputeSubmergedArea(this.normal, this.offset, body.GetTransform(), sc);
            area += sarea;
            areac.x += sarea * sc.x;
            areac.y += sarea * sc.y;
            var shapeDensity = 0;
            if (this.useDensity) {
               shapeDensity = 1;
            }
            else {
               shapeDensity = 1;
            }
            mass += sarea * shapeDensity;
            massc.x += sarea * sc.x * shapeDensity;
            massc.y += sarea * sc.y * shapeDensity;
         }
         areac.x /= area;
         areac.y /= area;
         massc.x /= mass;
         massc.y /= mass;
         if (area < Number.MIN_VALUE) continue;
         var buoyancyForce = this.gravity.GetNegative();
         buoyancyForce.Multiply(this.density * area);
         body.ApplyForce(buoyancyForce, massc);
         var dragForce = body.GetLinearVelocityFromWorldPoint(areac);
         dragForce.Subtract(this.velocity);
         dragForce.Multiply((-this.linearDrag * area));
         body.ApplyForce(dragForce, areac);
         body.ApplyTorque((-body.GetInertia() / body.GetMass() * area * body.GetAngularVelocity() * this.angularDrag));
      }
   }
   b2BuoyancyController.prototype.Draw = function (debugDraw) {
      var r = 1000;
      var p1 = new b2Vec2();
      var p2 = new b2Vec2();
      p1.x = this.normal.x * this.offset + this.normal.y * r;
      p1.y = this.normal.y * this.offset - this.normal.x * r;
      p2.x = this.normal.x * this.offset - this.normal.y * r;
      p2.y = this.normal.y * this.offset + this.normal.x * r;
      var color = new b2Color(0, 0, 1);
      debugDraw.DrawSegment(p1, p2, color);
   }
   Box2D.inherit(b2ConstantAccelController, Box2D.Dynamics.Controllers.b2Controller);
   b2ConstantAccelController.prototype.__super = Box2D.Dynamics.Controllers.b2Controller.prototype;
   b2ConstantAccelController.b2ConstantAccelController = function () {
      Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this, arguments);
      this.A = new b2Vec2(0, 0);
   };
   b2ConstantAccelController.prototype.Step = function (step) {
      var smallA = new b2Vec2(this.A.x * step.dt, this.A.y * step.dt);
      for (var i = this.m_bodyList; i; i = i.nextBody) {
         var body = i.body;
         if (!body.IsAwake()) continue;
         body.SetLinearVelocity(new b2Vec2(body.GetLinearVelocity().x + smallA.x, body.GetLinearVelocity().y + smallA.y));
      }
   }
   Box2D.inherit(b2ConstantForceController, Box2D.Dynamics.Controllers.b2Controller);
   b2ConstantForceController.prototype.__super = Box2D.Dynamics.Controllers.b2Controller.prototype;
   b2ConstantForceController.b2ConstantForceController = function () {
      Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this, arguments);
      this.F = new b2Vec2(0, 0);
   };
   b2ConstantForceController.prototype.Step = function (step) {
      for (var i = this.m_bodyList; i; i = i.nextBody) {
         var body = i.body;
         if (!body.IsAwake()) continue;
         body.ApplyForce(this.F, body.GetWorldCenter());
      }
   }
   b2Controller.b2Controller = function () {};
   b2Controller.prototype.Step = function (step) {}
   b2Controller.prototype.Draw = function (debugDraw) {}
   b2Controller.prototype.AddBody = function (body) {
      var edge = new b2ControllerEdge();
      edge.controller = this;
      edge.body = body;
      edge.nextBody = this.m_bodyList;
      edge.prevBody = null;
      this.m_bodyList = edge;
      if (edge.nextBody) edge.nextBody.prevBody = edge;
      this.m_bodyCount++;
      edge.nextController = body.m_controllerList;
      edge.prevController = null;
      body.m_controllerList = edge;
      if (edge.nextController) edge.nextController.prevController = edge;
      body.m_controllerCount++;
   }
   b2Controller.prototype.RemoveBody = function (body) {
      var edge = body.m_controllerList;
      while (edge && edge.controller != this)
      edge = edge.nextController;
      if (edge.prevBody) edge.prevBody.nextBody = edge.nextBody;
      if (edge.nextBody) edge.nextBody.prevBody = edge.prevBody;
      if (edge.nextController) edge.nextController.prevController = edge.prevController;
      if (edge.prevController) edge.prevController.nextController = edge.nextController;
      if (this.m_bodyList == edge) this.m_bodyList = edge.nextBody;
      if (body.m_controllerList == edge) body.m_controllerList = edge.nextController;
      body.m_controllerCount--;
      this.m_bodyCount--;
   }
   b2Controller.prototype.Clear = function () {
      while (this.m_bodyList)
      this.RemoveBody(this.m_bodyList.body);
   }
   b2Controller.prototype.GetNext = function () {
      return this.m_next;
   }
   b2Controller.prototype.GetWorld = function () {
      return this.m_world;
   }
   b2Controller.prototype.GetBodyList = function () {
      return this.m_bodyList;
   }
   b2ControllerEdge.b2ControllerEdge = function () {};
   Box2D.inherit(b2GravityController, Box2D.Dynamics.Controllers.b2Controller);
   b2GravityController.prototype.__super = Box2D.Dynamics.Controllers.b2Controller.prototype;
   b2GravityController.b2GravityController = function () {
      Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this, arguments);
      this.G = 1;
      this.invSqr = true;
   };
   b2GravityController.prototype.Step = function (step) {
      var i = null;
      var body1 = null;
      var p1 = null;
      var mass1 = 0;
      var j = null;
      var body2 = null;
      var p2 = null;
      var dx = 0;
      var dy = 0;
      var r2 = 0;
      var f = null;
      if (this.invSqr) {
         for (i = this.m_bodyList;
         i; i = i.nextBody) {
            body1 = i.body;
            p1 = body1.GetWorldCenter();
            mass1 = body1.GetMass();
            for (j = this.m_bodyList;
            j != i; j = j.nextBody) {
               body2 = j.body;
               p2 = body2.GetWorldCenter();
               dx = p2.x - p1.x;
               dy = p2.y - p1.y;
               r2 = dx * dx + dy * dy;
               if (r2 < Number.MIN_VALUE) continue;
               f = new b2Vec2(dx, dy);
               f.Multiply(this.G / r2 / Math.sqrt(r2) * mass1 * body2.GetMass());
               if (body1.IsAwake()) body1.ApplyForce(f, p1);
               f.Multiply((-1));
               if (body2.IsAwake()) body2.ApplyForce(f, p2);
            }
         }
      }
      else {
         for (i = this.m_bodyList;
         i; i = i.nextBody) {
            body1 = i.body;
            p1 = body1.GetWorldCenter();
            mass1 = body1.GetMass();
            for (j = this.m_bodyList;
            j != i; j = j.nextBody) {
               body2 = j.body;
               p2 = body2.GetWorldCenter();
               dx = p2.x - p1.x;
               dy = p2.y - p1.y;
               r2 = dx * dx + dy * dy;
               if (r2 < Number.MIN_VALUE) continue;
               f = new b2Vec2(dx, dy);
               f.Multiply(this.G / r2 * mass1 * body2.GetMass());
               if (body1.IsAwake()) body1.ApplyForce(f, p1);
               f.Multiply((-1));
               if (body2.IsAwake()) body2.ApplyForce(f, p2);
            }
         }
      }
   }
   Box2D.inherit(b2TensorDampingController, Box2D.Dynamics.Controllers.b2Controller);
   b2TensorDampingController.prototype.__super = Box2D.Dynamics.Controllers.b2Controller.prototype;
   b2TensorDampingController.b2TensorDampingController = function () {
      Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this, arguments);
      this.T = new b2Mat22();
      this.maxTimestep = 0;
   };
   b2TensorDampingController.prototype.SetAxisAligned = function (xDamping, yDamping) {
      if (xDamping === undefined) xDamping = 0;
      if (yDamping === undefined) yDamping = 0;
      this.T.col1.x = (-xDamping);
      this.T.col1.y = 0;
      this.T.col2.x = 0;
      this.T.col2.y = (-yDamping);
      if (xDamping > 0 || yDamping > 0) {
         this.maxTimestep = 1 / Math.max(xDamping, yDamping);
      }
      else {
         this.maxTimestep = 0;
      }
   }
   b2TensorDampingController.prototype.Step = function (step) {
      var timestep = step.dt;
      if (timestep <= Number.MIN_VALUE) return;
      if (timestep > this.maxTimestep && this.maxTimestep > 0) timestep = this.maxTimestep;
      for (var i = this.m_bodyList; i; i = i.nextBody) {
         var body = i.body;
         if (!body.IsAwake()) {
            continue;
         }
         var damping = body.GetWorldVector(b2Math.MulMV(this.T, body.GetLocalVector(body.GetLinearVelocity())));
         body.SetLinearVelocity(new b2Vec2(body.GetLinearVelocity().x + damping.x * timestep, body.GetLinearVelocity().y + damping.y * timestep));
      }
   }
})();
(function () {
   var b2Color = Box2D.Common.b2Color,
      b2internal = Box2D.Common.b2internal,
      b2Settings = Box2D.Common.b2Settings,
      b2Mat22 = Box2D.Common.Math.b2Mat22,
      b2Mat33 = Box2D.Common.Math.b2Mat33,
      b2Math = Box2D.Common.Math.b2Math,
      b2Sweep = Box2D.Common.Math.b2Sweep,
      b2Transform = Box2D.Common.Math.b2Transform,
      b2Vec2 = Box2D.Common.Math.b2Vec2,
      b2Vec3 = Box2D.Common.Math.b2Vec3,
      b2DistanceJoint = Box2D.Dynamics.Joints.b2DistanceJoint,
      b2DistanceJointDef = Box2D.Dynamics.Joints.b2DistanceJointDef,
      b2FrictionJoint = Box2D.Dynamics.Joints.b2FrictionJoint,
      b2FrictionJointDef = Box2D.Dynamics.Joints.b2FrictionJointDef,
      b2GearJoint = Box2D.Dynamics.Joints.b2GearJoint,
      b2GearJointDef = Box2D.Dynamics.Joints.b2GearJointDef,
      b2Jacobian = Box2D.Dynamics.Joints.b2Jacobian,
      b2Joint = Box2D.Dynamics.Joints.b2Joint,
      b2JointDef = Box2D.Dynamics.Joints.b2JointDef,
      b2JointEdge = Box2D.Dynamics.Joints.b2JointEdge,
      b2LineJoint = Box2D.Dynamics.Joints.b2LineJoint,
      b2LineJointDef = Box2D.Dynamics.Joints.b2LineJointDef,
      b2MouseJoint = Box2D.Dynamics.Joints.b2MouseJoint,
      b2MouseJointDef = Box2D.Dynamics.Joints.b2MouseJointDef,
      b2PrismaticJoint = Box2D.Dynamics.Joints.b2PrismaticJoint,
      b2PrismaticJointDef = Box2D.Dynamics.Joints.b2PrismaticJointDef,
      b2PulleyJoint = Box2D.Dynamics.Joints.b2PulleyJoint,
      b2PulleyJointDef = Box2D.Dynamics.Joints.b2PulleyJointDef,
      b2RevoluteJoint = Box2D.Dynamics.Joints.b2RevoluteJoint,
      b2RevoluteJointDef = Box2D.Dynamics.Joints.b2RevoluteJointDef,
      b2WeldJoint = Box2D.Dynamics.Joints.b2WeldJoint,
      b2WeldJointDef = Box2D.Dynamics.Joints.b2WeldJointDef,
      b2Body = Box2D.Dynamics.b2Body,
      b2BodyDef = Box2D.Dynamics.b2BodyDef,
      b2ContactFilter = Box2D.Dynamics.b2ContactFilter,
      b2ContactImpulse = Box2D.Dynamics.b2ContactImpulse,
      b2ContactListener = Box2D.Dynamics.b2ContactListener,
      b2ContactManager = Box2D.Dynamics.b2ContactManager,
      b2DebugDraw = Box2D.Dynamics.b2DebugDraw,
      b2DestructionListener = Box2D.Dynamics.b2DestructionListener,
      b2FilterData = Box2D.Dynamics.b2FilterData,
      b2Fixture = Box2D.Dynamics.b2Fixture,
      b2FixtureDef = Box2D.Dynamics.b2FixtureDef,
      b2Island = Box2D.Dynamics.b2Island,
      b2TimeStep = Box2D.Dynamics.b2TimeStep,
      b2World = Box2D.Dynamics.b2World;

   Box2D.inherit(b2DistanceJoint, Box2D.Dynamics.Joints.b2Joint);
   b2DistanceJoint.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype;
   b2DistanceJoint.b2DistanceJoint = function () {
      Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments);
      this.m_localAnchor1 = new b2Vec2();
      this.m_localAnchor2 = new b2Vec2();
      this.m_u = new b2Vec2();
   };
   b2DistanceJoint.prototype.GetAnchorA = function () {
      return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
   }
   b2DistanceJoint.prototype.GetAnchorB = function () {
      return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
   }
   b2DistanceJoint.prototype.GetReactionForce = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return new b2Vec2(inv_dt * this.m_impulse * this.m_u.x, inv_dt * this.m_impulse * this.m_u.y);
   }
   b2DistanceJoint.prototype.GetReactionTorque = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return 0.0;
   }
   b2DistanceJoint.prototype.GetLength = function () {
      return this.m_length;
   }
   b2DistanceJoint.prototype.SetLength = function (length) {
      if (length === undefined) length = 0;
      this.m_length = length;
   }
   b2DistanceJoint.prototype.GetFrequency = function () {
      return this.m_frequencyHz;
   }
   b2DistanceJoint.prototype.SetFrequency = function (hz) {
      if (hz === undefined) hz = 0;
      this.m_frequencyHz = hz;
   }
   b2DistanceJoint.prototype.GetDampingRatio = function () {
      return this.m_dampingRatio;
   }
   b2DistanceJoint.prototype.SetDampingRatio = function (ratio) {
      if (ratio === undefined) ratio = 0;
      this.m_dampingRatio = ratio;
   }
   b2DistanceJoint.prototype.b2DistanceJoint = function (def) {
      this.__super.b2Joint.call(this, def);
      var tMat;
      var tX = 0;
      var tY = 0;
      this.m_localAnchor1.SetV(def.localAnchorA);
      this.m_localAnchor2.SetV(def.localAnchorB);
      this.m_length = def.length;
      this.m_frequencyHz = def.frequencyHz;
      this.m_dampingRatio = def.dampingRatio;
      this.m_impulse = 0.0;
      this.m_gamma = 0.0;
      this.m_bias = 0.0;
   }
   b2DistanceJoint.prototype.InitVelocityConstraints = function (step) {
      var tMat;
      var tX = 0;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      tMat = bA.m_xf.R;
      var r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
      var r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
      tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
      r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
      r1X = tX;
      tMat = bB.m_xf.R;
      var r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
      var r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
      r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
      r2X = tX;
      this.m_u.x = bB.m_sweep.c.x + r2X - bA.m_sweep.c.x - r1X;
      this.m_u.y = bB.m_sweep.c.y + r2Y - bA.m_sweep.c.y - r1Y;
      var length = Math.sqrt(this.m_u.x * this.m_u.x + this.m_u.y * this.m_u.y);
      if (length > b2Settings.b2_linearSlop) {
         this.m_u.Multiply(1.0 / length);
      }
      else {
         this.m_u.SetZero();
      }
      var cr1u = (r1X * this.m_u.y - r1Y * this.m_u.x);
      var cr2u = (r2X * this.m_u.y - r2Y * this.m_u.x);
      var invMass = bA.m_invMass + bA.m_invI * cr1u * cr1u + bB.m_invMass + bB.m_invI * cr2u * cr2u;
      this.m_mass = invMass != 0.0 ? 1.0 / invMass : 0.0;
      if (this.m_frequencyHz > 0.0) {
         var C = length - this.m_length;
         var omega = 2.0 * Math.PI * this.m_frequencyHz;
         var d = 2.0 * this.m_mass * this.m_dampingRatio * omega;
         var k = this.m_mass * omega * omega;
         this.m_gamma = step.dt * (d + step.dt * k);
         this.m_gamma = this.m_gamma != 0.0 ? 1 / this.m_gamma : 0.0;
         this.m_bias = C * step.dt * k * this.m_gamma;
         this.m_mass = invMass + this.m_gamma;
         this.m_mass = this.m_mass != 0.0 ? 1.0 / this.m_mass : 0.0;
      }
      if (step.warmStarting) {
         this.m_impulse *= step.dtRatio;
         var PX = this.m_impulse * this.m_u.x;
         var PY = this.m_impulse * this.m_u.y;
         bA.m_linearVelocity.x -= bA.m_invMass * PX;
         bA.m_linearVelocity.y -= bA.m_invMass * PY;
         bA.m_angularVelocity -= bA.m_invI * (r1X * PY - r1Y * PX);
         bB.m_linearVelocity.x += bB.m_invMass * PX;
         bB.m_linearVelocity.y += bB.m_invMass * PY;
         bB.m_angularVelocity += bB.m_invI * (r2X * PY - r2Y * PX);
      }
      else {
         this.m_impulse = 0.0;
      }
   }
   b2DistanceJoint.prototype.SolveVelocityConstraints = function (step) {
      var tMat;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      tMat = bA.m_xf.R;
      var r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
      var r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
      var tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
      r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
      r1X = tX;
      tMat = bB.m_xf.R;
      var r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
      var r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
      r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
      r2X = tX;
      var v1X = bA.m_linearVelocity.x + ((-bA.m_angularVelocity * r1Y));
      var v1Y = bA.m_linearVelocity.y + (bA.m_angularVelocity * r1X);
      var v2X = bB.m_linearVelocity.x + ((-bB.m_angularVelocity * r2Y));
      var v2Y = bB.m_linearVelocity.y + (bB.m_angularVelocity * r2X);
      var Cdot = (this.m_u.x * (v2X - v1X) + this.m_u.y * (v2Y - v1Y));
      var impulse = (-this.m_mass * (Cdot + this.m_bias + this.m_gamma * this.m_impulse));
      this.m_impulse += impulse;
      var PX = impulse * this.m_u.x;
      var PY = impulse * this.m_u.y;
      bA.m_linearVelocity.x -= bA.m_invMass * PX;
      bA.m_linearVelocity.y -= bA.m_invMass * PY;
      bA.m_angularVelocity -= bA.m_invI * (r1X * PY - r1Y * PX);
      bB.m_linearVelocity.x += bB.m_invMass * PX;
      bB.m_linearVelocity.y += bB.m_invMass * PY;
      bB.m_angularVelocity += bB.m_invI * (r2X * PY - r2Y * PX);
   }
   b2DistanceJoint.prototype.SolvePositionConstraints = function (baumgarte) {
      if (baumgarte === undefined) baumgarte = 0;
      var tMat;
      if (this.m_frequencyHz > 0.0) {
         return true;
      }
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      tMat = bA.m_xf.R;
      var r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
      var r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
      var tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
      r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
      r1X = tX;
      tMat = bB.m_xf.R;
      var r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
      var r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
      r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
      r2X = tX;
      var dX = bB.m_sweep.c.x + r2X - bA.m_sweep.c.x - r1X;
      var dY = bB.m_sweep.c.y + r2Y - bA.m_sweep.c.y - r1Y;
      var length = Math.sqrt(dX * dX + dY * dY);
      dX /= length;
      dY /= length;
      var C = length - this.m_length;
      C = b2Math.Clamp(C, (-b2Settings.b2_maxLinearCorrection), b2Settings.b2_maxLinearCorrection);
      var impulse = (-this.m_mass * C);
      this.m_u.Set(dX, dY);
      var PX = impulse * this.m_u.x;
      var PY = impulse * this.m_u.y;
      bA.m_sweep.c.x -= bA.m_invMass * PX;
      bA.m_sweep.c.y -= bA.m_invMass * PY;
      bA.m_sweep.a -= bA.m_invI * (r1X * PY - r1Y * PX);
      bB.m_sweep.c.x += bB.m_invMass * PX;
      bB.m_sweep.c.y += bB.m_invMass * PY;
      bB.m_sweep.a += bB.m_invI * (r2X * PY - r2Y * PX);
      bA.SynchronizeTransform();
      bB.SynchronizeTransform();
      return b2Math.Abs(C) < b2Settings.b2_linearSlop;
   }
   Box2D.inherit(b2DistanceJointDef, Box2D.Dynamics.Joints.b2JointDef);
   b2DistanceJointDef.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype;
   b2DistanceJointDef.b2DistanceJointDef = function () {
      Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments);
      this.localAnchorA = new b2Vec2();
      this.localAnchorB = new b2Vec2();
   };
   b2DistanceJointDef.prototype.b2DistanceJointDef = function () {
      this.__super.b2JointDef.call(this);
      this.type = b2Joint.e_distanceJoint;
      this.length = 1.0;
      this.frequencyHz = 0.0;
      this.dampingRatio = 0.0;
   }
   b2DistanceJointDef.prototype.Initialize = function (bA, bB, anchorA, anchorB) {
      this.bodyA = bA;
      this.bodyB = bB;
      this.localAnchorA.SetV(this.bodyA.GetLocalPoint(anchorA));
      this.localAnchorB.SetV(this.bodyB.GetLocalPoint(anchorB));
      var dX = anchorB.x - anchorA.x;
      var dY = anchorB.y - anchorA.y;
      this.length = Math.sqrt(dX * dX + dY * dY);
      this.frequencyHz = 0.0;
      this.dampingRatio = 0.0;
   }
   Box2D.inherit(b2FrictionJoint, Box2D.Dynamics.Joints.b2Joint);
   b2FrictionJoint.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype;
   b2FrictionJoint.b2FrictionJoint = function () {
      Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments);
      this.m_localAnchorA = new b2Vec2();
      this.m_localAnchorB = new b2Vec2();
      this.m_linearMass = new b2Mat22();
      this.m_linearImpulse = new b2Vec2();
   };
   b2FrictionJoint.prototype.GetAnchorA = function () {
      return this.m_bodyA.GetWorldPoint(this.m_localAnchorA);
   }
   b2FrictionJoint.prototype.GetAnchorB = function () {
      return this.m_bodyB.GetWorldPoint(this.m_localAnchorB);
   }
   b2FrictionJoint.prototype.GetReactionForce = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return new b2Vec2(inv_dt * this.m_linearImpulse.x, inv_dt * this.m_linearImpulse.y);
   }
   b2FrictionJoint.prototype.GetReactionTorque = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return inv_dt * this.m_angularImpulse;
   }
   b2FrictionJoint.prototype.SetMaxForce = function (force) {
      if (force === undefined) force = 0;
      this.m_maxForce = force;
   }
   b2FrictionJoint.prototype.GetMaxForce = function () {
      return this.m_maxForce;
   }
   b2FrictionJoint.prototype.SetMaxTorque = function (torque) {
      if (torque === undefined) torque = 0;
      this.m_maxTorque = torque;
   }
   b2FrictionJoint.prototype.GetMaxTorque = function () {
      return this.m_maxTorque;
   }
   b2FrictionJoint.prototype.b2FrictionJoint = function (def) {
      this.__super.b2Joint.call(this, def);
      this.m_localAnchorA.SetV(def.localAnchorA);
      this.m_localAnchorB.SetV(def.localAnchorB);
      this.m_linearMass.SetZero();
      this.m_angularMass = 0.0;
      this.m_linearImpulse.SetZero();
      this.m_angularImpulse = 0.0;
      this.m_maxForce = def.maxForce;
      this.m_maxTorque = def.maxTorque;
   }
   b2FrictionJoint.prototype.InitVelocityConstraints = function (step) {
      var tMat;
      var tX = 0;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      tMat = bA.m_xf.R;
      var rAX = this.m_localAnchorA.x - bA.m_sweep.localCenter.x;
      var rAY = this.m_localAnchorA.y - bA.m_sweep.localCenter.y;
      tX = (tMat.col1.x * rAX + tMat.col2.x * rAY);
      rAY = (tMat.col1.y * rAX + tMat.col2.y * rAY);
      rAX = tX;
      tMat = bB.m_xf.R;
      var rBX = this.m_localAnchorB.x - bB.m_sweep.localCenter.x;
      var rBY = this.m_localAnchorB.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * rBX + tMat.col2.x * rBY);
      rBY = (tMat.col1.y * rBX + tMat.col2.y * rBY);
      rBX = tX;
      var mA = bA.m_invMass;
      var mB = bB.m_invMass;
      var iA = bA.m_invI;
      var iB = bB.m_invI;
      var K = new b2Mat22();
      K.col1.x = mA + mB;
      K.col2.x = 0.0;
      K.col1.y = 0.0;
      K.col2.y = mA + mB;
      K.col1.x += iA * rAY * rAY;
      K.col2.x += (-iA * rAX * rAY);
      K.col1.y += (-iA * rAX * rAY);
      K.col2.y += iA * rAX * rAX;
      K.col1.x += iB * rBY * rBY;
      K.col2.x += (-iB * rBX * rBY);
      K.col1.y += (-iB * rBX * rBY);
      K.col2.y += iB * rBX * rBX;
      K.GetInverse(this.m_linearMass);
      this.m_angularMass = iA + iB;
      if (this.m_angularMass > 0.0) {
         this.m_angularMass = 1.0 / this.m_angularMass;
      }
      if (step.warmStarting) {
         this.m_linearImpulse.x *= step.dtRatio;
         this.m_linearImpulse.y *= step.dtRatio;
         this.m_angularImpulse *= step.dtRatio;
         var P = this.m_linearImpulse;
         bA.m_linearVelocity.x -= mA * P.x;
         bA.m_linearVelocity.y -= mA * P.y;
         bA.m_angularVelocity -= iA * (rAX * P.y - rAY * P.x + this.m_angularImpulse);
         bB.m_linearVelocity.x += mB * P.x;
         bB.m_linearVelocity.y += mB * P.y;
         bB.m_angularVelocity += iB * (rBX * P.y - rBY * P.x + this.m_angularImpulse);
      }
      else {
         this.m_linearImpulse.SetZero();
         this.m_angularImpulse = 0.0;
      }
   }
   b2FrictionJoint.prototype.SolveVelocityConstraints = function (step) {
      var tMat;
      var tX = 0;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var vA = bA.m_linearVelocity;
      var wA = bA.m_angularVelocity;
      var vB = bB.m_linearVelocity;
      var wB = bB.m_angularVelocity;
      var mA = bA.m_invMass;
      var mB = bB.m_invMass;
      var iA = bA.m_invI;
      var iB = bB.m_invI;
      tMat = bA.m_xf.R;
      var rAX = this.m_localAnchorA.x - bA.m_sweep.localCenter.x;
      var rAY = this.m_localAnchorA.y - bA.m_sweep.localCenter.y;
      tX = (tMat.col1.x * rAX + tMat.col2.x * rAY);
      rAY = (tMat.col1.y * rAX + tMat.col2.y * rAY);
      rAX = tX;
      tMat = bB.m_xf.R;
      var rBX = this.m_localAnchorB.x - bB.m_sweep.localCenter.x;
      var rBY = this.m_localAnchorB.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * rBX + tMat.col2.x * rBY);
      rBY = (tMat.col1.y * rBX + tMat.col2.y * rBY);
      rBX = tX;
      var maxImpulse = 0; {
         var Cdot = wB - wA;
         var impulse = (-this.m_angularMass * Cdot);
         var oldImpulse = this.m_angularImpulse;
         maxImpulse = step.dt * this.m_maxTorque;
         this.m_angularImpulse = b2Math.Clamp(this.m_angularImpulse + impulse, (-maxImpulse), maxImpulse);
         impulse = this.m_angularImpulse - oldImpulse;
         wA -= iA * impulse;
         wB += iB * impulse;
      } {
         var CdotX = vB.x - wB * rBY - vA.x + wA * rAY;
         var CdotY = vB.y + wB * rBX - vA.y - wA * rAX;
         var impulseV = b2Math.MulMV(this.m_linearMass, new b2Vec2((-CdotX), (-CdotY)));
         var oldImpulseV = this.m_linearImpulse.Copy();
         this.m_linearImpulse.Add(impulseV);
         maxImpulse = step.dt * this.m_maxForce;
         if (this.m_linearImpulse.LengthSquared() > maxImpulse * maxImpulse) {
            this.m_linearImpulse.Normalize();
            this.m_linearImpulse.Multiply(maxImpulse);
         }
         impulseV = b2Math.SubtractVV(this.m_linearImpulse, oldImpulseV);
         vA.x -= mA * impulseV.x;
         vA.y -= mA * impulseV.y;
         wA -= iA * (rAX * impulseV.y - rAY * impulseV.x);
         vB.x += mB * impulseV.x;
         vB.y += mB * impulseV.y;
         wB += iB * (rBX * impulseV.y - rBY * impulseV.x);
      }
      bA.m_angularVelocity = wA;
      bB.m_angularVelocity = wB;
   }
   b2FrictionJoint.prototype.SolvePositionConstraints = function (baumgarte) {
      if (baumgarte === undefined) baumgarte = 0;
      return true;
   }
   Box2D.inherit(b2FrictionJointDef, Box2D.Dynamics.Joints.b2JointDef);
   b2FrictionJointDef.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype;
   b2FrictionJointDef.b2FrictionJointDef = function () {
      Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments);
      this.localAnchorA = new b2Vec2();
      this.localAnchorB = new b2Vec2();
   };
   b2FrictionJointDef.prototype.b2FrictionJointDef = function () {
      this.__super.b2JointDef.call(this);
      this.type = b2Joint.e_frictionJoint;
      this.maxForce = 0.0;
      this.maxTorque = 0.0;
   }
   b2FrictionJointDef.prototype.Initialize = function (bA, bB, anchor) {
      this.bodyA = bA;
      this.bodyB = bB;
      this.localAnchorA.SetV(this.bodyA.GetLocalPoint(anchor));
      this.localAnchorB.SetV(this.bodyB.GetLocalPoint(anchor));
   }
   Box2D.inherit(b2GearJoint, Box2D.Dynamics.Joints.b2Joint);
   b2GearJoint.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype;
   b2GearJoint.b2GearJoint = function () {
      Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments);
      this.m_groundAnchor1 = new b2Vec2();
      this.m_groundAnchor2 = new b2Vec2();
      this.m_localAnchor1 = new b2Vec2();
      this.m_localAnchor2 = new b2Vec2();
      this.m_J = new b2Jacobian();
   };
   b2GearJoint.prototype.GetAnchorA = function () {
      return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
   }
   b2GearJoint.prototype.GetAnchorB = function () {
      return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
   }
   b2GearJoint.prototype.GetReactionForce = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return new b2Vec2(inv_dt * this.m_impulse * this.m_J.linearB.x, inv_dt * this.m_impulse * this.m_J.linearB.y);
   }
   b2GearJoint.prototype.GetReactionTorque = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      var tMat = this.m_bodyB.m_xf.R;
      var rX = this.m_localAnchor1.x - this.m_bodyB.m_sweep.localCenter.x;
      var rY = this.m_localAnchor1.y - this.m_bodyB.m_sweep.localCenter.y;
      var tX = tMat.col1.x * rX + tMat.col2.x * rY;
      rY = tMat.col1.y * rX + tMat.col2.y * rY;
      rX = tX;
      var PX = this.m_impulse * this.m_J.linearB.x;
      var PY = this.m_impulse * this.m_J.linearB.y;
      return inv_dt * (this.m_impulse * this.m_J.angularB - rX * PY + rY * PX);
   }
   b2GearJoint.prototype.GetRatio = function () {
      return this.m_ratio;
   }
   b2GearJoint.prototype.SetRatio = function (ratio) {
      if (ratio === undefined) ratio = 0;
      this.m_ratio = ratio;
   }
   b2GearJoint.prototype.b2GearJoint = function (def) {
      this.__super.b2Joint.call(this, def);
      var type1 = parseInt(def.joint1.m_type);
      var type2 = parseInt(def.joint2.m_type);
      this.m_revolute1 = null;
      this.m_prismatic1 = null;
      this.m_revolute2 = null;
      this.m_prismatic2 = null;
      var coordinate1 = 0;
      var coordinate2 = 0;
      this.m_ground1 = def.joint1.GetBodyA();
      this.m_bodyA = def.joint1.GetBodyB();
      if (type1 == b2Joint.e_revoluteJoint) {
         this.m_revolute1 = (def.joint1 instanceof b2RevoluteJoint ? def.joint1 : null);
         this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);
         this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);
         coordinate1 = this.m_revolute1.GetJointAngle();
      }
      else {
         this.m_prismatic1 = (def.joint1 instanceof b2PrismaticJoint ? def.joint1 : null);
         this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);
         this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);
         coordinate1 = this.m_prismatic1.GetJointTranslation();
      }
      this.m_ground2 = def.joint2.GetBodyA();
      this.m_bodyB = def.joint2.GetBodyB();
      if (type2 == b2Joint.e_revoluteJoint) {
         this.m_revolute2 = (def.joint2 instanceof b2RevoluteJoint ? def.joint2 : null);
         this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);
         this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);
         coordinate2 = this.m_revolute2.GetJointAngle();
      }
      else {
         this.m_prismatic2 = (def.joint2 instanceof b2PrismaticJoint ? def.joint2 : null);
         this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);
         this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);
         coordinate2 = this.m_prismatic2.GetJointTranslation();
      }
      this.m_ratio = def.ratio;
      this.m_constant = coordinate1 + this.m_ratio * coordinate2;
      this.m_impulse = 0.0;
   }
   b2GearJoint.prototype.InitVelocityConstraints = function (step) {
      var g1 = this.m_ground1;
      var g2 = this.m_ground2;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var ugX = 0;
      var ugY = 0;
      var rX = 0;
      var rY = 0;
      var tMat;
      var tVec;
      var crug = 0;
      var tX = 0;
      var K = 0.0;
      this.m_J.SetZero();
      if (this.m_revolute1) {
         this.m_J.angularA = (-1.0);
         K += bA.m_invI;
      }
      else {
         tMat = g1.m_xf.R;
         tVec = this.m_prismatic1.m_localXAxis1;
         ugX = tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
         ugY = tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
         tMat = bA.m_xf.R;
         rX = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
         rY = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
         tX = tMat.col1.x * rX + tMat.col2.x * rY;
         rY = tMat.col1.y * rX + tMat.col2.y * rY;
         rX = tX;
         crug = rX * ugY - rY * ugX;
         this.m_J.linearA.Set((-ugX), (-ugY));
         this.m_J.angularA = (-crug);
         K += bA.m_invMass + bA.m_invI * crug * crug;
      }
      if (this.m_revolute2) {
         this.m_J.angularB = (-this.m_ratio);
         K += this.m_ratio * this.m_ratio * bB.m_invI;
      }
      else {
         tMat = g2.m_xf.R;
         tVec = this.m_prismatic2.m_localXAxis1;
         ugX = tMat.col1.x * tVec.x + tMat.col2.x * tVec.y;
         ugY = tMat.col1.y * tVec.x + tMat.col2.y * tVec.y;
         tMat = bB.m_xf.R;
         rX = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
         rY = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
         tX = tMat.col1.x * rX + tMat.col2.x * rY;
         rY = tMat.col1.y * rX + tMat.col2.y * rY;
         rX = tX;
         crug = rX * ugY - rY * ugX;
         this.m_J.linearB.Set((-this.m_ratio * ugX), (-this.m_ratio * ugY));
         this.m_J.angularB = (-this.m_ratio * crug);
         K += this.m_ratio * this.m_ratio * (bB.m_invMass + bB.m_invI * crug * crug);
      }
      this.m_mass = K > 0.0 ? 1.0 / K : 0.0;
      if (step.warmStarting) {
         bA.m_linearVelocity.x += bA.m_invMass * this.m_impulse * this.m_J.linearA.x;
         bA.m_linearVelocity.y += bA.m_invMass * this.m_impulse * this.m_J.linearA.y;
         bA.m_angularVelocity += bA.m_invI * this.m_impulse * this.m_J.angularA;
         bB.m_linearVelocity.x += bB.m_invMass * this.m_impulse * this.m_J.linearB.x;
         bB.m_linearVelocity.y += bB.m_invMass * this.m_impulse * this.m_J.linearB.y;
         bB.m_angularVelocity += bB.m_invI * this.m_impulse * this.m_J.angularB;
      }
      else {
         this.m_impulse = 0.0;
      }
   }
   b2GearJoint.prototype.SolveVelocityConstraints = function (step) {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var Cdot = this.m_J.Compute(bA.m_linearVelocity, bA.m_angularVelocity, bB.m_linearVelocity, bB.m_angularVelocity);
      var impulse = (-this.m_mass * Cdot);
      this.m_impulse += impulse;
      bA.m_linearVelocity.x += bA.m_invMass * impulse * this.m_J.linearA.x;
      bA.m_linearVelocity.y += bA.m_invMass * impulse * this.m_J.linearA.y;
      bA.m_angularVelocity += bA.m_invI * impulse * this.m_J.angularA;
      bB.m_linearVelocity.x += bB.m_invMass * impulse * this.m_J.linearB.x;
      bB.m_linearVelocity.y += bB.m_invMass * impulse * this.m_J.linearB.y;
      bB.m_angularVelocity += bB.m_invI * impulse * this.m_J.angularB;
   }
   b2GearJoint.prototype.SolvePositionConstraints = function (baumgarte) {
      if (baumgarte === undefined) baumgarte = 0;
      var linearError = 0.0;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var coordinate1 = 0;
      var coordinate2 = 0;
      if (this.m_revolute1) {
         coordinate1 = this.m_revolute1.GetJointAngle();
      }
      else {
         coordinate1 = this.m_prismatic1.GetJointTranslation();
      }
      if (this.m_revolute2) {
         coordinate2 = this.m_revolute2.GetJointAngle();
      }
      else {
         coordinate2 = this.m_prismatic2.GetJointTranslation();
      }
      var C = this.m_constant - (coordinate1 + this.m_ratio * coordinate2);
      var impulse = (-this.m_mass * C);
      bA.m_sweep.c.x += bA.m_invMass * impulse * this.m_J.linearA.x;
      bA.m_sweep.c.y += bA.m_invMass * impulse * this.m_J.linearA.y;
      bA.m_sweep.a += bA.m_invI * impulse * this.m_J.angularA;
      bB.m_sweep.c.x += bB.m_invMass * impulse * this.m_J.linearB.x;
      bB.m_sweep.c.y += bB.m_invMass * impulse * this.m_J.linearB.y;
      bB.m_sweep.a += bB.m_invI * impulse * this.m_J.angularB;
      bA.SynchronizeTransform();
      bB.SynchronizeTransform();
      return linearError < b2Settings.b2_linearSlop;
   }
   Box2D.inherit(b2GearJointDef, Box2D.Dynamics.Joints.b2JointDef);
   b2GearJointDef.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype;
   b2GearJointDef.b2GearJointDef = function () {
      Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments);
   };
   b2GearJointDef.prototype.b2GearJointDef = function () {
      this.__super.b2JointDef.call(this);
      this.type = b2Joint.e_gearJoint;
      this.joint1 = null;
      this.joint2 = null;
      this.ratio = 1.0;
   }
   b2Jacobian.b2Jacobian = function () {
      this.linearA = new b2Vec2();
      this.linearB = new b2Vec2();
   };
   b2Jacobian.prototype.SetZero = function () {
      this.linearA.SetZero();
      this.angularA = 0.0;
      this.linearB.SetZero();
      this.angularB = 0.0;
   }
   b2Jacobian.prototype.Set = function (x1, a1, x2, a2) {
      if (a1 === undefined) a1 = 0;
      if (a2 === undefined) a2 = 0;
      this.linearA.SetV(x1);
      this.angularA = a1;
      this.linearB.SetV(x2);
      this.angularB = a2;
   }
   b2Jacobian.prototype.Compute = function (x1, a1, x2, a2) {
      if (a1 === undefined) a1 = 0;
      if (a2 === undefined) a2 = 0;
      return (this.linearA.x * x1.x + this.linearA.y * x1.y) + this.angularA * a1 + (this.linearB.x * x2.x + this.linearB.y * x2.y) + this.angularB * a2;
   }
   b2Joint.b2Joint = function () {
      this.m_edgeA = new b2JointEdge();
      this.m_edgeB = new b2JointEdge();
      this.m_localCenterA = new b2Vec2();
      this.m_localCenterB = new b2Vec2();
   };
   b2Joint.prototype.GetType = function () {
      return this.m_type;
   }
   b2Joint.prototype.GetAnchorA = function () {
      return null;
   }
   b2Joint.prototype.GetAnchorB = function () {
      return null;
   }
   b2Joint.prototype.GetReactionForce = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return null;
   }
   b2Joint.prototype.GetReactionTorque = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return 0.0;
   }
   b2Joint.prototype.GetBodyA = function () {
      return this.m_bodyA;
   }
   b2Joint.prototype.GetBodyB = function () {
      return this.m_bodyB;
   }
   b2Joint.prototype.GetNext = function () {
      return this.m_next;
   }
   b2Joint.prototype.GetUserData = function () {
      return this.m_userData;
   }
   b2Joint.prototype.SetUserData = function (data) {
      this.m_userData = data;
   }
   b2Joint.prototype.IsActive = function () {
      return this.m_bodyA.IsActive() && this.m_bodyB.IsActive();
   }
   b2Joint.Create = function (def, allocator) {
      var joint = null;
      switch (def.type) {
      case b2Joint.e_distanceJoint:
         {
            joint = new b2DistanceJoint((def instanceof b2DistanceJointDef ? def : null));
         }
         break;
      case b2Joint.e_mouseJoint:
         {
            joint = new b2MouseJoint((def instanceof b2MouseJointDef ? def : null));
         }
         break;
      case b2Joint.e_prismaticJoint:
         {
            joint = new b2PrismaticJoint((def instanceof b2PrismaticJointDef ? def : null));
         }
         break;
      case b2Joint.e_revoluteJoint:
         {
            joint = new b2RevoluteJoint((def instanceof b2RevoluteJointDef ? def : null));
         }
         break;
      case b2Joint.e_pulleyJoint:
         {
            joint = new b2PulleyJoint((def instanceof b2PulleyJointDef ? def : null));
         }
         break;
      case b2Joint.e_gearJoint:
         {
            joint = new b2GearJoint((def instanceof b2GearJointDef ? def : null));
         }
         break;
      case b2Joint.e_lineJoint:
         {
            joint = new b2LineJoint((def instanceof b2LineJointDef ? def : null));
         }
         break;
      case b2Joint.e_weldJoint:
         {
            joint = new b2WeldJoint((def instanceof b2WeldJointDef ? def : null));
         }
         break;
      case b2Joint.e_frictionJoint:
         {
            joint = new b2FrictionJoint((def instanceof b2FrictionJointDef ? def : null));
         }
         break;
      default:
         break;
      }
      return joint;
   }
   b2Joint.Destroy = function (joint, allocator) {}
   b2Joint.prototype.b2Joint = function (def) {
      b2Settings.b2Assert(def.bodyA != def.bodyB);
      this.m_type = def.type;
      this.m_prev = null;
      this.m_next = null;
      this.m_bodyA = def.bodyA;
      this.m_bodyB = def.bodyB;
      this.m_collideConnected = def.collideConnected;
      this.m_islandFlag = false;
      this.m_userData = def.userData;
   }
   b2Joint.prototype.InitVelocityConstraints = function (step) {}
   b2Joint.prototype.SolveVelocityConstraints = function (step) {}
   b2Joint.prototype.FinalizeVelocityConstraints = function () {}
   b2Joint.prototype.SolvePositionConstraints = function (baumgarte) {
      if (baumgarte === undefined) baumgarte = 0;
      return false;
   }
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.Joints.b2Joint.e_unknownJoint = 0;
      Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint = 1;
      Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint = 2;
      Box2D.Dynamics.Joints.b2Joint.e_distanceJoint = 3;
      Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint = 4;
      Box2D.Dynamics.Joints.b2Joint.e_mouseJoint = 5;
      Box2D.Dynamics.Joints.b2Joint.e_gearJoint = 6;
      Box2D.Dynamics.Joints.b2Joint.e_lineJoint = 7;
      Box2D.Dynamics.Joints.b2Joint.e_weldJoint = 8;
      Box2D.Dynamics.Joints.b2Joint.e_frictionJoint = 9;
      Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit = 0;
      Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit = 1;
      Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit = 2;
      Box2D.Dynamics.Joints.b2Joint.e_equalLimits = 3;
   });
   b2JointDef.b2JointDef = function () {};
   b2JointDef.prototype.b2JointDef = function () {
      this.type = b2Joint.e_unknownJoint;
      this.userData = null;
      this.bodyA = null;
      this.bodyB = null;
      this.collideConnected = false;
   }
   b2JointEdge.b2JointEdge = function () {};
   Box2D.inherit(b2LineJoint, Box2D.Dynamics.Joints.b2Joint);
   b2LineJoint.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype;
   b2LineJoint.b2LineJoint = function () {
      Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments);
      this.m_localAnchor1 = new b2Vec2();
      this.m_localAnchor2 = new b2Vec2();
      this.m_localXAxis1 = new b2Vec2();
      this.m_localYAxis1 = new b2Vec2();
      this.m_axis = new b2Vec2();
      this.m_perp = new b2Vec2();
      this.m_K = new b2Mat22();
      this.m_impulse = new b2Vec2();
   };
   b2LineJoint.prototype.GetAnchorA = function () {
      return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
   }
   b2LineJoint.prototype.GetAnchorB = function () {
      return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
   }
   b2LineJoint.prototype.GetReactionForce = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return new b2Vec2(inv_dt * (this.m_impulse.x * this.m_perp.x + (this.m_motorImpulse + this.m_impulse.y) * this.m_axis.x), inv_dt * (this.m_impulse.x * this.m_perp.y + (this.m_motorImpulse + this.m_impulse.y) * this.m_axis.y));
   }
   b2LineJoint.prototype.GetReactionTorque = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return inv_dt * this.m_impulse.y;
   }
   b2LineJoint.prototype.GetJointTranslation = function () {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var tMat;
      var p1 = bA.GetWorldPoint(this.m_localAnchor1);
      var p2 = bB.GetWorldPoint(this.m_localAnchor2);
      var dX = p2.x - p1.x;
      var dY = p2.y - p1.y;
      var axis = bA.GetWorldVector(this.m_localXAxis1);
      var translation = axis.x * dX + axis.y * dY;
      return translation;
   }
   b2LineJoint.prototype.GetJointSpeed = function () {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var tMat;
      tMat = bA.m_xf.R;
      var r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
      var r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
      var tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
      r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
      r1X = tX;
      tMat = bB.m_xf.R;
      var r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
      var r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
      r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
      r2X = tX;
      var p1X = bA.m_sweep.c.x + r1X;
      var p1Y = bA.m_sweep.c.y + r1Y;
      var p2X = bB.m_sweep.c.x + r2X;
      var p2Y = bB.m_sweep.c.y + r2Y;
      var dX = p2X - p1X;
      var dY = p2Y - p1Y;
      var axis = bA.GetWorldVector(this.m_localXAxis1);
      var v1 = bA.m_linearVelocity;
      var v2 = bB.m_linearVelocity;
      var w1 = bA.m_angularVelocity;
      var w2 = bB.m_angularVelocity;
      var speed = (dX * ((-w1 * axis.y)) + dY * (w1 * axis.x)) + (axis.x * (((v2.x + ((-w2 * r2Y))) - v1.x) - ((-w1 * r1Y))) + axis.y * (((v2.y + (w2 * r2X)) - v1.y) - (w1 * r1X)));
      return speed;
   }
   b2LineJoint.prototype.IsLimitEnabled = function () {
      return this.m_enableLimit;
   }
   b2LineJoint.prototype.EnableLimit = function (flag) {
      this.m_bodyA.SetAwake(true);
      this.m_bodyB.SetAwake(true);
      this.m_enableLimit = flag;
   }
   b2LineJoint.prototype.GetLowerLimit = function () {
      return this.m_lowerTranslation;
   }
   b2LineJoint.prototype.GetUpperLimit = function () {
      return this.m_upperTranslation;
   }
   b2LineJoint.prototype.SetLimits = function (lower, upper) {
      if (lower === undefined) lower = 0;
      if (upper === undefined) upper = 0;
      this.m_bodyA.SetAwake(true);
      this.m_bodyB.SetAwake(true);
      this.m_lowerTranslation = lower;
      this.m_upperTranslation = upper;
   }
   b2LineJoint.prototype.IsMotorEnabled = function () {
      return this.m_enableMotor;
   }
   b2LineJoint.prototype.EnableMotor = function (flag) {
      this.m_bodyA.SetAwake(true);
      this.m_bodyB.SetAwake(true);
      this.m_enableMotor = flag;
   }
   b2LineJoint.prototype.SetMotorSpeed = function (speed) {
      if (speed === undefined) speed = 0;
      this.m_bodyA.SetAwake(true);
      this.m_bodyB.SetAwake(true);
      this.m_motorSpeed = speed;
   }
   b2LineJoint.prototype.GetMotorSpeed = function () {
      return this.m_motorSpeed;
   }
   b2LineJoint.prototype.SetMaxMotorForce = function (force) {
      if (force === undefined) force = 0;
      this.m_bodyA.SetAwake(true);
      this.m_bodyB.SetAwake(true);
      this.m_maxMotorForce = force;
   }
   b2LineJoint.prototype.GetMaxMotorForce = function () {
      return this.m_maxMotorForce;
   }
   b2LineJoint.prototype.GetMotorForce = function () {
      return this.m_motorImpulse;
   }
   b2LineJoint.prototype.b2LineJoint = function (def) {
      this.__super.b2Joint.call(this, def);
      var tMat;
      var tX = 0;
      var tY = 0;
      this.m_localAnchor1.SetV(def.localAnchorA);
      this.m_localAnchor2.SetV(def.localAnchorB);
      this.m_localXAxis1.SetV(def.localAxisA);
      this.m_localYAxis1.x = (-this.m_localXAxis1.y);
      this.m_localYAxis1.y = this.m_localXAxis1.x;
      this.m_impulse.SetZero();
      this.m_motorMass = 0.0;
      this.m_motorImpulse = 0.0;
      this.m_lowerTranslation = def.lowerTranslation;
      this.m_upperTranslation = def.upperTranslation;
      this.m_maxMotorForce = def.maxMotorForce;
      this.m_motorSpeed = def.motorSpeed;
      this.m_enableLimit = def.enableLimit;
      this.m_enableMotor = def.enableMotor;
      this.m_limitState = b2Joint.e_inactiveLimit;
      this.m_axis.SetZero();
      this.m_perp.SetZero();
   }
   b2LineJoint.prototype.InitVelocityConstraints = function (step) {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var tMat;
      var tX = 0;
      this.m_localCenterA.SetV(bA.GetLocalCenter());
      this.m_localCenterB.SetV(bB.GetLocalCenter());
      var xf1 = bA.GetTransform();
      var xf2 = bB.GetTransform();
      tMat = bA.m_xf.R;
      var r1X = this.m_localAnchor1.x - this.m_localCenterA.x;
      var r1Y = this.m_localAnchor1.y - this.m_localCenterA.y;
      tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
      r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
      r1X = tX;
      tMat = bB.m_xf.R;
      var r2X = this.m_localAnchor2.x - this.m_localCenterB.x;
      var r2Y = this.m_localAnchor2.y - this.m_localCenterB.y;
      tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
      r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
      r2X = tX;
      var dX = bB.m_sweep.c.x + r2X - bA.m_sweep.c.x - r1X;
      var dY = bB.m_sweep.c.y + r2Y - bA.m_sweep.c.y - r1Y;
      this.m_invMassA = bA.m_invMass;
      this.m_invMassB = bB.m_invMass;
      this.m_invIA = bA.m_invI;
      this.m_invIB = bB.m_invI; {
         this.m_axis.SetV(b2Math.MulMV(xf1.R, this.m_localXAxis1));
         this.m_a1 = (dX + r1X) * this.m_axis.y - (dY + r1Y) * this.m_axis.x;
         this.m_a2 = r2X * this.m_axis.y - r2Y * this.m_axis.x;
         this.m_motorMass = this.m_invMassA + this.m_invMassB + this.m_invIA * this.m_a1 * this.m_a1 + this.m_invIB * this.m_a2 * this.m_a2;
         this.m_motorMass = this.m_motorMass > Number.MIN_VALUE ? 1.0 / this.m_motorMass : 0.0;
      } {
         this.m_perp.SetV(b2Math.MulMV(xf1.R, this.m_localYAxis1));
         this.m_s1 = (dX + r1X) * this.m_perp.y - (dY + r1Y) * this.m_perp.x;
         this.m_s2 = r2X * this.m_perp.y - r2Y * this.m_perp.x;
         var m1 = this.m_invMassA;
         var m2 = this.m_invMassB;
         var i1 = this.m_invIA;
         var i2 = this.m_invIB;
         this.m_K.col1.x = m1 + m2 + i1 * this.m_s1 * this.m_s1 + i2 * this.m_s2 * this.m_s2;
         this.m_K.col1.y = i1 * this.m_s1 * this.m_a1 + i2 * this.m_s2 * this.m_a2;
         this.m_K.col2.x = this.m_K.col1.y;
         this.m_K.col2.y = m1 + m2 + i1 * this.m_a1 * this.m_a1 + i2 * this.m_a2 * this.m_a2;
      }
      if (this.m_enableLimit) {
         var jointTransition = this.m_axis.x * dX + this.m_axis.y * dY;
         if (b2Math.Abs(this.m_upperTranslation - this.m_lowerTranslation) < 2.0 * b2Settings.b2_linearSlop) {
            this.m_limitState = b2Joint.e_equalLimits;
         }
         else if (jointTransition <= this.m_lowerTranslation) {
            if (this.m_limitState != b2Joint.e_atLowerLimit) {
               this.m_limitState = b2Joint.e_atLowerLimit;
               this.m_impulse.y = 0.0;
            }
         }
         else if (jointTransition >= this.m_upperTranslation) {
            if (this.m_limitState != b2Joint.e_atUpperLimit) {
               this.m_limitState = b2Joint.e_atUpperLimit;
               this.m_impulse.y = 0.0;
            }
         }
         else {
            this.m_limitState = b2Joint.e_inactiveLimit;
            this.m_impulse.y = 0.0;
         }
      }
      else {
         this.m_limitState = b2Joint.e_inactiveLimit;
      }
      if (this.m_enableMotor == false) {
         this.m_motorImpulse = 0.0;
      }
      if (step.warmStarting) {
         this.m_impulse.x *= step.dtRatio;
         this.m_impulse.y *= step.dtRatio;
         this.m_motorImpulse *= step.dtRatio;
         var PX = this.m_impulse.x * this.m_perp.x + (this.m_motorImpulse + this.m_impulse.y) * this.m_axis.x;
         var PY = this.m_impulse.x * this.m_perp.y + (this.m_motorImpulse + this.m_impulse.y) * this.m_axis.y;
         var L1 = this.m_impulse.x * this.m_s1 + (this.m_motorImpulse + this.m_impulse.y) * this.m_a1;
         var L2 = this.m_impulse.x * this.m_s2 + (this.m_motorImpulse + this.m_impulse.y) * this.m_a2;
         bA.m_linearVelocity.x -= this.m_invMassA * PX;
         bA.m_linearVelocity.y -= this.m_invMassA * PY;
         bA.m_angularVelocity -= this.m_invIA * L1;
         bB.m_linearVelocity.x += this.m_invMassB * PX;
         bB.m_linearVelocity.y += this.m_invMassB * PY;
         bB.m_angularVelocity += this.m_invIB * L2;
      }
      else {
         this.m_impulse.SetZero();
         this.m_motorImpulse = 0.0;
      }
   }
   b2LineJoint.prototype.SolveVelocityConstraints = function (step) {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var v1 = bA.m_linearVelocity;
      var w1 = bA.m_angularVelocity;
      var v2 = bB.m_linearVelocity;
      var w2 = bB.m_angularVelocity;
      var PX = 0;
      var PY = 0;
      var L1 = 0;
      var L2 = 0;
      if (this.m_enableMotor && this.m_limitState != b2Joint.e_equalLimits) {
         var Cdot = this.m_axis.x * (v2.x - v1.x) + this.m_axis.y * (v2.y - v1.y) + this.m_a2 * w2 - this.m_a1 * w1;
         var impulse = this.m_motorMass * (this.m_motorSpeed - Cdot);
         var oldImpulse = this.m_motorImpulse;
         var maxImpulse = step.dt * this.m_maxMotorForce;
         this.m_motorImpulse = b2Math.Clamp(this.m_motorImpulse + impulse, (-maxImpulse), maxImpulse);
         impulse = this.m_motorImpulse - oldImpulse;
         PX = impulse * this.m_axis.x;
         PY = impulse * this.m_axis.y;
         L1 = impulse * this.m_a1;
         L2 = impulse * this.m_a2;
         v1.x -= this.m_invMassA * PX;
         v1.y -= this.m_invMassA * PY;
         w1 -= this.m_invIA * L1;
         v2.x += this.m_invMassB * PX;
         v2.y += this.m_invMassB * PY;
         w2 += this.m_invIB * L2;
      }
      var Cdot1 = this.m_perp.x * (v2.x - v1.x) + this.m_perp.y * (v2.y - v1.y) + this.m_s2 * w2 - this.m_s1 * w1;
      if (this.m_enableLimit && this.m_limitState != b2Joint.e_inactiveLimit) {
         var Cdot2 = this.m_axis.x * (v2.x - v1.x) + this.m_axis.y * (v2.y - v1.y) + this.m_a2 * w2 - this.m_a1 * w1;
         var f1 = this.m_impulse.Copy();
         var df = this.m_K.Solve(new b2Vec2(), (-Cdot1), (-Cdot2));
         this.m_impulse.Add(df);
         if (this.m_limitState == b2Joint.e_atLowerLimit) {
            this.m_impulse.y = b2Math.Max(this.m_impulse.y, 0.0);
         }
         else if (this.m_limitState == b2Joint.e_atUpperLimit) {
            this.m_impulse.y = b2Math.Min(this.m_impulse.y, 0.0);
         }
         var b = (-Cdot1) - (this.m_impulse.y - f1.y) * this.m_K.col2.x;
         var f2r = 0;
         if (this.m_K.col1.x != 0.0) {
            f2r = b / this.m_K.col1.x + f1.x;
         }
         else {
            f2r = f1.x;
         }
         this.m_impulse.x = f2r;
         df.x = this.m_impulse.x - f1.x;
         df.y = this.m_impulse.y - f1.y;
         PX = df.x * this.m_perp.x + df.y * this.m_axis.x;
         PY = df.x * this.m_perp.y + df.y * this.m_axis.y;
         L1 = df.x * this.m_s1 + df.y * this.m_a1;
         L2 = df.x * this.m_s2 + df.y * this.m_a2;
         v1.x -= this.m_invMassA * PX;
         v1.y -= this.m_invMassA * PY;
         w1 -= this.m_invIA * L1;
         v2.x += this.m_invMassB * PX;
         v2.y += this.m_invMassB * PY;
         w2 += this.m_invIB * L2;
      }
      else {
         var df2 = 0;
         if (this.m_K.col1.x != 0.0) {
            df2 = ((-Cdot1)) / this.m_K.col1.x;
         }
         else {
            df2 = 0.0;
         }
         this.m_impulse.x += df2;
         PX = df2 * this.m_perp.x;
         PY = df2 * this.m_perp.y;
         L1 = df2 * this.m_s1;
         L2 = df2 * this.m_s2;
         v1.x -= this.m_invMassA * PX;
         v1.y -= this.m_invMassA * PY;
         w1 -= this.m_invIA * L1;
         v2.x += this.m_invMassB * PX;
         v2.y += this.m_invMassB * PY;
         w2 += this.m_invIB * L2;
      }
      bA.m_linearVelocity.SetV(v1);
      bA.m_angularVelocity = w1;
      bB.m_linearVelocity.SetV(v2);
      bB.m_angularVelocity = w2;
   }
   b2LineJoint.prototype.SolvePositionConstraints = function (baumgarte) {
      if (baumgarte === undefined) baumgarte = 0;
      var limitC = 0;
      var oldLimitImpulse = 0;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var c1 = bA.m_sweep.c;
      var a1 = bA.m_sweep.a;
      var c2 = bB.m_sweep.c;
      var a2 = bB.m_sweep.a;
      var tMat;
      var tX = 0;
      var m1 = 0;
      var m2 = 0;
      var i1 = 0;
      var i2 = 0;
      var linearError = 0.0;
      var angularError = 0.0;
      var active = false;
      var C2 = 0.0;
      var R1 = b2Mat22.FromAngle(a1);
      var R2 = b2Mat22.FromAngle(a2);
      tMat = R1;
      var r1X = this.m_localAnchor1.x - this.m_localCenterA.x;
      var r1Y = this.m_localAnchor1.y - this.m_localCenterA.y;
      tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
      r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
      r1X = tX;
      tMat = R2;
      var r2X = this.m_localAnchor2.x - this.m_localCenterB.x;
      var r2Y = this.m_localAnchor2.y - this.m_localCenterB.y;
      tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
      r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
      r2X = tX;
      var dX = c2.x + r2X - c1.x - r1X;
      var dY = c2.y + r2Y - c1.y - r1Y;
      if (this.m_enableLimit) {
         this.m_axis = b2Math.MulMV(R1, this.m_localXAxis1);
         this.m_a1 = (dX + r1X) * this.m_axis.y - (dY + r1Y) * this.m_axis.x;
         this.m_a2 = r2X * this.m_axis.y - r2Y * this.m_axis.x;
         var translation = this.m_axis.x * dX + this.m_axis.y * dY;
         if (b2Math.Abs(this.m_upperTranslation - this.m_lowerTranslation) < 2.0 * b2Settings.b2_linearSlop) {
            C2 = b2Math.Clamp(translation, (-b2Settings.b2_maxLinearCorrection), b2Settings.b2_maxLinearCorrection);
            linearError = b2Math.Abs(translation);
            active = true;
         }
         else if (translation <= this.m_lowerTranslation) {
            C2 = b2Math.Clamp(translation - this.m_lowerTranslation + b2Settings.b2_linearSlop, (-b2Settings.b2_maxLinearCorrection), 0.0);
            linearError = this.m_lowerTranslation - translation;
            active = true;
         }
         else if (translation >= this.m_upperTranslation) {
            C2 = b2Math.Clamp(translation - this.m_upperTranslation + b2Settings.b2_linearSlop, 0.0, b2Settings.b2_maxLinearCorrection);
            linearError = translation - this.m_upperTranslation;
            active = true;
         }
      }
      this.m_perp = b2Math.MulMV(R1, this.m_localYAxis1);
      this.m_s1 = (dX + r1X) * this.m_perp.y - (dY + r1Y) * this.m_perp.x;
      this.m_s2 = r2X * this.m_perp.y - r2Y * this.m_perp.x;
      var impulse = new b2Vec2();
      var C1 = this.m_perp.x * dX + this.m_perp.y * dY;
      linearError = b2Math.Max(linearError, b2Math.Abs(C1));
      angularError = 0.0;
      if (active) {
         m1 = this.m_invMassA;
         m2 = this.m_invMassB;
         i1 = this.m_invIA;
         i2 = this.m_invIB;
         this.m_K.col1.x = m1 + m2 + i1 * this.m_s1 * this.m_s1 + i2 * this.m_s2 * this.m_s2;
         this.m_K.col1.y = i1 * this.m_s1 * this.m_a1 + i2 * this.m_s2 * this.m_a2;
         this.m_K.col2.x = this.m_K.col1.y;
         this.m_K.col2.y = m1 + m2 + i1 * this.m_a1 * this.m_a1 + i2 * this.m_a2 * this.m_a2;
         this.m_K.Solve(impulse, (-C1), (-C2));
      }
      else {
         m1 = this.m_invMassA;
         m2 = this.m_invMassB;
         i1 = this.m_invIA;
         i2 = this.m_invIB;
         var k11 = m1 + m2 + i1 * this.m_s1 * this.m_s1 + i2 * this.m_s2 * this.m_s2;
         var impulse1 = 0;
         if (k11 != 0.0) {
            impulse1 = ((-C1)) / k11;
         }
         else {
            impulse1 = 0.0;
         }
         impulse.x = impulse1;
         impulse.y = 0.0;
      }
      var PX = impulse.x * this.m_perp.x + impulse.y * this.m_axis.x;
      var PY = impulse.x * this.m_perp.y + impulse.y * this.m_axis.y;
      var L1 = impulse.x * this.m_s1 + impulse.y * this.m_a1;
      var L2 = impulse.x * this.m_s2 + impulse.y * this.m_a2;
      c1.x -= this.m_invMassA * PX;
      c1.y -= this.m_invMassA * PY;
      a1 -= this.m_invIA * L1;
      c2.x += this.m_invMassB * PX;
      c2.y += this.m_invMassB * PY;
      a2 += this.m_invIB * L2;
      bA.m_sweep.a = a1;
      bB.m_sweep.a = a2;
      bA.SynchronizeTransform();
      bB.SynchronizeTransform();
      return linearError <= b2Settings.b2_linearSlop && angularError <= b2Settings.b2_angularSlop;
   }
   Box2D.inherit(b2LineJointDef, Box2D.Dynamics.Joints.b2JointDef);
   b2LineJointDef.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype;
   b2LineJointDef.b2LineJointDef = function () {
      Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments);
      this.localAnchorA = new b2Vec2();
      this.localAnchorB = new b2Vec2();
      this.localAxisA = new b2Vec2();
   };
   b2LineJointDef.prototype.b2LineJointDef = function () {
      this.__super.b2JointDef.call(this);
      this.type = b2Joint.e_lineJoint;
      this.localAxisA.Set(1.0, 0.0);
      this.enableLimit = false;
      this.lowerTranslation = 0.0;
      this.upperTranslation = 0.0;
      this.enableMotor = false;
      this.maxMotorForce = 0.0;
      this.motorSpeed = 0.0;
   }
   b2LineJointDef.prototype.Initialize = function (bA, bB, anchor, axis) {
      this.bodyA = bA;
      this.bodyB = bB;
      this.localAnchorA = this.bodyA.GetLocalPoint(anchor);
      this.localAnchorB = this.bodyB.GetLocalPoint(anchor);
      this.localAxisA = this.bodyA.GetLocalVector(axis);
   }
   Box2D.inherit(b2MouseJoint, Box2D.Dynamics.Joints.b2Joint);
   b2MouseJoint.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype;
   b2MouseJoint.b2MouseJoint = function () {
      Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments);
      this.K = new b2Mat22();
      this.K1 = new b2Mat22();
      this.K2 = new b2Mat22();
      this.m_localAnchor = new b2Vec2();
      this.m_target = new b2Vec2();
      this.m_impulse = new b2Vec2();
      this.m_mass = new b2Mat22();
      this.m_C = new b2Vec2();
   };
   b2MouseJoint.prototype.GetAnchorA = function () {
      return this.m_target;
   }
   b2MouseJoint.prototype.GetAnchorB = function () {
      return this.m_bodyB.GetWorldPoint(this.m_localAnchor);
   }
   b2MouseJoint.prototype.GetReactionForce = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return new b2Vec2(inv_dt * this.m_impulse.x, inv_dt * this.m_impulse.y);
   }
   b2MouseJoint.prototype.GetReactionTorque = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return 0.0;
   }
   b2MouseJoint.prototype.GetTarget = function () {
      return this.m_target;
   }
   b2MouseJoint.prototype.SetTarget = function (target) {
      if (this.m_bodyB.IsAwake() == false) {
         this.m_bodyB.SetAwake(true);
      }
      this.m_target = target;
   }
   b2MouseJoint.prototype.GetMaxForce = function () {
      return this.m_maxForce;
   }
   b2MouseJoint.prototype.SetMaxForce = function (maxForce) {
      if (maxForce === undefined) maxForce = 0;
      this.m_maxForce = maxForce;
   }
   b2MouseJoint.prototype.GetFrequency = function () {
      return this.m_frequencyHz;
   }
   b2MouseJoint.prototype.SetFrequency = function (hz) {
      if (hz === undefined) hz = 0;
      this.m_frequencyHz = hz;
   }
   b2MouseJoint.prototype.GetDampingRatio = function () {
      return this.m_dampingRatio;
   }
   b2MouseJoint.prototype.SetDampingRatio = function (ratio) {
      if (ratio === undefined) ratio = 0;
      this.m_dampingRatio = ratio;
   }
   b2MouseJoint.prototype.b2MouseJoint = function (def) {
      this.__super.b2Joint.call(this, def);
      this.m_target.SetV(def.target);
      var tX = this.m_target.x - this.m_bodyB.m_xf.position.x;
      var tY = this.m_target.y - this.m_bodyB.m_xf.position.y;
      var tMat = this.m_bodyB.m_xf.R;
      this.m_localAnchor.x = (tX * tMat.col1.x + tY * tMat.col1.y);
      this.m_localAnchor.y = (tX * tMat.col2.x + tY * tMat.col2.y);
      this.m_maxForce = def.maxForce;
      this.m_impulse.SetZero();
      this.m_frequencyHz = def.frequencyHz;
      this.m_dampingRatio = def.dampingRatio;
      this.m_beta = 0.0;
      this.m_gamma = 0.0;
   }
   b2MouseJoint.prototype.InitVelocityConstraints = function (step) {
      var b = this.m_bodyB;
      var mass = b.GetMass();
      var omega = 2.0 * Math.PI * this.m_frequencyHz;
      var d = 2.0 * mass * this.m_dampingRatio * omega;
      var k = mass * omega * omega;
      this.m_gamma = step.dt * (d + step.dt * k);
      this.m_gamma = this.m_gamma != 0 ? 1 / this.m_gamma : 0.0;
      this.m_beta = step.dt * k * this.m_gamma;
      var tMat;tMat = b.m_xf.R;
      var rX = this.m_localAnchor.x - b.m_sweep.localCenter.x;
      var rY = this.m_localAnchor.y - b.m_sweep.localCenter.y;
      var tX = (tMat.col1.x * rX + tMat.col2.x * rY);rY = (tMat.col1.y * rX + tMat.col2.y * rY);
      rX = tX;
      var invMass = b.m_invMass;
      var invI = b.m_invI;this.K1.col1.x = invMass;
      this.K1.col2.x = 0.0;
      this.K1.col1.y = 0.0;
      this.K1.col2.y = invMass;
      this.K2.col1.x = invI * rY * rY;
      this.K2.col2.x = (-invI * rX * rY);
      this.K2.col1.y = (-invI * rX * rY);
      this.K2.col2.y = invI * rX * rX;
      this.K.SetM(this.K1);
      this.K.AddM(this.K2);
      this.K.col1.x += this.m_gamma;
      this.K.col2.y += this.m_gamma;
      this.K.GetInverse(this.m_mass);
      this.m_C.x = b.m_sweep.c.x + rX - this.m_target.x;
      this.m_C.y = b.m_sweep.c.y + rY - this.m_target.y;
      b.m_angularVelocity *= 0.98;
      this.m_impulse.x *= step.dtRatio;
      this.m_impulse.y *= step.dtRatio;
      b.m_linearVelocity.x += invMass * this.m_impulse.x;
      b.m_linearVelocity.y += invMass * this.m_impulse.y;
      b.m_angularVelocity += invI * (rX * this.m_impulse.y - rY * this.m_impulse.x);
   }
   b2MouseJoint.prototype.SolveVelocityConstraints = function (step) {
      var b = this.m_bodyB;
      var tMat;
      var tX = 0;
      var tY = 0;
      tMat = b.m_xf.R;
      var rX = this.m_localAnchor.x - b.m_sweep.localCenter.x;
      var rY = this.m_localAnchor.y - b.m_sweep.localCenter.y;
      tX = (tMat.col1.x * rX + tMat.col2.x * rY);
      rY = (tMat.col1.y * rX + tMat.col2.y * rY);
      rX = tX;
      var CdotX = b.m_linearVelocity.x + ((-b.m_angularVelocity * rY));
      var CdotY = b.m_linearVelocity.y + (b.m_angularVelocity * rX);
      tMat = this.m_mass;
      tX = CdotX + this.m_beta * this.m_C.x + this.m_gamma * this.m_impulse.x;
      tY = CdotY + this.m_beta * this.m_C.y + this.m_gamma * this.m_impulse.y;
      var impulseX = (-(tMat.col1.x * tX + tMat.col2.x * tY));
      var impulseY = (-(tMat.col1.y * tX + tMat.col2.y * tY));
      var oldImpulseX = this.m_impulse.x;
      var oldImpulseY = this.m_impulse.y;
      this.m_impulse.x += impulseX;
      this.m_impulse.y += impulseY;
      var maxImpulse = step.dt * this.m_maxForce;
      if (this.m_impulse.LengthSquared() > maxImpulse * maxImpulse) {
         this.m_impulse.Multiply(maxImpulse / this.m_impulse.Length());
      }
      impulseX = this.m_impulse.x - oldImpulseX;
      impulseY = this.m_impulse.y - oldImpulseY;
      b.m_linearVelocity.x += b.m_invMass * impulseX;
      b.m_linearVelocity.y += b.m_invMass * impulseY;
      b.m_angularVelocity += b.m_invI * (rX * impulseY - rY * impulseX);
   }
   b2MouseJoint.prototype.SolvePositionConstraints = function (baumgarte) {
      if (baumgarte === undefined) baumgarte = 0;
      return true;
   }
   Box2D.inherit(b2MouseJointDef, Box2D.Dynamics.Joints.b2JointDef);
   b2MouseJointDef.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype;
   b2MouseJointDef.b2MouseJointDef = function () {
      Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments);
      this.target = new b2Vec2();
   };
   b2MouseJointDef.prototype.b2MouseJointDef = function () {
      this.__super.b2JointDef.call(this);
      this.type = b2Joint.e_mouseJoint;
      this.maxForce = 0.0;
      this.frequencyHz = 5.0;
      this.dampingRatio = 0.7;
   }
   Box2D.inherit(b2PrismaticJoint, Box2D.Dynamics.Joints.b2Joint);
   b2PrismaticJoint.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype;
   b2PrismaticJoint.b2PrismaticJoint = function () {
      Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments);
      this.m_localAnchor1 = new b2Vec2();
      this.m_localAnchor2 = new b2Vec2();
      this.m_localXAxis1 = new b2Vec2();
      this.m_localYAxis1 = new b2Vec2();
      this.m_axis = new b2Vec2();
      this.m_perp = new b2Vec2();
      this.m_K = new b2Mat33();
      this.m_impulse = new b2Vec3();
   };
   b2PrismaticJoint.prototype.GetAnchorA = function () {
      return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
   }
   b2PrismaticJoint.prototype.GetAnchorB = function () {
      return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
   }
   b2PrismaticJoint.prototype.GetReactionForce = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return new b2Vec2(inv_dt * (this.m_impulse.x * this.m_perp.x + (this.m_motorImpulse + this.m_impulse.z) * this.m_axis.x), inv_dt * (this.m_impulse.x * this.m_perp.y + (this.m_motorImpulse + this.m_impulse.z) * this.m_axis.y));
   }
   b2PrismaticJoint.prototype.GetReactionTorque = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return inv_dt * this.m_impulse.y;
   }
   b2PrismaticJoint.prototype.GetJointTranslation = function () {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var tMat;
      var p1 = bA.GetWorldPoint(this.m_localAnchor1);
      var p2 = bB.GetWorldPoint(this.m_localAnchor2);
      var dX = p2.x - p1.x;
      var dY = p2.y - p1.y;
      var axis = bA.GetWorldVector(this.m_localXAxis1);
      var translation = axis.x * dX + axis.y * dY;
      return translation;
   }
   b2PrismaticJoint.prototype.GetJointSpeed = function () {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var tMat;
      tMat = bA.m_xf.R;
      var r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
      var r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
      var tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
      r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
      r1X = tX;
      tMat = bB.m_xf.R;
      var r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
      var r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
      r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
      r2X = tX;
      var p1X = bA.m_sweep.c.x + r1X;
      var p1Y = bA.m_sweep.c.y + r1Y;
      var p2X = bB.m_sweep.c.x + r2X;
      var p2Y = bB.m_sweep.c.y + r2Y;
      var dX = p2X - p1X;
      var dY = p2Y - p1Y;
      var axis = bA.GetWorldVector(this.m_localXAxis1);
      var v1 = bA.m_linearVelocity;
      var v2 = bB.m_linearVelocity;
      var w1 = bA.m_angularVelocity;
      var w2 = bB.m_angularVelocity;
      var speed = (dX * ((-w1 * axis.y)) + dY * (w1 * axis.x)) + (axis.x * (((v2.x + ((-w2 * r2Y))) - v1.x) - ((-w1 * r1Y))) + axis.y * (((v2.y + (w2 * r2X)) - v1.y) - (w1 * r1X)));
      return speed;
   }
   b2PrismaticJoint.prototype.IsLimitEnabled = function () {
      return this.m_enableLimit;
   }
   b2PrismaticJoint.prototype.EnableLimit = function (flag) {
      this.m_bodyA.SetAwake(true);
      this.m_bodyB.SetAwake(true);
      this.m_enableLimit = flag;
   }
   b2PrismaticJoint.prototype.GetLowerLimit = function () {
      return this.m_lowerTranslation;
   }
   b2PrismaticJoint.prototype.GetUpperLimit = function () {
      return this.m_upperTranslation;
   }
   b2PrismaticJoint.prototype.SetLimits = function (lower, upper) {
      if (lower === undefined) lower = 0;
      if (upper === undefined) upper = 0;
      this.m_bodyA.SetAwake(true);
      this.m_bodyB.SetAwake(true);
      this.m_lowerTranslation = lower;
      this.m_upperTranslation = upper;
   }
   b2PrismaticJoint.prototype.IsMotorEnabled = function () {
      return this.m_enableMotor;
   }
   b2PrismaticJoint.prototype.EnableMotor = function (flag) {
      this.m_bodyA.SetAwake(true);
      this.m_bodyB.SetAwake(true);
      this.m_enableMotor = flag;
   }
   b2PrismaticJoint.prototype.SetMotorSpeed = function (speed) {
      if (speed === undefined) speed = 0;
      this.m_bodyA.SetAwake(true);
      this.m_bodyB.SetAwake(true);
      this.m_motorSpeed = speed;
   }
   b2PrismaticJoint.prototype.GetMotorSpeed = function () {
      return this.m_motorSpeed;
   }
   b2PrismaticJoint.prototype.SetMaxMotorForce = function (force) {
      if (force === undefined) force = 0;
      this.m_bodyA.SetAwake(true);
      this.m_bodyB.SetAwake(true);
      this.m_maxMotorForce = force;
   }
   b2PrismaticJoint.prototype.GetMotorForce = function () {
      return this.m_motorImpulse;
   }
   b2PrismaticJoint.prototype.b2PrismaticJoint = function (def) {
      this.__super.b2Joint.call(this, def);
      var tMat;
      var tX = 0;
      var tY = 0;
      this.m_localAnchor1.SetV(def.localAnchorA);
      this.m_localAnchor2.SetV(def.localAnchorB);
      this.m_localXAxis1.SetV(def.localAxisA);
      this.m_localYAxis1.x = (-this.m_localXAxis1.y);
      this.m_localYAxis1.y = this.m_localXAxis1.x;
      this.m_refAngle = def.referenceAngle;
      this.m_impulse.SetZero();
      this.m_motorMass = 0.0;
      this.m_motorImpulse = 0.0;
      this.m_lowerTranslation = def.lowerTranslation;
      this.m_upperTranslation = def.upperTranslation;
      this.m_maxMotorForce = def.maxMotorForce;
      this.m_motorSpeed = def.motorSpeed;
      this.m_enableLimit = def.enableLimit;
      this.m_enableMotor = def.enableMotor;
      this.m_limitState = b2Joint.e_inactiveLimit;
      this.m_axis.SetZero();
      this.m_perp.SetZero();
   }
   b2PrismaticJoint.prototype.InitVelocityConstraints = function (step) {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var tMat;
      var tX = 0;
      this.m_localCenterA.SetV(bA.GetLocalCenter());
      this.m_localCenterB.SetV(bB.GetLocalCenter());
      var xf1 = bA.GetTransform();
      var xf2 = bB.GetTransform();
      tMat = bA.m_xf.R;
      var r1X = this.m_localAnchor1.x - this.m_localCenterA.x;
      var r1Y = this.m_localAnchor1.y - this.m_localCenterA.y;
      tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
      r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
      r1X = tX;
      tMat = bB.m_xf.R;
      var r2X = this.m_localAnchor2.x - this.m_localCenterB.x;
      var r2Y = this.m_localAnchor2.y - this.m_localCenterB.y;
      tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
      r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
      r2X = tX;
      var dX = bB.m_sweep.c.x + r2X - bA.m_sweep.c.x - r1X;
      var dY = bB.m_sweep.c.y + r2Y - bA.m_sweep.c.y - r1Y;
      this.m_invMassA = bA.m_invMass;
      this.m_invMassB = bB.m_invMass;
      this.m_invIA = bA.m_invI;
      this.m_invIB = bB.m_invI; {
         this.m_axis.SetV(b2Math.MulMV(xf1.R, this.m_localXAxis1));
         this.m_a1 = (dX + r1X) * this.m_axis.y - (dY + r1Y) * this.m_axis.x;
         this.m_a2 = r2X * this.m_axis.y - r2Y * this.m_axis.x;
         this.m_motorMass = this.m_invMassA + this.m_invMassB + this.m_invIA * this.m_a1 * this.m_a1 + this.m_invIB * this.m_a2 * this.m_a2;
         if (this.m_motorMass > Number.MIN_VALUE) this.m_motorMass = 1.0 / this.m_motorMass;
      } {
         this.m_perp.SetV(b2Math.MulMV(xf1.R, this.m_localYAxis1));
         this.m_s1 = (dX + r1X) * this.m_perp.y - (dY + r1Y) * this.m_perp.x;
         this.m_s2 = r2X * this.m_perp.y - r2Y * this.m_perp.x;
         var m1 = this.m_invMassA;
         var m2 = this.m_invMassB;
         var i1 = this.m_invIA;
         var i2 = this.m_invIB;
         this.m_K.col1.x = m1 + m2 + i1 * this.m_s1 * this.m_s1 + i2 * this.m_s2 * this.m_s2;
         this.m_K.col1.y = i1 * this.m_s1 + i2 * this.m_s2;
         this.m_K.col1.z = i1 * this.m_s1 * this.m_a1 + i2 * this.m_s2 * this.m_a2;
         this.m_K.col2.x = this.m_K.col1.y;
         this.m_K.col2.y = i1 + i2;
         this.m_K.col2.z = i1 * this.m_a1 + i2 * this.m_a2;
         this.m_K.col3.x = this.m_K.col1.z;
         this.m_K.col3.y = this.m_K.col2.z;
         this.m_K.col3.z = m1 + m2 + i1 * this.m_a1 * this.m_a1 + i2 * this.m_a2 * this.m_a2;
      }
      if (this.m_enableLimit) {
         var jointTransition = this.m_axis.x * dX + this.m_axis.y * dY;
         if (b2Math.Abs(this.m_upperTranslation - this.m_lowerTranslation) < 2.0 * b2Settings.b2_linearSlop) {
            this.m_limitState = b2Joint.e_equalLimits;
         }
         else if (jointTransition <= this.m_lowerTranslation) {
            if (this.m_limitState != b2Joint.e_atLowerLimit) {
               this.m_limitState = b2Joint.e_atLowerLimit;
               this.m_impulse.z = 0.0;
            }
         }
         else if (jointTransition >= this.m_upperTranslation) {
            if (this.m_limitState != b2Joint.e_atUpperLimit) {
               this.m_limitState = b2Joint.e_atUpperLimit;
               this.m_impulse.z = 0.0;
            }
         }
         else {
            this.m_limitState = b2Joint.e_inactiveLimit;
            this.m_impulse.z = 0.0;
         }
      }
      else {
         this.m_limitState = b2Joint.e_inactiveLimit;
      }
      if (this.m_enableMotor == false) {
         this.m_motorImpulse = 0.0;
      }
      if (step.warmStarting) {
         this.m_impulse.x *= step.dtRatio;
         this.m_impulse.y *= step.dtRatio;
         this.m_motorImpulse *= step.dtRatio;
         var PX = this.m_impulse.x * this.m_perp.x + (this.m_motorImpulse + this.m_impulse.z) * this.m_axis.x;
         var PY = this.m_impulse.x * this.m_perp.y + (this.m_motorImpulse + this.m_impulse.z) * this.m_axis.y;
         var L1 = this.m_impulse.x * this.m_s1 + this.m_impulse.y + (this.m_motorImpulse + this.m_impulse.z) * this.m_a1;
         var L2 = this.m_impulse.x * this.m_s2 + this.m_impulse.y + (this.m_motorImpulse + this.m_impulse.z) * this.m_a2;
         bA.m_linearVelocity.x -= this.m_invMassA * PX;
         bA.m_linearVelocity.y -= this.m_invMassA * PY;
         bA.m_angularVelocity -= this.m_invIA * L1;
         bB.m_linearVelocity.x += this.m_invMassB * PX;
         bB.m_linearVelocity.y += this.m_invMassB * PY;
         bB.m_angularVelocity += this.m_invIB * L2;
      }
      else {
         this.m_impulse.SetZero();
         this.m_motorImpulse = 0.0;
      }
   }
   b2PrismaticJoint.prototype.SolveVelocityConstraints = function (step) {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var v1 = bA.m_linearVelocity;
      var w1 = bA.m_angularVelocity;
      var v2 = bB.m_linearVelocity;
      var w2 = bB.m_angularVelocity;
      var PX = 0;
      var PY = 0;
      var L1 = 0;
      var L2 = 0;
      if (this.m_enableMotor && this.m_limitState != b2Joint.e_equalLimits) {
         var Cdot = this.m_axis.x * (v2.x - v1.x) + this.m_axis.y * (v2.y - v1.y) + this.m_a2 * w2 - this.m_a1 * w1;
         var impulse = this.m_motorMass * (this.m_motorSpeed - Cdot);
         var oldImpulse = this.m_motorImpulse;
         var maxImpulse = step.dt * this.m_maxMotorForce;
         this.m_motorImpulse = b2Math.Clamp(this.m_motorImpulse + impulse, (-maxImpulse), maxImpulse);
         impulse = this.m_motorImpulse - oldImpulse;
         PX = impulse * this.m_axis.x;
         PY = impulse * this.m_axis.y;
         L1 = impulse * this.m_a1;
         L2 = impulse * this.m_a2;
         v1.x -= this.m_invMassA * PX;
         v1.y -= this.m_invMassA * PY;
         w1 -= this.m_invIA * L1;
         v2.x += this.m_invMassB * PX;
         v2.y += this.m_invMassB * PY;
         w2 += this.m_invIB * L2;
      }
      var Cdot1X = this.m_perp.x * (v2.x - v1.x) + this.m_perp.y * (v2.y - v1.y) + this.m_s2 * w2 - this.m_s1 * w1;
      var Cdot1Y = w2 - w1;
      if (this.m_enableLimit && this.m_limitState != b2Joint.e_inactiveLimit) {
         var Cdot2 = this.m_axis.x * (v2.x - v1.x) + this.m_axis.y * (v2.y - v1.y) + this.m_a2 * w2 - this.m_a1 * w1;
         var f1 = this.m_impulse.Copy();
         var df = this.m_K.Solve33(new b2Vec3(), (-Cdot1X), (-Cdot1Y), (-Cdot2));
         this.m_impulse.Add(df);
         if (this.m_limitState == b2Joint.e_atLowerLimit) {
            this.m_impulse.z = b2Math.Max(this.m_impulse.z, 0.0);
         }
         else if (this.m_limitState == b2Joint.e_atUpperLimit) {
            this.m_impulse.z = b2Math.Min(this.m_impulse.z, 0.0);
         }
         var bX = (-Cdot1X) - (this.m_impulse.z - f1.z) * this.m_K.col3.x;
         var bY = (-Cdot1Y) - (this.m_impulse.z - f1.z) * this.m_K.col3.y;
         var f2r = this.m_K.Solve22(new b2Vec2(), bX, bY);
         f2r.x += f1.x;
         f2r.y += f1.y;
         this.m_impulse.x = f2r.x;
         this.m_impulse.y = f2r.y;
         df.x = this.m_impulse.x - f1.x;
         df.y = this.m_impulse.y - f1.y;
         df.z = this.m_impulse.z - f1.z;
         PX = df.x * this.m_perp.x + df.z * this.m_axis.x;
         PY = df.x * this.m_perp.y + df.z * this.m_axis.y;
         L1 = df.x * this.m_s1 + df.y + df.z * this.m_a1;
         L2 = df.x * this.m_s2 + df.y + df.z * this.m_a2;
         v1.x -= this.m_invMassA * PX;
         v1.y -= this.m_invMassA * PY;
         w1 -= this.m_invIA * L1;
         v2.x += this.m_invMassB * PX;
         v2.y += this.m_invMassB * PY;
         w2 += this.m_invIB * L2;
      }
      else {
         var df2 = this.m_K.Solve22(new b2Vec2(), (-Cdot1X), (-Cdot1Y));
         this.m_impulse.x += df2.x;
         this.m_impulse.y += df2.y;
         PX = df2.x * this.m_perp.x;
         PY = df2.x * this.m_perp.y;
         L1 = df2.x * this.m_s1 + df2.y;
         L2 = df2.x * this.m_s2 + df2.y;
         v1.x -= this.m_invMassA * PX;
         v1.y -= this.m_invMassA * PY;
         w1 -= this.m_invIA * L1;
         v2.x += this.m_invMassB * PX;
         v2.y += this.m_invMassB * PY;
         w2 += this.m_invIB * L2;
      }
      bA.m_linearVelocity.SetV(v1);
      bA.m_angularVelocity = w1;
      bB.m_linearVelocity.SetV(v2);
      bB.m_angularVelocity = w2;
   }
   b2PrismaticJoint.prototype.SolvePositionConstraints = function (baumgarte) {
      if (baumgarte === undefined) baumgarte = 0;
      var limitC = 0;
      var oldLimitImpulse = 0;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var c1 = bA.m_sweep.c;
      var a1 = bA.m_sweep.a;
      var c2 = bB.m_sweep.c;
      var a2 = bB.m_sweep.a;
      var tMat;
      var tX = 0;
      var m1 = 0;
      var m2 = 0;
      var i1 = 0;
      var i2 = 0;
      var linearError = 0.0;
      var angularError = 0.0;
      var active = false;
      var C2 = 0.0;
      var R1 = b2Mat22.FromAngle(a1);
      var R2 = b2Mat22.FromAngle(a2);
      tMat = R1;
      var r1X = this.m_localAnchor1.x - this.m_localCenterA.x;
      var r1Y = this.m_localAnchor1.y - this.m_localCenterA.y;
      tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
      r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
      r1X = tX;
      tMat = R2;
      var r2X = this.m_localAnchor2.x - this.m_localCenterB.x;
      var r2Y = this.m_localAnchor2.y - this.m_localCenterB.y;
      tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
      r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
      r2X = tX;
      var dX = c2.x + r2X - c1.x - r1X;
      var dY = c2.y + r2Y - c1.y - r1Y;
      if (this.m_enableLimit) {
         this.m_axis = b2Math.MulMV(R1, this.m_localXAxis1);
         this.m_a1 = (dX + r1X) * this.m_axis.y - (dY + r1Y) * this.m_axis.x;
         this.m_a2 = r2X * this.m_axis.y - r2Y * this.m_axis.x;
         var translation = this.m_axis.x * dX + this.m_axis.y * dY;
         if (b2Math.Abs(this.m_upperTranslation - this.m_lowerTranslation) < 2.0 * b2Settings.b2_linearSlop) {
            C2 = b2Math.Clamp(translation, (-b2Settings.b2_maxLinearCorrection), b2Settings.b2_maxLinearCorrection);
            linearError = b2Math.Abs(translation);
            active = true;
         }
         else if (translation <= this.m_lowerTranslation) {
            C2 = b2Math.Clamp(translation - this.m_lowerTranslation + b2Settings.b2_linearSlop, (-b2Settings.b2_maxLinearCorrection), 0.0);
            linearError = this.m_lowerTranslation - translation;
            active = true;
         }
         else if (translation >= this.m_upperTranslation) {
            C2 = b2Math.Clamp(translation - this.m_upperTranslation + b2Settings.b2_linearSlop, 0.0, b2Settings.b2_maxLinearCorrection);
            linearError = translation - this.m_upperTranslation;
            active = true;
         }
      }
      this.m_perp = b2Math.MulMV(R1, this.m_localYAxis1);
      this.m_s1 = (dX + r1X) * this.m_perp.y - (dY + r1Y) * this.m_perp.x;
      this.m_s2 = r2X * this.m_perp.y - r2Y * this.m_perp.x;
      var impulse = new b2Vec3();
      var C1X = this.m_perp.x * dX + this.m_perp.y * dY;
      var C1Y = a2 - a1 - this.m_refAngle;
      linearError = b2Math.Max(linearError, b2Math.Abs(C1X));
      angularError = b2Math.Abs(C1Y);
      if (active) {
         m1 = this.m_invMassA;
         m2 = this.m_invMassB;
         i1 = this.m_invIA;
         i2 = this.m_invIB;
         this.m_K.col1.x = m1 + m2 + i1 * this.m_s1 * this.m_s1 + i2 * this.m_s2 * this.m_s2;
         this.m_K.col1.y = i1 * this.m_s1 + i2 * this.m_s2;
         this.m_K.col1.z = i1 * this.m_s1 * this.m_a1 + i2 * this.m_s2 * this.m_a2;
         this.m_K.col2.x = this.m_K.col1.y;
         this.m_K.col2.y = i1 + i2;
         this.m_K.col2.z = i1 * this.m_a1 + i2 * this.m_a2;
         this.m_K.col3.x = this.m_K.col1.z;
         this.m_K.col3.y = this.m_K.col2.z;
         this.m_K.col3.z = m1 + m2 + i1 * this.m_a1 * this.m_a1 + i2 * this.m_a2 * this.m_a2;
         this.m_K.Solve33(impulse, (-C1X), (-C1Y), (-C2));
      }
      else {
         m1 = this.m_invMassA;
         m2 = this.m_invMassB;
         i1 = this.m_invIA;
         i2 = this.m_invIB;
         var k11 = m1 + m2 + i1 * this.m_s1 * this.m_s1 + i2 * this.m_s2 * this.m_s2;
         var k12 = i1 * this.m_s1 + i2 * this.m_s2;
         var k22 = i1 + i2;
         this.m_K.col1.Set(k11, k12, 0.0);
         this.m_K.col2.Set(k12, k22, 0.0);
         var impulse1 = this.m_K.Solve22(new b2Vec2(), (-C1X), (-C1Y));
         impulse.x = impulse1.x;
         impulse.y = impulse1.y;
         impulse.z = 0.0;
      }
      var PX = impulse.x * this.m_perp.x + impulse.z * this.m_axis.x;
      var PY = impulse.x * this.m_perp.y + impulse.z * this.m_axis.y;
      var L1 = impulse.x * this.m_s1 + impulse.y + impulse.z * this.m_a1;
      var L2 = impulse.x * this.m_s2 + impulse.y + impulse.z * this.m_a2;
      c1.x -= this.m_invMassA * PX;
      c1.y -= this.m_invMassA * PY;
      a1 -= this.m_invIA * L1;
      c2.x += this.m_invMassB * PX;
      c2.y += this.m_invMassB * PY;
      a2 += this.m_invIB * L2;
      bA.m_sweep.a = a1;
      bB.m_sweep.a = a2;
      bA.SynchronizeTransform();
      bB.SynchronizeTransform();
      return linearError <= b2Settings.b2_linearSlop && angularError <= b2Settings.b2_angularSlop;
   }
   Box2D.inherit(b2PrismaticJointDef, Box2D.Dynamics.Joints.b2JointDef);
   b2PrismaticJointDef.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype;
   b2PrismaticJointDef.b2PrismaticJointDef = function () {
      Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments);
      this.localAnchorA = new b2Vec2();
      this.localAnchorB = new b2Vec2();
      this.localAxisA = new b2Vec2();
   };
   b2PrismaticJointDef.prototype.b2PrismaticJointDef = function () {
      this.__super.b2JointDef.call(this);
      this.type = b2Joint.e_prismaticJoint;
      this.localAxisA.Set(1.0, 0.0);
      this.referenceAngle = 0.0;
      this.enableLimit = false;
      this.lowerTranslation = 0.0;
      this.upperTranslation = 0.0;
      this.enableMotor = false;
      this.maxMotorForce = 0.0;
      this.motorSpeed = 0.0;
   }
   b2PrismaticJointDef.prototype.Initialize = function (bA, bB, anchor, axis) {
      this.bodyA = bA;
      this.bodyB = bB;
      this.localAnchorA = this.bodyA.GetLocalPoint(anchor);
      this.localAnchorB = this.bodyB.GetLocalPoint(anchor);
      this.localAxisA = this.bodyA.GetLocalVector(axis);
      this.referenceAngle = this.bodyB.GetAngle() - this.bodyA.GetAngle();
   }
   Box2D.inherit(b2PulleyJoint, Box2D.Dynamics.Joints.b2Joint);
   b2PulleyJoint.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype;
   b2PulleyJoint.b2PulleyJoint = function () {
      Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments);
      this.m_groundAnchor1 = new b2Vec2();
      this.m_groundAnchor2 = new b2Vec2();
      this.m_localAnchor1 = new b2Vec2();
      this.m_localAnchor2 = new b2Vec2();
      this.m_u1 = new b2Vec2();
      this.m_u2 = new b2Vec2();
   };
   b2PulleyJoint.prototype.GetAnchorA = function () {
      return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
   }
   b2PulleyJoint.prototype.GetAnchorB = function () {
      return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
   }
   b2PulleyJoint.prototype.GetReactionForce = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return new b2Vec2(inv_dt * this.m_impulse * this.m_u2.x, inv_dt * this.m_impulse * this.m_u2.y);
   }
   b2PulleyJoint.prototype.GetReactionTorque = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return 0.0;
   }
   b2PulleyJoint.prototype.GetGroundAnchorA = function () {
      var a = this.m_ground.m_xf.position.Copy();
      a.Add(this.m_groundAnchor1);
      return a;
   }
   b2PulleyJoint.prototype.GetGroundAnchorB = function () {
      var a = this.m_ground.m_xf.position.Copy();
      a.Add(this.m_groundAnchor2);
      return a;
   }
   b2PulleyJoint.prototype.GetLength1 = function () {
      var p = this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
      var sX = this.m_ground.m_xf.position.x + this.m_groundAnchor1.x;
      var sY = this.m_ground.m_xf.position.y + this.m_groundAnchor1.y;
      var dX = p.x - sX;
      var dY = p.y - sY;
      return Math.sqrt(dX * dX + dY * dY);
   }
   b2PulleyJoint.prototype.GetLength2 = function () {
      var p = this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
      var sX = this.m_ground.m_xf.position.x + this.m_groundAnchor2.x;
      var sY = this.m_ground.m_xf.position.y + this.m_groundAnchor2.y;
      var dX = p.x - sX;
      var dY = p.y - sY;
      return Math.sqrt(dX * dX + dY * dY);
   }
   b2PulleyJoint.prototype.GetRatio = function () {
      return this.m_ratio;
   }
   b2PulleyJoint.prototype.b2PulleyJoint = function (def) {
      this.__super.b2Joint.call(this, def);
      var tMat;
      var tX = 0;
      var tY = 0;
      this.m_ground = this.m_bodyA.m_world.m_groundBody;
      this.m_groundAnchor1.x = def.groundAnchorA.x - this.m_ground.m_xf.position.x;
      this.m_groundAnchor1.y = def.groundAnchorA.y - this.m_ground.m_xf.position.y;
      this.m_groundAnchor2.x = def.groundAnchorB.x - this.m_ground.m_xf.position.x;
      this.m_groundAnchor2.y = def.groundAnchorB.y - this.m_ground.m_xf.position.y;
      this.m_localAnchor1.SetV(def.localAnchorA);
      this.m_localAnchor2.SetV(def.localAnchorB);
      this.m_ratio = def.ratio;
      this.m_constant = def.lengthA + this.m_ratio * def.lengthB;
      this.m_maxLength1 = b2Math.Min(def.maxLengthA, this.m_constant - this.m_ratio * b2PulleyJoint.b2_minPulleyLength);
      this.m_maxLength2 = b2Math.Min(def.maxLengthB, (this.m_constant - b2PulleyJoint.b2_minPulleyLength) / this.m_ratio);
      this.m_impulse = 0.0;
      this.m_limitImpulse1 = 0.0;
      this.m_limitImpulse2 = 0.0;
   }
   b2PulleyJoint.prototype.InitVelocityConstraints = function (step) {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var tMat;
      tMat = bA.m_xf.R;
      var r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
      var r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
      var tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
      r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
      r1X = tX;
      tMat = bB.m_xf.R;
      var r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
      var r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
      r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
      r2X = tX;
      var p1X = bA.m_sweep.c.x + r1X;
      var p1Y = bA.m_sweep.c.y + r1Y;
      var p2X = bB.m_sweep.c.x + r2X;
      var p2Y = bB.m_sweep.c.y + r2Y;
      var s1X = this.m_ground.m_xf.position.x + this.m_groundAnchor1.x;
      var s1Y = this.m_ground.m_xf.position.y + this.m_groundAnchor1.y;
      var s2X = this.m_ground.m_xf.position.x + this.m_groundAnchor2.x;
      var s2Y = this.m_ground.m_xf.position.y + this.m_groundAnchor2.y;
      this.m_u1.Set(p1X - s1X, p1Y - s1Y);
      this.m_u2.Set(p2X - s2X, p2Y - s2Y);
      var length1 = this.m_u1.Length();
      var length2 = this.m_u2.Length();
      if (length1 > b2Settings.b2_linearSlop) {
         this.m_u1.Multiply(1.0 / length1);
      }
      else {
         this.m_u1.SetZero();
      }
      if (length2 > b2Settings.b2_linearSlop) {
         this.m_u2.Multiply(1.0 / length2);
      }
      else {
         this.m_u2.SetZero();
      }
      var C = this.m_constant - length1 - this.m_ratio * length2;
      if (C > 0.0) {
         this.m_state = b2Joint.e_inactiveLimit;
         this.m_impulse = 0.0;
      }
      else {
         this.m_state = b2Joint.e_atUpperLimit;
      }
      if (length1 < this.m_maxLength1) {
         this.m_limitState1 = b2Joint.e_inactiveLimit;
         this.m_limitImpulse1 = 0.0;
      }
      else {
         this.m_limitState1 = b2Joint.e_atUpperLimit;
      }
      if (length2 < this.m_maxLength2) {
         this.m_limitState2 = b2Joint.e_inactiveLimit;
         this.m_limitImpulse2 = 0.0;
      }
      else {
         this.m_limitState2 = b2Joint.e_atUpperLimit;
      }
      var cr1u1 = r1X * this.m_u1.y - r1Y * this.m_u1.x;
      var cr2u2 = r2X * this.m_u2.y - r2Y * this.m_u2.x;
      this.m_limitMass1 = bA.m_invMass + bA.m_invI * cr1u1 * cr1u1;
      this.m_limitMass2 = bB.m_invMass + bB.m_invI * cr2u2 * cr2u2;
      this.m_pulleyMass = this.m_limitMass1 + this.m_ratio * this.m_ratio * this.m_limitMass2;
      this.m_limitMass1 = 1.0 / this.m_limitMass1;
      this.m_limitMass2 = 1.0 / this.m_limitMass2;
      this.m_pulleyMass = 1.0 / this.m_pulleyMass;
      if (step.warmStarting) {
         this.m_impulse *= step.dtRatio;
         this.m_limitImpulse1 *= step.dtRatio;
         this.m_limitImpulse2 *= step.dtRatio;
         var P1X = ((-this.m_impulse) - this.m_limitImpulse1) * this.m_u1.x;
         var P1Y = ((-this.m_impulse) - this.m_limitImpulse1) * this.m_u1.y;
         var P2X = ((-this.m_ratio * this.m_impulse) - this.m_limitImpulse2) * this.m_u2.x;
         var P2Y = ((-this.m_ratio * this.m_impulse) - this.m_limitImpulse2) * this.m_u2.y;
         bA.m_linearVelocity.x += bA.m_invMass * P1X;
         bA.m_linearVelocity.y += bA.m_invMass * P1Y;
         bA.m_angularVelocity += bA.m_invI * (r1X * P1Y - r1Y * P1X);
         bB.m_linearVelocity.x += bB.m_invMass * P2X;
         bB.m_linearVelocity.y += bB.m_invMass * P2Y;
         bB.m_angularVelocity += bB.m_invI * (r2X * P2Y - r2Y * P2X);
      }
      else {
         this.m_impulse = 0.0;
         this.m_limitImpulse1 = 0.0;
         this.m_limitImpulse2 = 0.0;
      }
   }
   b2PulleyJoint.prototype.SolveVelocityConstraints = function (step) {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var tMat;
      tMat = bA.m_xf.R;
      var r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
      var r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
      var tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
      r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
      r1X = tX;
      tMat = bB.m_xf.R;
      var r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
      var r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
      r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
      r2X = tX;
      var v1X = 0;
      var v1Y = 0;
      var v2X = 0;
      var v2Y = 0;
      var P1X = 0;
      var P1Y = 0;
      var P2X = 0;
      var P2Y = 0;
      var Cdot = 0;
      var impulse = 0;
      var oldImpulse = 0;
      if (this.m_state == b2Joint.e_atUpperLimit) {
         v1X = bA.m_linearVelocity.x + ((-bA.m_angularVelocity * r1Y));
         v1Y = bA.m_linearVelocity.y + (bA.m_angularVelocity * r1X);
         v2X = bB.m_linearVelocity.x + ((-bB.m_angularVelocity * r2Y));
         v2Y = bB.m_linearVelocity.y + (bB.m_angularVelocity * r2X);
         Cdot = (-(this.m_u1.x * v1X + this.m_u1.y * v1Y)) - this.m_ratio * (this.m_u2.x * v2X + this.m_u2.y * v2Y);
         impulse = this.m_pulleyMass * ((-Cdot));
         oldImpulse = this.m_impulse;
         this.m_impulse = b2Math.Max(0.0, this.m_impulse + impulse);
         impulse = this.m_impulse - oldImpulse;
         P1X = (-impulse * this.m_u1.x);
         P1Y = (-impulse * this.m_u1.y);
         P2X = (-this.m_ratio * impulse * this.m_u2.x);
         P2Y = (-this.m_ratio * impulse * this.m_u2.y);
         bA.m_linearVelocity.x += bA.m_invMass * P1X;
         bA.m_linearVelocity.y += bA.m_invMass * P1Y;
         bA.m_angularVelocity += bA.m_invI * (r1X * P1Y - r1Y * P1X);
         bB.m_linearVelocity.x += bB.m_invMass * P2X;
         bB.m_linearVelocity.y += bB.m_invMass * P2Y;
         bB.m_angularVelocity += bB.m_invI * (r2X * P2Y - r2Y * P2X);
      }
      if (this.m_limitState1 == b2Joint.e_atUpperLimit) {
         v1X = bA.m_linearVelocity.x + ((-bA.m_angularVelocity * r1Y));
         v1Y = bA.m_linearVelocity.y + (bA.m_angularVelocity * r1X);
         Cdot = (-(this.m_u1.x * v1X + this.m_u1.y * v1Y));
         impulse = (-this.m_limitMass1 * Cdot);
         oldImpulse = this.m_limitImpulse1;
         this.m_limitImpulse1 = b2Math.Max(0.0, this.m_limitImpulse1 + impulse);
         impulse = this.m_limitImpulse1 - oldImpulse;
         P1X = (-impulse * this.m_u1.x);
         P1Y = (-impulse * this.m_u1.y);
         bA.m_linearVelocity.x += bA.m_invMass * P1X;
         bA.m_linearVelocity.y += bA.m_invMass * P1Y;
         bA.m_angularVelocity += bA.m_invI * (r1X * P1Y - r1Y * P1X);
      }
      if (this.m_limitState2 == b2Joint.e_atUpperLimit) {
         v2X = bB.m_linearVelocity.x + ((-bB.m_angularVelocity * r2Y));
         v2Y = bB.m_linearVelocity.y + (bB.m_angularVelocity * r2X);
         Cdot = (-(this.m_u2.x * v2X + this.m_u2.y * v2Y));
         impulse = (-this.m_limitMass2 * Cdot);
         oldImpulse = this.m_limitImpulse2;
         this.m_limitImpulse2 = b2Math.Max(0.0, this.m_limitImpulse2 + impulse);
         impulse = this.m_limitImpulse2 - oldImpulse;
         P2X = (-impulse * this.m_u2.x);
         P2Y = (-impulse * this.m_u2.y);
         bB.m_linearVelocity.x += bB.m_invMass * P2X;
         bB.m_linearVelocity.y += bB.m_invMass * P2Y;
         bB.m_angularVelocity += bB.m_invI * (r2X * P2Y - r2Y * P2X);
      }
   }
   b2PulleyJoint.prototype.SolvePositionConstraints = function (baumgarte) {
      if (baumgarte === undefined) baumgarte = 0;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var tMat;
      var s1X = this.m_ground.m_xf.position.x + this.m_groundAnchor1.x;
      var s1Y = this.m_ground.m_xf.position.y + this.m_groundAnchor1.y;
      var s2X = this.m_ground.m_xf.position.x + this.m_groundAnchor2.x;
      var s2Y = this.m_ground.m_xf.position.y + this.m_groundAnchor2.y;
      var r1X = 0;
      var r1Y = 0;
      var r2X = 0;
      var r2Y = 0;
      var p1X = 0;
      var p1Y = 0;
      var p2X = 0;
      var p2Y = 0;
      var length1 = 0;
      var length2 = 0;
      var C = 0;
      var impulse = 0;
      var oldImpulse = 0;
      var oldLimitPositionImpulse = 0;
      var tX = 0;
      var linearError = 0.0;
      if (this.m_state == b2Joint.e_atUpperLimit) {
         tMat = bA.m_xf.R;
         r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
         r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
         tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
         r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
         r1X = tX;
         tMat = bB.m_xf.R;
         r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
         r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
         tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
         r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
         r2X = tX;
         p1X = bA.m_sweep.c.x + r1X;
         p1Y = bA.m_sweep.c.y + r1Y;
         p2X = bB.m_sweep.c.x + r2X;
         p2Y = bB.m_sweep.c.y + r2Y;
         this.m_u1.Set(p1X - s1X, p1Y - s1Y);
         this.m_u2.Set(p2X - s2X, p2Y - s2Y);
         length1 = this.m_u1.Length();
         length2 = this.m_u2.Length();
         if (length1 > b2Settings.b2_linearSlop) {
            this.m_u1.Multiply(1.0 / length1);
         }
         else {
            this.m_u1.SetZero();
         }
         if (length2 > b2Settings.b2_linearSlop) {
            this.m_u2.Multiply(1.0 / length2);
         }
         else {
            this.m_u2.SetZero();
         }
         C = this.m_constant - length1 - this.m_ratio * length2;
         linearError = b2Math.Max(linearError, (-C));
         C = b2Math.Clamp(C + b2Settings.b2_linearSlop, (-b2Settings.b2_maxLinearCorrection), 0.0);
         impulse = (-this.m_pulleyMass * C);
         p1X = (-impulse * this.m_u1.x);
         p1Y = (-impulse * this.m_u1.y);
         p2X = (-this.m_ratio * impulse * this.m_u2.x);
         p2Y = (-this.m_ratio * impulse * this.m_u2.y);
         bA.m_sweep.c.x += bA.m_invMass * p1X;
         bA.m_sweep.c.y += bA.m_invMass * p1Y;
         bA.m_sweep.a += bA.m_invI * (r1X * p1Y - r1Y * p1X);
         bB.m_sweep.c.x += bB.m_invMass * p2X;
         bB.m_sweep.c.y += bB.m_invMass * p2Y;
         bB.m_sweep.a += bB.m_invI * (r2X * p2Y - r2Y * p2X);
         bA.SynchronizeTransform();
         bB.SynchronizeTransform();
      }
      if (this.m_limitState1 == b2Joint.e_atUpperLimit) {
         tMat = bA.m_xf.R;
         r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
         r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
         tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
         r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
         r1X = tX;
         p1X = bA.m_sweep.c.x + r1X;
         p1Y = bA.m_sweep.c.y + r1Y;
         this.m_u1.Set(p1X - s1X, p1Y - s1Y);
         length1 = this.m_u1.Length();
         if (length1 > b2Settings.b2_linearSlop) {
            this.m_u1.x *= 1.0 / length1;
            this.m_u1.y *= 1.0 / length1;
         }
         else {
            this.m_u1.SetZero();
         }
         C = this.m_maxLength1 - length1;
         linearError = b2Math.Max(linearError, (-C));
         C = b2Math.Clamp(C + b2Settings.b2_linearSlop, (-b2Settings.b2_maxLinearCorrection), 0.0);
         impulse = (-this.m_limitMass1 * C);
         p1X = (-impulse * this.m_u1.x);
         p1Y = (-impulse * this.m_u1.y);
         bA.m_sweep.c.x += bA.m_invMass * p1X;
         bA.m_sweep.c.y += bA.m_invMass * p1Y;
         bA.m_sweep.a += bA.m_invI * (r1X * p1Y - r1Y * p1X);
         bA.SynchronizeTransform();
      }
      if (this.m_limitState2 == b2Joint.e_atUpperLimit) {
         tMat = bB.m_xf.R;
         r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
         r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
         tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
         r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
         r2X = tX;
         p2X = bB.m_sweep.c.x + r2X;
         p2Y = bB.m_sweep.c.y + r2Y;
         this.m_u2.Set(p2X - s2X, p2Y - s2Y);
         length2 = this.m_u2.Length();
         if (length2 > b2Settings.b2_linearSlop) {
            this.m_u2.x *= 1.0 / length2;
            this.m_u2.y *= 1.0 / length2;
         }
         else {
            this.m_u2.SetZero();
         }
         C = this.m_maxLength2 - length2;
         linearError = b2Math.Max(linearError, (-C));
         C = b2Math.Clamp(C + b2Settings.b2_linearSlop, (-b2Settings.b2_maxLinearCorrection), 0.0);
         impulse = (-this.m_limitMass2 * C);
         p2X = (-impulse * this.m_u2.x);
         p2Y = (-impulse * this.m_u2.y);
         bB.m_sweep.c.x += bB.m_invMass * p2X;
         bB.m_sweep.c.y += bB.m_invMass * p2Y;
         bB.m_sweep.a += bB.m_invI * (r2X * p2Y - r2Y * p2X);
         bB.SynchronizeTransform();
      }
      return linearError < b2Settings.b2_linearSlop;
   }
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength = 2.0;
   });
   Box2D.inherit(b2PulleyJointDef, Box2D.Dynamics.Joints.b2JointDef);
   b2PulleyJointDef.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype;
   b2PulleyJointDef.b2PulleyJointDef = function () {
      Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments);
      this.groundAnchorA = new b2Vec2();
      this.groundAnchorB = new b2Vec2();
      this.localAnchorA = new b2Vec2();
      this.localAnchorB = new b2Vec2();
   };
   b2PulleyJointDef.prototype.b2PulleyJointDef = function () {
      this.__super.b2JointDef.call(this);
      this.type = b2Joint.e_pulleyJoint;
      this.groundAnchorA.Set((-1.0), 1.0);
      this.groundAnchorB.Set(1.0, 1.0);
      this.localAnchorA.Set((-1.0), 0.0);
      this.localAnchorB.Set(1.0, 0.0);
      this.lengthA = 0.0;
      this.maxLengthA = 0.0;
      this.lengthB = 0.0;
      this.maxLengthB = 0.0;
      this.ratio = 1.0;
      this.collideConnected = true;
   }
   b2PulleyJointDef.prototype.Initialize = function (bA, bB, gaA, gaB, anchorA, anchorB, r) {
      if (r === undefined) r = 0;
      this.bodyA = bA;
      this.bodyB = bB;
      this.groundAnchorA.SetV(gaA);
      this.groundAnchorB.SetV(gaB);
      this.localAnchorA = this.bodyA.GetLocalPoint(anchorA);
      this.localAnchorB = this.bodyB.GetLocalPoint(anchorB);
      var d1X = anchorA.x - gaA.x;
      var d1Y = anchorA.y - gaA.y;
      this.lengthA = Math.sqrt(d1X * d1X + d1Y * d1Y);
      var d2X = anchorB.x - gaB.x;
      var d2Y = anchorB.y - gaB.y;
      this.lengthB = Math.sqrt(d2X * d2X + d2Y * d2Y);
      this.ratio = r;
      var C = this.lengthA + this.ratio * this.lengthB;
      this.maxLengthA = C - this.ratio * b2PulleyJoint.b2_minPulleyLength;
      this.maxLengthB = (C - b2PulleyJoint.b2_minPulleyLength) / this.ratio;
   }
   Box2D.inherit(b2RevoluteJoint, Box2D.Dynamics.Joints.b2Joint);
   b2RevoluteJoint.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype;
   b2RevoluteJoint.b2RevoluteJoint = function () {
      Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments);
      this.K = new b2Mat22();
      this.K1 = new b2Mat22();
      this.K2 = new b2Mat22();
      this.K3 = new b2Mat22();
      this.impulse3 = new b2Vec3();
      this.impulse2 = new b2Vec2();
      this.reduced = new b2Vec2();
      this.m_localAnchor1 = new b2Vec2();
      this.m_localAnchor2 = new b2Vec2();
      this.m_impulse = new b2Vec3();
      this.m_mass = new b2Mat33();
   };
   b2RevoluteJoint.prototype.GetAnchorA = function () {
      return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
   }
   b2RevoluteJoint.prototype.GetAnchorB = function () {
      return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
   }
   b2RevoluteJoint.prototype.GetReactionForce = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return new b2Vec2(inv_dt * this.m_impulse.x, inv_dt * this.m_impulse.y);
   }
   b2RevoluteJoint.prototype.GetReactionTorque = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return inv_dt * this.m_impulse.z;
   }
   b2RevoluteJoint.prototype.GetJointAngle = function () {
      return this.m_bodyB.m_sweep.a - this.m_bodyA.m_sweep.a - this.m_referenceAngle;
   }
   b2RevoluteJoint.prototype.GetJointSpeed = function () {
      return this.m_bodyB.m_angularVelocity - this.m_bodyA.m_angularVelocity;
   }
   b2RevoluteJoint.prototype.IsLimitEnabled = function () {
      return this.m_enableLimit;
   }
   b2RevoluteJoint.prototype.EnableLimit = function (flag) {
      this.m_enableLimit = flag;
   }
   b2RevoluteJoint.prototype.GetLowerLimit = function () {
      return this.m_lowerAngle;
   }
   b2RevoluteJoint.prototype.GetUpperLimit = function () {
      return this.m_upperAngle;
   }
   b2RevoluteJoint.prototype.SetLimits = function (lower, upper) {
      if (lower === undefined) lower = 0;
      if (upper === undefined) upper = 0;
      this.m_lowerAngle = lower;
      this.m_upperAngle = upper;
   }
   b2RevoluteJoint.prototype.IsMotorEnabled = function () {
      this.m_bodyA.SetAwake(true);
      this.m_bodyB.SetAwake(true);
      return this.m_enableMotor;
   }
   b2RevoluteJoint.prototype.EnableMotor = function (flag) {
      this.m_enableMotor = flag;
   }
   b2RevoluteJoint.prototype.SetMotorSpeed = function (speed) {
      if (speed === undefined) speed = 0;
      this.m_bodyA.SetAwake(true);
      this.m_bodyB.SetAwake(true);
      this.m_motorSpeed = speed;
   }
   b2RevoluteJoint.prototype.GetMotorSpeed = function () {
      return this.m_motorSpeed;
   }
   b2RevoluteJoint.prototype.SetMaxMotorTorque = function (torque) {
      if (torque === undefined) torque = 0;
      this.m_maxMotorTorque = torque;
   }
   b2RevoluteJoint.prototype.GetMotorTorque = function () {
      return this.m_maxMotorTorque;
   }
   b2RevoluteJoint.prototype.b2RevoluteJoint = function (def) {
      this.__super.b2Joint.call(this, def);
      this.m_localAnchor1.SetV(def.localAnchorA);
      this.m_localAnchor2.SetV(def.localAnchorB);
      this.m_referenceAngle = def.referenceAngle;
      this.m_impulse.SetZero();
      this.m_motorImpulse = 0.0;
      this.m_lowerAngle = def.lowerAngle;
      this.m_upperAngle = def.upperAngle;
      this.m_maxMotorTorque = def.maxMotorTorque;
      this.m_motorSpeed = def.motorSpeed;
      this.m_enableLimit = def.enableLimit;
      this.m_enableMotor = def.enableMotor;
      this.m_limitState = b2Joint.e_inactiveLimit;
   }
   b2RevoluteJoint.prototype.InitVelocityConstraints = function (step) {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var tMat;
      var tX = 0;
      if (this.m_enableMotor || this.m_enableLimit) {}
      tMat = bA.m_xf.R;
      var r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
      var r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
      tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
      r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
      r1X = tX;
      tMat = bB.m_xf.R;
      var r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
      var r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
      r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
      r2X = tX;
      var m1 = bA.m_invMass;
      var m2 = bB.m_invMass;
      var i1 = bA.m_invI;
      var i2 = bB.m_invI;
      this.m_mass.col1.x = m1 + m2 + r1Y * r1Y * i1 + r2Y * r2Y * i2;
      this.m_mass.col2.x = (-r1Y * r1X * i1) - r2Y * r2X * i2;
      this.m_mass.col3.x = (-r1Y * i1) - r2Y * i2;
      this.m_mass.col1.y = this.m_mass.col2.x;
      this.m_mass.col2.y = m1 + m2 + r1X * r1X * i1 + r2X * r2X * i2;
      this.m_mass.col3.y = r1X * i1 + r2X * i2;
      this.m_mass.col1.z = this.m_mass.col3.x;
      this.m_mass.col2.z = this.m_mass.col3.y;
      this.m_mass.col3.z = i1 + i2;
      this.m_motorMass = 1.0 / (i1 + i2);
      if (this.m_enableMotor == false) {
         this.m_motorImpulse = 0.0;
      }
      if (this.m_enableLimit) {
         var jointAngle = bB.m_sweep.a - bA.m_sweep.a - this.m_referenceAngle;
         if (b2Math.Abs(this.m_upperAngle - this.m_lowerAngle) < 2.0 * b2Settings.b2_angularSlop) {
            this.m_limitState = b2Joint.e_equalLimits;
         }
         else if (jointAngle <= this.m_lowerAngle) {
            if (this.m_limitState != b2Joint.e_atLowerLimit) {
               this.m_impulse.z = 0.0;
            }
            this.m_limitState = b2Joint.e_atLowerLimit;
         }
         else if (jointAngle >= this.m_upperAngle) {
            if (this.m_limitState != b2Joint.e_atUpperLimit) {
               this.m_impulse.z = 0.0;
            }
            this.m_limitState = b2Joint.e_atUpperLimit;
         }
         else {
            this.m_limitState = b2Joint.e_inactiveLimit;
            this.m_impulse.z = 0.0;
         }
      }
      else {
         this.m_limitState = b2Joint.e_inactiveLimit;
      }
      if (step.warmStarting) {
         this.m_impulse.x *= step.dtRatio;
         this.m_impulse.y *= step.dtRatio;
         this.m_motorImpulse *= step.dtRatio;
         var PX = this.m_impulse.x;
         var PY = this.m_impulse.y;
         bA.m_linearVelocity.x -= m1 * PX;
         bA.m_linearVelocity.y -= m1 * PY;
         bA.m_angularVelocity -= i1 * ((r1X * PY - r1Y * PX) + this.m_motorImpulse + this.m_impulse.z);
         bB.m_linearVelocity.x += m2 * PX;
         bB.m_linearVelocity.y += m2 * PY;
         bB.m_angularVelocity += i2 * ((r2X * PY - r2Y * PX) + this.m_motorImpulse + this.m_impulse.z);
      }
      else {
         this.m_impulse.SetZero();
         this.m_motorImpulse = 0.0;
      }
   }
   b2RevoluteJoint.prototype.SolveVelocityConstraints = function (step) {
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var tMat;
      var tX = 0;
      var newImpulse = 0;
      var r1X = 0;
      var r1Y = 0;
      var r2X = 0;
      var r2Y = 0;
      var v1 = bA.m_linearVelocity;
      var w1 = bA.m_angularVelocity;
      var v2 = bB.m_linearVelocity;
      var w2 = bB.m_angularVelocity;
      var m1 = bA.m_invMass;
      var m2 = bB.m_invMass;
      var i1 = bA.m_invI;
      var i2 = bB.m_invI;
      if (this.m_enableMotor && this.m_limitState != b2Joint.e_equalLimits) {
         var Cdot = w2 - w1 - this.m_motorSpeed;
         var impulse = this.m_motorMass * ((-Cdot));
         var oldImpulse = this.m_motorImpulse;
         var maxImpulse = step.dt * this.m_maxMotorTorque;
         this.m_motorImpulse = b2Math.Clamp(this.m_motorImpulse + impulse, (-maxImpulse), maxImpulse);
         impulse = this.m_motorImpulse - oldImpulse;
         w1 -= i1 * impulse;
         w2 += i2 * impulse;
      }
      if (this.m_enableLimit && this.m_limitState != b2Joint.e_inactiveLimit) {
         tMat = bA.m_xf.R;
         r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
         r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
         tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
         r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
         r1X = tX;
         tMat = bB.m_xf.R;
         r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
         r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
         tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
         r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
         r2X = tX;
         var Cdot1X = v2.x + ((-w2 * r2Y)) - v1.x - ((-w1 * r1Y));
         var Cdot1Y = v2.y + (w2 * r2X) - v1.y - (w1 * r1X);
         var Cdot2 = w2 - w1;
         this.m_mass.Solve33(this.impulse3, (-Cdot1X), (-Cdot1Y), (-Cdot2));
         if (this.m_limitState == b2Joint.e_equalLimits) {
            this.m_impulse.Add(this.impulse3);
         }
         else if (this.m_limitState == b2Joint.e_atLowerLimit) {
            newImpulse = this.m_impulse.z + this.impulse3.z;
            if (newImpulse < 0.0) {
               this.m_mass.Solve22(this.reduced, (-Cdot1X), (-Cdot1Y));
               this.impulse3.x = this.reduced.x;
               this.impulse3.y = this.reduced.y;
               this.impulse3.z = (-this.m_impulse.z);
               this.m_impulse.x += this.reduced.x;
               this.m_impulse.y += this.reduced.y;
               this.m_impulse.z = 0.0;
            }
         }
         else if (this.m_limitState == b2Joint.e_atUpperLimit) {
            newImpulse = this.m_impulse.z + this.impulse3.z;
            if (newImpulse > 0.0) {
               this.m_mass.Solve22(this.reduced, (-Cdot1X), (-Cdot1Y));
               this.impulse3.x = this.reduced.x;
               this.impulse3.y = this.reduced.y;
               this.impulse3.z = (-this.m_impulse.z);
               this.m_impulse.x += this.reduced.x;
               this.m_impulse.y += this.reduced.y;
               this.m_impulse.z = 0.0;
            }
         }
         v1.x -= m1 * this.impulse3.x;
         v1.y -= m1 * this.impulse3.y;
         w1 -= i1 * (r1X * this.impulse3.y - r1Y * this.impulse3.x + this.impulse3.z);
         v2.x += m2 * this.impulse3.x;
         v2.y += m2 * this.impulse3.y;
         w2 += i2 * (r2X * this.impulse3.y - r2Y * this.impulse3.x + this.impulse3.z);
      }
      else {
         tMat = bA.m_xf.R;
         r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
         r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
         tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
         r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
         r1X = tX;
         tMat = bB.m_xf.R;
         r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
         r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
         tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
         r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
         r2X = tX;
         var CdotX = v2.x + ((-w2 * r2Y)) - v1.x - ((-w1 * r1Y));
         var CdotY = v2.y + (w2 * r2X) - v1.y - (w1 * r1X);
         this.m_mass.Solve22(this.impulse2, (-CdotX), (-CdotY));
         this.m_impulse.x += this.impulse2.x;
         this.m_impulse.y += this.impulse2.y;
         v1.x -= m1 * this.impulse2.x;
         v1.y -= m1 * this.impulse2.y;
         w1 -= i1 * (r1X * this.impulse2.y - r1Y * this.impulse2.x);
         v2.x += m2 * this.impulse2.x;
         v2.y += m2 * this.impulse2.y;
         w2 += i2 * (r2X * this.impulse2.y - r2Y * this.impulse2.x);
      }
      bA.m_linearVelocity.SetV(v1);
      bA.m_angularVelocity = w1;
      bB.m_linearVelocity.SetV(v2);
      bB.m_angularVelocity = w2;
   }
   b2RevoluteJoint.prototype.SolvePositionConstraints = function (baumgarte) {
      if (baumgarte === undefined) baumgarte = 0;
      var oldLimitImpulse = 0;
      var C = 0;
      var tMat;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var angularError = 0.0;
      var positionError = 0.0;
      var tX = 0;
      var impulseX = 0;
      var impulseY = 0;
      if (this.m_enableLimit && this.m_limitState != b2Joint.e_inactiveLimit) {
         var angle = bB.m_sweep.a - bA.m_sweep.a - this.m_referenceAngle;
         var limitImpulse = 0.0;
         if (this.m_limitState == b2Joint.e_equalLimits) {
            C = b2Math.Clamp(angle - this.m_lowerAngle, (-b2Settings.b2_maxAngularCorrection), b2Settings.b2_maxAngularCorrection);
            limitImpulse = (-this.m_motorMass * C);
            angularError = b2Math.Abs(C);
         }
         else if (this.m_limitState == b2Joint.e_atLowerLimit) {
            C = angle - this.m_lowerAngle;
            angularError = (-C);
            C = b2Math.Clamp(C + b2Settings.b2_angularSlop, (-b2Settings.b2_maxAngularCorrection), 0.0);
            limitImpulse = (-this.m_motorMass * C);
         }
         else if (this.m_limitState == b2Joint.e_atUpperLimit) {
            C = angle - this.m_upperAngle;
            angularError = C;
            C = b2Math.Clamp(C - b2Settings.b2_angularSlop, 0.0, b2Settings.b2_maxAngularCorrection);
            limitImpulse = (-this.m_motorMass * C);
         }
         bA.m_sweep.a -= bA.m_invI * limitImpulse;
         bB.m_sweep.a += bB.m_invI * limitImpulse;
         bA.SynchronizeTransform();
         bB.SynchronizeTransform();
      } {
         tMat = bA.m_xf.R;
         var r1X = this.m_localAnchor1.x - bA.m_sweep.localCenter.x;
         var r1Y = this.m_localAnchor1.y - bA.m_sweep.localCenter.y;
         tX = (tMat.col1.x * r1X + tMat.col2.x * r1Y);
         r1Y = (tMat.col1.y * r1X + tMat.col2.y * r1Y);
         r1X = tX;
         tMat = bB.m_xf.R;
         var r2X = this.m_localAnchor2.x - bB.m_sweep.localCenter.x;
         var r2Y = this.m_localAnchor2.y - bB.m_sweep.localCenter.y;
         tX = (tMat.col1.x * r2X + tMat.col2.x * r2Y);
         r2Y = (tMat.col1.y * r2X + tMat.col2.y * r2Y);
         r2X = tX;
         var CX = bB.m_sweep.c.x + r2X - bA.m_sweep.c.x - r1X;
         var CY = bB.m_sweep.c.y + r2Y - bA.m_sweep.c.y - r1Y;
         var CLengthSquared = CX * CX + CY * CY;
         var CLength = Math.sqrt(CLengthSquared);
         positionError = CLength;
         var invMass1 = bA.m_invMass;
         var invMass2 = bB.m_invMass;
         var invI1 = bA.m_invI;
         var invI2 = bB.m_invI;
         var k_allowedStretch = 10.0 * b2Settings.b2_linearSlop;
         if (CLengthSquared > k_allowedStretch * k_allowedStretch) {
            var uX = CX / CLength;
            var uY = CY / CLength;
            var k = invMass1 + invMass2;
            var m = 1.0 / k;
            impulseX = m * ((-CX));
            impulseY = m * ((-CY));
            var k_beta = 0.5;
            bA.m_sweep.c.x -= k_beta * invMass1 * impulseX;
            bA.m_sweep.c.y -= k_beta * invMass1 * impulseY;
            bB.m_sweep.c.x += k_beta * invMass2 * impulseX;
            bB.m_sweep.c.y += k_beta * invMass2 * impulseY;
            CX = bB.m_sweep.c.x + r2X - bA.m_sweep.c.x - r1X;
            CY = bB.m_sweep.c.y + r2Y - bA.m_sweep.c.y - r1Y;
         }
         this.K1.col1.x = invMass1 + invMass2;
         this.K1.col2.x = 0.0;
         this.K1.col1.y = 0.0;
         this.K1.col2.y = invMass1 + invMass2;
         this.K2.col1.x = invI1 * r1Y * r1Y;
         this.K2.col2.x = (-invI1 * r1X * r1Y);
         this.K2.col1.y = (-invI1 * r1X * r1Y);
         this.K2.col2.y = invI1 * r1X * r1X;
         this.K3.col1.x = invI2 * r2Y * r2Y;
         this.K3.col2.x = (-invI2 * r2X * r2Y);
         this.K3.col1.y = (-invI2 * r2X * r2Y);
         this.K3.col2.y = invI2 * r2X * r2X;
         this.K.SetM(this.K1);
         this.K.AddM(this.K2);
         this.K.AddM(this.K3);
         this.K.Solve(b2RevoluteJoint.tImpulse, (-CX), (-CY));
         impulseX = b2RevoluteJoint.tImpulse.x;
         impulseY = b2RevoluteJoint.tImpulse.y;
         bA.m_sweep.c.x -= bA.m_invMass * impulseX;
         bA.m_sweep.c.y -= bA.m_invMass * impulseY;
         bA.m_sweep.a -= bA.m_invI * (r1X * impulseY - r1Y * impulseX);
         bB.m_sweep.c.x += bB.m_invMass * impulseX;
         bB.m_sweep.c.y += bB.m_invMass * impulseY;
         bB.m_sweep.a += bB.m_invI * (r2X * impulseY - r2Y * impulseX);
         bA.SynchronizeTransform();
         bB.SynchronizeTransform();
      }
      return positionError <= b2Settings.b2_linearSlop && angularError <= b2Settings.b2_angularSlop;
   }
   Box2D.postDefs.push(function () {
      Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse = new b2Vec2();
   });
   Box2D.inherit(b2RevoluteJointDef, Box2D.Dynamics.Joints.b2JointDef);
   b2RevoluteJointDef.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype;
   b2RevoluteJointDef.b2RevoluteJointDef = function () {
      Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments);
      this.localAnchorA = new b2Vec2();
      this.localAnchorB = new b2Vec2();
   };
   b2RevoluteJointDef.prototype.b2RevoluteJointDef = function () {
      this.__super.b2JointDef.call(this);
      this.type = b2Joint.e_revoluteJoint;
      this.localAnchorA.Set(0.0, 0.0);
      this.localAnchorB.Set(0.0, 0.0);
      this.referenceAngle = 0.0;
      this.lowerAngle = 0.0;
      this.upperAngle = 0.0;
      this.maxMotorTorque = 0.0;
      this.motorSpeed = 0.0;
      this.enableLimit = false;
      this.enableMotor = false;
   }
   b2RevoluteJointDef.prototype.Initialize = function (bA, bB, anchor) {
      this.bodyA = bA;
      this.bodyB = bB;
      this.localAnchorA = this.bodyA.GetLocalPoint(anchor);
      this.localAnchorB = this.bodyB.GetLocalPoint(anchor);
      this.referenceAngle = this.bodyB.GetAngle() - this.bodyA.GetAngle();
   }
   Box2D.inherit(b2WeldJoint, Box2D.Dynamics.Joints.b2Joint);
   b2WeldJoint.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype;
   b2WeldJoint.b2WeldJoint = function () {
      Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments);
      this.m_localAnchorA = new b2Vec2();
      this.m_localAnchorB = new b2Vec2();
      this.m_impulse = new b2Vec3();
      this.m_mass = new b2Mat33();
   };
   b2WeldJoint.prototype.GetAnchorA = function () {
      return this.m_bodyA.GetWorldPoint(this.m_localAnchorA);
   }
   b2WeldJoint.prototype.GetAnchorB = function () {
      return this.m_bodyB.GetWorldPoint(this.m_localAnchorB);
   }
   b2WeldJoint.prototype.GetReactionForce = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return new b2Vec2(inv_dt * this.m_impulse.x, inv_dt * this.m_impulse.y);
   }
   b2WeldJoint.prototype.GetReactionTorque = function (inv_dt) {
      if (inv_dt === undefined) inv_dt = 0;
      return inv_dt * this.m_impulse.z;
   }
   b2WeldJoint.prototype.b2WeldJoint = function (def) {
      this.__super.b2Joint.call(this, def);
      this.m_localAnchorA.SetV(def.localAnchorA);
      this.m_localAnchorB.SetV(def.localAnchorB);
      this.m_referenceAngle = def.referenceAngle;
      this.m_impulse.SetZero();
      this.m_mass = new b2Mat33();
   }
   b2WeldJoint.prototype.InitVelocityConstraints = function (step) {
      var tMat;
      var tX = 0;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      tMat = bA.m_xf.R;
      var rAX = this.m_localAnchorA.x - bA.m_sweep.localCenter.x;
      var rAY = this.m_localAnchorA.y - bA.m_sweep.localCenter.y;
      tX = (tMat.col1.x * rAX + tMat.col2.x * rAY);
      rAY = (tMat.col1.y * rAX + tMat.col2.y * rAY);
      rAX = tX;
      tMat = bB.m_xf.R;
      var rBX = this.m_localAnchorB.x - bB.m_sweep.localCenter.x;
      var rBY = this.m_localAnchorB.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * rBX + tMat.col2.x * rBY);
      rBY = (tMat.col1.y * rBX + tMat.col2.y * rBY);
      rBX = tX;
      var mA = bA.m_invMass;
      var mB = bB.m_invMass;
      var iA = bA.m_invI;
      var iB = bB.m_invI;
      this.m_mass.col1.x = mA + mB + rAY * rAY * iA + rBY * rBY * iB;
      this.m_mass.col2.x = (-rAY * rAX * iA) - rBY * rBX * iB;
      this.m_mass.col3.x = (-rAY * iA) - rBY * iB;
      this.m_mass.col1.y = this.m_mass.col2.x;
      this.m_mass.col2.y = mA + mB + rAX * rAX * iA + rBX * rBX * iB;
      this.m_mass.col3.y = rAX * iA + rBX * iB;
      this.m_mass.col1.z = this.m_mass.col3.x;
      this.m_mass.col2.z = this.m_mass.col3.y;
      this.m_mass.col3.z = iA + iB;
      if (step.warmStarting) {
         this.m_impulse.x *= step.dtRatio;
         this.m_impulse.y *= step.dtRatio;
         this.m_impulse.z *= step.dtRatio;
         bA.m_linearVelocity.x -= mA * this.m_impulse.x;
         bA.m_linearVelocity.y -= mA * this.m_impulse.y;
         bA.m_angularVelocity -= iA * (rAX * this.m_impulse.y - rAY * this.m_impulse.x + this.m_impulse.z);
         bB.m_linearVelocity.x += mB * this.m_impulse.x;
         bB.m_linearVelocity.y += mB * this.m_impulse.y;
         bB.m_angularVelocity += iB * (rBX * this.m_impulse.y - rBY * this.m_impulse.x + this.m_impulse.z);
      }
      else {
         this.m_impulse.SetZero();
      }
   }
   b2WeldJoint.prototype.SolveVelocityConstraints = function (step) {
      var tMat;
      var tX = 0;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      var vA = bA.m_linearVelocity;
      var wA = bA.m_angularVelocity;
      var vB = bB.m_linearVelocity;
      var wB = bB.m_angularVelocity;
      var mA = bA.m_invMass;
      var mB = bB.m_invMass;
      var iA = bA.m_invI;
      var iB = bB.m_invI;
      tMat = bA.m_xf.R;
      var rAX = this.m_localAnchorA.x - bA.m_sweep.localCenter.x;
      var rAY = this.m_localAnchorA.y - bA.m_sweep.localCenter.y;
      tX = (tMat.col1.x * rAX + tMat.col2.x * rAY);
      rAY = (tMat.col1.y * rAX + tMat.col2.y * rAY);
      rAX = tX;
      tMat = bB.m_xf.R;
      var rBX = this.m_localAnchorB.x - bB.m_sweep.localCenter.x;
      var rBY = this.m_localAnchorB.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * rBX + tMat.col2.x * rBY);
      rBY = (tMat.col1.y * rBX + tMat.col2.y * rBY);
      rBX = tX;
      var Cdot1X = vB.x - wB * rBY - vA.x + wA * rAY;
      var Cdot1Y = vB.y + wB * rBX - vA.y - wA * rAX;
      var Cdot2 = wB - wA;
      var impulse = new b2Vec3();
      this.m_mass.Solve33(impulse, (-Cdot1X), (-Cdot1Y), (-Cdot2));
      this.m_impulse.Add(impulse);
      vA.x -= mA * impulse.x;
      vA.y -= mA * impulse.y;
      wA -= iA * (rAX * impulse.y - rAY * impulse.x + impulse.z);
      vB.x += mB * impulse.x;
      vB.y += mB * impulse.y;
      wB += iB * (rBX * impulse.y - rBY * impulse.x + impulse.z);
      bA.m_angularVelocity = wA;
      bB.m_angularVelocity = wB;
   }
   b2WeldJoint.prototype.SolvePositionConstraints = function (baumgarte) {
      if (baumgarte === undefined) baumgarte = 0;
      var tMat;
      var tX = 0;
      var bA = this.m_bodyA;
      var bB = this.m_bodyB;
      tMat = bA.m_xf.R;
      var rAX = this.m_localAnchorA.x - bA.m_sweep.localCenter.x;
      var rAY = this.m_localAnchorA.y - bA.m_sweep.localCenter.y;
      tX = (tMat.col1.x * rAX + tMat.col2.x * rAY);
      rAY = (tMat.col1.y * rAX + tMat.col2.y * rAY);
      rAX = tX;
      tMat = bB.m_xf.R;
      var rBX = this.m_localAnchorB.x - bB.m_sweep.localCenter.x;
      var rBY = this.m_localAnchorB.y - bB.m_sweep.localCenter.y;
      tX = (tMat.col1.x * rBX + tMat.col2.x * rBY);
      rBY = (tMat.col1.y * rBX + tMat.col2.y * rBY);
      rBX = tX;
      var mA = bA.m_invMass;
      var mB = bB.m_invMass;
      var iA = bA.m_invI;
      var iB = bB.m_invI;
      var C1X = bB.m_sweep.c.x + rBX - bA.m_sweep.c.x - rAX;
      var C1Y = bB.m_sweep.c.y + rBY - bA.m_sweep.c.y - rAY;
      var C2 = bB.m_sweep.a - bA.m_sweep.a - this.m_referenceAngle;
      var k_allowedStretch = 10.0 * b2Settings.b2_linearSlop;
      var positionError = Math.sqrt(C1X * C1X + C1Y * C1Y);
      var angularError = b2Math.Abs(C2);
      if (positionError > k_allowedStretch) {
         iA *= 1.0;
         iB *= 1.0;
      }
      this.m_mass.col1.x = mA + mB + rAY * rAY * iA + rBY * rBY * iB;
      this.m_mass.col2.x = (-rAY * rAX * iA) - rBY * rBX * iB;
      this.m_mass.col3.x = (-rAY * iA) - rBY * iB;
      this.m_mass.col1.y = this.m_mass.col2.x;
      this.m_mass.col2.y = mA + mB + rAX * rAX * iA + rBX * rBX * iB;
      this.m_mass.col3.y = rAX * iA + rBX * iB;
      this.m_mass.col1.z = this.m_mass.col3.x;
      this.m_mass.col2.z = this.m_mass.col3.y;
      this.m_mass.col3.z = iA + iB;
      var impulse = new b2Vec3();
      this.m_mass.Solve33(impulse, (-C1X), (-C1Y), (-C2));
      bA.m_sweep.c.x -= mA * impulse.x;
      bA.m_sweep.c.y -= mA * impulse.y;
      bA.m_sweep.a -= iA * (rAX * impulse.y - rAY * impulse.x + impulse.z);
      bB.m_sweep.c.x += mB * impulse.x;
      bB.m_sweep.c.y += mB * impulse.y;
      bB.m_sweep.a += iB * (rBX * impulse.y - rBY * impulse.x + impulse.z);
      bA.SynchronizeTransform();
      bB.SynchronizeTransform();
      return positionError <= b2Settings.b2_linearSlop && angularError <= b2Settings.b2_angularSlop;
   }
   Box2D.inherit(b2WeldJointDef, Box2D.Dynamics.Joints.b2JointDef);
   b2WeldJointDef.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype;
   b2WeldJointDef.b2WeldJointDef = function () {
      Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments);
      this.localAnchorA = new b2Vec2();
      this.localAnchorB = new b2Vec2();
   };
   b2WeldJointDef.prototype.b2WeldJointDef = function () {
      this.__super.b2JointDef.call(this);
      this.type = b2Joint.e_weldJoint;
      this.referenceAngle = 0.0;
   }
   b2WeldJointDef.prototype.Initialize = function (bA, bB, anchor) {
      this.bodyA = bA;
      this.bodyB = bB;
      this.localAnchorA.SetV(this.bodyA.GetLocalPoint(anchor));
      this.localAnchorB.SetV(this.bodyB.GetLocalPoint(anchor));
      this.referenceAngle = this.bodyB.GetAngle() - this.bodyA.GetAngle();
   }
})();
(function () {
   var b2DebugDraw = Box2D.Dynamics.b2DebugDraw;
   b2DebugDraw.b2DebugDraw = function () {
      this.m_drawScale = 1.0;
      this.m_lineThickness = 1.0;
      this.m_alpha = 1.0;
      this.m_fillAlpha = 1.0;
      this.m_xformScale = 1.0;
      var __this = this;
      //#WORKAROUND
      this.m_sprite = {
         graphics: {
            clear: function () {
               __this.m_ctx.clearRect(0, 0, __this.m_ctx.canvas.width, __this.m_ctx.canvas.height)
            }
         }
      };
   };
   b2DebugDraw.prototype._color = function (color, alpha) {
      return "rgba(" + ((color & 0xFF0000) >> 16) + "," + ((color & 0xFF00) >> 8) + "," + (color & 0xFF) + "," + alpha + ")";
   };
   b2DebugDraw.prototype.b2DebugDraw = function () {
      this.m_drawFlags = 0;
   };
   b2DebugDraw.prototype.SetFlags = function (flags) {
      if (flags === undefined) flags = 0;
      this.m_drawFlags = flags;
   };
   b2DebugDraw.prototype.GetFlags = function () {
      return this.m_drawFlags;
   };
   b2DebugDraw.prototype.AppendFlags = function (flags) {
      if (flags === undefined) flags = 0;
      this.m_drawFlags |= flags;
   };
   b2DebugDraw.prototype.ClearFlags = function (flags) {
      if (flags === undefined) flags = 0;
      this.m_drawFlags &= ~flags;
   };
   b2DebugDraw.prototype.SetSprite = function (sprite) {
      this.m_ctx = sprite;
   };
   b2DebugDraw.prototype.GetSprite = function () {
      return this.m_ctx;
   };
   b2DebugDraw.prototype.SetDrawScale = function (drawScale) {
      if (drawScale === undefined) drawScale = 0;
      this.m_drawScale = drawScale;
   };
   b2DebugDraw.prototype.GetDrawScale = function () {
      return this.m_drawScale;
   };
   b2DebugDraw.prototype.SetLineThickness = function (lineThickness) {
      if (lineThickness === undefined) lineThickness = 0;
      this.m_lineThickness = lineThickness;
      this.m_ctx.strokeWidth = lineThickness;
   };
   b2DebugDraw.prototype.GetLineThickness = function () {
      return this.m_lineThickness;
   };
   b2DebugDraw.prototype.SetAlpha = function (alpha) {
      if (alpha === undefined) alpha = 0;
      this.m_alpha = alpha;
   };
   b2DebugDraw.prototype.GetAlpha = function () {
      return this.m_alpha;
   };
   b2DebugDraw.prototype.SetFillAlpha = function (alpha) {
      if (alpha === undefined) alpha = 0;
      this.m_fillAlpha = alpha;
   };
   b2DebugDraw.prototype.GetFillAlpha = function () {
      return this.m_fillAlpha;
   };
   b2DebugDraw.prototype.SetXFormScale = function (xformScale) {
      if (xformScale === undefined) xformScale = 0;
      this.m_xformScale = xformScale;
   };
   b2DebugDraw.prototype.GetXFormScale = function () {
      return this.m_xformScale;
   };
   b2DebugDraw.prototype.DrawPolygon = function (vertices, vertexCount, color) {
      if (!vertexCount) return;
      var s = this.m_ctx;
      var drawScale = this.m_drawScale;
      s.beginPath();
      s.strokeStyle = this._color(color.color, this.m_alpha);
      s.moveTo(vertices[0].x * drawScale, vertices[0].y * drawScale);
      for (var i = 1; i < vertexCount; i++) {
         s.lineTo(vertices[i].x * drawScale, vertices[i].y * drawScale);
      }
      s.lineTo(vertices[0].x * drawScale, vertices[0].y * drawScale);
      s.closePath();
      s.stroke();
   };
   b2DebugDraw.prototype.DrawSolidPolygon = function (vertices, vertexCount, color) {
      if (!vertexCount) return;
      var s = this.m_ctx;
      var drawScale = this.m_drawScale;
      s.beginPath();
      s.strokeStyle = this._color(color.color, this.m_alpha);
      s.fillStyle = this._color(color.color, this.m_fillAlpha);
      s.moveTo(vertices[0].x * drawScale, vertices[0].y * drawScale);
      for (var i = 1; i < vertexCount; i++) {
         s.lineTo(vertices[i].x * drawScale, vertices[i].y * drawScale);
      }
      s.lineTo(vertices[0].x * drawScale, vertices[0].y * drawScale);
      s.closePath();
      s.fill();
      s.stroke();
   };
   b2DebugDraw.prototype.DrawCircle = function (center, radius, color) {
      if (!radius) return;
      var s = this.m_ctx;
      var drawScale = this.m_drawScale;
      s.beginPath();
      s.strokeStyle = this._color(color.color, this.m_alpha);
      s.arc(center.x * drawScale, center.y * drawScale, radius * drawScale, 0, Math.PI * 2, true);
      s.closePath();
      s.stroke();
   };
   b2DebugDraw.prototype.DrawSolidCircle = function (center, radius, axis, color) {
      if (!radius) return;
      var s = this.m_ctx,
         drawScale = this.m_drawScale,
         cx = center.x * drawScale,
         cy = center.y * drawScale;
      s.moveTo(0, 0);
      s.beginPath();
      s.strokeStyle = this._color(color.color, this.m_alpha);
      s.fillStyle = this._color(color.color, this.m_fillAlpha);
      s.arc(cx, cy, radius * drawScale, 0, Math.PI * 2, true);
      s.moveTo(cx, cy);
      s.lineTo((center.x + axis.x * radius) * drawScale, (center.y + axis.y * radius) * drawScale);
      s.closePath();
      s.fill();
      s.stroke();
   };
   b2DebugDraw.prototype.DrawSegment = function (p1, p2, color) {
      var s = this.m_ctx,
         drawScale = this.m_drawScale;
      s.strokeStyle = this._color(color.color, this.m_alpha);
      s.beginPath();
      s.moveTo(p1.x * drawScale, p1.y * drawScale);
      s.lineTo(p2.x * drawScale, p2.y * drawScale);
      s.closePath();
      s.stroke();
   };
   b2DebugDraw.prototype.DrawTransform = function (xf) {
      var s = this.m_ctx,
         drawScale = this.m_drawScale;
      s.beginPath();
      s.strokeStyle = this._color(0xff0000, this.m_alpha);
      s.moveTo(xf.position.x * drawScale, xf.position.y * drawScale);
      s.lineTo((xf.position.x + this.m_xformScale * xf.R.col1.x) * drawScale, (xf.position.y + this.m_xformScale * xf.R.col1.y) * drawScale);

      s.strokeStyle = this._color(0xff00, this.m_alpha);
      s.moveTo(xf.position.x * drawScale, xf.position.y * drawScale);
      s.lineTo((xf.position.x + this.m_xformScale * xf.R.col2.x) * drawScale, (xf.position.y + this.m_xformScale * xf.R.col2.y) * drawScale);
      s.closePath();
      s.stroke();
   };
})();
var i;
for (i = 0; i < Box2D.postDefs.length; ++i) Box2D.postDefs[i]();

module.exports = Box2D
},{}],"/Volumes/spaaaaaace/git/ld32/src/javascript/character.js":[function(require,module,exports){
Q.Sprite.extend("Character", {
  init: function(p) {
    this._super(p, {
      sheet: p.character,
      sprite: p.character,
      isControlled: false,
      direction: "right",
      points: [[-40, -40], [40, -40], [40, 150], [-40, 150]],
      type: Q.SPRITE_NPC,
      collisionMask: Q.SPRITE_DEFAULT | Q.SPRITE_INTERACTIVE | Q.SPRITE_WEAPON,
      canUse: 0,
      cx: 40,
    });

    this.add('2d, animation');
    this.on("touch");
    this.on("sensor");
    this.on("attacked");
    this.p.sheet = this.p.sprite + "Walk";
  },

  touch: function() {
    Q("Character").invoke("stopControl", false);
    this.p.type = Q.SPRITE_PLAYER;
    this.p.controlled = true;
    Q.stage().follow(this);
  },

  sensor: function(sensor) {
    this.sensor = sensor;
    this.p.canUse = 1/5;
  },

  stopControl: function() {
    this.p.type = Q.SPRITE_NPC;
    this.p.controlled = false;
  },

  step: function(dt) {
    if(!this.p.controlled) {
      this.play("stand_" + this.p.direction);
      return;
    };

    this.p.canUse -= dt;

    if(this.p.attacking) return;
    if(Q.inputs["left"]) {
      this.p.sheet = this.p.sprite + "Walk";
      this.p.direction = "left";
      this.play("walk_left");
      this.p.vx = -200;
    } else if(Q.inputs["right"]) {
      this.p.sheet = this.p.sprite + "Walk";
      this.p.direction = "right";
      this.play("walk_right");
      this.p.vx = 200;
    } else {
      this.play("stand_" + this.p.direction);
      this.p.vx = 0;
    }

    if(this.p.canUse > 0 && Q.inputs["action"]) {
      this.sensor.use();
      if(this.sensor.p.sprite === "KitchenTable") {
        this.p.sheet = this.p.sprite + "AttackFruitBowl";
        this.play("attack_fruit_bowl");
        this.p.attacking = true;
      }
    }
  },

  attacked: function() {
    console.log("swap");
    this.p.attacking = false;
    this.p.sheet = this.p.sprite + "Walk";
    this.play("stand_" + this.p.direction);
  },
});

},{}],"/Volumes/spaaaaaace/git/ld32/src/javascript/decoration.js":[function(require,module,exports){
Q.Sprite.extend("Decoration",{
  init: function(p) {
    this._super(p, {
      asset: p.image,
      type: Q.SPRITE_NONE,
      collisionMask: Q.SPRITE_NONE,
      visibleOnly: true,
      gravity: 0,
    });
  }
});

},{}],"/Volumes/spaaaaaace/git/ld32/src/javascript/interactive.js":[function(require,module,exports){
Q.Sprite.extend("Interactive",{
  init: function(p) {
    this._super(p, {
      sprite: p.prop,
      sheet: p.prop,
      sensor: true,
      type: Q.SPRITE_INTERACTIVE,
      collisionMask: Q.SPRITE_NONE | Q.SPRITE_PLAYER,
      gravity: 0,
      usable: true,
    });

    this.add('animation');
    this.play("normal");
    this.on("sensor");
  },

  use: function() {
    if(!this.p.usable) return;
    this.p.usable = false;
    this.play("interact");
  },

  sensor: function(sensed) {
    if(this.p.usable) sensed.trigger("sensor", this);
  }
});

},{}],"/Volumes/spaaaaaace/git/ld32/src/javascript/levels.js":[function(require,module,exports){
var levels = [
  {title: "An Unconventional Death", name: "test"},
]

// Level Builder
for(i in levels) {
  (function(level, nextLevel, levelNumber) {
    Q.scene(level.name,function(stage) {
      Q.stageTMX(level.name + ".tmx",stage);
      if(nextLevel) {
        this.nextScene = nextLevel.name;
      }

      var hud = Q.stageScene("levelOverlay", 1, {title: level.title, number: parseInt(levelNumber)+1});
      this.playerFails = 0;
      this.playerStarted = function() { hud.runTimer = true; };
      this.playerEnded = function() { hud.runTimer = false; };
      this.playerDoubleJump = function() { hud.playerDoubleJumps++; };
      this.playerThrow = function() { hud.playerThrows++; };
      this.playerSwap = function() { hud.playerSwaps++; };
      this.levelStats = function() {
        return {
          time: hud.elapsedTime,
          doubleJumps: hud.playerDoubleJumps,
          botThrows: hud.playerThrows,
          swaps: hud.playerSwaps,
          goals: level,
        };
      };

      stage.add("viewport");
      stage.viewport.scale = 0.5;
      stage.viewport.centerOn(800, 500);
    });
  })(levels[i], levels[parseInt(i)+1], i)
}

Q.scene('failLevel',function(stage) {
  var container = stage.insert(new Q.UI.Container({ x: Q.width/2, y: Q.height/2, fill: "#DBE5E6", shadow: true, shadowColor: "rgba(118,121,121, 0.5)" }));

  var button = container.insert(new Q.UI.Button({ x: 0, y: 0, fill: "#FFFFFF", label: "Try Again" }))         
  var label = container.insert(new Q.UI.Text({x:10, y: -10 - button.p.h, label: stage.options.label }));

  var continueCb = function() {
    Q.clearStages();
    Q.stageScene(stage.options.level);
  };
  Q.input.on("confirm", continueCb);
  button.on("click", continueCb);

  container.fit(20);
});

Q.scene('winLevel',function(stage) {
  var container = stage.insert(new Q.UI.Container({ x: Q.width/2, y: Q.height/2 + 55, fill: "#DBE5E6", shadow: true, shadowColor: "rgba(118,121,121, 0.5)" }));

  var button = container.insert(new Q.UI.Button({ x: 0, y: 0, fill: "#FFFFFF", label: "Next Level" }))         
  var swaps = container.insert(new Q.UI.Text({x:0, y: -10 - button.p.h, label: "Swaps: " + stage.options.levelStats.swaps, size: 16 }));
  var djs = container.insert(new Q.UI.Text({x:0, y: -6 - swaps.p.h + swaps.p.y, label: "Double Jumps: " + stage.options.levelStats.doubleJumps, size: 16 }));
  var bthrows = container.insert(new Q.UI.Text({x:0, y: -6 - djs.p.h + djs.p.y, label: "Throws: " + stage.options.levelStats.botThrows, size: 16 }));
  var time = container.insert(new Q.UI.Text({x:0, y: -10 - bthrows.p.h + bthrows.p.y, label: "Time: " + parseFloat(stage.options.levelStats.time).toFixed(2), size: 20 }));

  var twoStar = new Q.Sprite({ x: 0, y: -16 - time.p.h + time.p.y, sheet: 'star', opacity: 0.4, scale: 1.5});
  var oneStar = new Q.Sprite({ x: -(twoStar.p.w/1.4) - 2, y: -16 - time.p.h + time.p.y, sheet: 'star', opacity: 0.4, scale: 1.5});
  var threeStar = new Q.Sprite({ x: (twoStar.p.w/1.4) + 2, y: -16 - time.p.h + time.p.y, sheet: 'star', opacity: 0.4, scale: 1.5});
  oneStar.add("animation");
  twoStar.add("animation");
  threeStar.add("animation");

  container.insert(oneStar);
  container.insert(twoStar);
  container.insert(threeStar);

  if(stage.options.levelStats.time < stage.options.levelStats.goals.oneStarTime) {
    oneStar.p.opacity = 1;
  }
  if(stage.options.levelStats.time < stage.options.levelStats.goals.twoStarTime) {
    twoStar.p.opacity = 1;
  }
  if(stage.options.levelStats.time < stage.options.levelStats.goals.threeStarTime) {
    threeStar.p.opacity = 1;
  }

  var continueCb = function() {
    Q.clearStages();
    Q.stageScene(stage.options.level);
  };
  Q.input.on("confirm", continueCb);
  button.on("click", continueCb);

  container.fit(20);
});

Q.scene('levelOverlay',function(stage) {
  var title = stage.insert(new Q.UI.Text({
    x: Q.width / 2,
    y: Q.height / 3,
    // label: "Level " + stage.options.number + "  " + stage.options.title+ "...",
    label: stage.options.title,
    color: "#FFFFFF",
    outlineColor: "#545E5E",
    outlineWidth: 7,
    size: 32,
    opacity: 0
  }));
  title.add("tween");

  setTimeout(function() { title.animate({opacity: 1}, 0.75)}, 500);
  setTimeout(function() { title.animate({opacity: 0}, 0.75)}, 4000);
});

module.exports = levels;

},{}],"/Volumes/spaaaaaace/git/ld32/src/javascript/tmx.js":[function(require,module,exports){
var levels = require('./levels');

var files = [
  "tiles.png",
  "jim.json",
  "jim.png",
  "jen.json",
  "jen.png",
  "table.json",
  "table.png",
];

for(i in levels) {
  files.push(levels[i].name + ".tmx");
}

Q.loadTMX(files.join(", "), function() {
  Q.compileSheets("jim.png","jim.json");
  Q.compileSheets("jen.png","jen.json");
  Q.compileSheets("table.png","table.json");

  Q.animations("Jim", {
    walk_right: { frames: [0,1,2,3,4,5,6,7,8,9,10], rate: 1/12, flip: false, loop: true },
    walk_left: { frames: [0,1,2,3,4,5,6,7,8,9,10], rate: 1/12, flip: "x", loop: true },
    stand_right: { frames: [8,9], rate: 99, flip: false, loop: true },
    stand_left: { frames: [8,9], rate: 99, flip:"x", loop: true },
    attack_fruit_bowl: { frames: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14], rate: 1/12, flip: false, loop: false, trigger: "attacked" },
  });

  Q.animations("Jen", {
    walk_right: { frames: [0,1,2,3,4,5,6,7,8,9,10], rate: 1/12, flip: false, loop: true },
    walk_left: { frames: [0,1,2,3,4,5,6,7,8,9,10], rate: 1/12, flip: "x", loop: true },
    stand_right: { frames: [8,9], rate: 99, flip: false, loop: true },
    stand_left: { frames: [8,9], rate: 99, flip:"x", loop: true },
  });

  Q.animations("KitchenTable", {
    normal: { frames: [0], rate: 1/12, flip: false, loop: true },
    interact: { frames: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14], rate: 1/12, flip: false, loop: false },
    used: { frames: [14], rate: 1/12, flip: false },
  });


  Q.stageScene(levels[0].name);
});

},{"./levels":"/Volumes/spaaaaaace/git/ld32/src/javascript/levels.js"}]},{},["./src/javascript/game.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIuL3NyYy9qYXZhc2NyaXB0L2dhbWUuanMiLCIvVm9sdW1lcy9zcGFhYWFhYWNlL2dpdC9sZDMyL25vZGVfbW9kdWxlcy9xdWludHVzL2V4dHJhL3F1aW50dXNfZG9tLmpzIiwiL1ZvbHVtZXMvc3BhYWFhYWFjZS9naXQvbGQzMi9ub2RlX21vZHVsZXMvcXVpbnR1cy9leHRyYS9xdWludHVzX3BoeXNpY3MuanMiLCIvVm9sdW1lcy9zcGFhYWFhYWNlL2dpdC9sZDMyL25vZGVfbW9kdWxlcy9xdWludHVzL2V4dHJhL3F1aW50dXNfc3ZnLmpzIiwiL1ZvbHVtZXMvc3BhYWFhYWFjZS9naXQvbGQzMi9ub2RlX21vZHVsZXMvcXVpbnR1cy9pbmRleC5qcyIsIi9Wb2x1bWVzL3NwYWFhYWFhY2UvZ2l0L2xkMzIvbm9kZV9tb2R1bGVzL3F1aW50dXMvbGliL3F1aW50dXMuanMiLCIvVm9sdW1lcy9zcGFhYWFhYWNlL2dpdC9sZDMyL25vZGVfbW9kdWxlcy9xdWludHVzL2xpYi9xdWludHVzXzJkLmpzIiwiL1ZvbHVtZXMvc3BhYWFhYWFjZS9naXQvbGQzMi9ub2RlX21vZHVsZXMvcXVpbnR1cy9saWIvcXVpbnR1c19hbmltLmpzIiwiL1ZvbHVtZXMvc3BhYWFhYWFjZS9naXQvbGQzMi9ub2RlX21vZHVsZXMvcXVpbnR1cy9saWIvcXVpbnR1c19hdWRpby5qcyIsIi9Wb2x1bWVzL3NwYWFhYWFhY2UvZ2l0L2xkMzIvbm9kZV9tb2R1bGVzL3F1aW50dXMvbGliL3F1aW50dXNfaW5wdXQuanMiLCIvVm9sdW1lcy9zcGFhYWFhYWNlL2dpdC9sZDMyL25vZGVfbW9kdWxlcy9xdWludHVzL2xpYi9xdWludHVzX3NjZW5lcy5qcyIsIi9Wb2x1bWVzL3NwYWFhYWFhY2UvZ2l0L2xkMzIvbm9kZV9tb2R1bGVzL3F1aW50dXMvbGliL3F1aW50dXNfc3ByaXRlcy5qcyIsIi9Wb2x1bWVzL3NwYWFhYWFhY2UvZ2l0L2xkMzIvbm9kZV9tb2R1bGVzL3F1aW50dXMvbGliL3F1aW50dXNfdG14LmpzIiwiL1ZvbHVtZXMvc3BhYWFhYWFjZS9naXQvbGQzMi9ub2RlX21vZHVsZXMvcXVpbnR1cy9saWIvcXVpbnR1c190b3VjaC5qcyIsIi9Wb2x1bWVzL3NwYWFhYWFhY2UvZ2l0L2xkMzIvbm9kZV9tb2R1bGVzL3F1aW50dXMvbGliL3F1aW50dXNfdWkuanMiLCIvVm9sdW1lcy9zcGFhYWFhYWNlL2dpdC9sZDMyL25vZGVfbW9kdWxlcy9xdWludHVzL25vZGVfbW9kdWxlcy9ib3gyZHdlYi9ib3gyZC5qcyIsIi9Wb2x1bWVzL3NwYWFhYWFhY2UvZ2l0L2xkMzIvc3JjL2phdmFzY3JpcHQvY2hhcmFjdGVyLmpzIiwiL1ZvbHVtZXMvc3BhYWFhYWFjZS9naXQvbGQzMi9zcmMvamF2YXNjcmlwdC9kZWNvcmF0aW9uLmpzIiwiL1ZvbHVtZXMvc3BhYWFhYWFjZS9naXQvbGQzMi9zcmMvamF2YXNjcmlwdC9pbnRlcmFjdGl2ZS5qcyIsIi9Wb2x1bWVzL3NwYWFhYWFhY2UvZ2l0L2xkMzIvc3JjL2phdmFzY3JpcHQvbGV2ZWxzLmpzIiwiL1ZvbHVtZXMvc3BhYWFhYWFjZS9naXQvbGQzMi9zcmMvamF2YXNjcmlwdC90bXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOVRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25NQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDck1BOztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqdUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbFJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3bkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3J1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbG5CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZtVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJRdWludHVzID0gcmVxdWlyZSgncXVpbnR1cycpXG5cbnZhciBRID0gd2luZG93LlEgPSBRdWludHVzKCkuaW5jbHVkZShcIlNwcml0ZXMsIFNjZW5lcywgSW5wdXQsIDJELCBBbmltLCBUb3VjaCwgVUksIFRNWFwiKVxuUS5TUFJJVEVfUExBWUVSID0gMjtcblEuU1BSSVRFX1dFQVBPTiA9IDQ7XG5RLlNQUklURV9OUEMgPSA4O1xuUS5TUFJJVEVfSU5URVJBQ1RJVkUgPSAxNjtcblxuUS5zZXR1cCh7IG1heGltaXplOiB0cnVlIH0pLnRvdWNoKFEuU1BSSVRFX0FMTCk7XG5cblEuaW5wdXQua2V5Ym9hcmRDb250cm9scyh7XG4gIExFRlQ6IFwibGVmdFwiLFxuICBSSUdIVDogXCJyaWdodFwiLFxuICBVUDogXCJ1cFwiLFxuICBET1dOOiBcImRvd25cIixcbiAgQTogXCJsZWZ0XCIsXG4gIEQ6IFwicmlnaHRcIixcbiAgVzogXCJ1cFwiLFxuICBTOiBcImRvd25cIixcbiAgU1BBQ0U6IFwiYWN0aW9uXCJcbn0pO1xuXG5cbnJlcXVpcmUoJy4vY2hhcmFjdGVyJylcbnJlcXVpcmUoJy4vaW50ZXJhY3RpdmUnKVxucmVxdWlyZSgnLi9kZWNvcmF0aW9uJylcbnJlcXVpcmUoJy4vdG14JylcbiIsIi8qZ2xvYmFsIFF1aW50dXM6ZmFsc2UgKi9cbi8qZ2xvYmFsICQ6ZmFsc2UgKi9cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihRKSB7XG4gIFxuICBRLnNldHVwRE9NID0gZnVuY3Rpb24oaWQsb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIGlkID0gaWQgfHwgXCJxdWludHVzXCI7XG4gICAgUS5lbCA9ICQoUS5faXNTdHJpbmcoaWQpID8gXCIjXCIgKyBpZCA6IGlkKTtcbiAgICBpZihRLmVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgUS5lbCA9ICQoXCI8ZGl2PlwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdpZCcsaWQpXG4gICAgICAgICAgICAgICAgLmNzcyh7d2lkdGg6IDMyMCwgaGVpZ2h0OjQyMCB9KVxuICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhcImJvZHlcIik7XG4gICAgfVxuICAgIGlmKG9wdGlvbnMubWF4aW1pemUpIHtcbiAgICAgIHZhciB3ID0gJCh3aW5kb3cpLndpZHRoKCk7XG4gICAgICB2YXIgaCA9ICQod2luZG93KS5oZWlnaHQoKTtcbiAgICAgIFEuZWwuY3NzKHt3aWR0aDp3LGhlaWdodDpofSk7XG4gICAgfVxuICAgUS53cmFwcGVyID0gUS5lbFxuICAgICAgICAgICAgICAgICAud3JhcChcIjxkaXYgaWQ9J1wiICsgaWQgKyBcIl9jb250YWluZXInLz5cIilcbiAgICAgICAgICAgICAgICAgLnBhcmVudCgpXG4gICAgICAgICAgICAgICAgIC5jc3MoeyB3aWR0aDogUS5lbC53aWR0aCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBRLmVsLmhlaWdodCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luOiAnMCBhdXRvJyB9KTtcbiAgICBRLmVsLmNzcyh7IHBvc2l0aW9uOidyZWxhdGl2ZScsIG92ZXJmbG93OiAnaGlkZGVuJyB9KTtcbiAgICBRLndpZHRoID0gUS5lbC53aWR0aCgpO1xuICAgIFEuaGVpZ2h0ID0gUS5lbC5oZWlnaHQoKTtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyB3aW5kb3cuc2Nyb2xsVG8oMCwxKTsgfSwgMCk7XG4gICAgJCh3aW5kb3cpLmJpbmQoJ29yaWVudGF0aW9uY2hhbmdlJyxmdW5jdGlvbigpIHtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHdpbmRvdy5zY3JvbGxUbygwLDEpOyB9LCAwKTtcbiAgICB9KTtcbiAgICByZXR1cm4gUTtcbiAgfTtcblxuKGZ1bmN0aW9uKCkgeyBcbiAgICBmdW5jdGlvbiB0cmFuc2xhdGVCdWlsZGVyKGF0dHJpYnV0ZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRvbSx4LHkpIHtcbiAgICAgICAgZG9tLnN0eWxlW2F0dHJpYnV0ZV0gPSBcbiAgICAgICAgXCJ0cmFuc2xhdGUoXCIgKyBNYXRoLmZsb29yKHgpICsgXCJweCxcIiArXG4gICAgICAgIE1hdGguZmxvb3IoeSkgKyBcInB4KVwiO1xuICAgICAgfTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdHJhbnNsYXRlM0RCdWlsZGVyKGF0dHJpYnV0ZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRvbSx4LHkpIHtcbiAgICAgICAgZG9tLnN0eWxlW2F0dHJpYnV0ZV0gPSBcbiAgICAgICAgXCJ0cmFuc2xhdGUzZChcIiArIE1hdGguZmxvb3IoeCkgKyBcInB4LFwiICtcbiAgICAgICAgTWF0aC5mbG9vcih5KSArIFwicHgsMHB4KVwiO1xuICAgICAgfTtcbiAgICB9XG4gICAgZnVuY3Rpb24gc2NhbGVCdWlsZGVyKGF0dHJpYnV0ZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRvbSxzY2FsZSkge1xuICAgICAgICBkb20uc3R5bGVbYXR0cmlidXRlICsgJ09yaWdpbiddID0gXCIwJSAwJVwiO1xuICAgICAgICBkb20uc3R5bGVbYXR0cmlidXRlXSA9IFwic2NhbGUoXCIgKyBzY2FsZSArIFwiKVwiO1xuICAgICAgfTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZmFsbGJhY2tUcmFuc2xhdGUoZG9tLHgseSkge1xuICAgICAgZG9tLnN0eWxlLmxlZnQgPSB4ICsgXCJweFwiO1xuICAgICAgZG9tLnN0eWxlLnRvcCA9IHkgKyBcInB4XCI7XG4gICAgfVxuICAgIHZhciBoYXMzZCA9ICAoJ1dlYktpdENTU01hdHJpeCcgaW4gd2luZG93ICYmIFxuICAgICAgICAgICAgICAgICAgJ20xMScgaW4gbmV3IHdpbmRvdy5XZWJLaXRDU1NNYXRyaXgoKSk7XG4gICAgdmFyIGR1bW15U3R5bGUgPSAkKFwiPGRpdj5cIilbMF0uc3R5bGU7XG4gICAgdmFyIHRyYW5zZm9ybU1ldGhvZHMgPSBbJ3RyYW5zZm9ybScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3dlYmtpdFRyYW5zZm9ybScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ01velRyYW5zZm9ybScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21zVHJhbnNmb3JtJyBdO1xuICAgIGZvcih2YXIgaT0wO2k8dHJhbnNmb3JtTWV0aG9kcy5sZW5ndGg7aSsrKSB7XG4gICAgICB2YXIgdHJhbnNmb3JtTmFtZSA9IHRyYW5zZm9ybU1ldGhvZHNbaV07XG4gICAgICBpZighUS5faXNVbmRlZmluZWQoZHVtbXlTdHlsZVt0cmFuc2Zvcm1OYW1lXSkpIHtcbiAgICAgICAgaWYoaGFzM2QpIHtcbiAgICAgICAgICBRLnBvc2l0aW9uRE9NID0gdHJhbnNsYXRlM0RCdWlsZGVyKHRyYW5zZm9ybU5hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIFEucG9zaXRpb25ET00gPSB0cmFuc2xhdGVCdWlsZGVyKHRyYW5zZm9ybU5hbWUpOyBcbiAgICAgICAgfVxuICAgICAgICBRLnNjYWxlRE9NID0gc2NhbGVCdWlsZGVyKHRyYW5zZm9ybU5hbWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgUS5wb3NpdGlvbkRPTSA9IFEucG9zaXRpb25ET00gfHwgZmFsbGJhY2tUcmFuc2xhdGU7XG4gICAgUS5zY2FsZURPTSA9IFEuc2NhbGVET00gfHwgZnVuY3Rpb24oc2NhbGUpIHt9O1xuICB9KCkpO1xuXG4gIChmdW5jdGlvbigpIHtcbiAgICAgZnVuY3Rpb24gdHJhbnNpdGlvbkJ1aWxkZXIoYXR0cmlidXRlLHByZWZpeCl7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oZG9tLHByb3BlcnR5LHNlYyxlYXNpbmcpIHtcbiAgICAgICAgZWFzaW5nID0gZWFzaW5nIHx8IFwiXCI7XG4gICAgICAgIGlmKHByb3BlcnR5ID09PSAndHJhbnNmb3JtJykge1xuICAgICAgICAgIHByb3BlcnR5ID0gcHJlZml4ICsgcHJvcGVydHk7XG4gICAgICAgIH1cbiAgICAgICAgc2VjID0gc2VjIHx8IFwiMXNcIjtcbiAgICAgICAgZG9tLnN0eWxlW2F0dHJpYnV0ZV0gPSBwcm9wZXJ0eSArIFwiIFwiICsgc2VjICsgXCIgXCIgKyBlYXNpbmc7XG4gICAgICB9O1xuICAgIH1cbiAgICAvLyBEdW1teSBtZXRob2RcbiAgICBmdW5jdGlvbiBmYWxsYmFja1RyYW5zaXRpb24oKSB7IH1cbiAgICB2YXIgZHVtbXlTdHlsZSA9ICQoXCI8ZGl2PlwiKVswXS5zdHlsZTtcbiAgICB2YXIgdHJhbnNpdGlvbk1ldGhvZHMgPSBbJ3RyYW5zaXRpb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICd3ZWJraXRUcmFuc2l0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnTW96VHJhbnNpdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21zVHJhbnNpdGlvbicgXTtcbiAgICB2YXIgcHJlZml4TmFtZXMgPSBbICcnLCAnLXdlYmtpdC0nLCAnLW1vei0nLCAnLW1zLScgXTtcbiAgICBmb3IodmFyIGk9MDtpPHRyYW5zaXRpb25NZXRob2RzLmxlbmd0aDtpKyspIHtcbiAgICAgIHZhciB0cmFuc2l0aW9uTmFtZSA9IHRyYW5zaXRpb25NZXRob2RzW2ldO1xuICAgICAgdmFyIHByZWZpeE5hbWUgPSBwcmVmaXhOYW1lc1tpXTtcbiAgICAgIGlmKCFRLl9pc1VuZGVmaW5lZChkdW1teVN0eWxlW3RyYW5zaXRpb25OYW1lXSkpIHtcbiAgICAgICAgUS50cmFuc2l0aW9uRE9NID0gdHJhbnNpdGlvbkJ1aWxkZXIodHJhbnNpdGlvbk5hbWUscHJlZml4TmFtZSk7IFxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgUS50cmFuc2l0aW9uRE9NID0gUS50cmFuc2l0aW9uRE9NIHx8IGZhbGxiYWNrVHJhbnNpdGlvbjtcbiAgfSgpKTtcblxuICBRLkRPTVNwcml0ZSA9IFEuU3ByaXRlLmV4dGVuZCh7XG4gICAgaW5pdDogZnVuY3Rpb24ocHJvcHMpIHtcbiAgICAgIHRoaXMuX3N1cGVyKHByb3BzKTtcbiAgICAgIHRoaXMuZWwgPSAkKFwiPGRpdj5cIikuY3NzKHtcbiAgICAgICAgd2lkdGg6IHRoaXMucC53LFxuICAgICAgICBoZWlnaHQ6IHRoaXMucC5oLFxuICAgICAgICB6SW5kZXg6IHRoaXMucC56IHx8IDAsXG4gICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnXG4gICAgICB9KTtcbiAgICAgIHRoaXMuZG9tID0gdGhpcy5lbFswXTtcbiAgICAgIHRoaXMucnAgPSB7fTtcbiAgICAgIHRoaXMuc2V0SW1hZ2UoKTtcbiAgICAgIHRoaXMuc2V0VHJhbnNmb3JtKCk7XG4gICAgfSxcbiAgXG4gICAgc2V0SW1hZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFzc2V0O1xuICAgICAgaWYodGhpcy5zaGVldCgpKSB7XG4gICAgICAgIGFzc2V0ID0gUS5hc3NldCh0aGlzLnNoZWV0KCkuYXNzZXQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXNzZXQgPSB0aGlzLmFzc2V0KCk7XG4gICAgICB9XG4gICAgICBpZihhc3NldCkge1xuICAgICAgICB0aGlzLmRvbS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybChcIiArIGFzc2V0LnNyYyArIFwiKVwiO1xuICAgICAgfVxuICAgIH0sXG4gIFxuICAgIHNldFRyYW5zZm9ybTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcCA9IHRoaXMucDtcbiAgICAgIHZhciBycCA9IHRoaXMucnA7XG4gICAgICBpZihycC5mcmFtZSAhPT0gcC5mcmFtZSkge1xuICAgICAgICBpZihwLnNoZWV0KSB7XG4gICAgICAgICAgdGhpcy5kb20uc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uID0gXG4gICAgICAgICAgICAgICgtdGhpcy5zaGVldCgpLmZ4KHAuZnJhbWUpKSArIFwicHggXCIgKyBcbiAgICAgICAgICAgICAgKC10aGlzLnNoZWV0KCkuZnkocC5mcmFtZSkpICsgXCJweFwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuZG9tLnN0eWxlLmJhY2tncm91bmRQb3NpdGlvbiA9IFwiMHB4IDBweFwiO1xuICAgICAgICB9XG4gICAgICAgIHJwLmZyYW1lID0gcC5mcmFtZTtcbiAgICAgIH1cbiAgICAgIGlmKHJwLnggIT09IHAueCB8fCBycC55ICE9PSBwLnkpIHtcbiAgICAgICAgUS5wb3NpdGlvbkRPTSh0aGlzLmRvbSxwLngscC55KTtcbiAgICAgICAgcnAueCA9IHAueDtcbiAgICAgICAgcnAueSA9IHAueTtcbiAgICAgIH0gXG4gICAgfSxcblxuICAgIGhpZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5kb20uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9LFxuXG4gICAgc2hvdzogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmRvbS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICB9LFxuXG4gICAgZHJhdzogZnVuY3Rpb24oY3R4KSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2RyYXcnKTtcbiAgICB9LFxuXG4gICAgc3RlcDogZnVuY3Rpb24oZHQpIHtcbiAgICAgIHRoaXMudHJpZ2dlcignc3RlcCcsZHQpO1xuICAgICAgdGhpcy5zZXRUcmFuc2Zvcm0oKTtcbiAgICB9LFxuXG4gICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XG4gICAgICBpZih0aGlzLmRlc3Ryb3llZCkgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICB0aGlzLmVsLnJlbW92ZSgpO1xuICAgIH1cbiAgfSk7XG4gIFxuXG4gIGlmKFEuU3RhZ2UpIHtcbiAgICBRLkRPTVN0YWdlID0gUS5TdGFnZS5leHRlbmQoe1xuICAgICAgaW5pdDogZnVuY3Rpb24oc2NlbmUpIHtcbiAgICAgICAgdGhpcy5lbCA9ICQoXCI8ZGl2PlwiKS5jc3Moe1xuICAgICAgICAgIHRvcDowLFxuICAgICAgICAgIHBvc2l0aW9uOidyZWxhdGl2ZSdcbiAgICAgICAgfSkuYXBwZW5kVG8oUS5lbCk7XG4gICAgICAgIHRoaXMuZG9tID0gdGhpcy5lbFswXTtcbiAgICAgICAgdGhpcy53cmFwcGVyID0gdGhpcy5lbC53cmFwKCc8ZGl2PicpLnBhcmVudCgpLmNzcyh7XG4gICAgICAgICAgcG9zaXRpb246J2Fic29sdXRlJyxcbiAgICAgICAgICBsZWZ0OjAsXG4gICAgICAgICAgdG9wOjBcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2NhbGUgPSAxO1xuICAgICAgICB0aGlzLndyYXBwZXJfZG9tID0gdGhpcy53cmFwcGVyWzBdO1xuICAgICAgICB0aGlzLl9zdXBlcihzY2VuZSk7XG4gICAgICB9LFxuXG4gICAgICBpbnNlcnQ6IGZ1bmN0aW9uKGl0bSkge1xuICAgICAgICBpZihpdG0uZG9tKSB7IHRoaXMuZG9tLmFwcGVuZENoaWxkKGl0bS5kb20pOyB9XG4gICAgICAgIHJldHVybiB0aGlzLl9zdXBlcihpdG0pO1xuICAgICAgfSxcblxuICAgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMud3JhcHBlci5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgIH0sXG5cbiAgICAgIHJlc2NhbGU6IGZ1bmN0aW9uKHNjYWxlKSB7XG4gICAgICAgIHRoaXMuc2NhbGUgPSBzY2FsZTtcbiAgICAgICAgUS5zY2FsZURPTSh0aGlzLndyYXBwZXJfZG9tLHNjYWxlKTtcbiAgICAgIH0sXG5cbiAgICAgIGNlbnRlck9uOiBmdW5jdGlvbih4LHkpIHtcbiAgICAgICAgdGhpcy54ID0gUS53aWR0aC8yL3RoaXMuc2NhbGUgLSAgeDtcbiAgICAgICAgdGhpcy55ID0gUS5oZWlnaHQvMi90aGlzLnNjYWxlIC0geTtcbiAgICAgICAgUS5wb3NpdGlvbkRPTSh0aGlzLmRvbSx0aGlzLngsdGhpcy55KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIFEuZG9tT25seSA9IGZ1bmN0aW9uKCkge1xuICAgIFEuU3RhZ2UgPSBRLkRPTVN0YWdlO1xuICAgIFEuc2V0dXAgPSBRLnNldHVwRE9NO1xuICAgIFEuU3ByaXRlID0gUS5ET01TcHJpdGU7XG4gICAgcmV0dXJuIFE7XG4gIH07XG4gIFxuICBRLkRPTVRpbGVNYXAgPSBRLkRPTVNwcml0ZS5leHRlbmQoe1xuICAgIC8vIEV4cGVjdHMgYSBzcHJpdGUgc2hlZXQsIGFsb25nIHdpdGggY29scyBhbmQgcm93cyBwcm9wZXJ0aWVzXG4gICAgaW5pdDpmdW5jdGlvbihwcm9wcykge1xuICAgICAgdmFyIHNoZWV0ID0gUS5zaGVldChwcm9wcy5zaGVldCk7XG4gICAgICB0aGlzLl9zdXBlcihRLl9leHRlbmQocHJvcHMse1xuICAgICAgICB3OiBwcm9wcy5jb2xzICogc2hlZXQudGlsZXcsXG4gICAgICAgIGg6IHByb3BzLnJvd3MgKiBzaGVldC50aWxlaCxcbiAgICAgICAgdGlsZXc6IHNoZWV0LnRpbGV3LFxuICAgICAgICB0aWxlaDogc2hlZXQudGlsZWhcbiAgICAgIH0pKTtcbiAgICAgIHRoaXMuc2hvd24gPSBbXTtcbiAgICAgIHRoaXMuZG9tVGlsZXMgPSBbXTtcbiAgICB9LFxuXG4gICAgc2V0SW1hZ2U6IGZ1bmN0aW9uKCkgeyB9LFxuICBcbiAgICBzZXR1cDogZnVuY3Rpb24odGlsZXMsaGlkZSkge1xuICAgICAgdGhpcy50aWxlcyA9IHRpbGVzO1xuICAgICAgZm9yKHZhciB5PTAsaGVpZ2h0PXRpbGVzLmxlbmd0aDt5PGhlaWdodDt5KyspIHtcbiAgICAgICAgdGhpcy5kb21UaWxlcy5wdXNoKFtdKTtcbiAgICAgICAgdGhpcy5zaG93bi5wdXNoKFtdKTtcbiAgICAgICAgZm9yKHZhciB4PTAsd2lkdGg9dGlsZXNbMF0ubGVuZ3RoO3g8d2lkdGg7eCsrKSB7XG4gICAgICAgICAgdmFyIGRvbVRpbGUgPSB0aGlzLl9hZGRUaWxlKHRpbGVzW3ldW3hdKTtcbiAgICAgICAgICBpZihoaWRlKSB7IGRvbVRpbGUuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOyB9XG4gICAgICAgICAgdGhpcy5zaG93bi5wdXNoKGhpZGUgPyBmYWxzZSA6IHRydWUpO1xuICAgICAgICAgIHRoaXMuZG9tVGlsZXNbeV0ucHVzaChkb21UaWxlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBfYWRkVGlsZTogZnVuY3Rpb24oZnJhbWUpIHtcbiAgICAgIHZhciBwID0gdGhpcy5wO1xuICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgZGl2LnN0eWxlLndpZHRoID0gcC50aWxldyArIFwicHhcIjtcbiAgICAgIGRpdi5zdHlsZS5oZWlnaHQgPSBwLnRpbGVoICsgXCJweFwiO1xuICAgICAgZGl2LnN0eWxlLnN0eWxlRmxvYXQgPSBkaXYuc3R5bGUuY3NzRmxvYXQgPSAnbGVmdCc7XG4gICAgICB0aGlzLl9zZXRUaWxlKGRpdixmcmFtZSk7XG4gICAgICB0aGlzLmRvbS5hcHBlbmRDaGlsZChkaXYpO1xuICAgICAgcmV0dXJuIGRpdjtcbiAgICB9LFxuXG4gICAgX3NldFRpbGU6IGZ1bmN0aW9uKGRvbSxmcmFtZSkge1xuICAgICAgdmFyIGFzc2V0ID0gUS5hc3NldCh0aGlzLnNoZWV0KCkuYXNzZXQpO1xuICAgICAgZG9tLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwidXJsKFwiICsgYXNzZXQuc3JjICsgXCIpXCI7XG4gICAgICBkb20uc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uID0gKC10aGlzLnNoZWV0KCkuZngoZnJhbWUpKSArXCJweCBcIiArICgtdGhpcy5zaGVldCgpLmZ5KGZyYW1lKSkgKyBcInB4XCI7XG4gICAgfSxcblxuICAgIHZhbGlkVGlsZTogZnVuY3Rpb24oeCx5KSB7XG4gICAgICByZXR1cm4gKHkgPj0gMCAmJiB5IDwgdGhpcy5wLnJvd3MpICYmIFxuICAgICAgICAgICAgICh4ID49IDAgJiYgeCA8IHRoaXMucC5jb2xzKTtcbiAgICB9LFxuXG4gICAgZ2V0OiBmdW5jdGlvbih4LHkpIHsgcmV0dXJuIHRoaXMudmFsaWRUaWxlKHgseSkgPyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50aWxlc1t5XVt4XSA6IG51bGw7IH0sXG5cbiAgICBnZXREb206IGZ1bmN0aW9uKHgseSkgeyByZXR1cm4gdGhpcy52YWxpZFRpbGUoeCx5KSA/IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRvbVRpbGVzW3ldW3hdIDogbnVsbDsgfSxcbiAgICBzZXQ6IGZ1bmN0aW9uKHgseSxmcmFtZSkge1xuICAgICAgaWYoIXRoaXMudmFsaWRUaWxlKHgseSkpIHsgcmV0dXJuOyB9XG4gICAgICB0aGlzLnRpbGVzW3ldW3hdID0gZnJhbWU7XG4gICAgICB2YXIgZG9tVGlsZSA9IHRoaXMuZ2V0RG9tKHgseSk7XG4gICAgICB0aGlzLl9zZXRGaWxlKGRvbVRpbGUsZnJhbWUpO1xuICAgIH0sXG5cbiAgICBzaG93OiBmdW5jdGlvbih4LHkpIHtcbiAgICAgIGlmKCF0aGlzLnZhbGlkVGlsZSh4LHkpKSB7IHJldHVybjsgfVxuICAgICAgaWYodGhpcy5zaG93blt5XVt4XSkgeyByZXR1cm47IH1cbiAgICAgIHRoaXMuZ2V0RG9tKHgseSkuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcbiAgICAgIHRoaXMuc2hvd25beV1beF0gPSB0cnVlO1xuICAgIH0sXG5cbiAgICBoaWRlOiBmdW5jdGlvbih4LHkpIHtcbiAgICAgIGlmKCF0aGlzLnZhbGlkVGlsZSh4LHkpKSB7IHJldHVybjsgfVxuICAgICAgaWYoIXRoaXMuc2hvd25beV1beF0pIHsgcmV0dXJuOyB9XG4gICAgICB0aGlzLmdldERvbSh4LHkpLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcbiAgICAgIHRoaXMuc2hvd25beV1beF0gPSBmYWxzZTtcbiAgICB9XG4gIH0pOyBcblxuXG5cblxufTtcblxuIiwiLypnbG9iYWwgUXVpbnR1czpmYWxzZSAqL1xuLypnbG9iYWwgQm94MkQ6ZmFsc2UgKi9cblxudmFyIEJveDJEID0gcmVxdWlyZSgnYm94MmR3ZWInKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKFEpIHtcbiAgdmFyIEIyZCA9IFEuQjJkID0ge1xuICAgICAgV29ybGQ6IEJveDJELkR5bmFtaWNzLmIyV29ybGQsXG4gICAgICBWZWM6IEJveDJELkNvbW1vbi5NYXRoLmIyVmVjMixcbiAgICAgIEJvZHlEZWY6IEJveDJELkR5bmFtaWNzLmIyQm9keURlZixcbiAgICAgIEJvZHk6IEJveDJELkR5bmFtaWNzLmIyQm9keSxcbiAgICAgIEZpeHR1cmVEZWY6IEJveDJELkR5bmFtaWNzLmIyRml4dHVyZURlZixcbiAgICAgIEZpeHR1cmU6IEJveDJELkR5bmFtaWNzLmIyRml4dHVyZSxcbiAgICAgIFBvbHlnb25TaGFwZTogQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMlBvbHlnb25TaGFwZSxcbiAgICAgIENpcmNsZVNoYXBlOiBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyQ2lyY2xlU2hhcGUsXG4gICAgICBMaXN0ZW5lcjogIEJveDJELkR5bmFtaWNzLmIyQ29udGFjdExpc3RlbmVyXG4gICAgfTtcblxuICB2YXIgZGVmT3B0cyA9IFEuUGh5c2ljc0RlZmF1bHRzID0ge1xuICAgIGdyYXZpdHlYOiAwLFxuICAgIGdyYXZpdHlZOiA5LjgsXG4gICAgc2NhbGU6IDMwLFxuICAgIHZlbG9jaXR5SXRlcmF0aW9uczogOCxcbiAgICBwb3NpdGlvbkl0ZXJhdGlvbnM6IDNcbiAgfTtcblxuICBRLmNvbXBvbmVudCgnd29ybGQnLHtcbiAgICBhZGRlZDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLm9wdHMgPSBRLl9leHRlbmQoe30sZGVmT3B0cyk7XG4gICAgICB0aGlzLl9ncmF2aXR5ID0gbmV3IEIyZC5WZWModGhpcy5vcHRzLmdyYXZpdHlYLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRzLmdyYXZpdHlZKTtcbiAgICAgIHRoaXMuX3dvcmxkID0gbmV3IEIyZC5Xb3JsZCh0aGlzLl9ncmF2aXR5LCB0cnVlKTtcblxuICAgICAgdmFyIHBoeXNpY3MgPSB0aGlzLFxuICAgICAgICAgIGJvdW5kQmVnaW4gPSBmdW5jdGlvbihjb250YWN0KSB7IHBoeXNpY3MuYmVnaW5Db250YWN0KGNvbnRhY3QpOyB9LFxuICAgICAgICAgIGJvdW5kRW5kID0gZnVuY3Rpb24oY29udGFjdCkgeyBwaHlzaWNzLmVuZENvbnRhY3QoY29udGFjdCk7IH0sXG4gICAgICAgICAgYm91bmRQb3N0U29sdmUgPSBmdW5jdGlvbihjb250YWN0LGltcHVsc2UpIHsgcGh5c2ljcy5wb3N0U29sdmUoY29udGFjdCxpbXB1bHNlKTsgfTtcbiAgXG4gICAgICB0aGlzLl9saXN0ZW5lciA9IG5ldyBCMmQuTGlzdGVuZXIoKTtcbiAgICAgIHRoaXMuX2xpc3RlbmVyLkJlZ2luQ29udGFjdCA9IGJvdW5kQmVnaW47XG4gICAgICB0aGlzLl9saXN0ZW5lci5FbmRDb250YWN0ID0gYm91bmRFbmQ7XG4gICAgICB0aGlzLl9saXN0ZW5lci5Qb3N0U29sdmUgPSBib3VuZFBvc3RTb2x2ZTtcbiAgICAgIHRoaXMuX3dvcmxkLlNldENvbnRhY3RMaXN0ZW5lcih0aGlzLl9saXN0ZW5lcik7XG4gICAgICBcbiAgICAgIHRoaXMuY29sID0ge307XG4gICAgICB0aGlzLnNjYWxlID0gdGhpcy5vcHRzLnNjYWxlO1xuICAgICAgdGhpcy5lbnRpdHkub24oJ3N0ZXAnLHRoaXMsJ2JveFN0ZXAnKTtcbiAgICB9LFxuXG4gICAgc2V0Q29sbGlzaW9uRGF0YTogZnVuY3Rpb24oY29udGFjdCxpbXB1bHNlKSB7XG4gICAgICB2YXIgc3ByaXRlQSA9IGNvbnRhY3QuR2V0Rml4dHVyZUEoKS5HZXRCb2R5KCkuR2V0VXNlckRhdGEoKSxcbiAgICAgICAgICBzcHJpdGVCID0gY29udGFjdC5HZXRGaXh0dXJlQigpLkdldEJvZHkoKS5HZXRVc2VyRGF0YSgpO1xuICAgICAgIFxuICAgICAgdGhpcy5jb2xbXCJhXCJdID0gc3ByaXRlQTtcbiAgICAgIHRoaXMuY29sW1wiYlwiXSA9IHNwcml0ZUI7XG4gICAgICB0aGlzLmNvbFtcImltcHVsc2VcIl0gPSBpbXB1bHNlO1xuICAgICAgdGhpcy5jb2xbXCJzcHJpdGVcIl0gPSBudWxsO1xuICAgIH0sXG5cbiAgICBiZWdpbkNvbnRhY3Q6IGZ1bmN0aW9uKGNvbnRhY3QpIHtcbiAgICAgIHRoaXMuc2V0Q29sbGlzaW9uRGF0YShjb250YWN0LG51bGwpO1xuICAgICAgdGhpcy5jb2wuYS50cmlnZ2VyKFwiY29udGFjdFwiLHRoaXMuY29sLmIpO1xuICAgICAgdGhpcy5jb2wuYi50cmlnZ2VyKFwiY29udGFjdFwiLHRoaXMuY29sLmEpO1xuICAgICAgdGhpcy5lbnRpdHkudHJpZ2dlcihcImNvbnRhY3RcIix0aGlzLmNvbCk7XG4gICAgfSxcblxuICAgIGVuZENvbnRhY3Q6IGZ1bmN0aW9uKGNvbnRhY3QpIHtcbiAgICAgIHRoaXMuc2V0Q29sbGlzaW9uRGF0YShjb250YWN0LG51bGwpO1xuICAgICAgdGhpcy5jb2wuYS50cmlnZ2VyKFwiZW5kQ29udGFjdFwiLHRoaXMuY29sLmIpO1xuICAgICAgdGhpcy5jb2wuYi50cmlnZ2VyKFwiZW5kQ29udGFjdFwiLHRoaXMuY29sLmEpO1xuICAgICAgdGhpcy5lbnRpdHkudHJpZ2dlcihcImVuZENvbnRhY3RcIix0aGlzLmNvbCk7XG4gICAgfSxcblxuICAgIHBvc3RTb2x2ZTogZnVuY3Rpb24oY29udGFjdCwgaW1wdWxzZSkge1xuICAgICAgdGhpcy5zZXRDb2xsaXNpb25EYXRhKGNvbnRhY3QsaW1wdWxzZSk7XG4gICAgICB0aGlzLmNvbFtcInNwcml0ZVwiXSA9IHRoaXMuY29sLmI7XG4gICAgICB0aGlzLmNvbC5hLnRyaWdnZXIoXCJpbXB1bHNlXCIsdGhpcy5jb2wpO1xuICAgICAgdGhpcy5jb2xbXCJzcHJpdGVcIl0gPSB0aGlzLmNvbC5hO1xuICAgICAgdGhpcy5jb2wuYi50cmlnZ2VyKFwiaW1wdWxzZVwiLHRoaXMuY29sKTtcbiAgICAgIHRoaXMuZW50aXR5LnRyaWdnZXIoXCJpbXB1bHNlXCIsdGhpcy5jb2wpO1xuICAgIH0sXG5cbiAgICBjcmVhdGVCb2R5OiBmdW5jdGlvbihkZWYpIHtcbiAgICAgIHJldHVybiB0aGlzLl93b3JsZC5DcmVhdGVCb2R5KGRlZik7XG4gICAgfSxcblxuICAgIGRlc3Ryb3lCb2R5OiBmdW5jdGlvbihib2R5KSB7XG4gICAgICByZXR1cm4gdGhpcy5fd29ybGQuRGVzdHJveUJvZHkoYm9keSk7XG4gICAgfSxcblxuICAgIGJveFN0ZXA6IGZ1bmN0aW9uKGR0KSB7XG4gICAgICBpZihkdCA+IDEvMjApIHsgZHQgPSAxLzIwOyB9XG4gICAgICB0aGlzLl93b3JsZC5TdGVwKGR0LCBcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdHMudmVsb2NpdHlJdGVyYXRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3B0cy5wb3NpdGlvbkl0ZXJhdGlvbnMpO1xuICAgIH1cbiAgfSk7XG5cbiAgdmFyIGVudGl0eURlZmF1bHRzID0gUS5QaHlzaWNzRW50aXR5RGVmYXVsdHMgPSB7XG4gICAgZGVuc2l0eTogMSxcbiAgICBmcmljdGlvbjogMSxcbiAgICByZXN0aXR1dGlvbjogMC4xXG4gIH07XG5cbiAgUS5jb21wb25lbnQoJ3BoeXNpY3MnLHtcbiAgICBhZGRlZDogZnVuY3Rpb24oKSB7XG4gICAgICBpZih0aGlzLmVudGl0eS5zdGFnZSkge1xuICAgICAgICB0aGlzLmluc2VydGVkKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmVudGl0eS5vbignaW5zZXJ0ZWQnLHRoaXMsJ2luc2VydGVkJyk7XG4gICAgICB9XG4gICAgICB0aGlzLmVudGl0eS5vbignc3RlcCcsdGhpcywnc3RlcCcpO1xuICAgICAgdGhpcy5lbnRpdHkub24oJ3JlbW92ZWQnLHRoaXMsJ3JlbW92ZWQnKTtcbiAgICB9LFxuXG4gICAgcG9zaXRpb246IGZ1bmN0aW9uKHgseSkge1xuICAgICAgdmFyIHN0YWdlID0gdGhpcy5lbnRpdHkuc3RhZ2U7XG4gICAgICB0aGlzLl9ib2R5LlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5fYm9keS5TZXRQb3NpdGlvbihuZXcgQjJkLlZlYyh4IC8gc3RhZ2Uud29ybGQuc2NhbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgLyBzdGFnZS53b3JsZC5zY2FsZSkpO1xuICAgIH0sXG5cbiAgICBhbmdsZTogZnVuY3Rpb24oYW5nbGUpIHtcbiAgICAgIHRoaXMuX2JvZHkuU2V0QW5nbGUoYW5nbGUgLyAxODAgKiBNYXRoLlBJKTtcbiAgICB9LFxuXG4gICAgdmVsb2NpdHk6IGZ1bmN0aW9uKHgseSkge1xuICAgICAgdmFyIHN0YWdlID0gdGhpcy5lbnRpdHkuc3RhZ2U7XG4gICAgICB0aGlzLl9ib2R5LlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5fYm9keS5TZXRMaW5lYXJWZWxvY2l0eShuZXcgQjJkLlZlYyh4IC8gc3RhZ2Uud29ybGQuc2NhbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgLyBzdGFnZS53b3JsZC5zY2FsZSkpO1xuICAgIH0sXG4gXG4gICAgaW5zZXJ0ZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGVudGl0eSA9IHRoaXMuZW50aXR5LFxuICAgICAgICAgIHN0YWdlID0gZW50aXR5LnN0YWdlLFxuICAgICAgICAgIHNjYWxlID0gc3RhZ2Uud29ybGQuc2NhbGUsXG4gICAgICAgICAgcCA9IGVudGl0eS5wLFxuICAgICAgICAgIG9wcyA9IGVudGl0eURlZmF1bHRzLFxuICAgICAgICAgIGRlZiA9IHRoaXMuX2RlZiA9IG5ldyBCMmQuQm9keURlZigpLFxuICAgICAgICAgIGZpeHR1cmVEZWYgPSB0aGlzLl9maXh0dXJlID0gbmV3IEIyZC5GaXh0dXJlRGVmKCk7XG4gICAgICAgICAgICBcbiAgICAgIGRlZi5wb3NpdGlvbi54ID0gcC54IC8gc2NhbGU7XG4gICAgICBkZWYucG9zaXRpb24ueSA9IHAueSAvIHNjYWxlO1xuICAgICAgZGVmLnR5cGUgPSBwLnR5cGUgPT09ICdzdGF0aWMnID8gXG4gICAgICAgICAgICAgICAgIEIyZC5Cb2R5LmIyX3N0YXRpY0JvZHkgOlxuICAgICAgICAgICAgICAgICBCMmQuQm9keS5iMl9keW5hbWljQm9keTtcbiAgICAgIGRlZi5hY3RpdmUgPSB0cnVlO1xuICAgICAgXG4gICAgICB0aGlzLl9ib2R5ID0gc3RhZ2Uud29ybGQuY3JlYXRlQm9keShkZWYpOyBcbiAgICAgIHRoaXMuX2JvZHkuU2V0VXNlckRhdGEoZW50aXR5KTtcbiAgICAgIGZpeHR1cmVEZWYuZGVuc2l0eSA9IHAuZGVuc2l0eSB8fCBvcHMuZGVuc2l0eTtcbiAgICAgIGZpeHR1cmVEZWYuZnJpY3Rpb24gPSBwLmZyaWN0aW9uIHx8IG9wcy5mcmljdGlvbjtcbiAgICAgIGZpeHR1cmVEZWYucmVzdGl0dXRpb24gPSBwLnJlc3RpdHV0aW9uIHx8IG9wcy5yZXN0aXR1dGlvbjtcbiAgICAgIFxuICAgICAgc3dpdGNoKHAuc2hhcGUpIHtcbiAgICAgICAgY2FzZSBcImJsb2NrXCI6XG4gICAgICAgICAgZml4dHVyZURlZi5zaGFwZSA9IG5ldyBCMmQuUG9seWdvblNoYXBlKCk7XG4gICAgICAgICAgZml4dHVyZURlZi5zaGFwZS5TZXRBc0JveChwLncvMi9zY2FsZSwgcC5oLzIvc2NhbGUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiY2lyY2xlXCI6XG4gICAgICAgICAgZml4dHVyZURlZi5zaGFwZSA9IG5ldyBCMmQuQ2lyY2xlU2hhcGUocC5yL3NjYWxlKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcInBvbHlnb25cIjpcbiAgICAgICAgICBmaXh0dXJlRGVmLnNoYXBlID0gbmV3IEIyZC5Qb2x5Z29uU2hhcGUoKTtcbiAgICAgICAgICB2YXIgcG9pbnRzT2JqID0gUS5fbWFwKHAucG9pbnRzLGZ1bmN0aW9uKHB0KSB7XG4gICAgICAgICAgICByZXR1cm4geyB4OiBwdFswXSAvIHNjYWxlLCB5OiBwdFsxXSAvIHNjYWxlIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZml4dHVyZURlZi5zaGFwZS5TZXRBc0FycmF5KHBvaW50c09iaiwgcC5wb2ludHMubGVuZ3RoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhpcy5fYm9keS5DcmVhdGVGaXh0dXJlKGZpeHR1cmVEZWYpO1xuICAgICAgdGhpcy5fYm9keS5fYmJpZCA9IHAuaWQ7XG4gICAgfSxcblxuICAgIHJlbW92ZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGVudGl0eSA9IHRoaXMuZW50aXR5LFxuICAgICAgICAgIHN0YWdlID0gZW50aXR5LnBhcmVudDtcbiAgICAgIHN0YWdlLndvcmxkLmRlc3Ryb3lCb2R5KHRoaXMuX2JvZHkpO1xuICAgIH0sXG5cbiAgICBzdGVwOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwID0gdGhpcy5lbnRpdHkucCxcbiAgICAgICAgICBzdGFnZSA9IHRoaXMuZW50aXR5LnN0YWdlLFxuICAgICAgICAgIHBvcyA9IHRoaXMuX2JvZHkuR2V0UG9zaXRpb24oKSxcbiAgICAgICAgICBhbmdsZSA9IHRoaXMuX2JvZHkuR2V0QW5nbGUoKTtcbiAgICAgIHAueCA9IHBvcy54ICogc3RhZ2Uud29ybGQuc2NhbGU7XG4gICAgICBwLnkgPSBwb3MueSAqIHN0YWdlLndvcmxkLnNjYWxlO1xuICAgICAgcC5hbmdsZSA9IGFuZ2xlIC8gTWF0aC5QSSAqIDE4MDtcbiAgICB9XG4gIH0pO1xuXG5cbn07XG4iLCIvKmdsb2JhbCBRdWludHVzOmZhbHNlICovXG4vKmdsb2JhbCAkOmZhbHNlICovXG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oUSkge1xuICB2YXIgU1ZHX05TID1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI7IFxuICBRLnNldHVwU1ZHID0gZnVuY3Rpb24oaWQsb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIGlkID0gaWQgfHwgXCJxdWludHVzXCI7XG4gICAgUS5zdmcgPVEuX2lzU3RyaW5nKGlkKSA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSA6IGlkO1xuICAgIFxuICAgIGlmKCFRLnN2Zykge1xuICAgICAgUS5zdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoU1ZHX05TLCdzdmcnKTtcbiAgICAgIFEuc3ZnLnNldEF0dHJpYnV0ZSgnd2lkdGgnLDMyMCk7XG4gICAgICBRLnN2Zy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsNDIwKTtcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoUS5zdmcpO1xuICAgIH1cblxuICAgIGlmKG9wdGlvbnMubWF4aW1pemUpIHtcbiAgICAgIHZhciB3ID0gd2luZG93LmlubmVyV2lkdGgtMTtcbiAgICAgIHZhciBoID0gd2luZG93LmlubmVySGVpZ2h0LTEwO1xuICAgICAgUS5zdmcuc2V0QXR0cmlidXRlKCd3aWR0aCcsdyk7XG4gICAgICBRLnN2Zy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsaCk7XG4gICAgfVxuXHRRLndpZHRoID0gUS5zdmcuZ2V0QXR0cmlidXRlKCd3aWR0aCcpO1xuICAgIFEuaGVpZ2h0ID0gUS5zdmcuZ2V0QXR0cmlidXRlKCdoZWlnaHQnKTtcbiAgICB2YXIgcGFyZW50PVEuc3ZnLnBhcmVudE5vZGU7XG4gICAgdmFyIGNvbnRhaW5lcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb250YWluZXIuc2V0QXR0cmlidXRlKCdpZCcsaWQrJ19jb250YWluZXInKTtcbiAgICBjb250YWluZXIuc3R5bGUud2lkdGg9US53aWR0aDtcbiAgICBjb250YWluZXIuc3R5bGUuaGVpZ2h0PVEuaGVpZ2h0O1xuICAgIGNvbnRhaW5lci5zdHlsZS5tYXJnaW49JzAgYXV0byc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKFEuc3ZnKTtcbiAgICBwYXJlbnQuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcbiAgICBRLndyYXBwZXI9Y29udGFpbmVyO1xuIFxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHdpbmRvdy5zY3JvbGxUbygwLDEpOyB9LCAwKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLGZ1bmN0aW9uKCkge1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsgd2luZG93LnNjcm9sbFRvKDAsMSk7IH0sIDApO1xuICAgIH0pO1xuICAgIHJldHVybiBRO1xuICB9O1xuXG4gIFEuU3ByaXRlLmV4dGVuZChcIlNWR1Nwcml0ZVwiLHtcbiAgICBpbml0OiBmdW5jdGlvbihwcm9wcykge1xuICAgICAgdGhpcy5fc3VwZXIoUS5fZGVmYXVsdHMocHJvcHMse1xuICAgICAgICBzaGFwZTogJ2Jsb2NrJyxcbiAgICAgICAgY29sb3I6ICdibGFjaycsXG4gICAgICAgIGFuZ2xlOiAwLFxuICAgICAgICBhY3RpdmU6IHRydWUsXG4gICAgICAgIGN4OiAwLFxuICAgICAgICBjeTogMFxuICAgICAgfSkpO1xuICAgICAgdGhpcy5jcmVhdGVTaGFwZSgpO1xuICAgICAgdGhpcy5zdmcuc3ByaXRlID0gdGhpcztcbiAgICAgIHRoaXMucnAgPSB7fTtcbiAgICAgIHRoaXMuc2V0VHJhbnNmb3JtKCk7XG4gICAgfSxcblxuICAgIHNldDogZnVuY3Rpb24oYXR0cikge1xuICAgICAgUS5fZWFjaChhdHRyLGZ1bmN0aW9uKHZhbHVlLGtleSkge1xuICAgICAgICB0aGlzLnN2Zy5zZXRBdHRyaWJ1dGUoa2V5LHZhbHVlKTtcbiAgICAgIH0sdGhpcyk7XG4gICAgfSxcbiAgICBcbiAgICBjcmVhdGVTaGFwZTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcCA9IHRoaXMucDtcbiAgICAgIHN3aXRjaChwLnNoYXBlKSB7XG4gICAgICAgIGNhc2UgJ2Jsb2NrJzpcbiAgICAgICAgICB0aGlzLnN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhTVkdfTlMsJ3JlY3QnKTtcbiAgICAgICAgICBRLl9leHRlbmQocCx7IGN4OiBwLncvMiwgY3k6IHAuaC8yIH0pO1xuICAgICAgICAgIHRoaXMuc2V0KHsgd2lkdGg6IHAudywgaGVpZ2h0OiBwLmggfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2NpcmNsZSc6XG4gICAgICAgICAgdGhpcy5zdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoU1ZHX05TLCdjaXJjbGUnKTtcbiAgICAgICAgICB0aGlzLnNldCh7IHI6IHAuciwgY3g6IDAsIGN5OiAwIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdwb2x5Z29uJzpcbiAgICAgICAgICB0aGlzLnN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhTVkdfTlMsJ3BvbHlnb24nKTtcbiAgICAgICAgICB2YXIgcHRzID0gUS5fbWFwKHAucG9pbnRzLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24ocHQpIHsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHB0WzBdICsgXCIsXCIgKyBwdFsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuam9pbihcIiBcIik7XG4gICAgICAgICAgdGhpcy5zZXQoeyBwb2ludHM6IHB0cyB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgICBcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0KHsgZmlsbDogcC5jb2xvciB9KTtcbiAgICAgIGlmKHAub3V0bGluZSkge1xuICAgICAgICB0aGlzLnNldCh7XG4gICAgICAgICAgc3Ryb2tlOiBwLm91dGxpbmUsXG4gICAgICAgICAgXCJzdHJva2Utd2lkdGhcIjogcC5vdXRsaW5lV2lkdGggfHwgMVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0VHJhbnNmb3JtOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwID0gdGhpcy5wO1xuICAgICAgdmFyIHJwID0gdGhpcy5ycDtcbiAgICAgIGlmKHJwLnggIT09IHAueCB8fCBcbiAgICAgICAgIHJwLnkgIT09IHAueSB8fCBcbiAgICAgICAgIHJwLmFuZ2xlICE9PSBwLmFuZ2xlICkge1xuICAgICAgICB2YXIgdHJhbnNmb3JtID0gXCJ0cmFuc2xhdGUoXCIgKyAocC54IC0gcC5jeCkgKyBcIixcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocC55IC0gcC5jeSkgKyBcIikgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJyb3RhdGUoXCIgKyBwLmFuZ2xlICsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiLFwiICsgcC5jeCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiLFwiICsgcC5jeSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiKVwiO1xuICAgICAgICB0aGlzLnN2Zy5zZXRBdHRyaWJ1dGUoJ3RyYW5zZm9ybScsdHJhbnNmb3JtKTtcbiAgICAgICAgcnAuYW5nbGUgPSBwLmFuZ2xlO1xuICAgICAgICBycC54ID0gcC54O1xuICAgICAgICBycC55ID0gcC55O1xuICAgICAgfSBcbiAgICB9LFxuICAgIHJlbmRlcjogZnVuY3Rpb24oY3R4KSB7XG4gICAgXHRcbiAgICBcdHRoaXMudHJpZ2dlcigncHJlZHJhdycsY3R4KTtcbiAgICBcdHRoaXMudHJpZ2dlcignYmVmb3JlZHJhdycsY3R4KTtcbiAgICBcdHRoaXMuZHJhdyhjdHgpO1xuICAgIFx0dGhpcy50cmlnZ2VyKCdiZWZvcmVkcmF3JyxjdHgpO1xuICAgIH0sXG4gICAgZHJhdzogZnVuY3Rpb24oY3R4KSB7XG4gICAgfSxcblxuICAgIHN0ZXA6IGZ1bmN0aW9uKGR0KSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ3N0ZXAnLGR0KTtcbiAgICAgIHRoaXMuc2V0VHJhbnNmb3JtKCk7XG4gICAgfVxuICB9KTtcblxuXG4gIFEuU3RhZ2UuZXh0ZW5kKFwiU1ZHU3RhZ2VcIix7XG4gICAgaW5pdDogZnVuY3Rpb24oc2NlbmUpIHtcbiAgICAgIHRoaXMuc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFNWR19OUywnc3ZnJyk7XG4gICAgICB0aGlzLnN2Zy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJyxRLndpZHRoKTtcbiAgICAgIHRoaXMuc3ZnLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JyxRLmhlaWdodCk7XG4gICAgICBRLnN2Zy5hcHBlbmRDaGlsZCh0aGlzLnN2Zyk7XG4gICAgICBcbiAgICAgIHRoaXMudmlld0JveCA9IHsgeDogMCwgeTogMCwgdzogUS53aWR0aCwgaDogUS5oZWlnaHQgfTtcbiAgICAgIHRoaXMuX3N1cGVyKHNjZW5lKTtcbiAgICB9LFxuICAgIHJlbW92ZTpmdW5jdGlvbihpdG0pe1xuXHQgIGlmKGl0bS5zdmcpIHsgdGhpcy5zdmcucmVtb3ZlQ2hpbGQoaXRtLnN2Zyk7IH1cblx0ICByZXR1cm4gdGhpcy5fc3VwZXIoaXRtKTtcbiAgICB9LFxuICAgIGluc2VydDogZnVuY3Rpb24oaXRtKSB7XG4gICAgICBpZihpdG0uc3ZnKSB7IHRoaXMuc3ZnLmFwcGVuZENoaWxkKGl0bS5zdmcpOyB9XG4gICAgICByZXR1cm4gdGhpcy5fc3VwZXIoaXRtKTtcbiAgICB9LFxuXG4gICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XG4gICAgICBRLnN2Zy5yZW1vdmVDaGlsZCh0aGlzLnN2Zyk7XG4gICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH0sXG5cbiAgICB2aWV3cG9ydDogZnVuY3Rpb24odyxoKSB7XG4gICAgICB0aGlzLnZpZXdCb3gudyA9IHc7XG4gICAgICB0aGlzLnZpZXdCb3guaCA9IGg7XG4gICAgICBpZih0aGlzLnZpZXdCb3guY3ggfHwgdGhpcy52aWV3Qm94LmN5KSB7XG4gICAgICAgIHRoaXMuY2VudGVyT24odGhpcy52aWV3Qm94LmN4LFxuICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlld0JveC5jeSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldFZpZXdCb3goKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgY2VudGVyT246IGZ1bmN0aW9uKHgseSkge1xuICAgICAgdGhpcy52aWV3Qm94LmN4ID0geDtcbiAgICAgIHRoaXMudmlld0JveC5jeSA9IHk7XG4gICAgICB0aGlzLnZpZXdCb3gueCA9IHggLSB0aGlzLnZpZXdCb3gudy8yO1xuICAgICAgdGhpcy52aWV3Qm94LnkgPSB5IC0gdGhpcy52aWV3Qm94LmgvMjtcbiAgICAgIHRoaXMuc2V0Vmlld0JveCgpO1xuICAgIH0sXG5cbiAgICBzZXRWaWV3Qm94OiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc3ZnLnNldEF0dHJpYnV0ZSgndmlld0JveCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3Qm94LnggKyBcIiBcIiArIHRoaXMudmlld0JveC55ICsgXCIgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlld0JveC53ICsgXCIgXCIgKyB0aGlzLnZpZXdCb3guaCk7XG4gICAgfSxcblxuICAgIGJyb3dzZXJUb1dvcmxkOiBmdW5jdGlvbih4LHkpIHtcbiAgICAgIHZhciBtID0gdGhpcy5zdmcuZ2V0U2NyZWVuQ1RNKCk7XG4gICAgICB2YXIgcCA9IHRoaXMuc3ZnLmNyZWF0ZVNWR1BvaW50KCk7XG4gICAgICBwLnggPSB4OyBwLnkgPSB5O1xuICAgICAgcmV0dXJuIHAubWF0cml4VHJhbnNmb3JtKG0uaW52ZXJzZSgpKTtcbiAgICB9XG4gIH0pO1xuXG4gIFEuc3ZnT25seSA9IGZ1bmN0aW9uKCkge1xuICAgIFEuU3RhZ2UgPSBRLlNWR1N0YWdlO1xuICAgIFEuc2V0dXAgPSBRLnNldHVwU1ZHO1xuICAgIFEuU3ByaXRlID0gUS5TVkdTcHJpdGU7XG4gICAgcmV0dXJuIFE7XG4gIH07XG5cblxufTtcblxuIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuL2xpYi9xdWludHVzJykiLCIvLyAgICAgUXVpbnR1cyBHYW1lIEVuZ2luZVxuLy8gICAgIChjKSAyMDEyIFBhc2NhbCBSZXR0aWcsIEN5a29kIExMQ1xuLy8gICAgIFF1aW50dXMgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2Ugb3IgR1BMdjIgTGljZW5zZS5cbi8vICAgICBGb3IgYWxsIGRldGFpbHMgYW5kIGRvY3VtZW50YXRpb246XG4vLyAgICAgaHR0cDovL2h0bWw1cXVpbnR1cy5jb21cbi8vXG4vKipcblF1aW50dXMgSFRNTDUgR2FtZSBFbmdpbmUgXG5cblRoZSBjb2RlIGluIGBxdWludHVzLmpzYCBkZWZpbmVzIHRoZSBiYXNlIGBRdWludHVzKClgIG1ldGhvZFxud2hpY2ggY3JlYXRlIGFuIGluc3RhbmNlIG9mIHRoZSBlbmdpbmUuIFRoZSBiYXNpYyBlbmdpbmUgZG9lc24ndFxuZG8gYSB3aG9sZSBsb3QgLSBpdCBwcm92aWRlcyBhbiBhcmNoaXRlY3R1cmUgZm9yIGV4dGVuc2lvbiwgYVxuZ2FtZSBsb29wLCBhbmQgYSBtZXRob2QgZm9yIGNyZWF0aW5nIG9yIGJpbmRpbmcgdG8gYW4gZXhzaXRpbmdcbmNhbnZhcyBjb250ZXh0LiBUaGUgZW5naW5lIGhhcyBkZXBlbmRlbmNpZXMgb24gVW5kZXJzY29yZS5qcyBhbmQgalF1ZXJ5LFxuYWx0aG91Z2ggdGhlIGpRdWVyeSBkZXBlbmRlbmN5IHdpbGwgYmUgcmVtb3ZlZCBpbiB0aGUgZnV0dXJlLlxuXG5Nb3N0IG9mIHRoZSBnYW1lLXNwZWNpZmljIGZ1bmN0aW9uYWxpdHkgaXMgaW4gdGhlIFxudmFyaW91cyBvdGhlciBtb2R1bGVzOlxuXG4qIGBxdWludHVzX2lucHV0LmpzYCAtIGBJbnB1dGAgbW9kdWxlLCB3aGljaCBhbGxvd3MgZm9yIHVzZXIgaW5wdXQgdmlhIGtleWJvYXJkIGFuZCB0b3VjaHNjcmVlblxuKiBgcXVpbnR1c19zcHJpdGVzLmpzYCAtIGBTcHJpdGVzYCBtb2R1bGUsIHdoaWNoIGRlZmluZXMgYSBiYXNpYyBgUS5TcHJpdGVgIGNsYXNzIGFsb25nIHdpdGggc3ByaXRlc2hlZXQgc3VwcG9ydCBpbiBgUS5TcHJpdGVTaGVldGAuXG4qIGBxdWludHVzX3NjZW5lcy5qc2AgLSBgU2NlbmVzYCBtb2R1bGUuIEl0IGRlZmluZXMgdGhlIGBRLlNjZW5lYCBjbGFzcywgd2hpY2ggYWxsb3dzIGNyZWF0aW9uIG9mIHJldXNhYmxlIHNjZW5lcywgYW5kIHRoZSBgUS5TdGFnZWAgY2xhc3MsIHdoaWNoIGhhbmRsZXMgbWFuYWdpbmcgYSBudW1iZXIgb2Ygc3ByaXRlcyBhdCBvbmNlLlxuKiBgcXVpbnR1c19hbmltLmpzYCAtIGBBbmltYCBtb2R1bGUsIHdoaWNoIGFkZHMgaW4gc3VwcG9ydCBmb3IgYW5pbWF0aW9ucyBvbiBzcHJpdGVzIGFsb25nIHdpdGggYSBgdmlld3BvcnRgIGNvbXBvbmVudCB0byBmb2xsb3cgdGhlIHBsYXllciBhcm91bmQgYW5kIGEgYFEuUmVwZWF0ZXJgIGNsYXNzIHRoYXQgY2FuIGNyZWF0ZSBhIHJlcGVhdGluZywgc2Nyb2xsaW5nIGJhY2tncm91bmQuXG5cbkBtb2R1bGUgUXVpbnR1c1xuKi9cblxuLyoqXG4gVG9wLWxldmVsIFF1aW50dXMgZW5naW5lIGZhY3Rvcnkgd3JhcHBlciwgXG4gY3JlYXRlcyBuZXcgaW5zdGFuY2VzIG9mIHRoZSBlbmdpbmUgYnkgY2FsbGluZzpcblxuICAgICAgdmFyIFEgPSBRdWludHVzKHsgIC4uLiAgfSk7XG5cbiBBbnkgaW5pdGlhbCBzZXR1cCBtZXRob2RzIGFsc28gYWxsIHJldHVybiB0aGUgYFFgIG9iamVjdCwgYWxsb3dpbmcgYW55IGluaXRpYWwgXG4gc2V0dXAgY2FsbHMgdG8gYmUgY2hhaW5lZCB0b2dldGhlci5cblxuICAgICAgdmFyIFEgPSBRdWludHVzKClcbiAgICAgICAgICAgICAgLmluY2x1ZGUoXCJJbnB1dCwgU3ByaXRlcywgU2NlbmVzXCIpXG4gICAgICAgICAgICAgIC5zZXR1cCgncXVpbnR1cycsIHsgbWF4aW1pemU6IHRydWUgfSlcbiAgICAgICAgICAgICAgLmNvbnRyb2xzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgIFxuIGBRYCBpcyB1c2VkIGludGVybmFsbHkgYXMgdGhlIG9iamVjdCBuYW1lLCBhbmQgaXMgdXNlZCBpbiBtb3N0IG9mIHRoZSBleGFtcGxlcywgXG4gYnV0IG11bHRpcGxlIGluc3RhbmNlcyBvZiB0aGUgZW5naW5lIG9uIHRoZSBzYW1lIHBhZ2UgY2FuIGhhdmUgZGlmZmVyZW50IG5hbWVzLlxuXG4gICAgIHZhciBHYW1lMSA9IFF1aW50dXMoKSwgR2FtZTIgPSBRdWludHVzKCk7XG5cbkBjbGFzcyBRdWludHVzXG4qKi9cblxubW9kdWxlLmV4cG9ydHMgPSBRdWludHVzO1xuXG5RdWludHVzWycyRCddID0gcmVxdWlyZSgnLi9xdWludHVzXzJkJylcblF1aW50dXMuQW5pbSA9IHJlcXVpcmUoJy4vcXVpbnR1c19hbmltJylcblF1aW50dXMuQXVkaW8gPSByZXF1aXJlKCcuL3F1aW50dXNfYXVkaW8nKVxuUXVpbnR1cy5JbnB1dCA9IHJlcXVpcmUoJy4vcXVpbnR1c19pbnB1dCcpXG5RdWludHVzLlNjZW5lcyA9IHJlcXVpcmUoJy4vcXVpbnR1c19zY2VuZXMnKVxuUXVpbnR1cy5TcHJpdGVzID0gcmVxdWlyZSgnLi9xdWludHVzX3Nwcml0ZXMnKVxuUXVpbnR1cy5UTVggPSByZXF1aXJlKCcuL3F1aW50dXNfdG14JylcblF1aW50dXMuVG91Y2ggPSByZXF1aXJlKCcuL3F1aW50dXNfdG91Y2gnKVxuUXVpbnR1cy5VSSA9IHJlcXVpcmUoJy4vcXVpbnR1c191aScpXG5RdWludHVzLkRPTSA9IHJlcXVpcmUoJy4uL2V4dHJhL3F1aW50dXNfZG9tJylcblF1aW50dXMuUGh5c2ljcyA9IHJlcXVpcmUoJy4uL2V4dHJhL3F1aW50dXNfcGh5c2ljcycpXG5RdWludHVzLlNWRyA9IHJlcXVpcmUoJy4uL2V4dHJhL3F1aW50dXNfc3ZnJylcblxuZnVuY3Rpb24gUXVpbnR1cyhvcHRzKSB7XG5cbiAgLyoqXG4gICBBIGxhIGpRdWVyeSAtIHRoZSByZXR1cm5lZCBgUWAgb2JqZWN0IGlzIGFjdHVhbGx5XG4gICBhIG1ldGhvZCB0aGF0IGNhbGxzIGBRLnNlbGVjdGAuIGBRLnNlbGVjdGAgZG9lc24ndCBkbyBhbnl0aGluZ1xuICAgaW5pdGlhbGx5LCBidXQgY2FuIGJlIG92ZXJyaWRkZW4gYnkgYSBtb2R1bGUgdG8gYWxsb3dcbiAgIHNlbGVjdGlvbiBvZiBnYW1lIG9iamVjdHMuIFRoZSBgU2NlbmVzYCBtb2R1bGUgYWRkcyBpbiBcbiAgIHRoZSBzZWxlY3QgbWV0aG9kIHdoaWNoIHNlbGVjdHMgZnJvbSB0aGUgZGVmYXVsdCBzdGFnZS5cbiAgXG4gICAgICAgdmFyIFEgPSBRdWludHVzKCkuaW5jbHVkZShcIlNwcml0ZXMsIFNjZW5lc1wiKTtcbiAgICAgICAuLi4gR2FtZSBDb2RlIC4uLlxuICAgICAgIC8vIFNldCB0aGUgYW5ncnkgcHJvcGVydHkgb24gYWxsIEVuZW15MSBjbGFzcyBvYmplY3RzIHRvIHRydWVcbiAgICAgICBRKFwiRW5lbXkxXCIpLnAoeyBhbmdyeTogdHJ1ZSB9KTtcbiAgICBcbiAgICBAbWV0aG9kIFFcbiAgICBAZm9yIFF1aW50dXNcbiAgKi8gIFxuICB2YXIgUSA9IGZ1bmN0aW9uKHNlbGVjdG9yLHNjb3BlLG9wdGlvbnMpIHsgICBcbiAgICByZXR1cm4gUS5zZWxlY3Qoc2VsZWN0b3Isc2NvcGUsb3B0aW9ucyk7XG4gIH07XG5cbiAgLyoqXG4gICBEZWZhdWx0IG5vLW9wIHNlbGVjdCBtZXRob2QuIFJlcGxhY2VkIHdpdGggdGhlIFF1aW50dXMuU2NlbmUgY2xhc3NcblxuICAgQG1ldGhvZCBRLnNlbGVjdFxuICAgQGZvciBRdWludHVzXG4gICovXG4gIFEuc2VsZWN0ID0gZnVuY3Rpb24oKSB7IC8qIE5vLW9wICovIH07XG5cbiAgLyoqXG4gICBEZWZhdWx0IG5vLW9wIHNlbGVjdCBtZXRob2QuIFJlcGxhY2VkIHdpdGggdGhlIFF1aW50dXMuU2NlbmUgY2xhc3NcblxuXG4gICBTeW50YXggZm9yIGluY2x1ZGluZyBvdGhlciBtb2R1bGVzIGludG8gcXVpbnR1cywgY2FuIGFjY2VwdCBhIGNvbW1hLXNlcGFyYXRlZFxuICAgbGlzdCBvZiBzdHJpbmdzLCBhbiBhcnJheSBvZiBzdHJpbmdzLCBvciBhbiBhcnJheSBvZiBhY3R1YWwgb2JqZWN0cy4gRXhhbXBsZTpcbiAgXG4gICAgICAgUS5pbmNsdWRlKFwiSW5wdXQsIFNwcml0ZXMsIFNjZW5lc1wiKVxuXG4gICBAbWV0aG9kIFEuaW5jbHVkZVxuICAgQHBhcmFtIHtTdHJpbmd9IG1vZCAtIEEgY29tbWEgc2VwYXJhdGVkIGxpc3Qgb2YgbW9kdWxlIG5hbWVzXG4gICBAcmV0dXJuIHtRdWludHVzfSByZXR1cm5zIFF1aW50dXMgaW5zdGFuY2UgZm9yIGNoYWluaW5nLlxuICAgQGZvciBRdWludHVzXG4gICovXG4gIFEubW9kdWxlcyA9IHt9XG5cbiAgUS5pbmNsdWRlID0gZnVuY3Rpb24obW9kKSB7XG4gICAgUS5fZWFjaChRLl9ub3JtYWxpemVBcmcobW9kKSxmdW5jdGlvbihuYW1lKSB7XG4gICAgICB2YXIgbSA9IFF1aW50dXNbbmFtZV0gfHwgbmFtZTtcbiAgICAgIGlmKCFRLl9pc0Z1bmN0aW9uKG0pKSB7IHRocm93IFwiSW52YWxpZCBNb2R1bGU6XCIgKyBuYW1lOyB9XG4gICAgICBRLm1vZHVsZXNbbmFtZV0gPSBtO1xuICAgICAgbShRKVxuICAgIH0pO1xuICAgIHJldHVybiBRO1xuICB9O1xuXG4gIC8qKlxuICAgQW4gaW50ZXJuYWwgdXRpbGl0eSBtZXRob2QgKHV0aWxpdHkgbWV0aG9kcyBhcmUgcHJlZml4ZWQgd2l0aCB1bmRlcnNjb3JlcylcbiAgIEl0J3MgdXNlZCB0byB0YWtlIGEgc3RyaW5nIG9mIGNvbW1hIHNlcGFyYXRlZCBuYW1lcyBhbmQgdHVybiBpdCBpbnRvIGFuIGBBcnJheWBcbiAgIG9mIG5hbWVzLiBJZiBhbiBhcnJheSBvZiBuYW1lcyBpcyBwYXNzZWQgaW4sIGl0J3MgbGVmdCBhcyBpcy4gRXhhbXBsZSB1c2FnZTpcbiAgXG4gICAgICAgUS5fbm9ybWFsaXplQXJnKFwiU3ByaXRlcywgU2NlbmVzLCBQaHlzaWNzICAgXCIpO1xuICAgICAgIC8vIHJldHVybnMgWyBcIlNwcml0ZXNcIiwgXCJTY2VuZXNcIiwgXCJQaHlzaWNzXCIgXVxuICBcbiAgIFVzZWQgYnkgYFEuaW5jbHVkZWAgYW5kIGBRLlNwcml0ZS5hZGRgIHRvIGFkZCBtb2R1bGVzIGFuZCBjb21wb25lbnRzLCByZXNwZWN0aXZlbHkuXG5cbiAgIE1vc3Qgb2YgdGhlc2UgdXRpbGl0eSBtZXRob2RzIGFyZSBhIHN1YnNldCBvZiBVbmRlcnNjb3JlLmpzLFxuICAgTW9zdCBhcmUgcHVsbGVkIGRpcmVjdGx5IGZyb20gdW5kZXJzY29yZSBhbmQgc29tZSBhcmVcbiAgIG9jY2FzaW9uYWxseSBvcHRpbWl6ZWQgZm9yIHNwZWVkIGFuZCBtZW1vcnkgdXNhZ2UgaW4gbGlldSBvZiBmbGV4aWJpbGl0eS5cblxuICAgVW5kZXJzY29yZS5qcyBpcyAoYykgMjAwOS0yMDEyIEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBJbmMuXG5cbiAgIFVuZGVyc2NvcmUgaXMgZnJlZWx5IGRpc3RyaWJ1dGFibGUgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLlxuXG4gICBodHRwOi8vdW5kZXJzY29yZWpzLm9yZ1xuXG4gICBAbWV0aG9kIFEuX25vcm1hbGl6ZUFyZ1xuICAgQHBhcmFtIHtTdHJpbmcgb3IgQXJyYXl9IGFyZyAtIEVpdGhlciBhIGNvbW1hIHNlcGFyYXRlZCBzdHJpbmcgb3IgYW4gYXJyYXlcbiAgIEByZXR1cm4ge0FycmF5fSBhcnJheSBvZiBub3JtYWxpemVkIG5hbWVzXG4gICBAZm9yIFF1aW50dXNcbiAgKi9cbiAgUS5fbm9ybWFsaXplQXJnID0gZnVuY3Rpb24oYXJnKSB7XG4gICAgaWYoUS5faXNTdHJpbmcoYXJnKSkge1xuICAgICAgYXJnID0gYXJnLnJlcGxhY2UoL1xccysvZywnJykuc3BsaXQoXCIsXCIpO1xuICAgIH1cbiAgICBpZighUS5faXNBcnJheShhcmcpKSB7XG4gICAgICBhcmcgPSBbIGFyZyBdO1xuICAgIH1cbiAgICByZXR1cm4gYXJnO1xuICB9O1xuXG5cbiAgLyoqXG4gICBFeHRlbmRzIGEgZGVzdGluYXRpb24gb2JqZWN0IHdpdGggYSBzb3VyY2Ugb2JqZWN0IChtb2RpZmllcyBkZXN0aW5hdGlvbiBvYmplY3QpXG5cbiAgIEBtZXRob2QgUS5fZXh0ZW5kXG4gICBAcGFyYW0ge09iamVjdH0gZGVzdCAtIGRlc3RpbmF0aW9uIG9iamVjdFxuICAgQHBhcmFtIHtPYmplY3R9IHNvdXJjZSAtIHNvdXJjZSBvYmplY3RcbiAgIEByZXR1cm4ge09iamVjdH0gcmV0dXJucyB0aGUgZGVzdCBvYmplY3RcbiAgIEBmb3IgUXVpbnR1c1xuICAqL1xuICBRLl9leHRlbmQgPSBmdW5jdGlvbihkZXN0LHNvdXJjZSkge1xuICAgIGlmKCFzb3VyY2UpIHsgcmV0dXJuIGRlc3Q7IH1cbiAgICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkge1xuICAgICAgZGVzdFtwcm9wXSA9IHNvdXJjZVtwcm9wXTtcbiAgICB9XG4gICAgcmV0dXJuIGRlc3Q7XG4gIH07XG5cbiAgLyoqXG4gICBSZXR1cm4gYSBzaGFsbG93IGNvcHkgb2YgYW4gb2JqZWN0LiBTdWItb2JqZWN0cyAoYW5kIHN1Yi1hcnJheXMpIGFyZSBub3QgY2xvbmVkLiAodXNlcyBleHRlbmQgaW50ZXJuYWxseSlcblxuICAgQG1ldGhvZCBRLl9jbG9uZVxuICAgQHBhcmFtIHtPYmplY3R9IG9iaiAtIG9iamVjdCB0byBjbG9uZVxuICAgQHJldHVybiB7T2JqZWN0fSBjbG9uZWQgb2JqZWN0IFxuICAgQGZvciBRdWludHVzXG4gICovXG4gIFEuX2Nsb25lID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIFEuX2V4dGVuZCh7fSxvYmopO1xuICB9O1xuXG4gICAvKipcbiAgICBNZXRob2QgdGhhdCBhZGRzIGRlZmF1bHQgcHJvcGVydGllcyBvbnRvIGFuIG9iamVjdCBvbmx5IGlmIHRoZSBrZXkgb24gZGVzdCBpcyB1bmRlZmluZWRcblxuICAgQG1ldGhvZCBRLl9kZWZhdWx0c1xuICAgQHBhcmFtIHtPYmplY3R9IGRlc3QgLSBkZXN0aW5hdGlvbiBvYmplY3RcbiAgIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgLSBzb3VyY2Ugb2JqZWN0XG4gICBAcmV0dXJuIHtPYmplY3R9IHJldHVybnMgdGhlIGRlc3Qgb2JqZWN0XG4gICBAZm9yIFF1aW50dXNcbiAgKi9cbiAgUS5fZGVmYXVsdHMgPSBmdW5jdGlvbihkZXN0LHNvdXJjZSkge1xuICAgIGlmKCFzb3VyY2UpIHsgcmV0dXJuIGRlc3Q7IH1cbiAgICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkge1xuICAgICAgaWYoZGVzdFtwcm9wXSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGRlc3RbcHJvcF0gPSBzb3VyY2VbcHJvcF07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkZXN0O1xuICB9O1xuXG4gIC8qKlxuICAgU2hvcnRjdXQgZm9yIGhhc093blByb3BlcnR5XG5cbiAgIEBtZXRob2QgUS5fZGVmYXVsdHNcbiAgIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgLSBkZXN0aW5hdGlvbiBvYmplY3RcbiAgIEBwYXJhbSB7U3RyaW5nfSBrZXkgLSBrZXkgdG8gY2hlY2sgZm9yXG4gICBAcmV0dXJuIHtCb29sZWFufSBcbiAgIEBmb3IgUXVpbnR1c1xuICAqLyBcbiAgUS5faGFzID0gZnVuY3Rpb24ob2JqLCBrZXkpIHtcbiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTtcbiAgfTtcblxuICAgLyoqXG4gICBDaGVjayBpZiBzb21ldGhpbmcgaXMgYSBzdHJpbmdcblxuICAgTk9URTogdGhpcyBmYWlscyBmb3Igbm9uLXByaW1pdGl2ZXNcblxuICAgQG1ldGhvZCBRLl9pc1N0cmluZ1xuICAgQHBhcmFtIHtWYXJ9IG9iaiAtIG9iamVjdCB0byBjaGVjayBcbiAgIEByZXR1cm4ge0Jvb2xlYW59IFxuICAgQGZvciBRdWludHVzXG4gICovXG4gIFEuX2lzU3RyaW5nID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBvYmogPT09IFwic3RyaW5nXCI7XG4gIH07XG5cbiAgLyoqXG4gICBDaGVjayBpZiBzb21ldGhpbmcgaXMgYSBudW1iZXJcblxuICAgQG1ldGhvZCBRLl9pc051bWJlclxuICAgQHBhcmFtIHtWYXJ9IG9iaiAtIG9iamVjdCB0byBjaGVjayBcbiAgIEByZXR1cm4ge0Jvb2xlYW59IFxuICAgQGZvciBRdWludHVzXG4gICovXG4gIFEuX2lzTnVtYmVyID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBOdW1iZXJdJztcbiAgfTtcblxuICAvKipcbiAgIENoZWNrIGlmIHNvbWV0aGluZyBpcyBhIGZ1bmN0aW9uXG5cbiAgIEBtZXRob2QgUS5faXNGdW5jdGlvblxuICAgQHBhcmFtIHtWYXJ9IG9iaiAtIG9iamVjdCB0byBjaGVjayBcbiAgIEByZXR1cm4ge0Jvb2xlYW59IFxuICAgQGZvciBRdWludHVzXG4gICovXG4gIFEuX2lzRnVuY3Rpb24gPSBmdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IEZ1bmN0aW9uXSc7XG4gIH07XG5cbiAgIC8qKlxuICAgQ2hlY2sgaWYgc29tZXRoaW5nIGlzIGFuIE9iamVjdFxuXG4gICBAbWV0aG9kIFEuX2lzT2JqZWN0XG4gICBAcGFyYW0ge1Zhcn0gb2JqIC0gb2JqZWN0IHRvIGNoZWNrIFxuICAgQHJldHVybiB7Qm9vbGVhbn0gXG4gICBAZm9yIFF1aW50dXNcbiAgKi8gXG4gIFEuX2lzT2JqZWN0ID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBPYmplY3RdJztcbiAgfTtcblxuICAvKipcbiAgIENoZWNrIGlmIHNvbWV0aGluZyBpcyBhbiBBcnJheVxuXG4gICBAbWV0aG9kIFEuX2lzQXJyYXlcbiAgIEBwYXJhbSB7VmFyfSBvYmogLSBvYmplY3QgdG8gY2hlY2sgXG4gICBAcmV0dXJuIHtCb29sZWFufSBcbiAgIEBmb3IgUXVpbnR1c1xuICAqLyBcbiAgUS5faXNBcnJheSA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgfTtcblxuICAvKipcbiAgIENoZWNrIGlmIHNvbWV0aGluZyBpcyB1bmRlZmluZWRcblxuICAgQG1ldGhvZCBRLl9pc1VuZGVmaW5lZFxuICAgQHBhcmFtIHtWYXJ9IG9iaiAtIG9iamVjdCB0byBjaGVjayBcbiAgIEByZXR1cm4ge0Jvb2xlYW59IFxuICAgQGZvciBRdWludHVzXG4gICovIFxuICBRLl9pc1VuZGVmaW5lZCA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiBvYmogPT09IHZvaWQgMDtcbiAgfTtcblxuICAvKipcbiAgIFJlbW92ZXMgYSBwcm9wZXJ0eSBmcm9tIGFuIG9iamVjdCBhbmQgcmV0dXJucyBpdCBpZiBpdCBleGlzdHNcblxuICAgQG1ldGhvZCBRLl9wb3BQcm9wZXJ0eVxuICAgQHBhcmFtIHtPYmplY3R9IG9iaiBcbiAgIEBwYXJhbSB7U3RyaW5nfSBwcm9wZXJ0eSAtIHByb3BlcnR5IHRvIHBvcCBvZmYgdGhlIG9iamVjdFxuICAgQHJldHVybiB7VmFyfSBwb3BwZWQgcHJvcGVydHlcbiAgIEBmb3IgUXVpbnR1c1xuICAqLyBcbiAgUS5fcG9wUHJvcGVydHkgPSBmdW5jdGlvbihvYmoscHJvcGVydHkpIHtcbiAgICB2YXIgdmFsID0gb2JqW3Byb3BlcnR5XTtcbiAgICBkZWxldGUgb2JqW3Byb3BlcnR5XTtcbiAgICByZXR1cm4gdmFsO1xuICB9O1xuXG4gIC8qKlxuICAgQmFzaWMgaXRlcmF0aW9uIG1ldGhvZC4gVGhpcyBjYW4gb2Z0ZW4gYmUgYSBwZXJmb3JtYW5jZVxuICAgaGFuZGljYXAgd2hlbiB0aGUgY2FsbGJhY2sgaXRlcmF0b3IgaXMgY3JlYXRlZCBpbmxpbmUsXG4gICBhcyB0aGlzIGxlYWRzIHRvIGxvdHMgb2YgZnVuY3Rpb25zIHRoYXQgbmVlZCB0byBiZSBHQydkLlxuICAgQmV0dGVyIGlzIHRvIGRlZmluZSB0aGUgaXRlcmF0b3IgYXMgYSBwcml2YXRlIG1ldGhvZCBzby5cbiAgIFVzZXMgdGhlIGJ1aWx0IGluIGBmb3JFYWNoYCBtZXRob2RcblxuICAgQG1ldGhvZCBRLl9lYWNoXG4gICBAcGFyYW0ge0FycmF5IG9yIE9iamVjdH0gb2JqIFxuICAgQHBhcmFtIHtGdW5jdGlvbiBpdGVyYXRvciBmdW5jdGlvbiwgYHRoaXNgIGlzIHVzZWQgZm9yIGVhY2ggb2JqZWN0XG4gICBAZm9yIFF1aW50dXNcbiAgKi8gXG4gIFEuX2VhY2ggPSBmdW5jdGlvbihvYmosaXRlcmF0b3IsY29udGV4dCkge1xuICAgIGlmIChvYmogPT0gbnVsbCkgeyByZXR1cm47IH1cbiAgICBpZiAob2JqLmZvckVhY2gpIHtcbiAgICAgIG9iai5mb3JFYWNoKGl0ZXJhdG9yLGNvbnRleHQpO1xuICAgIH0gZWxzZSBpZiAob2JqLmxlbmd0aCA9PT0gK29iai5sZW5ndGgpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gb2JqLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtpXSwgaSwgb2JqKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZm9yICh2YXIga2V5IGluIG9iaikge1xuICAgICAgICBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtrZXldLCBrZXksIG9iaik7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgSW52b2tlIHRoZSBuYW1lZCBwcm9wZXJ0eSBvbiBlYWNoIGVsZW1lbnQgb2YgdGhlIGFycmF5XG5cbiAgIEBtZXRob2QgUS5faW52b2tlXG4gICBAcGFyYW0ge0FycmF5fSBhcnIgXG4gICBAcGFyYW0ge1N0cmluZ30gcHJvcGVydHkgLSBwcm9wZXJ0eSB0byBpbnZva2VcbiAgIEBwYXJhbSB7VmFyfSBbYXJnMV1cbiAgIEBwYXJhbSB7VmFyfSBbYXJnMl1cbiAgIEBmb3IgUXVpbnR1c1xuICAqLyBcbiAgUS5faW52b2tlID0gZnVuY3Rpb24oYXJyLHByb3BlcnR5LGFyZzEsYXJnMikge1xuICAgIGlmIChhcnIgPT0gbnVsbCkgeyByZXR1cm47IH1cbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGFyci5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgIGFycltpXVtwcm9wZXJ0eV0oYXJnMSxhcmcyKTtcbiAgICB9XG4gIH07XG5cblxuXG4gIC8qKlxuICAgQmFzaWMgZGV0ZWN0aW9uIG1ldGhvZCwgcmV0dXJucyB0aGUgZmlyc3QgaW5zdGFuY2Ugd2hlcmUgdGhlXG4gICBpdGVyYXRvciByZXR1cm5zIHRydXRoeS4gXG5cbiAgIEBtZXRob2QgUS5fZGV0ZWN0XG4gICBAcGFyYW0ge0FycmF5IG9yIE9iamVjdH0gb2JqXG4gICBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRvciBcbiAgIEBwYXJhbSB7T2JqZWN0fSBjb250ZXh0XG4gICBAcGFyYW0ge1Zhcn0gW2FyZzFdXG4gICBAcGFyYW0ge1Zhcn0gW2FyZzJdXG4gICBAcmV0dXJucyB7VmFyfSBmaXJzdCB0cnV0aHkgdmFsdWVcbiAgIEBmb3IgUXVpbnR1c1xuICAqL1xuICBRLl9kZXRlY3QgPSBmdW5jdGlvbihvYmosaXRlcmF0b3IsY29udGV4dCxhcmcxLGFyZzIpIHtcbiAgICB2YXIgcmVzdWx0O1xuICAgIGlmIChvYmogPT0gbnVsbCkgeyByZXR1cm47IH1cbiAgICBpZiAob2JqLmxlbmd0aCA9PT0gK29iai5sZW5ndGgpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gb2JqLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICByZXN1bHQgPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtpXSwgaSwgYXJnMSxhcmcyKTtcbiAgICAgICAgaWYocmVzdWx0KSB7IHJldHVybiByZXN1bHQ7IH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgZm9yICh2YXIga2V5IGluIG9iaikge1xuICAgICAgICByZXN1bHQgPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtrZXldLCBrZXksIGFyZzEsYXJnMik7XG4gICAgICAgIGlmKHJlc3VsdCkgeyByZXR1cm4gcmVzdWx0OyB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgUmV0dXJucyBhIG5ldyBBcnJheSB3aXRoIGVudHJpZXMgc2V0IHRvIHRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIGl0ZXJhdG9yLlxuXG4gICBAbWV0aG9kIFEuX2RldGVjdFxuICAgQHBhcmFtIHtBcnJheSBvciBPYmplY3R9IG9ialxuICAgQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0b3IgXG4gICBAcGFyYW0ge09iamVjdH0gY29udGV4dFxuICAgQHJldHVybnMge0FycmF5fVxuICAgQGZvciBRdWludHVzXG4gICovXG4gIFEuX21hcCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHtcbiAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgIGlmIChvYmogPT0gbnVsbCkgeyByZXR1cm4gcmVzdWx0czsgfVxuICAgIGlmIChvYmoubWFwKSB7IHJldHVybiBvYmoubWFwKGl0ZXJhdG9yLCBjb250ZXh0KTsgfVxuICAgIFEuX2VhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHtcbiAgICAgIHJlc3VsdHNbcmVzdWx0cy5sZW5ndGhdID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpO1xuICAgIH0pO1xuICAgIGlmIChvYmoubGVuZ3RoID09PSArb2JqLmxlbmd0aCkgeyByZXN1bHRzLmxlbmd0aCA9IG9iai5sZW5ndGg7IH1cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfTtcblxuICAvKipcbiAgIFJldHVybnMgYSBzb3J0ZWQgY29weSBvZiB1bmlxdWUgYXJyYXkgZWxlbWVudHMgd2l0aCBudWxsIHJlbW92ZWRcblxuICAgQG1ldGhvZCBRLl91bmlxXG4gICBAcGFyYW0ge0FycmF5fSBhcnJcbiAgIEByZXR1cm5zIHtBcnJheX0gdW5pcSdkIHNvcnRlZCBjb3B5IG9mIGFycmF5XG4gICBAZm9yIFF1aW50dXNcbiAgKi9cbiAgUS5fdW5pcSA9IGZ1bmN0aW9uKGFycikge1xuICAgIGFyciA9IGFyci5zbGljZSgpLnNvcnQoKTtcblxuICAgIHZhciBvdXRwdXQgPSBbXTtcblxuICAgIHZhciBsYXN0ID0gbnVsbDtcbiAgICBmb3IodmFyIGk9MDtpPGFyci5sZW5ndGg7aSsrKSB7XG4gICAgICBpZihhcnJbaV0gIT09IHZvaWQgMCAmJiBsYXN0ICE9PSBhcnJbaV0pIHtcbiAgICAgICAgb3V0cHV0LnB1c2goYXJyW2ldKTtcbiAgICAgIH1cbiAgICAgIGxhc3QgPSBhcnJbaV07XG4gICAgfVxuICAgIHJldHVybiBvdXRwdXQ7XG4gIH07XG5cbiAgLyoqXG4gICBSZXR1cm5zIGEgbmV3IGFycmF5IHdpdGggdGhlIHNhbWUgZW50cmllcyBhcyB0aGUgc291cmNlIGJ1dCBpbiBhIHJhbmRvbSBvcmRlci5cblxuICAgQG1ldGhvZCBRLl9zaHVmZmxlXG4gICBAcGFyYW0ge0FycmF5fSBhcnJcbiAgIEByZXR1cm5zIHtBcnJheX0gY29weSBvciBhcnIgaW4gc2h1ZmZsZWQgb3JkZXJcbiAgIEBmb3IgUXVpbnR1c1xuICAqL1xuICBRLl9zaHVmZmxlID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIHNodWZmbGVkID0gW10sIHJhbmQ7XG4gICAgUS5fZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkge1xuICAgICAgcmFuZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpbmRleCArIDEpKTtcbiAgICAgIHNodWZmbGVkW2luZGV4XSA9IHNodWZmbGVkW3JhbmRdO1xuICAgICAgc2h1ZmZsZWRbcmFuZF0gPSB2YWx1ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gc2h1ZmZsZWQ7XG4gIH07XG5cblxuICAvKipcbiAgIFJldHVybiBhbiBvYmplY3QncyBrZXlzIGFzIGEgbmV3IEFycmF5XG5cbiAgIEBtZXRob2QgUS5fa2V5c1xuICAgQHBhcmFtIHtPYmplY3R9IG9ialxuICAgQHJldHVybnMge0FycmF5fVxuICAgQGZvciBRdWludHVzXG4gICovXG4gIFEuX2tleXMgPSBPYmplY3Qua2V5cyB8fCBmdW5jdGlvbihvYmopIHtcbiAgICBpZihRLl9pc09iamVjdChvYmopKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgb2JqZWN0Jyk7IH1cbiAgICB2YXIga2V5cyA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKFEuX2hhcyhvYmosIGtleSkpIHsga2V5c1trZXlzLmxlbmd0aF0gPSBrZXk7IH0gfSBcbiAgICByZXR1cm4ga2V5cztcbiAgfTtcblxuXG4gIC8qKlxuICAgUmV0dXJuIGFuIGFycmF5IGluIHRoZSByYW5nZSBmcm9tIHN0YXJ0IHRvIHN0b3AgXG5cbiAgIEBtZXRob2QgUS5fcmFuZ2VcbiAgIEBwYXJhbSB7SW50ZWdlcn0gc3RhcnRcbiAgIEBwYXJhbSB7SW50ZWdlcn0gc3RvcFxuICAgQHBhcmFtIHtJbnRlZ2VyfSBbc3RlcF1cbiAgIEByZXR1cm5zIHtBcnJheX1cbiAgIEBmb3IgUXVpbnR1c1xuICAqL1xuICBRLl9yYW5nZSA9IGZ1bmN0aW9uKHN0YXJ0LHN0b3Asc3RlcCkge1xuICAgIHN0ZXAgPSBzdGVwIHx8IDE7XG5cbiAgICB2YXIgbGVuID0gTWF0aC5tYXgoTWF0aC5jZWlsKChzdG9wIC0gc3RhcnQpIC8gc3RlcCksIDApO1xuICAgIHZhciBpZHggPSAwO1xuICAgIHZhciByYW5nZSA9IG5ldyBBcnJheShsZW4pO1xuXG4gICAgd2hpbGUoaWR4IDwgbGVuKSB7XG4gICAgICByYW5nZVtpZHgrK10gPSBzdGFydDtcbiAgICAgIHN0YXJ0ICs9IHN0ZXA7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJhbmdlO1xuXG4gIH07XG5cbiAgdmFyIGlkSW5kZXggPSAwO1xuICAvKipcbiAgIFJldHVybiBhIG5ldyB1bmlxdWUgaWRlbnRpZmllclxuXG4gICBAbWV0aG9kIFEuX3VuaXF1ZUlkXG4gICBAcmV0dXJucyB7SW50ZWdlcn1cbiAgIEBmb3IgUXVpbnR1c1xuICAqL1xuICBRLl91bmlxdWVJZCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBpZEluZGV4Kys7XG4gIH07XG5cblxuXG4gIC8qKlxuICAgT3B0aW9uc1xuICBcbiAgIERlZmF1bHQgZW5naW5lIG9wdGlvbnMgZGVmaW5pbmcgdGhlIHBhdGhzIFxuICAgd2hlcmUgaW1hZ2VzLCBhdWRpbyBhbmQgb3RoZXIgZGF0YSBmaWxlcyBzaG91bGQgYmUgZm91bmRcbiAgIHJlbGF0aXZlIHRvIHRoZSBiYXNlIEhUTUwgZmlsZS4gQXMgd2VsbCBhcyBhIGNvdXBsZSBvZiBvdGhlclxuICAgb3B0aW9ucy5cbiAgXG4gICBUaGVzZSBjYW4gYmUgb3ZlcnJpZGVuIGJ5IHBhc3NpbmcgaW4gb3B0aW9ucyB0byB0aGUgYFF1aW50dXMoKWAgXG4gICBmYWN0b3J5IG1ldGhvZCwgZm9yIGV4YW1wbGU6XG4gIFxuICAgICAgIC8vIE92ZXJyaWRlIHRoZSBpbWFnZVBhdGggdG8gZGVmYXVsdCB0byAvYXNzZXRzL2ltYWdlcy9cbiAgICAgICB2YXIgUSA9IFF1aW50dXMoeyBpbWFnZVBhdGg6IFwiL2Fzc2V0cy9pbWFnZXMvXCIgfSk7XG4gIFxuICAgSWYgeW91IGZvbGxvdyB0aGUgZGVmYXVsdCBjb252ZW50aW9uIGZyb20gdGhlIGV4YW1wbGVzLCBob3dldmVyLFxuICAgeW91IHNob3VsZCBiZSBhYmxlIHRvIGNhbGwgYFF1aW50dXMoKWAgd2l0aG91dCBhbnkgb3B0aW9ucy5cblxuICAgRGVmYXVsdCBPcHRpb25zXG5cbiAgICAgICB7XG4gICAgICAgIGltYWdlUGF0aDogXCJpbWFnZXMvXCIsXG4gICAgICAgIGF1ZGlvUGF0aDogXCJhdWRpby9cIixcbiAgICAgICAgZGF0YVBhdGg6ICBcImRhdGEvXCIsXG4gICAgICAgIGF1ZGlvU3VwcG9ydGVkOiBbICdtcDMnLCdvZ2cnIF0sXG4gICAgICAgIHNvdW5kOiB0cnVlLFxuICAgICAgICBmcmFtZVRpbWVMaW1pdDogMTAwXG4gICAgICAgfVxuXG4gICBAcHJvcGVydHkgUS5vcHRpb25zXG4gICBAdHlwZSBPYmplY3RcbiAgIEBmb3IgUXVpbnR1c1xuICAqL1xuICBRLm9wdGlvbnMgPSB7XG4gICAgaW1hZ2VQYXRoOiBcImltYWdlcy9cIixcbiAgICBhdWRpb1BhdGg6IFwiYXVkaW8vXCIsXG4gICAgZGF0YVBhdGg6ICBcImRhdGEvXCIsXG4gICAgYXVkaW9TdXBwb3J0ZWQ6IFsgJ21wMycsJ29nZycgXSxcbiAgICBzb3VuZDogdHJ1ZSxcbiAgICBmcmFtZVRpbWVMaW1pdDogMTAwLFxuICAgIGF1dG9Gb2N1czogdHJ1ZVxuICB9O1xuICBpZihvcHRzKSB7IFEuX2V4dGVuZChRLm9wdGlvbnMsb3B0cyk7IH1cblxuXG4gIC8qKlxuICAgR2FtZSBMb29wIHN1cHBvcnRcblxuICAgQnkgZGVmYXVsdCB0aGUgZW5naW5lIGRvZXNuJ3Qgc3RhcnQgYSBnYW1lIGxvb3AgdW50aWwgeW91IGFjdHVhbGx5IHRlbGwgaXQgdG8uXG4gICBVc3VhbGx5IHRoZSBsb29wIGlzIHN0YXJ0ZWQgdGhlIGZpcnN0IHRpbWUgeW91IGNhbGwgYFEuc3RhZ2VTY2VuZWAsIGJ1dCBpZiB5b3UgXG4gICBhcmVuJ3QgdXNpbmcgdGhlIGBTY2VuZXNgIG1vZHVsZSB5b3UgY2FuIGV4cGxpY2l0bHkgc3RhcnQgdGhlIGdhbWUgbG9vcCB5b3Vyc2VsZlxuICAgYW5kIGNvbnRyb2wgKipleGFjdGx5Kiogd2hhdCB0aGUgZW5naW5lIGRvZXMgZWFjaCBjeWNsZS4gRm9yIGV4YW1wbGU6XG4gIFxuICAgICAgIHZhciBRID0gUXVpbnR1cygpLnNldHVwKCk7XG4gIFxuICAgICAgIHZhciBiYWxsID0gbmV3IFEuU3ByaXRlKHsgLi4gfSk7XG4gIFxuICAgICAgIFEuZ2FtZUxvb3AoZnVuY3Rpb24oZHQpIHtcbiAgICAgICAgIFEuY2xlYXIoKTsgXG4gICAgICAgICBiYWxsLnN0ZXAoZHQpO1xuICAgICAgICAgYmFsbC5kcmF3KFEuY3R4KTtcbiAgICAgICB9KTtcbiAgXG4gICBUaGUgY2FsbGJhY2sgd2lsbCBiZSBjYWxsZWQgd2l0aCBmcmFjdGlvbiBvZiBhIHNlY29uZCB0aGF0IGhhcyBlbGFwc2VkIHNpbmNlIFxuICAgdGhlIGxhc3QgY2FsbCB0byB0aGUgbG9vcCBtZXRob2QuXG5cbiAgIEBtZXRob2QgUS5nYW1lTG9vcFxuICAgQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2tcbiAgIEBmb3IgUXVpbnR1c1xuICAqL1xuICBRLmdhbWVMb29wID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICBRLmxhc3RHYW1lTG9vcEZyYW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgICAvLyBTaG9ydCBjaXJjdWl0IHRoZSBsb29wIGNoZWNrIGluIGNhc2UgbXVsdGlwbGUgc2NlbmVzXG4gICAgLy8gYXJlIHN0YWdlZCBpbW1lZGlhdGVseVxuICAgIFEubG9vcCA9IHRydWU7IFxuXG4gICAgLy8gS2VlcCB0cmFjayBvZiB0aGUgZnJhbWUgd2UgYXJlIG9uIChzbyB0aGF0IGFuaW1hdGlvbnMgY2FuIGJlIHN5bmNlZFxuICAgIC8vIHRvIHRoZSBuZXh0IGZyYW1lKVxuICAgIFEuX2xvb3BGcmFtZSA9IDA7XG5cbiAgICAvLyBXcmFwIHRoZSBjYWxsYmFjayB0byBzYXZlIGl0IGFuZCBzdGFuZGFyZGl6ZSB0aGUgcGFzc2VkXG4gICAgLy8gaW4gdGltZS4gXG4gICAgUS5nYW1lTG9vcENhbGxiYWNrV3JhcHBlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgUS5fbG9vcEZyYW1lKys7XG4gICAgICBRLmxvb3AgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKFEuZ2FtZUxvb3BDYWxsYmFja1dyYXBwZXIpO1xuICAgICAgdmFyIGR0ID0gbm93IC0gUS5sYXN0R2FtZUxvb3BGcmFtZTtcbiAgICAgIC8qIFByZXZlbnQgZmFzdC1mb3J3YXJkaW5nIGJ5IGxpbWl0aW5nIHRoZSBsZW5ndGggb2YgYSBzaW5nbGUgZnJhbWUuICovXG4gICAgICBpZihkdCA+IFEub3B0aW9ucy5mcmFtZVRpbWVMaW1pdCkgeyBkdCA9IFEub3B0aW9ucy5mcmFtZVRpbWVMaW1pdDsgfVxuICAgICAgY2FsbGJhY2suYXBwbHkoUSxbZHQgLyAxMDAwXSk7ICBcbiAgICAgIFEubGFzdEdhbWVMb29wRnJhbWUgPSBub3c7XG4gICAgfTtcblxuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoUS5nYW1lTG9vcENhbGxiYWNrV3JhcHBlcik7XG4gICAgcmV0dXJuIFE7XG4gIH07XG5cbiAgLyoqXG4gICBQYXVzZSB0aGUgZW50aXJlIGdhbWUgYnkgY2FuY2VsaW5nIHRoZSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgY2FsbC4gSWYgeW91IHVzZSBzZXRUaW1lb3V0IG9yXG4gICBzZXRJbnRlcnZhbCBpbiB5b3VyIGdhbWUsIHRob3NlIHdpbGwsIG9mIGNvdXJzZSwga2VlcCBvbiByb2xsaW5nLi4uXG5cbiAgICBAbWV0aG9kIFEucGF1c2VHYW1lXG4gICAgQGZvciBRdWludHVzXG4gICovXG4gIFEucGF1c2VHYW1lID0gZnVuY3Rpb24oKSB7XG4gICAgaWYoUS5sb29wKSB7XG4gICAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUoUS5sb29wKTsgXG4gICAgfVxuICAgIFEubG9vcCA9IG51bGw7XG4gIH07XG5cbiAgLyoqXG4gICBVbnBhdXNlIHRoZSBnYW1lIGJ5IHJlc3RhcnRpbmcgdGhlIHJlcXVlc3RBbmltYXRpb25GcmFtZS1iYXNlZCBsb29wLlxuICAgUGF1c2UgdGhlIGVudGlyZSBnYW1lIGJ5IGNhbmNlbGluZyB0aGUgcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGNhbGwuIElmIHlvdSB1c2Ugc2V0VGltZW91dCBvclxuICAgc2V0SW50ZXJ2YWwgaW4geW91ciBnYW1lLCB0aG9zZSB3aWxsLCBvZiBjb3Vyc2UsIGtlZXAgb24gcm9sbGluZy4uLlxuXG4gICAgQG1ldGhvZCBRLnBhdXNlR2FtZVxuICAgIEBmb3IgUXVpbnR1c1xuICAqL1xuICBRLnVucGF1c2VHYW1lID0gZnVuY3Rpb24oKSB7XG4gICAgaWYoIVEubG9vcCkge1xuICAgICAgUS5sYXN0R2FtZUxvb3BGcmFtZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgUS5sb29wID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShRLmdhbWVMb29wQ2FsbGJhY2tXcmFwcGVyKTtcbiAgICB9XG4gIH07XG5cblxuICAvKipcbiAgIFRoZSBiYXNlIENsYXNzIG9iamVjdFxuICBcbiAgIFF1aW50dXMgdXNlcyB0aGUgU2ltcGxlIEphdmFTY3JpcHQgaW5oZXJpdGFuY2UgQ2xhc3Mgb2JqZWN0LCBjcmVhdGVkIGJ5XG4gICBKb2huIFJlc2lnIGFuZCBkZXNjcmliZWQgb24gaGlzIGJsb2c6IFxuICBcbiAgIFtodHRwOi8vZWpvaG4ub3JnL2Jsb2cvc2ltcGxlLWphdmFzY3JpcHQtaW5oZXJpdGFuY2UvXShodHRwOi8vZWpvaG4ub3JnL2Jsb2cvc2ltcGxlLWphdmFzY3JpcHQtaW5oZXJpdGFuY2UvKVxuICBcbiAgIFRoZSBjbGFzcyBpcyB1c2VkIHdob2xlc2FsZSwgd2l0aCB0aGUgb25seSBkaWZmZXJlbmNlcyBiZWluZyB0aGF0IGluc3RlYWRcbiAgIG9mIGFwcGVhcmluZyBpbiBhIHRvcC1sZXZlbCBuYW1lc3BhY2UsIHRoZSBgQ2xhc3NgIG9iamVjdCBpcyBhdmFpbGFibGUgYXMgXG4gICBgUS5DbGFzc2AgYW5kIGEgc2Vjb25kIGFyZ3VtZW50IG9uIHRoZSBgZXh0ZW5kYCBtZXRob2QgYWxsb3dzIGZvciBhZGRpbmdcbiAgIGNsYXNzIGxldmVsIG1ldGhvZHMgYW5kIHRoZSBjbGFzcyBuYW1lIGlzIHBhc3NlZCBpbiBhIHBhcmFtZXRlciBmb3IgaW50cm9zcGVjdGlvblxuICAgcHVycG9zZXMuXG4gIFxuICAgQ2xhc3NlcyBjYW4gYmUgY3JlYXRlZCBieSBjYWxsaW5nIGBRLkNsYXNzLmV4dGVuZChuYW1lLHsgLi4gfSlgLCBhbHRob3VnaCBtb3N0IG9mIHRoZSB0aW1lXG4gICB5b3UnbGwgd2FudCB0byB1c2Ugb25lIG9mIHRoZSBkZXJpdml0aXZlIGNsYXNzZXMsIGBRLkV2ZW50ZWRgIG9yIGBRLkdhbWVPYmplY3RgIHdoaWNoXG4gICBoYXZlIGEgbGl0dGxlIGJpdCBvZiBmdW5jdGlvbmFsaXR5IGJ1aWx0LWluLiBgUS5FdmVudGVkYCBhZGRzIGV2ZW50IGJpbmRpbmcgYW5kIFxuICAgdHJpZ2dlcmluZyBzdXBwb3J0IGFuZCBgUS5HYW1lT2JqZWN0YCBhZGRzIHN1cHBvcnQgZm9yIGNvbXBvbmVudHMgYW5kIGEgZGVzdHJveSBtZXRob2QuXG4gIFxuICAgVGhlIG1haW4gdGhpbmdzIFEuQ2xhc3MgZ2V0IHlvdSBhcmUgZWFzeSBpbmhlcml0YW5jZSwgYSBjb25zdHJ1Y3RvciBtZXRob2QgY2FsbGVkIGBpbml0KClgLFxuICAgZHluYW1pYyBhZGRpdGlvbiBvZiBhIHRoaXMuX3N1cGVyIG1ldGhvZCB3aGVuIGEgbWV0aG9kIGlzIG92ZXJsb2FkZWQgKGJlIGNhcmVmdWwgd2l0aCBcbiAgIHRoaXMgYXMgaXQgYWRkcyBzb21lIG92ZXJoZWFkIHRvIG1ldGhvZCBjYWxscy4pIENhbGxzIHRvIGBpbnN0YW5jZW9mYCBhbHNvIGFsbCBcbiAgIHdvcmsgYXMgeW91J2QgaG9wZS5cbiAgXG4gICBCeSBjb252ZW50aW9uLCBjbGFzc2VzIHNob3VsZCBiZSBhZGRlZCBvbnRvIHRvIHRoZSBgUWAgb2JqZWN0IGFuZCBjYXBpdGFsaXplZCwgc28gaWYgXG4gICB5b3Ugd2FudGVkIHRvIGNyZWF0ZSBhIG5ldyBjbGFzcyBmb3IgeW91ciBnYW1lLCB5b3UnZCB3cml0ZTpcbiAgXG4gICAgICAgUS5DbGFzcy5leHRlbmQoXCJNeUNsYXNzXCIseyAuLi4gfSk7XG4gIFxuICAgRXhhbXBsZXM6XG4gIFxuICAgICAgIFEuQ2xhc3MuZXh0ZW5kKFwiQmlyZFwiLHsgXG4gICAgICAgICBpbml0OiBmdW5jdGlvbihuYW1lKSB7IHRoaXMubmFtZSA9IG5hbWU7IH0sXG4gICAgICAgICBzcGVhazogZnVuY3Rpb24oKSB7IGNvbnNvbGUubG9nKHRoaXMubmFtZSk7IH0sXG4gICAgICAgICBmbHk6IGZ1bmN0aW9uKCkgICB7IGNvbnNvbGUubG9nKFwiRmx5aW5nXCIpOyB9XG4gICAgICAgfSk7XG4gIFxuICAgICAgIFEuQmlyZC5leHRlbmQoXCJQZW5ndWluXCIse1xuICAgICAgICAgc3BlYWs6IGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZyh0aGlzLm5hbWUgKyBcIiB0aGUgcGVuZ3VpblwiKTsgfSxcbiAgICAgICAgIGZseTogZnVuY3Rpb24oKSAgIHsgY29uc29sZS5sb2coXCJDYW4ndCBmbHksIHNvcnJ5Li4uXCIpOyB9XG4gICAgICAgfSk7XG4gIFxuICAgICAgIHZhciByYW5kb21CaXJkID0gbmV3IFEuQmlyZChcIkZyYW5rXCIpLFxuICAgICAgICAgICBwZW5neSAgICAgID0gbmV3IFEuUGVuZ3VpbihcIlBlbmd5XCIpO1xuICBcbiAgICAgICByYW5kb21CaXJkLmZseSgpOyAvLyBMb2dzIFwiRmx5aW5nXCJcbiAgICAgICBwZW5neS5mbHkoKTsgICAgICAvLyBMb2dzIFwiQ2FuJ3QgZmx5LHNvcnJ5Li4uXCJcbiAgXG4gICAgICAgcmFuZG9tQmlyZC5zcGVhaygpOyAvLyBMb2dzIFwiRnJhbmtcIlxuICAgICAgIHBlbmd5LnNwZWFrKCk7ICAgICAgLy8gTG9ncyBcIlBlbmd5IHRoZSBwZW5ndWluXCJcbiAgXG4gICAgICAgY29uc29sZS5sb2cocmFuZG9tQmlyZCBpbnN0YW5jZW9mIFEuQmlyZCk7ICAgIC8vIHRydWUgXG4gICAgICAgY29uc29sZS5sb2cocmFuZG9tQmlyZCBpbnN0YW5jZW9mIFEuUGVuZ3Vpbik7IC8vIGZhbHNlXG4gICAgICAgY29uc29sZS5sb2cocGVuZ3kgaW5zdGFuY2VvZiBRLkJpcmQpOyAgICAgICAgIC8vIHRydWUgXG4gICAgICAgY29uc29sZS5sb2cocGVuZ3kgaW5zdGFuY2VvZiBRLlBlbmd1aW4pOyAgICAgIC8vIHRydWUgXG5cbiAgU2ltcGxlIEphdmFTY3JpcHQgSW5oZXJpdGFuY2VcbiAgQnkgSm9obiBSZXNpZyBodHRwOi8vZWpvaG4ub3JnL1xuICBNSVQgTGljZW5zZWQuXG4gIFxuICBJbnNwaXJlZCBieSBiYXNlMiBhbmQgUHJvdG90eXBlXG4gIEBjbGFzcyBRLkNsYXNzXG4gIEBmb3IgUXVpbnR1c1xuICAqL1xuICAoZnVuY3Rpb24oKXtcbiAgICB2YXIgaW5pdGlhbGl6aW5nID0gZmFsc2UsIFxuICAgICAgICBmblRlc3QgPSAveHl6Ly50ZXN0KGZ1bmN0aW9uKCl7IHZhciB4eXo7fSkgPyAvXFxiX3N1cGVyXFxiLyA6IC8uKi87XG4gICAgLyoqIFRoZSBiYXNlIENsYXNzIGltcGxlbWVudGF0aW9uIChkb2VzIG5vdGhpbmcpIFxuICAgICAqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGZvciBRLkNsYXNzXG4gICAgICovXG4gICAgUS5DbGFzcyA9IGZ1bmN0aW9uKCl7fTtcblxuICAgIC8qKlxuICAgICAqIFNlZSBpZiBhIG9iamVjdCBpcyBhIHNwZWNpZmljIGNsYXNzXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGlzQVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWUgLSBjbGFzcyB0byBjaGVjayBhZ2FpbnN0XG4gICAgICovXG4gICAgUS5DbGFzcy5wcm90b3R5cGUuaXNBID0gZnVuY3Rpb24oY2xhc3NOYW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy5jbGFzc05hbWUgPT09IGNsYXNzTmFtZTtcbiAgICB9O1xuICAgIFxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBDbGFzcyB0aGF0IGluaGVyaXRzIGZyb20gdGhpcyBjbGFzcyBcbiAgICAgKlxuICAgICAqIEBtZXRob2QgZXh0ZW5kXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGNsYXNzTmFtZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwcm9wZXJ0aWVzIC0gaGFzaCBvZiBwcm9wZXJ0aWVzIChpbml0IHdpbGwgYmUgdGhlIGNvbnN0cnVjdG9yKVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbY2xhc3NNZXRob2RzXSAtIG9wdGlvbmFsIGNsYXNzIG1ldGhvZHMgdG8gYWRkIHRvIHRoZSBjbGFzc1xuICAgICAqL1xuICAgIFEuQ2xhc3MuZXh0ZW5kID0gZnVuY3Rpb24oY2xhc3NOYW1lLCBwcm9wLCBjbGFzc01ldGhvZHMpIHtcbiAgICAgIC8qIE5vIG5hbWUsIGRvbid0IGFkZCBvbnRvIFEgKi9cbiAgICAgIGlmKCFRLl9pc1N0cmluZyhjbGFzc05hbWUpKSB7XG4gICAgICAgIGNsYXNzTWV0aG9kcyA9IHByb3A7XG4gICAgICAgIHByb3AgPSBjbGFzc05hbWU7XG4gICAgICAgIGNsYXNzTmFtZSA9IG51bGw7XG4gICAgICB9XG4gICAgICB2YXIgX3N1cGVyID0gdGhpcy5wcm90b3R5cGUsXG4gICAgICAgICAgVGhpc0NsYXNzID0gdGhpcztcbiAgICAgIFxuICAgICAgLyogSW5zdGFudGlhdGUgYSBiYXNlIGNsYXNzIChidXQgb25seSBjcmVhdGUgdGhlIGluc3RhbmNlLCAqL1xuICAgICAgLyogZG9uJ3QgcnVuIHRoZSBpbml0IGNvbnN0cnVjdG9yKSAqL1xuICAgICAgaW5pdGlhbGl6aW5nID0gdHJ1ZTtcbiAgICAgIHZhciBwcm90b3R5cGUgPSBuZXcgVGhpc0NsYXNzKCk7XG4gICAgICBpbml0aWFsaXppbmcgPSBmYWxzZTtcblxuICAgICAgZnVuY3Rpb24gX3N1cGVyRmFjdG9yeShuYW1lLGZuKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgdG1wID0gdGhpcy5fc3VwZXI7XG5cbiAgICAgICAgICAvKiBBZGQgYSBuZXcgLl9zdXBlcigpIG1ldGhvZCB0aGF0IGlzIHRoZSBzYW1lIG1ldGhvZCAqL1xuICAgICAgICAgIC8qIGJ1dCBvbiB0aGUgc3VwZXItY2xhc3MgKi9cbiAgICAgICAgICB0aGlzLl9zdXBlciA9IF9zdXBlcltuYW1lXTtcblxuICAgICAgICAgIC8qIFRoZSBtZXRob2Qgb25seSBuZWVkIHRvIGJlIGJvdW5kIHRlbXBvcmFyaWx5LCBzbyB3ZSAqL1xuICAgICAgICAgIC8qIHJlbW92ZSBpdCB3aGVuIHdlJ3JlIGRvbmUgZXhlY3V0aW5nICovXG4gICAgICAgICAgdmFyIHJldCA9IGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7ICAgICAgICBcbiAgICAgICAgICB0aGlzLl9zdXBlciA9IHRtcDtcblxuICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8qIENvcHkgdGhlIHByb3BlcnRpZXMgb3ZlciBvbnRvIHRoZSBuZXcgcHJvdG90eXBlICovXG4gICAgICBmb3IgKHZhciBuYW1lIGluIHByb3ApIHtcbiAgICAgICAgLyogQ2hlY2sgaWYgd2UncmUgb3ZlcndyaXRpbmcgYW4gZXhpc3RpbmcgZnVuY3Rpb24gKi9cbiAgICAgICAgcHJvdG90eXBlW25hbWVdID0gdHlwZW9mIHByb3BbbmFtZV0gPT09IFwiZnVuY3Rpb25cIiAmJiBcbiAgICAgICAgICB0eXBlb2YgX3N1cGVyW25hbWVdID09PSBcImZ1bmN0aW9uXCIgJiYgXG4gICAgICAgICAgICBmblRlc3QudGVzdChwcm9wW25hbWVdKSA/IFxuICAgICAgICAgICAgICBfc3VwZXJGYWN0b3J5KG5hbWUscHJvcFtuYW1lXSkgOiBcbiAgICAgICAgICAgICAgcHJvcFtuYW1lXTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLyogVGhlIGR1bW15IGNsYXNzIGNvbnN0cnVjdG9yICovXG4gICAgICBmdW5jdGlvbiBDbGFzcygpIHtcbiAgICAgICAgLyogQWxsIGNvbnN0cnVjdGlvbiBpcyBhY3R1YWxseSBkb25lIGluIHRoZSBpbml0IG1ldGhvZCAqL1xuICAgICAgICBpZiAoICFpbml0aWFsaXppbmcgJiYgdGhpcy5pbml0ICkge1xuICAgICAgICAgIHRoaXMuaW5pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8qIFBvcHVsYXRlIG91ciBjb25zdHJ1Y3RlZCBwcm90b3R5cGUgb2JqZWN0ICovXG4gICAgICBDbGFzcy5wcm90b3R5cGUgPSBwcm90b3R5cGU7XG4gICAgICBcbiAgICAgIC8qIEVuZm9yY2UgdGhlIGNvbnN0cnVjdG9yIHRvIGJlIHdoYXQgd2UgZXhwZWN0ICovXG4gICAgICBDbGFzcy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBDbGFzcztcbiAgICAgIC8qIEFuZCBtYWtlIHRoaXMgY2xhc3MgZXh0ZW5kYWJsZSAqL1xuICAgICAgQ2xhc3MuZXh0ZW5kID0gUS5DbGFzcy5leHRlbmQ7XG4gICAgICBcbiAgICAgIC8qIElmIHRoZXJlIGFyZSBjbGFzcy1sZXZlbCBNZXRob2RzLCBhZGQgdGhlbSB0byB0aGUgY2xhc3MgKi9cbiAgICAgIGlmKGNsYXNzTWV0aG9kcykge1xuICAgICAgICBRLl9leHRlbmQoQ2xhc3MsY2xhc3NNZXRob2RzKTtcbiAgICAgIH1cblxuICAgICAgaWYoY2xhc3NOYW1lKSB7IFxuICAgICAgICAvKiBTYXZlIHRoZSBjbGFzcyBvbnRvIFEgKi9cbiAgICAgICAgUVtjbGFzc05hbWVdID0gQ2xhc3M7XG5cbiAgICAgICAgLyogTGV0IHRoZSBjbGFzcyBrbm93IGl0cyBuYW1lICovXG4gICAgICAgIENsYXNzLnByb3RvdHlwZS5jbGFzc05hbWUgPSBjbGFzc05hbWU7XG4gICAgICAgIENsYXNzLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIENsYXNzO1xuICAgIH07XG4gIH0oKSk7XG4gICAgXG5cbiAgLy8gRXZlbnQgSGFuZGxpbmdcbiAgLy8gPT09PT09PT09PT09PT1cblxuICAvKipcbiAgIFRoZSBgUS5FdmVudGVkYCBjbGFzcyBhZGRzIGV2ZW50IGhhbmRsaW5nIG9udG8gdGhlIGJhc2UgYFEuQ2xhc3NgIFxuICAgY2xhc3MuIFEuRXZlbnRlZCBvYmplY3RzIGNhbiB0cmlnZ2VyIGV2ZW50cyBhbmQgb3RoZXIgb2JqZWN0cyBjYW5cbiAgIGJpbmQgdG8gdGhvc2UgZXZlbnRzLlxuXG4gICBAY2xhc3MgUS5FdmVudGVkXG4gICBAZXh0ZW5kcyBRLkNsYXNzXG4gICBAZm9yIFF1aW50dXNcbiAgKi9cbiAgUS5DbGFzcy5leHRlbmQoXCJFdmVudGVkXCIse1xuXG4gICAgLyoqXG4gICAgQmluZHMgYSBjYWxsYmFjayB0byBhbiBldmVudCBvbiB0aGlzIG9iamVjdC4gSWYgeW91IHByb3ZpZGUgYVxuICAgIGB0YXJnZXRgIG9iamVjdCwgdGhhdCBvYmplY3Qgd2lsbCBhZGQgdGhpcyBldmVudCB0byBpdCdzIGxpc3Qgb2ZcbiAgICBiaW5kcywgYWxsb3dpbmcgaXQgdG8gYXV0b21hdGljYWxseSByZW1vdmUgaXQgd2hlbiBpdCBpcyBkZXN0cm95ZWQuXG5cbiAgICBAbWV0aG9kIG9uXG4gICAgQGZvciBRLkV2ZW50ZWRcbiAgICBAcGFyYW0ge1N0cmluZ30gZXZlbnQgLSBuYW1lIG9yIGNvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIGV2ZW50c1xuICAgIEBwYXJhbSB7T2JqZWN0fSBbdGFyZ2V0XSAtIG9wdGlvbmFsIGNvbnRleHQgZm9yIGNhbGxiYWNrLCBkZWZhdWx0cyB0byB0aGUgRXZlbnRlZFxuICAgIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10gLSBjYWxsYmFjayAob3B0aW9uYWwgLSBkZWZhdWx0cyB0byBuYW1lIG9mIGV2ZW50IG9uIGNvbnRleHRcbiAgICAqL1xuICAgIG9uOiBmdW5jdGlvbihldmVudCx0YXJnZXQsY2FsbGJhY2spIHtcbiAgICAgIGlmKFEuX2lzQXJyYXkoZXZlbnQpIHx8IGV2ZW50LmluZGV4T2YoXCIsXCIpICE9PSAtMSkge1xuICAgICAgICBldmVudCA9IFEuX25vcm1hbGl6ZUFyZyhldmVudCk7XG4gICAgICAgIGZvcih2YXIgaT0wO2k8ZXZlbnQubGVuZ3RoO2krKykge1xuICAgICAgICAgIHRoaXMub24oZXZlbnRbaV0sdGFyZ2V0LGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGVyZSBpcyBubyB0YXJnZXQgcHJvdmlkZWQsXG4gICAgICAvLyBzd2FwcGluZyB0aGUgdGFyZ2V0IGFuZCBjYWxsYmFjayBwYXJhbWV0ZXJzLlxuICAgICAgaWYoIWNhbGxiYWNrKSB7XG4gICAgICAgIGNhbGxiYWNrID0gdGFyZ2V0O1xuICAgICAgICB0YXJnZXQgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiB0aGVyZSdzIHN0aWxsIG5vIGNhbGxiYWNrLCBkZWZhdWx0IHRvIHRoZSBldmVudCBuYW1lXG4gICAgICBpZighY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2sgPSBldmVudDtcbiAgICAgIH1cbiAgICAgIC8vIEhhbmRsZSBjYXNlIGZvciBjYWxsYmFjayB0aGF0IGlzIGEgc3RyaW5nLCB0aGlzIHdpbGxcbiAgICAgIC8vIHB1bGwgdGhlIGNhbGxiYWNrIGZyb20gdGhlIHRhcmdldCBvYmplY3Qgb3IgZnJvbSB0aGlzXG4gICAgICAvLyBvYmplY3QuXG4gICAgICBpZihRLl9pc1N0cmluZyhjYWxsYmFjaykpIHtcbiAgICAgICAgY2FsbGJhY2sgPSAodGFyZ2V0IHx8IHRoaXMpW2NhbGxiYWNrXTtcbiAgICAgIH1cblxuICAgICAgLy8gVG8ga2VlcCBgUS5FdmVudGVkYCBvYmplY3RzIGZyb20gbmVlZGluZyBhIGNvbnN0cnVjdG9yLFxuICAgICAgLy8gdGhlIGBsaXN0ZW5lcnNgIG9iamVjdCBpcyBjcmVhdGVkIG9uIHRoZSBmbHkgYXMgbmVlZGVkLlxuICAgICAgLy8gYGxpc3RlbmVyc2Aga2VlcHMgYSBsaXN0IG9mIGNhbGxiYWNrcyBpbmRleGVkIGJ5IGV2ZW50IG5hbWVcbiAgICAgIC8vIGZvciBxdWljayBsb29rdXAuIFxuICAgICAgdGhpcy5saXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVycyB8fCB7fTtcbiAgICAgIHRoaXMubGlzdGVuZXJzW2V2ZW50XSA9IHRoaXMubGlzdGVuZXJzW2V2ZW50XSB8fCBbXTtcbiAgICAgIHRoaXMubGlzdGVuZXJzW2V2ZW50XS5wdXNoKFsgdGFyZ2V0IHx8IHRoaXMsIGNhbGxiYWNrXSk7XG5cbiAgICAgIC8vIFdpdGggYSBwcm92aWRlZCB0YXJnZXQsIHRoZSB0YXJnZXQgb2JqZWN0IGtlZXBzIHRyYWNrIG9mXG4gICAgICAvLyB0aGUgZXZlbnRzIGl0IGlzIGJvdW5kIHRvLCB3aGljaCBhbGxvd3MgZm9yIGF1dG9tYXRpYyBcbiAgICAgIC8vIHVuYmluZGluZyBvbiBkZXN0cm95LlxuICAgICAgaWYodGFyZ2V0KSB7XG4gICAgICAgIGlmKCF0YXJnZXQuYmluZHMpIHsgdGFyZ2V0LmJpbmRzID0gW107IH1cbiAgICAgICAgdGFyZ2V0LmJpbmRzLnB1c2goW3RoaXMsZXZlbnQsY2FsbGJhY2tdKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIFRyaWdnZXJzIGFuIGV2ZW50LCBwYXNzaW5nIGluIHNvbWUgb3B0aW9uYWwgYWRkaXRpb25hbCBkYXRhIGFib3V0XG4gICAgIHRoZSBldmVudC4gXG5cbiAgICBAbWV0aG9kIHRyaWdnZXJcbiAgICBAZm9yIFEuRXZlbnRlZFxuICAgIEBwYXJhbSB7U3RyaW5nfSBldmVudCAtIG5hbWUgb2YgZXZlbnRcbiAgICBAcGFyYW0ge09iamVjdH0gW2RhdGFdIC0gb3B0aW9uYWwgZGF0YSB0byBwYXNzIHRvIHRoZSBjYWxsYmFja1xuICAgICovXG4gICAgdHJpZ2dlcjogZnVuY3Rpb24oZXZlbnQsZGF0YSkge1xuICAgICAgLy8gRmlyc3QgbWFrZSBzdXJlIHRoZXJlIGFyZSBhbnkgbGlzdGVuZXJzLCB0aGVuIGNoZWNrIGZvciBhbnkgbGlzdGVuZXJzXG4gICAgICAvLyBvbiB0aGlzIHNwZWNpZmljIGV2ZW50LCBpZiBub3QsIGVhcmx5IG91dC5cbiAgICAgIGlmKHRoaXMubGlzdGVuZXJzICYmIHRoaXMubGlzdGVuZXJzW2V2ZW50XSkge1xuICAgICAgICAvLyBDYWxsIGVhY2ggbGlzdGVuZXIgaW4gdGhlIGNvbnRleHQgb2YgZWl0aGVyIHRoZSB0YXJnZXQgcGFzc2VkIGludG9cbiAgICAgICAgLy8gYG9uYCBvciB0aGUgb2JqZWN0IGl0c2VsZi5cbiAgICAgICAgZm9yKHZhciBpPTAsbGVuID0gdGhpcy5saXN0ZW5lcnNbZXZlbnRdLmxlbmd0aDtpPGxlbjtpKyspIHtcbiAgICAgICAgICB2YXIgbGlzdGVuZXIgPSB0aGlzLmxpc3RlbmVyc1tldmVudF1baV07XG4gICAgICAgICAgbGlzdGVuZXJbMV0uY2FsbChsaXN0ZW5lclswXSxkYXRhKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICBVbmJpbmRzIGFuIGV2ZW50LiBDYW4gYmUgY2FsbGVkIHdpdGggMSwgMiwgb3IgMyBwYXJhbWV0ZXJzLCBlYWNoIFxuICAgICAgIG9mIHdoaWNoIHVuYmluZHMgYSBtb3JlIHNwZWNpZmljIGxpc3RlbmVyLlxuXG4gICAgQG1ldGhvZCBvZmZcbiAgICBAZm9yIFEuRXZlbnRlZFxuICAgIEBwYXJhbSB7U3RyaW5nfSBldmVudCAtIG5hbWUgb2YgZXZlbnRcbiAgICBAcGFyYW0ge09iamVjdH0gW3RhcmdldF0gLSBvcHRpb25hbGx5IGxpbWl0IHRvIGEgc3BlY2lmaWMgdGFyZ2V0XG4gICAgQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrXSAtIG9wdGlvbmFsbHkgbGltaXQgdG8gb25lIHNwZWNpZmljIGNhbGxiYWNrXG4gICAgKi9cbiAgICBvZmY6IGZ1bmN0aW9uKGV2ZW50LHRhcmdldCxjYWxsYmFjaykge1xuICAgICAgLy8gV2l0aG91dCBhIHRhcmdldCwgcmVtb3ZlIGFsbCB0ZWggbGlzdGVuZXJzLlxuICAgICAgaWYoIXRhcmdldCkge1xuICAgICAgICBpZih0aGlzLmxpc3RlbmVyc1tldmVudF0pIHtcbiAgICAgICAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNbZXZlbnRdO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiB0aGUgY2FsbGJhY2sgaXMgYSBzdHJpbmcsIGZpbmQgYSBtZXRob2Qgb2YgdGhlXG4gICAgICAgIC8vIHNhbWUgbmFtZSBvbiB0aGUgdGFyZ2V0LlxuICAgICAgICBpZihRLl9pc1N0cmluZyhjYWxsYmFjaykgJiYgdGFyZ2V0W2NhbGxiYWNrXSkge1xuICAgICAgICAgIGNhbGxiYWNrID0gdGFyZ2V0W2NhbGxiYWNrXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbCA9IHRoaXMubGlzdGVuZXJzICYmIHRoaXMubGlzdGVuZXJzW2V2ZW50XTtcbiAgICAgICAgaWYobCkge1xuICAgICAgICAgIC8vIExvb3AgZnJvbSB0aGUgZW5kIHRvIHRoZSBiZWdpbm5pbmcsIHdoaWNoIGFsbG93cyB1c1xuICAgICAgICAgIC8vIHRvIHJlbW92ZSBlbGVtZW50cyB3aXRob3V0IGhhdmluZyB0byBhZmZlY3QgdGhlIGxvb3AuXG4gICAgICAgICAgZm9yKHZhciBpID0gbC5sZW5ndGgtMTtpPj0wO2ktLSkge1xuICAgICAgICAgICAgaWYobFtpXVswXSA9PT0gdGFyZ2V0KSB7XG4gICAgICAgICAgICAgIGlmKCFjYWxsYmFjayB8fCBjYWxsYmFjayA9PT0gbFtpXVsxXSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdGVuZXJzW2V2ZW50XS5zcGxpY2UoaSwxKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKiogXG4gICAgIGBkZWJpbmRgIGlzIGNhbGxlZCB0byByZW1vdmUgYW55IGxpc3RlbmVycyBhbiBvYmplY3QgaGFkXG4gICAgIG9uIG90aGVyIG9iamVjdHMuIFRoZSBtb3N0IGNvbW1vbiBjYXNlIGlzIHdoZW4gYW4gb2JqZWN0IGlzXG4gICAgIGRlc3Ryb3llZCB5b3UnbGwgd2FudCBhbGwgdGhlIGV2ZW50IGxpc3RlbmVycyB0byBiZSByZW1vdmVkXG4gICAgIGZvciB5b3UuXG5cbiAgICBAbWV0aG9kIGRlYmluZFxuICAgIEBmb3IgUS5FdmVudGVkXG4gICAgKi9cbiAgICBkZWJpbmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgIGlmKHRoaXMuYmluZHMpIHtcbiAgICAgICAgIGZvcih2YXIgaT0wLGxlbj10aGlzLmJpbmRzLmxlbmd0aDtpPGxlbjtpKyspIHtcbiAgICAgICAgICAgdmFyIGJvdW5kRXZlbnQgPSB0aGlzLmJpbmRzW2ldLFxuICAgICAgICAgICAgICAgc291cmNlID0gYm91bmRFdmVudFswXSxcbiAgICAgICAgICAgICAgIGV2ZW50ID0gYm91bmRFdmVudFsxXTtcbiAgICAgICAgICAgc291cmNlLm9mZihldmVudCx0aGlzKTtcbiAgICAgICAgIH1cbiAgICAgICB9XG4gICAgIH1cblxuICAgfSk7XG5cblxuICAgXG5cblxuICAvKipcbiAgIFRoZSBtYXN0ZXIgbGlzdCBvZiByZWdpc3RlcmVkIGNvbXBvbmVudHMsIGluZGV4ZWQgaW4gYW4gb2JqZWN0IGJ5IG5hbWUuXG5cbiAgIEBwcm9wZXJ0eSBRLmNvbXBvbmVudHNcbiAgIEB0eXBlIE9iamVjdFxuICAgQGZvciBRdWludHVzXG4gICovXG4gIFEuY29tcG9uZW50cyA9IHt9O1xuXG4gIC8qKlxuICAgQ29tcG9uZW50c1xuICAgPT09PT09PT09PT09PT1cbiAgXG4gICBDb21wb25lbnRzIGFyZSBzZWxmLWNvbnRhaW5lZCBwaWVjZXMgb2YgZnVuY3Rpb25hbGl0eSB0aGF0IGNhbiBiZSBhZGRlZCBvbnRvIGFuZCByZW1vdmVkXG4gICBmcm9tIG9iamVjdHMuIFRoZSBhbGxvdyBmb3IgYSBtb3JlIGR5bmFtaWMgZnVuY3Rpb25hbGl0eSB0cmVlIHRoYW4gdXNpbmcgaW5oZXJpdGFuY2UgKGkuZS5cbiAgIGJ5IGZhdm9yaW5nIGNvbXBvc2l0aW9uIG92ZXIgaW5oZXJpdGFuY2UpIGFuZCBhcmUgYWRkZWQgYW5kIHJlbW92ZWQgb24gdGhlIGZseSBhdCBydW50aW1lLlxuICAgKHllcywgSSBrbm93IGV2ZXJ5dGhpbmcgaW4gSlMgaXMgYXQgcnVudGltZSwgYnV0IHlvdSBrbm93IHdoYXQgSSBtZWFuLCBnZWV6KVxuICBcbiAgIENvbWJpbmluZyBjb21wb25lbnRzIHdpdGggZXZlbnRzIG1ha2VzIGl0IGVhc3kgdG8gY3JlYXRlIHJldXNhYmxlIHBpZWNlcyBvZlxuICAgZnVuY3Rpb25hbGl0eSB0aGF0IGNhbiBiZSBkZWNvdXBsZWQgZnJvbSBlYWNoIG90aGVyLlxuXG4gICBUaGUgYmFzZSBjbGFzcyBmb3IgY29tcG9uZW50cy4gVGhlc2UgYXJlIHVzdWFsbHkgbm90IGRlcml2ZWQgZGlyZWN0bHkgYnV0IGFyZSBpbnN0ZWFkXG4gICBjcmVhdGVkIGJ5IGNhbGxpbmcgYFEucmVnaXN0ZXJgIHRvIHJlZ2lzdGVyIGEgbmV3IGNvbXBvbmVudCBnaXZlbiBhIHNldCBvZiBtZXRob2RzIHRoZSBcbiAgIGNvbXBvbmVudCBzdXBwb3J0cy4gQ29tcG9uZW50cyBhcmUgY3JlYXRlZCBhdXRvbWF0aWNhbGx5IHdoZW4gdGhleSBhcmUgYWRkZWQgdG8gYSBcbiAgIGBRLkdhbWVPYmplY3RgIHdpdGggdGhlIGBhZGRgIG1ldGhvZC5cbiAgXG4gICBNYW55IGNvbXBvbmVudHMgYWxzbyBkZWZpbmUgYW4gYGFkZGVkYCBtZXRob2QsIHdoaWNoIGlzIGNhbGxlZCBhdXRvbWF0aWNhbGx5IGJ5IHRoZVxuICAgYGluaXRgIGNvbnN0cnVjdG9yIGFmdGVyIGEgY29tcG9uZW50IGhhcyBiZWVuIGFkZGVkIHRvIGFuIG9iamVjdC4gVGhpcyBpcyBhIGdvb2QgdGltZVxuICAgdG8gYWRkIGV2ZW50IGxpc3RlbmVycyBvbiB0aGUgb2JqZWN0LlxuXG4gICBAY2xhc3MgUS5Db21wb25lbnRcbiAgIEBldmVudHMgUS5FdmVudGVkXG4gICBAZm9yIFF1aW50dXNcbiAgKi9cbiAgUS5FdmVudGVkLmV4dGVuZChcIkNvbXBvbmVudFwiLHtcblxuICAgIC8vIENvbXBvbmVudHMgYXJlIGNyZWF0ZWQgd2hlbiB0aGV5IGFyZSBhZGRlZCBvbnRvIGEgYFEuR2FtZU9iamVjdGAgZW50aXR5LiBUaGUgZW50aXR5XG4gICAgLy8gaXMgZGlyZWN0bHkgZXh0ZW5kZWQgd2l0aCBhbnkgbWV0aG9kcyBpbnNpZGUgb2YgYW4gYGV4dGVuZGAgcHJvcGVydHkgYW5kIHRoZW4gdGhlIFxuICAgIC8vIGNvbXBvbmVudCBpdHNlbGYgaXMgYWRkZWQgb250byB0aGUgZW50aXR5IGFzIHdlbGwuIFxuICAgIGluaXQ6IGZ1bmN0aW9uKGVudGl0eSkge1xuICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XG4gICAgICBpZih0aGlzLmV4dGVuZCkgeyBRLl9leHRlbmQoZW50aXR5LHRoaXMuZXh0ZW5kKTsgICB9XG4gICAgICBlbnRpdHlbdGhpcy5uYW1lXSA9IHRoaXM7XG5cbiAgICAgIGVudGl0eS5hY3RpdmVDb21wb25lbnRzLnB1c2godGhpcy5jb21wb25lbnROYW1lKTtcblxuICAgICAgaWYoZW50aXR5LnN0YWdlICYmIGVudGl0eS5zdGFnZS5hZGRUb0xpc3QpIHtcbiAgICAgICAgZW50aXR5LnN0YWdlLmFkZFRvTGlzdCh0aGlzLmNvbXBvbmVudE5hbWUsZW50aXR5KTtcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMuYWRkZWQpIHsgdGhpcy5hZGRlZCgpOyB9ICAgIFxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgYGRlc3Ryb3lgIGlzIGNhbGxlZCBhdXRvbWF0aWNhbGx5IHdoZW4gYSBjb21wb25lbnQgaXMgcmVtb3ZlZCBmcm9tIGFuIGVudGl0eS4gSXQgaXMgXG4gICAgIG5vdCBjYWxsZWQsIGhvd2V2ZXIsIHdoZW4gYW4gZW50aXR5IGlzIGRlc3Ryb3llZCAoZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMpLlxuICAgICBcbiAgICAgSXQncyBqb2IgaXMgdG8gcmVtb3ZlIGFueSBtZXRob2RzIHRoYXQgd2VyZSBhZGRlZCB3aXRoIGBleHRlbmRgIGFuZCB0aGVuIHJlbW92ZSBhbmRcbiAgICAgZGViaW5kIGl0c2VsZiBmcm9tIHRoZSBlbnRpdHkuIEl0IHdpbGwgYWxzbyBjYWxsIGBkZXN0cm95ZWRgIGlmIHRoZSBjb21wb25lbnQgaGFzXG4gICAgIGEgbWV0aG9kIGJ5IHRoYXQgbmFtZS5cblxuICAgICBAbWV0aG9kIGRlc3Ryb3lcbiAgICAgQGZvciBRLkNvbXBvbmVudFxuICAgICovXG4gICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XG4gICAgICBpZih0aGlzLmV4dGVuZCkge1xuICAgICAgICB2YXIgZXh0ZW5zaW9ucyA9IFEuX2tleXModGhpcy5leHRlbmQpO1xuICAgICAgICBmb3IodmFyIGk9MCxsZW49ZXh0ZW5zaW9ucy5sZW5ndGg7aTxsZW47aSsrKSB7XG4gICAgICAgICAgZGVsZXRlIHRoaXMuZW50aXR5W2V4dGVuc2lvbnNbaV1dO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBkZWxldGUgdGhpcy5lbnRpdHlbdGhpcy5uYW1lXTtcbiAgICAgIHZhciBpZHggPSB0aGlzLmVudGl0eS5hY3RpdmVDb21wb25lbnRzLmluZGV4T2YodGhpcy5jb21wb25lbnROYW1lKTtcbiAgICAgIGlmKGlkeCAhPT0gLTEpIHsgXG4gICAgICAgIHRoaXMuZW50aXR5LmFjdGl2ZUNvbXBvbmVudHMuc3BsaWNlKGlkeCwxKTtcblxuICAgICAgICBpZih0aGlzLmVudGl0eS5zdGFnZSAmJiB0aGlzLmVudGl0eS5zdGFnZS5hZGRUb0xpc3QpIHtcbiAgICAgICAgICB0aGlzLmVudGl0eS5zdGFnZS5hZGRUb0xpc3RzKHRoaXMuY29tcG9uZW50TmFtZSx0aGlzLmVudGl0eSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuZGViaW5kKCk7XG4gICAgICBpZih0aGlzLmRlc3Ryb3llZCkgeyB0aGlzLmRlc3Ryb3llZCgpOyB9XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgIFxuICAgIEdhbWUgT2JqZWN0c1xuICAgID09PT09PT09PT09PVxuXG4gICBUaGlzIGlzIHRoZSBiYXNlIGNsYXNzIG1vc3QgUXVpbnR1cyBvYmplY3RzIGFyZSBkZXJpdmVkIGZyb20sIGl0IGV4dGVuZHMgXG4gICBgUS5FdmVudGVkYCBhbmQgYWRkcyBjb21wb25lbnQgc3VwcG9ydCB0byBhbiBvYmplY3QsIGFsbG93aW5nIGNvbXBvbmVudHMgdG9cbiAgIGJlIGFkZGVkIGFuZCByZW1vdmVkIGZyb20gYW4gb2JqZWN0LiBJdCBhbHNvIGRlZmluZXMgYSBkZXN0cm95ZWQgbWV0aG9kXG4gICB3aGljaCB3aWxsIGRlYmluZCB0aGUgb2JqZWN0LCByZW1vdmUgaXQgZnJvbSBpdCdzIHBhcmVudCAodXN1YWxseSBhIHNjZW5lKVxuICAgaWYgaXQgaGFzIG9uZSwgYW5kIHRyaWdnZXIgYSBkZXN0cm95ZWQgZXZlbnQuXG5cbiAgIEBjbGFzcyBRLkdhbWVPYmplY3RcbiAgIEBleHRlbmRzIFEuRXZlbnRlZFxuICAgQGZvciBRdWludHVzXG4gICovXG4gIFEuRXZlbnRlZC5leHRlbmQoXCJHYW1lT2JqZWN0XCIse1xuXG4gICAgLyoqXG4gICAgIFNpbXBsZSBjaGVjayB0byBzZWUgaWYgYSBjb21wb25lbnQgYWxyZWFkeSBleGlzdHNcbiAgICAgb24gYW4gb2JqZWN0IGJ5IHNlYXJjaGluZyBmb3IgYSBwcm9wZXJ0eSBvZiB0aGUgc2FtZSBuYW1lLlxuXG4gICAgIEBtZXRob2QgaGFzXG4gICAgIEBmb3IgUS5HYW1lT2JqZWN0XG4gICAgIEBwYXJhbSB7U3RyaW5nfSBjb21wb25lbnQgLSBuYW1lIG9mIGNvbXBvbmVudCB0byB0ZXN0IGFnYWluc3RcbiAgICAgQHJldHVybnMge0Jvb2xlYW59XG4gICAgKi9cbiAgICBoYXM6IGZ1bmN0aW9uKGNvbXBvbmVudCkge1xuICAgICAgcmV0dXJuIHRoaXNbY29tcG9uZW50XSA/IHRydWUgOiBmYWxzZTsgXG4gICAgfSxcblxuICAgIC8qKlxuICAgICBBZGRzIG9uZSBvciBtb3JlIGNvbXBvbmVudHMgdG8gYW4gb2JqZWN0LiBBY2NlcHRzIGVpdGhlciBcbiAgICAgYSBjb21tYSBzZXBhcmF0ZWQgc3RyaW5nIG9yIGFuIGFycmF5IG9mIHN0cmluZ3MgdGhhdCBtYXBcbiAgICAgdG8gY29tcG9uZW50IG5hbWVzLlxuICAgIFxuICAgICBJbnN0YW50aWF0ZXMgYSBuZXcgY29tcG9uZW50IG9iamVjdCBvZiB0aGUgY29ycmVjdCB0eXBlXG4gICAgIChpZiB0aGUgY29tcG9uZW50IGV4aXN0cykgYW5kIHRoZW4gdHJpZ2dlcnMgYW4gYWRkQ29tcG9uZW50XG4gICAgIGV2ZW50LlxuXG4gICAgIEZvciBleGFtcGxlOlxuXG4gICAgICAgICB0aGlzLmFkZChcIjJkLCBhaUJvdW5jZVwiKVxuICAgIFxuICAgICBSZXR1cm5zIHRoZSBvYmplY3QgdG8gYWxsb3cgY2hhaW5pbmcuXG5cbiAgICAgQGZvciBRLkdhbWVPYmplY3RcbiAgICAgQG1ldGhvZCBhZGRcbiAgICAgQHBhcmFtIHtTdHJpbmd9IGNvbXBvbmVudHMgLSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBjb21wb25lbnRzIHRvIGFkZFxuICAgICBAcmV0dXJuIHtPYmplY3R9IHJldHVybnMgdGhpcyBmb3IgY2hhaW5pbmcgcHVycG9zZXNcbiAgICAqL1xuICAgIGFkZDogZnVuY3Rpb24oY29tcG9uZW50cykge1xuICAgICAgY29tcG9uZW50cyA9IFEuX25vcm1hbGl6ZUFyZyhjb21wb25lbnRzKTtcbiAgICAgIGlmKCF0aGlzLmFjdGl2ZUNvbXBvbmVudHMpIHsgdGhpcy5hY3RpdmVDb21wb25lbnRzID0gW107IH1cbiAgICAgIGZvcih2YXIgaT0wLGxlbj1jb21wb25lbnRzLmxlbmd0aDtpPGxlbjtpKyspIHtcbiAgICAgICAgdmFyIG5hbWUgPSBjb21wb25lbnRzW2ldLFxuICAgICAgICAgICAgQ29tcCA9IFEuY29tcG9uZW50c1tuYW1lXTtcbiAgICAgICAgaWYoIXRoaXMuaGFzKG5hbWUpICYmIENvbXApIHsgXG4gICAgICAgICAgdmFyIGMgPSBuZXcgQ29tcCh0aGlzKTsgXG4gICAgICAgICAgdGhpcy50cmlnZ2VyKCdhZGRDb21wb25lbnQnLGMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LCBcblxuICAgIC8qKlxuICAgICBSZW1vdmVzIG9uZSBvciBtb3JlIGNvbXBvbmVudHMgZnJvbSBhbiBvYmplY3QuIEFjY2VwdHMgdGhlXG4gICAgIHNhbWUgc3R5bGUgb2YgcGFyYW1ldGVycyBhcyBgYWRkYC4gVHJpZ2dlcnMgYSBkZWxDb21wb25lbnQgZXZlbnRcbiAgICAgYW5kIGFuZCBjYWxscyBkZXN0cm95IG9uIHRoZSBjb21wb25lbnQuXG4gICAgXG4gICAgIFJldHVybnMgdGhlIGVsZW1lbnQgdG8gYWxsb3cgY2hhaW5pbmcuXG5cbiAgICAgQGZvciBRLkdhbWVPYmplY3RcbiAgICAgQG1ldGhvZCBkZWxcbiAgICAgQHBhcmFtIHtTdHJpbmd9IGNvbXBvbmVudHMgLSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBjb21wb25lbnRzIHRvIHJlbW92ZVxuICAgICBAcmV0dXJuIHtPYmplY3R9IHJldHVybnMgdGhpcyBmb3IgY2hhaW5pbmcgcHVycG9zZXNcbiAgICAqL1xuICAgIGRlbDogZnVuY3Rpb24oY29tcG9uZW50cykge1xuICAgICAgY29tcG9uZW50cyA9IFEuX25vcm1hbGl6ZUFyZyhjb21wb25lbnRzKTtcbiAgICAgIGZvcih2YXIgaT0wLGxlbj1jb21wb25lbnRzLmxlbmd0aDtpPGxlbjtpKyspIHtcbiAgICAgICAgdmFyIG5hbWUgPSBjb21wb25lbnRzW2ldO1xuICAgICAgICBpZihuYW1lICYmIHRoaXMuaGFzKG5hbWUpKSB7IFxuICAgICAgICAgIHRoaXMudHJpZ2dlcignZGVsQ29tcG9uZW50Jyx0aGlzW25hbWVdKTtcbiAgICAgICAgICB0aGlzW25hbWVdLmRlc3Ryb3koKTsgXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgRGVzdHJveXMgdGhlIG9iamVjdCBieSBjYWxsaW5nIGRlYmluZCBhbmQgcmVtb3ZpbmcgdGhlXG4gICAgIG9iamVjdCBmcm9tIGl0J3MgcGFyZW50LiBXaWxsIHRyaWdnZXIgYSBkZXN0cm95ZWQgZXZlbnRcbiAgICAgY2FsbGJhY2suXG5cbiAgICAgQGZvciBRLkdhbWVPYmplY3RcbiAgICAgQG1ldGhvZCBkZWxcbiAgICAgQHBhcmFtIHtTdHJpbmd9IGNvbXBvbmVudHMgLSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBjb21wb25lbnRzIHRvIHJlbW92ZVxuICAgICBAcmV0dXJuIHtPYmplY3R9IHJldHVybnMgdGhpcyBmb3IgY2hhaW5pbmcgcHVycG9zZXNcbiAgICAqL1xuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYodGhpcy5pc0Rlc3Ryb3llZCkgeyByZXR1cm47IH1cbiAgICAgIHRoaXMudHJpZ2dlcignZGVzdHJveWVkJyk7XG4gICAgICB0aGlzLmRlYmluZCgpO1xuICAgICAgaWYodGhpcy5zdGFnZSAmJiB0aGlzLnN0YWdlLnJlbW92ZSkge1xuICAgICAgICB0aGlzLnN0YWdlLnJlbW92ZSh0aGlzKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuaXNEZXN0cm95ZWQgPSB0cnVlO1xuICAgICAgaWYodGhpcy5kZXN0cm95ZWQpIHsgdGhpcy5kZXN0cm95ZWQoKTsgfVxuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICBSZWdpc3RlcnMgYSBjb21wb25lbnQgd2l0aCB0aGUgZW5naW5lLCBtYWtpbmcgaXQgYXZhaWxhYmxlIHRvIGBRLkdhbWVPYmplY3RgJ3MgXG4gICBUaGlzIGNyZWF0ZXMgYSBuZXcgZGVzY2VuZGVudCBjbGFzcyBvZiBgUS5Db21wb25lbnRgIHdpdGggbmV3IG1ldGhvZHMgYWRkZWQgaW4uXG5cbiAgIEBmb3IgUXVpbnR1c1xuICAgQG1ldGhvZCBRLmNvbXBvbmVudFxuICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUgLSBjb21wb25lbnQgbmFtZVxuICAgQHBhcmFtIHtPYmplY3R9IG1ldGVob2RzIC0gaGFzaCBvZiBtZXRob2RzIGZvciB0aGUgY29tcG9uZW50XG4gICovXG4gIFEuY29tcG9uZW50ID0gZnVuY3Rpb24obmFtZSxtZXRob2RzKSB7XG4gICAgaWYoIW1ldGhvZHMpIHsgcmV0dXJuIFEuY29tcG9uZW50c1tuYW1lXTsgfVxuICAgIG1ldGhvZHMubmFtZSA9IG5hbWU7XG4gICAgbWV0aG9kcy5jb21wb25lbnROYW1lID0gXCIuXCIgKyBuYW1lO1xuICAgIHJldHVybiAoUS5jb21wb25lbnRzW25hbWVdID0gUS5Db21wb25lbnQuZXh0ZW5kKG5hbWUgKyBcIkNvbXBvbmVudFwiLG1ldGhvZHMpKTtcbiAgfTtcblxuXG4gIC8qKlxuICAgR2VuZXJpYyBHYW1lIFN0YXRlIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvXG4gICB0cmFjayBvZiB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgR2FtZSwgZm9yIGV4YW1wbGUgd2hlbiB0aGUgcGxheWVyIHN0YXJ0c1xuICAgYSBuZXcgZ2FtZSB5b3UgbWlnaHQgd2FudCB0byBrZWVwIHRyYWNrIG9mIHRoZWlyIHNjb3JlIGFuZCByZW1haW5pbmcgbGl2ZXM6XG4gIFxuICAgICAgIFEucmVzZXQoeyBzY29yZTogMCwgbGl2ZXM6IDIgfSk7XG4gIFxuICAgVGhlbiBpbiB5b3VyIGdhbWUgbWlnaHQgd2FudCB0byBhZGQgdG8gdGhlIHNjb3JlOlxuICAgICAgIFxuICAgICAgICBRLnN0YXRlLmluYyhcInNjb3JlXCIsNTApO1xuICBcbiAgIEluIHlvdXIgaHVkLCB5b3UgY2FuIGxpc3RlbiBmb3IgY2hhbmdlIGV2ZW50cyBvbiB0aGUgc3RhdGUgdG8gdXBkYXRlIHlvdXIgXG4gICBkaXNwbGF5OlxuICBcbiAgICAgICAgUS5zdGF0ZS5vbihcImNoYW5nZS5zY29yZVwiLGZ1bmN0aW9uKCkgeyAuLiB1cGRhdGUgdGhlIHNjb3JlIGRpc3BsYXkgLi4gfSk7XG4gIFxuICBAY2xhc3MgUS5HYW1lU3RhdGVcbiAgQGV4dGVuZHMgUS5HYW1lT2JqZWN0XG4gICovXG4gIFEuR2FtZU9iamVjdC5leHRlbmQoXCJHYW1lU3RhdGVcIix7XG4gICAgaW5pdDogZnVuY3Rpb24ocCkge1xuICAgICAgdGhpcy5wID0gUS5fZXh0ZW5kKHt9LHApO1xuICAgICAgdGhpcy5saXN0ZW5lcnMgPSB7fTtcbiAgICB9LFxuXG5cbiAgICAvKipcbiAgICAgUmVzZXRzIHRoZSBzdGF0ZSB0byB2YWx1ZSBwLCB0cmlnZ2VycyBhIHJlc2V0IGV2ZW50LlxuXG4gICAgIEBtZXRob2QgcmVzZXRcbiAgICAgQHBhcmFtIHtPYmplY3R9IHAgLSBwcm9wZXJ0aWVzIHRvIHJlaW5pdGlhbGl6ZSB0b1xuICAgICovXG4gICAgcmVzZXQ6IGZ1bmN0aW9uKHApIHsgdGhpcy5pbml0KHApOyB0aGlzLnRyaWdnZXIoXCJyZXNldFwiKTsgfSxcbiAgICBcbiAgICAvLyBJbnRlcm5hbCBoZWxwZXIgbWV0aG9kIHRvIHNldCBhbiBpbmRpdmlkdWFsIHByb3BlcnR5XG4gICAgX3RyaWdnZXJQcm9wZXJ0eTogZnVuY3Rpb24odmFsdWUsa2V5KSB7XG4gICAgICBpZih0aGlzLnBba2V5XSAhPT0gdmFsdWUpIHtcbiAgICAgICAgdGhpcy5wW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgdGhpcy50cmlnZ2VyKFwiY2hhbmdlLlwiICsga2V5LHZhbHVlKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIFNldCBvbmUgb3IgbW9yZSBwcm9wZXJ0aWVzLCB0cmlnZ2VyIGV2ZW50cyBvbiB0aG9zZVxuICAgICBwcm9wZXJ0aWVzIGNoYW5naW5nLlxuXG4gICAgIEBleGFtcGxlXG4gICAgICAgIFEuc3RhdGUuc2V0KHsgbGl2ZXM6IDUsIGhpdFBvaW50czogNCB9KTtcbiAgICAgICAgLy8gVHJpZ2dlcnMgMyBldmVudHM6IGNoYW5nZS5saXZlcywgY2hhbmdlLmhpdFBvaW50cywgY2hhbmdlXG5cblxuICAgICAgICBRLnN0YXRlLnNldChcImxpdmVzXCIsNSk7XG4gICAgICAgIC8vIFRyaWdnZXJzIDIgZXZlbnRzOiBjaGFuZ2UubGl2ZXMsIGNoYW5nZVxuXG4gICAgQG1ldGhvZCBzZXRcbiAgICBAcGFyYW0ge09iamVjdCBvciBTdHJpbmd9IHByb3BlcnRpZXMgLSBoYXNoIG9mIHByb3BlcnRpZXMgdG8gc2V0LCBvciBwcm9wZXJ0eSBuYW1lXG4gICAgQHBhcmFtIHtWYXJ9IFt2YWx1ZV0gLSBpZiBzZXR0aW5nIDEgcHJvcGVydHksIHRoZSB2YWx1ZSBvZiB0aGF0IHByb3BlcnR5XG4gICAgKi9cbiAgICBzZXQ6IGZ1bmN0aW9uKHByb3BlcnRpZXMsdmFsdWUpIHtcbiAgICAgIGlmKFEuX2lzT2JqZWN0KHByb3BlcnRpZXMpKSB7XG4gICAgICAgIFEuX2VhY2gocHJvcGVydGllcyx0aGlzLl90cmlnZ2VyUHJvcGVydHksdGhpcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl90cmlnZ2VyUHJvcGVydHkodmFsdWUscHJvcGVydGllcyk7XG4gICAgICB9XG4gICAgICB0aGlzLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICBJbmNyZW1lbnQgYW4gaW5kaXZpZHVhbCBwcm9wZXJ0eSBieSBhbW91bnQsIHVzZXMgc2V0IGludGVybmFsbHlcblxuICAgICBAbWV0aG9kIGluY1xuICAgICBAcGFyYW0ge1N0cmluZ30gcHJvcGVydHlcbiAgICAgQHBhcmFtIHtJbnRlZ2VyfSBhbW91bnQgLSBhbW91bnQgdG8gaW5jcmVtZW50IGJ5XG4gICAgKi9cbiAgICBpbmM6IGZ1bmN0aW9uKHByb3BlcnR5LGFtb3VudCkge1xuICAgICAgdGhpcy5zZXQocHJvcGVydHksdGhpcy5nZXQocHJvcGVydHkpICsgYW1vdW50KTtcbiAgICB9LFxuXG4gICAgLyoqXG5cbiAgICAgSW5jcmVtZW50IGFuIGluZGl2aWR1YWwgcHJvcGVydHkgYnkgYW1vdW50LCB1c2VzIHNldCBpbnRlcm5hbGx5XG5cbiAgICAgQG1ldGhvZCBkZWNcbiAgICAgQHBhcmFtIHtTdHJpbmd9IHByb3BlcnR5XG4gICAgIEBwYXJhbSB7SW50ZWdlcn0gYW1vdW50IC0gYW1vdW50IHRvIGRlY3JlbWVudCBieVxuICAgICovXG4gICAgZGVjOiBmdW5jdGlvbihwcm9wZXJ0eSxhbW91bnQpIHtcbiAgICAgIHRoaXMuc2V0KHByb3BlcnR5LHRoaXMuZ2V0KHByb3BlcnR5KSAtIGFtb3VudCk7XG4gICAgfSxcblxuICAgIC8qKlxuXG4gICAgIFJldHVybiBhbiBpbmRpdmlkdWFsIHByb3BlcnR5XG5cbiAgICAgQG1ldGhvZCBnZXRcbiAgICAgQHBhcmFtIHtTdHJpbmd9IHByb3BlcnR5IFxuICAgICBAcmV0dXJuIHtWYXJ9IHZhbHVlIG9mIHRoZSBwcm9wZXJ0eVxuICAgICovXG4gICAgZ2V0OiBmdW5jdGlvbihwcm9wZXJ0eSkge1xuICAgICAgcmV0dXJuIHRoaXMucFtwcm9wZXJ0eV07XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgIFRvcC1sZXZlbCBgUS5HYW1lU3RhdGVgIGluc3RhbmNlLCBnZW5lcmFsbHkgdXNlZCBmb3IgZ2xvYmFsIHN0YXRlIGluIHRoZSBnYW1lXG5cbiAgIEBmb3IgUXVpbnR1c1xuICAgQHByb3BlcnR5IFEuc3RhdGVcbiAgIEB0eXBlIFEuR2FtZVN0YXRlXG4gICovXG4gIFEuc3RhdGUgPSBuZXcgUS5HYW1lU3RhdGUoKTtcblxuICAvKiogXG4gICBSZXNldCB0aGUgZ2xvYmFsIGdhbWUgc3RhdGVcblxuICAgQGZvciBRdWludHVzXG4gICBAbWV0aG9kIFEucmVzZXRcbiAgKi9cbiAgUS5yZXNldCA9IGZ1bmN0aW9uKCkgeyBRLnN0YXRlLnJlc2V0KCk7IH07XG5cblxuXG5cbiAgUS50b3VjaERldmljZSA9ICgnb250b3VjaHN0YXJ0JyBpbiBkb2N1bWVudCk7XG5cbiAgLyoqXG4gIFxuICAgQ2FudmFzIE1ldGhvZHNcbiAgIFxuICAgVGhlIGBzZXR1cGAgYW5kIGBjbGVhcmAgbWV0aG9kIGFyZSB0aGUgb25seSB0d28gY2FudmFzLXNwZWNpZmljIG1ldGhvZHMgaW4gXG4gICB0aGUgY29yZSBvZiBRdWludHVzLiBgaW1hZ2VEYXRhYCAgYWxzbyB1c2VzIGNhbnZhcyBidXQgaXQgY2FuIGJlIHVzZWQgaW5cbiAgIGFueSB0eXBlIG9mIGdhbWUuXG5cbiAgIFNldHVwIHdpbGwgZWl0aGVyIGNyZWF0ZSBhIG5ldyBjYW52YXMgZWxlbWVudCBhbmQgYXBwZW5kIGl0XG4gICB0byB0aGUgYm9keSBvZiB0aGUgZG9jdW1lbnQgb3IgdXNlIGFuIGV4aXN0aW5nIG9uZS4gSXQgd2lsbCB0aGVuXG4gICBwdWxsIG91dCB0aGUgd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgY2FudmFzIGZvciBlbmdpbmUgdXNlLlxuICBcbiAgIEl0IGFsc28gYWRkcyBhIHdyYXBwZXIgY29udGFpbmVyIGFyb3VuZCB0aGUgZWxlbWVudC5cbiAgXG4gICBJZiB0aGUgYG1heGltaXplYCBpcyBzZXQgdG8gdHJ1ZSwgdGhlIGNhbnZhcyBlbGVtZW50IGlzIG1heGltaXplZFxuICAgb24gdGhlIHBhZ2UgYW5kIHRoZSBzY3JvbGwgdHJpY2sgaXMgdXNlZCB0byB0cnkgdG8gZ2V0IHRoZSBhZGRyZXNzIGJhciBhd2F5LlxuICBcbiAgIFRoZSBlbmdpbmUgd2lsbCBhbHNvIHJlc2FtcGxlIHRoZSBnYW1lIHRvIENTUyBkaW1lbnNpb25zIGF0IHR3aWNlIHBpeGVsXG4gICBkaW1lbnNpb25zIGlmIHRoZSBgcmVzYW1wbGVXaWR0aGAgb3IgYHJlc2FtcGxlSGVpZ2h0YCBvcHRpb25zIGFyZSBzZXQuXG4gIFxuICAgVE9ETzogYWRkIHN1cHBvcnQgZm9yIGF1dG8tcmVzaXplIHcvIGVuZ2luZSBldmVudCBub3RpZmljYXRpb25zXG5cbiAgIEF2YWlsYWJsZSBvcHRpb25zOlxuXG4gICAgICAge1xuICAgICAgICB3aWR0aDogMzIwLCAgLy8gd2lkdGggb2YgY3JlYXRlZCBjYW52YXNcbiAgICAgICAgaGVpZ2h0OiA0MjAsIC8vIGhlaWdodCBvZiBjcmVhdGVkIGNhbnZhc1xuICAgICAgICBtYXhpbWl6ZTogZmFsc2UgLy8gc2V0IHRvIHRydWUgdG8gbWF4aW1pemUgdG8gc2NyZWVuLCBcInRvdWNoXCIgdG8gbWF4aW1pemUgb24gdG91Y2ggZGV2aWNlc1xuICAgICAgIH1cblxuICAgQGZvciBRdWludHVzXG4gICBAbWV0aG9kIFEuc2V0dXBcbiAgIEBwYXJhbSB7U3RyaW5nfSBbaWQ9XCJxdWludHVzXCJdIC0gaWQgb2YgdGhlIGNhbnZhcyBlbGVtZW50IHRvIHRyaWdnZXIgcXVpbnR1cyBvblxuICAgQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAtIG9wdGlvbnMgaGFzaFxuXG4gICovXG4gIFEuc2V0dXAgPSBmdW5jdGlvbihpZCwgb3B0aW9ucykge1xuICAgIGlmKFEuX2lzT2JqZWN0KGlkKSkge1xuICAgICAgb3B0aW9ucyA9IGlkO1xuICAgICAgaWQgPSBudWxsO1xuICAgIH1cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICBpZCA9IGlkIHx8IFwicXVpbnR1c1wiO1xuXG4gICAgaWYoUS5faXNTdHJpbmcoaWQpKSB7XG4gICAgICBRLmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBRLmVsID0gaWQ7XG4gICAgfVxuXG4gICAgaWYoIVEuZWwpIHtcbiAgICAgIFEuZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgUS5lbC53aWR0aCA9IG9wdGlvbnMud2lkdGggfHwgMzIwO1xuICAgICAgUS5lbC5oZWlnaHQgPSBvcHRpb25zLmhlaWdodCB8fCA0MjA7XG4gICAgICBRLmVsLmlkID0gaWQ7XG5cbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoUS5lbCk7XG4gICAgfVxuXG4gICAgdmFyIHcgPSBwYXJzZUludChRLmVsLndpZHRoLDEwKSxcbiAgICAgICAgaCA9IHBhcnNlSW50KFEuZWwuaGVpZ2h0LDEwKTtcblxuICAgIHZhciBtYXhXaWR0aCA9IG9wdGlvbnMubWF4V2lkdGggfHwgNTAwMCxcbiAgICAgICAgbWF4SGVpZ2h0ID0gb3B0aW9ucy5tYXhIZWlnaHQgfHwgNTAwMCxcbiAgICAgICAgcmVzYW1wbGVXaWR0aCA9IG9wdGlvbnMucmVzYW1wbGVXaWR0aCxcbiAgICAgICAgcmVzYW1wbGVIZWlnaHQgPSBvcHRpb25zLnJlc2FtcGxlSGVpZ2h0LFxuICAgICAgICB1cHNhbXBsZVdpZHRoID0gb3B0aW9ucy51cHNhbXBsZVdpZHRoLFxuICAgICAgICB1cHNhbXBsZUhlaWdodCA9IG9wdGlvbnMudXBzYW1wbGVIZWlnaHQ7XG5cbiAgICBpZihvcHRpb25zLm1heGltaXplID09PSB0cnVlIHx8IChRLnRvdWNoRGV2aWNlICYmIG9wdGlvbnMubWF4aW1pemUgPT09ICd0b3VjaCcpKSAge1xuICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5wYWRkaW5nID0gMDtcbiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUubWFyZ2luID0gMDtcblxuICAgICAgdyA9IG9wdGlvbnMud2lkdGggfHwgTWF0aC5taW4od2luZG93LmlubmVyV2lkdGgsbWF4V2lkdGgpIC0gKChvcHRpb25zLnBhZ2VzY3JvbGwpPzE3OjApO1xuICAgICAgaCA9IG9wdGlvbnMuaGVpZ2h0IHx8IE1hdGgubWluKHdpbmRvdy5pbm5lckhlaWdodCAtIDUsbWF4SGVpZ2h0KTtcblxuICAgICAgaWYoUS50b3VjaERldmljZSkge1xuICAgICAgICBRLmVsLnN0eWxlLmhlaWdodCA9IChoKjIpICsgXCJweFwiO1xuICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwxKTtcblxuICAgICAgICB3ID0gTWF0aC5taW4od2luZG93LmlubmVyV2lkdGgsbWF4V2lkdGgpO1xuICAgICAgICBoID0gTWF0aC5taW4od2luZG93LmlubmVySGVpZ2h0LG1heEhlaWdodCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmKFEudG91Y2hEZXZpY2UpIHtcbiAgICAgIHdpbmRvdy5zY3JvbGxUbygwLDEpO1xuICAgIH1cblxuICAgIGlmKCh1cHNhbXBsZVdpZHRoICYmIHcgPD0gdXBzYW1wbGVXaWR0aCkgfHxcbiAgICAgICAodXBzYW1wbGVIZWlnaHQgJiYgaCA8PSB1cHNhbXBsZUhlaWdodCkpIHtcbiAgICAgIFEuZWwuc3R5bGUuaGVpZ2h0ID0gaCArIFwicHhcIjtcbiAgICAgIFEuZWwuc3R5bGUud2lkdGggPSB3ICsgXCJweFwiO1xuICAgICAgUS5lbC53aWR0aCA9IHcgKiAyO1xuICAgICAgUS5lbC5oZWlnaHQgPSBoICogMjtcbiAgICB9XG4gICAgZWxzZSBpZigoKHJlc2FtcGxlV2lkdGggJiYgdyA+IHJlc2FtcGxlV2lkdGgpIHx8XG4gICAgICAgIChyZXNhbXBsZUhlaWdodCAmJiBoID4gcmVzYW1wbGVIZWlnaHQpKSAmJiBcbiAgICAgICBRLnRvdWNoRGV2aWNlKSB7IFxuICAgICAgUS5lbC5zdHlsZS5oZWlnaHQgPSBoICsgXCJweFwiO1xuICAgICAgUS5lbC5zdHlsZS53aWR0aCA9IHcgKyBcInB4XCI7XG4gICAgICBRLmVsLndpZHRoID0gdyAvIDI7XG4gICAgICBRLmVsLmhlaWdodCA9IGggLyAyO1xuICAgIH0gZWxzZSB7XG4gICAgICBRLmVsLnN0eWxlLmhlaWdodCA9IGggKyBcInB4XCI7XG4gICAgICBRLmVsLnN0eWxlLndpZHRoID0gdyArIFwicHhcIjtcbiAgICAgIFEuZWwud2lkdGggPSB3O1xuICAgICAgUS5lbC5oZWlnaHQgPSBoO1xuICAgIH1cblxuICAgIHZhciBlbFBhcmVudCA9IFEuZWwucGFyZW50Tm9kZTtcblxuICAgIGlmKGVsUGFyZW50KSB7XG4gICAgICBRLndyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgUS53cmFwcGVyLmlkID0gUS5lbC5pZCArICdfY29udGFpbmVyJztcbiAgICAgIFEud3JhcHBlci5zdHlsZS53aWR0aCA9IHcgKyBcInB4XCI7XG4gICAgICBRLndyYXBwZXIuc3R5bGUubWFyZ2luID0gXCIwIGF1dG9cIjtcbiAgICAgIFEud3JhcHBlci5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcblxuXG4gICAgICBlbFBhcmVudC5pbnNlcnRCZWZvcmUoUS53cmFwcGVyLFEuZWwpO1xuICAgICAgUS53cmFwcGVyLmFwcGVuZENoaWxkKFEuZWwpO1xuICAgIH1cbiAgICBcbiAgICBRLmVsLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcblxuICAgIFEuY3R4ID0gUS5lbC5nZXRDb250ZXh0ICYmIFxuICAgICAgICAgICAgUS5lbC5nZXRDb250ZXh0KFwiMmRcIik7XG5cblxuICAgIFEud2lkdGggPSBwYXJzZUludChRLmVsLndpZHRoLDEwKTtcbiAgICBRLmhlaWdodCA9IHBhcnNlSW50KFEuZWwuaGVpZ2h0LDEwKTtcbiAgICBRLmNzc1dpZHRoID0gdztcbiAgICBRLmNzc0hlaWdodCA9IGg7XG5cbiAgICAvL3NjYWxlIHRvIGZpdFxuICAgIGlmKG9wdGlvbnMuc2NhbGVUb0ZpdCkge1xuICAgICAgdmFyIGZhY3RvciA9IDE7XG5cbiAgICAgIHZhciB3aW5XID0gd2luZG93LmlubmVyV2lkdGgqZmFjdG9yO1xuICAgICAgdmFyIHdpbkggPSB3aW5kb3cuaW5uZXJIZWlnaHQqZmFjdG9yO1xuICAgICAgdmFyIHdpblJhdGlvID0gd2luVy93aW5IOyAgICBcbiAgICAgIHZhciBnYW1lUmF0aW8gPSBRLmVsLndpZHRoL1EuZWwuaGVpZ2h0O1xuICAgICAgdmFyIHNjYWxlUmF0aW8gPSBnYW1lUmF0aW8gPCB3aW5SYXRpbyA/IHdpbkgvUS5lbC5oZWlnaHQgOiB3aW5XL1EuZWwud2lkdGg7XG4gICAgICB2YXIgc2NhbGVkVyA9IFEuZWwud2lkdGggKiBzY2FsZVJhdGlvO1xuICAgICAgdmFyIHNjYWxlZEggPSBRLmVsLmhlaWdodCAqIHNjYWxlUmF0aW87XG5cbiAgICAgIFEuZWwuc3R5bGUud2lkdGggPSBzY2FsZWRXICsgXCJweFwiOyBcbiAgICAgIFEuZWwuc3R5bGUuaGVpZ2h0ID0gc2NhbGVkSCArIFwicHhcIjsgXG5cbiAgICAgIGlmKFEuZWwucGFyZW50Tm9kZSkge1xuICAgICAgICBRLmVsLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSBzY2FsZWRXICsgXCJweFwiOyBcbiAgICAgICAgUS5lbC5wYXJlbnROb2RlLnN0eWxlLmhlaWdodCA9IHNjYWxlZEggKyBcInB4XCI7IFxuICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICBRLmNzc1dpZHRoID0gcGFyc2VJbnQoc2NhbGVkVywxMCk7XG4gICAgICBRLmNzc0hlaWdodCA9IHBhcnNlSW50KHNjYWxlZEgsMTApOyAgICAgXG5cbiAgICAgIC8vY2VudGVyIHZlcnRpY2FsbHkgd2hlbiBhZGp1c3RpbmcgdG8gd2lkdGhcbiAgICAgIGlmKGdhbWVSYXRpbyA+IHdpblJhdGlvKSB7XG4gICAgICAgIHZhciB0b3BQb3MgPSAod2luSCAtIHNjYWxlZEgpLzI7ICAgICAgICAgIFxuICAgICAgICBRLmVsLnN0eWxlLnRvcCA9IHRvcFBvcysncHgnO1xuICAgICAgfVxuICAgIH0gICBcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsZnVuY3Rpb24oKSB7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyB3aW5kb3cuc2Nyb2xsVG8oMCwxKTsgfSwgMCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gUTtcbiAgfTtcblxuXG4gIC8qKlxuICAgQ2xlYXIgdGhlIGNhbnZhcyBjb21wbGV0ZWx5LlxuXG4gICBJZiB5b3Ugd2FudCBpdCBjbGVhcmVkIHRvIGEgc3BlY2lmaWMgY29sb3IgLSBzZXQgYFEuY2xlYXJDb2xvcmAgdG8gdGhhdCBjb2xvclxuXG4gICBAbWV0aG9kIFEuY2xlYXJcbiAgIEBmb3IgUXVpbnR1c1xuICAqL1xuICBRLmNsZWFyID0gZnVuY3Rpb24oKSB7XG4gICAgaWYoUS5jbGVhckNvbG9yKSB7XG4gICAgICBRLmN0eC5nbG9iYWxBbHBoYSA9IDE7XG4gICAgICBRLmN0eC5maWxsU3R5bGUgPSBRLmNsZWFyQ29sb3I7XG4gICAgICBRLmN0eC5maWxsUmVjdCgwLDAsUS53aWR0aCxRLmhlaWdodCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIFEuY3R4LmNsZWFyUmVjdCgwLDAsUS53aWR0aCxRLmhlaWdodCk7XG4gICAgfVxuICB9O1xuICBcbiAgUS5zZXRJbWFnZVNtb290aGluZyA9IGZ1bmN0aW9uKGVuYWJsZWQpIHtcbiAgICBRLmN0eC5tb3pJbWFnZVNtb290aGluZ0VuYWJsZWQgPSBlbmFibGVkO1xuICAgIFEuY3R4LndlYmtpdEltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGVuYWJsZWQ7XG4gICAgUS5jdHgubXNJbWFnZVNtb290aGluZ0VuYWJsZWQgPSBlbmFibGVkO1xuICAgIFEuY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGVuYWJsZWQ7XG4gIH07XG5cbiAgLyoqXG4gICBSZXR1cm4gY2FudmFzIGltYWdlIGRhdGEgZ2l2ZW4gYW4gSW1hZ2Ugb2JqZWN0LlxuXG4gICBAbWV0aG9kIFEuaW1hZ2VEYXRhXG4gICBAZm9yIFF1aW50dXNcbiAgIEBwYXJhbSB7SW1hZ2V9IGltZyAtIGltYWdlIHRvIGdldCBpbWFnZSBkYXRkYSBmb3JcbiAgKi9cbiAgUS5pbWFnZURhdGEgPSBmdW5jdGlvbihpbWcpIHtcbiAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBcbiAgICBjYW52YXMud2lkdGggPSBpbWcud2lkdGg7XG4gICAgY2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHQ7XG5cbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICBjdHguZHJhd0ltYWdlKGltZywwLDApO1xuXG4gICAgcmV0dXJuIGN0eC5nZXRJbWFnZURhdGEoMCwwLGltZy53aWR0aCxpbWcuaGVpZ2h0KTtcbiAgfTtcblxuICBcbiAgLyoqXG4gICBBc3NldCBMb2FkaW5nIFN1cHBvcnRcbiAgXG4gICBUaGUgZW5naW5lIHN1cHBvcnRzIGxvYWRpbmcgYXNzZXRzIG9mIGRpZmZlcmVudCB0eXBlcyB1c2luZ1xuICAgYGxvYWRgIG9yIGBwcmVsb2FkYC4gQXNzZXRzIGFyZSBzdG9yZWQgYnkgdGhlaXIgbmFtZSBzbyB0aGUgXG4gICBzYW1lIGFzc2V0IHdvbid0IGJlIGxvYWRlZCB0d2ljZSBpZiBpdCBhbHJlYWR5IGV4aXN0cy5cblxuICAgQXVnbWVudGFibGUgbGlzdCBvZiBhc3NldCB0eXBlcywgbG9hZHMgYSBzcGVjaWZpYyBhc3NldCBcbiAgIHR5cGUgaWYgdGhlIGZpbGUgdHlwZSBtYXRjaGVzLCBvdGhlcndpc2UgZGVmYXVsdHMgdG8gYSBBamF4XG4gICBsb2FkIG9mIHRoZSBkYXRhLlxuICBcbiAgIFlvdSBjYW4gbmV3IHR5cGVzIG9mIGFzc2V0cyBiYXNlZCBvbiBmaWxlIGV4dGVuc2lvbiBieVxuICAgYWRkaW5nIHRvIGBhc3NldFR5cGVzYCBhbmQgYWRkaW5nIGEgbWV0aG9kIGNhbGxlZFxuICAgbG9hZEFzc2V0VFlQRU5BTUUgd2hlcmUgVFlQRU5BTUUgaXMgdGhlIG5hbWUgb2YgdGhlXG4gICB0eXBlIHlvdSBhZGRlZCBpbi5cblxuICAgRGVmYXVsdCBiaW5kaW5ncyBhcmU6XG5cbiAgICAgKiBwbmcsIGpwZywgZ2lmLCBqcGVnIC0+IEltYWdlXG4gICAgICogb2dnLCB3YXYsIG00YSwgbXAzIC0+IEF1ZGlvXG4gICAgICogRXZlcnl0aGluZyBlbHNlIC0+IERhdGFcbiAgICBcbiAgIFRvIGFkZCBhIG5ldyBmaWxlIGV4dGVuc2lvbiBpbiB0byBhbiBleGlzdGluZyB0eXBlIHlvdSBjYW4ganVzdCBhZGQgaXQgdG8gYXNzZXQgdHlwZXM6XG5cbiAgICAgICBRLmFzc2V0VHlwZXNbJ2JtcCddID0gXCJJbWFnZVwiO1xuXG4gICBUbyBhZGQgaW4gYSBuZXcgbG9hZGVyLCB5b3UnbGwgbmVlZCB0byBkZWZpbmUgYSBtZXRob2QgZm9yIHRoYXQgdHlwZSBhbmQgYWRkIHRvIHRoZSBgUS5hc3NldFR5cGVzYCBvYmplY3QsIGUuZy46XG5cbiAgICAgICBRLmxvYWRBc3NldFZpZGVvID0gZnVuY3Rpb24oa2V5LHNyYyxjYWxsYmFjayxlcnJvckNhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyIHZpZCA9IG5ldyBWaWRlbygpO1xuICAgICAgICAgIHZpZC5hZGRFdmVudExpc3RlbmVyKFwiY2FucGxheXRocm91Z2hcIixmdW5jdGlvbigpIHsgIGNhbGxiYWNrKGtleSx2aWQpOyB9KTtcbiAgICAgICAgICB2aWQub25lcnJvciA9IGVycm9yQ2FsbGJhY2s7XG4gICAgICAgICAgdmlkLnNyYyA9IFEuYXNzZXRVcmwoUS5vcHRpb25zLmltYWdlUGF0aCxzcmMpO1xuICAgICAgIH07XG5cbiAgICAgICBRLmFzc2V0VHlwZXNbJ21wNCddID0gJ1ZpZGVvJ1xuXG5cbiAgIEBmb3IgUXVpbnR1c1xuICAgQHByb3BlcnR5IFEuYXNzZXRUeXBlc1xuICAgQHR5cGUgT2JqZWN0XG4gICovXG4gIFEuYXNzZXRUeXBlcyA9IHsgXG4gICAgcG5nOiAnSW1hZ2UnLCBqcGc6ICdJbWFnZScsIGdpZjogJ0ltYWdlJywganBlZzogJ0ltYWdlJyxcbiAgICBvZ2c6ICdBdWRpbycsIHdhdjogJ0F1ZGlvJywgbTRhOiAnQXVkaW8nLCBtcDM6ICdBdWRpbydcbiAgfTtcblxuXG4gIC8qKlxuICAgUmV0dXJuIHRoZSBmaWxlIGV4dGVuc2lvbiBvZiBhIGZpbGVuYW1lXG5cbiAgIEBmb3IgUXVpbnR1c1xuICAgQG1ldGhvZCBRLl9maWxlRXh0ZW5zaW9uXG4gICBAcGFyYW0ge1N0cmluZ30gZmlsZW5hbWVcbiAgIEByZXR1cm4ge1N0cmluZ30gbG93ZXJjYXNlZCBleHRlbnNpb25cbiAgKi9cbiAgUS5fZmlsZUV4dGVuc2lvbiA9IGZ1bmN0aW9uKGZpbGVuYW1lKSB7XG4gICAgdmFyIGZpbGVQYXJ0cyA9IGZpbGVuYW1lLnNwbGl0KFwiLlwiKSxcbiAgICAgICAgZmlsZUV4dCA9IGZpbGVQYXJ0c1tmaWxlUGFydHMubGVuZ3RoLTFdLnRvTG93ZXJDYXNlKCk7XG4gICAgcmV0dXJuIGZpbGVFeHQ7XG4gIH07XG5cbiAgLyoqXG4gICBEZXRlcm1pbmUgdGhlIHR5cGUgb2YgYXNzZXQgYmFzZWQgb24gdGhlIGBRLmFzc2V0VHlwZXNgIGxvb2t1cCB0YWJsZVxuXG4gICBAZm9yIFF1aW50dXNcbiAgIEBtZXRob2QgUS5hc3NldFR5cGVcbiAgIEBwYXJhbSB7U3RyaW5nfSBhc3NldFxuICAqL1xuICBRLmFzc2V0VHlwZSA9IGZ1bmN0aW9uKGFzc2V0KSB7XG4gICAgLyogRGV0ZXJtaW5lIHRoZSBsb3dlcmNhc2UgZXh0ZW5zaW9uIG9mIHRoZSBmaWxlICovXG4gICAgdmFyIGZpbGVFeHQgPSBRLl9maWxlRXh0ZW5zaW9uKGFzc2V0KTtcblxuICAgIC8vIFVzZSB0aGUgd2ViIGF1ZGlvIGxvYWRlciBpbnN0ZWFkIG9mIHRoZSByZWd1bGFyIGxvYWRlclxuICAgIC8vIGlmIGl0J3Mgc3VwcG9ydGVkLlxuICAgIHZhciBmaWxlVHlwZSA9ICBRLmFzc2V0VHlwZXNbZmlsZUV4dF07XG4gICAgaWYoZmlsZVR5cGUgPT09ICdBdWRpbycgJiYgUS5hdWRpbyAmJiBRLmF1ZGlvLnR5cGUgPT09IFwiV2ViQXVkaW9cIikge1xuICAgICAgZmlsZVR5cGUgPSAnV2ViQXVkaW8nO1xuICAgIH1cblxuICAgIC8qIExvb2t1cCB0aGUgYXNzZXQgaW4gdGhlIGFzc2V0VHlwZXMgaGFzaCwgb3IgcmV0dXJuIG90aGVyICovXG4gICAgcmV0dXJuIGZpbGVUeXBlIHx8ICdPdGhlcic7XG4gIH07XG5cbiAgLyoqXG4gICBFaXRoZXIgcmV0dXJuIGFuIGFic29sdXRlIFVSTCwgb3IgYWRkIGEgYmFzZSB0byBhIHJlbGF0aXZlIFVSTFxuXG4gICBAZm9yIFF1aW50dXNcbiAgIEBtZXRob2QgUS5hc3NldFVybFxuICAgQHBhcmFtIHtTdHJpbmd9IGJhc2UgLSBiYXNlIGZvciByZWxhdGl2ZSBwYXRoc1xuICAgQHBhcmFtIHtTdHJpbmd9IHVybCAtIHVybCB0byByZXNvbHZlIHRvIGFzc2V0IHVybFxuICAgQHJldHVybiB7U3RyaW5nfSByZXNvbHZlZCB1cmxcbiAgKi9cbiAgUS5hc3NldFVybCA9IGZ1bmN0aW9uKGJhc2UsdXJsKSB7XG4gICAgdmFyIHRpbWVzdGFtcCA9IFwiXCI7XG4gICAgaWYoUS5vcHRpb25zLmRldmVsb3BtZW50KSB7XG4gICAgICB0aW1lc3RhbXAgPSAoL1xcPy8udGVzdCh1cmwpID8gXCImXCIgOiBcIj9cIikgKyBcIl90PVwiICtuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICB9XG4gICAgaWYoL15odHRwcz86XFwvXFwvLy50ZXN0KHVybCkgfHwgdXJsWzBdID09PSBcIi9cIikge1xuICAgICAgcmV0dXJuIHVybCArIHRpbWVzdGFtcDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGJhc2UgKyB1cmwgKyB0aW1lc3RhbXA7XG4gICAgfVxuICB9O1xuXG4gIC8qKiBcbiAgTG9hZGVyIGZvciBJbWFnZXMsIGNyZWF0ZXMgYSBuZXcgYEltYWdlYCBvYmplY3QgYW5kIHVzZXMgdGhlIFxuICBsb2FkIGNhbGxiYWNrIHRvIGRldGVybWluZSB0aGUgaW1hZ2UgaGFzIGJlZW4gbG9hZGVkXG5cbiAgQGZvciBRdWludHVzXG4gIEBtZXRob2QgUS5sb2FkQXNzZXRJbWFnZVxuICBAcGFyYW0ge1N0cmluZ30ga2V5XG4gIEBwYXJhbSB7U3RyaW5nfSBzcmNcbiAgQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2tcbiAgQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFja1xuICAqL1xuICBRLmxvYWRBc3NldEltYWdlID0gZnVuY3Rpb24oa2V5LHNyYyxjYWxsYmFjayxlcnJvckNhbGxiYWNrKSB7XG4gICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbigpIHsgIGNhbGxiYWNrKGtleSxpbWcpOyB9O1xuICAgIGltZy5vbmVycm9yID0gZXJyb3JDYWxsYmFjaztcbiAgICBpbWcuc3JjID0gUS5hc3NldFVybChRLm9wdGlvbnMuaW1hZ2VQYXRoLHNyYyk7XG4gIH07XG5cblxuICAvLyBMaXN0IG9mIG1pbWUgdHlwZXMgZ2l2ZW4gYW4gYXVkaW8gZmlsZSBleHRlbnNpb24sIHVzZWQgdG8gXG4gIC8vIGRldGVybWluZSB3aGF0IHNvdW5kIHR5cGVzIHRoZSBicm93c2VyIGNhbiBwbGF5IHVzaW5nIHRoZSBcbiAgLy8gYnVpbHQtaW4gYFNvdW5kLmNhblBsYXlUeXBlYFxuICBRLmF1ZGlvTWltZVR5cGVzID0geyBtcDM6ICdhdWRpby9tcGVnJywgXG4gICAgICAgICAgICAgICAgICAgICAgIG9nZzogJ2F1ZGlvL29nZzsgY29kZWNzPVwidm9yYmlzXCInLFxuICAgICAgICAgICAgICAgICAgICAgICBtNGE6ICdhdWRpby9tNGEnLFxuICAgICAgICAgICAgICAgICAgICAgICB3YXY6ICdhdWRpby93YXYnIH07XG5cblxuICBRLl9hdWRpb0Fzc2V0RXh0ZW5zaW9uID0gZnVuY3Rpb24oKSB7XG4gICAgaWYoUS5fYXVkaW9Bc3NldFByZWZlcnJlZEV4dGVuc2lvbikgeyByZXR1cm4gUS5fYXVkaW9Bc3NldFByZWZlcnJlZEV4dGVuc2lvbjsgfVxuXG4gICAgdmFyIHNuZCA9IG5ldyBBdWRpbygpO1xuXG4gICAgLyogRmluZCBhIHN1cHBvcnRlZCB0eXBlICovXG4gICAgcmV0dXJuIFEuX2F1ZGlvQXNzZXRQcmVmZXJyZWRFeHRlbnNpb24gPSBcbiAgICAgIFEuX2RldGVjdChRLm9wdGlvbnMuYXVkaW9TdXBwb3J0ZWQsXG4gICAgICAgICBmdW5jdGlvbihleHRlbnNpb24pIHtcbiAgICAgICAgIHJldHVybiBzbmQuY2FuUGxheVR5cGUoUS5hdWRpb01pbWVUeXBlc1tleHRlbnNpb25dKSA/IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlbnNpb24gOiBudWxsO1xuICAgICAgfSk7XG4gIH07XG5cblxuICAvKiogXG4gICBMb2FkZXIgZm9yIEF1ZGlvIGFzc2V0cy4gQnkgZGVmYXVsdCBjaG9wcyBvZmYgdGhlIGV4dGVuc2lvbiBhbmQgXG4gICB3aWxsIGF1dG9tYXRpY2FsbHkgZGV0ZXJtaW5lIHdoaWNoIG9mIHRoZSBzdXBwb3J0ZWQgdHlwZXMgaXMgXG4gICBwbGF5YWJsZSBieSB0aGUgYnJvd3NlciBhbmQgbG9hZCB0aGF0IHR5cGUuXG4gIFxuICAgV2hpY2ggdHlwZXMgYXJlIGF2YWlsYWJsZSBhcmUgZGV0ZXJtaW5lZCBieSB0aGUgZmlsZSBleHRlbnNpb25zXG4gICBsaXN0ZWQgaW4gdGhlIFF1aW50dXMgYG9wdGlvbnMuYXVkaW9TdXBwb3J0ZWRgXG5cblxuICBAZm9yIFF1aW50dXNcbiAgQG1ldGhvZCBRLmxvYWRBc3NldEF1ZGlvXG4gIEBwYXJhbSB7U3RyaW5nfSBrZXlcbiAgQHBhcmFtIHtTdHJpbmd9IHNyY1xuICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFja1xuICBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrXG4gICovXG4gIFEubG9hZEFzc2V0QXVkaW8gPSBmdW5jdGlvbihrZXksc3JjLGNhbGxiYWNrLGVycm9yQ2FsbGJhY2spIHtcbiAgICBpZighZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImF1ZGlvXCIpLnBsYXkgfHwgIVEub3B0aW9ucy5zb3VuZCkge1xuICAgICAgY2FsbGJhY2soa2V5LG51bGwpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBiYXNlTmFtZSA9IFEuX3JlbW92ZUV4dGVuc2lvbihzcmMpLFxuICAgICAgICBleHRlbnNpb24gPSBRLl9hdWRpb0Fzc2V0RXh0ZW5zaW9uKCksXG4gICAgICAgIGZpbGVuYW1lID0gbnVsbCxcbiAgICAgICAgc25kID0gbmV3IEF1ZGlvKCk7XG5cbiAgICAvKiBObyBzdXBwb3J0ZWQgYXVkaW8gPSB0cmlnZ2VyIG9rIGNhbGxiYWNrIGFueXdheSAqL1xuICAgIGlmKCFleHRlbnNpb24pIHtcbiAgICAgIGNhbGxiYWNrKGtleSxudWxsKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzbmQuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsZXJyb3JDYWxsYmFjayk7XG5cbiAgICAvLyBEb24ndCB3YWl0IGZvciBjYW5wbGF5dGhyb3VnaCBvbiBtb2JpbGVcbiAgICBpZighUS50b3VjaERldmljZSkgeyBcbiAgICAgIHNuZC5hZGRFdmVudExpc3RlbmVyKCdjYW5wbGF5dGhyb3VnaCcsZnVuY3Rpb24oKSB7IFxuICAgICAgICBjYWxsYmFjayhrZXksc25kKTsgXG4gICAgICB9KTtcbiAgICB9XG4gICAgc25kLnNyYyA9ICBRLmFzc2V0VXJsKFEub3B0aW9ucy5hdWRpb1BhdGgsYmFzZU5hbWUgKyBcIi5cIiArIGV4dGVuc2lvbik7XG4gICAgc25kLmxvYWQoKTtcblxuICAgIGlmKFEudG91Y2hEZXZpY2UpIHtcbiAgICAgIGNhbGxiYWNrKGtleSxzbmQpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgIEFzc2V0IGxvYWRlciBmb3IgQXVkaW8gZmlsZXMgaWYgdXNpbmcgdGhlIFdlYkF1ZGlvIEFQSSBlbmdpbmVcblxuICBAZm9yIFF1aW50dXNcbiAgQG1ldGhvZCBRLmxvYWRBc3NldFdlYkF1ZGlvXG4gIEBwYXJhbSB7U3RyaW5nfSBrZXlcbiAgQHBhcmFtIHtTdHJpbmd9IHNyY1xuICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFja1xuICBAcGFyYW0ge0Z1bmN0aW9ufSBlcnJvckNhbGxiYWNrXG4gICovXG4gIFEubG9hZEFzc2V0V2ViQXVkaW8gPSBmdW5jdGlvbihrZXksc3JjLGNhbGxiYWNrLGVycm9yQ2FsbGJhY2spIHtcbiAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpLFxuICAgICAgICBiYXNlTmFtZSA9IFEuX3JlbW92ZUV4dGVuc2lvbihzcmMpLFxuICAgICAgICBleHRlbnNpb24gPSBRLl9hdWRpb0Fzc2V0RXh0ZW5zaW9uKCk7XG5cbiAgICByZXF1ZXN0Lm9wZW4oXCJHRVRcIiwgUS5hc3NldFVybChRLm9wdGlvbnMuYXVkaW9QYXRoLGJhc2VOYW1lICsgXCIuXCIgKyBleHRlbnNpb24pLCB0cnVlKTtcbiAgICByZXF1ZXN0LnJlc3BvbnNlVHlwZSA9IFwiYXJyYXlidWZmZXJcIjtcblxuICAgIC8vIE91ciBhc3luY2hyb25vdXMgY2FsbGJhY2tcbiAgICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGF1ZGlvRGF0YSA9IHJlcXVlc3QucmVzcG9uc2U7XG5cbiAgICAgIFEuYXVkaW9Db250ZXh0LmRlY29kZUF1ZGlvRGF0YShyZXF1ZXN0LnJlc3BvbnNlLCBmdW5jdGlvbihidWZmZXIpIHtcbiAgICAgICAgY2FsbGJhY2soa2V5LGJ1ZmZlcik7XG4gICAgICB9LCBlcnJvckNhbGxiYWNrKTtcbiAgICB9O1xuICAgIHJlcXVlc3Quc2VuZCgpO1xuXG4gIH07XG5cbiAgLyoqXG4gICBMb2FkZXIgZm9yIG90aGVyIGZpbGUgdHlwZXMsIGp1c3Qgc3RvcmVzIHRoZSBkYXRhIHJldHVybmVkIGZyb20gYW4gQWpheCBjYWxsLlxuXG4gICBKdXN0IG1ha2VzIGEgQWpheCByZXF1ZXN0IGZvciBhbGwgb3RoZXIgZmlsZSB0eXBlc1xuXG4gIEBmb3IgUXVpbnR1c1xuICBAbWV0aG9kIFEubG9hZEFzc2V0T3RoZXJcbiAgQHBhcmFtIHtTdHJpbmd9IGtleVxuICBAcGFyYW0ge1N0cmluZ30gc3JjXG4gIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrXG4gIEBwYXJhbSB7RnVuY3Rpb259IGVycm9yQ2FsbGJhY2tcbiAgKi9cbiAgUS5sb2FkQXNzZXRPdGhlciA9IGZ1bmN0aW9uKGtleSxzcmMsY2FsbGJhY2ssZXJyb3JDYWxsYmFjaykge1xuICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICB2YXIgZmlsZVBhcnRzID0gc3JjLnNwbGl0KFwiLlwiKSxcbiAgICAgICAgZmlsZUV4dCA9IGZpbGVQYXJ0c1tmaWxlUGFydHMubGVuZ3RoLTFdLnRvTG93ZXJDYXNlKCk7XG5cbiAgICByZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYocmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgIGlmKHJlcXVlc3Quc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICBpZihmaWxlRXh0ID09PSAnanNvbicpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKGtleSxKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2VUZXh0KSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKGtleSxyZXF1ZXN0LnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVycm9yQ2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICByZXF1ZXN0Lm9wZW4oXCJHRVRcIiwgUS5hc3NldFVybChRLm9wdGlvbnMuZGF0YVBhdGgsc3JjKSwgdHJ1ZSk7XG4gICAgcmVxdWVzdC5zZW5kKG51bGwpO1xuICB9O1xuXG4gIC8qKlxuICAgSGVscGVyIG1ldGhvZCB0byByZXR1cm4gYSBuYW1lIHdpdGhvdXQgYW4gZXh0ZW5zaW9uXG5cbiAgIEBmb3IgUXVpbnR1c1xuICAgQG1ldGhvZCBfcmVtb3ZlRXh0ZW5zaW9uXG4gICBAcGFyYW0ge1N0cmluZ30gZmlsZW5hbWVcbiAgIEByZXR1cm4ge1N0cmluZ30gZmlsZW5hbWUgd2l0aG91dCBhbiBleHRlbnNpb25cbiAgKi9cbiAgUS5fcmVtb3ZlRXh0ZW5zaW9uID0gZnVuY3Rpb24oZmlsZW5hbWUpIHtcbiAgICByZXR1cm4gZmlsZW5hbWUucmVwbGFjZSgvXFwuKFxcd3szLDR9KSQvLFwiXCIpO1xuICB9O1xuXG4gIC8vIEFzc2V0IGhhc2ggc3RvcmluZyBhbnkgbG9hZGVkIGFzc2V0c1xuICBRLmFzc2V0cyA9IHt9O1xuXG4gIC8qKlxuICAgR2V0dGVyIG1ldGhvZCB0byByZXR1cm4gYW4gYXNzZXQgYnkgaXRzIG5hbWUuXG4gIFxuICAgQXNzZXQgbmFtZXMgZGVmYXVsdCB0byB0aGVpciBmaWxlbmFtZXMsIGJ1dCBjYW4gYmUgb3ZlcnJpZGRlblxuICAgYnkgcGFzc2luZyBhIGhhc2ggdG8gYGxvYWRgIHRvIHNldCBkaWZmZXJlbnQgbmFtZXMuXG5cbiAgIEBmb3IgUXVpbnR1c1xuICAgQG1ldGhvZCBhc3NldFxuICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUgLSBuYW1lIG9mIGFzc2V0IHRvIGxvb2t1cFxuICAqL1xuICBRLmFzc2V0ID0gZnVuY3Rpb24obmFtZSkge1xuICAgIHJldHVybiBRLmFzc2V0c1tuYW1lXTtcbiAgfTtcblxuICAvKipcbiAgIExvYWQgYXNzZXRzLCBhbmQgY2FsbCBvdXIgY2FsbGJhY2sgd2hlbiBkb25lLlxuICBcbiAgIEFsc28gb3B0aW9uYWxseSB0YWtlcyBhIGBwcm9ncmVzc0NhbGxiYWNrYCB3aGljaCB3aWxsIGJlIGNhbGxlZCBcbiAgIHdpdGggdGhlIG51bWJlciBvZiBhc3NldHMgbG9hZGVkIGFuZCB0aGUgdG90YWwgbnVtYmVyIG9mIGFzc2V0c1xuICAgdG8gYWxsb3cgc2hvd2luZyBvZiBhIHByb2dyZXNzLiBcbiAgXG4gICBBc3NldHMgY2FuIGJlIHBhc3NlZCBpbiBhcyBhbiBhcnJheSBvZiBmaWxlIG5hbWVzLCBhbmQgUXVpbnR1c1xuICAgd2lsbCB1c2UgdGhlIGZpbGUgbmFtZXMgYXMgdGhlIG5hbWUgZm9yIHJlZmVyZW5jZSwgb3IgYXMgYSBoYXNoIG9mIFxuICAgYHsgbmFtZTogZmlsZW5hbWUgfWAuIFxuICBcbiAgIEV4YW1wbGUgdXNhZ2U6XG4gICAgICAgUS5sb2FkKFsnc3ByaXRlcy5wbmcnLCdzcHJpdGVzLixqc29uJ10sZnVuY3Rpb24oKSB7XG4gICAgICAgICAgUS5zdGFnZVNjZW5lKFwibGV2ZWwxXCIpOyAvLyBvciBzb21ldGhpbmcgdG8gc3RhcnQgdGhlIGdhbWUuXG4gICAgICAgfSk7XG5cbiAgQGZvciBRdWludHVzXG4gIEBtZXRob2QgUS5sb2FkXG4gIEBwYXJhbSB7U3RyaW5nLCBBcnJheSBvciBBcnJheX0gYXNzZXRzIC0gY29tbWEgc2VwYXJhdGVkIHN0cmluZywgYXJyYXkgb3IgT2JqZWN0IGhhc2ggb2YgYXNzZXRzIHRvIGxvYWRcbiAgQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBjYWxsZWQgd2hlbiBkb25lIGxvYWRpbmdcbiAgQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgKi9cbiAgUS5sb2FkID0gZnVuY3Rpb24oYXNzZXRzLGNhbGxiYWNrLG9wdGlvbnMpIHtcbiAgICB2YXIgYXNzZXRPYmogPSB7fTtcblxuICAgIC8qIE1ha2Ugc3VyZSB3ZSBoYXZlIGFuIG9wdGlvbnMgaGFzaCB0byB3b3JrIHdpdGggKi9cbiAgICBpZighb3B0aW9ucykgeyBvcHRpb25zID0ge307IH1cblxuICAgIC8qIEdldCBvdXIgcHJvZ3Jlc3NDYWxsYmFjayBpZiB3ZSBoYXZlIG9uZSAqL1xuICAgIHZhciBwcm9ncmVzc0NhbGxiYWNrID0gb3B0aW9ucy5wcm9ncmVzc0NhbGxiYWNrO1xuXG4gICAgdmFyIGVycm9ycyA9IGZhbHNlLFxuICAgICAgICBlcnJvckNhbGxiYWNrID0gZnVuY3Rpb24oaXRtKSB7XG4gICAgICAgICAgZXJyb3JzID0gdHJ1ZTtcbiAgICAgICAgICAob3B0aW9ucy5lcnJvckNhbGxiYWNrICB8fFxuICAgICAgICAgICBmdW5jdGlvbihpdG0pIHsgdGhyb3coXCJFcnJvciBMb2FkaW5nOiBcIiArIGl0bSApOyB9KShpdG0pO1xuICAgICAgICB9O1xuXG4gICAgLyogQ29udmVydCB0byBhbiBhcnJheSBpZiBpdCdzIGEgc3RyaW5nICovXG4gICAgaWYoUS5faXNTdHJpbmcoYXNzZXRzKSkge1xuICAgICAgYXNzZXRzID0gUS5fbm9ybWFsaXplQXJnKGFzc2V0cyk7XG4gICAgfVxuXG4gICAgLyogSWYgdGhlIHVzZXIgcGFzc2VkIGluIGFuIGFycmF5LCBjb252ZXJ0IGl0ICovXG4gICAgLyogdG8gYSBoYXNoIHdpdGggbG9va3VwcyBieSBmaWxlbmFtZSAqL1xuICAgIGlmKFEuX2lzQXJyYXkoYXNzZXRzKSkgeyBcbiAgICAgIFEuX2VhY2goYXNzZXRzLGZ1bmN0aW9uKGl0bSkge1xuICAgICAgICBpZihRLl9pc09iamVjdChpdG0pKSB7XG4gICAgICAgICAgUS5fZXh0ZW5kKGFzc2V0T2JqLGl0bSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXNzZXRPYmpbaXRtXSA9IGl0bTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8qIE90aGVyd2lzZSBqdXN0IHVzZSB0aGUgYXNzZXRzIGFzIGlzICovXG4gICAgICBhc3NldE9iaiA9IGFzc2V0cztcbiAgICB9XG5cbiAgICAvKiBGaW5kIHRoZSAjIG9mIGFzc2V0cyB3ZSdyZSBsb2FkaW5nICovXG4gICAgdmFyIGFzc2V0c1RvdGFsID0gUS5fa2V5cyhhc3NldE9iaikubGVuZ3RoLFxuICAgICAgICBhc3NldHNSZW1haW5pbmcgPSBhc3NldHNUb3RhbDtcblxuICAgIC8qIENsb3N1cmUnZCBwZXItYXNzZXQgY2FsbGJhY2sgZ2V0cyBjYWxsZWQgKi9cbiAgICAvKiBlYWNoIHRpbWUgYW4gYXNzZXQgaXMgc3VjY2Vzc2Z1bGx5IGxvYWRkZWQgKi9cbiAgICB2YXIgbG9hZGVkQ2FsbGJhY2sgPSBmdW5jdGlvbihrZXksb2JqLGZvcmNlKSB7XG4gICAgICBpZihlcnJvcnMpIHsgcmV0dXJuOyB9XG5cbiAgICAgIC8vIFByZXZlbnQgZG91YmxlIGNhbGxiYWNrcyAoSSdtIGxvb2tpbmcgYXQgeW91IEZpcmVmb3gsIGNhbnBsYXl0aHJvdWdoXG4gICAgICBpZighUS5hc3NldHNba2V5XXx8Zm9yY2UpIHtcblxuICAgICAgICAvKiBBZGQgdGhlIG9iamVjdCB0byBvdXIgYXNzZXQgbGlzdCAqL1xuICAgICAgICBRLmFzc2V0c1trZXldID0gb2JqO1xuXG4gICAgICAgIC8qIFdlJ3ZlIGdvdCBvbmUgbGVzcyBhc3NldCB0byBsb2FkICovXG4gICAgICAgIGFzc2V0c1JlbWFpbmluZy0tO1xuXG4gICAgICAgIC8qIFVwZGF0ZSBvdXIgcHJvZ3Jlc3MgaWYgd2UgaGF2ZSBpdCAqL1xuICAgICAgICBpZihwcm9ncmVzc0NhbGxiYWNrKSB7IFxuICAgICAgICAgICBwcm9ncmVzc0NhbGxiYWNrKGFzc2V0c1RvdGFsIC0gYXNzZXRzUmVtYWluaW5nLGFzc2V0c1RvdGFsKTsgXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLyogSWYgd2UncmUgb3V0IG9mIGFzc2V0cywgY2FsbCBvdXIgZnVsbCBjYWxsYmFjayAqL1xuICAgICAgLyogaWYgdGhlcmUgaXMgb25lICovXG4gICAgICBpZihhc3NldHNSZW1haW5pbmcgPT09IDAgJiYgY2FsbGJhY2spIHtcbiAgICAgICAgLyogaWYgd2UgaGF2ZW4ndCBzZXQgdXAgb3VyIGNhbnZhcyBlbGVtZW50IHlldCwgKi9cbiAgICAgICAgLyogYXNzdW1lIHdlJ3JlIHVzaW5nIGEgY2FudmFzIHdpdGggaWQgJ3F1aW50dXMnICovXG4gICAgICAgIGNhbGxiYWNrLmFwcGx5KFEpOyBcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyogTm93IGFjdHVhbGx5IGxvYWQgZWFjaCBhc3NldCAqL1xuICAgIFEuX2VhY2goYXNzZXRPYmosZnVuY3Rpb24oaXRtLGtleSkge1xuXG4gICAgICAvKiBEZXRlcm1pbmUgdGhlIHR5cGUgb2YgdGhlIGFzc2V0ICovXG4gICAgICB2YXIgYXNzZXRUeXBlID0gUS5hc3NldFR5cGUoaXRtKTtcblxuICAgICAgLyogSWYgd2UgYWxyZWFkeSBoYXZlIHRoZSBhc3NldCBsb2FkZWQsICovXG4gICAgICAvKiBkb24ndCBsb2FkIGl0IGFnYWluICovXG4gICAgICBpZihRLmFzc2V0c1trZXldKSB7XG4gICAgICAgIGxvYWRlZENhbGxiYWNrKGtleSxRLmFzc2V0c1trZXldLHRydWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLyogQ2FsbCB0aGUgYXBwcm9wcmlhdGUgbG9hZGVyIGZ1bmN0aW9uICovXG4gICAgICAgIC8qIHBhc3NpbmcgaW4gb3VyIHBlci1hc3NldCBjYWxsYmFjayAqL1xuICAgICAgICAvKiBEcm9wcGluZyBvdXIgYXNzZXQgYnkgbmFtZSBpbnRvIFEuYXNzZXRzICovXG4gICAgICAgIFFbXCJsb2FkQXNzZXRcIiArIGFzc2V0VHlwZV0oa2V5LGl0bSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVkQ2FsbGJhY2ssXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgeyBlcnJvckNhbGxiYWNrKGl0bSk7IH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gIH07XG5cbiAgLy8gQXJyYXkgdG8gc3RvcmUgYW55IGFzc2V0cyB0aGF0IG5lZWQgdG8gYmUgXG4gIC8vIHByZWxvYWRlZFxuICBRLnByZWxvYWRzID0gW107XG4gIFxuICAvKipcbiAgIExldCB1cyBnYXRoZXIgYXNzZXRzIHRvIGxvYWQgYXQgYSBsYXRlciB0aW1lLFxuICAgYW5kIHRoZW4gcHJlbG9hZCB0aGVtIGFsbCBhdCB0aGUgc2FtZSB0aW1lIHdpdGhcbiAgIGEgc2luZ2xlIGNhbGxiYWNrLiBPcHRpb25zIGFyZSBwYXNzZWQgdGhyb3VnaCB0byB0aGVcbiAgIFEubG9hZCBtZXRob2QgaWYgdXNlZC5cbiAgXG4gICBFeGFtcGxlIHVzYWdlOlxuICAgICAgICBRLnByZWxvYWQoXCJzcHJpdGVzLnBuZ1wiKTtcbiAgICAgICAgLi4uXG4gICAgICAgIFEucHJlbG9hZChcInNwcml0ZXMuanNvblwiKTtcbiAgICAgICAgLi4uXG4gIFxuICAgICAgICBRLnByZWxvYWQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgIFEuc3RhZ2VTY2VuZShcImxldmVsMVwiKTsgLy8gb3Igc29tZXRoaW5nIHRvIHN0YXJ0IHRoZSBnYW1lXG4gICAgICAgIH0pO1xuICBAZm9yIFF1aW50dXNcbiAgQG1ldGhvZCBRLnByZWxvYWRcbiAgQHBhcmFtIHtTdHJpbmcgb3IgRnVuY3Rpb259IGFyZyAtIGNvbW1hIHNlcGFyYXRlZCBzdHJpbmcgb2YgYXNzZXRzIHRvIGxvYWQsIG9yIGNhbGxiYWNrXG4gIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gLSBvcHRpb25zIHRvIHBhc3MgdG8gbG9hZFxuICAqL1xuICBRLnByZWxvYWQgPSBmdW5jdGlvbihhcmcsb3B0aW9ucykge1xuICAgIGlmKFEuX2lzRnVuY3Rpb24oYXJnKSkge1xuICAgICAgUS5sb2FkKFEuX3VuaXEoUS5wcmVsb2FkcyksYXJnLG9wdGlvbnMpO1xuICAgICAgUS5wcmVsb2FkcyA9IFtdO1xuICAgIH0gZWxzZSB7XG4gICAgICBRLnByZWxvYWRzID0gUS5wcmVsb2Fkcy5jb25jYXQoYXJnKTtcbiAgICB9XG4gIH07XG5cblxuICAvLyBNYXRoIE1ldGhvZHNcbiAgLy8gPT09PT09PT09PT09PT1cbiAgLy9cbiAgLy8gTWF0aCBtZXRob2RzLCBmb3Igcm90YXRpbmcgYW5kIHNjYWxpbmcgcG9pbnRzXG5cbiAgLy8gQSBsaXN0IG9mIG1hdHJpY2VzIGF2YWlsYWJsZVxuICBRLm1hdHJpY2VzMmQgPSBbXTtcblxuICBRLm1hdHJpeDJkID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFEubWF0cmljZXMyZC5sZW5ndGggPiAwID8gUS5tYXRyaWNlczJkLnBvcCgpLmlkZW50aXR5KCkgOiBuZXcgUS5NYXRyaXgyRCgpO1xuICB9O1xuXG4gIC8qKlxuICAgQSAyRCBtYXRyaXggY2xhc3MsIG9wdGltaXplZCBmb3IgMkQgcG9pbnRzLFxuICAgd2hlcmUgdGhlIGxhc3Qgcm93IG9mIHRoZSBtYXRyaXggd2lsbCBhbHdheXMgYmUgMCwwLDEgXG5cbiAgIERvIG5vdCBjYWxsIGBuZXcgUS5NYXRyaXgyRGAgLSB1c2UgdGhlIHByb3ZpZGVkIFEubWF0cml4MkQgZmFjdG9yeSBmdW5jdGlvbiBmb3IgR0MgaGFwcGluZXNzXG5cbiAgICAgICAgdmFyIG1hdHJpeCA9IFEubWF0cml4MmQoKTtcblxuICAgR29vZCBEb2NzIGhlcmU6IGh0dHBzOi8vZ2l0aHViLmNvbS9oZXlncmFkeS90cmFuc2Zvcm0vd2lraS9jYWxjdWxhdGluZy0yZC1tYXRyaWNlc1xuXG4gICBVc2VkIGludGVybmFsbHkgYnkgUXVpbnR1cyBmb3IgYWxsIHRyYW5zZm9ybXMgLyBjb2xsaXNpb24gZGV0ZWN0aW9uLiBNb3N0IG9mIHRoZSBtZXRob2RzIG1vZGlmeSB0aGUgbWF0cml4IHRoZXkgYXJlIGNhbGxlZCB1cG9uIGFuZCBhcmUgY2hhaW5hYmxlLlxuXG4gICBAY2xhc3MgUS5NYXRyaXgyRFxuICAgQGZvciBRdWludHVzXG4gICBAZXh0ZW5kcyBRLkNsYXNzXG4gICovXG4gIFEuTWF0cml4MkQgPSBRLkNsYXNzLmV4dGVuZCh7XG4gICAgLyoqXG4gICAgIEluaXRpYWxpemUgYSBtYXRyaXggZnJvbSBhIHNvdXJjZSBvciB3aXRoIHRoZSBpZGVudGlmeSBtYXRyaXhcblxuICAgICBAY29uc3RydWN0b3JcbiAgICAgQGZvciBRLk1hdHJpeDJEXG4gICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbihzb3VyY2UpIHtcbiAgICAgIGlmKHNvdXJjZSkge1xuICAgICAgICB0aGlzLm0gPSBbXTtcbiAgICAgICAgdGhpcy5jbG9uZShzb3VyY2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5tID0gWzEsMCwwLDAsMSwwXTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIFR1cm4gdGhpcyBtYXRyaXggaW50byB0aGUgaWRlbnRpdHlcblxuICAgICBAZm9yIFEuTWF0cml4MkRcbiAgICAgQG1ldGhvZCBpZGVudGl0eVxuICAgICBAY2hhaW5hYmxlXG4gICAgKi9cbiAgICBpZGVudGl0eTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgbSA9IHRoaXMubTtcbiAgICAgIG1bMF0gPSAxOyBtWzFdID0gMDsgbVsyXSA9IDA7XG4gICAgICBtWzNdID0gMDsgbVs0XSA9IDE7IG1bNV0gPSAwO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKiBcblxuICAgICBDbG9uZSBhbm90aGVyIG1hdHJpeCBpbnRvIHRoaXMgb25lXG5cbiAgICAgQGZvciBRLk1hdHJpeDJEXG4gICAgIEBtZXRob2QgY2xvbmVcbiAgICAgQHBhcmFtIHtRLk1hdHJpeDJEfSBtYXRyaXggLSBtYXRyaXggdG8gY2xvbmVcbiAgICAgQGNoYWluYWJsZVxuICAgICovXG4gICAgY2xvbmU6IGZ1bmN0aW9uKG1hdHJpeCkge1xuICAgICAgdmFyIGQgPSB0aGlzLm0sIHMgPSBtYXRyaXgubTtcbiAgICAgIGRbMF09c1swXTsgZFsxXT1zWzFdOyBkWzJdID0gc1syXTtcbiAgICAgIGRbM109c1szXTsgZFs0XT1zWzRdOyBkWzVdID0gc1s1XTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgbXVsdGlwbHkgdHdvIG1hdHJpY2VzIChsZWF2aW5nIHRoZSByZXN1bHQgaW4gdGhpcylcblxuICAgICAgICBhICogYiA9IFxuICAgICAgICAgICBbIFsgYTExKmIxMSArIGExMipiMjEgXSwgWyBhMTEqYjEyICsgYTEyKmIyMiBdLCBbIGExMSpiMzEgKyBhMTIqYjMyICsgYTEzIF0gLFxuICAgICAgICAgICBbIGEyMSpiMTEgKyBhMjIqYjIxIF0sIFsgYTIxKmIxMiArIGEyMipiMjIgXSwgWyBhMjEqYjMxICsgYTIyKmIzMiArIGEyMyBdIF1cblxuICAgICBAZm9yIFEuTWF0cml4MkRcbiAgICAgQG1ldGhvZCBjbG9uZVxuICAgICBAcGFyYW0ge1EuTWF0cml4MkR9IG1hdHJpeCAtIG1hdHJpeCB0byBtdWx0aXBseSBieVxuICAgICBAY2hhaW5hYmxlXG4gICAqL1xuICAgIG11bHRpcGx5OiBmdW5jdGlvbihtYXRyaXgpIHtcbiAgICAgIHZhciBhID0gdGhpcy5tLCBiID0gbWF0cml4Lm07XG5cbiAgICAgIHZhciBtMTEgPSBhWzBdKmJbMF0gKyBhWzFdKmJbM107XG4gICAgICB2YXIgbTEyID0gYVswXSpiWzFdICsgYVsxXSpiWzRdO1xuICAgICAgdmFyIG0xMyA9IGFbMF0qYlsyXSArIGFbMV0qYls1XSArIGFbMl07XG5cbiAgICAgIHZhciBtMjEgPSBhWzNdKmJbMF0gKyBhWzRdKmJbM107XG4gICAgICB2YXIgbTIyID0gYVszXSpiWzFdICsgYVs0XSpiWzRdO1xuICAgICAgdmFyIG0yMyA9IGFbM10qYlsyXSArIGFbNF0qYls1XSArIGFbNV07XG5cbiAgICAgIGFbMF09bTExOyBhWzFdPW0xMjsgYVsyXSA9IG0xMztcbiAgICAgIGFbM109bTIxOyBhWzRdPW0yMjsgYVs1XSA9IG0yMztcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKiogXG4gICAgIFxuICAgICBNdWx0aXBseSB0aGlzIG1hdHJpeCBieSBhIHJvdGF0aW9uIG1hdHJpeCByb3RhdGVkIHJhZGlhbnMgcmFkaWFucyBcblxuICAgIEBmb3IgUS5NYXRyaXgyRFxuICAgIEBtZXRob2Qgcm90YXRlXG4gICAgQHBhcmFtIHtGbG9hdH0gcmFkaWFucyAtIGFuZ2xlIHRvIHJvdGF0ZSBieVxuICAgIEBjaGFpbmFibGVcbiAgICAqL1xuICAgIHJvdGF0ZTogZnVuY3Rpb24ocmFkaWFucykge1xuICAgICAgaWYocmFkaWFucyA9PT0gMCkgeyByZXR1cm4gdGhpczsgfVxuICAgICAgdmFyIGNvcyA9IE1hdGguY29zKHJhZGlhbnMpLFxuICAgICAgICAgIHNpbiA9IE1hdGguc2luKHJhZGlhbnMpLFxuICAgICAgICAgIG0gPSB0aGlzLm07XG5cbiAgICAgIHZhciBtMTEgPSBtWzBdKmNvcyAgKyBtWzFdKnNpbjtcbiAgICAgIHZhciBtMTIgPSBtWzBdKi1zaW4gKyBtWzFdKmNvcztcblxuICAgICAgdmFyIG0yMSA9IG1bM10qY29zICArIG1bNF0qc2luO1xuICAgICAgdmFyIG0yMiA9IG1bM10qLXNpbiArIG1bNF0qY29zO1xuXG4gICAgICBtWzBdID0gbTExOyBtWzFdID0gbTEyOyAvLyBtWzJdID09IG1bMl1cbiAgICAgIG1bM10gPSBtMjE7IG1bNF0gPSBtMjI7IC8vIG1bNV0gPT0gbVs1XVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuXG4gICAgIEhlbHBlciBtZXRob2QgdG8gcm90YXRlIGJ5IGEgc2V0IG51bWJlciBvZiBkZWdyZWVzIChjYWxscyByb3RhdGUgaW50ZXJuYWxseSlcblxuICAgICBAZm9yIFEuTWF0cml4MkRcbiAgICAgQG1ldGhvZCByb3RhdGVEZWdcbiAgICAgQHBhcmFtIHtGbG9hdH0gZGVncmVlc1xuICAgICBAY2hhaW5hYmxlXG4gICAgKi9cbiAgICByb3RhdGVEZWc6IGZ1bmN0aW9uKGRlZ3JlZXMpIHtcbiAgICAgIGlmKGRlZ3JlZXMgPT09IDApIHsgcmV0dXJuIHRoaXM7IH1cbiAgICAgIHJldHVybiB0aGlzLnJvdGF0ZShNYXRoLlBJICogZGVncmVlcyAvIDE4MCk7XG4gICAgfSxcblxuICAgIC8qKlxuXG4gICAgIE11bHRpcGx5IHRoaXMgbWF0cml4IGJ5IGEgc2NhbGluZyBtYXRyaXggc2NhbGluZyBzeCBhbmQgc3lcbiAgICAgQGZvciBRLk1hdHJpeDJEXG4gICAgIEBtZXRob2Qgc2NhbGVcbiAgICAgQHBhcmFtIHtGbG9hdH0gc3ggLSBzY2FsZSBpbiB4IGRpbWVuc2lvbiAoc2NhbGluZyBpcyB1bmlmb3JtIHVubGVzcyBgc3lgIGlzIHByb3ZpZGVkKVxuICAgICBAcGFyYW0ge0Zsb2F0fSBbc3ldIC0gc2NhbGUgaW4gdGhlIHkgZGltZW5zaW9uXG4gICAgIEBjaGFpbmFibGVcbiAgICAqL1xuICAgIHNjYWxlOiBmdW5jdGlvbihzeCxzeSkge1xuICAgICAgdmFyIG0gPSB0aGlzLm07XG4gICAgICBpZihzeSA9PT0gdm9pZCAwKSB7IHN5ID0gc3g7IH1cblxuICAgICAgbVswXSAqPSBzeDtcbiAgICAgIG1bMV0gKj0gc3k7XG4gICAgICBtWzNdICo9IHN4O1xuICAgICAgbVs0XSAqPSBzeTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cblxuICAgIC8qKiBcbiAgICAgTXVsdGlwbHkgdGhpcyBtYXRyaXggYnkgYSB0cmFuc2xhdGlvbiBtYXRyaXggdHJhbnNsYXRlIGJ5IHR4IGFuZCB0eVxuXG4gICAgIEBmb3IgUS5NYXRyaXgyRFxuICAgICBAbWV0aG9kIHRyYW5zbGF0ZVxuICAgICBAcGFyYW0ge0Zsb2F0fSB0eFxuICAgICBAcGFyYW0ge0Zsb2F0fSB0eVxuICAgICBAY2hhaW5hYmxlXG4gICAgKi9cbiAgICB0cmFuc2xhdGU6IGZ1bmN0aW9uKHR4LHR5KSB7XG4gICAgICB2YXIgbSA9IHRoaXMubTtcblxuICAgICAgbVsyXSArPSBtWzBdKnR4ICsgbVsxXSp0eTtcbiAgICAgIG1bNV0gKz0gbVszXSp0eCArIG1bNF0qdHk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG5cbiAgICAvKipcbiAgICAgVHJhbnNmb3JtIHggYW5kIHkgY29vcmRpbmF0ZXMgYnkgdGhpcyBtYXRyaXhcbiAgICAgTWVtb3J5IEhvZ2d5IHZlcnNpb24sIHJldHVybnMgYSBuZXcgQXJyYXlcblxuICAgICBAZm9yIFEuTWF0cml4MkRcbiAgICAgQG1ldGhvZCB0cmFuc2Zvcm1cbiAgICAgQHBhcmFtIHtGbG9hdH0geFxuICAgICBAcGFyYW0ge0Zsb2F0fSB5XG5cbiAgICAgKi9cbiAgICB0cmFuc2Zvcm06IGZ1bmN0aW9uKHgseSkge1xuICAgICAgcmV0dXJuIFsgeCAqIHRoaXMubVswXSArIHkgKiB0aGlzLm1bMV0gKyB0aGlzLm1bMl0sIFxuICAgICAgICAgICAgICAgeCAqIHRoaXMubVszXSArIHkgKiB0aGlzLm1bNF0gKyB0aGlzLm1bNV0gXTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIFRyYW5zZm9ybSBhbiBvYmplY3Qgd2l0aCBhbiB4IGFuZCB5IHByb3BlcnR5IGJ5IHRoaXMgTWF0cml4XG4gICAgIEBmb3IgUS5NYXRyaXgyRFxuICAgICBAbWV0aG9kIHRyYW5zZm9ybVB0XG4gICAgIEBwYXJhbSB7T2JqZWN0fSBvYmpcbiAgICAgQHJldHVybiB7T2JqZWN0fSBvYmpcbiAgICAqL1xuICAgIHRyYW5zZm9ybVB0OiBmdW5jdGlvbihvYmopIHtcbiAgICAgIHZhciB4ID0gb2JqLngsIHkgPSBvYmoueTtcblxuICAgICAgb2JqLnggPSB4ICogdGhpcy5tWzBdICsgeSAqIHRoaXMubVsxXSArIHRoaXMubVsyXTtcbiAgICAgIG9iai55ID0geCAqIHRoaXMubVszXSArIHkgKiB0aGlzLm1bNF0gKyB0aGlzLm1bNV07XG5cbiAgICAgIHJldHVybiBvYmo7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICBUcmFuc2Zvcm0gYW4gYXJyYXkgd2l0aCBhbiB4IGFuZCB5IGVsZW1lbnRzIGJ5IHRoaXMgTWF0cml4IGFuZCBwdXQgdGhlIHJlc3VsdCBpbiBcbiAgICAgdGhlIG91dEFyclxuXG4gICAgIEBmb3IgUS5NYXRyaXgyRFxuICAgICBAbWV0aG9kIHRyYW5zZm9ybUFyclxuICAgICBAcGFyYW0ge0FycmF5fSBpbkFyciAtIGlucHV0IGFycmF5XG4gICAgIEBwYXJhbSB7QXJyYXl9IG91dEFyciAtIG91dHB1dCBhcnJheVxuICAgICBAcmV0dXJuIHtPYmplY3R9IG9ialxuICAgICovXG4gICAgdHJhbnNmb3JtQXJyOiBmdW5jdGlvbihpbkFycixvdXRBcnIpIHtcbiAgICAgIHZhciB4ID0gaW5BcnJbMF0sIHkgPSBpbkFyclsxXTtcbiAgICAgIFxuICAgICAgb3V0QXJyWzBdID0geCAqIHRoaXMubVswXSArIHkgKiB0aGlzLm1bMV0gKyB0aGlzLm1bMl07XG4gICAgICBvdXRBcnJbMV0gPSB4ICogdGhpcy5tWzNdICsgeSAqIHRoaXMubVs0XSArIHRoaXMubVs1XTtcblxuICAgICAgcmV0dXJuIG91dEFycjtcbiAgICB9LFxuXG5cbiAgICAvKipcbiAgICAgUmV0dXJuIGp1c3QgdGhlIHggY29vcmRpbmF0ZSB0cmFuc2Zvcm1lZCBieSB0aGlzIE1hdHJpeFxuXG4gICAgIEBmb3IgUS5NYXRyaXgyRFxuICAgICBAbWV0aG9kIHRyYW5zZm9ybVhcbiAgICAgQHBhcmFtIHtGbG9hdH0geFxuICAgICBAcGFyYW0ge0Zsb2F0fSB5XG4gICAgIEByZXR1cm4ge0Zsb2F0fSB4IHRyYW5zZm9ybWVkXG4gICAgKi9cbiAgICB0cmFuc2Zvcm1YOiBmdW5jdGlvbih4LHkpIHtcbiAgICAgIHJldHVybiB4ICogdGhpcy5tWzBdICsgeSAqIHRoaXMubVsxXSArIHRoaXMubVsyXTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIFJldHVybiBqdXN0IHRoZSB5IGNvb3JkaW5hdGUgdHJhbnNmb3JtZWQgYnkgdGhpcyBNYXRyaXhcblxuICAgICBAZm9yIFEuTWF0cml4MkRcbiAgICAgQG1ldGhvZCB0cmFuc2Zvcm1ZXG4gICAgIEBwYXJhbSB7RmxvYXR9IHhcbiAgICAgQHBhcmFtIHtGbG9hdH0geVxuICAgICBAcmV0dXJuIHtGbG9hdH0geSB0cmFuc2Zvcm1lZFxuICAgICovXG4gICAgdHJhbnNmb3JtWTogZnVuY3Rpb24oeCx5KSB7XG4gICAgICByZXR1cm4geCAqIHRoaXMubVszXSArIHkgKiB0aGlzLm1bNF0gKyB0aGlzLm1bNV07XG4gICAgfSxcblxuICAgIC8qKlxuICAgICBSZWxlYXNlIHRoaXMgTWF0cml4IHRvIGJlIHJldXNlZFxuXG4gICAgIEBmb3IgUS5NYXRyaXgyRFxuICAgICBAbWV0aG9kIHJlbGVhc2VcbiAgICAqL1xuICAgIHJlbGVhc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgUS5tYXRyaWNlczJkLnB1c2godGhpcyk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIFNldCB0aGUgY29tcGxldGUgdHJhbnNmb3JtIG9uIGEgQ2FudmFzIDJEIGNvbnRleHRcblxuICAgICBAZm9yIFEuTWF0cml4MkRcbiAgICAgQG1ldGhvZCBzZXRDb250ZXh0VHJhbnNmb3JtXG4gICAgIEBwYXJhbSB7Q29udGV4dDJEfSBjdHggLSAyRCBjYW52cyBjb250ZXh0XG4gICAgICovICBcbiAgICAgc2V0Q29udGV4dFRyYW5zZm9ybTogZnVuY3Rpb24oY3R4KSB7XG4gICAgICB2YXIgbSA9IHRoaXMubTtcbiAgICAgIC8vIHNvdXJjZTpcbiAgICAgIC8vICBtWzBdIG1bMV0gbVsyXVxuICAgICAgLy8gIG1bM10gbVs0XSBtWzVdXG4gICAgICAvLyAgMCAgICAgMCAgIDFcbiAgICAgIC8vXG4gICAgICAvLyBkZXN0aW5hdGlvbjpcbiAgICAgIC8vICBtMTEgIG0yMSAgZHhcbiAgICAgIC8vICBtMTIgIG0yMiAgZHlcbiAgICAgIC8vICAwICAgIDAgICAgMVxuICAgICAgLy8gIHNldFRyYW5zZm9ybShtMTEsIG0xMiwgbTIxLCBtMjIsIGR4LCBkeSlcbiAgICAgIGN0eC50cmFuc2Zvcm0obVswXSxtWzNdLG1bMV0sbVs0XSxtWzJdLG1bNV0pO1xuICAgIH1cblxuICB9KTtcblxuICAvLyBBbmQgdGhhdCdzIGl0Li5cbiAgLy8gPT09PT09PT09PT09PT09XG4gIC8vXG4gIC8vIFJldHVybiB0aGUgYFFgIG9iamVjdCBmcm9tIHRoZSBgUXVpbnR1cygpYCBmYWN0b3J5IG1ldGhvZC4gQ3JlYXRlIGF3ZXNvbWUgZ2FtZXMuIFJlcGVhdC5cbiAgcmV0dXJuIFE7XG59O1xuXG4vLyBMYXN0bHksIGFkZCBpbiB0aGUgYHJlcXVlc3RBbmltYXRpb25GcmFtZWAgc2hpbSwgaWYgbmVjZXNzYXJ5LiBEb2VzIG5vdGhpbmcgXG4vLyBpZiBgcmVxdWVzdEFuaW1hdGlvbkZyYW1lYCBpcyBhbHJlYWR5IG9uIHRoZSBgd2luZG93YCBvYmplY3QuXG4oZnVuY3Rpb24oKSB7XG4gICAgdmFyIGxhc3RUaW1lID0gMDtcbiAgICB2YXIgdmVuZG9ycyA9IFsnbXMnLCAnbW96JywgJ3dlYmtpdCcsICdvJ107XG4gICAgZm9yKHZhciB4ID0gMDsgeCA8IHZlbmRvcnMubGVuZ3RoICYmICF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lOyArK3gpIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvd1t2ZW5kb3JzW3hdKydSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcbiAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gXG4gICAgICAgICAgd2luZG93W3ZlbmRvcnNbeF0rJ0NhbmNlbEFuaW1hdGlvbkZyYW1lJ10gfHwgd2luZG93W3ZlbmRvcnNbeF0rJ0NhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZSddO1xuICAgIH1cbiBcbiAgICBpZiAoIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgY3VyclRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgIHZhciB0aW1lVG9DYWxsID0gTWF0aC5tYXgoMCwgMTYgLSAoY3VyclRpbWUgLSBsYXN0VGltZSkpO1xuICAgICAgICAgICAgdmFyIGlkID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IGNhbGxiYWNrKGN1cnJUaW1lICsgdGltZVRvQ2FsbCk7IH0sIFxuICAgICAgICAgICAgICB0aW1lVG9DYWxsKTtcbiAgICAgICAgICAgIGxhc3RUaW1lID0gY3VyclRpbWUgKyB0aW1lVG9DYWxsO1xuICAgICAgICAgICAgcmV0dXJuIGlkO1xuICAgICAgICB9O1xuICAgIH1cbiBcbiAgICBpZiAoIXdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSkge1xuICAgICAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGlkKTtcbiAgICAgICAgfTtcbiAgICB9XG59KCkpO1xuXG5cbiIsIi8qZ2xvYmFsIFF1aW50dXM6ZmFsc2UgKi9cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihRKSB7XG5cbiAgUS5jb21wb25lbnQoJ3ZpZXdwb3J0Jyx7XG4gICAgYWRkZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5lbnRpdHkub24oJ3ByZXJlbmRlcicsdGhpcywncHJlcmVuZGVyJyk7XG4gICAgICB0aGlzLmVudGl0eS5vbigncmVuZGVyJyx0aGlzLCdwb3N0cmVuZGVyJyk7XG4gICAgICB0aGlzLnggPSAwO1xuICAgICAgdGhpcy55ID0gMDtcbiAgICAgIHRoaXMub2Zmc2V0WCA9IDA7XG4gICAgICB0aGlzLm9mZnNldFkgPSAwO1xuICAgICAgdGhpcy5jZW50ZXJYID0gUS53aWR0aC8yO1xuICAgICAgdGhpcy5jZW50ZXJZID0gUS5oZWlnaHQvMjtcbiAgICAgIHRoaXMuc2NhbGUgPSAxO1xuICAgIH0sXG5cbiAgICBleHRlbmQ6IHtcbiAgICAgIGZvbGxvdzogZnVuY3Rpb24oc3ByaXRlLGRpcmVjdGlvbnMsYm91bmRpbmdCb3gpIHtcbiAgICAgICAgdGhpcy5vZmYoJ3Bvc3RzdGVwJyx0aGlzLnZpZXdwb3J0LCdmb2xsb3cnKTtcbiAgICAgICAgdGhpcy52aWV3cG9ydC5kaXJlY3Rpb25zID0gZGlyZWN0aW9ucyB8fCB7IHg6IHRydWUsIHk6IHRydWUgfTtcbiAgICAgICAgdGhpcy52aWV3cG9ydC5mb2xsb3dpbmcgPSBzcHJpdGU7XG4gICAgICAgIHRoaXMudmlld3BvcnQuYm91bmRpbmdCb3ggPSBib3VuZGluZ0JveDtcbiAgICAgICAgdGhpcy5vbigncG9zdHN0ZXAnLHRoaXMudmlld3BvcnQsJ2ZvbGxvdycpO1xuICAgICAgICB0aGlzLnZpZXdwb3J0LmZvbGxvdyh0cnVlKTtcbiAgICAgIH0sXG5cbiAgICAgIHVuZm9sbG93OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5vZmYoJ3Bvc3RzdGVwJyx0aGlzLnZpZXdwb3J0LCdmb2xsb3cnKTtcbiAgICAgIH0sXG5cbiAgICAgIGNlbnRlck9uOiBmdW5jdGlvbih4LHkpIHtcbiAgICAgICAgdGhpcy52aWV3cG9ydC5jZW50ZXJPbih4LHkpO1xuICAgICAgfSxcblxuICAgICAgbW92ZVRvOiBmdW5jdGlvbih4LHkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3BvcnQubW92ZVRvKHgseSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGZvbGxvdzogZnVuY3Rpb24oZmlyc3QpIHtcbiAgICAgIHZhciBmb2xsb3dYID0gUS5faXNGdW5jdGlvbih0aGlzLmRpcmVjdGlvbnMueCkgPyB0aGlzLmRpcmVjdGlvbnMueCh0aGlzLmZvbGxvd2luZykgOiB0aGlzLmRpcmVjdGlvbnMueDtcbiAgICAgIHZhciBmb2xsb3dZID0gUS5faXNGdW5jdGlvbih0aGlzLmRpcmVjdGlvbnMueSkgPyB0aGlzLmRpcmVjdGlvbnMueSh0aGlzLmZvbGxvd2luZykgOiB0aGlzLmRpcmVjdGlvbnMueTtcblxuICAgICAgdGhpc1tmaXJzdCA9PT0gdHJ1ZSA/ICdjZW50ZXJPbicgOiAnc29mdENlbnRlck9uJ10oXG4gICAgICAgICAgICAgICAgICAgIGZvbGxvd1ggPyBcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZvbGxvd2luZy5wLnggKyB0aGlzLmZvbGxvd2luZy5wLncvMiAtIHRoaXMub2Zmc2V0WCA6XG4gICAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBmb2xsb3dZID9cbiAgICAgICAgICAgICAgICAgICAgIHRoaXMuZm9sbG93aW5nLnAueSArIHRoaXMuZm9sbG93aW5nLnAuaC8yIC0gdGhpcy5vZmZzZXRZIDpcbiAgICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgKTtcbiAgICB9LFxuXG4gICAgb2Zmc2V0OiBmdW5jdGlvbih4LHkpIHtcbiAgICAgIHRoaXMub2Zmc2V0WCA9IHg7XG4gICAgICB0aGlzLm9mZnNldFkgPSB5O1xuICAgIH0sXG5cbiAgICBzb2Z0Q2VudGVyT246IGZ1bmN0aW9uKHgseSkge1xuICAgICAgaWYoeCAhPT0gdm9pZCAwKSB7ICAgICAgICBcbiAgICAgICAgdmFyIGR4ID0gKHggLSBRLndpZHRoIC8gMiAvIHRoaXMuc2NhbGUgLSB0aGlzLngpLzM7XG4gICAgICAgIGlmKHRoaXMuYm91bmRpbmdCb3gpIHtcbiAgICAgICAgICBpZih0aGlzLnggKyBkeCA8IHRoaXMuYm91bmRpbmdCb3gubWluWCkge1xuICAgICAgICAgICAgdGhpcy54ID0gdGhpcy5ib3VuZGluZ0JveC5taW5YIC8gdGhpcy5zY2FsZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih0aGlzLnggKyBkeCA+ICh0aGlzLmJvdW5kaW5nQm94Lm1heFggLSBRLndpZHRoKSAvIHRoaXMuc2NhbGUpIHtcbiAgICAgICAgICAgIHRoaXMueCA9ICh0aGlzLmJvdW5kaW5nQm94Lm1heFggLSBRLndpZHRoKSAvIHRoaXMuc2NhbGU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy54ICs9IGR4O1xuICAgICAgICAgIH0gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLnggKz0gZHg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKHkgIT09IHZvaWQgMCkgeyBcbiAgICAgICAgdmFyIGR5ID0gKHkgLSBRLmhlaWdodCAvIDIgLyB0aGlzLnNjYWxlIC0gdGhpcy55KS8zO1xuICAgICAgICBpZih0aGlzLmJvdW5kaW5nQm94KSB7XG4gICAgICAgICAgaWYodGhpcy55ICsgZHkgPCB0aGlzLmJvdW5kaW5nQm94Lm1pblkpIHtcbiAgICAgICAgICAgIHRoaXMueSA9IHRoaXMuYm91bmRpbmdCb3gubWluWSAvIHRoaXMuc2NhbGU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodGhpcy55ICsgZHkgPiAodGhpcy5ib3VuZGluZ0JveC5tYXhZIC0gUS5oZWlnaHQpIC8gdGhpcy5zY2FsZSkge1xuICAgICAgICAgICAgdGhpcy55ID0gKHRoaXMuYm91bmRpbmdCb3gubWF4WSAtIFEuaGVpZ2h0KSAvIHRoaXMuc2NhbGU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy55ICs9IGR5O1xuICAgICAgICAgIH0gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLnkgKz0gZHk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH0sXG4gICAgY2VudGVyT246IGZ1bmN0aW9uKHgseSkge1xuICAgICAgaWYoeCAhPT0gdm9pZCAwKSB7XG4gICAgICAgIHRoaXMueCA9IHggLSBRLndpZHRoIC8gMiAvIHRoaXMuc2NhbGU7XG4gICAgICB9XG4gICAgICBpZih5ICE9PSB2b2lkIDApIHsgXG4gICAgICAgIHRoaXMueSA9IHkgLSBRLmhlaWdodCAvIDIgLyB0aGlzLnNjYWxlO1xuICAgICAgfVxuXG4gICAgfSxcblxuICAgIG1vdmVUbzogZnVuY3Rpb24oeCx5KSB7XG4gICAgICBpZih4ICE9PSB2b2lkIDApIHtcbiAgICAgICAgdGhpcy54ID0geDtcbiAgICAgIH1cbiAgICAgIGlmKHkgIT09IHZvaWQgMCkgeyBcbiAgICAgICAgdGhpcy55ID0geTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmVudGl0eTtcblxuICAgIH0sXG5cbiAgICBwcmVyZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5jZW50ZXJYID0gdGhpcy54ICsgUS53aWR0aCAvIDIgL3RoaXMuc2NhbGU7XG4gICAgICB0aGlzLmNlbnRlclkgPSB0aGlzLnkgKyBRLmhlaWdodCAvIDIgL3RoaXMuc2NhbGU7XG4gICAgICBRLmN0eC5zYXZlKCk7XG4gICAgICBRLmN0eC50cmFuc2xhdGUoTWF0aC5mbG9vcihRLndpZHRoLzIpLE1hdGguZmxvb3IoUS5oZWlnaHQvMikpO1xuICAgICAgUS5jdHguc2NhbGUodGhpcy5zY2FsZSx0aGlzLnNjYWxlKTtcbiAgICAgIFEuY3R4LnRyYW5zbGF0ZSgtTWF0aC5mbG9vcih0aGlzLmNlbnRlclgpLCAtTWF0aC5mbG9vcih0aGlzLmNlbnRlclkpKTtcbiAgICB9LFxuXG4gICAgcG9zdHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICBRLmN0eC5yZXN0b3JlKCk7XG4gICAgfVxuICB9KTtcblxuXG4gUS5TcHJpdGUuZXh0ZW5kKFwiVGlsZUxheWVyXCIse1xuXG4gICAgaW5pdDogZnVuY3Rpb24ocHJvcHMpIHtcbiAgICAgIHRoaXMuX3N1cGVyKHByb3BzLHtcbiAgICAgICAgdGlsZVc6IDMyLFxuICAgICAgICB0aWxlSDogMzIsXG4gICAgICAgIGJsb2NrVGlsZVc6IDEwLFxuICAgICAgICBibG9ja1RpbGVIOiAxMCxcbiAgICAgICAgdHlwZTogMSxcbiAgICAgICAgcmVuZGVyQWx3YXlzOiB0cnVlXG4gICAgICB9KTtcbiAgICAgIGlmKHRoaXMucC5kYXRhQXNzZXQpIHtcbiAgICAgICAgdGhpcy5sb2FkKHRoaXMucC5kYXRhQXNzZXQpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnNldERpbWVuc2lvbnMoKTtcblxuICAgICAgdGhpcy5ibG9ja3MgPSBbXTtcbiAgICAgIHRoaXMucC5ibG9ja1cgPSB0aGlzLnAudGlsZVcgKiB0aGlzLnAuYmxvY2tUaWxlVztcbiAgICAgIHRoaXMucC5ibG9ja0ggPSB0aGlzLnAudGlsZUggKiB0aGlzLnAuYmxvY2tUaWxlSDtcbiAgICAgIHRoaXMuY29sQm91bmRzID0ge307IFxuICAgICAgdGhpcy5kaXJlY3Rpb25zID0gWyAndG9wJywnbGVmdCcsJ3JpZ2h0JywnYm90dG9tJ107XG4gICAgICB0aGlzLnRpbGVQcm9wZXJ0aWVzID0ge307XG5cbiAgICAgIHRoaXMuY29sbGlzaW9uT2JqZWN0ID0geyBcbiAgICAgICAgcDoge1xuICAgICAgICAgIHc6IHRoaXMucC50aWxlVyxcbiAgICAgICAgICBoOiB0aGlzLnAudGlsZUgsXG4gICAgICAgICAgY3g6IHRoaXMucC50aWxlVy8yLFxuICAgICAgICAgIGN5OiB0aGlzLnAudGlsZUgvMlxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgXG4gICAgICB0aGlzLnRpbGVDb2xsaXNpb25PYmplY3RzID0ge307ICAgICAgXG5cbiAgICAgIHRoaXMuY29sbGlzaW9uTm9ybWFsID0geyBzZXBhcmF0ZTogW119O1xuXG4gICAgICB0aGlzLl9nZW5lcmF0ZUNvbGxpc2lvbk9iamVjdHMoKTtcbiAgICB9LFxuXG4gICAgLy8gR2VuZXJhdGUgdGhlIHRpbGVDb2xsaXNpb25PYmplY3Qgb3ZlcnJpZGVzIHdoZXJlIG5lZWRlZFxuICAgIF9nZW5lcmF0ZUNvbGxpc2lvbk9iamVjdHM6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICBmdW5jdGlvbiByZXR1cm5Qb2ludChwdCkge1xuICAgICAgICByZXR1cm4gWyBwdFswXSAqIHNlbGYucC50aWxlVyAtIHNlbGYucC50aWxlVy8yLFxuICAgICAgICAgICAgICAgICBwdFsxXSAqIHNlbGYucC50aWxlSCAtIHNlbGYucC50aWxlSC8yXG4gICAgICAgICAgICAgICBdO1xuICAgICAgfVxuXG4gICAgICBpZih0aGlzLnNoZWV0KCkgJiYgdGhpcy5zaGVldCgpLmZyYW1lUHJvcGVydGllcykge1xuICAgICAgICB2YXIgZnJhbWVQcm9wZXJ0aWVzID0gdGhpcy5zaGVldCgpLmZyYW1lUHJvcGVydGllcztcbiAgICAgICAgZm9yKHZhciBrIGluIGZyYW1lUHJvcGVydGllcykgeyBcbiAgICAgICAgICB2YXIgY29sT2JqID0gdGhpcy50aWxlQ29sbGlzaW9uT2JqZWN0c1trXSA9IHsgcDogUS5fY2xvbmUodGhpcy5jb2xsaXNpb25PYmplY3QucCkgfTtcbiAgICAgICAgICBRLl9leHRlbmQoY29sT2JqLnAsZnJhbWVQcm9wZXJ0aWVzW2tdKTtcblxuICAgICAgICAgIGlmKGNvbE9iai5wLnBvaW50cykge1xuICAgICAgICAgICAgY29sT2JqLnAucG9pbnRzID0gUS5fbWFwKGNvbE9iai5wLnBvaW50cywgcmV0dXJuUG9pbnQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMudGlsZUNvbGxpc2lvbk9iamVjdHNba10gPSBjb2xPYmo7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH0sXG5cbiAgICBsb2FkOiBmdW5jdGlvbihkYXRhQXNzZXQpIHtcbiAgICAgIHZhciBmaWxlUGFydHMgPSBkYXRhQXNzZXQuc3BsaXQoXCIuXCIpLFxuICAgICAgICAgIGZpbGVFeHQgPSBmaWxlUGFydHNbZmlsZVBhcnRzLmxlbmd0aC0xXS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgIGRhdGE7XG5cbiAgICAgIGlmIChmaWxlRXh0ID09PSBcImpzb25cIikgeyAgXG4gICAgICAgIGRhdGEgPSBRLl9pc1N0cmluZyhkYXRhQXNzZXQpID8gIFEuYXNzZXQoZGF0YUFzc2V0KSA6IGRhdGFBc3NldDtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aHJvdyBcImZpbGUgdHlwZSBub3Qgc3VwcG9ydGVkXCI7XG4gICAgICB9XG4gICAgICB0aGlzLnAudGlsZXMgPSBkYXRhO1xuICAgIH0sXG5cbiAgICBzZXREaW1lbnNpb25zOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciB0aWxlcyA9IHRoaXMucC50aWxlcztcblxuICAgICAgaWYodGlsZXMpIHsgXG4gICAgICAgIHRoaXMucC5yb3dzID0gdGlsZXMubGVuZ3RoO1xuICAgICAgICB0aGlzLnAuY29scyA9IHRpbGVzWzBdLmxlbmd0aDtcbiAgICAgICAgdGhpcy5wLncgPSB0aGlzLnAuY29scyAqIHRoaXMucC50aWxlVztcbiAgICAgICAgdGhpcy5wLmggPSB0aGlzLnAucm93cyAqIHRoaXMucC50aWxlSDtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0VGlsZTogZnVuY3Rpb24odGlsZVgsdGlsZVkpIHtcbiAgICAgIHJldHVybiB0aGlzLnAudGlsZXNbdGlsZVldICYmIHRoaXMucC50aWxlc1t0aWxlWV1bdGlsZVhdO1xuICAgIH0sXG4gICAgXG4gICAgZ2V0VGlsZVByb3BlcnR5OiBmdW5jdGlvbih0aWxlLCBwcm9wKSB7XG4gICAgICBpZih0aGlzLnRpbGVQcm9wZXJ0aWVzW3RpbGVdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGlsZVByb3BlcnRpZXNbdGlsZV1bcHJvcF07ICAgICAgICAgIFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSAgICAgIFxuICAgIH0sXG4gICAgXG4gICAgZ2V0VGlsZVByb3BlcnRpZXM6IGZ1bmN0aW9uKHRpbGUpIHtcbiAgICAgIGlmKHRoaXMudGlsZVByb3BlcnRpZXNbdGlsZV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aWxlUHJvcGVydGllc1t0aWxlXTsgICAgICAgICAgXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4ge307XG4gICAgICB9XG4gICAgfSxcbiAgICBcbiAgICBnZXRUaWxlUHJvcGVydHlBdDogZnVuY3Rpb24odGlsZVgsIHRpbGVZLCBwcm9wKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRUaWxlUHJvcGVydHkodGhpcy5nZXRUaWxlKHRpbGVYLCB0aWxlWSksIHByb3ApO1xuICAgIH0sXG4gICAgXG4gICAgZ2V0VGlsZVByb3BlcnRpZXNBdDogZnVuY3Rpb24odGlsZVgsIHRpbGVZKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRUaWxlUHJvcGVydGllcyh0aGlzLmdldFRpbGUodGlsZVgsIHRpbGVZKSk7XG4gICAgfSxcbiAgICBcbiAgICB0aWxlSGFzUHJvcGVydHk6IGZ1bmN0aW9uKHRpbGUsIHByb3ApIHtcbiAgICAgIHJldHVybih0aGlzLmdldFRpbGVQcm9wZXJ0eSh0aWxlLCBwcm9wKSAhPT0gdW5kZWZpbmVkKTtcbiAgICB9LCAgICBcblxuICAgIHNldFRpbGU6IGZ1bmN0aW9uKHgseSx0aWxlKSB7XG4gICAgICB2YXIgcCA9IHRoaXMucCxcbiAgICAgICAgICBibG9ja1ggPSBNYXRoLmZsb29yKHgvcC5ibG9ja1RpbGVXKSxcbiAgICAgICAgICBibG9ja1kgPSBNYXRoLmZsb29yKHkvcC5ibG9ja1RpbGVIKTtcblxuICAgICAgaWYoeCA+PSAwICYmIHggPCB0aGlzLnAuY29scyAmJlxuICAgICAgICAgeSA+PSAwICYmIHkgPCB0aGlzLnAucm93cykgeyBcblxuICAgICAgICB0aGlzLnAudGlsZXNbeV1beF0gPSB0aWxlO1xuXG4gICAgICAgIGlmKHRoaXMuYmxvY2tzW2Jsb2NrWV0pIHtcbiAgICAgICAgICB0aGlzLmJsb2Nrc1tibG9ja1ldW2Jsb2NrWF0gPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIHRpbGVQcmVzZW50OiBmdW5jdGlvbih0aWxlWCx0aWxlWSkge1xuICAgICAgcmV0dXJuIHRoaXMucC50aWxlc1t0aWxlWV0gJiYgdGhpcy5jb2xsaWRhYmxlVGlsZSh0aGlzLnAudGlsZXNbdGlsZVldW3RpbGVYXSk7XG4gICAgfSxcblxuICAgIC8vIE92ZXJsb2FkIHRoaXMgbWV0aG9kIHRvIGRyYXcgdGlsZXMgYXQgZnJhbWUgMCBvciBub3QgZHJhd1xuICAgIC8vIHRpbGVzIGF0IGhpZ2hlciBudW1iZXIgZnJhbWVzXG4gICAgZHJhd2FibGVUaWxlOiBmdW5jdGlvbih0aWxlTnVtKSB7XG4gICAgICByZXR1cm4gdGlsZU51bSA+IDA7XG4gICAgfSxcblxuICAgIC8vIE92ZXJsb2FkIHRoaXMgbWV0aG9kIHRvIGNvbnRyb2wgd2hpY2ggdGlsZXMgdHJpZ2dlciBhIGNvbGxpc2lvblxuICAgIC8vIChkZWZhdWx0cyB0byBhbGwgdGlsZXMgPiBudW1iZXIgMClcbiAgICBjb2xsaWRhYmxlVGlsZTogZnVuY3Rpb24odGlsZU51bSkge1xuICAgICAgcmV0dXJuIHRpbGVOdW0gPiAwO1xuICAgIH0sXG4gICAgXG4gICAgZ2V0Q29sbGlzaW9uT2JqZWN0OiBmdW5jdGlvbih0aWxlWCwgdGlsZVkpIHtcbiAgICAgIHZhciBwID0gdGhpcy5wLFxuICAgICAgICAgIHRpbGUgPSB0aGlzLmdldFRpbGUodGlsZVgsIHRpbGVZKSxcbiAgICAgICAgICBjb2xPYmo7XG4gICAgICBcbiAgICAgIGNvbE9iaiA9ICh0aGlzLnRpbGVDb2xsaXNpb25PYmplY3RzW3RpbGVdICE9PSB1bmRlZmluZWQpID8gXG4gICAgICAgIHRoaXMudGlsZUNvbGxpc2lvbk9iamVjdHNbdGlsZV0gOiB0aGlzLmNvbGxpc2lvbk9iamVjdDsgICAgIFxuICAgICAgXG4gICAgICBjb2xPYmoucC54ID0gdGlsZVggKiBwLnRpbGVXICsgcC54ICsgcC50aWxlVy8yO1xuICAgICAgY29sT2JqLnAueSA9IHRpbGVZICogcC50aWxlSCArIHAueSArIHAudGlsZUgvMjtcbiAgICAgIFxuICAgICAgcmV0dXJuIGNvbE9iajtcbiAgICB9LFxuXG4gICAgY29sbGlkZTogZnVuY3Rpb24ob2JqKSB7XG4gICAgICB2YXIgcCA9IHRoaXMucCxcbiAgICAgICAgICBvYmpQID0gb2JqLmMgfHwgb2JqLnAsIFxuICAgICAgICAgIHRpbGVTdGFydFggPSBNYXRoLmZsb29yKChvYmpQLnggLSBvYmpQLmN4IC0gcC54KSAvIHAudGlsZVcpLFxuICAgICAgICAgIHRpbGVTdGFydFkgPSBNYXRoLmZsb29yKChvYmpQLnkgLSBvYmpQLmN5IC0gcC55KSAvIHAudGlsZUgpLFxuICAgICAgICAgIHRpbGVFbmRYID0gIE1hdGguY2VpbCgob2JqUC54IC0gb2JqUC5jeCArIG9ialAudyAtIHAueCkgLyBwLnRpbGVXKSxcbiAgICAgICAgICB0aWxlRW5kWSA9ICBNYXRoLmNlaWwoKG9ialAueSAtIG9ialAuY3kgKyBvYmpQLmggLSBwLnkpIC8gcC50aWxlSCksXG4gICAgICAgICAgbm9ybWFsID0gdGhpcy5jb2xsaXNpb25Ob3JtYWwsXG4gICAgICAgICAgY29sLCBjb2xPYmo7XG4gIFxuICAgICAgbm9ybWFsLmNvbGxpZGVkID0gZmFsc2U7XG5cbiAgICAgIGZvcih2YXIgdGlsZVkgPSB0aWxlU3RhcnRZOyB0aWxlWTw9dGlsZUVuZFk7IHRpbGVZKyspIHtcbiAgICAgICAgZm9yKHZhciB0aWxlWCA9IHRpbGVTdGFydFg7IHRpbGVYPD10aWxlRW5kWDsgdGlsZVgrKykge1xuICAgICAgICAgIGlmKHRoaXMudGlsZVByZXNlbnQodGlsZVgsdGlsZVkpKSB7XG4gICAgICAgICAgICBjb2xPYmogPSB0aGlzLmdldENvbGxpc2lvbk9iamVjdCh0aWxlWCwgdGlsZVkpO1xuXG4gICAgICAgICAgICBjb2wgPSBRLmNvbGxpc2lvbihvYmosY29sT2JqKTtcbiAgICAgIFxuICAgICAgICAgICAgaWYoY29sICYmIGNvbC5tYWduaXR1ZGUgPiAwKSB7XG4gICAgICAgICAgICAgIGlmKGNvbE9iai5wLnNlbnNvcikge1xuICAgICAgICAgICAgICAgIGNvbE9iai50aWxlID0gdGhpcy5nZXRUaWxlKHRpbGVYLHRpbGVZKTtcbiAgICAgICAgICAgICAgICBpZihvYmoudHJpZ2dlcikgeyBcbiAgICAgICAgICAgICAgICAgIG9iai50cmlnZ2VyKCdzZW5zb3IudGlsZScsY29sT2JqKTsgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2UgaWYoIW5vcm1hbC5jb2xsaWRlZCB8fCBub3JtYWwubWFnbml0dWRlIDwgY29sLm1hZ25pdHVkZSApIHtcbiAgICAgICAgICAgICAgICAgbm9ybWFsLmNvbGxpZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgbm9ybWFsLnNlcGFyYXRlWzBdID0gY29sLnNlcGFyYXRlWzBdO1xuICAgICAgICAgICAgICAgICBub3JtYWwuc2VwYXJhdGVbMV0gPSBjb2wuc2VwYXJhdGVbMV07XG4gICAgICAgICAgICAgICAgIG5vcm1hbC5tYWduaXR1ZGUgPSBjb2wubWFnbml0dWRlO1xuICAgICAgICAgICAgICAgICBub3JtYWwuZGlzdGFuY2UgPSBjb2wuZGlzdGFuY2U7XG4gICAgICAgICAgICAgICAgIG5vcm1hbC5ub3JtYWxYID0gY29sLm5vcm1hbFg7XG4gICAgICAgICAgICAgICAgIG5vcm1hbC5ub3JtYWxZID0gY29sLm5vcm1hbFk7XG4gICAgICAgICAgICAgICAgIG5vcm1hbC50aWxlWCA9IHRpbGVYO1xuICAgICAgICAgICAgICAgICBub3JtYWwudGlsZVkgPSB0aWxlWTtcbiAgICAgICAgICAgICAgICAgbm9ybWFsLnRpbGUgPSB0aGlzLmdldFRpbGUodGlsZVgsdGlsZVkpO1xuICAgICAgICAgICAgICAgICBpZihvYmoucC5jb2xsaXNpb25zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICBvYmoucC5jb2xsaXNpb25zLnB1c2gobm9ybWFsKTsgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBub3JtYWwuY29sbGlkZWQgPyBub3JtYWwgOiBmYWxzZTtcbiAgICB9LFxuXG4gICAgcHJlcmVuZGVyQmxvY2s6IGZ1bmN0aW9uKGJsb2NrWCxibG9ja1kpIHtcbiAgICAgIHZhciBwID0gdGhpcy5wLFxuICAgICAgICAgIHRpbGVzID0gcC50aWxlcyxcbiAgICAgICAgICBzaGVldCA9IHRoaXMuc2hlZXQoKSxcbiAgICAgICAgICBibG9ja09mZnNldFggPSBibG9ja1gqcC5ibG9ja1RpbGVXLFxuICAgICAgICAgIGJsb2NrT2Zmc2V0WSA9IGJsb2NrWSpwLmJsb2NrVGlsZUg7XG5cbiAgICAgIGlmKGJsb2NrT2Zmc2V0WCA8IDAgfHwgYmxvY2tPZmZzZXRYID49IHRoaXMucC5jb2xzIHx8XG4gICAgICAgICBibG9ja09mZnNldFkgPCAwIHx8IGJsb2NrT2Zmc2V0WSA+PSB0aGlzLnAucm93cykge1xuICAgICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKSxcbiAgICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgY2FudmFzLndpZHRoID0gcC5ibG9ja1c7XG4gICAgICBjYW52YXMuaGVpZ2h0PSBwLmJsb2NrSDtcbiAgICAgIHRoaXMuYmxvY2tzW2Jsb2NrWV0gPSB0aGlzLmJsb2Nrc1tibG9ja1ldIHx8IHt9O1xuICAgICAgdGhpcy5ibG9ja3NbYmxvY2tZXVtibG9ja1hdID0gY2FudmFzO1xuXG4gICAgICBmb3IodmFyIHk9MDt5PHAuYmxvY2tUaWxlSDt5KyspIHtcbiAgICAgICAgaWYodGlsZXNbeStibG9ja09mZnNldFldKSB7XG4gICAgICAgICAgZm9yKHZhciB4PTA7eDxwLmJsb2NrVGlsZVc7eCsrKSB7XG4gICAgICAgICAgICBpZih0aGlzLmRyYXdhYmxlVGlsZSh0aWxlc1t5K2Jsb2NrT2Zmc2V0WV1beCtibG9ja09mZnNldFhdKSkge1xuICAgICAgICAgICAgICBzaGVldC5kcmF3KGN0eCxcbiAgICAgICAgICAgICAgICAgICAgICAgICB4KnAudGlsZVcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgeSpwLnRpbGVILFxuICAgICAgICAgICAgICAgICAgICAgICAgIHRpbGVzW3krYmxvY2tPZmZzZXRZXVt4K2Jsb2NrT2Zmc2V0WF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBkcmF3QmxvY2s6IGZ1bmN0aW9uKGN0eCwgYmxvY2tYLCBibG9ja1kpIHtcbiAgICAgIHZhciBwID0gdGhpcy5wLFxuICAgICAgICAgIHN0YXJ0WCA9IE1hdGguZmxvb3IoYmxvY2tYICogcC5ibG9ja1cgKyBwLngpLFxuICAgICAgICAgIHN0YXJ0WSA9IE1hdGguZmxvb3IoYmxvY2tZICogcC5ibG9ja0ggKyBwLnkpO1xuXG4gICAgICBpZighdGhpcy5ibG9ja3NbYmxvY2tZXSB8fCAhdGhpcy5ibG9ja3NbYmxvY2tZXVtibG9ja1hdKSB7XG4gICAgICAgIHRoaXMucHJlcmVuZGVyQmxvY2soYmxvY2tYLGJsb2NrWSk7XG4gICAgICB9XG5cbiAgICAgIGlmKHRoaXMuYmxvY2tzW2Jsb2NrWV0gICYmIHRoaXMuYmxvY2tzW2Jsb2NrWV1bYmxvY2tYXSkge1xuICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMuYmxvY2tzW2Jsb2NrWV1bYmxvY2tYXSxzdGFydFgsc3RhcnRZKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgZHJhdzogZnVuY3Rpb24oY3R4KSB7XG4gICAgICB2YXIgcCA9IHRoaXMucCxcbiAgICAgICAgICB2aWV3cG9ydCA9IHRoaXMuc3RhZ2Uudmlld3BvcnQsXG4gICAgICAgICAgc2NhbGUgPSB2aWV3cG9ydCA/IHZpZXdwb3J0LnNjYWxlIDogMSxcbiAgICAgICAgICB4ID0gdmlld3BvcnQgPyB2aWV3cG9ydC54IDogMCxcbiAgICAgICAgICB5ID0gdmlld3BvcnQgPyB2aWV3cG9ydC55IDogMCxcbiAgICAgICAgICB2aWV3VyA9IFEud2lkdGggLyBzY2FsZSxcbiAgICAgICAgICB2aWV3SCA9IFEuaGVpZ2h0IC8gc2NhbGUsXG4gICAgICAgICAgc3RhcnRCbG9ja1ggPSBNYXRoLmZsb29yKCh4IC0gcC54KSAvIHAuYmxvY2tXKSxcbiAgICAgICAgICBzdGFydEJsb2NrWSA9IE1hdGguZmxvb3IoKHkgLSBwLnkpIC8gcC5ibG9ja0gpLFxuICAgICAgICAgIGVuZEJsb2NrWCA9IE1hdGguZmxvb3IoKHggKyB2aWV3VyAtIHAueCkgLyBwLmJsb2NrVyksXG4gICAgICAgICAgZW5kQmxvY2tZID0gTWF0aC5mbG9vcigoeSArIHZpZXdIIC0gcC55KSAvIHAuYmxvY2tIKTtcblxuICAgICAgZm9yKHZhciBpeT1zdGFydEJsb2NrWTtpeTw9ZW5kQmxvY2tZO2l5KyspIHtcbiAgICAgICAgZm9yKHZhciBpeD1zdGFydEJsb2NrWDtpeDw9ZW5kQmxvY2tYO2l4KyspIHtcbiAgICAgICAgICB0aGlzLmRyYXdCbG9jayhjdHgsaXgsaXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBRLmdyYXZpdHlZID0gOS44KjEwMDtcbiAgUS5ncmF2aXR5WCA9IDA7XG5cbiAgUS5jb21wb25lbnQoJzJkJyx7XG4gICAgYWRkZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGVudGl0eSA9IHRoaXMuZW50aXR5O1xuICAgICAgUS5fZGVmYXVsdHMoZW50aXR5LnAse1xuICAgICAgICB2eDogMCxcbiAgICAgICAgdnk6IDAsXG4gICAgICAgIGF4OiAwLFxuICAgICAgICBheTogMCxcbiAgICAgICAgZ3Jhdml0eTogMSxcbiAgICAgICAgY29sbGlzaW9uTWFzazogUS5TUFJJVEVfREVGQVVMVFxuICAgICAgfSk7XG4gICAgICBlbnRpdHkub24oJ3N0ZXAnLHRoaXMsXCJzdGVwXCIpO1xuICAgICAgZW50aXR5Lm9uKCdoaXQnLHRoaXMsJ2NvbGxpc2lvbicpO1xuICAgIH0sXG5cbiAgICBjb2xsaXNpb246IGZ1bmN0aW9uKGNvbCxsYXN0KSB7XG4gICAgICB2YXIgZW50aXR5ID0gdGhpcy5lbnRpdHksXG4gICAgICAgICAgcCA9IGVudGl0eS5wLFxuICAgICAgICAgIG1hZ25pdHVkZSA9IDA7XG5cbiAgICAgIGlmKGNvbC5vYmoucCAmJiBjb2wub2JqLnAuc2Vuc29yKSB7XG4gICAgICAgIGNvbC5vYmoudHJpZ2dlcihcInNlbnNvclwiLGVudGl0eSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29sLmltcGFjdCA9IDA7XG4gICAgICB2YXIgaW1wYWN0WCA9IE1hdGguYWJzKHAudngpO1xuICAgICAgdmFyIGltcGFjdFkgPSBNYXRoLmFicyhwLnZ5KTtcblxuICAgICAgcC54IC09IGNvbC5zZXBhcmF0ZVswXTtcbiAgICAgIHAueSAtPSBjb2wuc2VwYXJhdGVbMV07XG5cbiAgICAgIC8vIFRvcCBjb2xsaXNpb25cbiAgICAgIGlmKGNvbC5ub3JtYWxZIDwgLTAuMykgeyBcbiAgICAgICAgaWYoIXAuc2tpcENvbGxpZGUgJiYgcC52eSA+IDApIHsgcC52eSA9IDA7IH1cbiAgICAgICAgY29sLmltcGFjdCA9IGltcGFjdFk7XG4gICAgICAgIGVudGl0eS50cmlnZ2VyKFwiYnVtcC5ib3R0b21cIixjb2wpO1xuICAgICAgfVxuICAgICAgaWYoY29sLm5vcm1hbFkgPiAwLjMpIHtcbiAgICAgICAgaWYoIXAuc2tpcENvbGxpZGUgJiYgcC52eSA8IDApIHsgcC52eSA9IDA7IH1cbiAgICAgICAgY29sLmltcGFjdCA9IGltcGFjdFk7XG5cbiAgICAgICAgZW50aXR5LnRyaWdnZXIoXCJidW1wLnRvcFwiLGNvbCk7XG4gICAgICB9XG5cbiAgICAgIGlmKGNvbC5ub3JtYWxYIDwgLTAuMykgeyBcbiAgICAgICAgaWYoIXAuc2tpcENvbGxpZGUgJiYgcC52eCA+IDApIHsgcC52eCA9IDA7ICB9XG4gICAgICAgIGNvbC5pbXBhY3QgPSBpbXBhY3RYO1xuICAgICAgICBlbnRpdHkudHJpZ2dlcihcImJ1bXAucmlnaHRcIixjb2wpO1xuICAgICAgfVxuICAgICAgaWYoY29sLm5vcm1hbFggPiAwLjMpIHsgXG4gICAgICAgIGlmKCFwLnNraXBDb2xsaWRlICYmIHAudnggPCAwKSB7IHAudnggPSAwOyB9XG4gICAgICAgIGNvbC5pbXBhY3QgPSBpbXBhY3RYO1xuXG4gICAgICAgIGVudGl0eS50cmlnZ2VyKFwiYnVtcC5sZWZ0XCIsY29sKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc3RlcDogZnVuY3Rpb24oZHQpIHtcbiAgICAgIHZhciBwID0gdGhpcy5lbnRpdHkucCxcbiAgICAgICAgICBkdFN0ZXAgPSBkdDtcbiAgICAgIC8vIFRPRE86IGNoZWNrIHRoZSBlbnRpdHkncyBtYWduaXR1ZGUgb2YgdnggYW5kIHZ5LFxuICAgICAgLy8gcmVkdWNlIHRoZSBtYXggZHRTdGVwIGlmIG5lY2Vzc2FyeSB0byBwcmV2ZW50IFxuICAgICAgLy8gc2tpcHBpbmcgdGhyb3VnaCBvYmplY3RzLlxuICAgICAgd2hpbGUoZHRTdGVwID4gMCkge1xuICAgICAgICBkdCA9IE1hdGgubWluKDEvMzAsZHRTdGVwKTtcbiAgICAgICAgLy8gVXBkYXRlZCBiYXNlZCBvbiB0aGUgdmVsb2NpdHkgYW5kIGFjY2VsZXJhdGlvblxuICAgICAgICBwLnZ4ICs9IHAuYXggKiBkdCArIChwLmdyYXZpdHlYID09PSB2b2lkIDAgPyBRLmdyYXZpdHlYIDogcC5ncmF2aXR5WCkgKiBkdCAqIHAuZ3Jhdml0eTtcbiAgICAgICAgcC52eSArPSBwLmF5ICogZHQgKyAocC5ncmF2aXR5WSA9PT0gdm9pZCAwID8gUS5ncmF2aXR5WSA6IHAuZ3Jhdml0eVkpICogZHQgKiBwLmdyYXZpdHk7XG4gICAgICAgIHAueCArPSBwLnZ4ICogZHQ7XG4gICAgICAgIHAueSArPSBwLnZ5ICogZHQ7XG5cbiAgICAgICAgdGhpcy5lbnRpdHkuc3RhZ2UuY29sbGlkZSh0aGlzLmVudGl0eSk7XG4gICAgICAgIGR0U3RlcCAtPSBkdDtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIFEuY29tcG9uZW50KCdhaUJvdW5jZScsIHtcbiAgICBhZGRlZDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmVudGl0eS5vbihcImJ1bXAucmlnaHRcIix0aGlzLFwiZ29MZWZ0XCIpO1xuICAgICAgdGhpcy5lbnRpdHkub24oXCJidW1wLmxlZnRcIix0aGlzLFwiZ29SaWdodFwiKTtcbiAgICB9LFxuXG4gICAgZ29MZWZ0OiBmdW5jdGlvbihjb2wpIHtcbiAgICAgIHRoaXMuZW50aXR5LnAudnggPSAtY29sLmltcGFjdDsgICAgICBcbiAgICAgIGlmKHRoaXMuZW50aXR5LnAuZGVmYXVsdERpcmVjdGlvbiA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICAgIHRoaXMuZW50aXR5LnAuZmxpcCA9ICd4JztcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMuZW50aXR5LnAuZmxpcCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBnb1JpZ2h0OiBmdW5jdGlvbihjb2wpIHtcbiAgICAgIHRoaXMuZW50aXR5LnAudnggPSBjb2wuaW1wYWN0O1xuICAgICAgaWYodGhpcy5lbnRpdHkucC5kZWZhdWx0RGlyZWN0aW9uID09PSAnbGVmdCcpIHtcbiAgICAgICAgICB0aGlzLmVudGl0eS5wLmZsaXAgPSAneCc7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLmVudGl0eS5wLmZsaXAgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG59O1xuIiwiLypnbG9iYWwgUXVpbnR1czpmYWxzZSAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKFEpIHtcblxuICBRLl9hbmltYXRpb25zID0ge307XG4gIFEuYW5pbWF0aW9ucyA9IGZ1bmN0aW9uKHNwcml0ZSxhbmltYXRpb25zKSB7XG4gICAgaWYoIVEuX2FuaW1hdGlvbnNbc3ByaXRlXSkgeyBRLl9hbmltYXRpb25zW3Nwcml0ZV0gPSB7fTsgfVxuICAgIFEuX2V4dGVuZChRLl9hbmltYXRpb25zW3Nwcml0ZV0sYW5pbWF0aW9ucyk7XG4gIH07XG5cbiAgUS5hbmltYXRpb24gPSBmdW5jdGlvbihzcHJpdGUsbmFtZSkge1xuICAgIHJldHVybiBRLl9hbmltYXRpb25zW3Nwcml0ZV0gJiYgUS5fYW5pbWF0aW9uc1tzcHJpdGVdW25hbWVdO1xuICB9O1xuXG4gIFEuY29tcG9uZW50KCdhbmltYXRpb24nLHtcbiAgICBhZGRlZDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcCA9IHRoaXMuZW50aXR5LnA7XG4gICAgICBwLmFuaW1hdGlvbiA9IG51bGw7XG4gICAgICBwLmFuaW1hdGlvblByaW9yaXR5ID0gLTE7XG4gICAgICBwLmFuaW1hdGlvbkZyYW1lID0gMDtcbiAgICAgIHAuYW5pbWF0aW9uVGltZSA9IDA7XG4gICAgICB0aGlzLmVudGl0eS5vbihcInN0ZXBcIix0aGlzLFwic3RlcFwiKTtcbiAgICB9LFxuICAgIGV4dGVuZDoge1xuICAgICAgcGxheTogZnVuY3Rpb24obmFtZSxwcmlvcml0eSxyZXNldEZyYW1lKSB7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9uLnBsYXkobmFtZSxwcmlvcml0eSxyZXNldEZyYW1lKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHN0ZXA6IGZ1bmN0aW9uKGR0KSB7XG4gICAgICB2YXIgZW50aXR5ID0gdGhpcy5lbnRpdHksXG4gICAgICAgICAgcCA9IGVudGl0eS5wO1xuICAgICAgaWYocC5hbmltYXRpb24pIHtcbiAgICAgICAgdmFyIGFuaW0gPSBRLmFuaW1hdGlvbihwLnNwcml0ZSxwLmFuaW1hdGlvbiksXG4gICAgICAgICAgICByYXRlID0gYW5pbS5yYXRlIHx8IHAucmF0ZSxcbiAgICAgICAgICAgIHN0ZXBwZWQgPSAwO1xuICAgICAgICBwLmFuaW1hdGlvblRpbWUgKz0gZHQ7XG4gICAgICAgIGlmKHAuYW5pbWF0aW9uQ2hhbmdlZCkge1xuICAgICAgICAgIHAuYW5pbWF0aW9uQ2hhbmdlZCA9IGZhbHNlO1xuICAgICAgICB9IGVsc2UgeyBcbiAgICAgICAgICBwLmFuaW1hdGlvblRpbWUgKz0gZHQ7XG4gICAgICAgICAgaWYocC5hbmltYXRpb25UaW1lID4gcmF0ZSkge1xuICAgICAgICAgICAgc3RlcHBlZCA9IE1hdGguZmxvb3IocC5hbmltYXRpb25UaW1lIC8gcmF0ZSk7XG4gICAgICAgICAgICBwLmFuaW1hdGlvblRpbWUgLT0gc3RlcHBlZCAqIHJhdGU7XG4gICAgICAgICAgICBwLmFuaW1hdGlvbkZyYW1lICs9IHN0ZXBwZWQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKHN0ZXBwZWQgPiAwKSB7XG4gICAgICAgICAgaWYocC5hbmltYXRpb25GcmFtZSA+PSBhbmltLmZyYW1lcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmKGFuaW0ubG9vcCA9PT0gZmFsc2UgfHwgYW5pbS5uZXh0KSB7XG4gICAgICAgICAgICAgIHAuYW5pbWF0aW9uRnJhbWUgPSBhbmltLmZyYW1lcy5sZW5ndGggLSAxO1xuICAgICAgICAgICAgICBlbnRpdHkudHJpZ2dlcignYW5pbUVuZCcpO1xuICAgICAgICAgICAgICBlbnRpdHkudHJpZ2dlcignYW5pbUVuZC4nICsgcC5hbmltYXRpb24pO1xuICAgICAgICAgICAgICBwLmFuaW1hdGlvbiA9IG51bGw7XG4gICAgICAgICAgICAgIHAuYW5pbWF0aW9uUHJpb3JpdHkgPSAtMTtcbiAgICAgICAgICAgICAgaWYoYW5pbS50cmlnZ2VyKSB7ICBcbiAgICAgICAgICAgICAgICBlbnRpdHkudHJpZ2dlcihhbmltLnRyaWdnZXIsYW5pbS50cmlnZ2VyRGF0YSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYoYW5pbS5uZXh0KSB7IHRoaXMucGxheShhbmltLm5leHQsYW5pbS5uZXh0UHJpb3JpdHkpOyB9XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGVudGl0eS50cmlnZ2VyKCdhbmltTG9vcCcpO1xuICAgICAgICAgICAgICBlbnRpdHkudHJpZ2dlcignYW5pbUxvb3AuJyArIHAuYW5pbWF0aW9uKTtcbiAgICAgICAgICAgICAgcC5hbmltYXRpb25GcmFtZSA9IHAuYW5pbWF0aW9uRnJhbWUgJSBhbmltLmZyYW1lcy5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVudGl0eS50cmlnZ2VyKFwiYW5pbUZyYW1lXCIpO1xuICAgICAgICB9XG4gICAgICAgIHAuc2hlZXQgPSBhbmltLnNoZWV0IHx8IHAuc2hlZXQ7XG4gICAgICAgIHAuZnJhbWUgPSBhbmltLmZyYW1lc1twLmFuaW1hdGlvbkZyYW1lXTtcbiAgICAgICAgaWYoYW5pbS5oYXNPd25Qcm9wZXJ0eShcImZsaXBcIikpIHsgcC5mbGlwICA9IGFuaW0uZmxpcDsgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBwbGF5OiBmdW5jdGlvbihuYW1lLHByaW9yaXR5LHJlc2V0RnJhbWUpIHtcbiAgICAgIHZhciBlbnRpdHkgPSB0aGlzLmVudGl0eSxcbiAgICAgICAgICBwID0gZW50aXR5LnA7XG4gICAgICBwcmlvcml0eSA9IHByaW9yaXR5IHx8IDA7XG4gICAgICBpZihuYW1lICE9PSBwLmFuaW1hdGlvbiAmJiBwcmlvcml0eSA+PSBwLmFuaW1hdGlvblByaW9yaXR5KSB7XG4gICAgICAgIGlmKHJlc2V0RnJhbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJlc2V0RnJhbWUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHAuYW5pbWF0aW9uID0gbmFtZTtcbiAgICAgICAgaWYocmVzZXRGcmFtZSkge1xuICAgICAgICAgIHAuYW5pbWF0aW9uQ2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgcC5hbmltYXRpb25UaW1lID0gMDsgICAgICAgICAgXG4gICAgICAgICAgcC5hbmltYXRpb25GcmFtZSA9IDA7XG4gICAgICAgIH0gICAgICAgIFxuICAgICAgICBwLmFuaW1hdGlvblByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgIGVudGl0eS50cmlnZ2VyKCdhbmltJyk7XG4gICAgICAgIGVudGl0eS50cmlnZ2VyKCdhbmltLicgKyBwLmFuaW1hdGlvbik7XG4gICAgICB9XG4gICAgfVxuICBcbiAgfSk7XG5cblxuICBRLlNwcml0ZS5leHRlbmQoXCJSZXBlYXRlclwiLHtcbiAgICBpbml0OiBmdW5jdGlvbihwcm9wcykge1xuICAgICAgdGhpcy5fc3VwZXIoUS5fZGVmYXVsdHMocHJvcHMse1xuICAgICAgICBzcGVlZFg6IDEsXG4gICAgICAgIHNwZWVkWTogMSxcbiAgICAgICAgcmVwZWF0WTogdHJ1ZSxcbiAgICAgICAgcmVwZWF0WDogdHJ1ZSxcbiAgICAgICAgcmVuZGVyQWx3YXlzOiB0cnVlLFxuICAgICAgICB0eXBlOiAwXG4gICAgICB9KSk7XG4gICAgICB0aGlzLnAucmVwZWF0VyA9IHRoaXMucC5yZXBlYXRXIHx8IHRoaXMucC53O1xuICAgICAgdGhpcy5wLnJlcGVhdEggPSB0aGlzLnAucmVwZWF0SCB8fCB0aGlzLnAuaDtcbiAgICB9LFxuXG4gICAgZHJhdzogZnVuY3Rpb24oY3R4KSB7XG4gICAgICB2YXIgcCA9IHRoaXMucCxcbiAgICAgICAgICBhc3NldCA9IHRoaXMuYXNzZXQoKSxcbiAgICAgICAgICBzaGVldCA9IHRoaXMuc2hlZXQoKSxcbiAgICAgICAgICBzY2FsZSA9IHRoaXMuc3RhZ2Uudmlld3BvcnQgPyB0aGlzLnN0YWdlLnZpZXdwb3J0LnNjYWxlIDogMSxcbiAgICAgICAgICB2aWV3WCA9IE1hdGguZmxvb3IodGhpcy5zdGFnZS52aWV3cG9ydCA/IHRoaXMuc3RhZ2Uudmlld3BvcnQueCA6IDApLFxuICAgICAgICAgIHZpZXdZID0gTWF0aC5mbG9vcih0aGlzLnN0YWdlLnZpZXdwb3J0ID8gdGhpcy5zdGFnZS52aWV3cG9ydC55IDogMCksXG4gICAgICAgICAgb2Zmc2V0WCA9IE1hdGguZmxvb3IocC54ICsgdmlld1ggKiB0aGlzLnAuc3BlZWRYKSxcbiAgICAgICAgICBvZmZzZXRZID0gTWF0aC5mbG9vcihwLnkgKyB2aWV3WSAqIHRoaXMucC5zcGVlZFkpLFxuICAgICAgICAgIGN1clgsIGN1clksIHN0YXJ0WDtcbiAgICAgIGlmKHAucmVwZWF0WCkge1xuICAgICAgICBjdXJYID0gLW9mZnNldFggJSBwLnJlcGVhdFc7XG4gICAgICAgIGlmKGN1clggPiAwKSB7IGN1clggLT0gcC5yZXBlYXRXOyB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdXJYID0gcC54IC0gdmlld1g7XG4gICAgICB9XG4gICAgICBpZihwLnJlcGVhdFkpIHtcbiAgICAgICAgY3VyWSA9IC1vZmZzZXRZICUgcC5yZXBlYXRIO1xuICAgICAgICBpZihjdXJZID4gMCkgeyBjdXJZIC09IHAucmVwZWF0SDsgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3VyWSA9IHAueSAtIHZpZXdZO1xuICAgICAgfVxuXG4gICAgICBzdGFydFggPSBjdXJYO1xuICAgICAgd2hpbGUoY3VyWSA8IFEuaGVpZ2h0IC8gc2NhbGUpIHtcbiAgICAgICAgY3VyWCA9IHN0YXJ0WDtcbiAgICAgICAgd2hpbGUoY3VyWCA8IFEud2lkdGggLyBzY2FsZSkge1xuICAgICAgICAgIGlmKHNoZWV0KSB7XG4gICAgICAgICAgICBzaGVldC5kcmF3KGN0eCxjdXJYICsgdmlld1gsY3VyWSArIHZpZXdZLHAuZnJhbWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjdHguZHJhd0ltYWdlKGFzc2V0LGN1clggKyB2aWV3WCxjdXJZICsgdmlld1kpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJYICs9IHAucmVwZWF0VztcbiAgICAgICAgICBpZighcC5yZXBlYXRYKSB7IGJyZWFrOyB9XG4gICAgICAgIH1cbiAgICAgICAgY3VyWSArPSBwLnJlcGVhdEg7XG4gICAgICAgIGlmKCFwLnJlcGVhdFkpIHsgYnJlYWs7IH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIFEuVHdlZW4gPSBRLkNsYXNzLmV4dGVuZCh7XG4gICAgaW5pdDogZnVuY3Rpb24oZW50aXR5LHByb3BlcnRpZXMsZHVyYXRpb24sZWFzaW5nLG9wdGlvbnMpIHtcbiAgICAgIGlmKFEuX2lzT2JqZWN0KGVhc2luZykpIHsgb3B0aW9ucyA9IGVhc2luZzsgZWFzaW5nID0gUS5FYXNpbmcuTGluZWFyOyB9XG4gICAgICBpZihRLl9pc09iamVjdChkdXJhdGlvbikpIHsgb3B0aW9ucyA9IGR1cmF0aW9uOyBkdXJhdGlvbiA9IDE7IH1cblxuICAgICAgdGhpcy5lbnRpdHkgPSBlbnRpdHk7XG4gICAgICAvL3RoaXMucCA9IChlbnRpdHkgaW5zdGFuY2VvZiBRLlN0YWdlKSA/IGVudGl0eS52aWV3cG9ydCA6IGVudGl0eS5wO1xuICAgICAgdGhpcy5kdXJhdGlvbiA9IGR1cmF0aW9uIHx8IDE7XG4gICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgIHRoaXMuZGVsYXkgPSB0aGlzLm9wdGlvbnMuZGVsYXkgfHwgMDtcbiAgICAgIHRoaXMuZWFzaW5nID0gZWFzaW5nIHx8IHRoaXMub3B0aW9ucy5lYXNpbmcgfHwgUS5FYXNpbmcuTGluZWFyO1xuXG4gICAgICB0aGlzLnN0YXJ0RnJhbWUgPSBRLl9sb29wRnJhbWUgKyAxO1xuICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllcztcbiAgICAgIHRoaXMuc3RhcnQgPSB7fTtcbiAgICAgIHRoaXMuZGlmZiA9IHt9O1xuICAgIH0sXG5cbiAgICBzdGVwOiBmdW5jdGlvbihkdCkge1xuICAgICAgdmFyIHByb3BlcnR5O1xuXG4gICAgICBpZih0aGlzLnN0YXJ0RnJhbWUgPiBRLl9sb29wRnJhbWUpIHsgcmV0dXJuIHRydWU7IH1cbiAgICAgIGlmKHRoaXMuZGVsYXkgPj0gZHQpIHtcbiAgICAgICAgdGhpcy5kZWxheSAtPSBkdDtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIGlmKHRoaXMuZGVsYXkgPiAwKSB7XG4gICAgICAgIGR0IC09IHRoaXMuZGVsYXk7XG4gICAgICAgIHRoaXMuZGVsYXkgPSAwO1xuICAgICAgfVxuXG4gICAgICBpZih0aGlzLnRpbWUgPT09IDApIHtcbiAgICAgICAgLy8gZmlyc3QgdGltZSBydW5uaW5nPyBJbml0aWFsaXplIHRoZSBwcm9wZXJ0aWVzIHRvIGNoYWluaW5nIGNvcnJlY3RseS5cbiAgICAgICAgdmFyIGVudGl0eSA9IHRoaXMuZW50aXR5LCBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzO1xuICAgICAgICB0aGlzLnAgPSAoZW50aXR5IGluc3RhbmNlb2YgUS5TdGFnZSkgPyBlbnRpdHkudmlld3BvcnQgOiBlbnRpdHkucDtcbiAgICAgICAgZm9yKHByb3BlcnR5IGluIHByb3BlcnRpZXMpIHtcbiAgICAgICAgICB0aGlzLnN0YXJ0W3Byb3BlcnR5XSA9IHRoaXMucFtwcm9wZXJ0eV07XG4gICAgICAgICAgaWYoIVEuX2lzVW5kZWZpbmVkKHRoaXMuc3RhcnRbcHJvcGVydHldKSkge1xuICAgICAgICAgICAgdGhpcy5kaWZmW3Byb3BlcnR5XSA9IHByb3BlcnRpZXNbcHJvcGVydHldIC0gdGhpcy5zdGFydFtwcm9wZXJ0eV07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLnRpbWUgKz0gZHQ7XG5cbiAgICAgIHZhciBwcm9ncmVzcyA9IE1hdGgubWluKDEsdGhpcy50aW1lIC8gdGhpcy5kdXJhdGlvbiksXG4gICAgICAgICAgbG9jYXRpb24gPSB0aGlzLmVhc2luZyhwcm9ncmVzcyk7XG5cbiAgICAgIGZvcihwcm9wZXJ0eSBpbiB0aGlzLnN0YXJ0KSB7XG4gICAgICAgIGlmKCFRLl9pc1VuZGVmaW5lZCh0aGlzLnBbcHJvcGVydHldKSkge1xuICAgICAgICAgIHRoaXMucFtwcm9wZXJ0eV0gPSB0aGlzLnN0YXJ0W3Byb3BlcnR5XSArIHRoaXMuZGlmZltwcm9wZXJ0eV0gKiBsb2NhdGlvbjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZihwcm9ncmVzcyA+PSAxKSB7XG4gICAgICAgIGlmKHRoaXMub3B0aW9ucy5jYWxsYmFjaykgeyBcbiAgICAgICAgICB0aGlzLm9wdGlvbnMuY2FsbGJhY2suYXBwbHkodGhpcy5lbnRpdHkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcHJvZ3Jlc3MgPCAxO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gQ29kZSByaXBwZWQgZGlyZWN0bHkgZnJvbSBUd2Vlbi5qc1xuICAvLyBodHRwczovL2dpdGh1Yi5jb20vc29sZS90d2Vlbi5qcy9ibG9iL21hc3Rlci9zcmMvVHdlZW4uanNcbiAgUS5FYXNpbmcgPSB7XG4gICAgTGluZWFyOiBmdW5jdGlvbiAoaykgeyByZXR1cm4gazsgfSxcblxuICAgIFF1YWRyYXRpYzoge1xuICAgICAgSW46IGZ1bmN0aW9uICggayApICB7IHJldHVybiBrICogazsgfSxcbiAgICAgIE91dDogZnVuY3Rpb24gKCBrICkge3JldHVybiBrICogKCAyIC0gayApOyB9LFxuICAgICAgSW5PdXQ6IGZ1bmN0aW9uICggayApIHtcbiAgICAgICAgaWYgKChrICo9IDIgKSA8IDEpIHsgcmV0dXJuIDAuNSAqIGsgKiBrOyB9XG4gICAgICAgIHJldHVybiAtMC41ICogKC0tayAqIChrIC0gMikgLSAxKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgUS5jb21wb25lbnQoJ3R3ZWVuJyx7XG4gICAgYWRkZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fdHdlZW5zID0gW107XG4gICAgICB0aGlzLmVudGl0eS5vbihcInN0ZXBcIix0aGlzLFwic3RlcFwiKTtcbiAgICB9LFxuICAgIGV4dGVuZDoge1xuICAgICAgYW5pbWF0ZTogZnVuY3Rpb24ocHJvcGVydGllcyxkdXJhdGlvbixlYXNpbmcsb3B0aW9ucykge1xuICAgICAgICB0aGlzLnR3ZWVuLl90d2VlbnMucHVzaChuZXcgUS5Ud2Vlbih0aGlzLHByb3BlcnRpZXMsZHVyYXRpb24sZWFzaW5nLG9wdGlvbnMpKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9LFxuXG4gICAgICBjaGFpbjogZnVuY3Rpb24ocHJvcGVydGllcyxkdXJhdGlvbixlYXNpbmcsb3B0aW9ucykge1xuICAgICAgICBpZihRLl9pc09iamVjdChlYXNpbmcpKSB7IG9wdGlvbnMgPSBlYXNpbmc7IGVhc2luZyA9IFEuRWFzaW5nLkxpbmVhcjsgfVxuICAgICAgICAvLyBDaGFpbiBhbiBhbmltYXRpb24gdG8gdGhlIGVuZFxuICAgICAgICB2YXIgdHdlZW5DbnQgPSB0aGlzLnR3ZWVuLl90d2VlbnMubGVuZ3RoO1xuICAgICAgICBpZih0d2VlbkNudCA+IDApIHtcbiAgICAgICAgICB2YXIgbGFzdFR3ZWVuID0gdGhpcy50d2Vlbi5fdHdlZW5zW3R3ZWVuQ250IC0gMV07XG4gICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICAgICAgb3B0aW9uc1snZGVsYXknXSA9IGxhc3RUd2Vlbi5kdXJhdGlvbiAtIGxhc3RUd2Vlbi50aW1lICsgbGFzdFR3ZWVuLmRlbGF5O1xuICAgICAgICB9IFxuXG4gICAgICAgIHRoaXMuYW5pbWF0ZShwcm9wZXJ0aWVzLGR1cmF0aW9uLGVhc2luZyxvcHRpb25zKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9LFxuXG4gICAgICBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy50d2Vlbi5fdHdlZW5zLmxlbmd0aCA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBzdGVwOiBmdW5jdGlvbihkdCkge1xuICAgICAgZm9yKHZhciBpPTA7IGkgPCB0aGlzLl90d2VlbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYoIXRoaXMuX3R3ZWVuc1tpXS5zdGVwKGR0KSkge1xuICAgICAgICAgIHRoaXMuX3R3ZWVucy5zcGxpY2UoaSwxKTtcbiAgICAgICAgICBpLS07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG5cbn07XG5cbiIsIi8qZ2xvYmFsIFF1aW50dXM6ZmFsc2UsIEF1ZGlvQ29udGV4dDpmYWxzZSwgd2luZG93OmZhbHNlICovXG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oUSkge1xuXG4gIFEuYXVkaW8gPSB7XG4gICAgY2hhbm5lbHM6IFtdLFxuICAgIGNoYW5uZWxNYXg6ICBRLm9wdGlvbnMuY2hhbm5lbE1heCB8fCAxMCxcbiAgICBhY3RpdmU6IHt9LFxuICAgIHBsYXk6IGZ1bmN0aW9uKCkge31cbiAgfTtcblxuXG4gIFEuaGFzV2ViQXVkaW8gPSAodHlwZW9mIEF1ZGlvQ29udGV4dCAhPT0gXCJ1bmRlZmluZWRcIikgfHwgKHR5cGVvZiB3ZWJraXRBdWRpb0NvbnRleHQgIT09IFwidW5kZWZpbmVkXCIpO1xuXG4gIGlmKFEuaGFzV2ViQXVkaW8pIHsgXG4gICAgaWYodHlwZW9mIEF1ZGlvQ29udGV4dCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgUS5hdWRpb0NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIFEuYXVkaW9Db250ZXh0ID0gbmV3IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQoKTtcbiAgICB9XG4gIH1cblxuICBRLmVuYWJsZVNvdW5kID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGhhc1RvdWNoID0gICEhKCdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdyk7XG5cbiAgICBpZihRLmhhc1dlYkF1ZGlvKSB7XG4gICAgICBRLmF1ZGlvLmVuYWJsZVdlYkF1ZGlvU291bmQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgUS5hdWRpby5lbmFibGVIVE1MNVNvdW5kKCk7XG4gICAgfVxuICAgIHJldHVybiBRO1xuICB9O1xuXG4gIFEuYXVkaW8uZW5hYmxlV2ViQXVkaW9Tb3VuZCA9IGZ1bmN0aW9uKCkge1xuICAgIFEuYXVkaW8udHlwZSA9IFwiV2ViQXVkaW9cIjtcblxuICAgIFEuYXVkaW8uc291bmRJRCA9IDA7XG5cbiAgICBRLmF1ZGlvLnBsYXlpbmdTb3VuZHMgPSB7fTtcblxuICAgIFEuYXVkaW8ucmVtb3ZlU291bmQgPSBmdW5jdGlvbihzb3VuZElEKSB7XG4gICAgICBkZWxldGUgUS5hdWRpby5wbGF5aW5nU291bmRzW3NvdW5kSURdO1xuICAgIH07XG5cbiAgICAvLyBQbGF5IGEgc2luZ2xlIHNvdW5kLCBvcHRpb25hbGx5IGRlYm91bmNlZCBcbiAgICAvLyB0byBwcmV2ZW50IHJlcGVhdGVkIHBsYXlzIGluIGEgc2hvcnQgdGltZVxuICAgIFEuYXVkaW8ucGxheSA9IGZ1bmN0aW9uKHMsb3B0aW9ucykge1xuICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXG4gICAgICAvLyBTZWUgaWYgdGhpcyBhdWRpbyBmaWxlIGlzIGN1cnJlbnRseSBiZWluZyBkZWJvdW5jZWQsIGlmIFxuICAgICAgLy8gaXQgaXMsIGRvbid0IGRvIGFueXRoaW5nIGFuZCBqdXN0IHJldHVyblxuICAgICAgaWYoUS5hdWRpby5hY3RpdmVbc10gJiYgUS5hdWRpby5hY3RpdmVbc10gPiBub3cpIHsgcmV0dXJuOyB9XG5cbiAgICAgIC8vIElmIGFueSBvcHRpb25zIHdlcmUgcGFzc2VkIGluLCBjaGVjayBmb3IgYSBkZWJvdW5jZSxcbiAgICAgIC8vIHdoaWNoIGlzIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIGRlYm91bmNlIHRoaXMgc291bmRcbiAgICAgIGlmKG9wdGlvbnMgJiYgb3B0aW9uc1snZGVib3VuY2UnXSkge1xuICAgICAgICBRLmF1ZGlvLmFjdGl2ZVtzXSA9IG5vdyArIG9wdGlvbnNbJ2RlYm91bmNlJ107XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkZWxldGUgUS5hdWRpby5hY3RpdmVbc107XG4gICAgICB9XG5cbiAgICAgIHZhciBzb3VuZElEID0gUS5hdWRpby5zb3VuZElEKys7XG5cbiAgICAgIHZhciBzb3VyY2UgPSBRLmF1ZGlvQ29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICAgIHNvdXJjZS5idWZmZXIgPSBRLmFzc2V0KHMpO1xuICAgICAgc291cmNlLmNvbm5lY3QoUS5hdWRpb0NvbnRleHQuZGVzdGluYXRpb24pO1xuICAgICAgaWYob3B0aW9ucyAmJiBvcHRpb25zWydsb29wJ10pIHtcbiAgICAgICAgc291cmNlLmxvb3AgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICBRLmF1ZGlvLnJlbW92ZVNvdW5kKHNvdW5kSUQpO1xuICAgICAgICB9LHNvdXJjZS5idWZmZXIuZHVyYXRpb24gKiAxMDAwKTtcbiAgICAgIH1cbiAgICAgIHNvdXJjZS5hc3NldE5hbWUgPSBzO1xuICAgICAgaWYoc291cmNlLnN0YXJ0KSB7IHNvdXJjZS5zdGFydCgwKTsgfSBlbHNlIHsgc291cmNlLm5vdGVPbigwKTsgfVxuXG4gICAgICBRLmF1ZGlvLnBsYXlpbmdTb3VuZHNbc291bmRJRF0gPSBzb3VyY2U7XG5cblxuICAgIH07XG5cbiAgICBRLmF1ZGlvLnN0b3AgPSBmdW5jdGlvbihzKSB7XG4gICAgICBmb3IodmFyIGtleSBpbiBRLmF1ZGlvLnBsYXlpbmdTb3VuZHMpIHtcbiAgICAgICAgdmFyIHNuZCA9IFEuYXVkaW8ucGxheWluZ1NvdW5kc1trZXldO1xuICAgICAgICBpZighcyB8fCBzID09PSBzbmQuYXNzZXROYW1lKSB7XG4gICAgICAgICAgaWYoc25kLnN0b3ApIHsgc25kLnN0b3AoMCk7ICB9IGVsc2UgeyAgc25kLm5vdGVPZmYoMCk7IH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgfTtcblxuICBRLmF1ZGlvLmVuYWJsZUhUTUw1U291bmQgPSBmdW5jdGlvbigpIHtcbiAgICBRLmF1ZGlvLnR5cGUgPSBcIkhUTUw1XCI7XG5cbiAgICBmb3IgKHZhciBpPTA7aTxRLmF1ZGlvLmNoYW5uZWxNYXg7aSsrKSB7XHRcbiAgICAgIFEuYXVkaW8uY2hhbm5lbHNbaV0gPSB7fTtcbiAgICAgIFEuYXVkaW8uY2hhbm5lbHNbaV1bJ2NoYW5uZWwnXSA9IG5ldyBBdWRpbygpOyBcbiAgICAgIFEuYXVkaW8uY2hhbm5lbHNbaV1bJ2ZpbmlzaGVkJ10gPSAtMTtcdFxuICAgIH1cblxuICAgIC8vIFBsYXkgYSBzaW5nbGUgc291bmQsIG9wdGlvbmFsbHkgZGVib3VuY2VkIFxuICAgIC8vIHRvIHByZXZlbnQgcmVwZWF0ZWQgcGxheXMgaW4gYSBzaG9ydCB0aW1lXG4gICAgUS5hdWRpby5wbGF5ID0gZnVuY3Rpb24ocyxvcHRpb25zKSB7XG4gICAgICB2YXIgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgICAgIC8vIFNlZSBpZiB0aGlzIGF1ZGlvIGZpbGUgaXMgY3VycmVudGx5IGJlaW5nIGRlYm91bmNlZCwgaWYgXG4gICAgICAvLyBpdCBpcywgZG9uJ3QgZG8gYW55dGhpbmcgYW5kIGp1c3QgcmV0dXJuXG4gICAgICBpZihRLmF1ZGlvLmFjdGl2ZVtzXSAmJiBRLmF1ZGlvLmFjdGl2ZVtzXSA+IG5vdykgeyByZXR1cm47IH1cblxuICAgICAgLy8gSWYgYW55IG9wdGlvbnMgd2VyZSBwYXNzZWQgaW4sIGNoZWNrIGZvciBhIGRlYm91bmNlLFxuICAgICAgLy8gd2hpY2ggaXMgdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gZGVib3VuY2UgdGhpcyBzb3VuZFxuICAgICAgaWYob3B0aW9ucyAmJiBvcHRpb25zWydkZWJvdW5jZSddKSB7XG4gICAgICAgIFEuYXVkaW8uYWN0aXZlW3NdID0gbm93ICsgb3B0aW9uc1snZGVib3VuY2UnXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlbGV0ZSBRLmF1ZGlvLmFjdGl2ZVtzXTtcbiAgICAgIH1cblxuICAgICAgLy8gRmluZCBhIGZyZWUgYXVkaW8gY2hhbm5lbCBhbmQgcGxheSB0aGUgc291bmRcbiAgICAgIGZvciAodmFyIGk9MDtpPFEuYXVkaW8uY2hhbm5lbHMubGVuZ3RoO2krKykge1xuICAgICAgICAvLyBDaGVjayB0aGUgY2hhbm5lbCBpcyBlaXRoZXIgZmluaXNoZWQgb3Igbm90IGxvb3BpbmdcbiAgICAgICAgaWYgKCFRLmF1ZGlvLmNoYW5uZWxzW2ldWydsb29wJ10gJiYgUS5hdWRpby5jaGFubmVsc1tpXVsnZmluaXNoZWQnXSA8IG5vdykge1x0XG5cbiAgICAgICAgICBRLmF1ZGlvLmNoYW5uZWxzW2ldWydjaGFubmVsJ10uc3JjID0gUS5hc3NldChzKS5zcmM7XG5cbiAgICAgICAgICAvLyBJZiB3ZSdyZSBsb29waW5nIC0ganVzdCBzZXQgbG9vcCB0byB0cnVlIHRvIHByZXZlbnQgdGhpcyBjaGFubmNlbFxuICAgICAgICAgIC8vIGZyb20gYmVpbmcgdXNlZC5cbiAgICAgICAgICBpZihvcHRpb25zICYmIG9wdGlvbnNbJ2xvb3AnXSkgeyBcbiAgICAgICAgICAgIFEuYXVkaW8uY2hhbm5lbHNbaV1bJ2xvb3AnXSA9IHRydWU7XG4gICAgICAgICAgICBRLmF1ZGlvLmNoYW5uZWxzW2ldWydjaGFubmVsJ10ubG9vcCA9IHRydWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIFEuYXVkaW8uY2hhbm5lbHNbaV1bJ2ZpbmlzaGVkJ10gPSBub3cgKyBRLmFzc2V0KHMpLmR1cmF0aW9uKjEwMDA7XG4gICAgICAgICAgfVxuICAgICAgICAgIFEuYXVkaW8uY2hhbm5lbHNbaV1bJ2NoYW5uZWwnXS5sb2FkKCk7XG4gICAgICAgICAgUS5hdWRpby5jaGFubmVsc1tpXVsnY2hhbm5lbCddLnBsYXkoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBTdG9wIGEgc2luZ2xlIHNvdW5kIGFzc2V0IG9yIHN0b3AgYWxsIHNvdW5kcyBjdXJyZW50bHkgcGxheWluZ1xuICAgIFEuYXVkaW8uc3RvcCA9IGZ1bmN0aW9uKHMpIHtcbiAgICAgIHZhciBzcmMgPSBzID8gUS5hc3NldChzKS5zcmMgOiBudWxsO1xuICAgICAgdmFyIHRtID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICBmb3IgKHZhciBpPTA7aTxRLmF1ZGlvLmNoYW5uZWxzLmxlbmd0aDtpKyspIHtcbiAgICAgICAgaWYgKCghc3JjIHx8IFEuYXVkaW8uY2hhbm5lbHNbaV1bJ2NoYW5uZWwnXS5zcmMgPT09IHNyYykgJiYgXG4gICAgICAgICAgICAoUS5hdWRpby5jaGFubmVsc1tpXVsnbG9vcCddIHx8IFEuYXVkaW8uY2hhbm5lbHNbaV1bJ2ZpbmlzaGVkJ10gPj0gdG0pKSB7XG4gICAgICAgICAgUS5hdWRpby5jaGFubmVsc1tpXVsnY2hhbm5lbCddLnBhdXNlKCk7XG4gICAgICAgICAgUS5hdWRpby5jaGFubmVsc1tpXVsnbG9vcCddID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gIH07XG5cbn07XG4gIFxuIiwiLypnbG9iYWwgUXVpbnR1czpmYWxzZSAqL1xuLyoqXG5RdWludHVzIEhUTUw1IEdhbWUgRW5naW5lIC0gSW5wdXQgTW9kdWxlXG5cblRoZSBjb2RlIGluIGBxdWludHVzX2lucHV0LmpzYCBkZWZpbmVzIHRoZSBgUXVpbnR1cy5JbnB1dGAgbW9kdWxlLCB3aGljaFxuY29uY2VybnMgaXRzZWxmIHdpdGggZ2FtZS10eXBlIChwcmV0dHkgYW55dGhpbmcgYmVzaWRlcyB0b3VjaHNjcmVlbiBpbnB1dClcblxuQG1vZHVsZSBRdWludHVzLklucHV0XG4qL1xuXG4vKipcbiAqIFF1aW50dXMgSW5wdXQgTW9kdWxlXG4gKlxuICogQGNsYXNzIFF1aW50dXMuSW5wdXRcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihRKSB7XG4gIC8qKlxuICAgKiBQcm92aWRlZCBrZXkgbmFtZXMgbWFwcGVkIHRvIGtleSBjb2RlcyAtIGFkZCBtb3JlIG5hbWVzIGFuZCBrZXkgY29kZXMgYXMgbmVjZXNzYXJ5XG4gICAqXG4gICAqIEBmb3IgUXVpbnR1cy5JbnB1dFxuICAgKiBAcHJvcGVydHkgS0VZX05BTUVTXG4gICAqIEB0eXBlIE9iamVjdFxuICAgKiBAc3RhdGljXG4gICAqL1xuICB2YXIgS0VZX05BTUVTID0gUS5LRVlfTkFNRVMgPSB7XG4gICAgTEVGVDogMzcsIFJJR0hUOiAzOSxcbiAgICBVUDogMzgsIERPV046IDQwLFxuICAgIFNQQUNFOiAzMixcbiAgICBaOiA5MCxcbiAgICBYOiA4OCxcbiAgICBFTlRFUjogMTMsXG4gICAgRVNDOiAyNyxcbiAgICBQOiA4MCxcbiAgICBTOiA4M1xuICB9O1xuXG4gIHZhciBERUZBVUxUX0tFWVMgPSB7XG4gICAgTEVGVDogJ2xlZnQnLCBSSUdIVDogJ3JpZ2h0JyxcbiAgICBVUDogJ3VwJywgICAgIERPV046ICdkb3duJyxcbiAgICBTUEFDRTogJ2ZpcmUnLFxuICAgIFo6ICdmaXJlJyxcbiAgICBYOiAnYWN0aW9uJyxcbiAgICBFTlRFUjogJ2NvbmZpcm0nLFxuICAgIEVTQzogJ2VzYycsXG4gICAgUDogJ1AnLFxuICAgIFM6ICdTJ1xuICB9O1xuXG4gIHZhciBERUZBVUxUX1RPVUNIX0NPTlRST0xTICA9IFsgWydsZWZ0JywnPCcgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbJ3JpZ2h0JywnPicgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbJ2FjdGlvbicsJ2InXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbJ2ZpcmUnLCAnYScgXV07XG5cbiAgLy8gQ2xvY2t3aXNlIGZyb20gbWlkbmlnaHQgKGEgbGEgQ1NTKVxuICB2YXIgREVGQVVMVF9KT1lQQURfSU5QVVRTID0gIFsgJ3VwJywncmlnaHQnLCdkb3duJywnbGVmdCddO1xuXG4gIC8qKlxuICAgKiBDdXJyZW50IHN0YXRlIG9mIGJvdW5kIGlucHV0c1xuICAgKlxuICAgKiBAZm9yIFF1aW50dXMuSW5wdXRcbiAgICogQHByb3BlcnR5IFEuaW5wdXRzXG4gICAqIEB0eXBlIE9iamVjdFxuICAgKi9cbiAgUS5pbnB1dHMgPSB7fTtcbiAgUS5qb3lwYWQgPSB7fTtcblxuICB2YXIgaGFzVG91Y2ggPSAgISEoJ29udG91Y2hzdGFydCcgaW4gd2luZG93KTtcblxuXG4gIC8qKlxuICAgKlxuICAgKiBDb252ZXJ0IGEgY2FudmFzIHBvaW50IHRvIGEgc3RhZ2UgcG9pbnQsIHggZGltZW5zaW9uXG4gICAqXG4gICAqIEBtZXRob2QgUS5jYW52YXNUb1N0YWdlWFxuICAgKiBAZm9yIFF1aW50dXMuSW5wdXRcbiAgICogQHBhcmFtIHtGbG9hdH0geFxuICAgKiBAcGFyYW0ge1EuU3RhZ2V9IHN0YWdlXG4gICAqIEByZXR1cm5zIHtJbnRlZ2VyfSB4XG4gICAqL1xuICBRLmNhbnZhc1RvU3RhZ2VYID0gZnVuY3Rpb24oeCxzdGFnZSkge1xuICAgIHggPSB4IC8gUS5jc3NXaWR0aCAqIFEud2lkdGg7XG4gICAgaWYoc3RhZ2Uudmlld3BvcnQpIHtcbiAgICAgIHggLz0gc3RhZ2Uudmlld3BvcnQuc2NhbGU7XG4gICAgICB4ICs9IHN0YWdlLnZpZXdwb3J0Lng7XG4gICAgfVxuXG4gICAgcmV0dXJuIHg7XG4gIH07XG5cbiAgLyoqXG4gICAqXG4gICAqIENvbnZlcnQgYSBjYW52YXMgcG9pbnQgdG8gYSBzdGFnZSBwb2ludCwgeSBkaW1lbnNpb25cbiAgICpcbiAgICogQG1ldGhvZCBRLmNhbnZhc1RvU3RhZ2VZXG4gICAqIEBwYXJhbSB7RmxvYXR9IHlcbiAgICogQHBhcmFtIHtRLlN0YWdlfSBzdGFnZVxuICAgKiBAcmV0dXJucyB7SW50ZWdlcn0geVxuICAgKi9cbiAgUS5jYW52YXNUb1N0YWdlWSA9IGZ1bmN0aW9uKHksc3RhZ2UpIHtcbiAgICAgIHkgPSB5IC8gUS5jc3NXaWR0aCAqIFEud2lkdGg7XG4gICAgICBpZihzdGFnZS52aWV3cG9ydCkge1xuICAgICAgICB5IC89IHN0YWdlLnZpZXdwb3J0LnNjYWxlO1xuICAgICAgICB5ICs9IHN0YWdlLnZpZXdwb3J0Lnk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB5O1xuICB9O1xuXG5cblxuICAvKipcbiAgICpcbiAgICogQnV0dG9uIGFuZCBtb3VzZSBpbnB1dCBzdWJzeXN0ZW0gZm9yIFF1aW50dXMuXG4gICAqIEFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MgaXMgYXV0by1jcmVhdGVkIGFzIHt7I2Nyb3NzTGluayBcIlEuaW5wdXRcIn19e3svY3Jvc3NMaW5rfX1cbiAgICpcbiAgICogQGNsYXNzIFEuSW5wdXRTeXN0ZW1cbiAgICogQGV4dGVuZHMgUS5FdmVudGVkXG4gICAqIEBmb3IgUXVpbnR1cy5JbnB1dFxuICAgKi9cbiAgUS5JbnB1dFN5c3RlbSA9IFEuRXZlbnRlZC5leHRlbmQoe1xuICAgIGtleXM6IHt9LFxuICAgIGtleXBhZDoge30sXG4gICAga2V5Ym9hcmRFbmFibGVkOiBmYWxzZSxcbiAgICB0b3VjaEVuYWJsZWQ6IGZhbHNlLFxuICAgIGpveXBhZEVuYWJsZWQ6IGZhbHNlLFxuXG4gICAgLyoqXG4gICAgICogQmluZCBhIGtleSBuYW1lIG9yIGtleWNvZGUgdG8gYW4gYWN0aW9uIG5hbWUgKHVzZWQgYnkgYGtleWJvYXJkQ29udHJvbHNgKVxuICAgICAqXG4gICAgICogQG1ldGhvZCBiaW5kS2V5XG4gICAgICogQGZvciBRLklucHV0U3lzdGVtXG4gICAgICogQHBhcmFtIHtTdHJpbmcgb3IgSW50ZWdlcn0ga2V5IC0gbmFtZSBvciBpbnRlZ2VyIGtleWNvZGUgZm9yIHRvIGJpbmRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSAtIG5hbWUgb2YgYWN0aW9uIHRvIGJpbmQgdG9cbiAgICAgKi9cbiAgICBiaW5kS2V5OiBmdW5jdGlvbihrZXksbmFtZSkge1xuICAgICAgUS5pbnB1dC5rZXlzW0tFWV9OQU1FU1trZXldIHx8IGtleV0gPSBuYW1lO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBFbmFibGUga2V5Ym9hcmQgY29udHJvbHMgYnkgYmluZGluZyB0byBldmVudHNcbiAgICAgKlxuICAgICAqIEBmb3IgUS5JbnB1dFN5c3RlbVxuICAgICAqIEBtZXRob2QgZW5hYmxlS2V5Ym9hcmRcbiAgICAgKi9cbiAgICBlbmFibGVLZXlib2FyZDogZnVuY3Rpb24oKSB7XG4gICAgICBpZih0aGlzLmtleWJvYXJkRW5hYmxlZCkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgLy8gTWFrZSBzZWxlY3RhYmxlIGFuZCByZW1vdmUgYW4gOmZvY3VzIG91dGxpbmVcbiAgICAgIFEuZWwudGFiSW5kZXggPSAwO1xuICAgICAgUS5lbC5zdHlsZS5vdXRsaW5lID0gMDtcblxuICAgICAgUS5lbC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYoUS5pbnB1dC5rZXlzW2Uua2V5Q29kZV0pIHtcbiAgICAgICAgICB2YXIgYWN0aW9uTmFtZSA9IFEuaW5wdXQua2V5c1tlLmtleUNvZGVdO1xuICAgICAgICAgIFEuaW5wdXRzW2FjdGlvbk5hbWVdID0gdHJ1ZTtcbiAgICAgICAgICBRLmlucHV0LnRyaWdnZXIoYWN0aW9uTmFtZSk7XG4gICAgICAgICAgUS5pbnB1dC50cmlnZ2VyKCdrZXlkb3duJyxlLmtleUNvZGUpO1xuICAgICAgICB9XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH0sZmFsc2UpO1xuXG4gICAgICBRLmVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYoUS5pbnB1dC5rZXlzW2Uua2V5Q29kZV0pIHtcbiAgICAgICAgICB2YXIgYWN0aW9uTmFtZSA9IFEuaW5wdXQua2V5c1tlLmtleUNvZGVdO1xuICAgICAgICAgIFEuaW5wdXRzW2FjdGlvbk5hbWVdID0gZmFsc2U7XG4gICAgICAgICAgUS5pbnB1dC50cmlnZ2VyKGFjdGlvbk5hbWUgKyBcIlVwXCIpO1xuICAgICAgICAgIFEuaW5wdXQudHJpZ2dlcigna2V5dXAnLGUua2V5Q29kZSk7XG4gICAgICAgIH1cbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSxmYWxzZSk7XG5cbiAgICAgIGlmKFEub3B0aW9ucy5hdXRvRm9jdXMpIHsgIFEuZWwuZm9jdXMoKTsgfVxuICAgICAgdGhpcy5rZXlib2FyZEVuYWJsZWQgPSB0cnVlO1xuICAgIH0sXG5cblxuICAgIC8qKlxuICAgICAqIENvbnZlbmllbmNlIG1ldGhvZCB0byBhY3RpdmF0ZSBrZXlib2FyZCBjb250cm9scyAoY2FsbCBgYmluZEtleWAgYW5kIGBlbmFibGVLZXlib2FyZGAgaW50ZXJuYWxseSlcbiAgICAgICpcbiAgICAgKiBAbWV0aG9kIGtleWJvYXJkQ29udHJvbHNcbiAgICAgKiBAZm9yIFEuSW5wdXRTeXN0ZW1cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW2tleXNdIC0gaGFzaCBvZiBrZXkgbmFtZXMgb3IgY29kZXMgdG8gYWN0aW9uc1xuICAgICAqL1xuICAgIGtleWJvYXJkQ29udHJvbHM6IGZ1bmN0aW9uKGtleXMpIHtcbiAgICAgIGtleXMgPSBrZXlzIHx8IERFRkFVTFRfS0VZUztcbiAgICAgIFEuX2VhY2goa2V5cyxmdW5jdGlvbihuYW1lLGtleSkge1xuICAgICAgIHRoaXMuYmluZEtleShrZXksbmFtZSk7XG4gICAgICB9LFEuaW5wdXQpO1xuICAgICAgdGhpcy5lbmFibGVLZXlib2FyZCgpO1xuICAgIH0sXG5cbiAgICBfY29udGFpbmVyT2Zmc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIFEuaW5wdXQub2Zmc2V0WCA9IDA7XG4gICAgICBRLmlucHV0Lm9mZnNldFkgPSAwO1xuICAgICAgdmFyIGVsID0gUS5lbDtcbiAgICAgIGRvIHtcbiAgICAgICAgUS5pbnB1dC5vZmZzZXRYICs9IGVsLm9mZnNldExlZnQ7XG4gICAgICAgIFEuaW5wdXQub2Zmc2V0WSArPSBlbC5vZmZzZXRUb3A7XG4gICAgICB9IHdoaWxlKGVsID0gZWwub2Zmc2V0UGFyZW50KTtcbiAgICB9LFxuXG4gICAgdG91Y2hMb2NhdGlvbjogZnVuY3Rpb24odG91Y2gpIHtcbiAgICAgIHZhciBlbCA9IFEuZWwsIFxuICAgICAgICBwb3NYID0gdG91Y2gub2Zmc2V0WCxcbiAgICAgICAgcG9zWSA9IHRvdWNoLm9mZnNldFksXG4gICAgICAgIHRvdWNoWCwgdG91Y2hZO1xuXG4gICAgICBpZihRLl9pc1VuZGVmaW5lZChwb3NYKSB8fCBRLl9pc1VuZGVmaW5lZChwb3NZKSkge1xuICAgICAgICBwb3NYID0gdG91Y2gubGF5ZXJYO1xuICAgICAgICBwb3NZID0gdG91Y2gubGF5ZXJZO1xuICAgICAgfVxuXG4gICAgICBpZihRLl9pc1VuZGVmaW5lZChwb3NYKSB8fCBRLl9pc1VuZGVmaW5lZChwb3NZKSkge1xuICAgICAgICBpZihRLmlucHV0Lm9mZnNldFggPT09IHZvaWQgMCkgeyBRLmlucHV0Ll9jb250YWluZXJPZmZzZXQoKTsgfVxuICAgICAgICBwb3NYID0gdG91Y2gucGFnZVggLSBRLmlucHV0Lm9mZnNldFg7XG4gICAgICAgIHBvc1kgPSB0b3VjaC5wYWdlWSAtIFEuaW5wdXQub2Zmc2V0WTtcbiAgICAgIH1cblxuICAgICAgdG91Y2hYID0gUS53aWR0aCAqIHBvc1ggLyBRLmNzc1dpZHRoO1xuICAgICAgdG91Y2hZID0gUS5oZWlnaHQgKiBwb3NZIC8gUS5jc3NIZWlnaHQ7XG5cblxuICAgICAgcmV0dXJuIHsgeDogdG91Y2hYLCB5OiB0b3VjaFkgfTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQWN0aXZhdGUgdG91Y2ggYnV0dG9uIGNvbnRyb2xzIC0gcGFzcyBpbiBhbiBvcHRpb25zIGhhc2ggdG8gb3ZlcnJpZGVcbiAgICAgKlxuICAgICAqIERlZmF1bHQgT3B0aW9uczpcbiAgICAgKlxuICAgICAqICAgICB7XG4gICAgICogICAgICAgIGxlZnQ6IDAsXG4gICAgICogICAgICAgIGd1dHRlcjoxMCxcbiAgICAgKiAgICAgICAgY29udHJvbHM6IERFRkFVTFRfVE9VQ0hfQ09OVFJPTFMsXG4gICAgICogICAgICAgIHdpZHRoOiBRLndpZHRoLFxuICAgICAqICAgICAgICBib3R0b206IFEuaGVpZ2h0XG4gICAgICogICAgICB9XG4gICAgICpcbiAgICAgKiBEZWZhdWx0IGNvbnRyb2xzIGFyZSBsZWZ0IGFuZCByaWdodCBidXR0b25zLCBhIHNwYWNlLCBhbmQgJ2EnIGFuZCAnYicgYnV0dG9ucywgYXMgZGVmaW5lZCBhcyBhbiBBcnJheSBvZiBBcnJheXMgYmVsb3c6XG4gICAgICpcbiAgICAgKiAgICAgIFsgWydsZWZ0JywnPCcgXSxcbiAgICAgKiAgICAgICAgWydyaWdodCcsJz4nIF0sXG4gICAgICogICAgICAgIFtdLCAgLy8gdXNlIGFuIGVtcHR5IGFycmF5IGFzIGEgc3BhY2VyXG4gICAgICogICAgICAgIFsnYWN0aW9uJywnYiddLFxuICAgICAqICAgICAgICBbJ2ZpcmUnLCAnYScgXV1cbiAgICAgKlxuICAgICAqIEBtZXRob2QgdG91Y2hDb250cm9sc1xuICAgICAqIEBmb3IgUS5JbnB1dFN5c3RlbVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0c10gLSBPcHRpb25zIGhhc2hcbiAgICAgKi9cbiAgICB0b3VjaENvbnRyb2xzOiBmdW5jdGlvbihvcHRzKSB7XG4gICAgICBpZih0aGlzLnRvdWNoRW5hYmxlZCkgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgIGlmKCFoYXNUb3VjaCkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgUS5pbnB1dC5rZXlwYWQgPSBvcHRzID0gUS5fZXh0ZW5kKHtcbiAgICAgICAgbGVmdDogMCxcbiAgICAgICAgZ3V0dGVyOjEwLFxuICAgICAgICBjb250cm9sczogREVGQVVMVF9UT1VDSF9DT05UUk9MUyxcbiAgICAgICAgd2lkdGg6IFEud2lkdGgsXG4gICAgICAgIGJvdHRvbTogUS5oZWlnaHQsXG4gICAgICAgIGZ1bGxIZWlnaHQ6IGZhbHNlXG4gICAgICB9LG9wdHMpO1xuXG4gICAgICBvcHRzLnVuaXQgPSAob3B0cy53aWR0aCAvIG9wdHMuY29udHJvbHMubGVuZ3RoKTtcbiAgICAgIG9wdHMuc2l6ZSA9IG9wdHMudW5pdCAtIDIgKiBvcHRzLmd1dHRlcjtcblxuICAgICAgZnVuY3Rpb24gZ2V0S2V5KHRvdWNoKSB7XG4gICAgICAgIHZhciBwb3MgPSBRLmlucHV0LnRvdWNoTG9jYXRpb24odG91Y2gpLFxuICAgICAgICAgICAgbWluWSA9IG9wdHMuYm90dG9tIC0gb3B0cy51bml0O1xuICAgICAgICBmb3IodmFyIGk9MCxsZW49b3B0cy5jb250cm9scy5sZW5ndGg7aTxsZW47aSsrKSB7XG4gICAgICAgICAgdmFyIG1pblggPSBvcHRzLmxlZnQgKyBpICogb3B0cy51bml0ICsgaSAqIG9wdHMuZ3V0dGVyO1xuICAgICAgICAgIGlmKHBvcy54ID49ICBtaW5YICYmIHBvcy54IDw9IChtaW5YK29wdHMudW5pdCkgJiYgKG9wdHMuZnVsbEhlaWdodCB8fCAocG9zLnkgPj0gbWluWSAmJiBwb3MueSA8PSAobWluWStvcHRzLnVuaXQpKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBvcHRzLmNvbnRyb2xzW2ldWzBdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiB0b3VjaERpc3BhdGNoKGV2ZW50KSB7XG4gICAgICAgIHZhciB3YXNPbiA9IHt9LFxuICAgICAgICAgICAgaSwgbGVuLCB0Y2gsIGtleSwgYWN0aW9uTmFtZTtcblxuICAgICAgICAvLyBSZXNldCBhbGwgdGhlIGFjdGlvbnMgYm91bmQgdG8gY29udHJvbHNcbiAgICAgICAgLy8gYnV0IGtlZXAgdHJhY2sgb2YgYWxsIHRoZSBhY3Rpb25zIHRoYXQgd2VyZSBvblxuICAgICAgICBmb3IoaT0wLGxlbiA9IG9wdHMuY29udHJvbHMubGVuZ3RoO2k8bGVuO2krKykge1xuICAgICAgICAgIGFjdGlvbk5hbWUgPSBvcHRzLmNvbnRyb2xzW2ldWzBdO1xuICAgICAgICAgIGlmKFEuaW5wdXRzW2FjdGlvbk5hbWVdKSB7IHdhc09uW2FjdGlvbk5hbWVdID0gdHJ1ZTsgfVxuICAgICAgICAgIFEuaW5wdXRzW2FjdGlvbk5hbWVdID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdG91Y2hlcyA9IGV2ZW50LnRvdWNoZXMgPyBldmVudC50b3VjaGVzIDogWyBldmVudCBdO1xuXG4gICAgICAgIGZvcihpPTAsbGVuPXRvdWNoZXMubGVuZ3RoO2k8bGVuO2krKykge1xuICAgICAgICAgIHRjaCA9IHRvdWNoZXNbaV07XG4gICAgICAgICAga2V5ID0gZ2V0S2V5KHRjaCk7XG5cbiAgICAgICAgICBpZihrZXkpIHtcbiAgICAgICAgICAgIC8vIE1hcmsgdGhpcyBpbnB1dCBhcyBvblxuICAgICAgICAgICAgUS5pbnB1dHNba2V5XSA9IHRydWU7XG5cbiAgICAgICAgICAgIC8vIEVpdGhlciB0cmlnZ2VyIGEgbmV3IGFjdGlvblxuICAgICAgICAgICAgLy8gb3IgcmVtb3ZlIGZyb20gd2FzT24gbGlzdFxuICAgICAgICAgICAgaWYoIXdhc09uW2tleV0pIHtcbiAgICAgICAgICAgICAgUS5pbnB1dC50cmlnZ2VyKGtleSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBkZWxldGUgd2FzT25ba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBbnkgcmVtYWluaW5nIHdlcmUgb24gdGhlIGxhc3QgZnJhbWVcbiAgICAgICAgLy8gYW5kIG5lZWQgdG8gdHJpZ2dlciBhbiB1cCBhY3Rpb25cbiAgICAgICAgZm9yKGFjdGlvbk5hbWUgaW4gd2FzT24pIHtcbiAgICAgICAgICBRLmlucHV0LnRyaWdnZXIoYWN0aW9uTmFtZSArIFwiVXBcIik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgdGhpcy50b3VjaERpc3BhdGNoSGFuZGxlciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdG91Y2hEaXNwYXRjaChlKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfTtcblxuXG4gICAgICBRLl9lYWNoKFtcInRvdWNoc3RhcnRcIixcInRvdWNoZW5kXCIsXCJ0b3VjaG1vdmVcIixcInRvdWNoY2FuY2VsXCJdLGZ1bmN0aW9uKGV2dCkge1xuICAgICAgICBRLmVsLmFkZEV2ZW50TGlzdGVuZXIoZXZ0LHRoaXMudG91Y2hEaXNwYXRjaEhhbmRsZXIpO1xuICAgICAgfSx0aGlzKTtcblxuICAgICAgdGhpcy50b3VjaEVuYWJsZWQgPSB0cnVlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBUdXJuIG9mZiB0b3VjaCAoYnV5dHRvbiBhbmQgam95cGFkKSBjb250cm9scyBhbmQgcmVtb3ZlIGV2ZW50IGxpc3RlbmVyc1xuICAgICAqXG4gICAgICogQG1ldGhvZCBkaXNhYmxlVG91Y2hDb250cm9sc1xuICAgICAqIEBmb3IgUS5JbnB1dFN5c3RlbVxuICAgICAqL1xuICAgIGRpc2FibGVUb3VjaENvbnRyb2xzOiBmdW5jdGlvbigpIHtcbiAgICAgIFEuX2VhY2goW1widG91Y2hzdGFydFwiLFwidG91Y2hlbmRcIixcInRvdWNobW92ZVwiLFwidG91Y2hjYW5jZWxcIl0sZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIFEuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihldnQsdGhpcy50b3VjaERpc3BhdGNoSGFuZGxlcik7XG4gICAgICB9LHRoaXMpO1xuXG4gICAgICBRLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLHRoaXMuam95cGFkU3RhcnQpO1xuICAgICAgUS5lbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLHRoaXMuam95cGFkTW92ZSk7XG4gICAgICBRLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJyx0aGlzLmpveXBhZEVuZCk7XG4gICAgICBRLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJyx0aGlzLmpveXBhZEVuZCk7XG4gICAgICB0aGlzLnRvdWNoRW5hYmxlZCA9IGZhbHNlO1xuXG4gICAgICAvLyBjbGVhciBleGlzdGluZyBpbnB1dHNcbiAgICAgIGZvcih2YXIgaW5wdXQgaW4gUS5pbnB1dHMpIHtcbiAgICAgICAgUS5pbnB1dHNbaW5wdXRdID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKiBcbiAgICAgKiBBY3RpdmF0ZSBqb3lwYWQgY29udHJvbHMgKGkuZS4gNC13YXkgdG91Y2ggY29udHJvbHMpXG4gICAgICpcbiAgICAgKiBMb3RzIG9mIG9wdGlvbnMsIGRlZmF1bHRzIGFyZTpcbiAgICAgKiBcbiAgICAgKiAgICAge1xuICAgICAqICAgICAgc2l6ZTogNTAsXG4gICAgICogICAgICB0cmlnZ2VyOiAyMCxcbiAgICAgKiAgICAgIGNlbnRlcjogMjUsXG4gICAgICogICAgICBjb2xvcjogXCIjQ0NDXCIsXG4gICAgICogICAgICBiYWNrZ3JvdW5kOiBcIiMwMDBcIixcbiAgICAgKiAgICAgIGFscGhhOiAwLjUsXG4gICAgICogICAgICB6b25lOiBRLndpZHRoIC8gMixcbiAgICAgKiAgICAgIGlucHV0czogREVGQVVMVF9KT1lQQURfSU5QVVRTXG4gICAgICogICAgfVxuICAgICAqXG4gICAgICogIERlZmF1bHQgam95cGFkIGNvbnRyb2xzIGlzIGFuIGFycmF5IHRoYXQgZGVmaW5lcyB0aGUgaW5wdXRzIHRvIGJpbmQgdG86XG4gICAgICpcbiAgICAgKiAgICAgICAvLyBDbG9ja3dpc2UgZnJvbSBtaWRuaWdodCAoYSBsYSBDU1MpXG4gICAgICogICAgICAgdmFyIERFRkFVTFRfSk9ZUEFEX0lOUFVUUyA9ICBbICd1cCcsJ3JpZ2h0JywnZG93bicsJ2xlZnQnXTtcbiAgICAgKlxuICAgICAqIEBtZXRob2Qgam95cGFkQ29udHJvbHNcbiAgICAgKiBAZm9yIFEuSW5wdXRTeXN0ZW1cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdHNdIC0gIGpveXBhZCBvcHRpb25zXG4gICAgICovXG4gICBqb3lwYWRDb250cm9sczogZnVuY3Rpb24ob3B0cykge1xuICAgICAgaWYodGhpcy5qb3lwYWRFbmFibGVkKSB7IHJldHVybiBmYWxzZTsgfVxuICAgICAgaWYoIWhhc1RvdWNoKSB7IHJldHVybiBmYWxzZTsgfVxuXG4gICAgICB2YXIgam95cGFkID0gUS5qb3lwYWQgPSBRLl9kZWZhdWx0cyhvcHRzIHx8IHt9LHtcbiAgICAgICAgc2l6ZTogNTAsXG4gICAgICAgIHRyaWdnZXI6IDIwLFxuICAgICAgICBjZW50ZXI6IDI1LFxuICAgICAgICBjb2xvcjogXCIjQ0NDXCIsXG4gICAgICAgIGJhY2tncm91bmQ6IFwiIzAwMFwiLFxuICAgICAgICBhbHBoYTogMC41LFxuICAgICAgICB6b25lOiBRLndpZHRoIC8gMixcbiAgICAgICAgam95cGFkVG91Y2g6IG51bGwsXG4gICAgICAgIGlucHV0czogREVGQVVMVF9KT1lQQURfSU5QVVRTLFxuICAgICAgICB0cmlnZ2VyczogW11cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmpveXBhZFN0YXJ0ID0gZnVuY3Rpb24oZXZ0KSB7XG4gICAgICAgIGlmKGpveXBhZC5qb3lwYWRUb3VjaCA9PT0gbnVsbCkge1xuICAgICAgICAgIHZhciB0b3VjaCA9IGV2dC5jaGFuZ2VkVG91Y2hlc1swXSxcbiAgICAgICAgICAgICAgbG9jID0gUS5pbnB1dC50b3VjaExvY2F0aW9uKHRvdWNoKTtcblxuICAgICAgICAgIGlmKGxvYy54IDwgam95cGFkLnpvbmUpIHtcbiAgICAgICAgICAgIGpveXBhZC5qb3lwYWRUb3VjaCA9IHRvdWNoLmlkZW50aWZpZXI7XG4gICAgICAgICAgICBqb3lwYWQuY2VudGVyWCA9IGxvYy54O1xuICAgICAgICAgICAgam95cGFkLmNlbnRlclkgPSBsb2MueTsgXG4gICAgICAgICAgICBqb3lwYWQueCA9IG51bGw7XG4gICAgICAgICAgICBqb3lwYWQueSA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBcbiAgICAgIHRoaXMuam95cGFkTW92ZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYoam95cGFkLmpveXBhZFRvdWNoICE9PSBudWxsKSB7XG4gICAgICAgICAgdmFyIGV2dCA9IGU7XG5cbiAgICAgICAgICBmb3IodmFyIGk9MCxsZW49ZXZ0LmNoYW5nZWRUb3VjaGVzLmxlbmd0aDtpPGxlbjtpKyspIHtcbiAgICAgICAgICAgIHZhciB0b3VjaCA9IGV2dC5jaGFuZ2VkVG91Y2hlc1tpXTtcblxuICAgICAgICAgICAgaWYodG91Y2guaWRlbnRpZmllciA9PT0gam95cGFkLmpveXBhZFRvdWNoKSB7XG4gICAgICAgICAgICAgIHZhciBsb2MgPSBRLmlucHV0LnRvdWNoTG9jYXRpb24odG91Y2gpLFxuICAgICAgICAgICAgICAgICAgZHggPSBsb2MueCAtIGpveXBhZC5jZW50ZXJYLFxuICAgICAgICAgICAgICAgICAgZHkgPSBsb2MueSAtIGpveXBhZC5jZW50ZXJZLFxuICAgICAgICAgICAgICAgICAgZGlzdCA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSksXG4gICAgICAgICAgICAgICAgICBvdmVyYWdlID0gTWF0aC5tYXgoMSxkaXN0IC8gam95cGFkLnNpemUpLFxuICAgICAgICAgICAgICAgICAgYW5nID0gIE1hdGguYXRhbjIoZHgsZHkpO1xuXG4gICAgICAgICAgICAgIGlmKG92ZXJhZ2UgPiAxKSB7XG4gICAgICAgICAgICAgICAgZHggLz0gb3ZlcmFnZTtcbiAgICAgICAgICAgICAgICBkeSAvPSBvdmVyYWdlO1xuICAgICAgICAgICAgICAgIGRpc3QgLz0gb3ZlcmFnZTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHZhciB0cmlnZ2VycyA9IFtcbiAgICAgICAgICAgICAgICBkeSA8IC1qb3lwYWQudHJpZ2dlcixcbiAgICAgICAgICAgICAgICBkeCA+IGpveXBhZC50cmlnZ2VyLFxuICAgICAgICAgICAgICAgIGR5ID4gam95cGFkLnRyaWdnZXIsXG4gICAgICAgICAgICAgICAgZHggPCAtam95cGFkLnRyaWdnZXJcbiAgICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgICBmb3IodmFyIGs9MDtrPHRyaWdnZXJzLmxlbmd0aDtrKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uTmFtZSA9IGpveXBhZC5pbnB1dHNba107XG4gICAgICAgICAgICAgICAgaWYodHJpZ2dlcnNba10pIHtcbiAgICAgICAgICAgICAgICAgIFEuaW5wdXRzW2FjdGlvbk5hbWVdID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgaWYoIWpveXBhZC50cmlnZ2Vyc1trXSkgeyBcbiAgICAgICAgICAgICAgICAgICAgUS5pbnB1dC50cmlnZ2VyKGFjdGlvbk5hbWUpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBRLmlucHV0c1thY3Rpb25OYW1lXSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgaWYoam95cGFkLnRyaWdnZXJzW2tdKSB7IFxuICAgICAgICAgICAgICAgICAgICBRLmlucHV0LnRyaWdnZXIoYWN0aW9uTmFtZSArIFwiVXBcIik7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgUS5fZXh0ZW5kKGpveXBhZCwge1xuICAgICAgICAgICAgICAgIGR4OiBkeCwgZHk6IGR5LFxuICAgICAgICAgICAgICAgIHg6IGpveXBhZC5jZW50ZXJYICsgZHgsXG4gICAgICAgICAgICAgICAgeTogam95cGFkLmNlbnRlclkgKyBkeSxcbiAgICAgICAgICAgICAgICBkaXN0OiBkaXN0LFxuICAgICAgICAgICAgICAgIGFuZzogYW5nLFxuICAgICAgICAgICAgICAgIHRyaWdnZXJzOiB0cmlnZ2Vyc1xuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5qb3lwYWRFbmQgPSBmdW5jdGlvbihlKSB7IFxuICAgICAgICAgIHZhciBldnQgPSBlO1xuXG4gICAgICAgICAgaWYoam95cGFkLmpveXBhZFRvdWNoICE9PSBudWxsKSB7XG4gICAgICAgICAgICBmb3IodmFyIGk9MCxsZW49ZXZ0LmNoYW5nZWRUb3VjaGVzLmxlbmd0aDtpPGxlbjtpKyspIHsgXG4gICAgICAgICAgICB2YXIgdG91Y2ggPSBldnQuY2hhbmdlZFRvdWNoZXNbaV07XG4gICAgICAgICAgICAgIGlmKHRvdWNoLmlkZW50aWZpZXIgPT09IGpveXBhZC5qb3lwYWRUb3VjaCkge1xuICAgICAgICAgICAgICAgIGZvcih2YXIgaz0wO2s8am95cGFkLnRyaWdnZXJzLmxlbmd0aDtrKyspIHtcbiAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25OYW1lID0gam95cGFkLmlucHV0c1trXTtcbiAgICAgICAgICAgICAgICAgIFEuaW5wdXRzW2FjdGlvbk5hbWVdID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmKGpveXBhZC50cmlnZ2Vyc1trXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgUS5pbnB1dC50cmlnZ2VyKGFjdGlvbk5hbWUgKyBcIlVwXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGpveXBhZC5qb3lwYWRUb3VjaCA9IG51bGw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfTtcblxuICAgICAgUS5lbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLHRoaXMuam95cGFkU3RhcnQpO1xuICAgICAgUS5lbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsdGhpcy5qb3lwYWRNb3ZlKTtcbiAgICAgIFEuZWwuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsdGhpcy5qb3lwYWRFbmQpO1xuICAgICAgUS5lbC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hjYW5jZWxcIix0aGlzLmpveXBhZEVuZCk7XG5cbiAgICAgIHRoaXMuam95cGFkRW5hYmxlZCA9IHRydWU7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEFjdGl2YXRlIG1vdXNlIGNvbnRyb2xzIC0gbW91c2UgY29udHJvbHMgZG9uJ3QgdHJpZ2dlciBldmVudHMsIGJ1dCBqdXN0IHNldCBgUS5pbnB1dHNbJ21vdXNlWCddYCAmIGBRLmlucHV0c1snbW91c2VZJ11gIG9uIGVhY2ggZnJhbWUuXG4gICAgICpcbiAgICAgKiBEZWZhdWx0IG9wdGlvbnM6XG4gICAgICpcbiAgICAgKiAgICAge1xuICAgICAqICAgICAgIHN0YWdlTnVtOiAwLFxuICAgICAqICAgICAgIG1vdXNlWDogXCJtb3VzZVhcIixcbiAgICAgKiAgICAgICBtb3VzZVk6IFwibW91c2VZXCIsXG4gICAgICogICAgICAgY3Vyc29yOiBcIm9mZlwiXG4gICAgICogICAgIH1cbiAgICAgKlxuICAgICAqIEBtZXRob2QgbW91c2VDb250cm9sc1xuICAgICAqIEBmb3IgUS5JbnB1dFN5c3RlbVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gLSBvdmVycmlkZSBkZWZhdWx0IG9wdGlvbnNcbiAgICAgKi9cbiAgICBtb3VzZUNvbnRyb2xzOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgICAgdmFyIHN0YWdlTnVtID0gb3B0aW9ucy5zdGFnZU51bSB8fCAwO1xuICAgICAgdmFyIG1vdXNlSW5wdXRYID0gb3B0aW9ucy5tb3VzZVggfHwgXCJtb3VzZVhcIjtcbiAgICAgIHZhciBtb3VzZUlucHV0WSA9IG9wdGlvbnMubW91c2VZIHx8IFwibW91c2VZXCI7XG4gICAgICB2YXIgY3Vyc29yID0gb3B0aW9ucy5jdXJzb3IgfHwgXCJvZmZcIjtcblxuICAgICAgdmFyIG1vdXNlTW92ZU9iaiA9IHt9O1xuXG4gICAgICBpZihjdXJzb3IgIT09IFwib25cIikge1xuICAgICAgICAgIGlmKGN1cnNvciA9PT0gXCJvZmZcIikge1xuICAgICAgICAgICAgICBRLmVsLnN0eWxlLmN1cnNvciA9ICdub25lJztcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIFEuZWwuc3R5bGUuY3Vyc29yID0gY3Vyc29yO1xuICAgICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgUS5pbnB1dHNbbW91c2VJbnB1dFhdID0gMDtcbiAgICAgIFEuaW5wdXRzW21vdXNlSW5wdXRZXSA9IDA7XG5cbiAgICAgIFEuX21vdXNlTW92ZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgdG91Y2ggPSBlLnRvdWNoZXMgPyBlLnRvdWNoZXNbMF0gOiBlO1xuICAgICAgICB2YXIgZWwgPSBRLmVsLCBcbiAgICAgICAgICAgIHBvc1ggPSB0b3VjaC5vZmZzZXRYLFxuICAgICAgICAgICAgcG9zWSA9IHRvdWNoLm9mZnNldFksXG4gICAgICAgICAgICBlWCwgZVksXG4gICAgICAgICAgICBzdGFnZSA9IFEuc3RhZ2Uoc3RhZ2VOdW0pO1xuXG4gICAgICAgIGlmKFEuX2lzVW5kZWZpbmVkKHBvc1gpIHx8IFEuX2lzVW5kZWZpbmVkKHBvc1kpKSB7XG4gICAgICAgICAgcG9zWCA9IHRvdWNoLmxheWVyWDtcbiAgICAgICAgICBwb3NZID0gdG91Y2gubGF5ZXJZO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoUS5faXNVbmRlZmluZWQocG9zWCkgfHwgUS5faXNVbmRlZmluZWQocG9zWSkpIHtcbiAgICAgICAgICBpZihRLmlucHV0Lm9mZnNldFggPT09IHZvaWQgMCkgeyBRLmlucHV0Ll9jb250YWluZXJPZmZzZXQoKTsgfVxuICAgICAgICAgIHBvc1ggPSB0b3VjaC5wYWdlWCAtIFEuaW5wdXQub2Zmc2V0WDtcbiAgICAgICAgICBwb3NZID0gdG91Y2gucGFnZVkgLSBRLmlucHV0Lm9mZnNldFk7XG4gICAgICAgIH1cblxuICAgICAgICBpZihzdGFnZSkge1xuICAgICAgICAgIG1vdXNlTW92ZU9iai54PSBRLmNhbnZhc1RvU3RhZ2VYKHBvc1gsc3RhZ2UpO1xuICAgICAgICAgIG1vdXNlTW92ZU9iai55PSBRLmNhbnZhc1RvU3RhZ2VZKHBvc1ksc3RhZ2UpO1xuXG4gICAgICAgICAgUS5pbnB1dHNbbW91c2VJbnB1dFhdID0gbW91c2VNb3ZlT2JqLng7XG4gICAgICAgICAgUS5pbnB1dHNbbW91c2VJbnB1dFldID0gbW91c2VNb3ZlT2JqLnk7XG5cbiAgICAgICAgICBRLmlucHV0LnRyaWdnZXIoJ21vdXNlTW92ZScsbW91c2VNb3ZlT2JqKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgUS5lbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLFEuX21vdXNlTW92ZSx0cnVlKTtcbiAgICAgIFEuZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsUS5fbW91c2VNb3ZlLHRydWUpO1xuICAgICAgUS5lbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLFEuX21vdXNlTW92ZSx0cnVlKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogVHVybiBvZmYgbW91c2UgY29udHJvbHNcbiAgICAgKlxuICAgICAqIEBtZXRob2QgZGlzYWJsZU1vdXNlQ29udHJvbHNcbiAgICAgKiBAZm9yIFEuSW5wdXRTeXN0ZW1cbiAgICAgKi9cbiAgICBkaXNhYmxlTW91c2VDb250cm9sczogZnVuY3Rpb24oKSB7XG4gICAgICBpZihRLl9tb3VzZU1vdmUpIHtcbiAgICAgICAgUS5lbC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsUS5fbW91c2VNb3ZlLCB0cnVlKTtcbiAgICAgICAgUS5lbC5zdHlsZS5jdXJzb3IgPSAnaW5oZXJpdCc7XG4gICAgICAgIFEuX21vdXNlTW92ZSA9IG51bGw7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKiBcbiAgICAgKiBEcmF3IHRoZSB0b3VjaCBidXR0b25zIG9uIHRoZSBzY3JlZW5cbiAgICAgKlxuICAgICAqIG92ZXJsb2FkIHRoaXMgdG8gY2hhbmdlIGhvdyBidXR0b25zIGFyZSBkcmF3blxuICAgICAqXG4gICAgICogQG1ldGhvZCBkcmF3QnV0dG9uc1xuICAgICAqIEBmb3IgUS5JbnB1dFN5c3RlbVxuICAgICAqL1xuICAgIGRyYXdCdXR0b25zOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBrZXlwYWQgPSBRLmlucHV0LmtleXBhZCxcbiAgICAgICAgICBjdHggPSBRLmN0eDtcblxuICAgICAgY3R4LnNhdmUoKTtcbiAgICAgIGN0eC50ZXh0QWxpZ24gPSBcImNlbnRlclwiOyBcbiAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSBcIm1pZGRsZVwiO1xuXG4gICAgICBmb3IodmFyIGk9MDtpPGtleXBhZC5jb250cm9scy5sZW5ndGg7aSsrKSB7XG4gICAgICAgIHZhciBjb250cm9sID0ga2V5cGFkLmNvbnRyb2xzW2ldO1xuXG4gICAgICAgIGlmKGNvbnRyb2xbMF0pIHtcbiAgICAgICAgICBjdHguZm9udCA9IFwiYm9sZCBcIiArIChrZXlwYWQuc2l6ZS8yKSArIFwicHggYXJpYWxcIjtcbiAgICAgICAgICB2YXIgeCA9IGtleXBhZC5sZWZ0ICsgaSAqIGtleXBhZC51bml0ICsga2V5cGFkLmd1dHRlcixcbiAgICAgICAgICAgICAgeSA9IGtleXBhZC5ib3R0b20gLSBrZXlwYWQudW5pdCxcbiAgICAgICAgICAgICAga2V5ID0gUS5pbnB1dHNbY29udHJvbFswXV07XG5cbiAgICAgICAgICBjdHguZmlsbFN0eWxlID0ga2V5cGFkLmNvbG9yIHx8IFwiI0ZGRkZGRlwiO1xuICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGtleSA/IDEuMCA6IDAuNTtcbiAgICAgICAgICBjdHguZmlsbFJlY3QoeCx5LGtleXBhZC5zaXplLGtleXBhZC5zaXplKTtcblxuICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBrZXlwYWQudGV4dCB8fCBcIiMwMDAwMDBcIjtcbiAgICAgICAgICBjdHguZmlsbFRleHQoY29udHJvbFsxXSxcbiAgICAgICAgICAgICAgICAgICAgICAgeCtrZXlwYWQuc2l6ZS8yLFxuICAgICAgICAgICAgICAgICAgICAgICB5K2tleXBhZC5zaXplLzIpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgfSxcblxuICAgIGRyYXdDaXJjbGU6IGZ1bmN0aW9uKHgseSxjb2xvcixzaXplKSB7XG4gICAgICB2YXIgY3R4ID0gUS5jdHgsXG4gICAgICAgICAgam95cGFkID0gUS5qb3lwYWQ7XG5cbiAgICAgIGN0eC5zYXZlKCk7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHguZ2xvYmFsQWxwaGE9am95cGFkLmFscGhhO1xuICAgICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xuICAgICAgY3R4LmFyYyh4LCB5LCBzaXplLCAwLCBNYXRoLlBJKjIsIHRydWUpOyBcbiAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgIGN0eC5maWxsKCk7XG4gICAgICBjdHgucmVzdG9yZSgpO1xuICAgIH0sXG5cblxuXG4gICAgLyoqIFxuICAgICAqIERyYXcgdGhlIGpveXBhZCBvbiB0aGUgc2NyZWVuXG4gICAgICpcbiAgICAgKiBvdmVybG9hZCB0aGlzIHRvIGNoYW5nZSBob3cgam95cGFkIGlzIGRyYXduXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGRyYXdKb3lwYWRcbiAgICAgKiBAZm9yIFEuSW5wdXRTeXN0ZW1cbiAgICAgKi9cbiAgICBkcmF3Sm95cGFkOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBqb3lwYWQgPSBRLmpveXBhZDtcbiAgICAgIGlmKGpveXBhZC5qb3lwYWRUb3VjaCAhPT0gbnVsbCkge1xuICAgICAgICBRLmlucHV0LmRyYXdDaXJjbGUoam95cGFkLmNlbnRlclgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBqb3lwYWQuY2VudGVyWSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGpveXBhZC5iYWNrZ3JvdW5kLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgam95cGFkLnNpemUpO1xuXG4gICAgICAgIGlmKGpveXBhZC54ICE9PSBudWxsKSB7XG4gICAgICAgICAgUS5pbnB1dC5kcmF3Q2lyY2xlKGpveXBhZC54LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgam95cGFkLnksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBqb3lwYWQuY29sb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBqb3lwYWQuY2VudGVyKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgfSxcblxuICAgIC8qKiBcbiAgICAgKiBDYWxsZWQgZWFjaCBmcmFtZSBieSB0aGUgc3RhZ2UgZ2FtZSBsb29wIHRvIHJlbmRlciBhbnkgb25zY3JlZW4gVUlcbiAgICAgKlxuICAgICAqIGNhbGxzIGBkcmF3Sm95cGFkYCBhbmQgYGRyYXdCdXR0b25zYCBpZiBlbmFibGVkXG4gICAgICpcbiAgICAgKiBAbWV0aG9kIGRyYXdDYW52YXNcbiAgICAgKiBAZm9yIFEuSW5wdXRTeXN0ZW1cbiAgICAgKi9cbiAgICBkcmF3Q2FudmFzOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmKHRoaXMudG91Y2hFbmFibGVkKSB7XG4gICAgICAgIHRoaXMuZHJhd0J1dHRvbnMoKTtcbiAgICAgIH1cblxuICAgICAgaWYodGhpcy5qb3lwYWRFbmFibGVkKSB7XG4gICAgICAgIHRoaXMuZHJhd0pveXBhZCgpO1xuICAgICAgfVxuICAgIH1cblxuXG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEluc3RhbmNlIG9mIHRoZSBpbnB1dCBzdWJzeXRlbSB0aGF0IGlzIGFjdHVhbGx5IHVzZWQgZHVyaW5nIGdhbWVwbGF5XG4gICAqXG4gICAqIEBwcm9wZXJ0eSBRLmlucHV0XG4gICAqIEBmb3IgUXVpbnR1cy5JbnB1dFxuICAgKiBAdHlwZSBRLklucHV0U3lzdGVtXG4gICAqL1xuICBRLmlucHV0ID0gbmV3IFEuSW5wdXRTeXN0ZW0oKTtcblxuICAvKipcbiAgICogSGVscGVyIG1ldGhvZCB0byBhY3RpdmF0ZSBjb250cm9scyB3aXRoIGRlZmF1bHQgb3B0aW9uc1xuICAgKlxuICAgKiBAZm9yIFF1aW50dXMuSW5wdXRcbiAgICogQG1ldGhvZCBRLmNvbnRyb2xzXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gam95cGFkIC0gZW5hYmxlIDQtd2F5IGpveXBhZCAodHJ1ZSkgb3IganVzdCBsZWZ0LCByaWdodCBjb250cm9scyAoZmFsc2UsIHVuZGVmaW5lZClcbiAgICovXG4gIFEuY29udHJvbHMgPSBmdW5jdGlvbihqb3lwYWQpIHtcbiAgICBRLmlucHV0LmtleWJvYXJkQ29udHJvbHMoKTtcblxuICAgIGlmKGpveXBhZCkge1xuICAgICAgUS5pbnB1dC50b3VjaENvbnRyb2xzKHtcbiAgICAgICAgY29udHJvbHM6IFsgW10sW10sW10sWydhY3Rpb24nLCdiJ10sWydmaXJlJywnYSddXVxuICAgICAgfSk7XG4gICAgICBRLmlucHV0LmpveXBhZENvbnRyb2xzKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIFEuaW5wdXQudG91Y2hDb250cm9scygpO1xuICAgIH1cblxuICAgIHJldHVybiBRO1xuICB9O1xuICBcblxuICAvKipcbiAgICogUGxhdGZvcm1lciBDb250cm9sIENvbXBvbmVudFxuICAgKlxuICAgKiBBZGRzIDJEIHBsYXRmb3JtZXIgY29udHJvbHMgb250byBhIFNwcml0ZVxuICAgKlxuICAgKiBQbGF0Zm9ybWVyIGNvbnRyb2xzIGJpbmQgdG8gbGVmdCwgYW5kIHJpZ2h0IGFuZCBhbGxvdyB0aGUgcGxheWVyIHRvIGp1bXAuIFxuICAgKlxuICAgKiBBZGRzIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllcyB0byB0aGUgZW50aXR5IHRvIGNvbnRyb2wgc3BlZWQgYW5kIGp1bXBpbmc6XG4gICAqXG4gICAqICAgICAgeyBcbiAgICogICAgICAgIHNwZWVkOiAyMDAsXG4gICAqICAgICAgICBqdW1wU3BlZWQ6IC0zMDBcbiAgICogICAgICB9XG4gICAqXG4gICAqXG4gICAqIEBjbGFzcyBwbGF0Zm9ybWVyQ29udHJvbHNcbiAgICogQGZvciBRdWludHVzLklucHV0XG4gICAqL1xuICBRLmNvbXBvbmVudChcInBsYXRmb3JtZXJDb250cm9sc1wiLCB7XG4gICAgZGVmYXVsdHM6IHtcbiAgICAgIHNwZWVkOiAyMDAsXG4gICAgICBqdW1wU3BlZWQ6IC0zMDAsXG4gICAgICBjb2xsaXNpb25zOiBbXVxuICAgIH0sXG5cbiAgICBhZGRlZDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcCA9IHRoaXMuZW50aXR5LnA7XG5cbiAgICAgIFEuX2RlZmF1bHRzKHAsdGhpcy5kZWZhdWx0cyk7XG5cbiAgICAgIHRoaXMuZW50aXR5Lm9uKFwic3RlcFwiLHRoaXMsXCJzdGVwXCIpO1xuICAgICAgdGhpcy5lbnRpdHkub24oXCJidW1wLmJvdHRvbVwiLHRoaXMsXCJsYW5kZWRcIik7XG5cbiAgICAgIHAubGFuZGVkID0gMDtcbiAgICAgIHAuZGlyZWN0aW9uID0ncmlnaHQnO1xuICAgIH0sXG5cbiAgICBsYW5kZWQ6IGZ1bmN0aW9uKGNvbCkge1xuICAgICAgdmFyIHAgPSB0aGlzLmVudGl0eS5wO1xuICAgICAgcC5sYW5kZWQgPSAxLzU7XG4gICAgfSxcblxuICAgIHN0ZXA6IGZ1bmN0aW9uKGR0KSB7XG4gICAgICB2YXIgcCA9IHRoaXMuZW50aXR5LnA7XG4gICAgICBcbiAgICAgIGlmKHAuaWdub3JlQ29udHJvbHMgPT09IHVuZGVmaW5lZCB8fCAhcC5pZ25vcmVDb250cm9scykge1xuICAgICAgICB2YXIgY29sbGlzaW9uID0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIC8vIEZvbGxvdyBhbG9uZyB0aGUgY3VycmVudCBzbG9wZSwgaWYgcG9zc2libGUuXG4gICAgICAgIGlmKHAuY29sbGlzaW9ucyAhPT0gdW5kZWZpbmVkICYmIHAuY29sbGlzaW9ucy5sZW5ndGggPiAwICYmIChRLmlucHV0c1snbGVmdCddIHx8IFEuaW5wdXRzWydyaWdodCddIHx8IHAubGFuZGVkID4gMCkpIHtcbiAgICAgICAgICBpZihwLmNvbGxpc2lvbnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICBjb2xsaXNpb24gPSBwLmNvbGxpc2lvbnNbMF07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIElmIHRoZXJlJ3MgbW9yZSB0aGFuIG9uZSBwb3NzaWJsZSBzbG9wZSwgZm9sbG93IHNsb3BlIHdpdGggbmVnYXRpdmUgWSBub3JtYWxcbiAgICAgICAgICAgIGNvbGxpc2lvbiA9IG51bGw7XG5cbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBwLmNvbGxpc2lvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgaWYocC5jb2xsaXNpb25zW2ldLm5vcm1hbFkgPCAwKSB7XG4gICAgICAgICAgICAgICAgY29sbGlzaW9uID0gcC5jb2xsaXNpb25zW2ldO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9ICAgICAgICAgIFxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBEb24ndCBjbGltYiB1cCB3YWxscy4gICAgICBcbiAgICAgICAgICBpZihjb2xsaXNpb24gIT09IG51bGwgJiYgY29sbGlzaW9uLm5vcm1hbFkgPiAtMC4zICYmIGNvbGxpc2lvbi5ub3JtYWxZIDwgMC4zKSB7ICAgICAgICBcbiAgICAgICAgICAgIGNvbGxpc2lvbiA9IG51bGw7XG4gICAgICAgICAgfSAgICAgICAgXG4gICAgICAgIH0gICAgICBcblxuICAgICAgICBpZihRLmlucHV0c1snbGVmdCddKSB7XG4gICAgICAgICAgcC5kaXJlY3Rpb24gPSAnbGVmdCc7XG4gICAgICAgICAgaWYoY29sbGlzaW9uICYmIHAubGFuZGVkID4gMCkge1xuICAgICAgICAgICAgcC52eCA9IHAuc3BlZWQgKiBjb2xsaXNpb24ubm9ybWFsWTtcbiAgICAgICAgICAgIHAudnkgPSAtcC5zcGVlZCAqIGNvbGxpc2lvbi5ub3JtYWxYO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwLnZ4ID0gLXAuc3BlZWQ7XG4gICAgICAgICAgfSAgICAgICAgXG4gICAgICAgIH0gZWxzZSBpZihRLmlucHV0c1sncmlnaHQnXSkge1xuICAgICAgICAgIHAuZGlyZWN0aW9uID0gJ3JpZ2h0JztcbiAgICAgICAgICBpZihjb2xsaXNpb24gJiYgcC5sYW5kZWQgPiAwKSB7XG4gICAgICAgICAgICBwLnZ4ID0gLXAuc3BlZWQgKiBjb2xsaXNpb24ubm9ybWFsWTtcbiAgICAgICAgICAgIHAudnkgPSBwLnNwZWVkICogY29sbGlzaW9uLm5vcm1hbFg7ICAgICAgICAgIFxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwLnZ4ID0gcC5zcGVlZDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcC52eCA9IDA7XG4gICAgICAgICAgaWYoY29sbGlzaW9uICYmIHAubGFuZGVkID4gMCkge1xuICAgICAgICAgICAgcC52eSA9IDA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZihwLmxhbmRlZCA+IDAgJiYgKFEuaW5wdXRzWyd1cCddIHx8IFEuaW5wdXRzWydhY3Rpb24nXSkgJiYgIXAuanVtcGluZykge1xuICAgICAgICAgIHAudnkgPSBwLmp1bXBTcGVlZDtcbiAgICAgICAgICBwLmxhbmRlZCA9IC1kdDtcbiAgICAgICAgICBwLmp1bXBpbmcgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYoUS5pbnB1dHNbJ3VwJ10gfHwgUS5pbnB1dHNbJ2FjdGlvbiddKSB7XG4gICAgICAgICAgdGhpcy5lbnRpdHkudHJpZ2dlcignanVtcCcsIHRoaXMuZW50aXR5KTtcbiAgICAgICAgICBwLmp1bXBpbmcgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZihwLmp1bXBpbmcgJiYgIShRLmlucHV0c1sndXAnXSB8fCBRLmlucHV0c1snYWN0aW9uJ10pKSB7XG4gICAgICAgICAgcC5qdW1waW5nID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5lbnRpdHkudHJpZ2dlcignanVtcGVkJywgdGhpcy5lbnRpdHkpO1xuICAgICAgICAgIGlmKHAudnkgPCBwLmp1bXBTcGVlZCAvIDMpIHtcbiAgICAgICAgICAgIHAudnkgPSBwLmp1bXBTcGVlZCAvIDM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBwLmxhbmRlZCAtPSBkdDtcbiAgICB9XG4gIH0pO1xuXG5cbiAgLyoqXG4gICAqIFN0ZXAgQ29udHJvbHMgY29tcG9uZW50XG4gICAqXG4gICAqIEFkZHMgU3RlcCAoc3F1YXJlIGdyaWQgYmFzZWQpIDQtd2F5cyBjb250cm9scyBvbnRvIGEgU3ByaXRlXG4gICAqXG4gICAqIEFkZHMgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzIHRvIHRoZSBlbnRpdHk6XG4gICAqXG4gICAqICAgICAgeyBcbiAgICogICAgICAgIHN0ZXBEaXN0YW5jZTogMzIsIC8vIHNob3VsZCBiZSB0aWxlIHNpemVcbiAgICogICAgICAgIHN0ZXBEZWxheTogMC4yICAvLyBzZWNvbmRzIHRvIGRlbGF5IGJlZm9yZSBuZXh0IHN0ZXBcbiAgICogICAgICB9XG4gICAqXG4gICAqXG4gICAqIEBjbGFzcyBzdGVwQ29udHJvbHNcbiAgICogQGZvciBRdWludHVzLklucHV0XG4gICAqL1xuICBRLmNvbXBvbmVudChcInN0ZXBDb250cm9sc1wiLCB7XG5cbiAgICBhZGRlZDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcCA9IHRoaXMuZW50aXR5LnA7XG5cbiAgICAgIGlmKCFwLnN0ZXBEaXN0YW5jZSkgeyBwLnN0ZXBEaXN0YW5jZSA9IDMyOyB9XG4gICAgICBpZighcC5zdGVwRGVsYXkpIHsgcC5zdGVwRGVsYXkgPSAwLjI7IH1cblxuICAgICAgcC5zdGVwV2FpdCA9IDA7XG4gICAgICB0aGlzLmVudGl0eS5vbihcInN0ZXBcIix0aGlzLFwic3RlcFwiKTtcbiAgICAgIHRoaXMuZW50aXR5Lm9uKFwiaGl0XCIsIHRoaXMsXCJjb2xsaXNpb25cIik7XG4gICAgfSxcblxuICAgIGNvbGxpc2lvbjogZnVuY3Rpb24oY29sKSB7XG4gICAgICB2YXIgcCA9IHRoaXMuZW50aXR5LnA7XG5cbiAgICAgIGlmKHAuc3RlcHBpbmcpIHtcbiAgICAgICAgcC5zdGVwcGluZyA9IGZhbHNlO1xuICAgICAgICBwLnggPSBwLm9yaWdYO1xuICAgICAgICBwLnkgPSBwLm9yaWdZO1xuICAgICAgfVxuXG4gICAgfSxcblxuICAgIHN0ZXA6IGZ1bmN0aW9uKGR0KSB7XG4gICAgICB2YXIgcCA9IHRoaXMuZW50aXR5LnAsXG4gICAgICAgICAgbW92ZWQgPSBmYWxzZTtcbiAgICAgIHAuc3RlcFdhaXQgLT0gZHQ7XG5cbiAgICAgIGlmKHAuc3RlcHBpbmcpIHtcbiAgICAgICAgcC54ICs9IHAuZGlmZlggKiBkdCAvIHAuc3RlcERlbGF5O1xuICAgICAgICBwLnkgKz0gcC5kaWZmWSAqIGR0IC8gcC5zdGVwRGVsYXk7XG4gICAgICB9XG5cbiAgICAgIGlmKHAuc3RlcFdhaXQgPiAwKSB7IHJldHVybjsgfVxuICAgICAgaWYocC5zdGVwcGluZykge1xuICAgICAgICBwLnggPSBwLmRlc3RYO1xuICAgICAgICBwLnkgPSBwLmRlc3RZO1xuICAgICAgfVxuICAgICAgcC5zdGVwcGluZyA9IGZhbHNlO1xuXG4gICAgICBwLmRpZmZYID0gMDtcbiAgICAgIHAuZGlmZlkgPSAwO1xuXG4gICAgICBpZihRLmlucHV0c1snbGVmdCddKSB7XG4gICAgICAgIHAuZGlmZlggPSAtcC5zdGVwRGlzdGFuY2U7XG4gICAgICB9IGVsc2UgaWYoUS5pbnB1dHNbJ3JpZ2h0J10pIHtcbiAgICAgICAgcC5kaWZmWCA9IHAuc3RlcERpc3RhbmNlO1xuICAgICAgfVxuXG4gICAgICBpZihRLmlucHV0c1sndXAnXSkge1xuICAgICAgICBwLmRpZmZZID0gLXAuc3RlcERpc3RhbmNlO1xuICAgICAgfSBlbHNlIGlmKFEuaW5wdXRzWydkb3duJ10pIHtcbiAgICAgICAgcC5kaWZmWSA9IHAuc3RlcERpc3RhbmNlO1xuICAgICAgfVxuXG4gICAgICBpZihwLmRpZmZZIHx8IHAuZGlmZlggKSB7IFxuICAgICAgICBwLnN0ZXBwaW5nID0gdHJ1ZTtcbiAgICAgICAgcC5vcmlnWCA9IHAueDtcbiAgICAgICAgcC5vcmlnWSA9IHAueTtcbiAgICAgICAgcC5kZXN0WCA9IHAueCArIHAuZGlmZlg7XG4gICAgICAgIHAuZGVzdFkgPSBwLnkgKyBwLmRpZmZZO1xuICAgICAgICBwLnN0ZXBXYWl0ID0gcC5zdGVwRGVsYXk7IFxuICAgICAgfVxuXG4gICAgfVxuXG4gIH0pO1xufTtcblxuIiwiLypnbG9iYWwgUXVpbnR1czpmYWxzZSAqL1xuXG4vKipcblF1aW50dXMgSFRNTDUgR2FtZSBFbmdpbmUgLSBTY2VuZXMgTW9kdWxlXG5cblRoZSBjb2RlIGluIGBxdWludHVzX3NjZW5lcy5qc2AgZGVmaW5lcyB0aGUgYFF1aW50dXMuU2NlbmVzYCBtb2R1bGUsIHdoaWNoXG5hZGRzIGluIHN1cHBvcnQgZm9yIFNjZW5lcyBhbmQgU3RhZ2VzIGludG8gUXVpbnR1cy4gXG5cbkRlcGVuZHMgb24gdGhlIGBRdWludHVzLlNwcml0ZWAgbW9kdWxlLlxuXG5TY2VuZXMgbGV0IHlvdSBjcmVhdGUgcmV1c2FibGUgZGVmaW5pdGlvbnMgZm9yIHNldHRpbmcgdXAgbGV2ZWxzIGFuZCBzY3JlZW5zLlxuXG5TdGFnZXMgYXJlIHRoZSBwcmltYXJ5IGNvbnRhaW5lciBvYmplY3QgaW4gUXVpbnR1cywgaGFuZGxpbmcgU3ByaXRlIG1hbmFnZW1lbnQsXG5zdGVwcGluZywgcmVuZGVyaW5nIGFuZCBjb2xsaXNpb24gZGV0ZWN0aW9uLlxuXG5AbW9kdWxlIFF1aW50dXMuU2NlbmVzXG4qL1xuXG4vKiogXG4gKiBRdWludHVzIFNjZW5lcyBNb2R1bGUgQ2xhc3NcbiAqXG4gKiBAY2xhc3MgUXVpbnR1cy5TY2VuZXNcbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihRKSB7XG5cbiAgUS5zY2VuZXMgPSB7fTtcbiAgUS5zdGFnZXMgPSBbXTtcblxuXG4gIC8qKiBcbiAgIEJhc2ljIHNjZW5lIGNsYXNzLCBjb25zaXN0aW5nIHByaW1hcmlseSBvZiBhIHNjZW5lIGZ1bmN0aW9uIFxuICAgYW5kIHNvbWUgb3B0aW9ucyB0aGF0IGFyZSBwYXNzZWQgdG8gdGhlIHN0YWdlLlxuXG4gICBTaG91bGQgYmUgaW5zdGFudGlhdGVkIGJ5IGNhbGxpbmcgYFEuc2NlbmVgIG5vdCBuZXdcblxuICAgQGNsYXNzIFEuU2NlbmVcbiAgIEBmb3IgUXVpbnR1cy5TY2VuZXNcbiAgKi9cbiAgUS5DbGFzcy5leHRlbmQoJ1NjZW5lJyx7XG4gICAgaW5pdDogZnVuY3Rpb24oc2NlbmVGdW5jLG9wdHMpIHtcbiAgICAgIHRoaXMub3B0cyA9IG9wdHMgfHwge307XG4gICAgICB0aGlzLnNjZW5lRnVuYyA9IHNjZW5lRnVuYztcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgU2V0IHVwIGEgbmV3IHNjZW5lIG9yIHJldHVybiBhbiBleGlzdGluZyBzY2VuZS4gSWYgeW91IGRvbid0IHBhc3MgaW4gYHNjZW5lRnVuY2AsIFxuICAgaXQnbGwgcmV0dXJuIGEgc2NlbmUgb3RoZXJ3aXNlIGl0J2xsIGNyZWF0ZSBhIG5ldyBvbmUuXG5cbiAgIEBtZXRob2QgUS5zY2VuZVxuICAgQGZvciBRdWludHVzLlNjZW5lc1xuICAgQHBhcmFtIHtTdHJpbmd9IG5hbWUgLSBuYW1lIG9mIHNjZW5lIHRvIGNyZWF0ZSBvciByZXR1cm5cbiAgIEBwYXJhbSB7RnVuY3Rpb259IFtzY2VuZUZ1bmNdIC0gc2NlbmUgZnVuY3Rpb246IGBmdW5jdGlvbihzdGFnZSkgeyAuLiB9YCB0aGF0IHNldHMgdXAgdGhlIHN0YWdlXG4gICovXG4gIFEuc2NlbmUgPSBmdW5jdGlvbihuYW1lLHNjZW5lRnVuYyxvcHRzKSB7XG4gICAgaWYoc2NlbmVGdW5jID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBRLnNjZW5lc1tuYW1lXTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYoUS5faXNGdW5jdGlvbihzY2VuZUZ1bmMpKSB7XG4gICAgICAgIHNjZW5lRnVuYyA9IG5ldyBRLlNjZW5lKHNjZW5lRnVuYyxvcHRzKTtcbiAgICAgICAgc2NlbmVGdW5jLm5hbWUgPSBuYW1lO1xuICAgICAgfVxuICAgICAgUS5zY2VuZXNbbmFtZV0gPSBzY2VuZUZ1bmM7XG4gICAgICByZXR1cm4gc2NlbmVGdW5jO1xuICAgIH1cbiAgfTtcblxuICBRLl9udWxsQ29udGFpbmVyID0ge1xuICAgIGM6IHtcbiAgICAgIHg6IDAsXG4gICAgICB5OiAwLFxuICAgICAgYW5nbGU6IDAsXG4gICAgICBzY2FsZTogMVxuICAgIH0sXG4gICAgbWF0cml4OiBRLm1hdHJpeDJkKClcbiAgfTtcblxuIFxuICAvKipcbiAgIFNBVCBjb2xsaXNpb24gZGV0ZWN0aW9uIGJldHdlZW4gdHdvIG9iamVjdHNcbiAgIFRoYW5rcyB0byBkb2MncyBhdDogaHR0cDovL3d3dy5zZXZlbnNvbi5jb20uYXUvYWN0aW9uc2NyaXB0L3NhdC9cblxuICAgVGhpcyBpcyBzb3J0IG9mIGEgYmxhY2sgYm94IC0gdXNlIHRoZSBtZXRob2RzIG9uIHN0YWdlIGxpa2UgYHNlYXJjaGAgYW5kIGBjb2xsaWRlYCB0b1xuICAgcnVuIHRoZSBjb2xsaXNpb24gc3lzdGVtLlxuXG4gICBAcHJvcGVydHkgUS5jb2xsaXNpb25cbiAgIEBmb3IgUXVpbnR1cy5TY2VuZXNcbiAgKi9cbiAgUS5jb2xsaXNpb24gPSAoZnVuY3Rpb24oKSB7IFxuICAgIHZhciBub3JtYWxYLCBub3JtYWxZLFxuICAgICAgICBvZmZzZXQgPSBbIDAsMCBdLFxuICAgICAgICByZXN1bHQxID0geyBzZXBhcmF0ZTogW10gfSxcbiAgICAgICAgcmVzdWx0MiA9IHsgc2VwYXJhdGU6IFtdIH07XG5cbiAgICBmdW5jdGlvbiBjYWxjdWxhdGVOb3JtYWwocG9pbnRzLGlkeCkge1xuICAgICAgdmFyIHB0MSA9IHBvaW50c1tpZHhdLFxuICAgICAgICAgIHB0MiA9IHBvaW50c1tpZHgrMV0gfHwgcG9pbnRzWzBdO1xuXG4gICAgICBub3JtYWxYID0gLShwdDJbMV0gLSBwdDFbMV0pO1xuICAgICAgbm9ybWFsWSA9IHB0MlswXSAtIHB0MVswXTtcblxuICAgICAgdmFyIGRpc3QgPSBNYXRoLnNxcnQobm9ybWFsWCpub3JtYWxYICsgbm9ybWFsWSpub3JtYWxZKTtcbiAgICAgIGlmKGRpc3QgPiAwKSB7XG4gICAgICAgIG5vcm1hbFggLz0gZGlzdDtcbiAgICAgICAgbm9ybWFsWSAvPSBkaXN0O1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRvdFByb2R1Y3RBZ2FpbnN0Tm9ybWFsKHBvaW50KSB7XG4gICAgICByZXR1cm4gKG5vcm1hbFggKiBwb2ludFswXSkgKyAobm9ybWFsWSAqIHBvaW50WzFdKTtcblxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNvbGxpZGUobzEsbzIsZmxpcCkge1xuICAgICAgdmFyIG1pbjEsbWF4MSxcbiAgICAgICAgICBtaW4yLG1heDIsXG4gICAgICAgICAgZDEsIGQyLFxuICAgICAgICAgIG9mZnNldExlbmd0aCxcbiAgICAgICAgICB0bXAsIGksIGosXG4gICAgICAgICAgbWluRGlzdCwgbWluRGlzdEFicyxcbiAgICAgICAgICBzaG9ydGVzdERpc3QgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksXG4gICAgICAgICAgY29sbGlkZWQgPSBmYWxzZSxcbiAgICAgICAgICBwMSwgcDI7XG5cbiAgICAgIHZhciByZXN1bHQgPSBmbGlwID8gcmVzdWx0MiA6IHJlc3VsdDE7XG5cbiAgICAgIG9mZnNldFswXSA9IDA7IC8vbzEueCArIG8xLmN4IC0gbzIueCAtIG8yLmN4O1xuICAgICAgb2Zmc2V0WzFdID0gMDsgLy9vMS55ICsgbzEuY3kgLSBvMi55IC0gbzIuY3k7XG5cbiAgICAgIC8vIElmIHdlIGhhdmUgYSBwb3NpdGlvbiBtYXRyaXgsIGp1c3QgdXNlIHRob3NlIHBvaW50cyxcbiAgICAgIGlmKG8xLmMpIHtcbiAgICAgICAgcDEgPSBvMS5jLnBvaW50cztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHAxID0gbzEucC5wb2ludHM7XG4gICAgICAgIG9mZnNldFswXSArPSBvMS5wLng7XG4gICAgICAgIG9mZnNldFsxXSArPSBvMS5wLnk7XG4gICAgICB9XG5cbiAgICAgIGlmKG8yLmMpIHtcbiAgICAgICAgcDIgPSBvMi5jLnBvaW50cztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHAyID0gbzIucC5wb2ludHM7XG4gICAgICAgIG9mZnNldFswXSArPSAtbzIucC54O1xuICAgICAgICBvZmZzZXRbMV0gKz0gLW8yLnAueTsgXG4gICAgICB9XG5cbiAgICAgIG8xID0gbzEucDtcbiAgICAgIG8yID0gbzIucDtcblxuXG4gICAgICBmb3IoaSA9IDA7aTxwMS5sZW5ndGg7aSsrKSB7XG4gICAgICAgIGNhbGN1bGF0ZU5vcm1hbChwMSxpKTtcblxuICAgICAgICBtaW4xID0gZG90UHJvZHVjdEFnYWluc3ROb3JtYWwocDFbMF0pO1xuICAgICAgICBtYXgxID0gbWluMTtcblxuICAgICAgICBmb3IoaiA9IDE7IGo8cDEubGVuZ3RoO2orKykge1xuICAgICAgICAgIHRtcCA9IGRvdFByb2R1Y3RBZ2FpbnN0Tm9ybWFsKHAxW2pdKTtcbiAgICAgICAgICBpZih0bXAgPCBtaW4xKSB7IG1pbjEgPSB0bXA7IH1cbiAgICAgICAgICBpZih0bXAgPiBtYXgxKSB7IG1heDEgPSB0bXA7IH1cbiAgICAgICAgfVxuXG4gICAgICAgIG1pbjIgPSBkb3RQcm9kdWN0QWdhaW5zdE5vcm1hbChwMlswXSk7XG4gICAgICAgIG1heDIgPSBtaW4yO1xuXG4gICAgICAgIGZvcihqID0gMTtqPHAyLmxlbmd0aDtqKyspIHtcbiAgICAgICAgICB0bXAgPSBkb3RQcm9kdWN0QWdhaW5zdE5vcm1hbChwMltqXSk7XG4gICAgICAgICAgaWYodG1wIDwgbWluMikgeyBtaW4yID0gdG1wOyB9XG4gICAgICAgICAgaWYodG1wID4gbWF4MikgeyBtYXgyID0gdG1wOyB9XG4gICAgICAgIH1cblxuICAgICAgICBvZmZzZXRMZW5ndGggPSBkb3RQcm9kdWN0QWdhaW5zdE5vcm1hbChvZmZzZXQpO1xuICAgICAgICBtaW4xICs9IG9mZnNldExlbmd0aDtcbiAgICAgICAgbWF4MSArPSBvZmZzZXRMZW5ndGg7XG5cbiAgICAgICAgZDEgPSBtaW4xIC0gbWF4MjtcbiAgICAgICAgZDIgPSBtaW4yIC0gbWF4MTtcblxuICAgICAgICBpZihkMSA+IDAgfHwgZDIgPiAwKSB7IHJldHVybiBudWxsOyB9XG5cbiAgICAgICAgbWluRGlzdCA9IChtYXgyIC0gbWluMSkgKiAtMTtcbiAgICAgICAgaWYoZmxpcCkgeyBtaW5EaXN0ICo9IC0xOyB9XG5cbiAgICAgICAgbWluRGlzdEFicyA9IE1hdGguYWJzKG1pbkRpc3QpO1xuXG4gICAgICAgIGlmKG1pbkRpc3RBYnMgPCBzaG9ydGVzdERpc3QpIHtcbiAgICAgICAgICByZXN1bHQuZGlzdGFuY2UgPSBtaW5EaXN0O1xuICAgICAgICAgIHJlc3VsdC5tYWduaXR1ZGUgPSBtaW5EaXN0QWJzO1xuICAgICAgICAgIHJlc3VsdC5ub3JtYWxYID0gbm9ybWFsWDtcbiAgICAgICAgICByZXN1bHQubm9ybWFsWSA9IG5vcm1hbFk7XG5cbiAgICAgICAgICBpZihyZXN1bHQuZGlzdGFuY2UgPiAwKSB7XG4gICAgICAgICAgICByZXN1bHQuZGlzdGFuY2UgKj0gLTE7XG4gICAgICAgICAgICByZXN1bHQubm9ybWFsWCAqPSAtMTtcbiAgICAgICAgICAgIHJlc3VsdC5ub3JtYWxZICo9IC0xO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbGxpZGVkID0gdHJ1ZTtcbiAgICAgICAgICBzaG9ydGVzdERpc3QgPSBtaW5EaXN0QWJzO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIERvIHJldHVybiB0aGUgYWN0dWFsIGNvbGxpc2lvblxuICAgICAgcmV0dXJuIGNvbGxpZGVkID8gcmVzdWx0IDogbnVsbDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzYXRDb2xsaXNpb24obzEsbzIpIHtcbiAgICAgIHZhciByZXN1bHQxLCByZXN1bHQyLCByZXN1bHQ7XG5cbiAgICAgIGlmKCFvMS5wLnBvaW50cykgeyBRLl9nZW5lcmF0ZVBvaW50cyhvMSk7IH1cbiAgICAgIGlmKCFvMi5wLnBvaW50cykgeyBRLl9nZW5lcmF0ZVBvaW50cyhvMik7IH1cblxuICAgICAgcmVzdWx0MSA9IGNvbGxpZGUobzEsbzIpO1xuICAgICAgaWYoIXJlc3VsdDEpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgIHJlc3VsdDIgPSBjb2xsaWRlKG8yLG8xLHRydWUpO1xuICAgICAgaWYoIXJlc3VsdDIpIHsgcmV0dXJuIGZhbHNlOyB9XG5cbiAgICAgIHJlc3VsdCA9IChyZXN1bHQyLm1hZ25pdHVkZSA8IHJlc3VsdDEubWFnbml0dWRlKSA/IHJlc3VsdDIgOiByZXN1bHQxO1xuXG4gICAgICBpZihyZXN1bHQubWFnbml0dWRlID09PSAwKSB7IHJldHVybiBmYWxzZTsgfVxuICAgICAgcmVzdWx0LnNlcGFyYXRlWzBdID0gcmVzdWx0LmRpc3RhbmNlICogcmVzdWx0Lm5vcm1hbFg7XG4gICAgICByZXN1bHQuc2VwYXJhdGVbMV0gPSByZXN1bHQuZGlzdGFuY2UgKiByZXN1bHQubm9ybWFsWTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICByZXR1cm4gc2F0Q29sbGlzaW9uO1xuICB9KCkpO1xuXG5cbiAgLyoqXG4gICBDaGVjayBmb3IgdGhlIG92ZXJsYXAgb2YgdGhlIGJvdWRuaW5nIGJveGVzIG9mIHR3byBTcHJpdGVzXG5cbiAgIEBtZXRob2QgUS5vdmVybGFwXG4gICBAZm9yIFF1aW50dXMuU2NlbmVzXG4gICBAcGFyYW0ge1EuU3ByaXRlfSBvMVxuICAgQHBhcmFtIHtRLlNwcml0ZX0gbzJcbiAgIEByZXR1cm5zIHtCb29sZWFufVxuICAqL1xuICBRLm92ZXJsYXAgPSBmdW5jdGlvbihvMSxvMikge1xuICAgIHZhciBjMSA9IG8xLmMgfHwgbzEucCB8fCBvMTtcbiAgICB2YXIgYzIgPSBvMi5jIHx8IG8yLnAgfHwgbzI7XG5cbiAgICB2YXIgbzF4ID0gYzEueCAtIChjMS5jeCB8fCAwKSxcbiAgICAgICAgbzF5ID0gYzEueSAtIChjMS5jeSB8fCAwKTtcbiAgICB2YXIgbzJ4ID0gYzIueCAtIChjMi5jeCB8fCAwKSxcbiAgICAgICAgbzJ5ID0gYzIueSAtIChjMi5jeSB8fCAwKTtcblxuICAgIHJldHVybiAhKChvMXkrYzEuaDxvMnkpIHx8IChvMXk+bzJ5K2MyLmgpIHx8XG4gICAgICAgICAgICAgKG8xeCtjMS53PG8yeCkgfHwgKG8xeD5vMngrYzIudykpO1xuICB9O1xuXG4gIC8qKlxuICAgQmFzZSBzdGFnZSBjbGFzcywgcmVzcG9uc2libGUgZm9yIG1hbmFnaW5nIHNldHMgb2Ygc3ByaXRlcy5cblxuICAgYFEuU3RhZ2VgJ3MgYXJlbid0IGdlbmVyYWxseSBpbnN0YW50aWF0ZWQgZGlyZWN0bHksIGJ1dCByYXRoZXIgYXJlIGNyZWF0ZWRcbiAgIGF1dG9tYXRpY2FsbHkgd2hlbiB5b3UgY2FsbCBgUS5zdGFnZVNjZW5lKCdzY2VuZU5hbWUnKWBcblxuICAgQGNsYXNzIFEuU3RhZ2VcbiAgIEBleHRlbmRzIFEuR2FtZU9iamVjdFxuICAgQGZvciBRdWludHVzLlNjZW5lc1xuICAqL1xuICBRLlN0YWdlID0gUS5HYW1lT2JqZWN0LmV4dGVuZCh7XG4gICAgLy8gU2hvdWxkIGtub3cgd2hldGhlciBvciBub3QgdGhlIHN0YWdlIGlzIHBhdXNlZFxuICAgIGRlZmF1bHRzOiB7XG4gICAgICBzb3J0OiBmYWxzZSxcbiAgICAgIGdyaWRXOiA0MDAsXG4gICAgICBncmlkSDogNDAwLFxuICAgICAgeDogMCxcbiAgICAgIHk6IDBcbiAgICB9LFxuXG4gICAgaW5pdDogZnVuY3Rpb24oc2NlbmUsb3B0cykge1xuICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xuICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuICAgICAgdGhpcy5saXN0cyA9IHt9O1xuICAgICAgdGhpcy5pbmRleCA9IHt9O1xuICAgICAgdGhpcy5yZW1vdmVMaXN0ID0gW107XG4gICAgICB0aGlzLmdyaWQgPSB7fTtcbiAgICAgIHRoaXMuX2NvbGxpc2lvbkxheWVycyA9IFtdO1xuXG4gICAgICB0aGlzLnRpbWUgPSAwO1xuXG4gICAgICB0aGlzLmRlZmF1bHRzWyd3J10gPSBRLndpZHRoO1xuICAgICAgdGhpcy5kZWZhdWx0c1snaCddID0gUS5oZWlnaHQ7XG5cbiAgICAgIHRoaXMub3B0aW9ucyA9IFEuX2V4dGVuZCh7fSx0aGlzLmRlZmF1bHRzKTtcbiAgICAgIGlmKHRoaXMuc2NlbmUpICB7IFxuICAgICAgICBRLl9leHRlbmQodGhpcy5vcHRpb25zLHNjZW5lLm9wdHMpO1xuICAgICAgfVxuICAgICAgaWYob3B0cykgeyBRLl9leHRlbmQodGhpcy5vcHRpb25zLG9wdHMpOyB9XG5cblxuICAgICAgaWYodGhpcy5vcHRpb25zLnNvcnQgJiYgIVEuX2lzRnVuY3Rpb24odGhpcy5vcHRpb25zLnNvcnQpKSB7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLnNvcnQgPSBmdW5jdGlvbihhLGIpIHsgcmV0dXJuICgoYS5wICYmIGEucC56KSB8fCAtMSkgLSAoKGIucCAmJiBiLnAueikgfHwgLTEpOyB9O1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBkZXN0cm95ZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5pbnZva2UoXCJkZWJpbmRcIik7XG4gICAgICB0aGlzLnRyaWdnZXIoXCJkZXN0cm95ZWRcIik7XG4gICAgfSxcblxuICAgIC8vIE5lZWRzIHRvIGJlIHNlcGFyYXRlZCBvdXQgc28gdGhlIGN1cnJlbnQgc3RhZ2UgY2FuIGJlIHNldFxuICAgIGxvYWRTY2VuZTogZnVuY3Rpb24oKSB7XG4gICAgICBpZih0aGlzLnNjZW5lKSAgeyBcbiAgICAgICAgdGhpcy5zY2VuZS5zY2VuZUZ1bmModGhpcyk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAgTG9hZCBhbiBhcnJheSBvZiBhc3NldHMgb2YgdGhlIGZvcm06XG5cbiAgICAgICAgICBbIFsgXCJQbGF5ZXJcIiwgeyB4OiAxNSwgeTogNTQgfSBdLFxuICAgICAgICAgICAgWyBcIkVuZW15XCIsICB7IHg6IDU0LCB5OiA0MiB9IF0gXVxuXG4gICAgICBFaXRoZXIgcGFzcyBpbiB0aGUgYXJyYXkgb3IgYSBzdHJpbmcgb2YgYXNzZXQgbmFtZVxuXG4gICAgIEBtZXRob2QgbG9hZEFzc2V0c1xuICAgICBAcGFyYW0ge0FycmF5IG9yIFN0cmluZ30gYXNzZXQgLSBBcnJheSBvZiBhc3NldHMgb3IgYSBzdHJpbmcgb2YgYXNzZXQgbmFtZVxuICAgICBAZm9yIFEuU3RhZ2VcbiAgICAqL1xuICAgIC8vIExvYWQgYW4gYXJyYXkgb2YgYXNzZXRzIG9mIHRoZSBmb3JtOlxuICAgIC8vIFsgWyBcIlBsYXllclwiLCB7IHg6IDE1LCB5OiA1NCB9IF0sXG4gICAgLy8gICBbIFwiRW5lbXlcIiwgIHsgeDogNTQsIHk6IDQyIH0gXSBdXG4gICAgLy8gRWl0aGVyIHBhc3MgaW4gdGhlIGFycmF5IG9yIGEgc3RyaW5nIG9mIGFzc2V0IG5hbWVcbiAgICBsb2FkQXNzZXRzOiBmdW5jdGlvbihhc3NldCkge1xuICAgICAgdmFyIGFzc2V0QXJyYXkgPSBRLl9pc0FycmF5KGFzc2V0KSA/IGFzc2V0IDogUS5hc3NldChhc3NldCk7XG4gICAgICBmb3IodmFyIGk9MDtpPGFzc2V0QXJyYXkubGVuZ3RoO2krKykge1xuICAgICAgICB2YXIgc3ByaXRlQ2xhc3MgPSBhc3NldEFycmF5W2ldWzBdO1xuICAgICAgICB2YXIgc3ByaXRlUHJvcHMgPSBhc3NldEFycmF5W2ldWzFdO1xuICAgICAgICB0aGlzLmluc2VydChuZXcgUVtzcHJpdGVDbGFzc10oc3ByaXRlUHJvcHMpKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIGV4ZWN1dGVzIHRoZSBjYWxsYmFjayBmb3IgZWFjaCBpdGVtIGluIHRoZSBzY2VuZVxuXG4gICAgIEBtZXRob2QgZWFjaFxuICAgICBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFja1xuICAgICBAZm9yIFEuU3RhZ2VcbiAgICAqL1xuICAgIGVhY2g6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICBmb3IodmFyIGk9MCxsZW49dGhpcy5pdGVtcy5sZW5ndGg7aTxsZW47aSsrKSB7XG4gICAgICAgIGNhbGxiYWNrLmNhbGwodGhpcy5pdGVtc1tpXSxhcmd1bWVudHNbMV0sYXJndW1lbnRzWzJdKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIGludm9rZXMgYSBmdW5jdGlvbmNhbGwgZm9yIGVhY2ggaXRlbSBpbiB0aGUgc2NlbmVcblxuICAgICBAbWV0aG9kIGludm9rZVxuICAgICBAcGFyYW0ge2Z1bmN0aW9ufSBmdW5jTmFtZVxuICAgICBAZm9yIFEuU3RhZ2VcbiAgICAqL1xuICAgIGludm9rZTogZnVuY3Rpb24oZnVuY05hbWUpIHtcbiAgICAgIGZvcih2YXIgaT0wLGxlbj10aGlzLml0ZW1zLmxlbmd0aDtpPGxlbjtpKyspIHsgICAgICAgICAgICAgIFxuICAgICAgICB0aGlzLml0ZW1zW2ldW2Z1bmNOYW1lXS5jYWxsKFxuICAgICAgICAgIHRoaXMuaXRlbXNbaV0sYXJndW1lbnRzWzFdLGFyZ3VtZW50c1syXVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcblxuICAgICBAbWV0aG9kIGRldGVjdFxuICAgICBAcGFyYW0ge2Z1bmN0aW9ufSBmdW5jXG4gICAgIEBmb3IgUS5TdGFnZVxuICAgICovXG4gICAgZGV0ZWN0OiBmdW5jdGlvbihmdW5jKSB7XG4gICAgICBmb3IodmFyIGkgPSB0aGlzLml0ZW1zLmxlbmd0aC0xO2kgPj0gMDsgaS0tKSB7XG4gICAgICAgIGlmKGZ1bmMuY2FsbCh0aGlzLml0ZW1zW2ldLGFyZ3VtZW50c1sxXSxhcmd1bWVudHNbMl0sYXJndW1lbnRzWzNdKSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLml0ZW1zW2ldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuXG4gICAgLyoqXG5cbiAgICAgQG1ldGhvZCBpZGVudGlmeVxuICAgICBAcGFyYW0ge2Z1bmN0aW9ufSBmdW5jXG4gICAgIEBmb3IgUS5TdGFnZVxuICAgICovXG4gICAgaWRlbnRpZnk6IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICAgIHZhciByZXN1bHQ7XG4gICAgICBmb3IodmFyIGkgPSB0aGlzLml0ZW1zLmxlbmd0aC0xO2kgPj0gMDsgaS0tKSB7XG4gICAgICAgIGlmKHJlc3VsdCA9IGZ1bmMuY2FsbCh0aGlzLml0ZW1zW2ldLGFyZ3VtZW50c1sxXSxhcmd1bWVudHNbMl0sYXJndW1lbnRzWzNdKSkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgLyoqXG5cbiAgICAgQG1ldGhvZCBmaW5kXG4gICAgIEBwYXJhbSB7TnVtYmVyIG9yIFN0cmluZ30gaWRcbiAgICAgQGZvciBRLlN0YWdlXG4gICAgKi9cbiAgICBmaW5kOiBmdW5jdGlvbihpZCkge1xuICAgICAgcmV0dXJuIHRoaXMuaW5kZXhbaWRdO1xuICAgIH0sXG5cbiAgICBhZGRUb0xpc3RzOiBmdW5jdGlvbihsaXN0cyxvYmplY3QpIHtcbiAgICAgIGZvcih2YXIgaT0wO2k8bGlzdHMubGVuZ3RoO2krKykge1xuICAgICAgICB0aGlzLmFkZFRvTGlzdChsaXN0c1tpXSxvYmplY3QpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBhZGRUb0xpc3Q6IGZ1bmN0aW9uKGxpc3QsIGl0bSkge1xuICAgICAgaWYoIXRoaXMubGlzdHNbbGlzdF0pIHsgdGhpcy5saXN0c1tsaXN0XSA9IFtdOyB9XG4gICAgICB0aGlzLmxpc3RzW2xpc3RdLnB1c2goaXRtKTtcbiAgICB9LFxuXG5cbiAgICByZW1vdmVGcm9tTGlzdHM6IGZ1bmN0aW9uKGxpc3RzLCBpdG0pIHtcbiAgICAgIGZvcih2YXIgaT0wO2k8bGlzdHMubGVuZ3RoO2krKykge1xuICAgICAgICB0aGlzLnJlbW92ZUZyb21MaXN0KGxpc3RzW2ldLGl0bSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIHJlbW92ZUZyb21MaXN0OiBmdW5jdGlvbihsaXN0LCBpdG0pIHtcbiAgICAgIHZhciBsaXN0SW5kZXggPSB0aGlzLmxpc3RzW2xpc3RdLmluZGV4T2YoaXRtKTtcbiAgICAgIGlmKGxpc3RJbmRleCAhPT0gLTEpIHsgXG4gICAgICAgIHRoaXMubGlzdHNbbGlzdF0uc3BsaWNlKGxpc3RJbmRleCwxKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIEluc2VydHMgYW4gaXRlbSBkaXJlY3RseSBpbnRvIHRoZSBzY2VuZSwgb3IgaW5zaWRlIGEgY29udGFpbmVyLlxuICAgICBUaGUgb2JqZWN0IGNhbiBsYXRlciBhY2Nlc3NlZCB2aWEgYGNoaWxkcmVuYCBwcm9wZXJ0eSBvZiB0aGUgc2NlbmUgb3IgdGhlIGNvbnRhaW5lci5cblxuICAgICBAbWV0aG9kIGluc2VydFxuICAgICBAZm9yIFEuU3RhZ2VcbiAgICAgQHBhcmFtIHtRLkdhbWVPYmplY3R9IGl0bSAtIHRoZSBJdGVtIHRvIGluc2VydFxuICAgICBAcGFyYW0gW2NvbnRhaW5lcl0gLSBgY29udGFpbmVyYCB0byBhZGQgdGhlIGl0ZW0gdG9cbiAgICAgQHJldHVybiB0aGUgaW5zZXJ0ZWQgb2JqZWN0IGZvciBjaGFpbmluZ1xuICAgICovXG4gICAgaW5zZXJ0OiBmdW5jdGlvbihpdG0sY29udGFpbmVyKSB7XG4gICAgICB0aGlzLml0ZW1zLnB1c2goaXRtKTtcbiAgICAgIGl0bS5zdGFnZSA9IHRoaXM7XG4gICAgICBpdG0uY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgICAgaWYoY29udGFpbmVyKSB7XG4gICAgICAgIGNvbnRhaW5lci5jaGlsZHJlbi5wdXNoKGl0bSk7XG4gICAgICB9XG5cbiAgICAgIGl0bS5ncmlkID0ge307XG5cblxuICAgICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYSBzcXVhcmUgb2YgY29sbGlzaW9uIHBvaW50c1xuICAgICAgUS5fZ2VuZXJhdGVQb2ludHMoaXRtKTtcbiAgICAgIFEuX2dlbmVyYXRlQ29sbGlzaW9uUG9pbnRzKGl0bSk7XG5cbiAgICAgIFxuICAgICAgaWYoaXRtLmNsYXNzTmFtZSkgeyB0aGlzLmFkZFRvTGlzdChpdG0uY2xhc3NOYW1lLCBpdG0pOyB9XG4gICAgICBpZihpdG0uYWN0aXZlQ29tcG9uZW50cykgeyB0aGlzLmFkZFRvTGlzdHMoaXRtLmFjdGl2ZUNvbXBvbmVudHMsIGl0bSk7IH1cblxuICAgICAgaWYoaXRtLnApIHtcbiAgICAgICAgdGhpcy5pbmRleFtpdG0ucC5pZF0gPSBpdG07XG4gICAgICB9XG4gICAgICB0aGlzLnRyaWdnZXIoJ2luc2VydGVkJyxpdG0pO1xuICAgICAgaXRtLnRyaWdnZXIoJ2luc2VydGVkJyx0aGlzKTtcblxuICAgICAgdGhpcy5yZWdyaWQoaXRtKTtcbiAgICAgIHJldHVybiBpdG07XG4gICAgfSxcblxuICAgIC8qKlxuICAgICBSZW1vdmVzIGFuIGl0ZW0gZnJvbSB0aGUgc2NlbmUuXG5cbiAgICAgQG1ldGhvZCByZW1vdmVcbiAgICAgQHBhcmFtIHtRLkdhbWVPYmplY3R9IGl0bSAtIHRoZSBJdGVtIHRvIHJlbW92ZVxuICAgICBAZm9yIFEuU3RhZ2VcbiAgICAqL1xuICAgIHJlbW92ZTogZnVuY3Rpb24oaXRtKSB7XG4gICAgICB0aGlzLmRlbEdyaWQoaXRtKTtcbiAgICAgIHRoaXMucmVtb3ZlTGlzdC5wdXNoKGl0bSk7XG4gICAgfSxcblxuICAgIGZvcmNlUmVtb3ZlOiBmdW5jdGlvbihpdG0pIHtcbiAgICAgIHZhciBpZHggPSAgdGhpcy5pdGVtcy5pbmRleE9mKGl0bSk7XG4gICAgICBpZihpZHggIT09IC0xKSB7IFxuICAgICAgICB0aGlzLml0ZW1zLnNwbGljZShpZHgsMSk7XG5cbiAgICAgICAgaWYoaXRtLmNsYXNzTmFtZSkgeyB0aGlzLnJlbW92ZUZyb21MaXN0KGl0bS5jbGFzc05hbWUsaXRtKTsgfVxuICAgICAgICBpZihpdG0uYWN0aXZlQ29tcG9uZW50cykgeyB0aGlzLnJlbW92ZUZyb21MaXN0cyhpdG0uYWN0aXZlQ29tcG9uZW50cyxpdG0pOyB9XG4gICAgICAgIGlmKGl0bS5jb250YWluZXIpIHtcbiAgICAgICAgICB2YXIgY29udGFpbmVySWR4ID0gaXRtLmNvbnRhaW5lci5jaGlsZHJlbi5pbmRleE9mKGl0bSk7XG4gICAgICAgICAgaWYoY29udGFpbmVySWR4ICE9PSAtMSkge1xuICAgICAgICAgICAgaXRtLmNvbnRhaW5lci5jaGlsZHJlbi5zcGxpY2UoY29udGFpbmVySWR4LDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmKGl0bS5kZXN0cm95KSB7IGl0bS5kZXN0cm95KCk7IH1cbiAgICAgICAgaWYoaXRtLnAuaWQpIHtcbiAgICAgICAgICBkZWxldGUgdGhpcy5pbmRleFtpdG0ucC5pZF07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50cmlnZ2VyKCdyZW1vdmVkJyxpdG0pO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgUGF1c2VzIHRoZSBzY2VuZSwgc3ByaXRlcyB3aWxsIG5vIGxvbmdlciBiZSBzdGVwcGVkIGJ1dCBzdGlsbCByZW5kZXJlZC5cblxuICAgICBAbWV0aG9kIHBhdXNlXG4gICAgIEBmb3IgUS5TdGFnZVxuICAgICovXG4gICAgcGF1c2U6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5wYXVzZWQgPSB0cnVlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgVW5wYXVzZXMgdGhlIHNjZW5lLlxuXG4gICAgIEBtZXRob2QgdW5wYXVzZVxuICAgICBAZm9yIFEuU3RhZ2VcbiAgICAqL1xuICAgIHVucGF1c2U6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5wYXVzZWQgPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgX2dyaWRDZWxsQ2hlY2s6IGZ1bmN0aW9uKHR5cGUsaWQsb2JqLGNvbGxpc2lvbk1hc2spIHtcbiAgICAgIGlmKFEuX2lzVW5kZWZpbmVkKGNvbGxpc2lvbk1hc2spIHx8IGNvbGxpc2lvbk1hc2sgJiB0eXBlKSB7XG4gICAgICAgIHZhciBvYmoyID0gdGhpcy5pbmRleFtpZF07XG4gICAgICAgIGlmKG9iajIgJiYgb2JqMiAhPT0gb2JqICYmIFEub3ZlcmxhcChvYmosb2JqMikpIHtcbiAgICAgICAgICB2YXIgY29sPSBRLmNvbGxpc2lvbihvYmosb2JqMik7XG4gICAgICAgICAgaWYoY29sKSB7XG4gICAgICAgICAgICBjb2wub2JqID0gb2JqMjtcbiAgICAgICAgICAgIHJldHVybiBjb2w7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgZ3JpZFRlc3Q6IGZ1bmN0aW9uKG9iaixjb2xsaXNpb25NYXNrKSB7XG4gICAgICB2YXIgZ3JpZCA9IG9iai5ncmlkLCBncmlkQ2VsbCwgY29sO1xuXG4gICAgICBmb3IodmFyIHkgPSBncmlkLlkxO3kgPD0gZ3JpZC5ZMjt5KyspIHtcbiAgICAgICAgaWYodGhpcy5ncmlkW3ldKSB7XG4gICAgICAgICAgZm9yKHZhciB4ID0gZ3JpZC5YMTt4IDw9IGdyaWQuWDI7eCsrKSB7XG4gICAgICAgICAgICBncmlkQ2VsbCA9IHRoaXMuZ3JpZFt5XVt4XTtcbiAgICAgICAgICAgIGlmKGdyaWRDZWxsKSB7IFxuICAgICAgICAgICAgICBjb2wgPSBRLl9kZXRlY3QoZ3JpZENlbGwsdGhpcy5fZ3JpZENlbGxDaGVjayx0aGlzLG9iaixjb2xsaXNpb25NYXNrKTtcbiAgICAgICAgICAgICAgaWYoY29sKSB7IHJldHVybiBjb2w7IH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgY29sbGlzaW9uTGF5ZXI6IGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgICB0aGlzLl9jb2xsaXNpb25MYXllcnMucHVzaChsYXllcik7XG4gICAgICBsYXllci5jb2xsaXNpb25MYXllciA9IHRydWU7XG4gICAgICByZXR1cm4gdGhpcy5pbnNlcnQobGF5ZXIpO1xuICAgIH0sXG4gICAgXG4gICAgX2NvbGxpZGVDb2xsaXNpb25MYXllcjogZnVuY3Rpb24ob2JqLGNvbGxpc2lvbk1hc2spIHtcbiAgICAgIHZhciBjb2w7XG5cbiAgICAgIGZvcih2YXIgaSA9IDAsbWF4ID0gdGhpcy5fY29sbGlzaW9uTGF5ZXJzLmxlbmd0aDtpIDwgbWF4O2krKykge1xuICAgICAgICB2YXIgbGF5ZXIgPSB0aGlzLl9jb2xsaXNpb25MYXllcnNbaV07XG4gICAgICAgIGlmKGxheWVyLnAudHlwZSAmIGNvbGxpc2lvbk1hc2spIHtcbiAgICAgICAgICBjb2wgPSBsYXllci5jb2xsaWRlKG9iaik7XG4gICAgICAgICAgaWYoY29sKSB7IGNvbC5vYmogPSBsYXllcjsgIHJldHVybiBjb2w7IH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgU2VhcmNoZXMgdGhlIHNjZW5lIGZvciBhbiBvYmplY3QuXG5cbiAgICAgQG1ldGhvZCBzZWFyY2hcbiAgICAgQHBhcmFtIG9ialxuICAgICBAcGFyYW0gW2NvbGxpc2lvbk1hc2tdIC1cbiAgICAgQGZvciBRLlN0YWdlXG4gICAgKi9cbiAgICBzZWFyY2g6IGZ1bmN0aW9uKG9iaixjb2xsaXNpb25NYXNrKSB7XG4gICAgICB2YXIgY29sO1xuXG4gICAgICAvLyBJZiB0aGUgb2JqZWN0IGRvZXNuJ3QgaGF2ZSBhIGdyaWQsIHJlZ3JpZCBpdFxuICAgICAgLy8gc28gd2Uga25vdyB3aGVyZSB0byBzZWFyY2hcbiAgICAgIC8vIGFuZCBza2lwIGFkZGluZyBpdCB0byB0aGUgZ3JpZCBvbmx5IGlmIGl0J3Mgbm90IG9uIHRoaXMgc3RhZ2VcbiAgICAgIGlmKCFvYmouZ3JpZCkgeyB0aGlzLnJlZ3JpZChvYmosb2JqLnN0YWdlICE9PSB0aGlzKTsgfVxuXG4gICAgICBjb2xsaXNpb25NYXNrID0gUS5faXNVbmRlZmluZWQoY29sbGlzaW9uTWFzaykgPyAob2JqLnAgJiYgb2JqLnAuY29sbGlzaW9uTWFzaykgOiBjb2xsaXNpb25NYXNrO1xuXG4gICAgICBjb2wgPSB0aGlzLl9jb2xsaWRlQ29sbGlzaW9uTGF5ZXIob2JqLGNvbGxpc2lvbk1hc2spO1xuICAgICAgY29sID0gIGNvbCB8fCB0aGlzLmdyaWRUZXN0KG9iaixjb2xsaXNpb25NYXNrKTtcbiAgICAgIHJldHVybiBjb2w7XG4gICAgfSxcblxuICAgIF9sb2NhdGVPYmo6IHtcbiAgICAgIHA6IHsgXG4gICAgICAgIHg6IDAsXG4gICAgICAgIHk6IDAsXG4gICAgICAgIGN4OiAwLFxuICAgICAgICBjeTogMCxcbiAgICAgICAgdzogMSxcbiAgICAgICAgaDogMVxuICAgICAgfSwgZ3JpZDoge31cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIEZpbmRzIGFueSBvYmplY3QgdGhhdCBjb2xsaWRlcyB3aXRoIHRoZSBwb2ludCB4LHkgb24gdGhlIHN0YWdlIChub3Qgb24gdGhlIGNhbnZhcykuXG4gICAgIElmIGBjb2xsaXNpb25NYXNrYCBpcyB1c2VkLCBvbmx5IGNoZWNrcyBmb3IgY29sbGlzaW9ucyB3aXRoIHNwcml0ZXMgb2YgdGhhdCB0eXBlLlxuXG4gICAgIEBtZXRob2QgbG9jYXRlXG4gICAgIEBwYXJhbSB7bnVtYmVyfSB4XG4gICAgIEBwYXJhbSB7bnVtYmVyfSB5XG4gICAgIEBwYXJhbSBbY29sbGlzaW9uTWFza10gLSB0eXBlIG9mIHRoZSBzcHJpdGVcbiAgICAgQHJldHVybiB0aGUgb2JqZWN0IGlmIG9uZSBpcyBmb3VuZCBvciBmYWxzZVxuICAgICBAZm9yIFEuU3RhZ2VcbiAgICAqL1xuICAgIGxvY2F0ZTogZnVuY3Rpb24oeCx5LGNvbGxpc2lvbk1hc2spIHtcbiAgICAgIHZhciBjb2wgPSBudWxsO1xuXG4gICAgICB0aGlzLl9sb2NhdGVPYmoucC54ID0geDtcbiAgICAgIHRoaXMuX2xvY2F0ZU9iai5wLnkgPSB5O1xuXG4gICAgICB0aGlzLnJlZ3JpZCh0aGlzLl9sb2NhdGVPYmosdHJ1ZSk7XG5cbiAgICAgIGNvbCA9IHRoaXMuX2NvbGxpZGVDb2xsaXNpb25MYXllcih0aGlzLl9sb2NhdGVPYmosY29sbGlzaW9uTWFzayk7XG4gICAgICBjb2wgPSAgY29sIHx8IHRoaXMuZ3JpZFRlc3QodGhpcy5fbG9jYXRlT2JqLGNvbGxpc2lvbk1hc2spO1xuXG4gICAgICBpZihjb2wgJiYgY29sLm9iaikge1xuICAgICAgICByZXR1cm4gY29sLm9iajtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgY2FsY3VsYXRlcyBpZiB0aGUgZ2l2ZW4gb2JqZWN0IGNvbGxpZGVzIHdpdGggYW55dGhpbmcgaW4gdGhlIHNjZW5lXG5cbiAgICAgQG1ldGhvZCBjb2xsaWRlXG4gICAgIEBwYXJhbSB7T2JqZWN0fSBvYmogLSB0aGUgb2JqZWN0IG9uIHRoYXQgdGhlIGNvbGxpc2lvbnMgc2hvdWxkIGJlIGNoZWNrZWRcbiAgICAgQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAtIGNvbGxpc2lvbnNNYXNrLCBtYXhDb2wsIHNraXBFdmVudHMgdG8gb3ZlcndyaXRlIGZyb20gb2JqXG4gICAgIEByZXR1cm4gY29sMiB8fCBjb2xcbiAgICAgQGZvciBRLlN0YWdlXG4gICAgKi9cbiAgICBjb2xsaWRlOiBmdW5jdGlvbihvYmosb3B0aW9ucykge1xuICAgICAgdmFyIGNvbCwgY29sMiwgY29sbGlzaW9uTWFzaywgXG4gICAgICAgICAgbWF4Q29sLCBjdXJDb2wsIHNraXBFdmVudHM7XG4gICAgICBpZihRLl9pc09iamVjdChvcHRpb25zKSkge1xuICAgICAgICBjb2xsaXNpb25NYXNrID0gb3B0aW9ucy5jb2xsaXNpb25NYXNrO1xuICAgICAgICBtYXhDb2wgPSBvcHRpb25zLm1heENvbDtcbiAgICAgICAgc2tpcEV2ZW50cyA9IG9wdGlvbnMuc2tpcEV2ZW50cztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbGxpc2lvbk1hc2sgPSBvcHRpb25zO1xuICAgICAgfVxuICAgICAgY29sbGlzaW9uTWFzayA9IFEuX2lzVW5kZWZpbmVkKGNvbGxpc2lvbk1hc2spID8gKG9iai5wICYmIG9iai5wLmNvbGxpc2lvbk1hc2spIDogY29sbGlzaW9uTWFzaztcbiAgICAgIG1heENvbCA9IG1heENvbCB8fCAzO1xuXG5cbiAgICAgIFEuX2dlbmVyYXRlQ29sbGlzaW9uUG9pbnRzKG9iaik7XG4gICAgICB0aGlzLnJlZ3JpZChvYmopO1xuXG4gICAgICBjdXJDb2wgPSBtYXhDb2w7XG4gICAgICB3aGlsZShjdXJDb2wgPiAwICYmIChjb2wgPSB0aGlzLl9jb2xsaWRlQ29sbGlzaW9uTGF5ZXIob2JqLGNvbGxpc2lvbk1hc2spKSkge1xuICAgICAgICBpZighc2tpcEV2ZW50cykgeyBcbiAgICAgICAgICBvYmoudHJpZ2dlcignaGl0Jyxjb2wpO1xuICAgICAgICAgIG9iai50cmlnZ2VyKCdoaXQuY29sbGlzaW9uJyxjb2wpO1xuICAgICAgICB9XG4gICAgICAgIFEuX2dlbmVyYXRlQ29sbGlzaW9uUG9pbnRzKG9iaik7XG4gICAgICAgIHRoaXMucmVncmlkKG9iaik7XG4gICAgICAgIGN1ckNvbC0tO1xuICAgICAgfVxuXG4gICAgICBjdXJDb2wgPSBtYXhDb2w7XG4gICAgICB3aGlsZShjdXJDb2wgPiAwICYmIChjb2wyID0gdGhpcy5ncmlkVGVzdChvYmosY29sbGlzaW9uTWFzaykpKSB7XG4gICAgICAgIG9iai50cmlnZ2VyKCdoaXQnLGNvbDIpO1xuICAgICAgICBvYmoudHJpZ2dlcignaGl0LnNwcml0ZScsY29sMik7XG5cbiAgICAgICAgLy8gRG8gdGhlIHJlY2lwcmljb2wgY29sbGlzaW9uXG4gICAgICAgIC8vIFRPRE86IGV4dHJhY3RcbiAgICAgICAgaWYoIXNraXBFdmVudHMpIHsgXG4gICAgICAgICAgdmFyIG9iajIgPSBjb2wyLm9iajtcbiAgICAgICAgICBjb2wyLm9iaiA9IG9iajtcbiAgICAgICAgICBjb2wyLm5vcm1hbFggKj0gLTE7XG4gICAgICAgICAgY29sMi5ub3JtYWxZICo9IC0xO1xuICAgICAgICAgIGNvbDIuZGlzdGFuY2UgPSAwO1xuICAgICAgICAgIGNvbDIubWFnbml0dWRlID0gMDtcbiAgICAgICAgICBjb2wyLnNlcGFyYXRlWzBdID0gMDtcbiAgICAgICAgICBjb2wyLnNlcGFyYXRlWzFdID0gMDtcblxuICAgICAgICAgIFxuICAgICAgICAgIG9iajIudHJpZ2dlcignaGl0Jyxjb2wyKTtcbiAgICAgICAgICBvYmoyLnRyaWdnZXIoJ2hpdC5zcHJpdGUnLGNvbDIpO1xuICAgICAgICB9XG5cbiAgICAgICAgUS5fZ2VuZXJhdGVDb2xsaXNpb25Qb2ludHMob2JqKTtcbiAgICAgICAgdGhpcy5yZWdyaWQob2JqKTtcbiAgICAgICAgY3VyQ29sLS07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjb2wyIHx8IGNvbDtcbiAgICB9LFxuXG4gICAgZGVsR3JpZDogZnVuY3Rpb24oaXRlbSkge1xuICAgICAgdmFyIGdyaWQgPSBpdGVtLmdyaWQ7XG5cbiAgICAgIGZvcih2YXIgeSA9IGdyaWQuWTE7eSA8PSBncmlkLlkyO3krKykge1xuICAgICAgICBpZih0aGlzLmdyaWRbeV0pIHtcbiAgICAgICAgICBmb3IodmFyIHggPSBncmlkLlgxO3ggPD0gZ3JpZC5YMjt4KyspIHtcbiAgICAgICAgICAgIGlmKHRoaXMuZ3JpZFt5XVt4XSkge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuZ3JpZFt5XVt4XVtpdGVtLnAuaWRdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBhZGRHcmlkOiBmdW5jdGlvbihpdGVtKSB7XG4gICAgICB2YXIgZ3JpZCA9IGl0ZW0uZ3JpZDtcblxuICAgICAgZm9yKHZhciB5ID0gZ3JpZC5ZMTt5IDw9IGdyaWQuWTI7eSsrKSB7XG4gICAgICAgIGlmKCF0aGlzLmdyaWRbeV0pIHsgdGhpcy5ncmlkW3ldID0ge307IH1cbiAgICAgICAgZm9yKHZhciB4ID0gZ3JpZC5YMTt4IDw9IGdyaWQuWDI7eCsrKSB7XG4gICAgICAgICAgaWYoIXRoaXMuZ3JpZFt5XVt4XSkgeyB0aGlzLmdyaWRbeV1beF0gPSB7fTsgfVxuICAgICAgICAgIHRoaXMuZ3JpZFt5XVt4XVtpdGVtLnAuaWRdID0gaXRlbS5wLnR5cGU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH0sXG5cbiAgICAvLyBBZGQgYW4gaXRlbSBpbnRvIHRoZSBjb2xsaXNpb24gZGV0ZWN0aW9uIGdyaWQsXG4gICAgLy8gSWdub3JlIGNvbGxpc2lvbiBsYXllcnNcbiAgICByZWdyaWQ6IGZ1bmN0aW9uKGl0ZW0sc2tpcEFkZCkge1xuICAgICAgaWYoaXRlbS5jb2xsaXNpb25MYXllcikgeyByZXR1cm47IH1cbiAgICAgIGl0ZW0uZ3JpZCA9IGl0ZW0uZ3JpZCB8fCB7fTtcblxuICAgICAgdmFyIGMgPSBpdGVtLmMgfHwgaXRlbS5wO1xuXG4gICAgICB2YXIgZ3JpZFgxID0gTWF0aC5mbG9vcigoYy54IC0gYy5jeCkgLyB0aGlzLm9wdGlvbnMuZ3JpZFcpLFxuICAgICAgICAgIGdyaWRZMSA9IE1hdGguZmxvb3IoKGMueSAtIGMuY3kpIC8gdGhpcy5vcHRpb25zLmdyaWRIKSxcbiAgICAgICAgICBncmlkWDIgPSBNYXRoLmZsb29yKChjLnggLSBjLmN4ICsgYy53KSAvIHRoaXMub3B0aW9ucy5ncmlkVyksXG4gICAgICAgICAgZ3JpZFkyID0gTWF0aC5mbG9vcigoYy55IC0gYy5jeSArIGMuaCkgLyB0aGlzLm9wdGlvbnMuZ3JpZEgpLFxuICAgICAgICAgIGdyaWQgPSBpdGVtLmdyaWQ7XG5cbiAgICAgIGlmKGdyaWQuWDEgIT09IGdyaWRYMSB8fCBncmlkLlgyICE9PSBncmlkWDIgfHwgXG4gICAgICAgICBncmlkLlkxICE9PSBncmlkWTEgfHwgZ3JpZC5ZMiAhPT0gZ3JpZFkyKSB7XG5cbiAgICAgICAgIGlmKGdyaWQuWDEgIT09IHZvaWQgMCkgeyB0aGlzLmRlbEdyaWQoaXRlbSk7IH1cbiAgICAgICAgIGdyaWQuWDEgPSBncmlkWDE7XG4gICAgICAgICBncmlkLlgyID0gZ3JpZFgyO1xuICAgICAgICAgZ3JpZC5ZMSA9IGdyaWRZMTtcbiAgICAgICAgIGdyaWQuWTIgPSBncmlkWTI7XG5cbiAgICAgICAgIGlmKCFza2lwQWRkKSB7IHRoaXMuYWRkR3JpZChpdGVtKTsgfVxuICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgbWFya1Nwcml0ZXM6IGZ1bmN0aW9uKGl0ZW1zLHRpbWUpIHtcbiAgICAgIHZhciB2aWV3cG9ydCA9IHRoaXMudmlld3BvcnQsXG4gICAgICAgICAgc2NhbGUgPSB2aWV3cG9ydCA/IHZpZXdwb3J0LnNjYWxlIDogMSxcbiAgICAgICAgICB4ID0gdmlld3BvcnQgPyB2aWV3cG9ydC54IDogMCxcbiAgICAgICAgICB5ID0gdmlld3BvcnQgPyB2aWV3cG9ydC55IDogMCxcbiAgICAgICAgICB2aWV3VyA9IFEud2lkdGggLyBzY2FsZSxcbiAgICAgICAgICB2aWV3SCA9IFEuaGVpZ2h0IC8gc2NhbGUsXG4gICAgICAgICAgZ3JpZFgxID0gTWF0aC5mbG9vcih4IC8gdGhpcy5vcHRpb25zLmdyaWRXKSxcbiAgICAgICAgICBncmlkWTEgPSBNYXRoLmZsb29yKHkgLyB0aGlzLm9wdGlvbnMuZ3JpZEgpLFxuICAgICAgICAgIGdyaWRYMiA9IE1hdGguZmxvb3IoKHggKyB2aWV3VykgLyB0aGlzLm9wdGlvbnMuZ3JpZFcpLFxuICAgICAgICAgIGdyaWRZMiA9IE1hdGguZmxvb3IoKHkgKyB2aWV3SCkgLyB0aGlzLm9wdGlvbnMuZ3JpZEgpLFxuICAgICAgICAgIGdyaWRSb3csIGdyaWRCbG9jaztcblxuICAgICAgZm9yKHZhciBpeT1ncmlkWTE7IGl5PD1ncmlkWTI7IGl5KyspIHtcbiAgICAgICAgaWYoKGdyaWRSb3cgPSB0aGlzLmdyaWRbaXldKSkgeyBcbiAgICAgICAgICBmb3IodmFyIGl4PWdyaWRYMTsgaXg8PWdyaWRYMjsgaXgrKykge1xuICAgICAgICAgICAgaWYoKGdyaWRCbG9jayA9IGdyaWRSb3dbaXhdKSkge1xuICAgICAgICAgICAgICBmb3IodmFyIGlkIGluIGdyaWRCbG9jaykge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuaW5kZXhbaWRdKSB7XG4gICAgICAgICAgICAgICAgICB0aGlzLmluZGV4W2lkXS5tYXJrID0gdGltZTtcbiAgICAgICAgICAgICAgICAgIGlmKHRoaXMuaW5kZXhbaWRdLmNvbnRhaW5lcikgeyB0aGlzLmluZGV4W2lkXS5jb250YWluZXIubWFyayA9IHRpbWU7IH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgdXBkYXRlU3ByaXRlczogZnVuY3Rpb24oaXRlbXMsZHQsaXNDb250YWluZXIpIHtcbiAgICAgIHZhciBpdGVtO1xuXG4gICAgICBmb3IodmFyIGk9MCxsZW49aXRlbXMubGVuZ3RoO2k8bGVuO2krKykgeyAgICAgICAgICAgICAgXG4gICAgICAgIGl0ZW0gPSBpdGVtc1tpXTtcbiAgICAgICAgLy8gSWYgc2V0IHRvIHZpc2libGUgb25seSwgZG9uJ3Qgc3RlcCBpZiBzZXQgdG8gdmlzaWJsZU9ubHlcbiAgICAgICAgaWYoIWlzQ29udGFpbmVyICYmIChpdGVtLnAudmlzaWJsZU9ubHkgJiYgKCFpdGVtLm1hcmsgfHwgaXRlbS5tYXJrIDwgdGhpcy50aW1lKSkpIHsgY29udGludWU7IH1cblxuICAgICAgICBpZihpc0NvbnRhaW5lciB8fCAhaXRlbS5jb250YWluZXIpIHsgXG4gICAgICAgICAgaXRlbS51cGRhdGUoZHQpO1xuICAgICAgICAgIFEuX2dlbmVyYXRlQ29sbGlzaW9uUG9pbnRzKGl0ZW0pO1xuICAgICAgICAgIHRoaXMucmVncmlkKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuXG5cbiAgICBzdGVwOmZ1bmN0aW9uKGR0KSB7XG4gICAgICBpZih0aGlzLnBhdXNlZCkgeyByZXR1cm4gZmFsc2U7IH1cblxuICAgICAgdGhpcy50aW1lICs9IGR0O1xuICAgICAgdGhpcy5tYXJrU3ByaXRlcyh0aGlzLml0ZW1zLHRoaXMudGltZSk7XG5cbiAgICAgIHRoaXMudHJpZ2dlcihcInByZXN0ZXBcIixkdCk7XG4gICAgICB0aGlzLnVwZGF0ZVNwcml0ZXModGhpcy5pdGVtcyxkdCk7XG4gICAgICB0aGlzLnRyaWdnZXIoXCJzdGVwXCIsZHQpO1xuXG4gICAgICBpZih0aGlzLnJlbW92ZUxpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICBmb3IodmFyIGk9MCxsZW49dGhpcy5yZW1vdmVMaXN0Lmxlbmd0aDtpPGxlbjtpKyspIHtcbiAgICAgICAgICB0aGlzLmZvcmNlUmVtb3ZlKHRoaXMucmVtb3ZlTGlzdFtpXSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZW1vdmVMaXN0Lmxlbmd0aCA9IDA7XG4gICAgICB9XG5cbiAgICAgIHRoaXMudHJpZ2dlcigncG9zdHN0ZXAnLGR0KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIEhpZGVzIHRoZSBzY2VuZS5cblxuICAgICBAbWV0aG9kIGhpZGVcbiAgICAgQGZvciBRLlN0YWdlXG4gICAgKi9cbiAgICBoaWRlOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuaGlkZGVuID0gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIFVuaGlkZXMgdGhlIHNjZW5lLlxuXG4gICAgIEBtZXRob2Qgc2hvd1xuICAgICBAZm9yIFEuU3RhZ2VcbiAgICAqL1xuICAgIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5oaWRkZW4gPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIFN0b3BzIHRoZSBzY2VuZSAoaGlkZXMgYW5kIHBhdXNlcykuXG5cbiAgICAgQG1ldGhvZCBzdG9wXG4gICAgIEBmb3IgUS5TdGFnZVxuICAgICovXG4gICAgc3RvcDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmhpZGUoKTtcbiAgICAgIHRoaXMucGF1c2UoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIFN0YXJ0cyB0aGUgc2NlbmUgKHNob3dzIGFuZCB1bnBhdXNlcykuXG5cbiAgICAgQG1ldGhvZCBzdGFydFxuICAgICBAZm9yIFEuU3RhZ2VcbiAgICAqL1xuICAgIHN0YXJ0OiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc2hvdygpO1xuICAgICAgdGhpcy51bnBhdXNlKCk7XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24oY3R4KSB7XG4gICAgICBpZih0aGlzLmhpZGRlbikgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgIGlmKHRoaXMub3B0aW9ucy5zb3J0KSB7XG4gICAgICAgIHRoaXMuaXRlbXMuc29ydCh0aGlzLm9wdGlvbnMuc29ydCk7XG4gICAgICB9XG4gICAgICB0aGlzLnRyaWdnZXIoXCJwcmVyZW5kZXJcIixjdHgpO1xuICAgICAgdGhpcy50cmlnZ2VyKFwiYmVmb3JlcmVuZGVyXCIsY3R4KTtcblxuICAgICAgZm9yKHZhciBpPTAsbGVuPXRoaXMuaXRlbXMubGVuZ3RoO2k8bGVuO2krKykgeyAgICAgICAgICAgICAgXG4gICAgICAgIHZhciBpdGVtID0gdGhpcy5pdGVtc1tpXTtcbiAgICAgICAgLy8gRG9uJ3QgcmVuZGVyIHNwcml0ZXMgd2l0aCBjb250YWluZXJzIChzcHJpdGVzIGRvIHRoYXQgdGhlbXNlbHZlcylcbiAgICAgICAgLy8gQWxzbyBkb24ndCByZW5kZXIgaWYgbm90IG9uc2NyZWVuXG4gICAgICAgIGlmKCFpdGVtLmNvbnRhaW5lciAmJiAoaXRlbS5wLnJlbmRlckFsd2F5cyB8fCBpdGVtLm1hcmsgPj0gdGhpcy50aW1lKSkge1xuICAgICAgICAgIGl0ZW0ucmVuZGVyKGN0eCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMudHJpZ2dlcihcInJlbmRlclwiLGN0eCk7XG4gICAgICB0aGlzLnRyaWdnZXIoXCJwb3N0cmVuZGVyXCIsY3R4KTtcbiAgICB9XG4gIH0pO1xuXG4gIFEuYWN0aXZlU3RhZ2UgPSAwO1xuXG4gIFEuU3RhZ2VTZWxlY3RvciA9IFEuQ2xhc3MuZXh0ZW5kKHtcbiAgICBlbXB0eUxpc3Q6IFtdLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oc3RhZ2Usc2VsZWN0b3IpIHtcbiAgICAgIHRoaXMuc3RhZ2UgPSBzdGFnZTtcbiAgICAgIHRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjtcblxuICAgICAgLy8gR2VuZXJhdGUgYW4gb2JqZWN0IGxpc3QgZnJvbSB0aGUgc2VsZWN0b3JcbiAgICAgIC8vIFRPRE86IGhhbmRsZSBhcnJheSBzZWxlY3RvcnNcbiAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLnN0YWdlLmxpc3RzW3RoaXMuc2VsZWN0b3JdIHx8IHRoaXMuZW1wdHlMaXN0O1xuICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLml0ZW1zLmxlbmd0aDtcbiAgICB9LFxuXG4gICAgZWFjaDogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgIGZvcih2YXIgaT0wLGxlbj10aGlzLml0ZW1zLmxlbmd0aDtpPGxlbjtpKyspIHtcbiAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzLml0ZW1zW2ldLGFyZ3VtZW50c1sxXSxhcmd1bWVudHNbMl0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGludm9rZTogZnVuY3Rpb24oZnVuY05hbWUpIHtcbiAgICAgIGZvcih2YXIgaT0wLGxlbj10aGlzLml0ZW1zLmxlbmd0aDtpPGxlbjtpKyspIHsgICAgICAgICAgICAgIFxuICAgICAgICB0aGlzLml0ZW1zW2ldW2Z1bmNOYW1lXS5jYWxsKFxuICAgICAgICAgIHRoaXMuaXRlbXNbaV0sYXJndW1lbnRzWzFdLGFyZ3VtZW50c1syXVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHRyaWdnZXI6IGZ1bmN0aW9uKG5hbWUscGFyYW1zKSB7XG4gICAgICB0aGlzLmludm9rZShcInRyaWdnZXJcIixuYW1lLHBhcmFtcyk7XG4gICAgfSxcblxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5pbnZva2UoXCJkZXN0cm95XCIpO1xuICAgIH0sXG5cbiAgICBkZXRlY3Q6IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICAgIGZvcih2YXIgaSA9IDAsdmFsPW51bGwsIGxlbj10aGlzLml0ZW1zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGlmKGZ1bmMuY2FsbCh0aGlzLml0ZW1zW2ldLGFyZ3VtZW50c1sxXSxhcmd1bWVudHNbMl0pKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuaXRlbXNbaV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgaWRlbnRpZnk6IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICAgIHZhciByZXN1bHQgPSBudWxsO1xuICAgICAgZm9yKHZhciBpID0gMCx2YWw9bnVsbCwgbGVuPXRoaXMuaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgaWYocmVzdWx0ID0gZnVuYy5jYWxsKHRoaXMuaXRlbXNbaV0sYXJndW1lbnRzWzFdLGFyZ3VtZW50c1syXSkpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICB9LFxuXG4gICAgLy8gVGhpcyBoaWRkZW4gdXRpbGl0eSBtZXRob2QgZXh0ZW5kc1xuICAgIC8vIGFuZCBvYmplY3QncyBwcm9wZXJ0aWVzIHdpdGggYSBzb3VyY2Ugb2JqZWN0LlxuICAgIC8vIFVzZWQgYnkgdGhlIHAgbWV0aG9kIHRvIHNldCBwcm9wZXJ0aWVzLlxuICAgIF9wT2JqZWN0OiBmdW5jdGlvbihzb3VyY2UpIHtcbiAgICAgIFEuX2V4dGVuZCh0aGlzLnAsc291cmNlKTtcbiAgICB9LFxuXG4gICAgX3BTaW5nbGU6IGZ1bmN0aW9uKHByb3BlcnR5LHZhbHVlKSB7XG4gICAgICB0aGlzLnBbcHJvcGVydHldID0gdmFsdWU7XG4gICAgfSxcblxuICAgIHNldDogZnVuY3Rpb24ocHJvcGVydHksIHZhbHVlKSB7XG4gICAgICAvLyBJcyB2YWx1ZSB1bmRlZmluZWRcbiAgICAgIGlmKHZhbHVlID09PSB2b2lkIDApIHtcbiAgICAgICAgdGhpcy5lYWNoKHRoaXMuX3BPYmplY3QscHJvcGVydHkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5lYWNoKHRoaXMuX3BTaW5nbGUscHJvcGVydHksdmFsdWUpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgYXQ6IGZ1bmN0aW9uKGlkeCkge1xuICAgICAgcmV0dXJuIHRoaXMuaXRlbXNbaWR4XTtcbiAgICB9LFxuXG4gICAgZmlyc3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuaXRlbXNbMF07XG4gICAgfSxcblxuICAgIGxhc3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuaXRlbXNbdGhpcy5pdGVtcy5sZW5ndGgtMV07XG4gICAgfVxuXG4gIH0pO1xuXG4gIC8vIE1heWJlIGFkZCBzdXBwb3J0IGZvciBkaWZmZXJlbnQgdHlwZXNcbiAgLy8gZW50aXR5IC0gYWN0aXZlIGNvbGxpc2lvbiBkZXRlY3Rpb25cbiAgLy8gIHBhcnRpY2xlIC0gbm8gY29sbGlzaW9uIGRldGVjdGlvbiwgbm8gYWRkaW5nIGNvbXBvbmVudHMgdG8gbGlzdHMgLyBldGNcbiAgLy9cblxuICAvLyBRKFwiUGxheWVyXCIpLmludm9rZShcInNoaW1tZXIpOyAtIG5lZWRzIHRvIHJldHVybiBhIHNlbGVjdG9yXG4gIC8vIFEoXCIuaGFwcHlcIikuaW52b2tlKFwic2FzZGZhXCIsJ2Zkc2FmYXMnLFwiZmFzZGZhc1wiKTtcbiAgLy8gUShcIkVuZW15XCIpLnAoeyBhOiBcImFzZGZhc2ZcIiAgfSk7XG5cbiAgUS5zZWxlY3QgPSBmdW5jdGlvbihzZWxlY3RvcixzY29wZSkge1xuICAgIHNjb3BlID0gKHNjb3BlID09PSB2b2lkIDApID8gUS5hY3RpdmVTdGFnZSA6IHNjb3BlO1xuICAgIHNjb3BlID0gUS5zdGFnZShzY29wZSk7XG4gICAgaWYoUS5faXNOdW1iZXIoc2VsZWN0b3IpKSB7XG4gICAgICByZXR1cm4gc2NvcGUuaW5kZXhbc2VsZWN0b3JdO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbmV3IFEuU3RhZ2VTZWxlY3RvcihzY29wZSxzZWxlY3Rvcik7XG4gICAgICAvLyBjaGVjayBpZiBpcyBhcnJheVxuICAgICAgLy8gY2hlY2sgaXMgaGFzIGFueSBjb21tYXNcbiAgICAgICAgIC8vIHNwbGl0IGludG8gYXJyYXlzXG4gICAgICAvLyBmaW5kIGVhY2ggb2YgdGhlIGNsYXNzZXNcbiAgICAgIC8vIGZpbmQgYWxsIHRoZSBpbnN0YW5jZXMgb2YgYSBzcGVjaWZpYyBjbGFzc1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgIFJldHVybnMgdGhlIGRlZmF1bHQgb3IgY3VycmVudGx5IGFjdGl2ZSBzdGFnZS5cbiAgIElmIGNhbGxlZCBmcm9tIGEgc3ByaXRlcyBzdGVwKCkgcmV0dXJucyB0aGUgc3RhZ2UgdGhhdCB0aGUgc3ByaXRlIGlzIG1lbWJlciBvZlxuICAgSWYgYSBudW1iZXIgaXMgcGFzc2VkIGluLCB0aGlzIHN0YWdlcyBpcyByZXR1cm5lZFxuICAgKldhcm5pbmcqIG1pZ2h0IHJldHVybiBgdW5kZWZpbmVkYCBpZiB0aGF0IHN0YWdlIGRvZXNudCBleGlzdCFcblxuICAgQG1ldGhvZCBRLnN0YWdlXG4gICBAZm9yIFFcbiAgIEBwYXJhbSB7TnVtYmVyfSBudW0gLSBudW1iZXIgb2YgdGhlIHN0YWdlXG4gICBAcmV0dXJuIHtRLlN0YWdlfSBjdXJyZW50LCBhY3RpdmUsIG9yIG51bWJlcmVkIHN0YWdlXG4gICovXG4gIFEuc3RhZ2UgPSBmdW5jdGlvbihudW0pIHtcbiAgICAvLyBVc2UgYWN0aXZlU3RhZ2UgaXMgbnVtIGlzIHVuZGVmaW5lZFxuICAgIG51bSA9IChudW0gPT09IHZvaWQgMCkgPyBRLmFjdGl2ZVN0YWdlIDogbnVtO1xuICAgIHJldHVybiBRLnN0YWdlc1tudW1dO1xuICB9O1xuXG4gIC8qKlxuICAgU3RhZ2VzIGEgc2NlbmUuIGBudW1gIGlzIGxpa2UgYSB6LWluZGV4LiBIaWdoZXIgbnVtYmVyZWQgc3RhZ2VzIHJlbmRlciBvbiB0b3BcbiAgIG9mIGxvd2VyIG51bWJlcmVkIHN0YWdlcyFcblxuICAgQG1ldGhvZCBRLnN0YWdlU2NlbmVcbiAgIEBwYXJhbSB7US5TY2VuZSBvciBTdHJpbmd9IHNjZW5lIC0gYSBRLlNjZW5lIG9yIHRoZSBzdHJpbmcgZm9yIG5hbWUgb2YgYSBzY2VuZVxuICAgQHBhcmFtIHtudW1iZXJ9IFtudW1dIC0gaW5kZXhcbiAgIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gc29tZSBvcHRpb25zXG4gICBAZm9yIFF1aW50dXNcbiAgICovXG4gIFEuc3RhZ2VTY2VuZSA9IGZ1bmN0aW9uKHNjZW5lLG51bSxvcHRpb25zKSB7XG4gICAgLy8gSWYgaXQncyBhIHN0cmluZywgZmluZCBhIHJlZ2lzdGVyZWQgc2NlbmUgYnkgdGhhdCBuYW1lXG4gICAgaWYoUS5faXNTdHJpbmcoc2NlbmUpKSB7XG4gICAgICBzY2VuZSA9IFEuc2NlbmUoc2NlbmUpO1xuICAgIH1cblxuICAgIC8vIElmIHRoZSB1c2VyIHNraXBwZWQgdGhlIG51bSBhcmcgYW5kIHdlbnQgc3RyYWlnaHQgdG8gb3B0aW9ucyxcbiAgICAvLyBzd2FwIHRoZSB0d28gYW5kIGdyYWIgYSBkZWZhdWx0IGZvciBudW1cbiAgICBpZihRLl9pc09iamVjdChudW0pKSB7XG4gICAgICBvcHRpb25zID0gbnVtO1xuICAgICAgbnVtID0gUS5fcG9wUHJvcGVydHkob3B0aW9ucyxcInN0YWdlXCIpIHx8IChzY2VuZSAmJiBzY2VuZS5vcHRzLnN0YWdlKSB8fCAwO1xuICAgIH1cblxuICAgIC8vIENsb25lIHRoZSBvcHRpb25zIGFyZyB0byBwcmV2ZW50IG1vZGlmaWNhdGlvblxuICAgIG9wdGlvbnMgPSBRLl9jbG9uZShvcHRpb25zKTtcblxuICAgIC8vIEdyYWIgdGhlIHN0YWdlIGNsYXNzLCBwdWxsaW5nIGZyb20gb3B0aW9ucywgdGhlIHNjZW5lIGRlZmF1bHQsIG9yIHVzZVxuICAgIC8vIHRoZSBkZWZhdWx0IHN0YWdlXG4gICAgdmFyIFN0YWdlQ2xhc3MgPSAoUS5fcG9wUHJvcGVydHkob3B0aW9ucyxcInN0YWdlQ2xhc3NcIikpIHx8IFxuICAgICAgICAgICAgICAgICAgICAgKHNjZW5lICYmIHNjZW5lLm9wdHMuc3RhZ2VDbGFzcykgfHwgUS5TdGFnZTtcblxuICAgIC8vIEZpZ3VyZSBvdXQgd2hpY2ggc3RhZ2UgdG8gdXNlXG4gICAgbnVtID0gUS5faXNVbmRlZmluZWQobnVtKSA/ICgoc2NlbmUgJiYgc2NlbmUub3B0cy5zdGFnZSkgfHwgMCkgOiBudW07XG5cbiAgICAvLyBDbGVhbiB1cCBhbiBleGlzdGluZyBzdGFnZSBpZiBuZWNlc3NhcnlcbiAgICBpZihRLnN0YWdlc1tudW1dKSB7XG4gICAgICBRLnN0YWdlc1tudW1dLmRlc3Ryb3koKTtcbiAgICB9XG5cbiAgICAvLyBNYWtlIHRoaXMgdGhpcyB0aGUgYWN0aXZlIHN0YWdlIGFuZCBpbml0aWFsaXplIHRoZSBzdGFnZSxcbiAgICAvLyBjYWxsaW5nIGxvYWRTY2VuZSB0byBwb3B1cGxhdGUgdGhlIHN0YWdlIGlmIHdlIGhhdmUgYSBzY2VuZS5cbiAgICBRLmFjdGl2ZVN0YWdlID0gbnVtO1xuICAgIHZhciBzdGFnZSA9IFEuc3RhZ2VzW251bV0gPSBuZXcgU3RhZ2VDbGFzcyhzY2VuZSxvcHRpb25zKTtcblxuICAgIC8vIExvYWQgYW4gYXNzZXRzIG9iamVjdCBhcnJheVxuICAgIGlmKHN0YWdlLm9wdGlvbnMuYXNzZXQpIHtcbiAgICAgIHN0YWdlLmxvYWRBc3NldHMoc3RhZ2Uub3B0aW9ucy5hc3NldCk7XG4gICAgfVxuXG4gICAgaWYoc2NlbmUpIHtcbiAgICAgIHN0YWdlLmxvYWRTY2VuZSgpO1xuICAgIH1cbiAgICBRLmFjdGl2ZVN0YWdlID0gMDtcblxuICAgIC8vIElmIHRoZXJlJ3Mgbm8gbG9vcCBhY3RpdmUsIHJ1biB0aGUgZGVmYXVsdCBzdGFnZUdhbWVMb29wXG4gICAgaWYoIVEubG9vcCkge1xuICAgICAgUS5nYW1lTG9vcChRLnN0YWdlR2FtZUxvb3ApO1xuICAgIH1cblxuICAgIC8vIEZpbmFsbHkgcmV0dXJuIHRoZSBzdGFnZSB0byB0aGUgdXNlciBmb3IgdXNlIGlmIG5lZWRlZFxuICAgIHJldHVybiBzdGFnZTtcbiAgfTtcblxuICBRLnN0YWdlR2FtZUxvb3AgPSBmdW5jdGlvbihkdCkge1xuICAgIHZhciBpLGxlbixzdGFnZTtcblxuXG4gICAgaWYoZHQgPCAwKSB7IGR0ID0gMS4wLzYwOyB9XG4gICAgaWYoZHQgPiAxLzE1KSB7IGR0ICA9IDEuMC8xNTsgfVxuXG4gICAgZm9yKGkgPTAsbGVuPVEuc3RhZ2VzLmxlbmd0aDtpPGxlbjtpKyspIHtcbiAgICAgIFEuYWN0aXZlU3RhZ2UgPSBpO1xuICAgICAgc3RhZ2UgPSBRLnN0YWdlKCk7XG4gICAgICBpZihzdGFnZSkge1xuICAgICAgICBzdGFnZS5zdGVwKGR0KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZihRLmN0eCkgeyBRLmNsZWFyKCk7IH1cblxuICAgIGZvcihpID0wLGxlbj1RLnN0YWdlcy5sZW5ndGg7aTxsZW47aSsrKSB7XG4gICAgICBRLmFjdGl2ZVN0YWdlID0gaTtcbiAgICAgIHN0YWdlID0gUS5zdGFnZSgpO1xuICAgICAgaWYoc3RhZ2UpIHtcbiAgICAgICAgc3RhZ2UucmVuZGVyKFEuY3R4KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBRLmFjdGl2ZVN0YWdlID0gMDtcblxuICAgIGlmKFEuaW5wdXQgJiYgUS5jdHgpIHsgUS5pbnB1dC5kcmF3Q2FudmFzKFEuY3R4KTsgfVxuICB9O1xuXG4gIC8qKlxuICAgRGVzdHJveXMgdGhlIHN0YWdlIHdpdGggaW5kZXggYG51bWAuXG5cbiAgIEBtZXRob2QgY2xlYXJTdGFnZVxuICAgQHBhcmFtIHtOdW1iZXJ9IG51bVxuICAgQGZvciBRXG4gICovXG4gIFEuY2xlYXJTdGFnZSA9IGZ1bmN0aW9uKG51bSkge1xuICAgIGlmKFEuc3RhZ2VzW251bV0pIHsgXG4gICAgICBRLnN0YWdlc1tudW1dLmRlc3Ryb3koKTsgXG4gICAgICBRLnN0YWdlc1tudW1dID0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICBEZXN0cm95cyBhbGwgc3RhZ2VzLlxuXG4gICBAbWV0aG9kIGNsZWFyU3RhZ2VzXG4gICBAZm9yIFFcbiAgKi9cbiAgUS5jbGVhclN0YWdlcyA9IGZ1bmN0aW9uKCkge1xuICAgIGZvcih2YXIgaT0wLGxlbj1RLnN0YWdlcy5sZW5ndGg7aTxsZW47aSsrKSB7XG4gICAgICBpZihRLnN0YWdlc1tpXSkgeyBRLnN0YWdlc1tpXS5kZXN0cm95KCk7IH1cbiAgICB9XG4gICAgUS5zdGFnZXMubGVuZ3RoID0gMDtcbiAgfTtcblxuXG59O1xuXG4iLCIvKmdsb2JhbCBRdWludHVzOmZhbHNlICovXG4vKipcblF1aW50dXMgSFRNTDUgR2FtZSBFbmdpbmUgLSBTcHJpdGVzIE1vZHVsZVxuXG5UaGUgY29kZSBpbiBgcXVpbnR1c19zcHJpdGVzLmpzYCBkZWZpbmVzIHRoZSBgUXVpbnR1cy5TcHJpdGVzYCBtb2R1bGUsIHdoaWNoXG5hZGQgc3VwcG9ydCBmb3Igc3ByaXRlIHNoZWV0cyBhbmQgdGhlIGJhc2Ugc3ByaXRlIGNsYXNzLlxuXG5Nb3N0IGdhbWVzIHdpbGwgaW5jbHVkZSBhdCBhIG1pbmltdW0gYFF1aW50dXMuU3ByaXRlc2AgYW5kIGBRdWludHVzLlNjZW5lc2BcblxuQG1vZHVsZSBRdWludHVzLlNwcml0ZXNcbiovXG5cblxuLyoqXG4gKiBRdWludHVzIFNwcml0ZXMgTW9kdWxlIENsYXNzXG4gKlxuICogQGNsYXNzIFF1aW50dXMuU3ByaXRlc1xuICovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKFEpIHtcbiBcbiAgLyoqXG5cbiAgU3ByaXRlIHNoZWV0IGNsYXNzIC0gZ2VuZXJhbGx5IGluc3RhbnRpYXRlZCB3aXRoIGBRLnNoZWV0YCBuZXcgYG5ld2BcblxuXG4gIEBjbGFzcyBRLlNwcml0ZVNoZWV0XG4gIEBleHRlbmRzIFEuQ2xhc3NcbiAgQGZvciBRdWludHVzLlNwcml0ZXNcbiAgKi9cbiAgUS5DbGFzcy5leHRlbmQoXCJTcHJpdGVTaGVldFwiLHtcblxuICAgIC8qKlxuICAgIGNvbnN0cnVjdG9yXG5cbiAgICBPcHRpb25zOlxuXG4gICAgICAqIHRpbGVXIC0gdGlsZSB3aWR0aFxuICAgICAgKiB0aWxlSCAtIHRpbGUgaGVpZ2h0XG4gICAgICAqIHcgICAgIC0gd2lkdGggb2YgdGhlIHNwcml0ZSBibG9ja1xuICAgICAgKiBoICAgICAtIGhlaWdodCBvZiB0aGUgc3ByaXRlIGJsb2NrXG4gICAgICAqIHN4ICAgIC0gc3RhcnQgeFxuICAgICAgKiBzeSAgICAtIHN0YXJ0IHlcbiAgICAgICogc3BhY2luZ1ggLSBzcGFjaW5nIGJldHdlZW4gZWFjaCB0aWxlIHggKGFmdGVyIDFzdClcbiAgICAgICogc3BhY2luZ1kgLSBzcGFjaW5nIGJldHdlZW4gZWFjaCB0aWxlIHlcbiAgICAgICogbWFyZ2luWCAtIG1hcmdpbiBhcm91bmQgZWFjaCB0aWxlIHggXG4gICAgICAqIG1hcmdpblkgLSBtYXJnaW4gYXJvdW5kIGVhY2ggdGlsZSB5XG4gICAgICAqIGNvbHMgIC0gbnVtYmVyIG9mIGNvbHVtbnMgcGVyIHJvd1xuICAgIFxuICAgIEBjb25zdHJ1Y3RvclxuICAgIEBmb3IgUS5TcHJpdGVTaGVldFxuICAgIEBtZXRob2QgaW5pdFxuICAgIEBwYXJhbSB7U3RyaW5nfSBuYW1lXG4gICAgQHBhcmFtIHtTdHJpbmd9IGFzc2V0IFxuICAgIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbihuYW1lLCBhc3NldCxvcHRpb25zKSB7XG4gICAgICBpZighUS5hc3NldChhc3NldCkpIHsgdGhyb3cgXCJJbnZhbGlkIEFzc2V0OlwiICsgYXNzZXQ7IH1cbiAgICAgIFEuX2V4dGVuZCh0aGlzLHtcbiAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgYXNzZXQ6IGFzc2V0LFxuICAgICAgICB3OiBRLmFzc2V0KGFzc2V0KS53aWR0aCxcbiAgICAgICAgaDogUS5hc3NldChhc3NldCkuaGVpZ2h0LFxuICAgICAgICB0aWxlVzogNjQsXG4gICAgICAgIHRpbGVIOiA2NCxcbiAgICAgICAgc3g6IDAsXG4gICAgICAgIHN5OiAwLFxuICAgICAgICBzcGFjaW5nWDogMCxcbiAgICAgICAgc3BhY2luZ1k6IDAsXG4gICAgICAgIGZyYW1lUHJvcGVydGllczoge31cbiAgICAgICAgfSk7XG4gICAgICBpZihvcHRpb25zKSB7IFEuX2V4dGVuZCh0aGlzLG9wdGlvbnMpOyB9XG4gICAgICAvLyBmaXggZm9yIG9sZCB0aWxldyBpbnN0ZWFkIG9mIHRpbGVXXG4gICAgICBpZih0aGlzLnRpbGV3KSB7IFxuICAgICAgICB0aGlzLnRpbGVXID0gdGhpcy50aWxldzsgXG4gICAgICAgIGRlbGV0ZSB0aGlzWyd0aWxldyddOyBcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMudGlsZWgpIHsgXG4gICAgICAgIHRoaXMudGlsZUggPSB0aGlzLnRpbGVoOyBcbiAgICAgICAgZGVsZXRlIHRoaXNbJ3RpbGVoJ107IFxuICAgICAgfVxuXG4gICAgICB0aGlzLmNvbHMgPSB0aGlzLmNvbHMgfHwgXG4gICAgICAgICAgICAgICAgICBNYXRoLmZsb29yKHRoaXMudyAvICh0aGlzLnRpbGVXICsgdGhpcy5zcGFjaW5nWCkpO1xuXG4gICAgICB0aGlzLmZyYW1lcyA9IHRoaXMuY29scyAqIChNYXRoLmZsb29yKHRoaXMuaC8odGhpcy50aWxlSCArIHRoaXMuc3BhY2luZ1kpKSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICBSZXR1cm5zIHRoZSBzdGFydGluZyB4IHBvc2l0aW9uIG9mIGEgc2luZ2xlIGZyYW1lXG5cbiAgICAgQG1ldGhvZCBmeFxuICAgICBAZm9yIFEuU3ByaXRlU2hlZXRcbiAgICAgQHBhcmFtIHtJbnRlZ2VyfSBmcmFtZVxuICAgICovXG4gICAgZng6IGZ1bmN0aW9uKGZyYW1lKSB7XG4gICAgICByZXR1cm4gTWF0aC5mbG9vcigoZnJhbWUgJSB0aGlzLmNvbHMpICogKHRoaXMudGlsZVcgKyB0aGlzLnNwYWNpbmdYKSArIHRoaXMuc3gpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgUmV0dXJucyB0aGUgc3RhcnRpbmcgeSBwb3NpdGlvbiBvZiBhIHNpbmdsZSBmcmFtZVxuXG4gICAgIEBtZXRob2QgZnlcbiAgICAgQGZvciBRLlNwcml0ZVNoZWV0XG4gICAgIEBwYXJhbSB7SW50ZWdlcn0gZnJhbWVcbiAgICAqL1xuICAgIGZ5OiBmdW5jdGlvbihmcmFtZSkge1xuICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5mbG9vcihmcmFtZSAvIHRoaXMuY29scykgKiAodGhpcy50aWxlSCArIHRoaXMuc3BhY2luZ1kpICsgdGhpcy5zeSk7XG4gICAgfSxcblxuICAgIC8qKiBcbiAgICAgRHJhdyBhIHNpbmdsZSBmcmFtZSBhdCB4LHkgb24gdGhlIHByb3ZpZGVkIGNvbnRleHRcblxuICAgICBAbWV0aG9kIGRyYXdcbiAgICAgQGZvciBRLlNwcml0ZVNoZWV0XG4gICAgIEBwYXJhbSB7Q29udGV4dDJEfSBjdHhcbiAgICAgQHBhcmFtIHtGbG9hdH0geFxuICAgICBAcGFyYW0ge0Zsb2F0fSB5XG4gICAgIEBwYXJhbSB7SW50ZWdlcn0gZnJhbWVcbiAgICAqL1xuICAgIGRyYXc6IGZ1bmN0aW9uKGN0eCwgeCwgeSwgZnJhbWUpIHtcbiAgICAgIGlmKCFjdHgpIHsgY3R4ID0gUS5jdHg7IH1cbiAgICAgIGN0eC5kcmF3SW1hZ2UoUS5hc3NldCh0aGlzLmFzc2V0KSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5meChmcmFtZSksdGhpcy5meShmcmFtZSksXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGlsZVcsIHRoaXMudGlsZUgsXG4gICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoeCksTWF0aC5mbG9vcih5KSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50aWxlVywgdGhpcy50aWxlSCk7XG5cbiAgICB9XG5cbiAgfSk7XG5cblxuICBRLnNoZWV0cyA9IHt9O1xuXG4gIC8qKlxuICAgUmV0dXJuIGEgYFEuU3ByaXRlU2hlZXRgIG9yICBjcmVhdGUgYSBuZXcgc3ByaXRlIHNoZWV0XG5cbiAgIEBtZXRob2QgUS5zaGVldFxuICAgQGZvciBRdWludHVzLlNwcml0ZXNcbiAgIEBwYXJhbSB7U3RyaW5nfSBuYW1lIC0gbmFtZSBvZiBzaGVldCB0byByZXR1cm4gb3IgY3JlYXRlXG4gICBAcGFyYW0ge1N0cmluZ30gW2Fzc2V0XSAtIGlmIHByb3ZpZGVkLCB3aWxsIGNyZWF0ZSBhIHNwcml0ZSBzaGVldCB1c2luZyB0aGlzIGFzc2V0XG4gICBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIC0gaWYgcHJvdmlkZWQsIHdpbGwgYmUgcGFzc2VkIGFzIG9wdGlvbnMgdG8gYFEuU3ByaXRlU2hlZXRgXG4gICovXG4gIFEuc2hlZXQgPSBmdW5jdGlvbihuYW1lLGFzc2V0LG9wdGlvbnMpIHtcbiAgICBpZihhc3NldCkge1xuICAgICAgUS5zaGVldHNbbmFtZV0gPSBuZXcgUS5TcHJpdGVTaGVldChuYW1lLGFzc2V0LG9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gUS5zaGVldHNbbmFtZV07XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgQ3JlYXRlIGEgbnVtYmVyIG9mIGBRLlNwcml0ZVNoZWV0YCBvYmplY3RzIGZyb20gYW4gaW1hZ2UgYXNzZXQgYW5kIGEgc3ByaXRlIGRhdGEgSlNPTiBhc3NldFxuXG4gICBAbWV0aG9kIFEuY29tcGlsZVNoZWV0c1xuICAgQGZvciBRdWludHVzLlNwcml0ZXNcbiAgIEBwYXJhbSB7U3RyaW5nfSBpbWFnZUFzc2V0IFxuICAgQHBhcmFtIHtTdHJpbmcgc3ByaXRlRGF0YUFzc2V0XG4gICovXG4gIFEuY29tcGlsZVNoZWV0cyA9IGZ1bmN0aW9uKGltYWdlQXNzZXQsc3ByaXRlRGF0YUFzc2V0KSB7XG4gICAgdmFyIGRhdGEgPSBRLmFzc2V0KHNwcml0ZURhdGFBc3NldCk7XG4gICAgUS5fZWFjaChkYXRhLGZ1bmN0aW9uKHNwcml0ZURhdGEsbmFtZSkge1xuICAgICAgUS5zaGVldChuYW1lLGltYWdlQXNzZXQsc3ByaXRlRGF0YSk7XG4gICAgfSk7XG4gIH07XG5cblxuICAvKipcbiAgIEJpdG1hc2sgMCB0byBpbmRpY2F0ZSBubyBzcHJpdGVzXG5cbiAgIEBwcm9wZXJ0eSBRLlNQUklURV9OT05FXG4gICBAZm9yIFF1aW50dXMuU3ByaXRlc1xuICAgQGZpbmFsXG4gICovXG4gIFEuU1BSSVRFX05PTkUgICAgID0gMDtcblxuICAvKipcbiAgIGRlZmF1bHQgc3ByaXRlIHR5cGUgMVxuXG4gICBAcHJvcGVydHkgUS5TUFJJVEVfREVGQVVMVFxuICAgQGZvciBRdWludHVzLlNwcml0ZXNcbiAgIEBmaW5hbFxuICAqL1xuICBRLlNQUklURV9ERUZBVUxUICA9IDE7XG5cbiAgLyoqXG4gICBwYXJ0aWNsZSBzcHJpdGUgdHlwZSAyXG5cbiAgIEBwcm9wZXJ0eSBRLlNQUklURV9QQVJUSUNMRVxuICAgQGZvciBRdWludHVzLlNwcml0ZXNcbiAgIEBmaW5hbFxuICAqL1xuICBRLlNQUklURV9QQVJUSUNMRSA9IDI7XG5cbiAgLyoqXG4gICBhY3RpdmUgc3ByaXRlIHR5cGUgNFxuXG4gICBAcHJvcGVydHkgUS5TUFJJVEVfQUNUSVZFXG4gICBAZm9yIFF1aW50dXMuU3ByaXRlc1xuICAgQGZpbmFsXG4gICovXG4gIFEuU1BSSVRFX0FDVElWRSAgID0gNDtcblxuICAvKipcbiAgIGZyaWVuZGx5IHNwcml0ZSB0eXBlIDhcblxuICAgQHByb3BlcnR5IFEuU1BSSVRFX0ZSSUVORExZXG4gICBAZm9yIFF1aW50dXMuU3ByaXRlc1xuICAgQGZpbmFsXG4gICovXG4gIFEuU1BSSVRFX0ZSSUVORExZID0gODtcblxuICAvKipcbiAgIGVuZW15IHNwcml0ZSB0eXBlIDE2XG5cbiAgIEBwcm9wZXJ0eSBRLlNQUklURV9FTkVNWVxuICAgQGZvciBRdWludHVzLlNwcml0ZXNcbiAgIEBmaW5hbFxuICAqL1xuICBRLlNQUklURV9FTkVNWSAgICA9IDE2O1xuXG5cbiAgLyoqXG4gICBwb3dlcnVwIHNwcml0ZSB0eXBlIDMyXG5cbiAgIEBwcm9wZXJ0eSBRLlNQUklURV9QT1dFUlVQXG4gICBAZm9yIFF1aW50dXMuU3ByaXRlc1xuICAgQGZpbmFsXG4gICovXG4gIFEuU1BSSVRFX1BPV0VSVVAgID0gMzI7XG5cblxuICAvKipcbiAgIFVJIHNwcml0ZSB0eXBlIDY0XG5cbiAgIEBwcm9wZXJ0eSBRLlNQUklURV9VSVxuICAgQGZvciBRdWludHVzLlNwcml0ZXNcbiAgIEBmaW5hbFxuICAqL1xuICBRLlNQUklURV9VSSAgICAgICA9IDY0O1xuXG4gIC8qKiBcbiAgIGFsbCBzcHJpdGUgdHlwZSAtIDB4RkZGRlxuXG4gICBAcHJvcGVydHkgUS5TUFJJVEVfQUxMXG4gICBAZm9yIFF1aW50dXMuU3ByaXRlc1xuICAgQGZpbmFsXG4gICovXG4gIFEuU1BSSVRFX0FMTCAgID0gMHhGRkZGO1xuXG5cbiAgLyoqXG4gICBnZW5lcmF0ZSBhIHNxdWFyZSBzZXQgb2YgIGBwLnBvaW50c2Agb24gYW4gb2JqZWN0IGZyb20gYHAud2AgYW5kIGBwLmhgXG5cbiAgIGBwLnBvaW50c2AgcmVwcmVzZW50IHRoZSBjb2xsaXNpb24gcG9pbnRzIGZvciBhbiBvYmplY3QgaW4gb2JqZWN0IGNvb3JkaW5hdGVzLlxuXG5cbiAgICBAbWV0aG9kIHEuX2dlbmVyYXRlUG9pbnRzXG4gICAgQGZvciBRdWludHVzLlNwcml0ZXNcbiAgICBAcGFyYW0ge1EuU3ByaXRlfSBvYmogLSBvYmplY3QgdG8gYWRkIHBvaW50cyB0b1xuICAgIEBwYXJhbSB7Qm9vbGVhbn0gZm9yY2UgLSBpZiBzZXQgdG8gdHJ1ZSwgd2lsbCByZWdlbmVyYXRlIGBwLnBvaW50c2AgZXZlbiBpZiBpdCBhbHJlYWR5IGV4aXN0cywgb3RoZXJ3aXNlICBpZiBwLnBvaW50cyBleGlzdCBpdCdsbCBiZSBsZWZ0IGFsb25lXG4gICovXG4gIFEuX2dlbmVyYXRlUG9pbnRzID0gZnVuY3Rpb24ob2JqLGZvcmNlKSB7XG4gICAgaWYob2JqLnAucG9pbnRzICYmICFmb3JjZSkgeyByZXR1cm47IH1cbiAgICB2YXIgcCA9IG9iai5wLFxuICAgICAgICBoYWxmVyA9IHAudy8yLFxuICAgICAgICBoYWxmSCA9IHAuaC8yO1xuXG4gICAgcC5wb2ludHMgPSBbIFxuICAgICAgWyAtaGFsZlcsIC1oYWxmSCBdLFxuICAgICAgWyAgaGFsZlcsIC1oYWxmSCBdLFxuICAgICAgWyAgaGFsZlcsICBoYWxmSCBdLFxuICAgICAgWyAtaGFsZlcsICBoYWxmSCBdXG4gICAgICBdO1xuICB9O1xuXG5cbiAgLyoqXG4gICBHZW5lcmF0ZSBhIHNxdWFyZSBzZXQgb2YgIGBjLnBvaW50c2Agb24gYW4gb2JqZWN0IGZyb20gdGhlIG9iamVjdCB0cmFuc2Zvcm0gbWF0cml4IGFuZCBgcC5wb2ludHNgXG5cbiAgIGBjLnBvaW50c2AgcmVwcmVzZW50cyB0aGUgY29sbGlzaW9uIHBvaW50cyBvZiBhbiBzcHJpdGUgaW4gd29ybGQgY29vcmRpbmF0ZXMsIHNjYWxlZCwgcm90YXRlIGFuZCB0YWtpbmcgaW50byBhY2NvdW50IGFueSBwYXJlbnQgdHJhbnNmb3Jtcy5cblxuXG4gICAgQG1ldGhvZCBRLl9nZW5lcmF0ZUNvbGxpc2lvblBvaW50c1xuICAgIEBmb3IgUXVpbnR1cy5TcHJpdGVzXG4gICAgQHBhcmFtIHtxLnNwcml0ZX0gb2JqIC0gb2JqZWN0IHRvIGFkZCBjb2xsaXNpb24gcG9pbnRzIHRvXG4gICovXG4gUS5fZ2VuZXJhdGVDb2xsaXNpb25Qb2ludHMgPSBmdW5jdGlvbihvYmopIHtcbiAgICBpZighb2JqLm1hdHJpeCAmJiAhb2JqLnJlZnJlc2hNYXRyaXgpIHsgcmV0dXJuOyB9XG4gICAgaWYoIW9iai5jKSB7IG9iai5jID0geyBwb2ludHM6IFtdIH07IH1cbiAgICB2YXIgcCA9IG9iai5wLCBjID0gb2JqLmM7XG5cbiAgICBpZighcC5tb3ZlZCAmJiBcbiAgICAgICBjLm9yaWdYID09PSBwLnggJiZcbiAgICAgICBjLm9yaWdZID09PSBwLnkgJiZcbiAgICAgICBjLm9yaWdTY2FsZSA9PT0gcC5zY2FsZSAmJlxuICAgICAgIGMub3JpZ0FuZ2xlID09PSBwLmFuZ2xlKSB7IFxuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgYy5vcmlnWCA9IHAueDtcbiAgICBjLm9yaWdZID0gcC55O1xuICAgIGMub3JpZ1NjYWxlID0gcC5zY2FsZTtcbiAgICBjLm9yaWdBbmdsZSA9IHAuYW5nbGU7XG5cbiAgICBvYmoucmVmcmVzaE1hdHJpeCgpO1xuXG4gICAgdmFyIGk7XG5cbiAgICAvLyBFYXJseSBvdXQgaWYgd2UgZG9uJ3QgbmVlZCB0byByb3RhdGUgLyBzY2FsZSAvIGRlYWwgd2l0aCBhIGNvbnRhaW5lclxuICAgIGlmKCFvYmouY29udGFpbmVyICYmICghcC5zY2FsZSB8fCBwLnNjYWxlID09PSAxKSAmJiBwLmFuZ2xlID09PSAwKSB7XG4gICAgICBmb3IoaT0wO2k8b2JqLnAucG9pbnRzLmxlbmd0aDtpKyspIHtcbiAgICAgICAgb2JqLmMucG9pbnRzW2ldID0gb2JqLmMucG9pbnRzW2ldIHx8IFtdO1xuICAgICAgICBvYmouYy5wb2ludHNbaV1bMF0gPSBwLnggKyBvYmoucC5wb2ludHNbaV1bMF07XG4gICAgICAgIG9iai5jLnBvaW50c1tpXVsxXSA9IHAueSArIG9iai5wLnBvaW50c1tpXVsxXTtcbiAgICAgIH1cbiAgICAgIGMueCA9IHAueDsgYy55ID0gcC55O1xuICAgICAgYy5jeCA9IHAuY3g7IGMuY3kgPSBwLmN5O1xuICAgICAgYy53ID0gcC53OyBjLmggPSBwLmg7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBjb250YWluZXIgPSBvYmouY29udGFpbmVyIHx8IFEuX251bGxDb250YWluZXI7XG5cbiAgICBjLnggPSBjb250YWluZXIubWF0cml4LnRyYW5zZm9ybVgocC54LHAueSk7XG4gICAgYy55ID0gY29udGFpbmVyLm1hdHJpeC50cmFuc2Zvcm1ZKHAueCxwLnkpO1xuICAgIGMuYW5nbGUgPSBwLmFuZ2xlICsgY29udGFpbmVyLmMuYW5nbGU7XG4gICAgYy5zY2FsZSA9IChjb250YWluZXIuYy5zY2FsZSB8fCAxKSAqIChwLnNjYWxlIHx8IDEpO1xuXG4gICAgdmFyIG1pblggPSBJbmZpbml0eSxcbiAgICAgICAgbWluWSA9IEluZmluaXR5LFxuICAgICAgICBtYXhYID0gLUluZmluaXR5LFxuICAgICAgICBtYXhZID0gLUluZmluaXR5O1xuXG4gICAgZm9yKGk9MDtpPG9iai5wLnBvaW50cy5sZW5ndGg7aSsrKSB7XG4gICAgICBpZighb2JqLmMucG9pbnRzW2ldKSB7XG4gICAgICAgIG9iai5jLnBvaW50c1tpXSA9IFtdO1xuICAgICAgfVxuICAgICAgb2JqLm1hdHJpeC50cmFuc2Zvcm1BcnIob2JqLnAucG9pbnRzW2ldLG9iai5jLnBvaW50c1tpXSk7XG4gICAgICB2YXIgeCA9IG9iai5jLnBvaW50c1tpXVswXSxcbiAgICAgICAgICB5ID0gb2JqLmMucG9pbnRzW2ldWzFdO1xuXG4gICAgICAgICAgaWYoeCA8IG1pblgpIHsgbWluWCA9IHg7IH1cbiAgICAgICAgICBpZih4ID4gbWF4WCkgeyBtYXhYID0geDsgfVxuICAgICAgICAgIGlmKHkgPCBtaW5ZKSB7IG1pblkgPSB5OyB9XG4gICAgICAgICAgaWYoeSA+IG1heFkpIHsgbWF4WSA9IHk7IH1cbiAgICB9XG5cbiAgICBpZihtaW5YID09PSBtYXhYKSB7IG1heFgrPTE7IH1cbiAgICBpZihtaW5ZID09PSBtYXhZKSB7IG1heFkrPTE7IH1cblxuICAgIGMuY3ggPSBjLnggLSBtaW5YO1xuICAgIGMuY3kgPSBjLnkgLSBtaW5ZO1xuXG4gICAgYy53ID0gbWF4WCAtIG1pblg7XG4gICAgYy5oID0gbWF4WSAtIG1pblk7XG5cbiAgICAvLyBUT0RPOiBJbnZva2UgbW92ZWQgb24gY2hpbGRyZW5cbiAgfTtcbiAgXG4gIFxuICAvKipcbiAgIFxuICAgQmFzaWMgc3ByaXRlIGNsYXNzIC0gd2lsbCByZW5kZXIgZWl0aGVyIGFuZCBhc3NldCBvciBhIGZyYW1lIGZyb20gYSBzcHJpdGUgc2hlZXQuXG5cbiAgIEF1dG8gc2V0cyB0aGUgd2lkdGggYW5kIGhlaWdodCAoYHAud2AgYW5kIGBwLmhgKSBmcm9tIHRoZSBwcm92aWRlZCBpbWFnZSBhc3NldCBhbmRcbiAgIGNlbnRlcnMgdGhlIHNwcml0ZSBzbyAwLDAgaXMgdGhlIGNlbnRlciBvZiB0aGUgcHJvdmlkZSBpbWFnZS5cblxuICAgTW9zdCBvZiB0aGUgdGltZXMgeW91J2xsIHN1Yi1jbGFzcyBgUS5TcHJpdGVgIFxuXG4gICBAZXh0ZW5kcyBRLkdhbWVPYmplY3RcbiAgIEBjbGFzcyBRLlNwcml0ZVxuICAgQGZvciBRdWludHVzLlNwcml0ZXNcbiAgKi9cbiAgUS5HYW1lT2JqZWN0LmV4dGVuZChcIlNwcml0ZVwiLHtcblxuICAgIC8qKlxuICAgICBcbiAgICAgIERlZmF1bHQgc3ByaXRlIGNvbnN0cnVjdG9yLCB0YWtlcyBpbiBhIHNldCBvZiBwcm9wZXJ0aWVzIGFuZCBhIHNldCBvZiBkZWZhdWx0IHByb3BlcnRpZXMgKHVzZWZ1bCB3aGVuIHlvdSBjcmVhdGUgYSBzdWJjbGFzcyBvZiBzcHJpdGUpXG4gICAgIFxuICAgICAgRGVmYXVsdCBwcm9wZXJ0aWVzOlxuXG4gICAgICAgICAgIHtcbiAgICAgICAgICAgIGFzc2V0OiBudWxsLCAgLy8gYXNzZXQgdG8gdXNlXG4gICAgICAgICAgICBzaGVldDogbnVsbCwgIC8vIHNwcml0ZSBzaGVldCB0byB1c2UgKG92ZXJyaWRlcyBhc3NldClcbiAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgejogMCxcbiAgICAgICAgICAgIHc6IDAsICAgICAgICAgLy8gd2lkdGgsIHNldCBmcm9tIHAuYXNzZXQgb3IgcC5zaGVldFxuICAgICAgICAgICAgaDogMCwgICAgICAgICAvLyBoZWlnaHQsIHNldCBmcm9tIHAuYXNzZXQgb3IgcC5zaGVldFxuICAgICAgICAgICAgY3g6IHcvMiwgICAgICAvLyBjZW50ZXIgeCwgZGVmYXVsdHMgdG8gY2VudGVyIG9mIHRoZSBhc3NldCBvciBzaGVldFxuICAgICAgICAgICAgY3k6IGgvMiwgICAgICAvLyBjZW50ZXIgeSwgZGVmYXVsdCBzYW1lIGFzIGN4XG4gICAgICAgICAgICAvLyBwb2ludHMgZGVmaW5lcyB0aGUgY29sbGlzaW9uIHNoYXBlLCBvdmVycmlkZSB0byBjdXN0b21lciB0aGUgY29sbGlzaW9uIHNoYXBlLFxuICAgICAgICAgICAgLy8gbXVzdCBiZSBhIGNvbnZleCBwb2x5Z29uIGluIGNsb2Nrd2lzZSBvcmRlclxuICAgICAgICAgICAgcG9pbnRzOiBbICBbIC13LzIsIC1oLzIgXSwgWyAgdy8yLCAtaC8yIF0sIFsgIHcvMiwgIGgvMiBdLCBbIC13LzIsICBoLzIgXSBdLFxuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIGFuZ2xlOiAwLFxuICAgICAgICAgICAgZnJhbWU6IDBcbiAgICAgICAgICAgIHR5cGU6ICBRLlNQUklURV9ERUZBVUxUIHwgUS5TUFJJVEVfQUNUSVZFLFxuICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICBzb3J0OiBmYWxzZSwgICAvLyBzZXQgdG8gdHJ1ZSB0byBmb3JjZSBjaGlsZHJlbiB0byBiZSBzb3J0ZWQgYnkgdGhlaWVyIHAueixcbiAgICAgICAgICAgIGhpZGRlbjogZmFsc2UsICAvLyBzZXQgdG8gdHJ1ZSB0byBoaWRlIHRoZSBzcHJpdGVcbiAgICAgICAgICAgIGZsaXA6IFwiXCIgICAgICAgLy8gc2V0IHRvIFwieFwiLCBcInlcIiwgb3IgXCJ4eVwiIHRvIGZsaXAgc3ByaXRlIG92ZXIgdGhhdCBkaW1lbnNpb25cbiAgICAgICAgICAgfVxuXG4gICAgICBAbWV0aG9kIGluaXRcbiAgICAgIEBmb3IgUS5TcHJpdGVcbiAgICAgIEBwYXJhbSB7T2JqZWN0fSBwcm9wcyAtIHByb3BlcnR5IGhhcyB0aGF0IHdpbGwgYmUgdHVybmVkIGludG8gYHBgXG4gICAgICBAcGFyYW0ge09iamVjdH0gW2RlZmF1bHRQcm9wc10gLSBkZWZhdWx0IHByb3BlcnRpZXMgdGhhdCBhcmUgYXNzaWduZWQgb25seSBpZiB0aGVyZSdzIG5vdCBhIGNvcnJlc3BvbmRpbmcgdmFsdWUgaW4gYHByb3BzYFxuICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24ocHJvcHMsZGVmYXVsdFByb3BzKSB7XG4gICAgICB0aGlzLnAgPSBRLl9leHRlbmQoeyBcbiAgICAgICAgeDogMCxcbiAgICAgICAgeTogMCxcbiAgICAgICAgejogMCxcbiAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgYW5nbGU6IDAsXG4gICAgICAgIGZyYW1lOiAwLFxuICAgICAgICB0eXBlOiBRLlNQUklURV9ERUZBVUxUIHwgUS5TUFJJVEVfQUNUSVZFLFxuICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgc3ByaXRlUHJvcGVydGllczoge31cbiAgICAgIH0sZGVmYXVsdFByb3BzKTtcblxuICAgICAgdGhpcy5tYXRyaXggPSBuZXcgUS5NYXRyaXgyRCgpO1xuICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdO1xuXG4gICAgICBRLl9leHRlbmQodGhpcy5wLHByb3BzKTsgXG5cbiAgICAgIHRoaXMuc2l6ZSgpO1xuICAgICAgdGhpcy5wLmlkID0gdGhpcy5wLmlkIHx8IFEuX3VuaXF1ZUlkKCk7XG5cbiAgICAgIHRoaXMucmVmcmVzaE1hdHJpeCgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICBSZXNldHMgdGhlIHdpZHRoLCBoZWlnaHQgYW5kIGNlbnRlciBiYXNlZCBvbiB0aGVcbiAgICAgYXNzZXQgb3Igc3ByaXRlIHNoZWV0XG5cbiAgICBAbWV0aG9kIHNpemVcbiAgICBAZm9yIFEuU3ByaXRlXG4gICAgQHBhcmFtIHtCb29sZWFufSBmb3JjZSAtIGZvcmNlIGEgcmVzZXQgKGNhbGwgaWYgdyBvciBoIGNoYW5nZXMpXG4gICAgKi9cbiAgICBzaXplOiBmdW5jdGlvbihmb3JjZSkge1xuICAgICAgaWYoZm9yY2UgfHwgKCF0aGlzLnAudyB8fCAhdGhpcy5wLmgpKSB7IFxuICAgICAgICBpZih0aGlzLmFzc2V0KCkpIHtcbiAgICAgICAgICB0aGlzLnAudyA9IHRoaXMuYXNzZXQoKS53aWR0aDtcbiAgICAgICAgICB0aGlzLnAuaCA9IHRoaXMuYXNzZXQoKS5oZWlnaHQ7XG4gICAgICAgIH0gZWxzZSBpZih0aGlzLnNoZWV0KCkpIHtcbiAgICAgICAgICB0aGlzLnAudyA9IHRoaXMuc2hlZXQoKS50aWxlVztcbiAgICAgICAgICB0aGlzLnAuaCA9IHRoaXMuc2hlZXQoKS50aWxlSDtcbiAgICAgICAgfVxuICAgICAgfSBcblxuICAgICAgdGhpcy5wLmN4ID0gKGZvcmNlIHx8IHRoaXMucC5jeCA9PT0gdm9pZCAwKSA/ICh0aGlzLnAudyAvIDIpIDogdGhpcy5wLmN4O1xuICAgICAgdGhpcy5wLmN5ID0gKGZvcmNlIHx8IHRoaXMucC5jeSA9PT0gdm9pZCAwKSA/ICh0aGlzLnAuaCAvIDIpIDogdGhpcy5wLmN5O1xuICAgIH0sXG5cbiAgICAvKipcbiAgICBHZXQgb3Igc2V0IHRoZSBhc3NldCBhc3NvY2lhdGUgd2l0aCB0aGlzIHNwcml0ZVxuXG4gICAgQG1ldGhvZCBhc3NldFxuICAgIEBmb3IgUS5TcHJpdGVcbiAgICBAcGFyYW0ge1N0cmluZ30gW25hbWVdIC0gbGVhdmUgZW1wdHkgdG8gcmV0dXJuIHRoZSBhc3NldCwgYWRkIHRvIHNldCB0aGUgYXNzZXRcbiAgICBAcGFyYW0ge0Jvb2xlYW59IFtyZXNpemVdIC0gZm9yY2UgYSBjYWxsIHRvIGBzaXplKClgIGFuZCBgX2dlbmVyYXRlUG9pbnRzYFxuICAgICovXG4gICAgYXNzZXQ6IGZ1bmN0aW9uKG5hbWUscmVzaXplKSB7XG4gICAgICBpZighbmFtZSkgeyByZXR1cm4gUS5hc3NldCh0aGlzLnAuYXNzZXQpOyB9XG5cbiAgICAgIHRoaXMucC5hc3NldCA9IG5hbWU7XG4gICAgICBpZihyZXNpemUpIHtcbiAgICAgICAgdGhpcy5zaXplKHRydWUpO1xuICAgICAgICBRLl9nZW5lcmF0ZVBvaW50cyh0aGlzLHRydWUpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcblxuICAgICBHZXQgb3Igc2V0IHRoZSBzaGVldCBhc3NvY2lhdGUgd2l0aCB0aGlzIHNwcml0ZVxuXG4gICAgIEBtZXRob2Qgc2hlZXRcbiAgICAgQGZvciBRLlNwcml0ZVxuICAgICBAcGFyYW0ge1N0cmluZ30gW25hbWVdIC0gbGVhdmUgZW1wdHkgdG8gcmV0dXJuIHRoZSBzcHJpdGUgc2hlZXQsIGFkZCB0byByZXNpemVcbiAgICAgQHBhcmFtIHtCb29sZWFufSBbcmVzaXplXSAtIGZvcmNlIGEgcmVzaXplXG4gICAgKi9cbiAgICBzaGVldDogZnVuY3Rpb24obmFtZSxyZXNpemUpIHtcbiAgICAgIGlmKCFuYW1lKSB7IHJldHVybiBRLnNoZWV0KHRoaXMucC5zaGVldCk7IH1cblxuICAgICAgdGhpcy5wLnNoZWV0ID0gbmFtZTtcbiAgICAgIGlmKHJlc2l6ZSkgeyBcbiAgICAgICAgdGhpcy5zaXplKHRydWUpO1xuICAgICAgICBRLl9nZW5lcmF0ZVBvaW50cyh0aGlzLHRydWUpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgSGlkZSB0aGUgc3ByaXRlIChyZW5kZXIgcmV0dXJucyB3aXRob3V0IHJlbmRlcmluZylcblxuICAgICBAbWV0aG9kIGhpZGVcbiAgICAgQGZvciBRLlNwcml0ZVxuICAgICovXG4gICAgaGlkZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnAuaGlkZGVuID0gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIFNob3cgdGhlIHNwcml0ZSBcblxuICAgICBAbWV0aG9kIHNob3dcbiAgICAgQGZvciBRLlNwcml0ZVxuICAgICovXG4gICAgc2hvdzogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnAuaGlkZGVuID0gZmFsc2U7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICBTZXQgYSBzZXQgb2YgYHBgIHByb3BlcnRpZXMgb24gYSBTcHJpdGVcblxuICAgICBAbWV0aG9kIHNldFxuICAgICBAZm9yIFEuU3ByaXRlXG4gICAgIEBwYXJhbSB7T2JqZWN0fSBwcm9wZXJ0aWVzIC0gaGFzaCBvZiBwcm9wZXJ0aWVzIHRvIHNldFxuICAgICovXG4gICAgc2V0OiBmdW5jdGlvbihwcm9wZXJ0aWVzKSB7XG4gICAgICBRLl9leHRlbmQodGhpcy5wLHByb3BlcnRpZXMpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIF9zb3J0Q2hpbGQ6IGZ1bmN0aW9uKGEsYikge1xuICAgICAgcmV0dXJuICgoYS5wICYmIGEucC56KSB8fCAtMSkgLSAoKGIucCAmJiBiLnAueikgfHwgLTEpO1xuICAgIH0sXG5cbiAgICBfZmxpcEFyZ3M6IHtcbiAgICAgIFwieFwiOiAgWyAtMSwgIDFdLFxuICAgICAgXCJ5XCI6ICBbICAxLCAtMV0sXG4gICAgICBcInh5XCI6IFsgLTEsIC0xXVxuICAgIH0sXG5cbiAgICAvKiogXG4gICAgIERlZmF1bHQgcmVuZGVyIG1ldGhvZCBmb3IgdGhlIHNwcml0ZS4gRG9uJ3Qgb3ZlcmxvYWQgdGhpcyB1bmxlc3MgeW91IHdhbnQgdG9cbiAgICAgaGFuZGxlIGFsbCB0aGUgdHJhbnNmb3JtIGFuZCBzY2FsZSBzdHVmZiB5b3Vyc2VsZi4gUmF0aGVyIG92ZXJsb2FkIHRoZSBgZHJhd2AgbWV0aG9kLlxuXG4gICAgIEBtZXRob2QgcmVuZGVyXG4gICAgIEBmb3IgUS5TcHJpdGVcbiAgICAgQHBhcmFtIHtDb250ZXh0MkR9IGN0eCAtIGNvbnRleHQgdG8gcmVuZGVyIHRvXG4gICAgKi9cbiAgICByZW5kZXI6IGZ1bmN0aW9uKGN0eCkge1xuICAgICAgdmFyIHAgPSB0aGlzLnA7XG5cbiAgICAgIGlmKHAuaGlkZGVuKSB7IHJldHVybjsgfVxuICAgICAgaWYoIWN0eCkgeyBjdHggPSBRLmN0eDsgfVxuXG4gICAgICB0aGlzLnRyaWdnZXIoJ3ByZWRyYXcnLGN0eCk7XG5cbiAgICAgIGN0eC5zYXZlKCk7XG5cbiAgICAgICAgaWYodGhpcy5wLm9wYWNpdHkgIT09IHZvaWQgMCAmJiB0aGlzLnAub3BhY2l0eSAhPT0gMSkge1xuICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IHRoaXMucC5vcGFjaXR5O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tYXRyaXguc2V0Q29udGV4dFRyYW5zZm9ybShjdHgpO1xuXG4gICAgICAgIGlmKHRoaXMucC5mbGlwKSB7IGN0eC5zY2FsZS5hcHBseShjdHgsdGhpcy5fZmxpcEFyZ3NbdGhpcy5wLmZsaXBdKTsgfVxuXG4gICAgICAgIHRoaXMudHJpZ2dlcignYmVmb3JlZHJhdycsY3R4KTtcbiAgICAgICAgdGhpcy5kcmF3KGN0eCk7XG4gICAgICAgIHRoaXMudHJpZ2dlcignZHJhdycsY3R4KTtcblxuICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgIFxuICAgICAgLy8gQ2hpbGRyZW4gc2V0IHVwIHRoZWlyIG93biBjb21wbGV0ZSBtYXRyaXhcbiAgICAgIC8vIGZyb20gdGhlIGJhc2Ugc3RhZ2UgbWF0cml4XG4gICAgICBpZih0aGlzLnAuc29ydCkgeyB0aGlzLmNoaWxkcmVuLnNvcnQodGhpcy5fc29ydENoaWxkKTsgfVxuICAgICAgUS5faW52b2tlKHRoaXMuY2hpbGRyZW4sXCJyZW5kZXJcIixjdHgpO1xuICAgICAgXG4gICAgICB0aGlzLnRyaWdnZXIoJ3Bvc3RkcmF3JyxjdHgpO1xuXG4gICAgICBpZihRLmRlYnVnKSB7IHRoaXMuZGVidWdSZW5kZXIoY3R4KTsgfVxuXG4gICAgfSxcblxuICAgIC8qKlxuICAgICBDZW50ZXIgc3ByaXRlIGluc2lkZSBvZiBpdCdzIGNvbnRhaW5lciAob3IgdGhlIHN0YWdlKVxuXG4gICAgIEBtZXRob2QgY2VudGVyXG4gICAgIEBmb3IgUS5TcHJpdGVcbiAgICAqL1xuICAgIGNlbnRlcjogZnVuY3Rpb24oKSB7XG4gICAgICBpZih0aGlzLmNvbnRhaW5lcikge1xuICAgICAgICB0aGlzLnAueCA9IHRoaXMuY29udGFpbmVyLnAudyAvIDI7XG4gICAgICAgIHRoaXMucC55ID0gdGhpcy5jb250YWluZXIucC5oIC8gMjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMucC54ID0gUS53aWR0aCAvIDI7XG4gICAgICAgIHRoaXMucC55ID0gUS5oZWlnaHQgLyAyO1xuICAgICAgfVxuXG4gICAgfSxcblxuICAgIC8qKlxuICAgICBEcmF3IHRoZSBhc3NldCBvbiB0aGUgc3RhZ2UuIHRoZSBjb250ZXh0IHBhc3NlZCBpbiBpcyBhbHJlYXkgdHJhbnNmb3JtZWQuXG5cbiAgICAgQWxsIHlvdSBuZWVkIHRvIGRvIGlzIGEgZHJhdyB0aGUgc3ByaXRlIGNlbnRlcmVkIGF0IDAsMFxuXG4gICAgIEBtZXRob2QgZHJhd1xuICAgICBAZm9yIFEuU3ByaXRlXG4gICAgIEBwYXJhbSB7Q29udGV4dDJEfSBjdHhcbiAgICAqL1xuICAgIGRyYXc6IGZ1bmN0aW9uKGN0eCkge1xuICAgICAgdmFyIHAgPSB0aGlzLnA7XG4gICAgICBpZihwLnNoZWV0KSB7XG4gICAgICAgIHRoaXMuc2hlZXQoKS5kcmF3KGN0eCwtcC5jeCwtcC5jeSxwLmZyYW1lKTtcbiAgICAgIH0gZWxzZSBpZihwLmFzc2V0KSB7XG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoUS5hc3NldChwLmFzc2V0KSwtcC5jeCwtcC5jeSk7XG4gICAgICB9IGVsc2UgaWYocC5jb2xvcikge1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gcC5jb2xvcjtcbiAgICAgICAgY3R4LmZpbGxSZWN0KC1wLmN4LC1wLmN5LHAudyxwLmgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBkZWJ1Z1JlbmRlcjogZnVuY3Rpb24oY3R4KSB7XG4gICAgICBpZighdGhpcy5wLnBvaW50cykge1xuICAgICAgICBRLl9nZW5lcmF0ZVBvaW50cyh0aGlzKTtcbiAgICAgIH1cbiAgICAgIGN0eC5zYXZlKCk7XG4gICAgICB0aGlzLm1hdHJpeC5zZXRDb250ZXh0VHJhbnNmb3JtKGN0eCk7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5wLmhpdCA/IFwiYmx1ZVwiIDogXCJyZWRcIjtcbiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiI0ZGMDAwMFwiO1xuICAgICAgY3R4LmZpbGxTdHlsZSA9IFwicmdiYSgwLDAsMCwwLjUpXCI7XG5cbiAgICAgIGN0eC5tb3ZlVG8odGhpcy5wLnBvaW50c1swXVswXSx0aGlzLnAucG9pbnRzWzBdWzFdKTtcbiAgICAgIGZvcih2YXIgaT0wO2k8dGhpcy5wLnBvaW50cy5sZW5ndGg7aSsrKSB7XG4gICAgICAgIGN0eC5saW5lVG8odGhpcy5wLnBvaW50c1tpXVswXSx0aGlzLnAucG9pbnRzW2ldWzFdKTtcbiAgICAgIH1cbiAgICAgIGN0eC5saW5lVG8odGhpcy5wLnBvaW50c1swXVswXSx0aGlzLnAucG9pbnRzWzBdWzFdKTtcbiAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgIGlmKFEuZGVidWdGaWxsKSB7IGN0eC5maWxsKCk7IH1cblxuICAgICAgY3R4LnJlc3RvcmUoKTtcblxuICAgICAgaWYodGhpcy5jKSB7IFxuICAgICAgICB2YXIgYyA9IHRoaXMuYztcbiAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxO1xuICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAyO1xuICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiI0ZGMDBGRlwiO1xuICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICBjdHgubW92ZVRvKGMueCAtIGMuY3gsICAgICAgIGMueSAtIGMuY3kpO1xuICAgICAgICAgIGN0eC5saW5lVG8oYy54IC0gYy5jeCArIGMudywgYy55IC0gYy5jeSk7XG4gICAgICAgICAgY3R4LmxpbmVUbyhjLnggLSBjLmN4ICsgYy53LCBjLnkgLSBjLmN5ICsgYy5oKTtcbiAgICAgICAgICBjdHgubGluZVRvKGMueCAtIGMuY3ggICAgICAsIGMueSAtIGMuY3kgKyBjLmgpO1xuICAgICAgICAgIGN0eC5saW5lVG8oYy54IC0gYy5jeCwgICAgICAgYy55IC0gYy5jeSk7XG4gICAgICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKiogXG4gICAgIFVwZGF0ZSBtZXRob2QgaXMgY2FsbGVkIGVhY2ggc3RlcCB3aXRoIHRoZSB0aW1lIGVsYXBzZWQgc2luY2UgdGhlIGxhc3Qgc3RlcC5cblxuICAgICBEb2Vzbid0IGRvIGFueXRoaW5nIG90aGVyIHRoYW4gdHJpZ2dlciBldmVudHMsIGNhbGwgYSBgc3RlcGAgbWV0aG9kIGlmIGRlZmluZWRcbiAgICAgYW5kIHJ1biB1cGRhdGUgb24gYWxsIGl0cyBjaGlsZHJlbi5cblxuICAgICBHZW5lcmFsbHkgbGVhdmUgdGhpcyBtZXRob2QgYWxvbmUgYW5kIGRlZmluZSBhIGBzdGVwYCBtZXRob2QgdGhhdCB3aWxsIGJlIGNhbGxlZFxuXG4gICAgIEBtZXRob2QgdXBkYXRlXG4gICAgIEBmb3IgUS5TcHJpdGVcbiAgICAgQHBhcmFtIHtGbG9hdH0gZHQgLSB0aW1lIGVsYXBzZWQgc2luY2UgbGFzdCBjYWxsXG4gICAgKi9cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGR0KSB7XG4gICAgICB0aGlzLnRyaWdnZXIoJ3ByZXN0ZXAnLGR0KTtcbiAgICAgIGlmKHRoaXMuc3RlcCkgeyB0aGlzLnN0ZXAoZHQpOyB9XG4gICAgICB0aGlzLnRyaWdnZXIoJ3N0ZXAnLGR0KTtcbiAgICAgIHRoaXMucmVmcmVzaE1hdHJpeCgpO1xuXG4gICAgICAvLyBVZ2x5IGNvdXBsaW5nIHRvIHN0YWdlIC0gd29ya2Fyb3VuZD9cbiAgICAgIGlmKHRoaXMuc3RhZ2UgJiYgdGhpcy5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXMuc3RhZ2UudXBkYXRlU3ByaXRlcyh0aGlzLmNoaWxkcmVuLGR0LHRydWUpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBSZXNldCBjb2xsaXNpb25zIGlmIHdlJ3JlIHRyYWNraW5nIHRoZW1cbiAgICAgIGlmKHRoaXMucC5jb2xsaXNpb25zKSB7IHRoaXMucC5jb2xsaXNpb25zID0gW107IH1cbiAgICB9LFxuXG4gICAgLyogXG4gICAgIFJlZ2VuZXJhdGVzIHRoaXMgc3ByaXRlJ3MgdHJhbnNmb3JtYXRpb24gbWF0cml4XG5cbiAgICAgQG1ldGhvZCByZWZyZXNoTWF0cml4XG4gICAgIEBmb3IgUS5TcHJpdGVcbiAgICAqL1xuICAgIHJlZnJlc2hNYXRyaXg6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHAgPSB0aGlzLnA7XG4gICAgICB0aGlzLm1hdHJpeC5pZGVudGl0eSgpO1xuXG4gICAgICBpZih0aGlzLmNvbnRhaW5lcikgeyB0aGlzLm1hdHJpeC5tdWx0aXBseSh0aGlzLmNvbnRhaW5lci5tYXRyaXgpOyB9XG4gICAgICBcbiAgICAgIHRoaXMubWF0cml4LnRyYW5zbGF0ZShwLngscC55KTtcblxuICAgICAgaWYocC5zY2FsZSkgeyB0aGlzLm1hdHJpeC5zY2FsZShwLnNjYWxlLHAuc2NhbGUpOyB9XG5cbiAgICAgIHRoaXMubWF0cml4LnJvdGF0ZURlZyhwLmFuZ2xlKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgU2ltcGxlIHNwcml0ZSB0aGF0IGFkZHMgaW4gYmFzaWMgbmV3dG9uaWFuIHBoeXNpY3Mgb24gZWFjaCBzdGVwOlxuXG4gICAgICAgcC52eCArPSBwLmF4ICogZHQ7XG4gICAgICAgcC52eSArPSBwLmF5ICogZHQ7XG5cbiAgICAgICBwLnggKz0gcC52eCAqIGR0O1xuICAgICAgIHAueSArPSBwLnZ5ICogZHQ7XG5cbiAgIEBjbGFzcyBRLk1vdmluZ1Nwcml0ZVxuICAgQGV4dGVuZHMgUS5TcHJpdGVcbiAgIEBmb3IgUXVpbnR1cy5TcHJpdGVzXG4gICovXG4gIFEuU3ByaXRlLmV4dGVuZChcIk1vdmluZ1Nwcml0ZVwiLHtcbiAgICBpbml0OiBmdW5jdGlvbihwcm9wcyxkZWZhdWx0UHJvcHMpIHtcbiAgICAgIHRoaXMuX3N1cGVyKFEuX2V4dGVuZCh7XG4gICAgICAgIHZ4OiAwLFxuICAgICAgICB2eTogMCxcbiAgICAgICAgYXg6IDAsXG4gICAgICAgIGF5OiAwXG4gICAgICB9LHByb3BzKSxkZWZhdWx0UHJvcHMpO1xuICAgfSxcblxuICAgc3RlcDogZnVuY3Rpb24oZHQpIHtcbiAgICAgdmFyIHAgPSB0aGlzLnA7XG5cbiAgICAgcC52eCArPSBwLmF4ICogZHQ7XG4gICAgIHAudnkgKz0gcC5heSAqIGR0O1xuXG4gICAgIHAueCArPSBwLnZ4ICogZHQ7XG4gICAgIHAueSArPSBwLnZ5ICogZHQ7XG4gICB9XG4gfSk7XG5cblxuXG5cbiAgcmV0dXJuIFE7XG59O1xuXG4iLCIvKmdsb2JhbCBRdWludHVzOmZhbHNlICovXG5cbi8qZ2xvYmFsIFF1aW50dXM6ZmFsc2UgKi9cbi8qKlxuUXVpbnR1cyBIVE1MNSBHYW1lIEVuZ2luZSAtIFRNWCBMb2FkZXIgbW9kdWxlXG5cbk1vZHVsZSByZXNwb25zaWJsZSBmb3IgbG9hZGluZyBUaWxlZCBUTVggZmlsZXNcblxuQG1vZHVsZSBRdWludHVzLklucHV0XG4qL1xuXG4vKipcbiAqIFF1aW50dXMgVE1YIExvYWRpbmcgbW9kdWxlXG4gKlxuICogQGNsYXNzIFF1aW50dXMuVE1YXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oUSkge1xuXG5cbiAvLyBBZGQgVE1YIGZpbGUgbG9hZGluZyBzdXBwb3J0IHRvIFF1aW50dXNcbiBRLmFzc2V0VHlwZXNbJ3RteCddID0gJ1RNWCc7XG5cbiAvLyBMb2FkIGEgVE1YIGZpbGUgYXMgYSBwYXJzZWQgWE1MIERPTVxuIFEubG9hZEFzc2V0VE1YID0gIGZ1bmN0aW9uKGtleSxzcmMsY2FsbGJhY2ssZXJyb3JDYWxsYmFjaykge1xuXG4gICAvLyBQaWdneWJhY2sgb24gbG9hZEFzc2V0T3RoZXIncyBBSkFYIGNhbGxcbiAgIFEubG9hZEFzc2V0T3RoZXIoa2V5LHNyYyxmdW5jdGlvbihrZXkscmVzcG9uc2VUZXh0KSB7XG4gICAgIHZhciBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XG4gICAgIHZhciBkb2MgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKHJlc3BvbnNlVGV4dCwgXCJhcHBsaWNhdGlvbi94bWxcIik7XG4gICAgIC8vIHNhdmUgdGhlIGFzc2V0IGFzIHRoZSBwYXJzZWQgZG9jXG4gICAgIGNhbGxiYWNrKGtleSxkb2MpO1xuICAgfSwgZXJyb3JDYWxsYmFjayk7XG5cbiB9O1xuXG4gUS5fdG14RXh0cmFjdEFzc2V0TmFtZSA9IGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgdmFyIHNvdXJjZSA9IHJlc3VsdC5nZXRBdHRyaWJ1dGUoXCJzb3VyY2VcIiksXG4gICBzb3VyY2VQYXJ0cyA9IHNvdXJjZS5zcGxpdChcIi9cIik7XG4gICAvLyBvbmx5IHJldHVybiB0aGUgbGFzdCBwYXJ0IG9mIHRoZSBhc3NldCBzdHJpbmdcbiAgIHJldHVybiBzb3VyY2VQYXJ0c1tzb3VyY2VQYXJ0cy5sZW5ndGggLSAxXTtcbiB9O1xuXG5cbiBRLl90bXhFeHRyYWN0U291cmNlcyA9IGZ1bmN0aW9uKGFzc2V0KSB7XG4gICB2YXIgcmVzdWx0cyA9IGFzc2V0LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbc291cmNlXVwiKTtcbiAgIHJldHVybiBRLl9tYXAocmVzdWx0cyxRLl90bXhFeHRyYWN0QXNzZXROYW1lKTtcblxuIH07XG4gXG5cbiBRLmxvYWRUTVggPSBmdW5jdGlvbihmaWxlcyxjYWxsYmFjayxvcHRpb25zKSB7XG4gICBpZihRLl9pc1N0cmluZyhmaWxlcykpIHtcbiAgICAgZmlsZXMgPSBRLl9ub3JtYWxpemVBcmcoZmlsZXMpO1xuICAgfVxuXG4gICB2YXIgdG14RmlsZXMgPSBbXTtcbiAgIFEuX2VhY2goZmlsZXMsZnVuY3Rpb24oZmlsZSkge1xuICAgICBpZihRLl9maWxlRXh0ZW5zaW9uKGZpbGUpID09PSAndG14Jykge1xuICAgICAgICB0bXhGaWxlcy5wdXNoKGZpbGUpO1xuICAgICB9XG4gICB9KTtcblxuICAgdmFyIGFkZGl0aW9uYWxBc3NldHMgPSBbXTtcblxuICAgUS5sb2FkKGZpbGVzLGZ1bmN0aW9uKCkge1xuICAgICBRLl9lYWNoKHRteEZpbGVzLGZ1bmN0aW9uKHRteEZpbGUpIHtcbiAgICAgICB2YXIgc291cmNlcyA9IFEuX3RteEV4dHJhY3RTb3VyY2VzKFEuYXNzZXQodG14RmlsZSkpO1xuICAgICAgIGFkZGl0aW9uYWxBc3NldHMgPSBhZGRpdGlvbmFsQXNzZXRzLmNvbmNhdChzb3VyY2VzKTtcbiAgICAgfSk7XG5cbiAgICAgaWYoYWRkaXRpb25hbEFzc2V0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgUS5sb2FkKGFkZGl0aW9uYWxBc3NldHMsY2FsbGJhY2ssb3B0aW9ucyk7XG4gICAgIH0gZWxzZSB7XG4gICAgICAgY2FsbGJhY2soKTtcbiAgICAgfVxuICAgfSk7XG5cbiB9O1xuXG5cblxuIGZ1bmN0aW9uIGF0dHIoZWxlbSxhdHIpIHtcbiAgIHZhciB2YWx1ZSA9IGVsZW0uZ2V0QXR0cmlidXRlKGF0cik7XG4gICByZXR1cm4gaXNOYU4odmFsdWUpID8gdmFsdWUgOiArdmFsdWU7XG4gfVxuXG4gZnVuY3Rpb24gcGFyc2VQcm9wZXJ0aWVzKGVsZW0pIHtcbiAgIHZhciBwcm9wRWxlbXMgPSBlbGVtLnF1ZXJ5U2VsZWN0b3JBbGwoXCJwcm9wZXJ0eVwiKSxcbiAgICAgICBwcm9wcyA9IHt9O1xuXG4gICBmb3IodmFyIGkgPSAwOyBpIDwgcHJvcEVsZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgIHZhciBwcm9wRWxlbSA9IHByb3BFbGVtc1tpXTtcbiAgICAgcHJvcHNbYXR0cihwcm9wRWxlbSwnbmFtZScpXSA9IGF0dHIocHJvcEVsZW0sJ3ZhbHVlJyk7XG4gICB9XG4gICByZXR1cm4gcHJvcHM7XG4gfVxuXG4gUS5fdG14TG9hZFRpbGVzZXRzID0gZnVuY3Rpb24odGlsZXNldHMsIHRpbGVQcm9wZXJ0aWVzKSB7XG4gICB2YXIgZ2lkTWFwID0gW107XG5cbiAgIGZ1bmN0aW9uIHBhcnNlUG9pbnQocHQpIHtcbiAgICAgdmFyIHB0cyA9IHB0LnNwbGl0KFwiLFwiKTtcbiAgICAgcmV0dXJuIFsgcGFyc2VGbG9hdChwdHNbMF0pLCBwYXJzZUZsb2F0KHB0c1sxXSkgXTtcbiAgIH1cblxuICAgZm9yKHZhciB0ID0gMDsgdCA8IHRpbGVzZXRzLmxlbmd0aDt0KyspIHtcbiAgICAgdmFyIHRpbGVzZXQgPSB0aWxlc2V0c1t0XSxcbiAgICAgICAgIHNoZWV0TmFtZSA9IGF0dHIodGlsZXNldCxcIm5hbWVcIiksXG4gICAgICAgICBnaWQgPSBhdHRyKHRpbGVzZXQsXCJmaXJzdGdpZFwiKSxcbiAgICAgICAgIGFzc2V0TmFtZSA9IFEuX3RteEV4dHJhY3RBc3NldE5hbWUodGlsZXNldC5xdWVyeVNlbGVjdG9yKFwiaW1hZ2VcIikpLFxuICAgICAgICAgdGlsZXNldFRpbGVQcm9wcyA9IHt9LFxuICAgICAgICAgdGlsZXNldFByb3BzID0geyB0aWxlVzogYXR0cih0aWxlc2V0LFwidGlsZXdpZHRoXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICB0aWxlSDogYXR0cih0aWxlc2V0LFwidGlsZWhlaWdodFwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc3BhY2luZ1g6IGF0dHIodGlsZXNldCxcInNwYWNpbmdcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNwYWNpbmdZOiBhdHRyKHRpbGVzZXQsXCJzcGFjaW5nXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgIHZhciB0aWxlcyA9IHRpbGVzZXQucXVlcnlTZWxlY3RvckFsbChcInRpbGVcIik7XG4gICAgIGZvcih2YXIgaSA9IDA7aSA8IHRpbGVzLmxlbmd0aDtpKyspIHtcbiAgICAgICB2YXIgdGlsZSA9IHRpbGVzW2ldO1xuICAgICAgIHZhciB0aWxlSWQgPSBhdHRyKHRpbGUsXCJpZFwiKTtcbiAgICAgICB2YXIgdGlsZUdpZCA9IGdpZCArIHRpbGVJZDtcblxuICAgICAgIHZhciBwcm9wZXJ0aWVzID0gcGFyc2VQcm9wZXJ0aWVzKHRpbGUpO1xuXG4gICAgICAgaWYocHJvcGVydGllcy5wb2ludHMpIHtcbiAgICAgICAgIHByb3BlcnRpZXMucG9pbnRzID0gUS5fbWFwKHByb3BlcnRpZXMucG9pbnRzLnNwbGl0KFwiIFwiKSxwYXJzZVBvaW50KTtcbiAgICAgICB9XG5cbiAgICAgICAvLyBzYXZlIHRoZSBwcm9wZXJ0aWVzIGluZGV4ZWQgYnkgR0lEIGZvciBjcmVhdGluZyBvYmplY3RzXG4gICAgICAgdGlsZVByb3BlcnRpZXNbdGlsZUdpZF0gPSBwcm9wZXJ0aWVzO1xuXG4gICAgICAgLy8gc2F2ZSB0aGUgcHJvcGVydGllcyBpbmRleGVkIGJ5IHRpbGUgbnVtYmVyIGZvciB0aGUgZnJhbWUgcHJvcGVydGllc1xuICAgICAgIHRpbGVzZXRUaWxlUHJvcHNbdGlsZUlkXSA9IHByb3BlcnRpZXM7XG4gICAgIH1cbiAgICAgdGlsZXNldFByb3BzLmZyYW1lUHJvcGVydGllcyA9IHRpbGVzZXRUaWxlUHJvcHM7XG4gICAgIGdpZE1hcC5wdXNoKFsgZ2lkLCBzaGVldE5hbWUgXSk7XG4gICAgIFEuc2hlZXQoc2hlZXROYW1lLCBhc3NldE5hbWUsICB0aWxlc2V0UHJvcHMpO1xuXG4gICB9XG4gICByZXR1cm4gZ2lkTWFwO1xuIH07XG5cbiBRLl90bXhQcm9jZXNzSW1hZ2VMYXllciA9IGZ1bmN0aW9uKHN0YWdlLGdpZE1hcCx0aWxlUHJvcGVydGllcyxsYXllcikge1xuICAgdmFyIGFzc2V0TmFtZSA9IFEuX3RteEV4dHJhY3RBc3NldE5hbWUobGF5ZXIucXVlcnlTZWxlY3RvcihcImltYWdlXCIpKTtcbiAgIHZhciBwcm9wZXJ0aWVzID0gcGFyc2VQcm9wZXJ0aWVzKGxheWVyKTtcbiAgIHByb3BlcnRpZXMuYXNzZXQgPSBhc3NldE5hbWU7XG5cbiAgIHN0YWdlLmluc2VydChuZXcgUS5SZXBlYXRlcihwcm9wZXJ0aWVzKSk7XG4gfTtcblxuIC8vIGdldCB0aGUgZmlyc3QgZW50cnkgaW4gdGhlIGdpZCBtYXAgdGhhdCBnaXZlc1xuIC8vIGEgZ2lkIG9mZnNldFxuIFEuX2xvb2t1cEdpZCA9IGZ1bmN0aW9uKGdpZCxnaWRNYXApIHtcbiAgIHZhciBpZHggPSAwO1xuXG4gICB3aGlsZShnaWRNYXBbaWR4KzFdICYmIGdpZCA+PSBnaWRNYXBbaWR4KzFdWzBdKSB7XG4gICAgIGlkeCsrO1xuICAgfVxuICAgcmV0dXJuIGdpZE1hcFtpZHhdO1xuIH07XG5cbiBRLl90bXhQcm9jZXNzVGlsZUxheWVyID0gZnVuY3Rpb24oc3RhZ2UsZ2lkTWFwLHRpbGVQcm9wZXJ0aWVzLGxheWVyKSB7XG4gICB2YXIgdGlsZXMgPSBsYXllci5xdWVyeVNlbGVjdG9yQWxsKFwidGlsZVwiKSxcbiAgICAgICB3aWR0aCA9IGF0dHIobGF5ZXIsJ3dpZHRoJyksXG4gICAgICAgaGVpZ2h0ID0gYXR0cihsYXllciwnaGVpZ2h0Jyk7XG5cbiAgICAgICBcbiAgIHZhciBnaWREZXRhaWxzLGdpZE9mZnNldCwgc2hlZXROYW1lO1xuXG4gICB2YXIgZGF0YSA9IFtdLCBpZHg9MDtcbiAgIGZvcih2YXIgeT0wO3k8aGVpZ2h0O3krKykge1xuICAgICBkYXRhW3ldID0gW107XG4gICAgIGZvcih2YXIgeD0wO3g8d2lkdGg7eCsrKSB7XG4gICAgICAgdmFyIGdpZCA9IGF0dHIodGlsZXNbaWR4XSxcImdpZFwiKTtcbiAgICAgICBpZihnaWQgPT09IDApIHtcbiAgICAgICAgIGRhdGFbeV0ucHVzaChudWxsKTtcbiAgICAgICB9IGVsc2Uge1xuICAgICAgICAgLy8gSWYgd2UgZG9uJ3Qga25vdyB3aGF0IHRpbGVzZXQgdGhpcyBtYXAgaXMgYXNzb2NpYXRlZCB3aXRoXG4gICAgICAgICAvLyBmaWd1cmUgaXQgb3V0IGJ5IGxvb2tpbmcgdXAgdGhlIGdpZCBvZiB0aGUgdGlsZSB3L1xuICAgICAgICAgLy8gYW5kIG1hdGNoIHRvIHRoZSB0aWxlc2VmXG4gICAgICAgICBpZighZ2lkT2Zmc2V0KSB7XG4gICAgICAgICAgIGdpZERldGFpbHMgPSBRLl9sb29rdXBHaWQoYXR0cih0aWxlc1tpZHhdLFwiZ2lkXCIpLGdpZE1hcCk7XG4gICAgICAgICAgIGdpZE9mZnNldCA9IGdpZERldGFpbHNbMF07XG4gICAgICAgICAgIHNoZWV0TmFtZSA9IGdpZERldGFpbHNbMV07XG4gICAgICAgICB9XG4gICAgICAgICBkYXRhW3ldLnB1c2goZ2lkIC0gZ2lkT2Zmc2V0KTtcbiAgICAgICB9XG4gICAgICAgaWR4Kys7XG4gICAgIH1cbiAgIH1cblxuICAgdmFyIHRpbGVMYXllclByb3BlcnRpZXMgPSBRLl9leHRlbmQoeyAgIFxuICAgICB0aWxlVzogUS5zaGVldChzaGVldE5hbWUpLnRpbGVXLFxuICAgICB0aWxlSDogUS5zaGVldChzaGVldE5hbWUpLnRpbGVILFxuICAgICBzaGVldDogc2hlZXROYW1lLFxuICAgICB0aWxlczogZGF0YVxuICAgICB9LHBhcnNlUHJvcGVydGllcyhsYXllcikpO1xuXG4gICB2YXIgVGlsZUxheWVyQ2xhc3MgPSB0aWxlTGF5ZXJQcm9wZXJ0aWVzLkNsYXNzIHx8ICdUaWxlTGF5ZXInO1xuXG4gICBpZih0aWxlTGF5ZXJQcm9wZXJ0aWVzWydjb2xsaXNpb24nXSkge1xuICAgICBzdGFnZS5jb2xsaXNpb25MYXllcihuZXcgUVtUaWxlTGF5ZXJDbGFzc10odGlsZUxheWVyUHJvcGVydGllcykpO1xuICAgfSBlbHNlIHtcbiAgICAgc3RhZ2UuaW5zZXJ0KG5ldyBRW1RpbGVMYXllckNsYXNzXSh0aWxlTGF5ZXJQcm9wZXJ0aWVzKSk7XG4gICB9XG4gfTtcblxuIFEuX3RteFByb2Nlc3NPYmplY3RMYXllciA9IGZ1bmN0aW9uKHN0YWdlLGdpZE1hcCx0aWxlUHJvcGVydGllcyxsYXllcikge1xuICAgdmFyIG9iamVjdHMgPSBsYXllci5xdWVyeVNlbGVjdG9yQWxsKFwib2JqZWN0XCIpO1xuICAgZm9yKHZhciBpPTA7aSA8IG9iamVjdHMubGVuZ3RoO2krKykge1xuICAgICB2YXIgb2JqID0gb2JqZWN0c1tpXSxcbiAgICAgICAgIGdpZCA9IGF0dHIob2JqLFwiZ2lkXCIpLFxuICAgICAgICAgeCA9IGF0dHIob2JqLCd4JyksXG4gICAgICAgICB5ID0gYXR0cihvYmosJ3knKSxcbiAgICAgICAgIHByb3BlcnRpZXMgPSB0aWxlUHJvcGVydGllc1tnaWRdLFxuICAgICAgICAgb3ZlcnJpZGVQcm9wZXJ0aWVzID0gcGFyc2VQcm9wZXJ0aWVzKG9iaik7XG5cbiAgICAgaWYoIXByb3BlcnRpZXMpIHsgdGhyb3cgXCJJbnZhbGlkIFRNWCBPYmplY3Q6IG1pc3NpbmcgcHJvcGVydGllcyBmb3IgR0lEOlwiICsgZ2lkOyB9XG4gICAgIGlmKCFwcm9wZXJ0aWVzWydDbGFzcyddKSB7IHRocm93IFwiSW52YWxpZCBUTVggT2JqZWN0OiBtaXNzaW5nIENsYXNzIGZvciBHSUQ6XCIgKyBnaWQ7IH1cblxuICAgICB2YXIgY2xhc3NOYW1lID0gcHJvcGVydGllc1snQ2xhc3MnXTtcbiAgICAgaWYoIWNsYXNzTmFtZSkgeyB0aHJvdyBcIkludmFsaWQgVE1YIE9iamVjdCBDbGFzczogXCIgKyBjbGFzc05hbWUgKyBcIiBHSUQ6XCIgKyBnaWQ7IH1cblxuICAgICB2YXIgcCA9IFEuX2V4dGVuZChRLl9leHRlbmQoeyB4OiB4LCB5OiB5IH0sIHByb3BlcnRpZXMpLCBvdmVycmlkZVByb3BlcnRpZXMpO1xuXG4gICAgIC8vIE9mZnNldCB0aGUgc3ByaXRlXG4gICAgIHZhciBzcHJpdGUgPSBuZXcgUVtjbGFzc05hbWVdKHApO1xuICAgICBzcHJpdGUucC54ICs9IHNwcml0ZS5wLncvMjtcbiAgICAgc3ByaXRlLnAueSAtPSBzcHJpdGUucC5oLzI7XG5cbiAgICAgc3RhZ2UuaW5zZXJ0KHNwcml0ZSk7XG4gICB9XG5cbiB9O1xuXG4gUS5fdG14UHJvY2Vzc29ycyA9IHsgJ29iamVjdGdyb3VwJzogUS5fdG14UHJvY2Vzc09iamVjdExheWVyLFxuICAgICAgICAgICAgICAgICAgICAgICdsYXllcic6IFEuX3RteFByb2Nlc3NUaWxlTGF5ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgJ2ltYWdlbGF5ZXInOiBRLl90bXhQcm9jZXNzSW1hZ2VMYXllciB9O1xuXG4gUS5zdGFnZVRNWCA9IGZ1bmN0aW9uKGRhdGFBc3NldCxzdGFnZSkge1xuICAgIHZhciBkYXRhID0gUS5faXNTdHJpbmcoZGF0YUFzc2V0KSA/ICBRLmFzc2V0KGRhdGFBc3NldCkgOiBkYXRhQXNzZXQ7XG5cbiAgICB2YXIgdGlsZVByb3BlcnRpZXMgPSB7fTtcblxuICAgIC8vIExvYWQgVGlsZXNldHNcbiAgICB2YXIgdGlsZXNldHMgPSBkYXRhLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwidGlsZXNldFwiKTtcbiAgICB2YXIgZ2lkTWFwID0gUS5fdG14TG9hZFRpbGVzZXRzKHRpbGVzZXRzLHRpbGVQcm9wZXJ0aWVzKTtcblxuICAgIC8vIEdvIHRocm91Z2ggZWFjaCBvZiB0aGUgbGF5ZXJzXG4gICAgUS5fZWFjaChkYXRhLmRvY3VtZW50RWxlbWVudC5jaGlsZE5vZGVzLGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgICB2YXIgbGF5ZXJUeXBlID0gbGF5ZXIudGFnTmFtZTtcbiAgICAgIGlmKFEuX3RteFByb2Nlc3NvcnNbbGF5ZXJUeXBlXSkge1xuICAgICAgICBRLl90bXhQcm9jZXNzb3JzW2xheWVyVHlwZV0oc3RhZ2UsIGdpZE1hcCwgdGlsZVByb3BlcnRpZXMsIGxheWVyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxufTtcblxuIiwiLypnbG9iYWwgUXVpbnR1czpmYWxzZSAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKFEpIHtcbiAgaWYoUS5faXNVbmRlZmluZWQoUS5tb2R1bGVzLlNwcml0ZXMpKSB7XG4gICAgdGhyb3cgXCJRdWludHVzLlRvdWNoIHJlcXVpcmVzIFF1aW50dXMuU3ByaXRlcyBNb2R1bGVcIjtcbiAgfVxuXG4gIHZhciBoYXNUb3VjaCA9ICAhISgnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cpO1xuXG4gIHZhciB0b3VjaFN0YWdlID0gWzBdO1xuICB2YXIgdG91Y2hUeXBlID0gMDtcblxuICBRLkV2ZW50ZWQuZXh0ZW5kKFwiVG91Y2hTeXN0ZW1cIix7XG5cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciB0b3VjaFN5c3RlbSA9IHRoaXM7XG5cbiAgICAgIHRoaXMuYm91bmRUb3VjaCA9IGZ1bmN0aW9uKGUpIHsgdG91Y2hTeXN0ZW0udG91Y2goZSk7IH07XG4gICAgICB0aGlzLmJvdW5kRHJhZyA9IGZ1bmN0aW9uKGUpIHsgdG91Y2hTeXN0ZW0uZHJhZyhlKTsgfTtcbiAgICAgIHRoaXMuYm91bmRFbmQgPSBmdW5jdGlvbihlKSB7IHRvdWNoU3lzdGVtLnRvdWNoRW5kKGUpOyB9O1xuXG4gICAgICBRLmVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLHRoaXMuYm91bmRUb3VjaCk7XG4gICAgICBRLmVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsdGhpcy5ib3VuZFRvdWNoKTtcblxuICAgICAgUS5lbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLHRoaXMuYm91bmREcmFnKTtcbiAgICAgIFEuZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJyx0aGlzLmJvdW5kRHJhZyk7XG5cbiAgICAgIFEuZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLHRoaXMuYm91bmRFbmQpO1xuICAgICAgUS5lbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJyx0aGlzLmJvdW5kRW5kKTtcbiAgICAgIFEuZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hjYW5jZWwnLHRoaXMuYm91bmRFbmQpO1xuXG4gICAgICB0aGlzLnRvdWNoUG9zID0gbmV3IFEuRXZlbnRlZCgpO1xuICAgICAgdGhpcy50b3VjaFBvcy5ncmlkID0ge307XG4gICAgICB0aGlzLnRvdWNoUG9zLnAgPSB7IHc6MSwgaDoxLCBjeDogMCwgY3k6IDAgfTtcbiAgICAgIHRoaXMuYWN0aXZlVG91Y2hlcyA9IHt9O1xuICAgICAgdGhpcy50b3VjaGVkT2JqZWN0cyA9IHt9O1xuICAgIH0sXG5cbiAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcbiAgICAgIFEuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsdGhpcy5ib3VuZFRvdWNoKTtcbiAgICAgIFEuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJyx0aGlzLmJvdW5kVG91Y2gpO1xuXG4gICAgICBRLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsdGhpcy5ib3VuZERyYWcpO1xuICAgICAgUS5lbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLHRoaXMuYm91bmREcmFnKTtcblxuICAgICAgUS5lbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsdGhpcy5ib3VuZEVuZCk7XG4gICAgICBRLmVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLHRoaXMuYm91bmRFbmQpO1xuICAgICAgUS5lbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGNhbmNlbCcsdGhpcy5ib3VuZEVuZCk7XG4gICAgfSxcblxuICAgIG5vcm1hbGl6ZVRvdWNoOiBmdW5jdGlvbih0b3VjaCxzdGFnZSkge1xuICAgICAgdmFyIGNhbnZhc1Bvc1ggPSB0b3VjaC5vZmZzZXRYLFxuICAgICAgICAgIGNhbnZhc1Bvc1kgPSB0b3VjaC5vZmZzZXRZO1xuICAgICAgICAgXG5cbiAgICAgIGlmKFEuX2lzVW5kZWZpbmVkKGNhbnZhc1Bvc1gpIHx8IFEuX2lzVW5kZWZpbmVkKGNhbnZhc1Bvc1kpKSB7XG4gICAgICAgIGNhbnZhc1Bvc1ggPSB0b3VjaC5sYXllclg7XG4gICAgICAgIGNhbnZhc1Bvc1kgPSB0b3VjaC5sYXllclk7XG4gICAgICB9XG5cbiAgICAgIGlmKFEuX2lzVW5kZWZpbmVkKGNhbnZhc1Bvc1gpIHx8IFEuX2lzVW5kZWZpbmVkKGNhbnZhc1Bvc1kpKSB7XG4gICAgICAgIGlmKFEudG91Y2gub2Zmc2V0WCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgUS50b3VjaC5vZmZzZXRYID0gMDtcbiAgICAgICAgICBRLnRvdWNoLm9mZnNldFkgPSAwO1xuICAgICAgICAgIHZhciBlbCA9IFEuZWw7XG4gICAgICAgICAgZG8ge1xuICAgICAgICAgICAgUS50b3VjaC5vZmZzZXRYICs9IGVsLm9mZnNldExlZnQ7XG4gICAgICAgICAgICBRLnRvdWNoLm9mZnNldFkgKz0gZWwub2Zmc2V0VG9wO1xuICAgICAgICAgIH0gd2hpbGUoZWwgPSBlbC5vZmZzZXRQYXJlbnQpO1xuICAgICAgICB9XG4gICAgICAgIGNhbnZhc1Bvc1ggPSB0b3VjaC5wYWdlWCAtIFEudG91Y2gub2Zmc2V0WDtcbiAgICAgICAgY2FudmFzUG9zWSA9IHRvdWNoLnBhZ2VZIC0gUS50b3VjaC5vZmZzZXRZO1xuICAgICAgfVxuXG5cbiAgICAgIHRoaXMudG91Y2hQb3MucC5veCA9IHRoaXMudG91Y2hQb3MucC5weCA9IGNhbnZhc1Bvc1ggLyBRLmNzc1dpZHRoICogUS53aWR0aDtcbiAgICAgIHRoaXMudG91Y2hQb3MucC5veSA9IHRoaXMudG91Y2hQb3MucC5weSA9IGNhbnZhc1Bvc1kgLyBRLmNzc0hlaWdodCAqIFEuaGVpZ2h0O1xuICAgICAgXG4gICAgICBpZihzdGFnZS52aWV3cG9ydCkge1xuICAgICAgICB0aGlzLnRvdWNoUG9zLnAucHggLz0gc3RhZ2Uudmlld3BvcnQuc2NhbGU7XG4gICAgICAgIHRoaXMudG91Y2hQb3MucC5weSAvPSBzdGFnZS52aWV3cG9ydC5zY2FsZTtcbiAgICAgICAgdGhpcy50b3VjaFBvcy5wLnB4ICs9IHN0YWdlLnZpZXdwb3J0Lng7XG4gICAgICAgIHRoaXMudG91Y2hQb3MucC5weSArPSBzdGFnZS52aWV3cG9ydC55O1xuICAgICAgfVxuXG4gICAgICB0aGlzLnRvdWNoUG9zLnAueCA9IHRoaXMudG91Y2hQb3MucC5weDtcbiAgICAgIHRoaXMudG91Y2hQb3MucC55ID0gdGhpcy50b3VjaFBvcy5wLnB5O1xuXG4gICAgICB0aGlzLnRvdWNoUG9zLm9iaiA9IG51bGw7XG4gICAgICByZXR1cm4gdGhpcy50b3VjaFBvcztcbiAgICB9LFxuXG4gICAgdG91Y2g6IGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciB0b3VjaGVzID0gZS5jaGFuZ2VkVG91Y2hlcyB8fCBbIGUgXTtcblxuICAgICAgZm9yKHZhciBpPTA7aTx0b3VjaGVzLmxlbmd0aDtpKyspIHtcblxuICAgICAgICBmb3IodmFyIHN0YWdlSWR4PTA7c3RhZ2VJZHggPCB0b3VjaFN0YWdlLmxlbmd0aDtzdGFnZUlkeCsrKSB7XG4gICAgICAgICAgdmFyIHRvdWNoID0gdG91Y2hlc1tpXSxcbiAgICAgICAgICAgICAgc3RhZ2UgPSBRLnN0YWdlKHRvdWNoU3RhZ2Vbc3RhZ2VJZHhdKTtcblxuICAgICAgICAgIGlmKCFzdGFnZSkgeyBjb250aW51ZTsgfVxuXG4gICAgICAgICAgdG91Y2guaWRlbnRpZmllciA9IHRvdWNoLmlkZW50aWZpZXIgfHwgMDtcbiAgICAgICAgICB2YXIgcG9zID0gdGhpcy5ub3JtYWxpemVUb3VjaCh0b3VjaCxzdGFnZSk7XG5cbiAgICAgICAgICBzdGFnZS5yZWdyaWQocG9zLHRydWUpO1xuICAgICAgICAgIHZhciBjb2wgPSBzdGFnZS5zZWFyY2gocG9zLHRvdWNoVHlwZSksIG9iajtcblxuICAgICAgICAgIGlmKGNvbCB8fCBzdGFnZUlkeCA9PT0gdG91Y2hTdGFnZS5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICBvYmogPSBjb2wgJiYgY29sLm9iajtcbiAgICAgICAgICAgIHBvcy5vYmogPSBvYmo7XG4gICAgICAgICAgICB0aGlzLnRyaWdnZXIoXCJ0b3VjaFwiLHBvcyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYob2JqICYmICF0aGlzLnRvdWNoZWRPYmplY3RzW29ial0pIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlVG91Y2hlc1t0b3VjaC5pZGVudGlmaWVyXSA9IHtcbiAgICAgICAgICAgICAgeDogcG9zLnAucHgsXG4gICAgICAgICAgICAgIHk6IHBvcy5wLnB5LFxuICAgICAgICAgICAgICBvcmlnWDogb2JqLnAueCxcbiAgICAgICAgICAgICAgb3JpZ1k6IG9iai5wLnksXG4gICAgICAgICAgICAgIHN4OiBwb3MucC5veCxcbiAgICAgICAgICAgICAgc3k6IHBvcy5wLm95LFxuICAgICAgICAgICAgICBpZGVudGlmaWVyOiB0b3VjaC5pZGVudGlmaWVyLFxuICAgICAgICAgICAgICBvYmo6IG9iaixcbiAgICAgICAgICAgICAgc3RhZ2U6IHN0YWdlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy50b3VjaGVkT2JqZWN0c1tvYmoucC5pZF0gPSB0cnVlO1xuICAgICAgICAgICAgb2JqLnRyaWdnZXIoJ3RvdWNoJywgdGhpcy5hY3RpdmVUb3VjaGVzW3RvdWNoLmlkZW50aWZpZXJdKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICAgIC8vZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0sXG5cbiAgICBkcmFnOiBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgdG91Y2hlcyA9IGUuY2hhbmdlZFRvdWNoZXMgfHwgWyBlIF07XG5cbiAgICAgIGZvcih2YXIgaT0wO2k8dG91Y2hlcy5sZW5ndGg7aSsrKSB7XG4gICAgICAgIHZhciB0b3VjaCA9IHRvdWNoZXNbaV07XG4gICAgICAgIHRvdWNoLmlkZW50aWZpZXIgPSB0b3VjaC5pZGVudGlmaWVyIHx8IDA7XG5cbiAgICAgICAgdmFyIGFjdGl2ZSA9IHRoaXMuYWN0aXZlVG91Y2hlc1t0b3VjaC5pZGVudGlmaWVyXSxcbiAgICAgICAgICAgIHN0YWdlID0gYWN0aXZlICYmIGFjdGl2ZS5zdGFnZTtcblxuICAgICAgICBpZihhY3RpdmUpIHtcbiAgICAgICAgICB2YXIgcG9zID0gdGhpcy5ub3JtYWxpemVUb3VjaCh0b3VjaCxzdGFnZSk7XG4gICAgICAgICAgYWN0aXZlLnggPSBwb3MucC5weDtcbiAgICAgICAgICBhY3RpdmUueSA9IHBvcy5wLnB5O1xuICAgICAgICAgIGFjdGl2ZS5keCA9IHBvcy5wLm94IC0gYWN0aXZlLnN4O1xuICAgICAgICAgIGFjdGl2ZS5keSA9IHBvcy5wLm95IC0gYWN0aXZlLnN5O1xuXG4gICAgICAgICAgYWN0aXZlLm9iai50cmlnZ2VyKCdkcmFnJywgYWN0aXZlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0sXG5cbiAgICB0b3VjaEVuZDogZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIHRvdWNoZXMgPSBlLmNoYW5nZWRUb3VjaGVzIHx8IFsgZSBdO1xuXG4gICAgICBmb3IodmFyIGk9MDtpPHRvdWNoZXMubGVuZ3RoO2krKykge1xuICAgICAgICB2YXIgdG91Y2ggPSB0b3VjaGVzW2ldO1xuXG4gICAgICAgIHRvdWNoLmlkZW50aWZpZXIgPSB0b3VjaC5pZGVudGlmaWVyIHx8IDA7XG5cbiAgICAgICAgdmFyIGFjdGl2ZSA9IHRoaXMuYWN0aXZlVG91Y2hlc1t0b3VjaC5pZGVudGlmaWVyXTtcblxuICAgICAgICBpZihhY3RpdmUpIHtcbiAgICAgICAgICBhY3RpdmUub2JqLnRyaWdnZXIoJ3RvdWNoRW5kJywgYWN0aXZlKTtcbiAgICAgICAgICBkZWxldGUgdGhpcy50b3VjaGVkT2JqZWN0c1thY3RpdmUub2JqLnAuaWRdO1xuICAgICAgICAgIHRoaXMuYWN0aXZlVG91Y2hlc1t0b3VjaC5pZGVudGlmaWVyXSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgfSk7XG5cbiAgUS50b3VjaCA9IGZ1bmN0aW9uKHR5cGUsc3RhZ2UpIHtcbiAgICBRLnVudG91Y2goKTtcbiAgICB0b3VjaFR5cGUgPSB0eXBlIHx8IFEuU1BSSVRFX1VJO1xuICAgIHRvdWNoU3RhZ2UgPSBzdGFnZSB8fCBbMiwxLDBdO1xuICAgIGlmKCFRLl9pc0FycmF5KHRvdWNoU3RhZ2UpKSB7XG4gICAgICB0b3VjaFN0YWdlID0gW3RvdWNoU3RhZ2VdO1xuICAgIH1cblxuICAgIGlmKCFRLl90b3VjaCkge1xuICAgICAgUS50b3VjaElucHV0ID0gbmV3IFEuVG91Y2hTeXN0ZW0oKTtcbiAgICB9XG4gICAgcmV0dXJuIFE7XG4gIH07XG5cbiAgUS51bnRvdWNoID0gZnVuY3Rpb24oKSB7XG4gICAgaWYoUS50b3VjaElucHV0KSB7XG4gICAgICBRLnRvdWNoSW5wdXQuZGVzdHJveSgpO1xuICAgICAgZGVsZXRlIFFbJ3RvdWNoSW5wdXQnXTtcbiAgICB9XG4gICAgcmV0dXJuIFE7XG4gIH07XG5cbn07XG4iLCIvKmdsb2JhbCBRdWludHVzOmZhbHNlICovXG5cblxuLyoqXG5RdWludHVzIEhUTUw1IEdhbWUgRW5naW5lIC0gVUkgTW9kdWxlXG5cblRoZSBjb2RlIGluIGBxdWludHVzX3VpLmpzYCBkZWZpbmVzIHRoZSBgUXVpbnR1cy5VSWAgbW9kdWxlLCB3aGljaFxuYWRkcyBpbiBzb21lIGVhc2lseSBhY2Nlc3NpYmxlIFVJIGVsZW1lbnRzIGludG8gUXVpbnR1cy5cblxuRGVwZW5kcyBvbiB0aGUgYFF1aW50dXMuU3ByaXRlYCBtb2R1bGUuXG5cblVJIGxldHMgeW91IGNyZWF0ZSBVSSBlbGVtZW50cyBsaWtlIGNvbnRhaW5lcnMsIGJ1dHRvbnMgYW5kIHRleHQgZWxlbWVudHMuXG5cbkBtb2R1bGUgUXVpbnR1cy5VSVxuKi9cblxuLyoqXG4gKiBRdWludHVzIFVJIE1vZHVsZSBDbGFzc1xuICpcbiAqIEBjbGFzcyBRdWludHVzLlVJXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oUSkge1xuICBpZihRLl9pc1VuZGVmaW5lZChRLm1vZHVsZXMuVG91Y2gpKSB7XG4gICAgdGhyb3cgXCJRdWludHVzLlVJIHJlcXVpcmVzIFF1aW50dXMuVG91Y2ggTW9kdWxlXCI7XG4gIH1cblxuICBRLlVJID0ge307XG5cbiAgLyoqXG4gICBEcmF3cyBhIHJvdW5kZWQgcmVjdGFuZ2xlIGNlbnRlcmVkIG9uIDAsMFxuXG4gICBPcHRpb25zIGZvciBgcmVjdGBcblxuICAgICAqIHJhZGl1cyAtIHJhZGl1cyBvZiB0aGUgcm91bmRlZCBjb3JuZXJzXG4gICAgICogdyAgICAgIC0gd2lkdGggb2YgdGhlIHJlY3RcbiAgICAgKiBoICAgICAgLSBoZWlnaHQgb2YgdGhlIHJlY3RcbiAgICAgKiBjeCAgICAgLSBYIGNvb3JkaW5hdGUgb2YgdG9wIGxlZnQgY29ybmVyXG4gICAgICogY3kgICAgIC0gWSBjb29yZGluYXRlIG9mIHRvcCBsZWZ0IGNvcm5lclxuXG4gICBAbWV0aG9kIHJvdW5kUmVjdFxuICAgQGZvciBRLlVJXG4gICBAcGFyYW0ge2NhbnZhcyBjb250ZXh0fSBjdHhcbiAgIEBwYXJhbSB7T2JqZWN0fSByZWN0IC1cbiAgICovXG4gIFEuVUkucm91bmRSZWN0ID0gZnVuY3Rpb24oY3R4LCByZWN0KSB7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8oLXJlY3QuY3ggKyByZWN0LnJhZGl1cywgLXJlY3QuY3kpO1xuICAgIGN0eC5saW5lVG8oLXJlY3QuY3ggKyByZWN0LncgLSByZWN0LnJhZGl1cywgLXJlY3QuY3kpO1xuICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKC1yZWN0LmN4ICsgcmVjdC53LCAtcmVjdC5jeSwgLXJlY3QuY3ggKyByZWN0LncsIC1yZWN0LmN5ICsgcmVjdC5yYWRpdXMpO1xuICAgIGN0eC5saW5lVG8oLXJlY3QuY3ggKyByZWN0LncsIC1yZWN0LmN5ICsgcmVjdC5oIC0gcmVjdC5yYWRpdXMpO1xuICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKC1yZWN0LmN4ICsgcmVjdC53LFxuICAgICAgICAgICAgICAgICAgICAgICAgIC1yZWN0LmN5ICsgcmVjdC5oLFxuICAgICAgICAgICAgICAgICAgICAgICAgIC1yZWN0LmN4ICsgcmVjdC53IC0gcmVjdC5yYWRpdXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgLXJlY3QuY3kgKyByZWN0LmgpO1xuICAgIGN0eC5saW5lVG8oLXJlY3QuY3ggKyByZWN0LnJhZGl1cywgLXJlY3QuY3kgKyByZWN0LmgpO1xuICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKC1yZWN0LmN4LCAtcmVjdC5jeSArIHJlY3QuaCwgLXJlY3QuY3gsIC1yZWN0LmN5ICsgcmVjdC5oIC0gcmVjdC5yYWRpdXMpO1xuICAgIGN0eC5saW5lVG8oLXJlY3QuY3gsIC1yZWN0LmN5ICsgcmVjdC5yYWRpdXMpO1xuICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKC1yZWN0LmN4LCAtcmVjdC5jeSwgLXJlY3QuY3ggKyByZWN0LnJhZGl1cywgLXJlY3QuY3kpO1xuICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgfTtcblxuICAvKipcbiAgIENyZWF0ZXMgYSBjb250YWluZXIgZm9yIFVJIGVsZW1lbnRzLlxuXG4gICBPcHRpb25zIGZvciBgcGAgYXJlIHZlcnkgc2ltaWxhciB0byB0aGUgb25lcyBmb3IgUS5TcHJpdGUuXG5cbiAgICAgKiBib3JkZXIgLSB3aWR0aCBvZiB0aGUgYm9yZGVyIFswXSAobm8gYm9yZGVyKVxuICAgICAqIHJhZGl1cyAtIHJhZGl1cyBvZiB0aGUgcm91bmRlZCBib3JkZXIgWzVdXG4gICAgICogc3Ryb2tlIC0gY29sb3Igb2YgdGhlIGJvcmRlciBbIzAwMF1cbiAgICAgKiB3ICAgICAgLSB3aWR0aCBvZiB0aGUgY29udGFpbmVyXG4gICAgICogaCAgICAgIC0gaGVpZ2h0IG9mIHRoZSBjb250YWluZXJcbiAgICAgKiB4ICAgICAgLSBYIGNvb3JkaW5hdGUgb2YgdG9wIGxlZnQgY29ybmVyXG4gICAgICogeSAgICAgIC0gWSBjb29yZGluYXRlIG9mIHRvcCBsZWZ0IGNvcm5lclxuICAgICAqIGZpbGwgICAtIGJhY2tncm91bmQgY29sb3IgW251bGxdXG4gICAgICogc2hhZG93IC0gaWYgdGhlIGNvbnRhaW5lciBzaG91bGQgaGF2ZSBhIHNoYWRvd1tmYWxzZV1cbiAgICAgKiBzaGFkb3dDb2xvciAtIGByZ2JgIHZhbHVlIG9mIHRoZSBzaGFkb3cgW2ZhbHNlXVxuXG4gICBAY2xhc3MgUS5VSS5Db250YWluZXJcbiAgIEBleHRlbmRzIFEuU3ByaXRlXG4gICBAZm9yIFEuVUlcbiAgIEBwYXJhbSB7T2JqZWN0fSBwIC0gYXMgZGVzY3JpYmVkIGFib3ZlXG4gICAqL1xuICBRLlVJLkNvbnRhaW5lciA9IFEuU3ByaXRlLmV4dGVuZChcIlVJLkNvbnRhaW5lclwiLCB7XG4gICAgaW5pdDogZnVuY3Rpb24ocCxkZWZhdWx0cykge1xuICAgICAgdmFyIGFkanVzdGVkUCA9IFEuX2Nsb25lKHB8fHt9KSxcbiAgICAgICAgICBtYXRjaDtcblxuICAgICAgaWYocCAmJiBRLl9pc1N0cmluZyhwLncpICYmIChtYXRjaCA9IHAudy5tYXRjaCgvXlswLTldKyUkLykpKSB7XG4gICAgICAgIGFkanVzdGVkUC53ID0gcGFyc2VJbnQocC53LDEwKSAqIFEud2lkdGggLyAxMDA7XG4gICAgICAgIGFkanVzdGVkUC54ID0gUS53aWR0aC8yIC0gYWRqdXN0ZWRQLncvMjtcbiAgICAgIH1cblxuICAgICAgaWYocCAmJiBRLl9pc1N0cmluZyhwLmgpICYmIChtYXRjaCA9IHAuaC5tYXRjaCgvXlswLTldKyUkLykpKSB7XG4gICAgICAgIGFkanVzdGVkUC5oID0gcGFyc2VJbnQocC5oLDEwKSAqIFEuaGVpZ2h0IC8gMTAwO1xuICAgICAgICBhZGp1c3RlZFAueSA9IFEuaGVpZ2h0IC8yIC0gYWRqdXN0ZWRQLmgvMjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fc3VwZXIoUS5fZGVmYXVsdHMoYWRqdXN0ZWRQLGRlZmF1bHRzKSx7XG4gICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgIGhpZGRlbjogZmFsc2UsIC8vIFNldCB0byB0cnVlIHRvIG5vdCBzaG93IHRoZSBjb250YWluZXJcbiAgICAgICAgZmlsbDogICBudWxsLCAvLyBTZXQgdG8gY29sb3IgdG8gYWRkIGJhY2tncm91bmRcbiAgICAgICAgaGlnaGxpZ2h0OiAgIG51bGwsIC8vIFNldCB0byBjb2xvciB0byBmb3IgYnV0dG9uXG4gICAgICAgIHJhZGl1czogNSwgLy8gQm9yZGVyIHJhZGl1c1xuICAgICAgICBzdHJva2U6IFwiIzAwMFwiLFxuICAgICAgICBib3JkZXI6IGZhbHNlLCAvLyBTZXQgdG8gYSB3aWR0aCB0byBzaG93IGEgYm9yZGVyXG4gICAgICAgIHNoYWRvdzogZmFsc2UsIC8vIFNldCB0byB0cnVlIG9yIGEgc2hhZG93IG9mZmVzdFxuICAgICAgICBzaGFkb3dDb2xvcjogZmFsc2UsIC8vIFNldCB0byBhIHJnYmEgdmFsdWUgZm9yIHRoZSBzaGFkb3dcbiAgICAgICAgb3V0bGluZVdpZHRoOiBmYWxzZSwgLy8gU2V0IHRvIGEgd2lkdGggdG8gb3V0bGluZSB0ZXh0XG4gICAgICAgIG91dGxpbmVDb2xvcjogXCIjMDAwXCIsXG4gICAgICAgIHR5cGU6IFEuU1BSSVRFX05PTkVcbiAgICAgIH0pO1xuXG4gICAgfSxcblxuICAgIC8qKlxuICAgICBJbnNlcnRzIGFuIG9iamVjdCBpbnRvIHRoZSBjb250YWluZXIuXG4gICAgIFRoZSBvYmplY3QgY2FuIGxhdGVyIGFjY2Vzc2VkIHZpYSBgY2hpbGRyZW5gIHByb3BlcnR5IG9mIHRoZSBjb250YWluZXIuXG5cbiAgICAgQG1ldGhvZCBpbnNlcnRcbiAgICAgQGZvciBRLlVJLkNvbnRhaW5lclxuICAgICBAcGFyYW0ge1EuR2FtZU9iamVjdH0gb2JqIC0gdGhlIEl0ZW0gdG8gaW5zZXJ0XG4gICAgIEByZXR1cm4gdGhlIGluc2VydGVkIG9iamVjdCBmb3IgY2hhaW5pbmdcbiAgICAqL1xuICAgIGluc2VydDogZnVuY3Rpb24ob2JqKSB7XG4gICAgICB0aGlzLnN0YWdlLmluc2VydChvYmosdGhpcyk7XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgRml0cyB0aGUgY29udGFpbmVycyBzaXplIGRlcGVuZGluZyBvbiBpdHMgY2hpbGRyZW4uXG5cbiAgICAgQG1ldGhvZCBmaXRcbiAgICAgQGZvciBRLlVJLkNvbnRhaW5lclxuICAgICBAcGFyYW0ge051bWJlcn0gcGFkZGluZ1kgLSB2ZXJ0aWNhbCBwYWRkaW5nXG4gICAgIEBwYXJhbSB7TnVtYmVyfSBwYWRkaW5nWCAtIGhvcml6b250YWwgcGFkZGluZ1xuICAgICBAcmV0dXJuIHRoZSBpbnNlcnRlZCBvYmplY3QgZm9yIGNoYWluaW5nXG4gICAgKi9cbiAgICBmaXQ6IGZ1bmN0aW9uKHBhZGRpbmdZLHBhZGRpbmdYKSB7XG4gICAgICBpZih0aGlzLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cblxuICAgICAgaWYocGFkZGluZ1kgPT09IHZvaWQgMCkgeyBwYWRkaW5nWSA9IDA7IH1cbiAgICAgIGlmKHBhZGRpbmdYID09PSB2b2lkIDApIHsgcGFkZGluZ1ggPSBwYWRkaW5nWTsgfVxuXG4gICAgICB2YXIgbWluWCA9IEluZmluaXR5LFxuICAgICAgICAgIG1pblkgPSBJbmZpbml0eSxcbiAgICAgICAgICBtYXhYID0gLUluZmluaXR5LFxuICAgICAgICAgIG1heFkgPSAtSW5maW5pdHk7XG5cbiAgICAgIGZvcih2YXIgaSA9MDtpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7aSsrKSB7XG4gICAgICAgIHZhciBvYmogPSB0aGlzLmNoaWxkcmVuW2ldO1xuICAgICAgICB2YXIgbWluT2JqWCA9IG9iai5wLnggLSBvYmoucC5jeCxcbiAgICAgICAgICAgIG1pbk9ialkgPSBvYmoucC55IC0gb2JqLnAuY3ksXG4gICAgICAgICAgICBtYXhPYmpYID0gb2JqLnAueCAtIG9iai5wLmN4ICsgb2JqLnAudyxcbiAgICAgICAgICAgIG1heE9ialkgPSBvYmoucC55IC0gb2JqLnAuY3kgKyBvYmoucC5oO1xuXG4gICAgICAgIGlmKG1pbk9ialggPCBtaW5YKSB7IG1pblggPSBtaW5PYmpYOyB9XG4gICAgICAgIGlmKG1pbk9ialkgPCBtaW5ZKSB7IG1pblkgPSBtaW5PYmpZOyB9XG5cbiAgICAgICAgaWYobWF4T2JqWCA+IG1heFgpIHsgbWF4WCA9IG1heE9ialg7IH1cbiAgICAgICAgaWYobWF4T2JqWSA+IG1heFkpIHsgbWF4WSA9IG1heE9ialk7IH1cblxuICAgICAgfVxuXG4gICAgICB0aGlzLnAuY3ggPSAtbWluWCArIHBhZGRpbmdYO1xuICAgICAgdGhpcy5wLmN5ID0gLW1pblkgKyBwYWRkaW5nWTtcbiAgICAgIHRoaXMucC53ID0gbWF4WCAtIG1pblggKyBwYWRkaW5nWCAqIDI7XG4gICAgICB0aGlzLnAuaCA9IG1heFkgLSBtaW5ZICsgcGFkZGluZ1kgKiAyO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgQWRkcyB0aGUgc2hhZG93IHNwZWNpZmllZCBpbiBgcGAgdG8gdGhlIGNvbnRhaW5lci5cblxuICAgICBAbWV0aG9kIGFkZFNoYWRvd1xuICAgICBAcGFyYW0ge2NhbnZhcyBjb250ZXh0fSBjdHggLSB0aGUgY2FudmFzIGNvbnRleHRcbiAgICAgQGZvciBRLlVJLkNvbnRhaW5lclxuICAgICovXG4gICAgYWRkU2hhZG93OiBmdW5jdGlvbihjdHgpIHtcbiAgICAgIGlmKHRoaXMucC5zaGFkb3cpIHtcbiAgICAgICAgdmFyIHNoYWRvd0Ftb3VudCA9IFEuX2lzTnVtYmVyKHRoaXMucC5zaGFkb3cpID8gdGhpcy5wLnNoYWRvdyA6IDU7XG4gICAgICAgIGN0eC5zaGFkb3dPZmZzZXRYPXNoYWRvd0Ftb3VudDtcbiAgICAgICAgY3R4LnNoYWRvd09mZnNldFk9c2hhZG93QW1vdW50O1xuICAgICAgICBjdHguc2hhZG93Q29sb3IgPSB0aGlzLnAuc2hhZG93Q29sb3IgfHwgXCJyZ2JhKDAsMCw1MCwwLjEpXCI7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICBTZXRzIHRoZSBzaGFkb3dzIGNvbG9yIHRvIGB0cmFuc3BhcmVudGAuXG5cbiAgICAgQG1ldGhvZCBjbGVhclNoYWRvd1xuICAgICBAcGFyYW0ge2NhbnZhcyBjb250ZXh0fSBjdHggLSB0aGUgY2FudmFzIGNvbnRleHRcbiAgICAgQGZvciBRLlVJLkNvbnRhaW5lclxuICAgICovXG4gICAgY2xlYXJTaGFkb3c6IGZ1bmN0aW9uKGN0eCkge1xuICAgICAgY3R4LnNoYWRvd0NvbG9yID0gXCJ0cmFuc3BhcmVudFwiO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKHJlKURyYXdzIHRoZSByb3VuZGVkUmVjdCB3aXRoIHNoYWRvdyBhbmQgYm9yZGVyIG9mIHRoZSBjb250YWluZXIuXG5cbiAgICAgQG1ldGhvZCBkcmF3UmFkaXVzXG4gICAgIEBwYXJhbSB7Y2FudmFzIGNvbnRleHR9IGN0eCAtIHRoZSBjYW52YXMgY29udGV4dFxuICAgICBAZm9yIFEuVUkuQ29udGFpbmVyXG4gICAgKi9cbiAgICBkcmF3UmFkaXVzOiBmdW5jdGlvbihjdHgpIHtcbiAgICAgIFEuVUkucm91bmRSZWN0KGN0eCx0aGlzLnApO1xuICAgICAgdGhpcy5hZGRTaGFkb3coY3R4KTtcbiAgICAgIGN0eC5maWxsKCk7XG4gICAgICBpZih0aGlzLnAuYm9yZGVyKSB7XG4gICAgICAgIHRoaXMuY2xlYXJTaGFkb3coY3R4KTtcbiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IHRoaXMucC5ib3JkZXI7XG4gICAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgZHJhd1NxdWFyZTogZnVuY3Rpb24oY3R4KSB7XG4gICAgICB0aGlzLmFkZFNoYWRvdyhjdHgpO1xuICAgICAgaWYodGhpcy5wLmZpbGwpIHtcbiAgICAgICAgY3R4LmZpbGxSZWN0KC10aGlzLnAuY3gsLXRoaXMucC5jeSxcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnAudyx0aGlzLnAuaCk7XG4gICAgICB9XG5cbiAgICAgIGlmKHRoaXMucC5ib3JkZXIpIHtcbiAgICAgICAgdGhpcy5jbGVhclNoYWRvdyhjdHgpO1xuICAgICAgICBjdHgubGluZVdpZHRoID0gdGhpcy5wLmJvcmRlcjtcbiAgICAgICAgY3R4LnN0cm9rZVJlY3QoLXRoaXMucC5jeCwtdGhpcy5wLmN5LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wLncsdGhpcy5wLmgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBkcmF3OiBmdW5jdGlvbihjdHgpIHtcbiAgICAgIGlmKHRoaXMucC5oaWRkZW4pIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgICBpZighdGhpcy5wLmJvcmRlciAmJiAhdGhpcy5wLmZpbGwpIHsgcmV0dXJuOyB9XG5cbiAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IHRoaXMucC5vcGFjaXR5O1xuICAgICAgaWYodGhpcy5wLmZyYW1lID09PSAxICYmIHRoaXMucC5oaWdobGlnaHQpIHtcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMucC5oaWdobGlnaHQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5wLmZpbGw7XG4gICAgICB9XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLnAuc3Ryb2tlO1xuXG4gICAgICBpZih0aGlzLnAucmFkaXVzID4gMCkge1xuICAgICAgICB0aGlzLmRyYXdSYWRpdXMoY3R4KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZHJhd1NxdWFyZShjdHgpO1xuICAgICAgfVxuXG4gICAgfVxuICB9KTtcblxuXG4gIC8qKlxuICAgQ3JlYXRlcyBhIFRleHQtVUkgZWxlbWVudC5cblxuICAgT3B0aW9ucyBmb3IgYHBgIGFyZSB2ZXJ5IHNpbWlsYXIgdG8gdGhlIG9uZXMgZm9yIFEuU3ByaXRlLlxuXG4gICAgICogbGFiZWwgICAgICAgIC0gdGV4dCB0byBkaXNwbGF5XG4gICAgICogd2VpZ2h0ICAgICAgIC0gd2VpZ2h0IG9mIHRoZSB0ZXh0IFs4MDBdXG4gICAgICogc2l6ZSAgICAgICAgIC0gc2l6ZSBvZiB0aGUgdGV4dCBpbiBweCBbMjRdXG4gICAgICogYWxpZ24gICAgICAgIC0gaG9yaXpvbnRhbCBhbGlnbm1lbnQgb2YgdGhlIHRleHQgW2xlZnRdXG4gICAgICogZmFtaWx5ICAgICAgIC0gZm9udCBmYW1pbHkgW0FyaWFsXVxuICAgICAqIGNvbG9yICAgICAgICAtIGNvbG9yIG9mIHRoZSB0ZXh0IFtibGFja11cbiAgICAgKiBvdXRsaW5lICAgICAgLSBvdXRsaW5lIGNvbG9yIG9mIHRoZSB0ZXh0IFtibGFja11cbiAgICAgKiBvdXRsaW5lV2lkdGggLSB0aGlja25lc3Mgb2YgdGhlIG91dGxpbmUgWzBdXG5cbiAgIEBjbGFzcyBRLlVJLlRleHRcbiAgIEBleHRlbmRzIFEuU3ByaXRlXG4gICBAZm9yIFEuVUlcbiAgIEBwYXJhbSB7T2JqZWN0fSBwIC0gYXMgZGVzY3JpYmVkIGFib3ZlXG4gICAqL1xuICBRLlVJLlRleHQgPSBRLlNwcml0ZS5leHRlbmQoXCJVSS5UZXh0XCIsIHtcbiAgICBpbml0OiBmdW5jdGlvbihwLGRlZmF1bHRQcm9wcykge1xuICAgICAgdGhpcy5fc3VwZXIoUS5fZGVmYXVsdHMocHx8e30sZGVmYXVsdFByb3BzKSx7XG4gICAgICAgIHR5cGU6IFEuU1BSSVRFX1VJLFxuICAgICAgICBzaXplOiAyNFxuICAgICAgfSk7XG5cbiAgICAgIC8vdGhpcy5lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICAvL3RoaXMuY3R4ID0gdGhpcy5lbC5nZXRDb250ZXh0KFwiMmRcIik7XG5cbiAgICAgIGlmKHRoaXMucC5sYWJlbCkge1xuICAgICAgICB0aGlzLmNhbGNTaXplKCk7XG4gICAgICB9XG5cbiAgICAgIC8vdGhpcy5wcmVyZW5kZXIoKTtcbiAgICB9LFxuXG4gICAgY2FsY1NpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zZXRGb250KFEuY3R4KTtcbiAgICAgIHRoaXMuc3BsaXRMYWJlbCA9IHRoaXMucC5sYWJlbC5zcGxpdChcIlxcblwiKTtcbiAgICAgIHZhciBtYXhMYWJlbCA9IFwiXCI7XG4gICAgICBmb3IodmFyIGkgPSAwO2kgPCB0aGlzLnNwbGl0TGFiZWwubGVuZ3RoO2krKykge1xuICAgICAgICBpZih0aGlzLnNwbGl0TGFiZWxbaV0ubGVuZ3RoID4gbWF4TGFiZWwubGVuZ3RoKSB7XG4gICAgICAgICAgbWF4TGFiZWwgPSB0aGlzLnNwbGl0TGFiZWxbaV07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIG1ldHJpY3MgPSBRLmN0eC5tZWFzdXJlVGV4dChtYXhMYWJlbCk7XG4gICAgICB0aGlzLnAuaCA9ICh0aGlzLnAuc2l6ZSB8fCAyNCkgKiB0aGlzLnNwbGl0TGFiZWwubGVuZ3RoICogMS4yO1xuICAgICAgdGhpcy5wLncgPSBtZXRyaWNzLndpZHRoO1xuICAgICAgdGhpcy5wLmN4ID0gdGhpcy5wLncgLyAyO1xuICAgICAgdGhpcy5wLmN5ID0gdGhpcy5wLmggLyAyO1xuICAgIH0sXG5cbiAgICBwcmVyZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYodGhpcy5wLm9sZExhYmVsID09PSB0aGlzLnAubGFiZWwpIHsgcmV0dXJuOyB9XG4gICAgICB0aGlzLnAub2xkTGFiZWwgPSB0aGlzLnAubGFiZWw7XG4gICAgICB0aGlzLmNhbGNTaXplKCk7XG4gICAgICB0aGlzLmVsLndpZHRoID0gdGhpcy5wLnc7XG4gICAgICB0aGlzLmVsLmhlaWdodCA9IHRoaXMucC5oICogNDtcbiAgICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLDAsdGhpcy5wLncsdGhpcy5wLmgpO1xuXG4gICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBcIiNGRjBcIjtcbiAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDAsMCx0aGlzLnAudyx0aGlzLnAuaC8yKTtcbiAgICAgIHRoaXMuc2V0Rm9udCh0aGlzLmN0eCk7XG5cbiAgICAgIHRoaXMuY3R4LmZpbGxUZXh0KHRoaXMucC5sYWJlbCwwLDApO1xuICAgIH0sXG5cbiAgICBkcmF3OiBmdW5jdGlvbihjdHgpIHtcbiAgICAgICAvL3RoaXMucHJlcmVuZGVyKCk7XG4gICAgICBpZih0aGlzLnAub3BhY2l0eSA9PT0gMCkgeyByZXR1cm47IH1cblxuICAgICAgaWYodGhpcy5wLm9sZExhYmVsICE9PSB0aGlzLnAubGFiZWwpIHsgdGhpcy5jYWxjU2l6ZSgpOyB9XG5cbiAgICAgIHRoaXMuc2V0Rm9udChjdHgpO1xuICAgICAgaWYodGhpcy5wLm9wYWNpdHkgIT09IHZvaWQgMCkgeyBjdHguZ2xvYmFsQWxwaGEgPSB0aGlzLnAub3BhY2l0eTsgfVxuICAgICAgZm9yKHZhciBpID0wO2k8dGhpcy5zcGxpdExhYmVsLmxlbmd0aDtpKyspIHtcbiAgICAgICAgaWYodGhpcy5wLmFsaWduID09PSAnY2VudGVyJykge1xuICAgICAgICAgIGlmKHRoaXMucC5vdXRsaW5lV2lkdGgpIHtcbiAgICAgICAgICAgIGN0eC5zdHJva2VUZXh0KHRoaXMuc3BsaXRMYWJlbFtpXSwwLC10aGlzLnAuY3kgKyBpICogdGhpcy5wLnNpemUgKiAxLjIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdHguZmlsbFRleHQodGhpcy5zcGxpdExhYmVsW2ldLDAsLXRoaXMucC5jeSArIGkgKiB0aGlzLnAuc2l6ZSAqIDEuMik7XG4gICAgICAgIH0gZWxzZSBpZih0aGlzLnAuYWxpZ24gPT09ICdyaWdodCcpIHtcbiAgICAgICAgICBpZih0aGlzLnAub3V0bGluZVdpZHRoKSB7XG4gICAgICAgICAgICBjdHguc3Ryb2tlVGV4dCh0aGlzLnNwbGl0TGFiZWxbaV0sdGhpcy5wLmN4LC10aGlzLnAuY3kgKyBpICogdGhpcy5wLnNpemUgKiAxLjIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdHguZmlsbFRleHQodGhpcy5zcGxpdExhYmVsW2ldLHRoaXMucC5jeCwtdGhpcy5wLmN5ICsgaSAqIHRoaXMucC5zaXplICogMS4yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZih0aGlzLnAub3V0bGluZVdpZHRoKSB7XG4gICAgICAgICAgICBjdHguc3Ryb2tlVGV4dCh0aGlzLnNwbGl0TGFiZWxbaV0sLXRoaXMucC5jeCwtdGhpcy5wLmN5ICtpICogdGhpcy5wLnNpemUgKiAxLjIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdHguZmlsbFRleHQodGhpcy5zcGxpdExhYmVsW2ldLC10aGlzLnAuY3gsLXRoaXMucC5jeSAraSAqIHRoaXMucC5zaXplICogMS4yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgUmV0dXJucyB0aGUgYXNzZXQgb2YgdGhlIGVsZW1lbnRcblxuICAgICBAbWV0aG9kIGFzc2V0XG4gICAgIEBmb3IgUS5VSS5UZXh0XG4gICAgKi9cbiAgICBhc3NldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5lbDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIFNldHMgdGhlIHRleHRmb250IHVzaW5nIHBhcmFtZXRlcnMgb2YgYHBgLlxuICAgICBEZWZhdWx0czogc2VlIENsYXNzIGRlc2NyaXB0aW9uIVxuXG4gICAgIEBtZXRob2Qgc2V0Rm9udFxuICAgICBAZm9yIFEuVUkuVGV4dFxuICAgICovXG4gICAgc2V0Rm9udDogZnVuY3Rpb24oY3R4KSB7XG4gICAgICBjdHgudGV4dEJhc2VsaW5lID0gXCJ0b3BcIjtcbiAgICAgIGN0eC5mb250PSB0aGlzLmZvbnQoKTtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLnAuY29sb3IgfHwgXCJibGFja1wiO1xuICAgICAgY3R4LnRleHRBbGlnbiA9IHRoaXMucC5hbGlnbiB8fCBcImxlZnRcIjtcbiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHRoaXMucC5vdXRsaW5lQ29sb3IgfHwgXCJibGFja1wiO1xuICAgICAgY3R4LmxpbmVXaWR0aCA9IHRoaXMucC5vdXRsaW5lV2lkdGggfHwgMDtcbiAgICB9LFxuXG4gICAgZm9udDogZnVuY3Rpb24oKSB7XG4gICAgICBpZih0aGlzLmZvbnRTdHJpbmcpIHsgcmV0dXJuIHRoaXMuZm9udFN0cmluZzsgfVxuXG4gICAgICB0aGlzLmZvbnRTdHJpbmcgPSAodGhpcy5wLndlaWdodCB8fCBcIjgwMFwiKSArIFwiIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnAuc2l6ZSB8fCAyNCkgKyBcInB4IFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLnAuZmFtaWx5IHx8IFwiQXJpYWxcIik7XG5cbiAgICAgIHJldHVybiB0aGlzLmZvbnRTdHJpbmc7XG4gICAgfVxuXG4gIH0pO1xuXG5cbiAgLyoqXG4gICBDcmVhdGVzIGEgQnV0dG9uLVVJIGVsZW1lbnQgdGhhdCBjYW4gYmUgcHJlc3NlZC90b3VjaGVkLlxuICAgV2hlbiBgdG91Y2hgIHN0YXJ0cywgaXQgaXMgaGlnaGxpZ2h0ZWQuXG4gICBXaGVuIGB0b3VjaEVuZGAgaXMgdHJpZ2dlcmVkLCB0aGUgYnV0dG9uIGNhbGxzIHRoZSBgY2FsbGJhY2tgIGZ1bmN0aW9uIGFuZCB0cmlnZ2VycyBhIGBjbGlja2AgZXZlbnQuXG4gICBDYW4gYmUgZ2l2ZW4gYSBga2V5QWN0aW9uTmFtZWAuIElmIHNvLCB0aGUgYnV0dG9uIGxpc3RlbnMgZm9yIGBrZXlkb3duYC10cmlnZ2VycyBvZiB0aGlzIGtleS5cblxuICAgT3B0aW9ucyBmb3IgYHBgIGFyZSB2ZXJ5IHNpbWlsYXIgdG8gdGhlIG9uZXMgZm9yIFEuVUkuQ29udGFpbmVyIGFuZCBRLlVJLlRleHQuXG5cbiAgICAgKiBsYWJlbCAgICAgICAgIC0gdGV4dCB0byBkaXNwbGF5XG4gICAgICoga2V5QWN0aW9uTmFtZSAtIF9zZWUgYWJvdmVfXG4gICAgICogZm9udCAgICAgICAgICAtIGZvbnQgZm9yIHRleHQgW3dlaWd0aDogNDAwLCBzaXplOiAyNHB4LCBmYW1pbHk6IGFyaWFsXVxuXG4gICBAY2xhc3MgUS5VSS5CdXR0b25cbiAgIEBleHRlbmRzIFEuQ29udGFpbmVyXG4gICBAZm9yIFEuVUlcbiAgIEBwYXJhbSB7T2JqZWN0fSBwIC0gYXMgZGVzY3JpYmVkIGFib3ZlXG4gICBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAtIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBvbiBgcHVzaGAgb3IgYHRvdWNoYFxuICAgQHBhcmFtIHtPYmplY3R9IGRlZmF1bHRQcm9wcyAtIGNvdWxkIGJlIHVzZWQgdG8gb3ZlcndyaXRlIGRlZmF1bHQgcHJvcGVydGllcywgb3RoZXJ3aXNlIHVzZXMgdGhlIG9uZXMgb2YgUS5TcHJpdGVcbiAgICovXG4gIFEuVUkuQnV0dG9uID0gUS5VSS5Db250YWluZXIuZXh0ZW5kKFwiVUkuQnV0dG9uXCIsIHtcbiAgICBpbml0OiBmdW5jdGlvbihwLCBjYWxsYmFjaywgZGVmYXVsdFByb3BzKSB7XG4gICAgICB0aGlzLl9zdXBlcihRLl9kZWZhdWx0cyhwfHx7fSxkZWZhdWx0UHJvcHMpLHtcbiAgICAgICAgdHlwZTogUS5TUFJJVEVfVUkgfCBRLlNQUklURV9ERUZBVUxULFxuICAgICAgICBrZXlBY3Rpb25OYW1lOiBudWxsXG4gICAgICB9KTtcbiAgICAgIGlmKHRoaXMucC5sYWJlbCAmJiAoIXRoaXMucC53IHx8ICF0aGlzLnAuaCkpIHtcbiAgICAgICAgUS5jdHguc2F2ZSgpO1xuICAgICAgICB0aGlzLnNldEZvbnQoUS5jdHgpO1xuICAgICAgICB2YXIgbWV0cmljcyA9IFEuY3R4Lm1lYXN1cmVUZXh0KHRoaXMucC5sYWJlbCk7XG4gICAgICAgIFEuY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgaWYoIXRoaXMucC5oKSB7ICB0aGlzLnAuaCA9IDI0ICsgMjA7IH1cbiAgICAgICAgaWYoIXRoaXMucC53KSB7IHRoaXMucC53ID0gbWV0cmljcy53aWR0aCArIDIwOyB9XG4gICAgICB9XG5cbiAgICAgIGlmKGlzTmFOKHRoaXMucC5jeCkpIHsgdGhpcy5wLmN4ID0gdGhpcy5wLncgLyAyOyB9XG4gICAgICBpZihpc05hTih0aGlzLnAuY3kpKSB7IHRoaXMucC5jeSA9IHRoaXMucC5oIC8gMjsgfVxuICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgdGhpcy5vbigndG91Y2gnLHRoaXMsXCJoaWdobGlnaHRcIik7XG4gICAgICB0aGlzLm9uKCd0b3VjaEVuZCcsdGhpcyxcInB1c2hcIik7XG4gICAgICBpZih0aGlzLnAua2V5QWN0aW9uTmFtZSkge1xuICAgICAgICBRLmlucHV0Lm9uKHRoaXMucC5rZXlBY3Rpb25OYW1lLHRoaXMsXCJwdXNoXCIpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBoaWdobGlnaHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYodHlwZW9mIHRoaXMuc2hlZXQoKSAhPT0gJ3VuZGVmaW5lZCcgJiYgdGhpcy5zaGVldCgpLmZyYW1lcyA+IDEpIHtcbiAgICAgICAgdGhpcy5wLmZyYW1lID0gMTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgcHVzaDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnAuZnJhbWUgPSAwO1xuICAgICAgaWYodGhpcy5jYWxsYmFjaykgeyB0aGlzLmNhbGxiYWNrKCk7IH1cbiAgICAgIHRoaXMudHJpZ2dlcignY2xpY2snKTtcbiAgICB9LFxuXG4gICAgZHJhdzogZnVuY3Rpb24oY3R4KSB7XG4gICAgICB0aGlzLl9zdXBlcihjdHgpO1xuXG4gICAgICBpZih0aGlzLnAuYXNzZXQgfHwgdGhpcy5wLnNoZWV0KSB7XG4gICAgICAgIFEuU3ByaXRlLnByb3RvdHlwZS5kcmF3LmNhbGwodGhpcyxjdHgpO1xuICAgICAgfVxuXG4gICAgICBpZih0aGlzLnAubGFiZWwpIHtcbiAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgdGhpcy5zZXRGb250KGN0eCk7XG4gICAgICAgIGN0eC5maWxsVGV4dCh0aGlzLnAubGFiZWwsMCwwKTtcbiAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgIFNldHMgdGhlIHRleHRmb250IHVzaW5nIHBhcmFtZXRlcnMgb2YgYHBgLlxuICAgICBEZWZhdWx0czogc2VlIENsYXNzIGRlc2NyaXB0aW9uIVxuXG4gICAgIEBtZXRob2Qgc2V0Rm9udFxuICAgICBAZm9yIFEuVUkuQnV0dG9uXG4gICAgKi9cbiAgICBzZXRGb250OiBmdW5jdGlvbihjdHgpIHtcbiAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSBcIm1pZGRsZVwiO1xuICAgICAgY3R4LmZvbnQgPSB0aGlzLnAuZm9udCB8fCBcIjQwMCAyNHB4IGFyaWFsXCI7XG4gICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5wLmZvbnRDb2xvciB8fCBcImJsYWNrXCI7XG4gICAgICBjdHgudGV4dEFsaWduID0gXCJjZW50ZXJcIjtcbiAgICB9XG5cbiAgfSk7XG5cbiAgLyoqXG4gICBDcmVhdGVzIGEgaHRtbC1pZnJhbWUgaW4gdGhlIGh0bWwtZG9jdW1lbnQuXG4gICBJdCBoYXMgYWxsIG90aGVyIGNhcGFiaWxpdGllcyBvZiBRLlNwcml0ZS5cbiAgIChkZWZhdWx0KSBQcm9wZXJ0aWVzIG9mIHRoZSBodG1sLWVsZW1lbnQ6XG5cbiAgICAgKiBzdHlsZS5wb3NpdGlvbjogYWJvc2x1dGVcbiAgICAgKiBzdHlsZS56SW5kZXg6IDUwMFxuICAgICAqIEF0dHJpYnV0ZSBmcmFtZWJvcmRlcjogMFxuXG4gICBPcHRpb25zIHZpYSBgcGA6XG5cbiAgICAgKiB1cmwgLSBzcmMgZm9yIGlmcmFtZVxuICAgICAqIHcgICAtIHdpZHRoIG9mIHRoZSBpZnJhbWVcbiAgICAgKiBoICAgLSBoZWlnaHQgb2YgdGhlIGlmcmFtZVxuXG4gICBAY2xhc3MgUS5VSS5JRnJhbWVcbiAgIEBleHRlbmRzIFEuU3ByaXRlXG4gICBAZm9yIFEuVUlcbiAgICovXG4gIFEuVUkuSUZyYW1lID0gUS5TcHJpdGUuZXh0ZW5kKFwiVUkuSUZyYW1lXCIsIHtcbiAgICBpbml0OiBmdW5jdGlvbihwKSB7XG4gICAgICB0aGlzLl9zdXBlcihwLCB7IG9wYWNpdHk6IDEsIHR5cGU6IFEuU1BSSVRFX1VJIHwgUS5TUFJJVEVfREVGQVVMVCB9KTtcblxuICAgICAgUS53cmFwcGVyLnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcblxuICAgICAgdGhpcy5pZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiSUZSQU1FXCIpO1xuICAgICAgdGhpcy5pZnJhbWUuc2V0QXR0cmlidXRlKFwic3JjXCIsdGhpcy5wLnVybCk7XG4gICAgICB0aGlzLmlmcmFtZS5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICAgIHRoaXMuaWZyYW1lLnN0eWxlLnpJbmRleCA9IDUwMDtcbiAgICAgIHRoaXMuaWZyYW1lLnNldEF0dHJpYnV0ZShcIndpZHRoXCIsdGhpcy5wLncpO1xuICAgICAgdGhpcy5pZnJhbWUuc2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIsdGhpcy5wLmgpO1xuICAgICAgdGhpcy5pZnJhbWUuc2V0QXR0cmlidXRlKFwiZnJhbWVib3JkZXJcIiwwKTtcblxuICAgICAgaWYodGhpcy5wLmJhY2tncm91bmQpIHtcbiAgICAgICAgdGhpcy5pZnJhbWUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gdGhpcy5wLmJhY2tncm91bmQ7XG4gICAgICB9XG5cbiAgICAgIFEud3JhcHBlci5hcHBlbmRDaGlsZCh0aGlzLmlmcmFtZSk7XG4gICAgICB0aGlzLm9uKFwiaW5zZXJ0ZWRcIixmdW5jdGlvbihwYXJlbnQpIHtcbiAgICAgICAgdGhpcy5wb3NpdGlvbklGcmFtZSgpO1xuICAgICAgICBwYXJlbnQub24oXCJkZXN0cm95ZWRcIix0aGlzLFwicmVtb3ZlXCIpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIHBvc2l0aW9uSUZyYW1lOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciB4ID0gdGhpcy5wLng7XG4gICAgICB2YXIgeSA9IHRoaXMucC55O1xuICAgICAgaWYodGhpcy5zdGFnZS52aWV3cG9ydCkge1xuICAgICAgICB4IC09IHRoaXMuc3RhZ2Uudmlld3BvcnQueDtcbiAgICAgICAgeSAtPSB0aGlzLnN0YWdlLnZpZXdwb3J0Lnk7XG4gICAgICB9XG5cbiAgICAgIGlmKHRoaXMub2xkWCAhPT0geCB8fCB0aGlzLm9sZFkgIT09IHkgfHwgdGhpcy5vbGRPcGFjaXR5ICE9PSB0aGlzLnAub3BhY2l0eSkge1xuXG4gICAgICAgIHRoaXMuaWZyYW1lLnN0eWxlLnRvcCA9ICh5IC0gdGhpcy5wLmN5KSArIFwicHhcIjtcbiAgICAgICAgdGhpcy5pZnJhbWUuc3R5bGUubGVmdCA9ICh4IC0gdGhpcy5wLmN4KSArIFwicHhcIjtcbiAgICAgICAgdGhpcy5pZnJhbWUuc3R5bGUub3BhY2l0eSA9IHRoaXMucC5vcGFjaXR5O1xuXG4gICAgICAgIHRoaXMub2xkWCA9IHg7XG4gICAgICAgIHRoaXMub2xkWSA9IHk7XG4gICAgICAgIHRoaXMub2xkT3BhY2l0eSA9IHRoaXMucC5vcGFjaXR5O1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBzdGVwOiBmdW5jdGlvbihkdCkge1xuICAgICAgdGhpcy5fc3VwZXIoZHQpO1xuICAgICAgdGhpcy5wb3NpdGlvbklGcmFtZSgpO1xuICAgIH0sXG5cbiAgICByZW1vdmU6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYodGhpcy5pZnJhbWUpIHtcbiAgICAgICAgUS53cmFwcGVyLnJlbW92ZUNoaWxkKHRoaXMuaWZyYW1lKTtcbiAgICAgICAgdGhpcy5pZnJhbWUgPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICBDcmVhdGVzIGEgZGl2LUhlbGVtZW50IGluIHRoZSBodG1sLWRvY3VtZW50IHdpdGggZ2l2ZW4gaW5uZXJIVE1MLlxuICAgSXQgaGFzIGFsbCBvdGhlciBjYXBhYmlsaXRpZXMgb2YgUS5TcHJpdGUuXG5cbiAgIE9wdGlvbiB2aWEgYHBgOlxuXG4gICAgICogaHRtbCAtIGlubmVySFRNTCBvZiB0aGUgZGl2XG5cbiAgIEBjbGFzcyBRLlVJLkhUTUxFbGVtZW50XG4gICBAZXh0ZW5kcyBRLlNwcml0ZVxuICAgQGZvciBRLlVJXG4gICAqL1xuICBRLlVJLkhUTUxFbGVtZW50ID0gUS5TcHJpdGUuZXh0ZW5kKFwiVUkuSFRNTEVsZW1lbnRcIiwge1xuICAgIGluaXQ6IGZ1bmN0aW9uKHApIHtcbiAgICAgIHRoaXMuX3N1cGVyKHAsIHsgb3BhY2l0eTogMSwgdHlwZTogUS5TUFJJVEVfVUkgIH0pO1xuXG4gICAgICBRLndyYXBwZXIuc3R5bGUub3ZlcmZsb3cgPSBcImhpZGRlblwiO1xuXG4gICAgICB0aGlzLmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gdGhpcy5wLmh0bWw7XG5cbiAgICAgIFEud3JhcHBlci5hcHBlbmRDaGlsZCh0aGlzLmVsKTtcbiAgICAgIHRoaXMub24oXCJpbnNlcnRlZFwiLGZ1bmN0aW9uKHBhcmVudCkge1xuICAgICAgICB0aGlzLnBvc2l0aW9uKCk7XG4gICAgICAgIHBhcmVudC5vbihcImRlc3Ryb3llZFwiLHRoaXMsXCJyZW1vdmVcIik7XG4gICAgICAgIHBhcmVudC5vbihcImNsZWFyXCIsdGhpcyxcInJlbW92ZVwiKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBwb3NpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgfSxcblxuICAgIHN0ZXA6IGZ1bmN0aW9uKGR0KSB7XG4gICAgICB0aGlzLl9zdXBlcihkdCk7XG4gICAgICB0aGlzLnBvc2l0aW9uKCk7XG4gICAgfSxcblxuICAgIHJlbW92ZTogZnVuY3Rpb24oKSB7XG4gICAgICBpZih0aGlzLmVsKSB7XG4gICAgICAgIFEud3JhcHBlci5yZW1vdmVDaGlsZCh0aGlzLmVsKTtcbiAgICAgICAgdGhpcy5lbD0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIFEuVUkuVmVydGljYWxMYXlvdXQgPSBRLlNwcml0ZS5leHRlbmQoXCJVSS5WZXJ0aWNhbExheW91dFwiLHtcblxuXG4gICAgaW5pdDogZnVuY3Rpb24ocCkge1xuICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdO1xuICAgICAgdGhpcy5fc3VwZXIocCwgeyB0eXBlOiAwIH0pO1xuICAgIH0sXG5cbiAgICBpbnNlcnQ6IGZ1bmN0aW9uKHNwcml0ZSkge1xuICAgICAgdGhpcy5zdGFnZS5pbnNlcnQoc3ByaXRlLHRoaXMpO1xuICAgICAgdGhpcy5yZWxheW91dCgpO1xuICAgICAgLy8gQmluZCB0byBkZXN0cm95XG4gICAgICByZXR1cm4gc3ByaXRlO1xuICAgIH0sXG5cbiAgICByZWxheW91dDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgdG90YWxIZWlnaHQgPSAwO1xuICAgICAgZm9yKHZhciBpPTA7aTx0aGlzLmNoaWxkcmVuLmxlbmd0aDtpKyspIHtcbiAgICAgICAgdG90YWxIZWlnaHQgKz0gdGhpcy5jaGlsZHJlbltpXS5wLmggfHwgMDtcbiAgICAgIH1cblxuICAgICAgLy8gQ2VudGVyP1xuICAgICAgdmFyIHRvdGFsU2VwYXJ0aW9uID0gdGhpcy5wLmggLSB0b3RhbEhlaWdodDtcblxuICAgICAgLy8gTWFrZSBzdXJlIGFsbCBlbGVtZW50cyBoYXZlIHRoZSBzYW1lIHNwYWNlIGJldHdlZW4gdGhlbVxuICAgIH1cbiAgfSk7XG5cblxuXG59O1xuIiwiLypcbiogQ29weXJpZ2h0IChjKSAyMDA2LTIwMDcgRXJpbiBDYXR0byBodHRwOi8vd3d3LmdwaHlzaWNzLmNvbVxuKlxuKiBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZFxuKiB3YXJyYW50eS4gIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzXG4qIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuXG4qIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLFxuKiBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0XG4qIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczpcbiogMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3RcbiogY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmVcbiogaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlXG4qIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuXG4qIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlXG4qIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS5cbiogMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi5cbiovXG5cInVzZSBzdHJpY3RcIlxuXG52YXIgQm94MkQgPSB7fTtcblxuKGZ1bmN0aW9uIChhMmosIHVuZGVmaW5lZCkge1xuICAgXG4gICBmdW5jdGlvbiBlbXB0eUZuKCkge307XG4gICBhMmouaW5oZXJpdCA9IGZ1bmN0aW9uKGNscywgYmFzZSkge1xuICAgICAgdmFyIHRtcEN0ciA9IGNscztcbiAgICAgIGVtcHR5Rm4ucHJvdG90eXBlID0gYmFzZS5wcm90b3R5cGU7XG4gICAgICBjbHMucHJvdG90eXBlID0gbmV3IGVtcHR5Rm47XG4gICAgICBjbHMucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gdG1wQ3RyO1xuICAgfTtcbiAgIFxuICAgYTJqLmdlbmVyYXRlQ2FsbGJhY2sgPSBmdW5jdGlvbiBnZW5lcmF0ZUNhbGxiYWNrKGNvbnRleHQsIGNiKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgY2IuYXBwbHkoY29udGV4dCwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICB9O1xuICAgXG4gICBhMmouTlZlY3RvciA9IGZ1bmN0aW9uIE5WZWN0b3IobGVuZ3RoKSB7XG4gICAgICBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQpIGxlbmd0aCA9IDA7XG4gICAgICB2YXIgdG1wID0gbmV3IEFycmF5KGxlbmd0aCB8fCAwKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpXG4gICAgICB0bXBbaV0gPSAwO1xuICAgICAgcmV0dXJuIHRtcDtcbiAgIH07XG4gICBcbiAgIGEyai5pcyA9IGZ1bmN0aW9uIGlzKG8xLCBvMikge1xuICAgICAgaWYgKG8xID09PSBudWxsKSByZXR1cm4gZmFsc2U7XG4gICAgICBpZiAoKG8yIGluc3RhbmNlb2YgRnVuY3Rpb24pICYmIChvMSBpbnN0YW5jZW9mIG8yKSkgcmV0dXJuIHRydWU7XG4gICAgICBpZiAoKG8xLmNvbnN0cnVjdG9yLl9faW1wbGVtZW50cyAhPSB1bmRlZmluZWQpICYmIChvMS5jb25zdHJ1Y3Rvci5fX2ltcGxlbWVudHNbbzJdKSkgcmV0dXJuIHRydWU7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICB9O1xuICAgXG4gICBhMmoucGFyc2VVSW50ID0gZnVuY3Rpb24odikge1xuICAgICAgcmV0dXJuIE1hdGguYWJzKHBhcnNlSW50KHYpKTtcbiAgIH1cbiAgIFxufSkoQm94MkQpO1xuXG4vLyNUT0RPIHJlbW92ZSBhc3NpZ25tZW50cyBmcm9tIGdsb2JhbCBuYW1lc3BhY2VcbnZhciBWZWN0b3IgPSBBcnJheTtcbnZhciBWZWN0b3JfYTJqX051bWJlciA9IEJveDJELk5WZWN0b3I7XG4vL3BhY2thZ2Ugc3RydWN0dXJlXG5pZiAodHlwZW9mKEJveDJEKSA9PT0gXCJ1bmRlZmluZWRcIikgQm94MkQgPSB7fTtcbmlmICh0eXBlb2YoQm94MkQuQ29sbGlzaW9uKSA9PT0gXCJ1bmRlZmluZWRcIikgQm94MkQuQ29sbGlzaW9uID0ge307XG5pZiAodHlwZW9mKEJveDJELkNvbGxpc2lvbi5TaGFwZXMpID09PSBcInVuZGVmaW5lZFwiKSBCb3gyRC5Db2xsaXNpb24uU2hhcGVzID0ge307XG5pZiAodHlwZW9mKEJveDJELkNvbW1vbikgPT09IFwidW5kZWZpbmVkXCIpIEJveDJELkNvbW1vbiA9IHt9O1xuaWYgKHR5cGVvZihCb3gyRC5Db21tb24uTWF0aCkgPT09IFwidW5kZWZpbmVkXCIpIEJveDJELkNvbW1vbi5NYXRoID0ge307XG5pZiAodHlwZW9mKEJveDJELkR5bmFtaWNzKSA9PT0gXCJ1bmRlZmluZWRcIikgQm94MkQuRHluYW1pY3MgPSB7fTtcbmlmICh0eXBlb2YoQm94MkQuRHluYW1pY3MuQ29udGFjdHMpID09PSBcInVuZGVmaW5lZFwiKSBCb3gyRC5EeW5hbWljcy5Db250YWN0cyA9IHt9O1xuaWYgKHR5cGVvZihCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycykgPT09IFwidW5kZWZpbmVkXCIpIEJveDJELkR5bmFtaWNzLkNvbnRyb2xsZXJzID0ge307XG5pZiAodHlwZW9mKEJveDJELkR5bmFtaWNzLkpvaW50cykgPT09IFwidW5kZWZpbmVkXCIpIEJveDJELkR5bmFtaWNzLkpvaW50cyA9IHt9O1xuLy9wcmUtZGVmaW5pdGlvbnNcbihmdW5jdGlvbiAoKSB7XG4gICBCb3gyRC5Db2xsaXNpb24uSUJyb2FkUGhhc2UgPSAnQm94MkQuQ29sbGlzaW9uLklCcm9hZFBoYXNlJztcblxuICAgZnVuY3Rpb24gYjJBQUJCKCkge1xuICAgICAgYjJBQUJCLmIyQUFCQi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkNvbGxpc2lvbi5iMkFBQkIgPSBiMkFBQkI7XG5cbiAgIGZ1bmN0aW9uIGIyQm91bmQoKSB7XG4gICAgICBiMkJvdW5kLmIyQm91bmQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uYjJCb3VuZCA9IGIyQm91bmQ7XG5cbiAgIGZ1bmN0aW9uIGIyQm91bmRWYWx1ZXMoKSB7XG4gICAgICBiMkJvdW5kVmFsdWVzLmIyQm91bmRWYWx1ZXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMkJvdW5kVmFsdWVzKSB0aGlzLmIyQm91bmRWYWx1ZXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uYjJCb3VuZFZhbHVlcyA9IGIyQm91bmRWYWx1ZXM7XG5cbiAgIGZ1bmN0aW9uIGIyQ29sbGlzaW9uKCkge1xuICAgICAgYjJDb2xsaXNpb24uYjJDb2xsaXNpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24gPSBiMkNvbGxpc2lvbjtcblxuICAgZnVuY3Rpb24gYjJDb250YWN0SUQoKSB7XG4gICAgICBiMkNvbnRhY3RJRC5iMkNvbnRhY3RJRC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIyQ29udGFjdElEKSB0aGlzLmIyQ29udGFjdElELmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29sbGlzaW9uLmIyQ29udGFjdElEID0gYjJDb250YWN0SUQ7XG5cbiAgIGZ1bmN0aW9uIGIyQ29udGFjdFBvaW50KCkge1xuICAgICAgYjJDb250YWN0UG9pbnQuYjJDb250YWN0UG9pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uYjJDb250YWN0UG9pbnQgPSBiMkNvbnRhY3RQb2ludDtcblxuICAgZnVuY3Rpb24gYjJEaXN0YW5jZSgpIHtcbiAgICAgIGIyRGlzdGFuY2UuYjJEaXN0YW5jZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkNvbGxpc2lvbi5iMkRpc3RhbmNlID0gYjJEaXN0YW5jZTtcblxuICAgZnVuY3Rpb24gYjJEaXN0YW5jZUlucHV0KCkge1xuICAgICAgYjJEaXN0YW5jZUlucHV0LmIyRGlzdGFuY2VJbnB1dC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkNvbGxpc2lvbi5iMkRpc3RhbmNlSW5wdXQgPSBiMkRpc3RhbmNlSW5wdXQ7XG5cbiAgIGZ1bmN0aW9uIGIyRGlzdGFuY2VPdXRwdXQoKSB7XG4gICAgICBiMkRpc3RhbmNlT3V0cHV0LmIyRGlzdGFuY2VPdXRwdXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uYjJEaXN0YW5jZU91dHB1dCA9IGIyRGlzdGFuY2VPdXRwdXQ7XG5cbiAgIGZ1bmN0aW9uIGIyRGlzdGFuY2VQcm94eSgpIHtcbiAgICAgIGIyRGlzdGFuY2VQcm94eS5iMkRpc3RhbmNlUHJveHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uYjJEaXN0YW5jZVByb3h5ID0gYjJEaXN0YW5jZVByb3h5O1xuXG4gICBmdW5jdGlvbiBiMkR5bmFtaWNUcmVlKCkge1xuICAgICAgYjJEeW5hbWljVHJlZS5iMkR5bmFtaWNUcmVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJEeW5hbWljVHJlZSkgdGhpcy5iMkR5bmFtaWNUcmVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29sbGlzaW9uLmIyRHluYW1pY1RyZWUgPSBiMkR5bmFtaWNUcmVlO1xuXG4gICBmdW5jdGlvbiBiMkR5bmFtaWNUcmVlQnJvYWRQaGFzZSgpIHtcbiAgICAgIGIyRHluYW1pY1RyZWVCcm9hZFBoYXNlLmIyRHluYW1pY1RyZWVCcm9hZFBoYXNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29sbGlzaW9uLmIyRHluYW1pY1RyZWVCcm9hZFBoYXNlID0gYjJEeW5hbWljVHJlZUJyb2FkUGhhc2U7XG5cbiAgIGZ1bmN0aW9uIGIyRHluYW1pY1RyZWVOb2RlKCkge1xuICAgICAgYjJEeW5hbWljVHJlZU5vZGUuYjJEeW5hbWljVHJlZU5vZGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uYjJEeW5hbWljVHJlZU5vZGUgPSBiMkR5bmFtaWNUcmVlTm9kZTtcblxuICAgZnVuY3Rpb24gYjJEeW5hbWljVHJlZVBhaXIoKSB7XG4gICAgICBiMkR5bmFtaWNUcmVlUGFpci5iMkR5bmFtaWNUcmVlUGFpci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkNvbGxpc2lvbi5iMkR5bmFtaWNUcmVlUGFpciA9IGIyRHluYW1pY1RyZWVQYWlyO1xuXG4gICBmdW5jdGlvbiBiMk1hbmlmb2xkKCkge1xuICAgICAgYjJNYW5pZm9sZC5iMk1hbmlmb2xkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJNYW5pZm9sZCkgdGhpcy5iMk1hbmlmb2xkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29sbGlzaW9uLmIyTWFuaWZvbGQgPSBiMk1hbmlmb2xkO1xuXG4gICBmdW5jdGlvbiBiMk1hbmlmb2xkUG9pbnQoKSB7XG4gICAgICBiMk1hbmlmb2xkUG9pbnQuYjJNYW5pZm9sZFBvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJNYW5pZm9sZFBvaW50KSB0aGlzLmIyTWFuaWZvbGRQb2ludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkNvbGxpc2lvbi5iMk1hbmlmb2xkUG9pbnQgPSBiMk1hbmlmb2xkUG9pbnQ7XG5cbiAgIGZ1bmN0aW9uIGIyUG9pbnQoKSB7XG4gICAgICBiMlBvaW50LmIyUG9pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uYjJQb2ludCA9IGIyUG9pbnQ7XG5cbiAgIGZ1bmN0aW9uIGIyUmF5Q2FzdElucHV0KCkge1xuICAgICAgYjJSYXlDYXN0SW5wdXQuYjJSYXlDYXN0SW5wdXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMlJheUNhc3RJbnB1dCkgdGhpcy5iMlJheUNhc3RJbnB1dC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkNvbGxpc2lvbi5iMlJheUNhc3RJbnB1dCA9IGIyUmF5Q2FzdElucHV0O1xuXG4gICBmdW5jdGlvbiBiMlJheUNhc3RPdXRwdXQoKSB7XG4gICAgICBiMlJheUNhc3RPdXRwdXQuYjJSYXlDYXN0T3V0cHV0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29sbGlzaW9uLmIyUmF5Q2FzdE91dHB1dCA9IGIyUmF5Q2FzdE91dHB1dDtcblxuICAgZnVuY3Rpb24gYjJTZWdtZW50KCkge1xuICAgICAgYjJTZWdtZW50LmIyU2VnbWVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkNvbGxpc2lvbi5iMlNlZ21lbnQgPSBiMlNlZ21lbnQ7XG5cbiAgIGZ1bmN0aW9uIGIyU2VwYXJhdGlvbkZ1bmN0aW9uKCkge1xuICAgICAgYjJTZXBhcmF0aW9uRnVuY3Rpb24uYjJTZXBhcmF0aW9uRnVuY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uYjJTZXBhcmF0aW9uRnVuY3Rpb24gPSBiMlNlcGFyYXRpb25GdW5jdGlvbjtcblxuICAgZnVuY3Rpb24gYjJTaW1wbGV4KCkge1xuICAgICAgYjJTaW1wbGV4LmIyU2ltcGxleC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIyU2ltcGxleCkgdGhpcy5iMlNpbXBsZXguYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uYjJTaW1wbGV4ID0gYjJTaW1wbGV4O1xuXG4gICBmdW5jdGlvbiBiMlNpbXBsZXhDYWNoZSgpIHtcbiAgICAgIGIyU2ltcGxleENhY2hlLmIyU2ltcGxleENhY2hlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29sbGlzaW9uLmIyU2ltcGxleENhY2hlID0gYjJTaW1wbGV4Q2FjaGU7XG5cbiAgIGZ1bmN0aW9uIGIyU2ltcGxleFZlcnRleCgpIHtcbiAgICAgIGIyU2ltcGxleFZlcnRleC5iMlNpbXBsZXhWZXJ0ZXguYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uYjJTaW1wbGV4VmVydGV4ID0gYjJTaW1wbGV4VmVydGV4O1xuXG4gICBmdW5jdGlvbiBiMlRpbWVPZkltcGFjdCgpIHtcbiAgICAgIGIyVGltZU9mSW1wYWN0LmIyVGltZU9mSW1wYWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29sbGlzaW9uLmIyVGltZU9mSW1wYWN0ID0gYjJUaW1lT2ZJbXBhY3Q7XG5cbiAgIGZ1bmN0aW9uIGIyVE9JSW5wdXQoKSB7XG4gICAgICBiMlRPSUlucHV0LmIyVE9JSW5wdXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uYjJUT0lJbnB1dCA9IGIyVE9JSW5wdXQ7XG5cbiAgIGZ1bmN0aW9uIGIyV29ybGRNYW5pZm9sZCgpIHtcbiAgICAgIGIyV29ybGRNYW5pZm9sZC5iMldvcmxkTWFuaWZvbGQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMldvcmxkTWFuaWZvbGQpIHRoaXMuYjJXb3JsZE1hbmlmb2xkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29sbGlzaW9uLmIyV29ybGRNYW5pZm9sZCA9IGIyV29ybGRNYW5pZm9sZDtcblxuICAgZnVuY3Rpb24gQ2xpcFZlcnRleCgpIHtcbiAgICAgIENsaXBWZXJ0ZXguQ2xpcFZlcnRleC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkNvbGxpc2lvbi5DbGlwVmVydGV4ID0gQ2xpcFZlcnRleDtcblxuICAgZnVuY3Rpb24gRmVhdHVyZXMoKSB7XG4gICAgICBGZWF0dXJlcy5GZWF0dXJlcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkNvbGxpc2lvbi5GZWF0dXJlcyA9IEZlYXR1cmVzO1xuXG4gICBmdW5jdGlvbiBiMkNpcmNsZVNoYXBlKCkge1xuICAgICAgYjJDaXJjbGVTaGFwZS5iMkNpcmNsZVNoYXBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJDaXJjbGVTaGFwZSkgdGhpcy5iMkNpcmNsZVNoYXBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMkNpcmNsZVNoYXBlID0gYjJDaXJjbGVTaGFwZTtcblxuICAgZnVuY3Rpb24gYjJFZGdlQ2hhaW5EZWYoKSB7XG4gICAgICBiMkVkZ2VDaGFpbkRlZi5iMkVkZ2VDaGFpbkRlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIyRWRnZUNoYWluRGVmKSB0aGlzLmIyRWRnZUNoYWluRGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMkVkZ2VDaGFpbkRlZiA9IGIyRWRnZUNoYWluRGVmO1xuXG4gICBmdW5jdGlvbiBiMkVkZ2VTaGFwZSgpIHtcbiAgICAgIGIyRWRnZVNoYXBlLmIyRWRnZVNoYXBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJFZGdlU2hhcGUpIHRoaXMuYjJFZGdlU2hhcGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyRWRnZVNoYXBlID0gYjJFZGdlU2hhcGU7XG5cbiAgIGZ1bmN0aW9uIGIyTWFzc0RhdGEoKSB7XG4gICAgICBiMk1hc3NEYXRhLmIyTWFzc0RhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyTWFzc0RhdGEgPSBiMk1hc3NEYXRhO1xuXG4gICBmdW5jdGlvbiBiMlBvbHlnb25TaGFwZSgpIHtcbiAgICAgIGIyUG9seWdvblNoYXBlLmIyUG9seWdvblNoYXBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJQb2x5Z29uU2hhcGUpIHRoaXMuYjJQb2x5Z29uU2hhcGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyUG9seWdvblNoYXBlID0gYjJQb2x5Z29uU2hhcGU7XG5cbiAgIGZ1bmN0aW9uIGIyU2hhcGUoKSB7XG4gICAgICBiMlNoYXBlLmIyU2hhcGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMlNoYXBlKSB0aGlzLmIyU2hhcGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyU2hhcGUgPSBiMlNoYXBlO1xuICAgQm94MkQuQ29tbW9uLmIyaW50ZXJuYWwgPSAnQm94MkQuQ29tbW9uLmIyaW50ZXJuYWwnO1xuXG4gICBmdW5jdGlvbiBiMkNvbG9yKCkge1xuICAgICAgYjJDb2xvci5iMkNvbG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJDb2xvcikgdGhpcy5iMkNvbG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29tbW9uLmIyQ29sb3IgPSBiMkNvbG9yO1xuXG4gICBmdW5jdGlvbiBiMlNldHRpbmdzKCkge1xuICAgICAgYjJTZXR0aW5ncy5iMlNldHRpbmdzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MgPSBiMlNldHRpbmdzO1xuXG4gICBmdW5jdGlvbiBiMk1hdDIyKCkge1xuICAgICAgYjJNYXQyMi5iMk1hdDIyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJNYXQyMikgdGhpcy5iMk1hdDIyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuQ29tbW9uLk1hdGguYjJNYXQyMiA9IGIyTWF0MjI7XG5cbiAgIGZ1bmN0aW9uIGIyTWF0MzMoKSB7XG4gICAgICBiMk1hdDMzLmIyTWF0MzMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMk1hdDMzKSB0aGlzLmIyTWF0MzMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db21tb24uTWF0aC5iMk1hdDMzID0gYjJNYXQzMztcblxuICAgZnVuY3Rpb24gYjJNYXRoKCkge1xuICAgICAgYjJNYXRoLmIyTWF0aC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkNvbW1vbi5NYXRoLmIyTWF0aCA9IGIyTWF0aDtcblxuICAgZnVuY3Rpb24gYjJTd2VlcCgpIHtcbiAgICAgIGIyU3dlZXAuYjJTd2VlcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkNvbW1vbi5NYXRoLmIyU3dlZXAgPSBiMlN3ZWVwO1xuXG4gICBmdW5jdGlvbiBiMlRyYW5zZm9ybSgpIHtcbiAgICAgIGIyVHJhbnNmb3JtLmIyVHJhbnNmb3JtLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJUcmFuc2Zvcm0pIHRoaXMuYjJUcmFuc2Zvcm0uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db21tb24uTWF0aC5iMlRyYW5zZm9ybSA9IGIyVHJhbnNmb3JtO1xuXG4gICBmdW5jdGlvbiBiMlZlYzIoKSB7XG4gICAgICBiMlZlYzIuYjJWZWMyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJWZWMyKSB0aGlzLmIyVmVjMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkNvbW1vbi5NYXRoLmIyVmVjMiA9IGIyVmVjMjtcblxuICAgZnVuY3Rpb24gYjJWZWMzKCkge1xuICAgICAgYjJWZWMzLmIyVmVjMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIyVmVjMykgdGhpcy5iMlZlYzMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5Db21tb24uTWF0aC5iMlZlYzMgPSBiMlZlYzM7XG5cbiAgIGZ1bmN0aW9uIGIyQm9keSgpIHtcbiAgICAgIGIyQm9keS5iMkJvZHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMkJvZHkpIHRoaXMuYjJCb2R5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuYjJCb2R5ID0gYjJCb2R5O1xuXG4gICBmdW5jdGlvbiBiMkJvZHlEZWYoKSB7XG4gICAgICBiMkJvZHlEZWYuYjJCb2R5RGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJCb2R5RGVmKSB0aGlzLmIyQm9keURlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLmIyQm9keURlZiA9IGIyQm9keURlZjtcblxuICAgZnVuY3Rpb24gYjJDb250YWN0RmlsdGVyKCkge1xuICAgICAgYjJDb250YWN0RmlsdGVyLmIyQ29udGFjdEZpbHRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLmIyQ29udGFjdEZpbHRlciA9IGIyQ29udGFjdEZpbHRlcjtcblxuICAgZnVuY3Rpb24gYjJDb250YWN0SW1wdWxzZSgpIHtcbiAgICAgIGIyQ29udGFjdEltcHVsc2UuYjJDb250YWN0SW1wdWxzZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLmIyQ29udGFjdEltcHVsc2UgPSBiMkNvbnRhY3RJbXB1bHNlO1xuXG4gICBmdW5jdGlvbiBiMkNvbnRhY3RMaXN0ZW5lcigpIHtcbiAgICAgIGIyQ29udGFjdExpc3RlbmVyLmIyQ29udGFjdExpc3RlbmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuYjJDb250YWN0TGlzdGVuZXIgPSBiMkNvbnRhY3RMaXN0ZW5lcjtcblxuICAgZnVuY3Rpb24gYjJDb250YWN0TWFuYWdlcigpIHtcbiAgICAgIGIyQ29udGFjdE1hbmFnZXIuYjJDb250YWN0TWFuYWdlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIyQ29udGFjdE1hbmFnZXIpIHRoaXMuYjJDb250YWN0TWFuYWdlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLmIyQ29udGFjdE1hbmFnZXIgPSBiMkNvbnRhY3RNYW5hZ2VyO1xuXG4gICBmdW5jdGlvbiBiMkRlYnVnRHJhdygpIHtcbiAgICAgIGIyRGVidWdEcmF3LmIyRGVidWdEcmF3LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJEZWJ1Z0RyYXcpIHRoaXMuYjJEZWJ1Z0RyYXcuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5EeW5hbWljcy5iMkRlYnVnRHJhdyA9IGIyRGVidWdEcmF3O1xuXG4gICBmdW5jdGlvbiBiMkRlc3RydWN0aW9uTGlzdGVuZXIoKSB7XG4gICAgICBiMkRlc3RydWN0aW9uTGlzdGVuZXIuYjJEZXN0cnVjdGlvbkxpc3RlbmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuYjJEZXN0cnVjdGlvbkxpc3RlbmVyID0gYjJEZXN0cnVjdGlvbkxpc3RlbmVyO1xuXG4gICBmdW5jdGlvbiBiMkZpbHRlckRhdGEoKSB7XG4gICAgICBiMkZpbHRlckRhdGEuYjJGaWx0ZXJEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuYjJGaWx0ZXJEYXRhID0gYjJGaWx0ZXJEYXRhO1xuXG4gICBmdW5jdGlvbiBiMkZpeHR1cmUoKSB7XG4gICAgICBiMkZpeHR1cmUuYjJGaXh0dXJlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJGaXh0dXJlKSB0aGlzLmIyRml4dHVyZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLmIyRml4dHVyZSA9IGIyRml4dHVyZTtcblxuICAgZnVuY3Rpb24gYjJGaXh0dXJlRGVmKCkge1xuICAgICAgYjJGaXh0dXJlRGVmLmIyRml4dHVyZURlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIyRml4dHVyZURlZikgdGhpcy5iMkZpeHR1cmVEZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5EeW5hbWljcy5iMkZpeHR1cmVEZWYgPSBiMkZpeHR1cmVEZWY7XG5cbiAgIGZ1bmN0aW9uIGIySXNsYW5kKCkge1xuICAgICAgYjJJc2xhbmQuYjJJc2xhbmQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMklzbGFuZCkgdGhpcy5iMklzbGFuZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLmIySXNsYW5kID0gYjJJc2xhbmQ7XG5cbiAgIGZ1bmN0aW9uIGIyVGltZVN0ZXAoKSB7XG4gICAgICBiMlRpbWVTdGVwLmIyVGltZVN0ZXAuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5EeW5hbWljcy5iMlRpbWVTdGVwID0gYjJUaW1lU3RlcDtcblxuICAgZnVuY3Rpb24gYjJXb3JsZCgpIHtcbiAgICAgIGIyV29ybGQuYjJXb3JsZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIyV29ybGQpIHRoaXMuYjJXb3JsZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLmIyV29ybGQgPSBiMldvcmxkO1xuXG4gICBmdW5jdGlvbiBiMkNpcmNsZUNvbnRhY3QoKSB7XG4gICAgICBiMkNpcmNsZUNvbnRhY3QuYjJDaXJjbGVDb250YWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDaXJjbGVDb250YWN0ID0gYjJDaXJjbGVDb250YWN0O1xuXG4gICBmdW5jdGlvbiBiMkNvbnRhY3QoKSB7XG4gICAgICBiMkNvbnRhY3QuYjJDb250YWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJDb250YWN0KSB0aGlzLmIyQ29udGFjdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdCA9IGIyQ29udGFjdDtcblxuICAgZnVuY3Rpb24gYjJDb250YWN0Q29uc3RyYWludCgpIHtcbiAgICAgIGIyQ29udGFjdENvbnN0cmFpbnQuYjJDb250YWN0Q29uc3RyYWludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIyQ29udGFjdENvbnN0cmFpbnQpIHRoaXMuYjJDb250YWN0Q29uc3RyYWludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdENvbnN0cmFpbnQgPSBiMkNvbnRhY3RDb25zdHJhaW50O1xuXG4gICBmdW5jdGlvbiBiMkNvbnRhY3RDb25zdHJhaW50UG9pbnQoKSB7XG4gICAgICBiMkNvbnRhY3RDb25zdHJhaW50UG9pbnQuYjJDb250YWN0Q29uc3RyYWludFBvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0Q29uc3RyYWludFBvaW50ID0gYjJDb250YWN0Q29uc3RyYWludFBvaW50O1xuXG4gICBmdW5jdGlvbiBiMkNvbnRhY3RFZGdlKCkge1xuICAgICAgYjJDb250YWN0RWRnZS5iMkNvbnRhY3RFZGdlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0RWRnZSA9IGIyQ29udGFjdEVkZ2U7XG5cbiAgIGZ1bmN0aW9uIGIyQ29udGFjdEZhY3RvcnkoKSB7XG4gICAgICBiMkNvbnRhY3RGYWN0b3J5LmIyQ29udGFjdEZhY3RvcnkuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMkNvbnRhY3RGYWN0b3J5KSB0aGlzLmIyQ29udGFjdEZhY3RvcnkuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3RGYWN0b3J5ID0gYjJDb250YWN0RmFjdG9yeTtcblxuICAgZnVuY3Rpb24gYjJDb250YWN0UmVnaXN0ZXIoKSB7XG4gICAgICBiMkNvbnRhY3RSZWdpc3Rlci5iMkNvbnRhY3RSZWdpc3Rlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdFJlZ2lzdGVyID0gYjJDb250YWN0UmVnaXN0ZXI7XG5cbiAgIGZ1bmN0aW9uIGIyQ29udGFjdFJlc3VsdCgpIHtcbiAgICAgIGIyQ29udGFjdFJlc3VsdC5iMkNvbnRhY3RSZXN1bHQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3RSZXN1bHQgPSBiMkNvbnRhY3RSZXN1bHQ7XG5cbiAgIGZ1bmN0aW9uIGIyQ29udGFjdFNvbHZlcigpIHtcbiAgICAgIGIyQ29udGFjdFNvbHZlci5iMkNvbnRhY3RTb2x2ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMkNvbnRhY3RTb2x2ZXIpIHRoaXMuYjJDb250YWN0U29sdmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0U29sdmVyID0gYjJDb250YWN0U29sdmVyO1xuXG4gICBmdW5jdGlvbiBiMkVkZ2VBbmRDaXJjbGVDb250YWN0KCkge1xuICAgICAgYjJFZGdlQW5kQ2lyY2xlQ29udGFjdC5iMkVkZ2VBbmRDaXJjbGVDb250YWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJFZGdlQW5kQ2lyY2xlQ29udGFjdCA9IGIyRWRnZUFuZENpcmNsZUNvbnRhY3Q7XG5cbiAgIGZ1bmN0aW9uIGIyTnVsbENvbnRhY3QoKSB7XG4gICAgICBiMk51bGxDb250YWN0LmIyTnVsbENvbnRhY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMk51bGxDb250YWN0KSB0aGlzLmIyTnVsbENvbnRhY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMk51bGxDb250YWN0ID0gYjJOdWxsQ29udGFjdDtcblxuICAgZnVuY3Rpb24gYjJQb2x5QW5kQ2lyY2xlQ29udGFjdCgpIHtcbiAgICAgIGIyUG9seUFuZENpcmNsZUNvbnRhY3QuYjJQb2x5QW5kQ2lyY2xlQ29udGFjdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyUG9seUFuZENpcmNsZUNvbnRhY3QgPSBiMlBvbHlBbmRDaXJjbGVDb250YWN0O1xuXG4gICBmdW5jdGlvbiBiMlBvbHlBbmRFZGdlQ29udGFjdCgpIHtcbiAgICAgIGIyUG9seUFuZEVkZ2VDb250YWN0LmIyUG9seUFuZEVkZ2VDb250YWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJQb2x5QW5kRWRnZUNvbnRhY3QgPSBiMlBvbHlBbmRFZGdlQ29udGFjdDtcblxuICAgZnVuY3Rpb24gYjJQb2x5Z29uQ29udGFjdCgpIHtcbiAgICAgIGIyUG9seWdvbkNvbnRhY3QuYjJQb2x5Z29uQ29udGFjdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyUG9seWdvbkNvbnRhY3QgPSBiMlBvbHlnb25Db250YWN0O1xuXG4gICBmdW5jdGlvbiBiMlBvc2l0aW9uU29sdmVyTWFuaWZvbGQoKSB7XG4gICAgICBiMlBvc2l0aW9uU29sdmVyTWFuaWZvbGQuYjJQb3NpdGlvblNvbHZlck1hbmlmb2xkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJQb3NpdGlvblNvbHZlck1hbmlmb2xkKSB0aGlzLmIyUG9zaXRpb25Tb2x2ZXJNYW5pZm9sZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyUG9zaXRpb25Tb2x2ZXJNYW5pZm9sZCA9IGIyUG9zaXRpb25Tb2x2ZXJNYW5pZm9sZDtcblxuICAgZnVuY3Rpb24gYjJCdW95YW5jeUNvbnRyb2xsZXIoKSB7XG4gICAgICBiMkJ1b3lhbmN5Q29udHJvbGxlci5iMkJ1b3lhbmN5Q29udHJvbGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkNvbnRyb2xsZXJzLmIyQnVveWFuY3lDb250cm9sbGVyID0gYjJCdW95YW5jeUNvbnRyb2xsZXI7XG5cbiAgIGZ1bmN0aW9uIGIyQ29uc3RhbnRBY2NlbENvbnRyb2xsZXIoKSB7XG4gICAgICBiMkNvbnN0YW50QWNjZWxDb250cm9sbGVyLmIyQ29uc3RhbnRBY2NlbENvbnRyb2xsZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnN0YW50QWNjZWxDb250cm9sbGVyID0gYjJDb25zdGFudEFjY2VsQ29udHJvbGxlcjtcblxuICAgZnVuY3Rpb24gYjJDb25zdGFudEZvcmNlQ29udHJvbGxlcigpIHtcbiAgICAgIGIyQ29uc3RhbnRGb3JjZUNvbnRyb2xsZXIuYjJDb25zdGFudEZvcmNlQ29udHJvbGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkNvbnRyb2xsZXJzLmIyQ29uc3RhbnRGb3JjZUNvbnRyb2xsZXIgPSBiMkNvbnN0YW50Rm9yY2VDb250cm9sbGVyO1xuXG4gICBmdW5jdGlvbiBiMkNvbnRyb2xsZXIoKSB7XG4gICAgICBiMkNvbnRyb2xsZXIuYjJDb250cm9sbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuQ29udHJvbGxlcnMuYjJDb250cm9sbGVyID0gYjJDb250cm9sbGVyO1xuXG4gICBmdW5jdGlvbiBiMkNvbnRyb2xsZXJFZGdlKCkge1xuICAgICAgYjJDb250cm9sbGVyRWRnZS5iMkNvbnRyb2xsZXJFZGdlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuQ29udHJvbGxlcnMuYjJDb250cm9sbGVyRWRnZSA9IGIyQ29udHJvbGxlckVkZ2U7XG5cbiAgIGZ1bmN0aW9uIGIyR3Jhdml0eUNvbnRyb2xsZXIoKSB7XG4gICAgICBiMkdyYXZpdHlDb250cm9sbGVyLmIyR3Jhdml0eUNvbnRyb2xsZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkdyYXZpdHlDb250cm9sbGVyID0gYjJHcmF2aXR5Q29udHJvbGxlcjtcblxuICAgZnVuY3Rpb24gYjJUZW5zb3JEYW1waW5nQ29udHJvbGxlcigpIHtcbiAgICAgIGIyVGVuc29yRGFtcGluZ0NvbnRyb2xsZXIuYjJUZW5zb3JEYW1waW5nQ29udHJvbGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkNvbnRyb2xsZXJzLmIyVGVuc29yRGFtcGluZ0NvbnRyb2xsZXIgPSBiMlRlbnNvckRhbXBpbmdDb250cm9sbGVyO1xuXG4gICBmdW5jdGlvbiBiMkRpc3RhbmNlSm9pbnQoKSB7XG4gICAgICBiMkRpc3RhbmNlSm9pbnQuYjJEaXN0YW5jZUpvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJEaXN0YW5jZUpvaW50KSB0aGlzLmIyRGlzdGFuY2VKb2ludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkRpc3RhbmNlSm9pbnQgPSBiMkRpc3RhbmNlSm9pbnQ7XG5cbiAgIGZ1bmN0aW9uIGIyRGlzdGFuY2VKb2ludERlZigpIHtcbiAgICAgIGIyRGlzdGFuY2VKb2ludERlZi5iMkRpc3RhbmNlSm9pbnREZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMkRpc3RhbmNlSm9pbnREZWYpIHRoaXMuYjJEaXN0YW5jZUpvaW50RGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyRGlzdGFuY2VKb2ludERlZiA9IGIyRGlzdGFuY2VKb2ludERlZjtcblxuICAgZnVuY3Rpb24gYjJGcmljdGlvbkpvaW50KCkge1xuICAgICAgYjJGcmljdGlvbkpvaW50LmIyRnJpY3Rpb25Kb2ludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIyRnJpY3Rpb25Kb2ludCkgdGhpcy5iMkZyaWN0aW9uSm9pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJGcmljdGlvbkpvaW50ID0gYjJGcmljdGlvbkpvaW50O1xuXG4gICBmdW5jdGlvbiBiMkZyaWN0aW9uSm9pbnREZWYoKSB7XG4gICAgICBiMkZyaWN0aW9uSm9pbnREZWYuYjJGcmljdGlvbkpvaW50RGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJGcmljdGlvbkpvaW50RGVmKSB0aGlzLmIyRnJpY3Rpb25Kb2ludERlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkZyaWN0aW9uSm9pbnREZWYgPSBiMkZyaWN0aW9uSm9pbnREZWY7XG5cbiAgIGZ1bmN0aW9uIGIyR2VhckpvaW50KCkge1xuICAgICAgYjJHZWFySm9pbnQuYjJHZWFySm9pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMkdlYXJKb2ludCkgdGhpcy5iMkdlYXJKb2ludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkdlYXJKb2ludCA9IGIyR2VhckpvaW50O1xuXG4gICBmdW5jdGlvbiBiMkdlYXJKb2ludERlZigpIHtcbiAgICAgIGIyR2VhckpvaW50RGVmLmIyR2VhckpvaW50RGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJHZWFySm9pbnREZWYpIHRoaXMuYjJHZWFySm9pbnREZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJHZWFySm9pbnREZWYgPSBiMkdlYXJKb2ludERlZjtcblxuICAgZnVuY3Rpb24gYjJKYWNvYmlhbigpIHtcbiAgICAgIGIySmFjb2JpYW4uYjJKYWNvYmlhbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkphY29iaWFuID0gYjJKYWNvYmlhbjtcblxuICAgZnVuY3Rpb24gYjJKb2ludCgpIHtcbiAgICAgIGIySm9pbnQuYjJKb2ludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIySm9pbnQpIHRoaXMuYjJKb2ludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50ID0gYjJKb2ludDtcblxuICAgZnVuY3Rpb24gYjJKb2ludERlZigpIHtcbiAgICAgIGIySm9pbnREZWYuYjJKb2ludERlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIySm9pbnREZWYpIHRoaXMuYjJKb2ludERlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50RGVmID0gYjJKb2ludERlZjtcblxuICAgZnVuY3Rpb24gYjJKb2ludEVkZ2UoKSB7XG4gICAgICBiMkpvaW50RWRnZS5iMkpvaW50RWRnZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50RWRnZSA9IGIySm9pbnRFZGdlO1xuXG4gICBmdW5jdGlvbiBiMkxpbmVKb2ludCgpIHtcbiAgICAgIGIyTGluZUpvaW50LmIyTGluZUpvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJMaW5lSm9pbnQpIHRoaXMuYjJMaW5lSm9pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJMaW5lSm9pbnQgPSBiMkxpbmVKb2ludDtcblxuICAgZnVuY3Rpb24gYjJMaW5lSm9pbnREZWYoKSB7XG4gICAgICBiMkxpbmVKb2ludERlZi5iMkxpbmVKb2ludERlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIyTGluZUpvaW50RGVmKSB0aGlzLmIyTGluZUpvaW50RGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyTGluZUpvaW50RGVmID0gYjJMaW5lSm9pbnREZWY7XG5cbiAgIGZ1bmN0aW9uIGIyTW91c2VKb2ludCgpIHtcbiAgICAgIGIyTW91c2VKb2ludC5iMk1vdXNlSm9pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMk1vdXNlSm9pbnQpIHRoaXMuYjJNb3VzZUpvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyTW91c2VKb2ludCA9IGIyTW91c2VKb2ludDtcblxuICAgZnVuY3Rpb24gYjJNb3VzZUpvaW50RGVmKCkge1xuICAgICAgYjJNb3VzZUpvaW50RGVmLmIyTW91c2VKb2ludERlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIyTW91c2VKb2ludERlZikgdGhpcy5iMk1vdXNlSm9pbnREZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJNb3VzZUpvaW50RGVmID0gYjJNb3VzZUpvaW50RGVmO1xuXG4gICBmdW5jdGlvbiBiMlByaXNtYXRpY0pvaW50KCkge1xuICAgICAgYjJQcmlzbWF0aWNKb2ludC5iMlByaXNtYXRpY0pvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJQcmlzbWF0aWNKb2ludCkgdGhpcy5iMlByaXNtYXRpY0pvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyUHJpc21hdGljSm9pbnQgPSBiMlByaXNtYXRpY0pvaW50O1xuXG4gICBmdW5jdGlvbiBiMlByaXNtYXRpY0pvaW50RGVmKCkge1xuICAgICAgYjJQcmlzbWF0aWNKb2ludERlZi5iMlByaXNtYXRpY0pvaW50RGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJQcmlzbWF0aWNKb2ludERlZikgdGhpcy5iMlByaXNtYXRpY0pvaW50RGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyUHJpc21hdGljSm9pbnREZWYgPSBiMlByaXNtYXRpY0pvaW50RGVmO1xuXG4gICBmdW5jdGlvbiBiMlB1bGxleUpvaW50KCkge1xuICAgICAgYjJQdWxsZXlKb2ludC5iMlB1bGxleUpvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJQdWxsZXlKb2ludCkgdGhpcy5iMlB1bGxleUpvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyUHVsbGV5Sm9pbnQgPSBiMlB1bGxleUpvaW50O1xuXG4gICBmdW5jdGlvbiBiMlB1bGxleUpvaW50RGVmKCkge1xuICAgICAgYjJQdWxsZXlKb2ludERlZi5iMlB1bGxleUpvaW50RGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJQdWxsZXlKb2ludERlZikgdGhpcy5iMlB1bGxleUpvaW50RGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyUHVsbGV5Sm9pbnREZWYgPSBiMlB1bGxleUpvaW50RGVmO1xuXG4gICBmdW5jdGlvbiBiMlJldm9sdXRlSm9pbnQoKSB7XG4gICAgICBiMlJldm9sdXRlSm9pbnQuYjJSZXZvbHV0ZUpvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gYjJSZXZvbHV0ZUpvaW50KSB0aGlzLmIyUmV2b2x1dGVKb2ludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMlJldm9sdXRlSm9pbnQgPSBiMlJldm9sdXRlSm9pbnQ7XG5cbiAgIGZ1bmN0aW9uIGIyUmV2b2x1dGVKb2ludERlZigpIHtcbiAgICAgIGIyUmV2b2x1dGVKb2ludERlZi5iMlJldm9sdXRlSm9pbnREZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMlJldm9sdXRlSm9pbnREZWYpIHRoaXMuYjJSZXZvbHV0ZUpvaW50RGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyUmV2b2x1dGVKb2ludERlZiA9IGIyUmV2b2x1dGVKb2ludERlZjtcblxuICAgZnVuY3Rpb24gYjJXZWxkSm9pbnQoKSB7XG4gICAgICBiMldlbGRKb2ludC5iMldlbGRKb2ludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IGIyV2VsZEpvaW50KSB0aGlzLmIyV2VsZEpvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyV2VsZEpvaW50ID0gYjJXZWxkSm9pbnQ7XG5cbiAgIGZ1bmN0aW9uIGIyV2VsZEpvaW50RGVmKCkge1xuICAgICAgYjJXZWxkSm9pbnREZWYuYjJXZWxkSm9pbnREZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBiMldlbGRKb2ludERlZikgdGhpcy5iMldlbGRKb2ludERlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMldlbGRKb2ludERlZiA9IGIyV2VsZEpvaW50RGVmO1xufSkoKTsgLy9kZWZpbml0aW9uc1xuQm94MkQucG9zdERlZnMgPSBbXTtcbihmdW5jdGlvbiAoKSB7XG4gICB2YXIgYjJDaXJjbGVTaGFwZSA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJDaXJjbGVTaGFwZSxcbiAgICAgIGIyRWRnZUNoYWluRGVmID0gQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMkVkZ2VDaGFpbkRlZixcbiAgICAgIGIyRWRnZVNoYXBlID0gQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMkVkZ2VTaGFwZSxcbiAgICAgIGIyTWFzc0RhdGEgPSBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyTWFzc0RhdGEsXG4gICAgICBiMlBvbHlnb25TaGFwZSA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJQb2x5Z29uU2hhcGUsXG4gICAgICBiMlNoYXBlID0gQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMlNoYXBlLFxuICAgICAgYjJDb2xvciA9IEJveDJELkNvbW1vbi5iMkNvbG9yLFxuICAgICAgYjJpbnRlcm5hbCA9IEJveDJELkNvbW1vbi5iMmludGVybmFsLFxuICAgICAgYjJTZXR0aW5ncyA9IEJveDJELkNvbW1vbi5iMlNldHRpbmdzLFxuICAgICAgYjJNYXQyMiA9IEJveDJELkNvbW1vbi5NYXRoLmIyTWF0MjIsXG4gICAgICBiMk1hdDMzID0gQm94MkQuQ29tbW9uLk1hdGguYjJNYXQzMyxcbiAgICAgIGIyTWF0aCA9IEJveDJELkNvbW1vbi5NYXRoLmIyTWF0aCxcbiAgICAgIGIyU3dlZXAgPSBCb3gyRC5Db21tb24uTWF0aC5iMlN3ZWVwLFxuICAgICAgYjJUcmFuc2Zvcm0gPSBCb3gyRC5Db21tb24uTWF0aC5iMlRyYW5zZm9ybSxcbiAgICAgIGIyVmVjMiA9IEJveDJELkNvbW1vbi5NYXRoLmIyVmVjMixcbiAgICAgIGIyVmVjMyA9IEJveDJELkNvbW1vbi5NYXRoLmIyVmVjMyxcbiAgICAgIGIyQUFCQiA9IEJveDJELkNvbGxpc2lvbi5iMkFBQkIsXG4gICAgICBiMkJvdW5kID0gQm94MkQuQ29sbGlzaW9uLmIyQm91bmQsXG4gICAgICBiMkJvdW5kVmFsdWVzID0gQm94MkQuQ29sbGlzaW9uLmIyQm91bmRWYWx1ZXMsXG4gICAgICBiMkNvbGxpc2lvbiA9IEJveDJELkNvbGxpc2lvbi5iMkNvbGxpc2lvbixcbiAgICAgIGIyQ29udGFjdElEID0gQm94MkQuQ29sbGlzaW9uLmIyQ29udGFjdElELFxuICAgICAgYjJDb250YWN0UG9pbnQgPSBCb3gyRC5Db2xsaXNpb24uYjJDb250YWN0UG9pbnQsXG4gICAgICBiMkRpc3RhbmNlID0gQm94MkQuQ29sbGlzaW9uLmIyRGlzdGFuY2UsXG4gICAgICBiMkRpc3RhbmNlSW5wdXQgPSBCb3gyRC5Db2xsaXNpb24uYjJEaXN0YW5jZUlucHV0LFxuICAgICAgYjJEaXN0YW5jZU91dHB1dCA9IEJveDJELkNvbGxpc2lvbi5iMkRpc3RhbmNlT3V0cHV0LFxuICAgICAgYjJEaXN0YW5jZVByb3h5ID0gQm94MkQuQ29sbGlzaW9uLmIyRGlzdGFuY2VQcm94eSxcbiAgICAgIGIyRHluYW1pY1RyZWUgPSBCb3gyRC5Db2xsaXNpb24uYjJEeW5hbWljVHJlZSxcbiAgICAgIGIyRHluYW1pY1RyZWVCcm9hZFBoYXNlID0gQm94MkQuQ29sbGlzaW9uLmIyRHluYW1pY1RyZWVCcm9hZFBoYXNlLFxuICAgICAgYjJEeW5hbWljVHJlZU5vZGUgPSBCb3gyRC5Db2xsaXNpb24uYjJEeW5hbWljVHJlZU5vZGUsXG4gICAgICBiMkR5bmFtaWNUcmVlUGFpciA9IEJveDJELkNvbGxpc2lvbi5iMkR5bmFtaWNUcmVlUGFpcixcbiAgICAgIGIyTWFuaWZvbGQgPSBCb3gyRC5Db2xsaXNpb24uYjJNYW5pZm9sZCxcbiAgICAgIGIyTWFuaWZvbGRQb2ludCA9IEJveDJELkNvbGxpc2lvbi5iMk1hbmlmb2xkUG9pbnQsXG4gICAgICBiMlBvaW50ID0gQm94MkQuQ29sbGlzaW9uLmIyUG9pbnQsXG4gICAgICBiMlJheUNhc3RJbnB1dCA9IEJveDJELkNvbGxpc2lvbi5iMlJheUNhc3RJbnB1dCxcbiAgICAgIGIyUmF5Q2FzdE91dHB1dCA9IEJveDJELkNvbGxpc2lvbi5iMlJheUNhc3RPdXRwdXQsXG4gICAgICBiMlNlZ21lbnQgPSBCb3gyRC5Db2xsaXNpb24uYjJTZWdtZW50LFxuICAgICAgYjJTZXBhcmF0aW9uRnVuY3Rpb24gPSBCb3gyRC5Db2xsaXNpb24uYjJTZXBhcmF0aW9uRnVuY3Rpb24sXG4gICAgICBiMlNpbXBsZXggPSBCb3gyRC5Db2xsaXNpb24uYjJTaW1wbGV4LFxuICAgICAgYjJTaW1wbGV4Q2FjaGUgPSBCb3gyRC5Db2xsaXNpb24uYjJTaW1wbGV4Q2FjaGUsXG4gICAgICBiMlNpbXBsZXhWZXJ0ZXggPSBCb3gyRC5Db2xsaXNpb24uYjJTaW1wbGV4VmVydGV4LFxuICAgICAgYjJUaW1lT2ZJbXBhY3QgPSBCb3gyRC5Db2xsaXNpb24uYjJUaW1lT2ZJbXBhY3QsXG4gICAgICBiMlRPSUlucHV0ID0gQm94MkQuQ29sbGlzaW9uLmIyVE9JSW5wdXQsXG4gICAgICBiMldvcmxkTWFuaWZvbGQgPSBCb3gyRC5Db2xsaXNpb24uYjJXb3JsZE1hbmlmb2xkLFxuICAgICAgQ2xpcFZlcnRleCA9IEJveDJELkNvbGxpc2lvbi5DbGlwVmVydGV4LFxuICAgICAgRmVhdHVyZXMgPSBCb3gyRC5Db2xsaXNpb24uRmVhdHVyZXMsXG4gICAgICBJQnJvYWRQaGFzZSA9IEJveDJELkNvbGxpc2lvbi5JQnJvYWRQaGFzZTtcblxuICAgYjJBQUJCLmIyQUFCQiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubG93ZXJCb3VuZCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMudXBwZXJCb3VuZCA9IG5ldyBiMlZlYzIoKTtcbiAgIH07XG4gICBiMkFBQkIucHJvdG90eXBlLklzVmFsaWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZFggPSB0aGlzLnVwcGVyQm91bmQueCAtIHRoaXMubG93ZXJCb3VuZC54O1xuICAgICAgdmFyIGRZID0gdGhpcy51cHBlckJvdW5kLnkgLSB0aGlzLmxvd2VyQm91bmQueTtcbiAgICAgIHZhciB2YWxpZCA9IGRYID49IDAuMCAmJiBkWSA+PSAwLjA7XG4gICAgICB2YWxpZCA9IHZhbGlkICYmIHRoaXMubG93ZXJCb3VuZC5Jc1ZhbGlkKCkgJiYgdGhpcy51cHBlckJvdW5kLklzVmFsaWQoKTtcbiAgICAgIHJldHVybiB2YWxpZDtcbiAgIH1cbiAgIGIyQUFCQi5wcm90b3R5cGUuR2V0Q2VudGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIG5ldyBiMlZlYzIoKHRoaXMubG93ZXJCb3VuZC54ICsgdGhpcy51cHBlckJvdW5kLngpIC8gMiwgKHRoaXMubG93ZXJCb3VuZC55ICsgdGhpcy51cHBlckJvdW5kLnkpIC8gMik7XG4gICB9XG4gICBiMkFBQkIucHJvdG90eXBlLkdldEV4dGVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gbmV3IGIyVmVjMigodGhpcy51cHBlckJvdW5kLnggLSB0aGlzLmxvd2VyQm91bmQueCkgLyAyLCAodGhpcy51cHBlckJvdW5kLnkgLSB0aGlzLmxvd2VyQm91bmQueSkgLyAyKTtcbiAgIH1cbiAgIGIyQUFCQi5wcm90b3R5cGUuQ29udGFpbnMgPSBmdW5jdGlvbiAoYWFiYikge1xuICAgICAgdmFyIHJlc3VsdCA9IHRydWU7XG4gICAgICByZXN1bHQgPSByZXN1bHQgJiYgdGhpcy5sb3dlckJvdW5kLnggPD0gYWFiYi5sb3dlckJvdW5kLng7XG4gICAgICByZXN1bHQgPSByZXN1bHQgJiYgdGhpcy5sb3dlckJvdW5kLnkgPD0gYWFiYi5sb3dlckJvdW5kLnk7XG4gICAgICByZXN1bHQgPSByZXN1bHQgJiYgYWFiYi51cHBlckJvdW5kLnggPD0gdGhpcy51cHBlckJvdW5kLng7XG4gICAgICByZXN1bHQgPSByZXN1bHQgJiYgYWFiYi51cHBlckJvdW5kLnkgPD0gdGhpcy51cHBlckJvdW5kLnk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgfVxuICAgYjJBQUJCLnByb3RvdHlwZS5SYXlDYXN0ID0gZnVuY3Rpb24gKG91dHB1dCwgaW5wdXQpIHtcbiAgICAgIHZhciB0bWluID0gKC1OdW1iZXIuTUFYX1ZBTFVFKTtcbiAgICAgIHZhciB0bWF4ID0gTnVtYmVyLk1BWF9WQUxVRTtcbiAgICAgIHZhciBwWCA9IGlucHV0LnAxLng7XG4gICAgICB2YXIgcFkgPSBpbnB1dC5wMS55O1xuICAgICAgdmFyIGRYID0gaW5wdXQucDIueCAtIGlucHV0LnAxLng7XG4gICAgICB2YXIgZFkgPSBpbnB1dC5wMi55IC0gaW5wdXQucDEueTtcbiAgICAgIHZhciBhYnNEWCA9IE1hdGguYWJzKGRYKTtcbiAgICAgIHZhciBhYnNEWSA9IE1hdGguYWJzKGRZKTtcbiAgICAgIHZhciBub3JtYWwgPSBvdXRwdXQubm9ybWFsO1xuICAgICAgdmFyIGludl9kID0gMDtcbiAgICAgIHZhciB0MSA9IDA7XG4gICAgICB2YXIgdDIgPSAwO1xuICAgICAgdmFyIHQzID0gMDtcbiAgICAgIHZhciBzID0gMDsge1xuICAgICAgICAgaWYgKGFic0RYIDwgTnVtYmVyLk1JTl9WQUxVRSkge1xuICAgICAgICAgICAgaWYgKHBYIDwgdGhpcy5sb3dlckJvdW5kLnggfHwgdGhpcy51cHBlckJvdW5kLnggPCBwWCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpbnZfZCA9IDEuMCAvIGRYO1xuICAgICAgICAgICAgdDEgPSAodGhpcy5sb3dlckJvdW5kLnggLSBwWCkgKiBpbnZfZDtcbiAgICAgICAgICAgIHQyID0gKHRoaXMudXBwZXJCb3VuZC54IC0gcFgpICogaW52X2Q7XG4gICAgICAgICAgICBzID0gKC0xLjApO1xuICAgICAgICAgICAgaWYgKHQxID4gdDIpIHtcbiAgICAgICAgICAgICAgIHQzID0gdDE7XG4gICAgICAgICAgICAgICB0MSA9IHQyO1xuICAgICAgICAgICAgICAgdDIgPSB0MztcbiAgICAgICAgICAgICAgIHMgPSAxLjA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodDEgPiB0bWluKSB7XG4gICAgICAgICAgICAgICBub3JtYWwueCA9IHM7XG4gICAgICAgICAgICAgICBub3JtYWwueSA9IDA7XG4gICAgICAgICAgICAgICB0bWluID0gdDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0bWF4ID0gTWF0aC5taW4odG1heCwgdDIpO1xuICAgICAgICAgICAgaWYgKHRtaW4gPiB0bWF4KSByZXR1cm4gZmFsc2U7XG4gICAgICAgICB9XG4gICAgICB9IHtcbiAgICAgICAgIGlmIChhYnNEWSA8IE51bWJlci5NSU5fVkFMVUUpIHtcbiAgICAgICAgICAgIGlmIChwWSA8IHRoaXMubG93ZXJCb3VuZC55IHx8IHRoaXMudXBwZXJCb3VuZC55IDwgcFkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaW52X2QgPSAxLjAgLyBkWTtcbiAgICAgICAgICAgIHQxID0gKHRoaXMubG93ZXJCb3VuZC55IC0gcFkpICogaW52X2Q7XG4gICAgICAgICAgICB0MiA9ICh0aGlzLnVwcGVyQm91bmQueSAtIHBZKSAqIGludl9kO1xuICAgICAgICAgICAgcyA9ICgtMS4wKTtcbiAgICAgICAgICAgIGlmICh0MSA+IHQyKSB7XG4gICAgICAgICAgICAgICB0MyA9IHQxO1xuICAgICAgICAgICAgICAgdDEgPSB0MjtcbiAgICAgICAgICAgICAgIHQyID0gdDM7XG4gICAgICAgICAgICAgICBzID0gMS4wO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHQxID4gdG1pbikge1xuICAgICAgICAgICAgICAgbm9ybWFsLnkgPSBzO1xuICAgICAgICAgICAgICAgbm9ybWFsLnggPSAwO1xuICAgICAgICAgICAgICAgdG1pbiA9IHQxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdG1heCA9IE1hdGgubWluKHRtYXgsIHQyKTtcbiAgICAgICAgICAgIGlmICh0bWluID4gdG1heCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgb3V0cHV0LmZyYWN0aW9uID0gdG1pbjtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgfVxuICAgYjJBQUJCLnByb3RvdHlwZS5UZXN0T3ZlcmxhcCA9IGZ1bmN0aW9uIChvdGhlcikge1xuICAgICAgdmFyIGQxWCA9IG90aGVyLmxvd2VyQm91bmQueCAtIHRoaXMudXBwZXJCb3VuZC54O1xuICAgICAgdmFyIGQxWSA9IG90aGVyLmxvd2VyQm91bmQueSAtIHRoaXMudXBwZXJCb3VuZC55O1xuICAgICAgdmFyIGQyWCA9IHRoaXMubG93ZXJCb3VuZC54IC0gb3RoZXIudXBwZXJCb3VuZC54O1xuICAgICAgdmFyIGQyWSA9IHRoaXMubG93ZXJCb3VuZC55IC0gb3RoZXIudXBwZXJCb3VuZC55O1xuICAgICAgaWYgKGQxWCA+IDAuMCB8fCBkMVkgPiAwLjApIHJldHVybiBmYWxzZTtcbiAgICAgIGlmIChkMlggPiAwLjAgfHwgZDJZID4gMC4wKSByZXR1cm4gZmFsc2U7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgIH1cbiAgIGIyQUFCQi5Db21iaW5lID0gZnVuY3Rpb24gKGFhYmIxLCBhYWJiMikge1xuICAgICAgdmFyIGFhYmIgPSBuZXcgYjJBQUJCKCk7XG4gICAgICBhYWJiLkNvbWJpbmUoYWFiYjEsIGFhYmIyKTtcbiAgICAgIHJldHVybiBhYWJiO1xuICAgfVxuICAgYjJBQUJCLnByb3RvdHlwZS5Db21iaW5lID0gZnVuY3Rpb24gKGFhYmIxLCBhYWJiMikge1xuICAgICAgdGhpcy5sb3dlckJvdW5kLnggPSBNYXRoLm1pbihhYWJiMS5sb3dlckJvdW5kLngsIGFhYmIyLmxvd2VyQm91bmQueCk7XG4gICAgICB0aGlzLmxvd2VyQm91bmQueSA9IE1hdGgubWluKGFhYmIxLmxvd2VyQm91bmQueSwgYWFiYjIubG93ZXJCb3VuZC55KTtcbiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgoYWFiYjEudXBwZXJCb3VuZC54LCBhYWJiMi51cHBlckJvdW5kLngpO1xuICAgICAgdGhpcy51cHBlckJvdW5kLnkgPSBNYXRoLm1heChhYWJiMS51cHBlckJvdW5kLnksIGFhYmIyLnVwcGVyQm91bmQueSk7XG4gICB9XG4gICBiMkJvdW5kLmIyQm91bmQgPSBmdW5jdGlvbiAoKSB7fTtcbiAgIGIyQm91bmQucHJvdG90eXBlLklzTG93ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gKHRoaXMudmFsdWUgJiAxKSA9PSAwO1xuICAgfVxuICAgYjJCb3VuZC5wcm90b3R5cGUuSXNVcHBlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiAodGhpcy52YWx1ZSAmIDEpID09IDE7XG4gICB9XG4gICBiMkJvdW5kLnByb3RvdHlwZS5Td2FwID0gZnVuY3Rpb24gKGIpIHtcbiAgICAgIHZhciB0ZW1wVmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgICAgdmFyIHRlbXBQcm94eSA9IHRoaXMucHJveHk7XG4gICAgICB2YXIgdGVtcFN0YWJiaW5nQ291bnQgPSB0aGlzLnN0YWJiaW5nQ291bnQ7XG4gICAgICB0aGlzLnZhbHVlID0gYi52YWx1ZTtcbiAgICAgIHRoaXMucHJveHkgPSBiLnByb3h5O1xuICAgICAgdGhpcy5zdGFiYmluZ0NvdW50ID0gYi5zdGFiYmluZ0NvdW50O1xuICAgICAgYi52YWx1ZSA9IHRlbXBWYWx1ZTtcbiAgICAgIGIucHJveHkgPSB0ZW1wUHJveHk7XG4gICAgICBiLnN0YWJiaW5nQ291bnQgPSB0ZW1wU3RhYmJpbmdDb3VudDtcbiAgIH1cbiAgIGIyQm91bmRWYWx1ZXMuYjJCb3VuZFZhbHVlcyA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJCb3VuZFZhbHVlcy5wcm90b3R5cGUuYjJCb3VuZFZhbHVlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubG93ZXJWYWx1ZXMgPSBuZXcgVmVjdG9yX2Eyal9OdW1iZXIoKTtcbiAgICAgIHRoaXMubG93ZXJWYWx1ZXNbMF0gPSAwLjA7XG4gICAgICB0aGlzLmxvd2VyVmFsdWVzWzFdID0gMC4wO1xuICAgICAgdGhpcy51cHBlclZhbHVlcyA9IG5ldyBWZWN0b3JfYTJqX051bWJlcigpO1xuICAgICAgdGhpcy51cHBlclZhbHVlc1swXSA9IDAuMDtcbiAgICAgIHRoaXMudXBwZXJWYWx1ZXNbMV0gPSAwLjA7XG4gICB9XG4gICBiMkNvbGxpc2lvbi5iMkNvbGxpc2lvbiA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJDb2xsaXNpb24uQ2xpcFNlZ21lbnRUb0xpbmUgPSBmdW5jdGlvbiAodk91dCwgdkluLCBub3JtYWwsIG9mZnNldCkge1xuICAgICAgaWYgKG9mZnNldCA9PT0gdW5kZWZpbmVkKSBvZmZzZXQgPSAwO1xuICAgICAgdmFyIGN2O1xuICAgICAgdmFyIG51bU91dCA9IDA7XG4gICAgICBjdiA9IHZJblswXTtcbiAgICAgIHZhciB2SW4wID0gY3YudjtcbiAgICAgIGN2ID0gdkluWzFdO1xuICAgICAgdmFyIHZJbjEgPSBjdi52O1xuICAgICAgdmFyIGRpc3RhbmNlMCA9IG5vcm1hbC54ICogdkluMC54ICsgbm9ybWFsLnkgKiB2SW4wLnkgLSBvZmZzZXQ7XG4gICAgICB2YXIgZGlzdGFuY2UxID0gbm9ybWFsLnggKiB2SW4xLnggKyBub3JtYWwueSAqIHZJbjEueSAtIG9mZnNldDtcbiAgICAgIGlmIChkaXN0YW5jZTAgPD0gMC4wKSB2T3V0W251bU91dCsrXS5TZXQodkluWzBdKTtcbiAgICAgIGlmIChkaXN0YW5jZTEgPD0gMC4wKSB2T3V0W251bU91dCsrXS5TZXQodkluWzFdKTtcbiAgICAgIGlmIChkaXN0YW5jZTAgKiBkaXN0YW5jZTEgPCAwLjApIHtcbiAgICAgICAgIHZhciBpbnRlcnAgPSBkaXN0YW5jZTAgLyAoZGlzdGFuY2UwIC0gZGlzdGFuY2UxKTtcbiAgICAgICAgIGN2ID0gdk91dFtudW1PdXRdO1xuICAgICAgICAgdmFyIHRWZWMgPSBjdi52O1xuICAgICAgICAgdFZlYy54ID0gdkluMC54ICsgaW50ZXJwICogKHZJbjEueCAtIHZJbjAueCk7XG4gICAgICAgICB0VmVjLnkgPSB2SW4wLnkgKyBpbnRlcnAgKiAodkluMS55IC0gdkluMC55KTtcbiAgICAgICAgIGN2ID0gdk91dFtudW1PdXRdO1xuICAgICAgICAgdmFyIGN2MjtcbiAgICAgICAgIGlmIChkaXN0YW5jZTAgPiAwLjApIHtcbiAgICAgICAgICAgIGN2MiA9IHZJblswXTtcbiAgICAgICAgICAgIGN2LmlkID0gY3YyLmlkO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjdjIgPSB2SW5bMV07XG4gICAgICAgICAgICBjdi5pZCA9IGN2Mi5pZDtcbiAgICAgICAgIH0rK251bU91dDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBudW1PdXQ7XG4gICB9XG4gICBiMkNvbGxpc2lvbi5FZGdlU2VwYXJhdGlvbiA9IGZ1bmN0aW9uIChwb2x5MSwgeGYxLCBlZGdlMSwgcG9seTIsIHhmMikge1xuICAgICAgaWYgKGVkZ2UxID09PSB1bmRlZmluZWQpIGVkZ2UxID0gMDtcbiAgICAgIHZhciBjb3VudDEgPSBwYXJzZUludChwb2x5MS5tX3ZlcnRleENvdW50KTtcbiAgICAgIHZhciB2ZXJ0aWNlczEgPSBwb2x5MS5tX3ZlcnRpY2VzO1xuICAgICAgdmFyIG5vcm1hbHMxID0gcG9seTEubV9ub3JtYWxzO1xuICAgICAgdmFyIGNvdW50MiA9IHBhcnNlSW50KHBvbHkyLm1fdmVydGV4Q291bnQpO1xuICAgICAgdmFyIHZlcnRpY2VzMiA9IHBvbHkyLm1fdmVydGljZXM7XG4gICAgICB2YXIgdE1hdDtcbiAgICAgIHZhciB0VmVjO1xuICAgICAgdE1hdCA9IHhmMS5SO1xuICAgICAgdFZlYyA9IG5vcm1hbHMxW2VkZ2UxXTtcbiAgICAgIHZhciBub3JtYWwxV29ybGRYID0gKHRNYXQuY29sMS54ICogdFZlYy54ICsgdE1hdC5jb2wyLnggKiB0VmVjLnkpO1xuICAgICAgdmFyIG5vcm1hbDFXb3JsZFkgPSAodE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueSk7XG4gICAgICB0TWF0ID0geGYyLlI7XG4gICAgICB2YXIgbm9ybWFsMVggPSAodE1hdC5jb2wxLnggKiBub3JtYWwxV29ybGRYICsgdE1hdC5jb2wxLnkgKiBub3JtYWwxV29ybGRZKTtcbiAgICAgIHZhciBub3JtYWwxWSA9ICh0TWF0LmNvbDIueCAqIG5vcm1hbDFXb3JsZFggKyB0TWF0LmNvbDIueSAqIG5vcm1hbDFXb3JsZFkpO1xuICAgICAgdmFyIGluZGV4ID0gMDtcbiAgICAgIHZhciBtaW5Eb3QgPSBOdW1iZXIuTUFYX1ZBTFVFO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDI7ICsraSkge1xuICAgICAgICAgdFZlYyA9IHZlcnRpY2VzMltpXTtcbiAgICAgICAgIHZhciBkb3QgPSB0VmVjLnggKiBub3JtYWwxWCArIHRWZWMueSAqIG5vcm1hbDFZO1xuICAgICAgICAgaWYgKGRvdCA8IG1pbkRvdCkge1xuICAgICAgICAgICAgbWluRG90ID0gZG90O1xuICAgICAgICAgICAgaW5kZXggPSBpO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgdFZlYyA9IHZlcnRpY2VzMVtlZGdlMV07XG4gICAgICB0TWF0ID0geGYxLlI7XG4gICAgICB2YXIgdjFYID0geGYxLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICB2YXIgdjFZID0geGYxLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueSk7XG4gICAgICB0VmVjID0gdmVydGljZXMyW2luZGV4XTtcbiAgICAgIHRNYXQgPSB4ZjIuUjtcbiAgICAgIHZhciB2MlggPSB4ZjIucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55KTtcbiAgICAgIHZhciB2MlkgPSB4ZjIucG9zaXRpb24ueSArICh0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55KTtcbiAgICAgIHYyWCAtPSB2MVg7XG4gICAgICB2MlkgLT0gdjFZO1xuICAgICAgdmFyIHNlcGFyYXRpb24gPSB2MlggKiBub3JtYWwxV29ybGRYICsgdjJZICogbm9ybWFsMVdvcmxkWTtcbiAgICAgIHJldHVybiBzZXBhcmF0aW9uO1xuICAgfVxuICAgYjJDb2xsaXNpb24uRmluZE1heFNlcGFyYXRpb24gPSBmdW5jdGlvbiAoZWRnZUluZGV4LCBwb2x5MSwgeGYxLCBwb2x5MiwgeGYyKSB7XG4gICAgICB2YXIgY291bnQxID0gcGFyc2VJbnQocG9seTEubV92ZXJ0ZXhDb3VudCk7XG4gICAgICB2YXIgbm9ybWFsczEgPSBwb2x5MS5tX25vcm1hbHM7XG4gICAgICB2YXIgdFZlYztcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdE1hdCA9IHhmMi5SO1xuICAgICAgdFZlYyA9IHBvbHkyLm1fY2VudHJvaWQ7XG4gICAgICB2YXIgZFggPSB4ZjIucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55KTtcbiAgICAgIHZhciBkWSA9IHhmMi5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgdE1hdCA9IHhmMS5SO1xuICAgICAgdFZlYyA9IHBvbHkxLm1fY2VudHJvaWQ7XG4gICAgICBkWCAtPSB4ZjEucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55KTtcbiAgICAgIGRZIC09IHhmMS5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgdmFyIGRMb2NhbDFYID0gKGRYICogeGYxLlIuY29sMS54ICsgZFkgKiB4ZjEuUi5jb2wxLnkpO1xuICAgICAgdmFyIGRMb2NhbDFZID0gKGRYICogeGYxLlIuY29sMi54ICsgZFkgKiB4ZjEuUi5jb2wyLnkpO1xuICAgICAgdmFyIGVkZ2UgPSAwO1xuICAgICAgdmFyIG1heERvdCA9ICgtTnVtYmVyLk1BWF9WQUxVRSk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50MTsgKytpKSB7XG4gICAgICAgICB0VmVjID0gbm9ybWFsczFbaV07XG4gICAgICAgICB2YXIgZG90ID0gKHRWZWMueCAqIGRMb2NhbDFYICsgdFZlYy55ICogZExvY2FsMVkpO1xuICAgICAgICAgaWYgKGRvdCA+IG1heERvdCkge1xuICAgICAgICAgICAgbWF4RG90ID0gZG90O1xuICAgICAgICAgICAgZWRnZSA9IGk7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICB2YXIgcyA9IGIyQ29sbGlzaW9uLkVkZ2VTZXBhcmF0aW9uKHBvbHkxLCB4ZjEsIGVkZ2UsIHBvbHkyLCB4ZjIpO1xuICAgICAgdmFyIHByZXZFZGdlID0gcGFyc2VJbnQoZWRnZSAtIDEgPj0gMCA/IGVkZ2UgLSAxIDogY291bnQxIC0gMSk7XG4gICAgICB2YXIgc1ByZXYgPSBiMkNvbGxpc2lvbi5FZGdlU2VwYXJhdGlvbihwb2x5MSwgeGYxLCBwcmV2RWRnZSwgcG9seTIsIHhmMik7XG4gICAgICB2YXIgbmV4dEVkZ2UgPSBwYXJzZUludChlZGdlICsgMSA8IGNvdW50MSA/IGVkZ2UgKyAxIDogMCk7XG4gICAgICB2YXIgc05leHQgPSBiMkNvbGxpc2lvbi5FZGdlU2VwYXJhdGlvbihwb2x5MSwgeGYxLCBuZXh0RWRnZSwgcG9seTIsIHhmMik7XG4gICAgICB2YXIgYmVzdEVkZ2UgPSAwO1xuICAgICAgdmFyIGJlc3RTZXBhcmF0aW9uID0gMDtcbiAgICAgIHZhciBpbmNyZW1lbnQgPSAwO1xuICAgICAgaWYgKHNQcmV2ID4gcyAmJiBzUHJldiA+IHNOZXh0KSB7XG4gICAgICAgICBpbmNyZW1lbnQgPSAoLTEpO1xuICAgICAgICAgYmVzdEVkZ2UgPSBwcmV2RWRnZTtcbiAgICAgICAgIGJlc3RTZXBhcmF0aW9uID0gc1ByZXY7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChzTmV4dCA+IHMpIHtcbiAgICAgICAgIGluY3JlbWVudCA9IDE7XG4gICAgICAgICBiZXN0RWRnZSA9IG5leHRFZGdlO1xuICAgICAgICAgYmVzdFNlcGFyYXRpb24gPSBzTmV4dDtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgZWRnZUluZGV4WzBdID0gZWRnZTtcbiAgICAgICAgIHJldHVybiBzO1xuICAgICAgfVxuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgIGlmIChpbmNyZW1lbnQgPT0gKC0xKSkgZWRnZSA9IGJlc3RFZGdlIC0gMSA+PSAwID8gYmVzdEVkZ2UgLSAxIDogY291bnQxIC0gMTtcbiAgICAgICAgIGVsc2UgZWRnZSA9IGJlc3RFZGdlICsgMSA8IGNvdW50MSA/IGJlc3RFZGdlICsgMSA6IDA7cyA9IGIyQ29sbGlzaW9uLkVkZ2VTZXBhcmF0aW9uKHBvbHkxLCB4ZjEsIGVkZ2UsIHBvbHkyLCB4ZjIpO1xuICAgICAgICAgaWYgKHMgPiBiZXN0U2VwYXJhdGlvbikge1xuICAgICAgICAgICAgYmVzdEVkZ2UgPSBlZGdlO1xuICAgICAgICAgICAgYmVzdFNlcGFyYXRpb24gPSBzO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVkZ2VJbmRleFswXSA9IGJlc3RFZGdlO1xuICAgICAgcmV0dXJuIGJlc3RTZXBhcmF0aW9uO1xuICAgfVxuICAgYjJDb2xsaXNpb24uRmluZEluY2lkZW50RWRnZSA9IGZ1bmN0aW9uIChjLCBwb2x5MSwgeGYxLCBlZGdlMSwgcG9seTIsIHhmMikge1xuICAgICAgaWYgKGVkZ2UxID09PSB1bmRlZmluZWQpIGVkZ2UxID0gMDtcbiAgICAgIHZhciBjb3VudDEgPSBwYXJzZUludChwb2x5MS5tX3ZlcnRleENvdW50KTtcbiAgICAgIHZhciBub3JtYWxzMSA9IHBvbHkxLm1fbm9ybWFscztcbiAgICAgIHZhciBjb3VudDIgPSBwYXJzZUludChwb2x5Mi5tX3ZlcnRleENvdW50KTtcbiAgICAgIHZhciB2ZXJ0aWNlczIgPSBwb2x5Mi5tX3ZlcnRpY2VzO1xuICAgICAgdmFyIG5vcm1hbHMyID0gcG9seTIubV9ub3JtYWxzO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB2YXIgdFZlYztcbiAgICAgIHRNYXQgPSB4ZjEuUjtcbiAgICAgIHRWZWMgPSBub3JtYWxzMVtlZGdlMV07XG4gICAgICB2YXIgbm9ybWFsMVggPSAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICB2YXIgbm9ybWFsMVkgPSAodE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueSk7XG4gICAgICB0TWF0ID0geGYyLlI7XG4gICAgICB2YXIgdFggPSAodE1hdC5jb2wxLnggKiBub3JtYWwxWCArIHRNYXQuY29sMS55ICogbm9ybWFsMVkpO1xuICAgICAgbm9ybWFsMVkgPSAodE1hdC5jb2wyLnggKiBub3JtYWwxWCArIHRNYXQuY29sMi55ICogbm9ybWFsMVkpO1xuICAgICAgbm9ybWFsMVggPSB0WDtcbiAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICB2YXIgbWluRG90ID0gTnVtYmVyLk1BWF9WQUxVRTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQyOyArK2kpIHtcbiAgICAgICAgIHRWZWMgPSBub3JtYWxzMltpXTtcbiAgICAgICAgIHZhciBkb3QgPSAobm9ybWFsMVggKiB0VmVjLnggKyBub3JtYWwxWSAqIHRWZWMueSk7XG4gICAgICAgICBpZiAoZG90IDwgbWluRG90KSB7XG4gICAgICAgICAgICBtaW5Eb3QgPSBkb3Q7XG4gICAgICAgICAgICBpbmRleCA9IGk7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICB2YXIgdENsaXA7XG4gICAgICB2YXIgaTEgPSBwYXJzZUludChpbmRleCk7XG4gICAgICB2YXIgaTIgPSBwYXJzZUludChpMSArIDEgPCBjb3VudDIgPyBpMSArIDEgOiAwKTtcbiAgICAgIHRDbGlwID0gY1swXTtcbiAgICAgIHRWZWMgPSB2ZXJ0aWNlczJbaTFdO1xuICAgICAgdE1hdCA9IHhmMi5SO1xuICAgICAgdENsaXAudi54ID0geGYyLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICB0Q2xpcC52LnkgPSB4ZjIucG9zaXRpb24ueSArICh0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55KTtcbiAgICAgIHRDbGlwLmlkLmZlYXR1cmVzLnJlZmVyZW5jZUVkZ2UgPSBlZGdlMTtcbiAgICAgIHRDbGlwLmlkLmZlYXR1cmVzLmluY2lkZW50RWRnZSA9IGkxO1xuICAgICAgdENsaXAuaWQuZmVhdHVyZXMuaW5jaWRlbnRWZXJ0ZXggPSAwO1xuICAgICAgdENsaXAgPSBjWzFdO1xuICAgICAgdFZlYyA9IHZlcnRpY2VzMltpMl07XG4gICAgICB0TWF0ID0geGYyLlI7XG4gICAgICB0Q2xpcC52LnggPSB4ZjIucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55KTtcbiAgICAgIHRDbGlwLnYueSA9IHhmMi5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgdENsaXAuaWQuZmVhdHVyZXMucmVmZXJlbmNlRWRnZSA9IGVkZ2UxO1xuICAgICAgdENsaXAuaWQuZmVhdHVyZXMuaW5jaWRlbnRFZGdlID0gaTI7XG4gICAgICB0Q2xpcC5pZC5mZWF0dXJlcy5pbmNpZGVudFZlcnRleCA9IDE7XG4gICB9XG4gICBiMkNvbGxpc2lvbi5NYWtlQ2xpcFBvaW50VmVjdG9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHIgPSBuZXcgVmVjdG9yKDIpO1xuICAgICAgclswXSA9IG5ldyBDbGlwVmVydGV4KCk7XG4gICAgICByWzFdID0gbmV3IENsaXBWZXJ0ZXgoKTtcbiAgICAgIHJldHVybiByO1xuICAgfVxuICAgYjJDb2xsaXNpb24uQ29sbGlkZVBvbHlnb25zID0gZnVuY3Rpb24gKG1hbmlmb2xkLCBwb2x5QSwgeGZBLCBwb2x5QiwgeGZCKSB7XG4gICAgICB2YXIgY3Y7XG4gICAgICBtYW5pZm9sZC5tX3BvaW50Q291bnQgPSAwO1xuICAgICAgdmFyIHRvdGFsUmFkaXVzID0gcG9seUEubV9yYWRpdXMgKyBwb2x5Qi5tX3JhZGl1cztcbiAgICAgIHZhciBlZGdlQSA9IDA7XG4gICAgICBiMkNvbGxpc2lvbi5zX2VkZ2VBT1swXSA9IGVkZ2VBO1xuICAgICAgdmFyIHNlcGFyYXRpb25BID0gYjJDb2xsaXNpb24uRmluZE1heFNlcGFyYXRpb24oYjJDb2xsaXNpb24uc19lZGdlQU8sIHBvbHlBLCB4ZkEsIHBvbHlCLCB4ZkIpO1xuICAgICAgZWRnZUEgPSBiMkNvbGxpc2lvbi5zX2VkZ2VBT1swXTtcbiAgICAgIGlmIChzZXBhcmF0aW9uQSA+IHRvdGFsUmFkaXVzKSByZXR1cm47XG4gICAgICB2YXIgZWRnZUIgPSAwO1xuICAgICAgYjJDb2xsaXNpb24uc19lZGdlQk9bMF0gPSBlZGdlQjtcbiAgICAgIHZhciBzZXBhcmF0aW9uQiA9IGIyQ29sbGlzaW9uLkZpbmRNYXhTZXBhcmF0aW9uKGIyQ29sbGlzaW9uLnNfZWRnZUJPLCBwb2x5QiwgeGZCLCBwb2x5QSwgeGZBKTtcbiAgICAgIGVkZ2VCID0gYjJDb2xsaXNpb24uc19lZGdlQk9bMF07XG4gICAgICBpZiAoc2VwYXJhdGlvbkIgPiB0b3RhbFJhZGl1cykgcmV0dXJuO1xuICAgICAgdmFyIHBvbHkxO1xuICAgICAgdmFyIHBvbHkyO1xuICAgICAgdmFyIHhmMTtcbiAgICAgIHZhciB4ZjI7XG4gICAgICB2YXIgZWRnZTEgPSAwO1xuICAgICAgdmFyIGZsaXAgPSAwO1xuICAgICAgdmFyIGtfcmVsYXRpdmVUb2wgPSAwLjk4O1xuICAgICAgdmFyIGtfYWJzb2x1dGVUb2wgPSAwLjAwMTtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgaWYgKHNlcGFyYXRpb25CID4ga19yZWxhdGl2ZVRvbCAqIHNlcGFyYXRpb25BICsga19hYnNvbHV0ZVRvbCkge1xuICAgICAgICAgcG9seTEgPSBwb2x5QjtcbiAgICAgICAgIHBvbHkyID0gcG9seUE7XG4gICAgICAgICB4ZjEgPSB4ZkI7XG4gICAgICAgICB4ZjIgPSB4ZkE7XG4gICAgICAgICBlZGdlMSA9IGVkZ2VCO1xuICAgICAgICAgbWFuaWZvbGQubV90eXBlID0gYjJNYW5pZm9sZC5lX2ZhY2VCO1xuICAgICAgICAgZmxpcCA9IDE7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHBvbHkxID0gcG9seUE7XG4gICAgICAgICBwb2x5MiA9IHBvbHlCO1xuICAgICAgICAgeGYxID0geGZBO1xuICAgICAgICAgeGYyID0geGZCO1xuICAgICAgICAgZWRnZTEgPSBlZGdlQTtcbiAgICAgICAgIG1hbmlmb2xkLm1fdHlwZSA9IGIyTWFuaWZvbGQuZV9mYWNlQTtcbiAgICAgICAgIGZsaXAgPSAwO1xuICAgICAgfVxuICAgICAgdmFyIGluY2lkZW50RWRnZSA9IGIyQ29sbGlzaW9uLnNfaW5jaWRlbnRFZGdlO1xuICAgICAgYjJDb2xsaXNpb24uRmluZEluY2lkZW50RWRnZShpbmNpZGVudEVkZ2UsIHBvbHkxLCB4ZjEsIGVkZ2UxLCBwb2x5MiwgeGYyKTtcbiAgICAgIHZhciBjb3VudDEgPSBwYXJzZUludChwb2x5MS5tX3ZlcnRleENvdW50KTtcbiAgICAgIHZhciB2ZXJ0aWNlczEgPSBwb2x5MS5tX3ZlcnRpY2VzO1xuICAgICAgdmFyIGxvY2FsX3YxMSA9IHZlcnRpY2VzMVtlZGdlMV07XG4gICAgICB2YXIgbG9jYWxfdjEyO1xuICAgICAgaWYgKGVkZ2UxICsgMSA8IGNvdW50MSkge1xuICAgICAgICAgbG9jYWxfdjEyID0gdmVydGljZXMxW3BhcnNlSW50KGVkZ2UxICsgMSldO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICBsb2NhbF92MTIgPSB2ZXJ0aWNlczFbMF07XG4gICAgICB9XG4gICAgICB2YXIgbG9jYWxUYW5nZW50ID0gYjJDb2xsaXNpb24uc19sb2NhbFRhbmdlbnQ7XG4gICAgICBsb2NhbFRhbmdlbnQuU2V0KGxvY2FsX3YxMi54IC0gbG9jYWxfdjExLngsIGxvY2FsX3YxMi55IC0gbG9jYWxfdjExLnkpO1xuICAgICAgbG9jYWxUYW5nZW50Lk5vcm1hbGl6ZSgpO1xuICAgICAgdmFyIGxvY2FsTm9ybWFsID0gYjJDb2xsaXNpb24uc19sb2NhbE5vcm1hbDtcbiAgICAgIGxvY2FsTm9ybWFsLnggPSBsb2NhbFRhbmdlbnQueTtcbiAgICAgIGxvY2FsTm9ybWFsLnkgPSAoLWxvY2FsVGFuZ2VudC54KTtcbiAgICAgIHZhciBwbGFuZVBvaW50ID0gYjJDb2xsaXNpb24uc19wbGFuZVBvaW50O1xuICAgICAgcGxhbmVQb2ludC5TZXQoMC41ICogKGxvY2FsX3YxMS54ICsgbG9jYWxfdjEyLngpLCAwLjUgKiAobG9jYWxfdjExLnkgKyBsb2NhbF92MTIueSkpO1xuICAgICAgdmFyIHRhbmdlbnQgPSBiMkNvbGxpc2lvbi5zX3RhbmdlbnQ7XG4gICAgICB0TWF0ID0geGYxLlI7XG4gICAgICB0YW5nZW50LnggPSAodE1hdC5jb2wxLnggKiBsb2NhbFRhbmdlbnQueCArIHRNYXQuY29sMi54ICogbG9jYWxUYW5nZW50LnkpO1xuICAgICAgdGFuZ2VudC55ID0gKHRNYXQuY29sMS55ICogbG9jYWxUYW5nZW50LnggKyB0TWF0LmNvbDIueSAqIGxvY2FsVGFuZ2VudC55KTtcbiAgICAgIHZhciB0YW5nZW50MiA9IGIyQ29sbGlzaW9uLnNfdGFuZ2VudDI7XG4gICAgICB0YW5nZW50Mi54ID0gKC10YW5nZW50LngpO1xuICAgICAgdGFuZ2VudDIueSA9ICgtdGFuZ2VudC55KTtcbiAgICAgIHZhciBub3JtYWwgPSBiMkNvbGxpc2lvbi5zX25vcm1hbDtcbiAgICAgIG5vcm1hbC54ID0gdGFuZ2VudC55O1xuICAgICAgbm9ybWFsLnkgPSAoLXRhbmdlbnQueCk7XG4gICAgICB2YXIgdjExID0gYjJDb2xsaXNpb24uc192MTE7XG4gICAgICB2YXIgdjEyID0gYjJDb2xsaXNpb24uc192MTI7XG4gICAgICB2MTEueCA9IHhmMS5wb3NpdGlvbi54ICsgKHRNYXQuY29sMS54ICogbG9jYWxfdjExLnggKyB0TWF0LmNvbDIueCAqIGxvY2FsX3YxMS55KTtcbiAgICAgIHYxMS55ID0geGYxLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiBsb2NhbF92MTEueCArIHRNYXQuY29sMi55ICogbG9jYWxfdjExLnkpO1xuICAgICAgdjEyLnggPSB4ZjEucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIGxvY2FsX3YxMi54ICsgdE1hdC5jb2wyLnggKiBsb2NhbF92MTIueSk7XG4gICAgICB2MTIueSA9IHhmMS5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogbG9jYWxfdjEyLnggKyB0TWF0LmNvbDIueSAqIGxvY2FsX3YxMi55KTtcbiAgICAgIHZhciBmcm9udE9mZnNldCA9IG5vcm1hbC54ICogdjExLnggKyBub3JtYWwueSAqIHYxMS55O1xuICAgICAgdmFyIHNpZGVPZmZzZXQxID0gKC10YW5nZW50LnggKiB2MTEueCkgLSB0YW5nZW50LnkgKiB2MTEueSArIHRvdGFsUmFkaXVzO1xuICAgICAgdmFyIHNpZGVPZmZzZXQyID0gdGFuZ2VudC54ICogdjEyLnggKyB0YW5nZW50LnkgKiB2MTIueSArIHRvdGFsUmFkaXVzO1xuICAgICAgdmFyIGNsaXBQb2ludHMxID0gYjJDb2xsaXNpb24uc19jbGlwUG9pbnRzMTtcbiAgICAgIHZhciBjbGlwUG9pbnRzMiA9IGIyQ29sbGlzaW9uLnNfY2xpcFBvaW50czI7XG4gICAgICB2YXIgbnAgPSAwO1xuICAgICAgbnAgPSBiMkNvbGxpc2lvbi5DbGlwU2VnbWVudFRvTGluZShjbGlwUG9pbnRzMSwgaW5jaWRlbnRFZGdlLCB0YW5nZW50Miwgc2lkZU9mZnNldDEpO1xuICAgICAgaWYgKG5wIDwgMikgcmV0dXJuO1xuICAgICAgbnAgPSBiMkNvbGxpc2lvbi5DbGlwU2VnbWVudFRvTGluZShjbGlwUG9pbnRzMiwgY2xpcFBvaW50czEsIHRhbmdlbnQsIHNpZGVPZmZzZXQyKTtcbiAgICAgIGlmIChucCA8IDIpIHJldHVybjtcbiAgICAgIG1hbmlmb2xkLm1fbG9jYWxQbGFuZU5vcm1hbC5TZXRWKGxvY2FsTm9ybWFsKTtcbiAgICAgIG1hbmlmb2xkLm1fbG9jYWxQb2ludC5TZXRWKHBsYW5lUG9pbnQpO1xuICAgICAgdmFyIHBvaW50Q291bnQgPSAwO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiMlNldHRpbmdzLmIyX21heE1hbmlmb2xkUG9pbnRzOyArK2kpIHtcbiAgICAgICAgIGN2ID0gY2xpcFBvaW50czJbaV07XG4gICAgICAgICB2YXIgc2VwYXJhdGlvbiA9IG5vcm1hbC54ICogY3Yudi54ICsgbm9ybWFsLnkgKiBjdi52LnkgLSBmcm9udE9mZnNldDtcbiAgICAgICAgIGlmIChzZXBhcmF0aW9uIDw9IHRvdGFsUmFkaXVzKSB7XG4gICAgICAgICAgICB2YXIgY3AgPSBtYW5pZm9sZC5tX3BvaW50c1twb2ludENvdW50XTtcbiAgICAgICAgICAgIHRNYXQgPSB4ZjIuUjtcbiAgICAgICAgICAgIHZhciB0WCA9IGN2LnYueCAtIHhmMi5wb3NpdGlvbi54O1xuICAgICAgICAgICAgdmFyIHRZID0gY3Yudi55IC0geGYyLnBvc2l0aW9uLnk7XG4gICAgICAgICAgICBjcC5tX2xvY2FsUG9pbnQueCA9ICh0WCAqIHRNYXQuY29sMS54ICsgdFkgKiB0TWF0LmNvbDEueSk7XG4gICAgICAgICAgICBjcC5tX2xvY2FsUG9pbnQueSA9ICh0WCAqIHRNYXQuY29sMi54ICsgdFkgKiB0TWF0LmNvbDIueSk7XG4gICAgICAgICAgICBjcC5tX2lkLlNldChjdi5pZCk7XG4gICAgICAgICAgICBjcC5tX2lkLmZlYXR1cmVzLmZsaXAgPSBmbGlwO1xuICAgICAgICAgICAgKytwb2ludENvdW50O1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgbWFuaWZvbGQubV9wb2ludENvdW50ID0gcG9pbnRDb3VudDtcbiAgIH1cbiAgIGIyQ29sbGlzaW9uLkNvbGxpZGVDaXJjbGVzID0gZnVuY3Rpb24gKG1hbmlmb2xkLCBjaXJjbGUxLCB4ZjEsIGNpcmNsZTIsIHhmMikge1xuICAgICAgbWFuaWZvbGQubV9wb2ludENvdW50ID0gMDtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIHRWZWM7XG4gICAgICB0TWF0ID0geGYxLlI7XG4gICAgICB0VmVjID0gY2lyY2xlMS5tX3A7XG4gICAgICB2YXIgcDFYID0geGYxLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICB2YXIgcDFZID0geGYxLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueSk7XG4gICAgICB0TWF0ID0geGYyLlI7XG4gICAgICB0VmVjID0gY2lyY2xlMi5tX3A7XG4gICAgICB2YXIgcDJYID0geGYyLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICB2YXIgcDJZID0geGYyLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueSk7XG4gICAgICB2YXIgZFggPSBwMlggLSBwMVg7XG4gICAgICB2YXIgZFkgPSBwMlkgLSBwMVk7XG4gICAgICB2YXIgZGlzdFNxciA9IGRYICogZFggKyBkWSAqIGRZO1xuICAgICAgdmFyIHJhZGl1cyA9IGNpcmNsZTEubV9yYWRpdXMgKyBjaXJjbGUyLm1fcmFkaXVzO1xuICAgICAgaWYgKGRpc3RTcXIgPiByYWRpdXMgKiByYWRpdXMpIHtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIG1hbmlmb2xkLm1fdHlwZSA9IGIyTWFuaWZvbGQuZV9jaXJjbGVzO1xuICAgICAgbWFuaWZvbGQubV9sb2NhbFBvaW50LlNldFYoY2lyY2xlMS5tX3ApO1xuICAgICAgbWFuaWZvbGQubV9sb2NhbFBsYW5lTm9ybWFsLlNldFplcm8oKTtcbiAgICAgIG1hbmlmb2xkLm1fcG9pbnRDb3VudCA9IDE7XG4gICAgICBtYW5pZm9sZC5tX3BvaW50c1swXS5tX2xvY2FsUG9pbnQuU2V0VihjaXJjbGUyLm1fcCk7XG4gICAgICBtYW5pZm9sZC5tX3BvaW50c1swXS5tX2lkLmtleSA9IDA7XG4gICB9XG4gICBiMkNvbGxpc2lvbi5Db2xsaWRlUG9seWdvbkFuZENpcmNsZSA9IGZ1bmN0aW9uIChtYW5pZm9sZCwgcG9seWdvbiwgeGYxLCBjaXJjbGUsIHhmMikge1xuICAgICAgbWFuaWZvbGQubV9wb2ludENvdW50ID0gMDtcbiAgICAgIHZhciB0UG9pbnQ7XG4gICAgICB2YXIgZFggPSAwO1xuICAgICAgdmFyIGRZID0gMDtcbiAgICAgIHZhciBwb3NpdGlvblggPSAwO1xuICAgICAgdmFyIHBvc2l0aW9uWSA9IDA7XG4gICAgICB2YXIgdFZlYztcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdE1hdCA9IHhmMi5SO1xuICAgICAgdFZlYyA9IGNpcmNsZS5tX3A7XG4gICAgICB2YXIgY1ggPSB4ZjIucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55KTtcbiAgICAgIHZhciBjWSA9IHhmMi5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgZFggPSBjWCAtIHhmMS5wb3NpdGlvbi54O1xuICAgICAgZFkgPSBjWSAtIHhmMS5wb3NpdGlvbi55O1xuICAgICAgdE1hdCA9IHhmMS5SO1xuICAgICAgdmFyIGNMb2NhbFggPSAoZFggKiB0TWF0LmNvbDEueCArIGRZICogdE1hdC5jb2wxLnkpO1xuICAgICAgdmFyIGNMb2NhbFkgPSAoZFggKiB0TWF0LmNvbDIueCArIGRZICogdE1hdC5jb2wyLnkpO1xuICAgICAgdmFyIGRpc3QgPSAwO1xuICAgICAgdmFyIG5vcm1hbEluZGV4ID0gMDtcbiAgICAgIHZhciBzZXBhcmF0aW9uID0gKC1OdW1iZXIuTUFYX1ZBTFVFKTtcbiAgICAgIHZhciByYWRpdXMgPSBwb2x5Z29uLm1fcmFkaXVzICsgY2lyY2xlLm1fcmFkaXVzO1xuICAgICAgdmFyIHZlcnRleENvdW50ID0gcGFyc2VJbnQocG9seWdvbi5tX3ZlcnRleENvdW50KTtcbiAgICAgIHZhciB2ZXJ0aWNlcyA9IHBvbHlnb24ubV92ZXJ0aWNlcztcbiAgICAgIHZhciBub3JtYWxzID0gcG9seWdvbi5tX25vcm1hbHM7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZlcnRleENvdW50OyArK2kpIHtcbiAgICAgICAgIHRWZWMgPSB2ZXJ0aWNlc1tpXTtcbiAgICAgICAgIGRYID0gY0xvY2FsWCAtIHRWZWMueDtcbiAgICAgICAgIGRZID0gY0xvY2FsWSAtIHRWZWMueTtcbiAgICAgICAgIHRWZWMgPSBub3JtYWxzW2ldO1xuICAgICAgICAgdmFyIHMgPSB0VmVjLnggKiBkWCArIHRWZWMueSAqIGRZO1xuICAgICAgICAgaWYgKHMgPiByYWRpdXMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgIH1cbiAgICAgICAgIGlmIChzID4gc2VwYXJhdGlvbikge1xuICAgICAgICAgICAgc2VwYXJhdGlvbiA9IHM7XG4gICAgICAgICAgICBub3JtYWxJbmRleCA9IGk7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICB2YXIgdmVydEluZGV4MSA9IHBhcnNlSW50KG5vcm1hbEluZGV4KTtcbiAgICAgIHZhciB2ZXJ0SW5kZXgyID0gcGFyc2VJbnQodmVydEluZGV4MSArIDEgPCB2ZXJ0ZXhDb3VudCA/IHZlcnRJbmRleDEgKyAxIDogMCk7XG4gICAgICB2YXIgdjEgPSB2ZXJ0aWNlc1t2ZXJ0SW5kZXgxXTtcbiAgICAgIHZhciB2MiA9IHZlcnRpY2VzW3ZlcnRJbmRleDJdO1xuICAgICAgaWYgKHNlcGFyYXRpb24gPCBOdW1iZXIuTUlOX1ZBTFVFKSB7XG4gICAgICAgICBtYW5pZm9sZC5tX3BvaW50Q291bnQgPSAxO1xuICAgICAgICAgbWFuaWZvbGQubV90eXBlID0gYjJNYW5pZm9sZC5lX2ZhY2VBO1xuICAgICAgICAgbWFuaWZvbGQubV9sb2NhbFBsYW5lTm9ybWFsLlNldFYobm9ybWFsc1tub3JtYWxJbmRleF0pO1xuICAgICAgICAgbWFuaWZvbGQubV9sb2NhbFBvaW50LnggPSAwLjUgKiAodjEueCArIHYyLngpO1xuICAgICAgICAgbWFuaWZvbGQubV9sb2NhbFBvaW50LnkgPSAwLjUgKiAodjEueSArIHYyLnkpO1xuICAgICAgICAgbWFuaWZvbGQubV9wb2ludHNbMF0ubV9sb2NhbFBvaW50LlNldFYoY2lyY2xlLm1fcCk7XG4gICAgICAgICBtYW5pZm9sZC5tX3BvaW50c1swXS5tX2lkLmtleSA9IDA7XG4gICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgdTEgPSAoY0xvY2FsWCAtIHYxLngpICogKHYyLnggLSB2MS54KSArIChjTG9jYWxZIC0gdjEueSkgKiAodjIueSAtIHYxLnkpO1xuICAgICAgdmFyIHUyID0gKGNMb2NhbFggLSB2Mi54KSAqICh2MS54IC0gdjIueCkgKyAoY0xvY2FsWSAtIHYyLnkpICogKHYxLnkgLSB2Mi55KTtcbiAgICAgIGlmICh1MSA8PSAwLjApIHtcbiAgICAgICAgIGlmICgoY0xvY2FsWCAtIHYxLngpICogKGNMb2NhbFggLSB2MS54KSArIChjTG9jYWxZIC0gdjEueSkgKiAoY0xvY2FsWSAtIHYxLnkpID4gcmFkaXVzICogcmFkaXVzKSByZXR1cm47XG4gICAgICAgICBtYW5pZm9sZC5tX3BvaW50Q291bnQgPSAxO1xuICAgICAgICAgbWFuaWZvbGQubV90eXBlID0gYjJNYW5pZm9sZC5lX2ZhY2VBO1xuICAgICAgICAgbWFuaWZvbGQubV9sb2NhbFBsYW5lTm9ybWFsLnggPSBjTG9jYWxYIC0gdjEueDtcbiAgICAgICAgIG1hbmlmb2xkLm1fbG9jYWxQbGFuZU5vcm1hbC55ID0gY0xvY2FsWSAtIHYxLnk7XG4gICAgICAgICBtYW5pZm9sZC5tX2xvY2FsUGxhbmVOb3JtYWwuTm9ybWFsaXplKCk7XG4gICAgICAgICBtYW5pZm9sZC5tX2xvY2FsUG9pbnQuU2V0Vih2MSk7XG4gICAgICAgICBtYW5pZm9sZC5tX3BvaW50c1swXS5tX2xvY2FsUG9pbnQuU2V0VihjaXJjbGUubV9wKTtcbiAgICAgICAgIG1hbmlmb2xkLm1fcG9pbnRzWzBdLm1faWQua2V5ID0gMDtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHUyIDw9IDApIHtcbiAgICAgICAgIGlmICgoY0xvY2FsWCAtIHYyLngpICogKGNMb2NhbFggLSB2Mi54KSArIChjTG9jYWxZIC0gdjIueSkgKiAoY0xvY2FsWSAtIHYyLnkpID4gcmFkaXVzICogcmFkaXVzKSByZXR1cm47XG4gICAgICAgICBtYW5pZm9sZC5tX3BvaW50Q291bnQgPSAxO1xuICAgICAgICAgbWFuaWZvbGQubV90eXBlID0gYjJNYW5pZm9sZC5lX2ZhY2VBO1xuICAgICAgICAgbWFuaWZvbGQubV9sb2NhbFBsYW5lTm9ybWFsLnggPSBjTG9jYWxYIC0gdjIueDtcbiAgICAgICAgIG1hbmlmb2xkLm1fbG9jYWxQbGFuZU5vcm1hbC55ID0gY0xvY2FsWSAtIHYyLnk7XG4gICAgICAgICBtYW5pZm9sZC5tX2xvY2FsUGxhbmVOb3JtYWwuTm9ybWFsaXplKCk7XG4gICAgICAgICBtYW5pZm9sZC5tX2xvY2FsUG9pbnQuU2V0Vih2Mik7XG4gICAgICAgICBtYW5pZm9sZC5tX3BvaW50c1swXS5tX2xvY2FsUG9pbnQuU2V0VihjaXJjbGUubV9wKTtcbiAgICAgICAgIG1hbmlmb2xkLm1fcG9pbnRzWzBdLm1faWQua2V5ID0gMDtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdmFyIGZhY2VDZW50ZXJYID0gMC41ICogKHYxLnggKyB2Mi54KTtcbiAgICAgICAgIHZhciBmYWNlQ2VudGVyWSA9IDAuNSAqICh2MS55ICsgdjIueSk7XG4gICAgICAgICBzZXBhcmF0aW9uID0gKGNMb2NhbFggLSBmYWNlQ2VudGVyWCkgKiBub3JtYWxzW3ZlcnRJbmRleDFdLnggKyAoY0xvY2FsWSAtIGZhY2VDZW50ZXJZKSAqIG5vcm1hbHNbdmVydEluZGV4MV0ueTtcbiAgICAgICAgIGlmIChzZXBhcmF0aW9uID4gcmFkaXVzKSByZXR1cm47XG4gICAgICAgICBtYW5pZm9sZC5tX3BvaW50Q291bnQgPSAxO1xuICAgICAgICAgbWFuaWZvbGQubV90eXBlID0gYjJNYW5pZm9sZC5lX2ZhY2VBO1xuICAgICAgICAgbWFuaWZvbGQubV9sb2NhbFBsYW5lTm9ybWFsLnggPSBub3JtYWxzW3ZlcnRJbmRleDFdLng7XG4gICAgICAgICBtYW5pZm9sZC5tX2xvY2FsUGxhbmVOb3JtYWwueSA9IG5vcm1hbHNbdmVydEluZGV4MV0ueTtcbiAgICAgICAgIG1hbmlmb2xkLm1fbG9jYWxQbGFuZU5vcm1hbC5Ob3JtYWxpemUoKTtcbiAgICAgICAgIG1hbmlmb2xkLm1fbG9jYWxQb2ludC5TZXQoZmFjZUNlbnRlclgsIGZhY2VDZW50ZXJZKTtcbiAgICAgICAgIG1hbmlmb2xkLm1fcG9pbnRzWzBdLm1fbG9jYWxQb2ludC5TZXRWKGNpcmNsZS5tX3ApO1xuICAgICAgICAgbWFuaWZvbGQubV9wb2ludHNbMF0ubV9pZC5rZXkgPSAwO1xuICAgICAgfVxuICAgfVxuICAgYjJDb2xsaXNpb24uVGVzdE92ZXJsYXAgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgdmFyIHQxID0gYi5sb3dlckJvdW5kO1xuICAgICAgdmFyIHQyID0gYS51cHBlckJvdW5kO1xuICAgICAgdmFyIGQxWCA9IHQxLnggLSB0Mi54O1xuICAgICAgdmFyIGQxWSA9IHQxLnkgLSB0Mi55O1xuICAgICAgdDEgPSBhLmxvd2VyQm91bmQ7XG4gICAgICB0MiA9IGIudXBwZXJCb3VuZDtcbiAgICAgIHZhciBkMlggPSB0MS54IC0gdDIueDtcbiAgICAgIHZhciBkMlkgPSB0MS55IC0gdDIueTtcbiAgICAgIGlmIChkMVggPiAwLjAgfHwgZDFZID4gMC4wKSByZXR1cm4gZmFsc2U7XG4gICAgICBpZiAoZDJYID4gMC4wIHx8IGQyWSA+IDAuMCkgcmV0dXJuIGZhbHNlO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICB9XG4gICBCb3gyRC5wb3N0RGVmcy5wdXNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5iMkNvbGxpc2lvbi5zX2luY2lkZW50RWRnZSA9IGIyQ29sbGlzaW9uLk1ha2VDbGlwUG9pbnRWZWN0b3IoKTtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5iMkNvbGxpc2lvbi5zX2NsaXBQb2ludHMxID0gYjJDb2xsaXNpb24uTWFrZUNsaXBQb2ludFZlY3RvcigpO1xuICAgICAgQm94MkQuQ29sbGlzaW9uLmIyQ29sbGlzaW9uLnNfY2xpcFBvaW50czIgPSBiMkNvbGxpc2lvbi5NYWtlQ2xpcFBvaW50VmVjdG9yKCk7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24uc19lZGdlQU8gPSBuZXcgVmVjdG9yX2Eyal9OdW1iZXIoMSk7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24uc19lZGdlQk8gPSBuZXcgVmVjdG9yX2Eyal9OdW1iZXIoMSk7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24uc19sb2NhbFRhbmdlbnQgPSBuZXcgYjJWZWMyKCk7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24uc19sb2NhbE5vcm1hbCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5iMkNvbGxpc2lvbi5zX3BsYW5lUG9pbnQgPSBuZXcgYjJWZWMyKCk7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24uc19ub3JtYWwgPSBuZXcgYjJWZWMyKCk7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24uc190YW5nZW50ID0gbmV3IGIyVmVjMigpO1xuICAgICAgQm94MkQuQ29sbGlzaW9uLmIyQ29sbGlzaW9uLnNfdGFuZ2VudDIgPSBuZXcgYjJWZWMyKCk7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24uc192MTEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24uc192MTIgPSBuZXcgYjJWZWMyKCk7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24uYjJDb2xsaWRlUG9seVRlbXBWZWMgPSBuZXcgYjJWZWMyKCk7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24uYjJfbnVsbEZlYXR1cmUgPSAweDAwMDAwMGZmO1xuICAgfSk7XG4gICBiMkNvbnRhY3RJRC5iMkNvbnRhY3RJRCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuZmVhdHVyZXMgPSBuZXcgRmVhdHVyZXMoKTtcbiAgIH07XG4gICBiMkNvbnRhY3RJRC5wcm90b3R5cGUuYjJDb250YWN0SUQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmZlYXR1cmVzLl9tX2lkID0gdGhpcztcbiAgIH1cbiAgIGIyQ29udGFjdElELnByb3RvdHlwZS5TZXQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgIHRoaXMua2V5ID0gaWQuX2tleTtcbiAgIH1cbiAgIGIyQ29udGFjdElELnByb3RvdHlwZS5Db3B5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGlkID0gbmV3IGIyQ29udGFjdElEKCk7XG4gICAgICBpZC5rZXkgPSB0aGlzLmtleTtcbiAgICAgIHJldHVybiBpZDtcbiAgIH1cbiAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShiMkNvbnRhY3RJRC5wcm90b3R5cGUsICdrZXknLCB7XG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgcmV0dXJuIHRoaXMuX2tleTtcbiAgICAgIH1cbiAgIH0pO1xuICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGIyQ29udGFjdElELnByb3RvdHlwZSwgJ2tleScsIHtcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB2YWx1ZSA9IDA7XG4gICAgICAgICB0aGlzLl9rZXkgPSB2YWx1ZTtcbiAgICAgICAgIHRoaXMuZmVhdHVyZXMuX3JlZmVyZW5jZUVkZ2UgPSB0aGlzLl9rZXkgJiAweDAwMDAwMGZmO1xuICAgICAgICAgdGhpcy5mZWF0dXJlcy5faW5jaWRlbnRFZGdlID0gKCh0aGlzLl9rZXkgJiAweDAwMDBmZjAwKSA+PiA4KSAmIDB4MDAwMDAwZmY7XG4gICAgICAgICB0aGlzLmZlYXR1cmVzLl9pbmNpZGVudFZlcnRleCA9ICgodGhpcy5fa2V5ICYgMHgwMGZmMDAwMCkgPj4gMTYpICYgMHgwMDAwMDBmZjtcbiAgICAgICAgIHRoaXMuZmVhdHVyZXMuX2ZsaXAgPSAoKHRoaXMuX2tleSAmIDB4ZmYwMDAwMDApID4+IDI0KSAmIDB4MDAwMDAwZmY7XG4gICAgICB9XG4gICB9KTtcbiAgIGIyQ29udGFjdFBvaW50LmIyQ29udGFjdFBvaW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm5vcm1hbCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMuaWQgPSBuZXcgYjJDb250YWN0SUQoKTtcbiAgIH07XG4gICBiMkRpc3RhbmNlLmIyRGlzdGFuY2UgPSBmdW5jdGlvbiAoKSB7fTtcbiAgIGIyRGlzdGFuY2UuRGlzdGFuY2UgPSBmdW5jdGlvbiAob3V0cHV0LCBjYWNoZSwgaW5wdXQpIHtcbiAgICAgICsrYjJEaXN0YW5jZS5iMl9namtDYWxscztcbiAgICAgIHZhciBwcm94eUEgPSBpbnB1dC5wcm94eUE7XG4gICAgICB2YXIgcHJveHlCID0gaW5wdXQucHJveHlCO1xuICAgICAgdmFyIHRyYW5zZm9ybUEgPSBpbnB1dC50cmFuc2Zvcm1BO1xuICAgICAgdmFyIHRyYW5zZm9ybUIgPSBpbnB1dC50cmFuc2Zvcm1CO1xuICAgICAgdmFyIHNpbXBsZXggPSBiMkRpc3RhbmNlLnNfc2ltcGxleDtcbiAgICAgIHNpbXBsZXguUmVhZENhY2hlKGNhY2hlLCBwcm94eUEsIHRyYW5zZm9ybUEsIHByb3h5QiwgdHJhbnNmb3JtQik7XG4gICAgICB2YXIgdmVydGljZXMgPSBzaW1wbGV4Lm1fdmVydGljZXM7XG4gICAgICB2YXIga19tYXhJdGVycyA9IDIwO1xuICAgICAgdmFyIHNhdmVBID0gYjJEaXN0YW5jZS5zX3NhdmVBO1xuICAgICAgdmFyIHNhdmVCID0gYjJEaXN0YW5jZS5zX3NhdmVCO1xuICAgICAgdmFyIHNhdmVDb3VudCA9IDA7XG4gICAgICB2YXIgY2xvc2VzdFBvaW50ID0gc2ltcGxleC5HZXRDbG9zZXN0UG9pbnQoKTtcbiAgICAgIHZhciBkaXN0YW5jZVNxcjEgPSBjbG9zZXN0UG9pbnQuTGVuZ3RoU3F1YXJlZCgpO1xuICAgICAgdmFyIGRpc3RhbmNlU3FyMiA9IGRpc3RhbmNlU3FyMTtcbiAgICAgIHZhciBpID0gMDtcbiAgICAgIHZhciBwO1xuICAgICAgdmFyIGl0ZXIgPSAwO1xuICAgICAgd2hpbGUgKGl0ZXIgPCBrX21heEl0ZXJzKSB7XG4gICAgICAgICBzYXZlQ291bnQgPSBzaW1wbGV4Lm1fY291bnQ7XG4gICAgICAgICBmb3IgKGkgPSAwO1xuICAgICAgICAgaSA8IHNhdmVDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICBzYXZlQVtpXSA9IHZlcnRpY2VzW2ldLmluZGV4QTtcbiAgICAgICAgICAgIHNhdmVCW2ldID0gdmVydGljZXNbaV0uaW5kZXhCO1xuICAgICAgICAgfVxuICAgICAgICAgc3dpdGNoIChzaW1wbGV4Lm1fY291bnQpIHtcbiAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgc2ltcGxleC5Tb2x2ZTIoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgc2ltcGxleC5Tb2x2ZTMoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGIyU2V0dGluZ3MuYjJBc3NlcnQoZmFsc2UpO1xuICAgICAgICAgfVxuICAgICAgICAgaWYgKHNpbXBsZXgubV9jb3VudCA9PSAzKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgIH1cbiAgICAgICAgIHAgPSBzaW1wbGV4LkdldENsb3Nlc3RQb2ludCgpO1xuICAgICAgICAgZGlzdGFuY2VTcXIyID0gcC5MZW5ndGhTcXVhcmVkKCk7XG4gICAgICAgICBpZiAoZGlzdGFuY2VTcXIyID4gZGlzdGFuY2VTcXIxKSB7fVxuICAgICAgICAgZGlzdGFuY2VTcXIxID0gZGlzdGFuY2VTcXIyO1xuICAgICAgICAgdmFyIGQgPSBzaW1wbGV4LkdldFNlYXJjaERpcmVjdGlvbigpO1xuICAgICAgICAgaWYgKGQuTGVuZ3RoU3F1YXJlZCgpIDwgTnVtYmVyLk1JTl9WQUxVRSAqIE51bWJlci5NSU5fVkFMVUUpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgfVxuICAgICAgICAgdmFyIHZlcnRleCA9IHZlcnRpY2VzW3NpbXBsZXgubV9jb3VudF07XG4gICAgICAgICB2ZXJ0ZXguaW5kZXhBID0gcHJveHlBLkdldFN1cHBvcnQoYjJNYXRoLk11bFRNVih0cmFuc2Zvcm1BLlIsIGQuR2V0TmVnYXRpdmUoKSkpO1xuICAgICAgICAgdmVydGV4LndBID0gYjJNYXRoLk11bFgodHJhbnNmb3JtQSwgcHJveHlBLkdldFZlcnRleCh2ZXJ0ZXguaW5kZXhBKSk7XG4gICAgICAgICB2ZXJ0ZXguaW5kZXhCID0gcHJveHlCLkdldFN1cHBvcnQoYjJNYXRoLk11bFRNVih0cmFuc2Zvcm1CLlIsIGQpKTtcbiAgICAgICAgIHZlcnRleC53QiA9IGIyTWF0aC5NdWxYKHRyYW5zZm9ybUIsIHByb3h5Qi5HZXRWZXJ0ZXgodmVydGV4LmluZGV4QikpO1xuICAgICAgICAgdmVydGV4LncgPSBiMk1hdGguU3VidHJhY3RWVih2ZXJ0ZXgud0IsIHZlcnRleC53QSk7XG4gICAgICAgICArK2l0ZXI7XG4gICAgICAgICArK2IyRGlzdGFuY2UuYjJfZ2prSXRlcnM7XG4gICAgICAgICB2YXIgZHVwbGljYXRlID0gZmFsc2U7XG4gICAgICAgICBmb3IgKGkgPSAwO1xuICAgICAgICAgaSA8IHNhdmVDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodmVydGV4LmluZGV4QSA9PSBzYXZlQVtpXSAmJiB2ZXJ0ZXguaW5kZXhCID09IHNhdmVCW2ldKSB7XG4gICAgICAgICAgICAgICBkdXBsaWNhdGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICAgICBpZiAoZHVwbGljYXRlKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgIH0rK3NpbXBsZXgubV9jb3VudDtcbiAgICAgIH1cbiAgICAgIGIyRGlzdGFuY2UuYjJfZ2prTWF4SXRlcnMgPSBiMk1hdGguTWF4KGIyRGlzdGFuY2UuYjJfZ2prTWF4SXRlcnMsIGl0ZXIpO1xuICAgICAgc2ltcGxleC5HZXRXaXRuZXNzUG9pbnRzKG91dHB1dC5wb2ludEEsIG91dHB1dC5wb2ludEIpO1xuICAgICAgb3V0cHV0LmRpc3RhbmNlID0gYjJNYXRoLlN1YnRyYWN0VlYob3V0cHV0LnBvaW50QSwgb3V0cHV0LnBvaW50QikuTGVuZ3RoKCk7XG4gICAgICBvdXRwdXQuaXRlcmF0aW9ucyA9IGl0ZXI7XG4gICAgICBzaW1wbGV4LldyaXRlQ2FjaGUoY2FjaGUpO1xuICAgICAgaWYgKGlucHV0LnVzZVJhZGlpKSB7XG4gICAgICAgICB2YXIgckEgPSBwcm94eUEubV9yYWRpdXM7XG4gICAgICAgICB2YXIgckIgPSBwcm94eUIubV9yYWRpdXM7XG4gICAgICAgICBpZiAob3V0cHV0LmRpc3RhbmNlID4gckEgKyByQiAmJiBvdXRwdXQuZGlzdGFuY2UgPiBOdW1iZXIuTUlOX1ZBTFVFKSB7XG4gICAgICAgICAgICBvdXRwdXQuZGlzdGFuY2UgLT0gckEgKyByQjtcbiAgICAgICAgICAgIHZhciBub3JtYWwgPSBiMk1hdGguU3VidHJhY3RWVihvdXRwdXQucG9pbnRCLCBvdXRwdXQucG9pbnRBKTtcbiAgICAgICAgICAgIG5vcm1hbC5Ob3JtYWxpemUoKTtcbiAgICAgICAgICAgIG91dHB1dC5wb2ludEEueCArPSByQSAqIG5vcm1hbC54O1xuICAgICAgICAgICAgb3V0cHV0LnBvaW50QS55ICs9IHJBICogbm9ybWFsLnk7XG4gICAgICAgICAgICBvdXRwdXQucG9pbnRCLnggLT0gckIgKiBub3JtYWwueDtcbiAgICAgICAgICAgIG91dHB1dC5wb2ludEIueSAtPSByQiAqIG5vcm1hbC55O1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwID0gbmV3IGIyVmVjMigpO1xuICAgICAgICAgICAgcC54ID0gLjUgKiAob3V0cHV0LnBvaW50QS54ICsgb3V0cHV0LnBvaW50Qi54KTtcbiAgICAgICAgICAgIHAueSA9IC41ICogKG91dHB1dC5wb2ludEEueSArIG91dHB1dC5wb2ludEIueSk7XG4gICAgICAgICAgICBvdXRwdXQucG9pbnRBLnggPSBvdXRwdXQucG9pbnRCLnggPSBwLng7XG4gICAgICAgICAgICBvdXRwdXQucG9pbnRBLnkgPSBvdXRwdXQucG9pbnRCLnkgPSBwLnk7XG4gICAgICAgICAgICBvdXRwdXQuZGlzdGFuY2UgPSAwLjA7XG4gICAgICAgICB9XG4gICAgICB9XG4gICB9XG4gICBCb3gyRC5wb3N0RGVmcy5wdXNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5iMkRpc3RhbmNlLnNfc2ltcGxleCA9IG5ldyBiMlNpbXBsZXgoKTtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5iMkRpc3RhbmNlLnNfc2F2ZUEgPSBuZXcgVmVjdG9yX2Eyal9OdW1iZXIoMyk7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJEaXN0YW5jZS5zX3NhdmVCID0gbmV3IFZlY3Rvcl9hMmpfTnVtYmVyKDMpO1xuICAgfSk7XG4gICBiMkRpc3RhbmNlSW5wdXQuYjJEaXN0YW5jZUlucHV0ID0gZnVuY3Rpb24gKCkge307XG4gICBiMkRpc3RhbmNlT3V0cHV0LmIyRGlzdGFuY2VPdXRwdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnBvaW50QSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMucG9pbnRCID0gbmV3IGIyVmVjMigpO1xuICAgfTtcbiAgIGIyRGlzdGFuY2VQcm94eS5iMkRpc3RhbmNlUHJveHkgPSBmdW5jdGlvbiAoKSB7fTtcbiAgIGIyRGlzdGFuY2VQcm94eS5wcm90b3R5cGUuU2V0ID0gZnVuY3Rpb24gKHNoYXBlKSB7XG4gICAgICBzd2l0Y2ggKHNoYXBlLkdldFR5cGUoKSkge1xuICAgICAgY2FzZSBiMlNoYXBlLmVfY2lyY2xlU2hhcGU6XG4gICAgICAgICB7XG4gICAgICAgICAgICB2YXIgY2lyY2xlID0gKHNoYXBlIGluc3RhbmNlb2YgYjJDaXJjbGVTaGFwZSA/IHNoYXBlIDogbnVsbCk7XG4gICAgICAgICAgICB0aGlzLm1fdmVydGljZXMgPSBuZXcgVmVjdG9yKDEsIHRydWUpO1xuICAgICAgICAgICAgdGhpcy5tX3ZlcnRpY2VzWzBdID0gY2lyY2xlLm1fcDtcbiAgICAgICAgICAgIHRoaXMubV9jb3VudCA9IDE7XG4gICAgICAgICAgICB0aGlzLm1fcmFkaXVzID0gY2lyY2xlLm1fcmFkaXVzO1xuICAgICAgICAgfVxuICAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGIyU2hhcGUuZV9wb2x5Z29uU2hhcGU6XG4gICAgICAgICB7XG4gICAgICAgICAgICB2YXIgcG9seWdvbiA9IChzaGFwZSBpbnN0YW5jZW9mIGIyUG9seWdvblNoYXBlID8gc2hhcGUgOiBudWxsKTtcbiAgICAgICAgICAgIHRoaXMubV92ZXJ0aWNlcyA9IHBvbHlnb24ubV92ZXJ0aWNlcztcbiAgICAgICAgICAgIHRoaXMubV9jb3VudCA9IHBvbHlnb24ubV92ZXJ0ZXhDb3VudDtcbiAgICAgICAgICAgIHRoaXMubV9yYWRpdXMgPSBwb2x5Z29uLm1fcmFkaXVzO1xuICAgICAgICAgfVxuICAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICAgYjJTZXR0aW5ncy5iMkFzc2VydChmYWxzZSk7XG4gICAgICB9XG4gICB9XG4gICBiMkRpc3RhbmNlUHJveHkucHJvdG90eXBlLkdldFN1cHBvcnQgPSBmdW5jdGlvbiAoZCkge1xuICAgICAgdmFyIGJlc3RJbmRleCA9IDA7XG4gICAgICB2YXIgYmVzdFZhbHVlID0gdGhpcy5tX3ZlcnRpY2VzWzBdLnggKiBkLnggKyB0aGlzLm1fdmVydGljZXNbMF0ueSAqIGQueTtcbiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdGhpcy5tX2NvdW50OyArK2kpIHtcbiAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMubV92ZXJ0aWNlc1tpXS54ICogZC54ICsgdGhpcy5tX3ZlcnRpY2VzW2ldLnkgKiBkLnk7XG4gICAgICAgICBpZiAodmFsdWUgPiBiZXN0VmFsdWUpIHtcbiAgICAgICAgICAgIGJlc3RJbmRleCA9IGk7XG4gICAgICAgICAgICBiZXN0VmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBiZXN0SW5kZXg7XG4gICB9XG4gICBiMkRpc3RhbmNlUHJveHkucHJvdG90eXBlLkdldFN1cHBvcnRWZXJ0ZXggPSBmdW5jdGlvbiAoZCkge1xuICAgICAgdmFyIGJlc3RJbmRleCA9IDA7XG4gICAgICB2YXIgYmVzdFZhbHVlID0gdGhpcy5tX3ZlcnRpY2VzWzBdLnggKiBkLnggKyB0aGlzLm1fdmVydGljZXNbMF0ueSAqIGQueTtcbiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdGhpcy5tX2NvdW50OyArK2kpIHtcbiAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMubV92ZXJ0aWNlc1tpXS54ICogZC54ICsgdGhpcy5tX3ZlcnRpY2VzW2ldLnkgKiBkLnk7XG4gICAgICAgICBpZiAodmFsdWUgPiBiZXN0VmFsdWUpIHtcbiAgICAgICAgICAgIGJlc3RJbmRleCA9IGk7XG4gICAgICAgICAgICBiZXN0VmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLm1fdmVydGljZXNbYmVzdEluZGV4XTtcbiAgIH1cbiAgIGIyRGlzdGFuY2VQcm94eS5wcm90b3R5cGUuR2V0VmVydGV4Q291bnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2NvdW50O1xuICAgfVxuICAgYjJEaXN0YW5jZVByb3h5LnByb3RvdHlwZS5HZXRWZXJ0ZXggPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgIGlmIChpbmRleCA9PT0gdW5kZWZpbmVkKSBpbmRleCA9IDA7XG4gICAgICBiMlNldHRpbmdzLmIyQXNzZXJ0KDAgPD0gaW5kZXggJiYgaW5kZXggPCB0aGlzLm1fY291bnQpO1xuICAgICAgcmV0dXJuIHRoaXMubV92ZXJ0aWNlc1tpbmRleF07XG4gICB9XG4gICBiMkR5bmFtaWNUcmVlLmIyRHluYW1pY1RyZWUgPSBmdW5jdGlvbiAoKSB7fTtcbiAgIGIyRHluYW1pY1RyZWUucHJvdG90eXBlLmIyRHluYW1pY1RyZWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1fcm9vdCA9IG51bGw7XG4gICAgICB0aGlzLm1fZnJlZUxpc3QgPSBudWxsO1xuICAgICAgdGhpcy5tX3BhdGggPSAwO1xuICAgICAgdGhpcy5tX2luc2VydGlvbkNvdW50ID0gMDtcbiAgIH1cbiAgIGIyRHluYW1pY1RyZWUucHJvdG90eXBlLkNyZWF0ZVByb3h5ID0gZnVuY3Rpb24gKGFhYmIsIHVzZXJEYXRhKSB7XG4gICAgICB2YXIgbm9kZSA9IHRoaXMuQWxsb2NhdGVOb2RlKCk7XG4gICAgICB2YXIgZXh0ZW5kWCA9IGIyU2V0dGluZ3MuYjJfYWFiYkV4dGVuc2lvbjtcbiAgICAgIHZhciBleHRlbmRZID0gYjJTZXR0aW5ncy5iMl9hYWJiRXh0ZW5zaW9uO1xuICAgICAgbm9kZS5hYWJiLmxvd2VyQm91bmQueCA9IGFhYmIubG93ZXJCb3VuZC54IC0gZXh0ZW5kWDtcbiAgICAgIG5vZGUuYWFiYi5sb3dlckJvdW5kLnkgPSBhYWJiLmxvd2VyQm91bmQueSAtIGV4dGVuZFk7XG4gICAgICBub2RlLmFhYmIudXBwZXJCb3VuZC54ID0gYWFiYi51cHBlckJvdW5kLnggKyBleHRlbmRYO1xuICAgICAgbm9kZS5hYWJiLnVwcGVyQm91bmQueSA9IGFhYmIudXBwZXJCb3VuZC55ICsgZXh0ZW5kWTtcbiAgICAgIG5vZGUudXNlckRhdGEgPSB1c2VyRGF0YTtcbiAgICAgIHRoaXMuSW5zZXJ0TGVhZihub2RlKTtcbiAgICAgIHJldHVybiBub2RlO1xuICAgfVxuICAgYjJEeW5hbWljVHJlZS5wcm90b3R5cGUuRGVzdHJveVByb3h5ID0gZnVuY3Rpb24gKHByb3h5KSB7XG4gICAgICB0aGlzLlJlbW92ZUxlYWYocHJveHkpO1xuICAgICAgdGhpcy5GcmVlTm9kZShwcm94eSk7XG4gICB9XG4gICBiMkR5bmFtaWNUcmVlLnByb3RvdHlwZS5Nb3ZlUHJveHkgPSBmdW5jdGlvbiAocHJveHksIGFhYmIsIGRpc3BsYWNlbWVudCkge1xuICAgICAgYjJTZXR0aW5ncy5iMkFzc2VydChwcm94eS5Jc0xlYWYoKSk7XG4gICAgICBpZiAocHJveHkuYWFiYi5Db250YWlucyhhYWJiKSkge1xuICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5SZW1vdmVMZWFmKHByb3h5KTtcbiAgICAgIHZhciBleHRlbmRYID0gYjJTZXR0aW5ncy5iMl9hYWJiRXh0ZW5zaW9uICsgYjJTZXR0aW5ncy5iMl9hYWJiTXVsdGlwbGllciAqIChkaXNwbGFjZW1lbnQueCA+IDAgPyBkaXNwbGFjZW1lbnQueCA6ICgtZGlzcGxhY2VtZW50LngpKTtcbiAgICAgIHZhciBleHRlbmRZID0gYjJTZXR0aW5ncy5iMl9hYWJiRXh0ZW5zaW9uICsgYjJTZXR0aW5ncy5iMl9hYWJiTXVsdGlwbGllciAqIChkaXNwbGFjZW1lbnQueSA+IDAgPyBkaXNwbGFjZW1lbnQueSA6ICgtZGlzcGxhY2VtZW50LnkpKTtcbiAgICAgIHByb3h5LmFhYmIubG93ZXJCb3VuZC54ID0gYWFiYi5sb3dlckJvdW5kLnggLSBleHRlbmRYO1xuICAgICAgcHJveHkuYWFiYi5sb3dlckJvdW5kLnkgPSBhYWJiLmxvd2VyQm91bmQueSAtIGV4dGVuZFk7XG4gICAgICBwcm94eS5hYWJiLnVwcGVyQm91bmQueCA9IGFhYmIudXBwZXJCb3VuZC54ICsgZXh0ZW5kWDtcbiAgICAgIHByb3h5LmFhYmIudXBwZXJCb3VuZC55ID0gYWFiYi51cHBlckJvdW5kLnkgKyBleHRlbmRZO1xuICAgICAgdGhpcy5JbnNlcnRMZWFmKHByb3h5KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgfVxuICAgYjJEeW5hbWljVHJlZS5wcm90b3R5cGUuUmViYWxhbmNlID0gZnVuY3Rpb24gKGl0ZXJhdGlvbnMpIHtcbiAgICAgIGlmIChpdGVyYXRpb25zID09PSB1bmRlZmluZWQpIGl0ZXJhdGlvbnMgPSAwO1xuICAgICAgaWYgKHRoaXMubV9yb290ID09IG51bGwpIHJldHVybjtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlcmF0aW9uczsgaSsrKSB7XG4gICAgICAgICB2YXIgbm9kZSA9IHRoaXMubV9yb290O1xuICAgICAgICAgdmFyIGJpdCA9IDA7XG4gICAgICAgICB3aGlsZSAobm9kZS5Jc0xlYWYoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgbm9kZSA9ICh0aGlzLm1fcGF0aCA+PiBiaXQpICYgMSA/IG5vZGUuY2hpbGQyIDogbm9kZS5jaGlsZDE7XG4gICAgICAgICAgICBiaXQgPSAoYml0ICsgMSkgJiAzMTtcbiAgICAgICAgIH0rK3RoaXMubV9wYXRoO1xuICAgICAgICAgdGhpcy5SZW1vdmVMZWFmKG5vZGUpO1xuICAgICAgICAgdGhpcy5JbnNlcnRMZWFmKG5vZGUpO1xuICAgICAgfVxuICAgfVxuICAgYjJEeW5hbWljVHJlZS5wcm90b3R5cGUuR2V0RmF0QUFCQiA9IGZ1bmN0aW9uIChwcm94eSkge1xuICAgICAgcmV0dXJuIHByb3h5LmFhYmI7XG4gICB9XG4gICBiMkR5bmFtaWNUcmVlLnByb3RvdHlwZS5HZXRVc2VyRGF0YSA9IGZ1bmN0aW9uIChwcm94eSkge1xuICAgICAgcmV0dXJuIHByb3h5LnVzZXJEYXRhO1xuICAgfVxuICAgYjJEeW5hbWljVHJlZS5wcm90b3R5cGUuUXVlcnkgPSBmdW5jdGlvbiAoY2FsbGJhY2ssIGFhYmIpIHtcbiAgICAgIGlmICh0aGlzLm1fcm9vdCA9PSBudWxsKSByZXR1cm47XG4gICAgICB2YXIgc3RhY2sgPSBuZXcgVmVjdG9yKCk7XG4gICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgc3RhY2tbY291bnQrK10gPSB0aGlzLm1fcm9vdDtcbiAgICAgIHdoaWxlIChjb3VudCA+IDApIHtcbiAgICAgICAgIHZhciBub2RlID0gc3RhY2tbLS1jb3VudF07XG4gICAgICAgICBpZiAobm9kZS5hYWJiLlRlc3RPdmVybGFwKGFhYmIpKSB7XG4gICAgICAgICAgICBpZiAobm9kZS5Jc0xlYWYoKSkge1xuICAgICAgICAgICAgICAgdmFyIHByb2NlZWQgPSBjYWxsYmFjayhub2RlKTtcbiAgICAgICAgICAgICAgIGlmICghcHJvY2VlZCkgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICBzdGFja1tjb3VudCsrXSA9IG5vZGUuY2hpbGQxO1xuICAgICAgICAgICAgICAgc3RhY2tbY291bnQrK10gPSBub2RlLmNoaWxkMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgIH1cbiAgIH1cbiAgIGIyRHluYW1pY1RyZWUucHJvdG90eXBlLlJheUNhc3QgPSBmdW5jdGlvbiAoY2FsbGJhY2ssIGlucHV0KSB7XG4gICAgICBpZiAodGhpcy5tX3Jvb3QgPT0gbnVsbCkgcmV0dXJuO1xuICAgICAgdmFyIHAxID0gaW5wdXQucDE7XG4gICAgICB2YXIgcDIgPSBpbnB1dC5wMjtcbiAgICAgIHZhciByID0gYjJNYXRoLlN1YnRyYWN0VlYocDEsIHAyKTtcbiAgICAgIHIuTm9ybWFsaXplKCk7XG4gICAgICB2YXIgdiA9IGIyTWF0aC5Dcm9zc0ZWKDEuMCwgcik7XG4gICAgICB2YXIgYWJzX3YgPSBiMk1hdGguQWJzVih2KTtcbiAgICAgIHZhciBtYXhGcmFjdGlvbiA9IGlucHV0Lm1heEZyYWN0aW9uO1xuICAgICAgdmFyIHNlZ21lbnRBQUJCID0gbmV3IGIyQUFCQigpO1xuICAgICAgdmFyIHRYID0gMDtcbiAgICAgIHZhciB0WSA9IDA7IHtcbiAgICAgICAgIHRYID0gcDEueCArIG1heEZyYWN0aW9uICogKHAyLnggLSBwMS54KTtcbiAgICAgICAgIHRZID0gcDEueSArIG1heEZyYWN0aW9uICogKHAyLnkgLSBwMS55KTtcbiAgICAgICAgIHNlZ21lbnRBQUJCLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHAxLngsIHRYKTtcbiAgICAgICAgIHNlZ21lbnRBQUJCLmxvd2VyQm91bmQueSA9IE1hdGgubWluKHAxLnksIHRZKTtcbiAgICAgICAgIHNlZ21lbnRBQUJCLnVwcGVyQm91bmQueCA9IE1hdGgubWF4KHAxLngsIHRYKTtcbiAgICAgICAgIHNlZ21lbnRBQUJCLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHAxLnksIHRZKTtcbiAgICAgIH1cbiAgICAgIHZhciBzdGFjayA9IG5ldyBWZWN0b3IoKTtcbiAgICAgIHZhciBjb3VudCA9IDA7XG4gICAgICBzdGFja1tjb3VudCsrXSA9IHRoaXMubV9yb290O1xuICAgICAgd2hpbGUgKGNvdW50ID4gMCkge1xuICAgICAgICAgdmFyIG5vZGUgPSBzdGFja1stLWNvdW50XTtcbiAgICAgICAgIGlmIChub2RlLmFhYmIuVGVzdE92ZXJsYXAoc2VnbWVudEFBQkIpID09IGZhbHNlKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgIH1cbiAgICAgICAgIHZhciBjID0gbm9kZS5hYWJiLkdldENlbnRlcigpO1xuICAgICAgICAgdmFyIGggPSBub2RlLmFhYmIuR2V0RXh0ZW50cygpO1xuICAgICAgICAgdmFyIHNlcGFyYXRpb24gPSBNYXRoLmFicyh2LnggKiAocDEueCAtIGMueCkgKyB2LnkgKiAocDEueSAtIGMueSkpIC0gYWJzX3YueCAqIGgueCAtIGFic192LnkgKiBoLnk7XG4gICAgICAgICBpZiAoc2VwYXJhdGlvbiA+IDAuMCkgY29udGludWU7XG4gICAgICAgICBpZiAobm9kZS5Jc0xlYWYoKSkge1xuICAgICAgICAgICAgdmFyIHN1YklucHV0ID0gbmV3IGIyUmF5Q2FzdElucHV0KCk7XG4gICAgICAgICAgICBzdWJJbnB1dC5wMSA9IGlucHV0LnAxO1xuICAgICAgICAgICAgc3ViSW5wdXQucDIgPSBpbnB1dC5wMjtcbiAgICAgICAgICAgIHN1YklucHV0Lm1heEZyYWN0aW9uID0gaW5wdXQubWF4RnJhY3Rpb247XG4gICAgICAgICAgICBtYXhGcmFjdGlvbiA9IGNhbGxiYWNrKHN1YklucHV0LCBub2RlKTtcbiAgICAgICAgICAgIGlmIChtYXhGcmFjdGlvbiA9PSAwLjApIHJldHVybjtcbiAgICAgICAgICAgIGlmIChtYXhGcmFjdGlvbiA+IDAuMCkge1xuICAgICAgICAgICAgICAgdFggPSBwMS54ICsgbWF4RnJhY3Rpb24gKiAocDIueCAtIHAxLngpO1xuICAgICAgICAgICAgICAgdFkgPSBwMS55ICsgbWF4RnJhY3Rpb24gKiAocDIueSAtIHAxLnkpO1xuICAgICAgICAgICAgICAgc2VnbWVudEFBQkIubG93ZXJCb3VuZC54ID0gTWF0aC5taW4ocDEueCwgdFgpO1xuICAgICAgICAgICAgICAgc2VnbWVudEFBQkIubG93ZXJCb3VuZC55ID0gTWF0aC5taW4ocDEueSwgdFkpO1xuICAgICAgICAgICAgICAgc2VnbWVudEFBQkIudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgocDEueCwgdFgpO1xuICAgICAgICAgICAgICAgc2VnbWVudEFBQkIudXBwZXJCb3VuZC55ID0gTWF0aC5tYXgocDEueSwgdFkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzdGFja1tjb3VudCsrXSA9IG5vZGUuY2hpbGQxO1xuICAgICAgICAgICAgc3RhY2tbY291bnQrK10gPSBub2RlLmNoaWxkMjtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgIH1cbiAgIGIyRHluYW1pY1RyZWUucHJvdG90eXBlLkFsbG9jYXRlTm9kZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLm1fZnJlZUxpc3QpIHtcbiAgICAgICAgIHZhciBub2RlID0gdGhpcy5tX2ZyZWVMaXN0O1xuICAgICAgICAgdGhpcy5tX2ZyZWVMaXN0ID0gbm9kZS5wYXJlbnQ7XG4gICAgICAgICBub2RlLnBhcmVudCA9IG51bGw7XG4gICAgICAgICBub2RlLmNoaWxkMSA9IG51bGw7XG4gICAgICAgICBub2RlLmNoaWxkMiA9IG51bGw7XG4gICAgICAgICByZXR1cm4gbm9kZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXcgYjJEeW5hbWljVHJlZU5vZGUoKTtcbiAgIH1cbiAgIGIyRHluYW1pY1RyZWUucHJvdG90eXBlLkZyZWVOb2RlID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIG5vZGUucGFyZW50ID0gdGhpcy5tX2ZyZWVMaXN0O1xuICAgICAgdGhpcy5tX2ZyZWVMaXN0ID0gbm9kZTtcbiAgIH1cbiAgIGIyRHluYW1pY1RyZWUucHJvdG90eXBlLkluc2VydExlYWYgPSBmdW5jdGlvbiAobGVhZikge1xuICAgICAgKyt0aGlzLm1faW5zZXJ0aW9uQ291bnQ7XG4gICAgICBpZiAodGhpcy5tX3Jvb3QgPT0gbnVsbCkge1xuICAgICAgICAgdGhpcy5tX3Jvb3QgPSBsZWFmO1xuICAgICAgICAgdGhpcy5tX3Jvb3QucGFyZW50ID0gbnVsbDtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBjZW50ZXIgPSBsZWFmLmFhYmIuR2V0Q2VudGVyKCk7XG4gICAgICB2YXIgc2libGluZyA9IHRoaXMubV9yb290O1xuICAgICAgaWYgKHNpYmxpbmcuSXNMZWFmKCkgPT0gZmFsc2UpIHtcbiAgICAgICAgIGRvIHtcbiAgICAgICAgICAgIHZhciBjaGlsZDEgPSBzaWJsaW5nLmNoaWxkMTtcbiAgICAgICAgICAgIHZhciBjaGlsZDIgPSBzaWJsaW5nLmNoaWxkMjtcbiAgICAgICAgICAgIHZhciBub3JtMSA9IE1hdGguYWJzKChjaGlsZDEuYWFiYi5sb3dlckJvdW5kLnggKyBjaGlsZDEuYWFiYi51cHBlckJvdW5kLngpIC8gMiAtIGNlbnRlci54KSArIE1hdGguYWJzKChjaGlsZDEuYWFiYi5sb3dlckJvdW5kLnkgKyBjaGlsZDEuYWFiYi51cHBlckJvdW5kLnkpIC8gMiAtIGNlbnRlci55KTtcbiAgICAgICAgICAgIHZhciBub3JtMiA9IE1hdGguYWJzKChjaGlsZDIuYWFiYi5sb3dlckJvdW5kLnggKyBjaGlsZDIuYWFiYi51cHBlckJvdW5kLngpIC8gMiAtIGNlbnRlci54KSArIE1hdGguYWJzKChjaGlsZDIuYWFiYi5sb3dlckJvdW5kLnkgKyBjaGlsZDIuYWFiYi51cHBlckJvdW5kLnkpIC8gMiAtIGNlbnRlci55KTtcbiAgICAgICAgICAgIGlmIChub3JtMSA8IG5vcm0yKSB7XG4gICAgICAgICAgICAgICBzaWJsaW5nID0gY2hpbGQxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICBzaWJsaW5nID0gY2hpbGQyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgICAgd2hpbGUgKHNpYmxpbmcuSXNMZWFmKCkgPT0gZmFsc2UpXG4gICAgICB9XG4gICAgICB2YXIgbm9kZTEgPSBzaWJsaW5nLnBhcmVudDtcbiAgICAgIHZhciBub2RlMiA9IHRoaXMuQWxsb2NhdGVOb2RlKCk7XG4gICAgICBub2RlMi5wYXJlbnQgPSBub2RlMTtcbiAgICAgIG5vZGUyLnVzZXJEYXRhID0gbnVsbDtcbiAgICAgIG5vZGUyLmFhYmIuQ29tYmluZShsZWFmLmFhYmIsIHNpYmxpbmcuYWFiYik7XG4gICAgICBpZiAobm9kZTEpIHtcbiAgICAgICAgIGlmIChzaWJsaW5nLnBhcmVudC5jaGlsZDEgPT0gc2libGluZykge1xuICAgICAgICAgICAgbm9kZTEuY2hpbGQxID0gbm9kZTI7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG5vZGUxLmNoaWxkMiA9IG5vZGUyO1xuICAgICAgICAgfVxuICAgICAgICAgbm9kZTIuY2hpbGQxID0gc2libGluZztcbiAgICAgICAgIG5vZGUyLmNoaWxkMiA9IGxlYWY7XG4gICAgICAgICBzaWJsaW5nLnBhcmVudCA9IG5vZGUyO1xuICAgICAgICAgbGVhZi5wYXJlbnQgPSBub2RlMjtcbiAgICAgICAgIGRvIHtcbiAgICAgICAgICAgIGlmIChub2RlMS5hYWJiLkNvbnRhaW5zKG5vZGUyLmFhYmIpKSBicmVhaztcbiAgICAgICAgICAgIG5vZGUxLmFhYmIuQ29tYmluZShub2RlMS5jaGlsZDEuYWFiYiwgbm9kZTEuY2hpbGQyLmFhYmIpO1xuICAgICAgICAgICAgbm9kZTIgPSBub2RlMTtcbiAgICAgICAgICAgIG5vZGUxID0gbm9kZTEucGFyZW50O1xuICAgICAgICAgfVxuICAgICAgICAgd2hpbGUgKG5vZGUxKVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICBub2RlMi5jaGlsZDEgPSBzaWJsaW5nO1xuICAgICAgICAgbm9kZTIuY2hpbGQyID0gbGVhZjtcbiAgICAgICAgIHNpYmxpbmcucGFyZW50ID0gbm9kZTI7XG4gICAgICAgICBsZWFmLnBhcmVudCA9IG5vZGUyO1xuICAgICAgICAgdGhpcy5tX3Jvb3QgPSBub2RlMjtcbiAgICAgIH1cbiAgIH1cbiAgIGIyRHluYW1pY1RyZWUucHJvdG90eXBlLlJlbW92ZUxlYWYgPSBmdW5jdGlvbiAobGVhZikge1xuICAgICAgaWYgKGxlYWYgPT0gdGhpcy5tX3Jvb3QpIHtcbiAgICAgICAgIHRoaXMubV9yb290ID0gbnVsbDtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBub2RlMiA9IGxlYWYucGFyZW50O1xuICAgICAgdmFyIG5vZGUxID0gbm9kZTIucGFyZW50O1xuICAgICAgdmFyIHNpYmxpbmc7XG4gICAgICBpZiAobm9kZTIuY2hpbGQxID09IGxlYWYpIHtcbiAgICAgICAgIHNpYmxpbmcgPSBub2RlMi5jaGlsZDI7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHNpYmxpbmcgPSBub2RlMi5jaGlsZDE7XG4gICAgICB9XG4gICAgICBpZiAobm9kZTEpIHtcbiAgICAgICAgIGlmIChub2RlMS5jaGlsZDEgPT0gbm9kZTIpIHtcbiAgICAgICAgICAgIG5vZGUxLmNoaWxkMSA9IHNpYmxpbmc7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG5vZGUxLmNoaWxkMiA9IHNpYmxpbmc7XG4gICAgICAgICB9XG4gICAgICAgICBzaWJsaW5nLnBhcmVudCA9IG5vZGUxO1xuICAgICAgICAgdGhpcy5GcmVlTm9kZShub2RlMik7XG4gICAgICAgICB3aGlsZSAobm9kZTEpIHtcbiAgICAgICAgICAgIHZhciBvbGRBQUJCID0gbm9kZTEuYWFiYjtcbiAgICAgICAgICAgIG5vZGUxLmFhYmIgPSBiMkFBQkIuQ29tYmluZShub2RlMS5jaGlsZDEuYWFiYiwgbm9kZTEuY2hpbGQyLmFhYmIpO1xuICAgICAgICAgICAgaWYgKG9sZEFBQkIuQ29udGFpbnMobm9kZTEuYWFiYikpIGJyZWFrO1xuICAgICAgICAgICAgbm9kZTEgPSBub2RlMS5wYXJlbnQ7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV9yb290ID0gc2libGluZztcbiAgICAgICAgIHNpYmxpbmcucGFyZW50ID0gbnVsbDtcbiAgICAgICAgIHRoaXMuRnJlZU5vZGUobm9kZTIpO1xuICAgICAgfVxuICAgfVxuICAgYjJEeW5hbWljVHJlZUJyb2FkUGhhc2UuYjJEeW5hbWljVHJlZUJyb2FkUGhhc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1fdHJlZSA9IG5ldyBiMkR5bmFtaWNUcmVlKCk7XG4gICAgICB0aGlzLm1fbW92ZUJ1ZmZlciA9IG5ldyBWZWN0b3IoKTtcbiAgICAgIHRoaXMubV9wYWlyQnVmZmVyID0gbmV3IFZlY3RvcigpO1xuICAgICAgdGhpcy5tX3BhaXJDb3VudCA9IDA7XG4gICB9O1xuICAgYjJEeW5hbWljVHJlZUJyb2FkUGhhc2UucHJvdG90eXBlLkNyZWF0ZVByb3h5ID0gZnVuY3Rpb24gKGFhYmIsIHVzZXJEYXRhKSB7XG4gICAgICB2YXIgcHJveHkgPSB0aGlzLm1fdHJlZS5DcmVhdGVQcm94eShhYWJiLCB1c2VyRGF0YSk7XG4gICAgICArK3RoaXMubV9wcm94eUNvdW50O1xuICAgICAgdGhpcy5CdWZmZXJNb3ZlKHByb3h5KTtcbiAgICAgIHJldHVybiBwcm94eTtcbiAgIH1cbiAgIGIyRHluYW1pY1RyZWVCcm9hZFBoYXNlLnByb3RvdHlwZS5EZXN0cm95UHJveHkgPSBmdW5jdGlvbiAocHJveHkpIHtcbiAgICAgIHRoaXMuVW5CdWZmZXJNb3ZlKHByb3h5KTtcbiAgICAgIC0tdGhpcy5tX3Byb3h5Q291bnQ7XG4gICAgICB0aGlzLm1fdHJlZS5EZXN0cm95UHJveHkocHJveHkpO1xuICAgfVxuICAgYjJEeW5hbWljVHJlZUJyb2FkUGhhc2UucHJvdG90eXBlLk1vdmVQcm94eSA9IGZ1bmN0aW9uIChwcm94eSwgYWFiYiwgZGlzcGxhY2VtZW50KSB7XG4gICAgICB2YXIgYnVmZmVyID0gdGhpcy5tX3RyZWUuTW92ZVByb3h5KHByb3h5LCBhYWJiLCBkaXNwbGFjZW1lbnQpO1xuICAgICAgaWYgKGJ1ZmZlcikge1xuICAgICAgICAgdGhpcy5CdWZmZXJNb3ZlKHByb3h5KTtcbiAgICAgIH1cbiAgIH1cbiAgIGIyRHluYW1pY1RyZWVCcm9hZFBoYXNlLnByb3RvdHlwZS5UZXN0T3ZlcmxhcCA9IGZ1bmN0aW9uIChwcm94eUEsIHByb3h5Qikge1xuICAgICAgdmFyIGFhYmJBID0gdGhpcy5tX3RyZWUuR2V0RmF0QUFCQihwcm94eUEpO1xuICAgICAgdmFyIGFhYmJCID0gdGhpcy5tX3RyZWUuR2V0RmF0QUFCQihwcm94eUIpO1xuICAgICAgcmV0dXJuIGFhYmJBLlRlc3RPdmVybGFwKGFhYmJCKTtcbiAgIH1cbiAgIGIyRHluYW1pY1RyZWVCcm9hZFBoYXNlLnByb3RvdHlwZS5HZXRVc2VyRGF0YSA9IGZ1bmN0aW9uIChwcm94eSkge1xuICAgICAgcmV0dXJuIHRoaXMubV90cmVlLkdldFVzZXJEYXRhKHByb3h5KTtcbiAgIH1cbiAgIGIyRHluYW1pY1RyZWVCcm9hZFBoYXNlLnByb3RvdHlwZS5HZXRGYXRBQUJCID0gZnVuY3Rpb24gKHByb3h5KSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3RyZWUuR2V0RmF0QUFCQihwcm94eSk7XG4gICB9XG4gICBiMkR5bmFtaWNUcmVlQnJvYWRQaGFzZS5wcm90b3R5cGUuR2V0UHJveHlDb3VudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fcHJveHlDb3VudDtcbiAgIH1cbiAgIGIyRHluYW1pY1RyZWVCcm9hZFBoYXNlLnByb3RvdHlwZS5VcGRhdGVQYWlycyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgdmFyIF9fdGhpcyA9IHRoaXM7XG4gICAgICBfX3RoaXMubV9wYWlyQ291bnQgPSAwO1xuICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgcXVlcnlQcm94eTtcbiAgICAgICBmdW5jdGlvbiBRdWVyeUNhbGxiYWNrKHByb3h5KSB7XG4gICAgICAgICAgaWYgKHByb3h5ID09IHF1ZXJ5UHJveHkpIHJldHVybiB0cnVlO1xuICAgICAgICAgIGlmIChfX3RoaXMubV9wYWlyQ291bnQgPT0gX190aGlzLm1fcGFpckJ1ZmZlci5sZW5ndGgpIHtcbiAgICAgICAgICAgICBfX3RoaXMubV9wYWlyQnVmZmVyW19fdGhpcy5tX3BhaXJDb3VudF0gPSBuZXcgYjJEeW5hbWljVHJlZVBhaXIoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIHBhaXIgPSBfX3RoaXMubV9wYWlyQnVmZmVyW19fdGhpcy5tX3BhaXJDb3VudF07XG4gICAgICAgICAgcGFpci5wcm94eUEgPSBwcm94eSA8IHF1ZXJ5UHJveHkgPyBwcm94eSA6IHF1ZXJ5UHJveHk7XG4gICAgICAgICAgcGFpci5wcm94eUIgPSBwcm94eSA+PSBxdWVyeVByb3h5ID8gcHJveHkgOiBxdWVyeVByb3h5OysrX190aGlzLm1fcGFpckNvdW50O1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgIH07XG4gICAgICBmb3IgKGkgPSAwO1xuICAgICAgaSA8IF9fdGhpcy5tX21vdmVCdWZmZXIubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgIHF1ZXJ5UHJveHkgPSBfX3RoaXMubV9tb3ZlQnVmZmVyW2ldO1xuICAgICAgICAgdmFyIGZhdEFBQkIgPSBfX3RoaXMubV90cmVlLkdldEZhdEFBQkIocXVlcnlQcm94eSk7XG4gICAgICAgICBfX3RoaXMubV90cmVlLlF1ZXJ5KFF1ZXJ5Q2FsbGJhY2ssIGZhdEFBQkIpO1xuICAgICAgfVxuICAgICAgX190aGlzLm1fbW92ZUJ1ZmZlci5sZW5ndGggPSAwO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfX3RoaXMubV9wYWlyQ291bnQ7KSB7XG4gICAgICAgICB2YXIgcHJpbWFyeVBhaXIgPSBfX3RoaXMubV9wYWlyQnVmZmVyW2ldO1xuICAgICAgICAgdmFyIHVzZXJEYXRhQSA9IF9fdGhpcy5tX3RyZWUuR2V0VXNlckRhdGEocHJpbWFyeVBhaXIucHJveHlBKTtcbiAgICAgICAgIHZhciB1c2VyRGF0YUIgPSBfX3RoaXMubV90cmVlLkdldFVzZXJEYXRhKHByaW1hcnlQYWlyLnByb3h5Qik7XG4gICAgICAgICBjYWxsYmFjayh1c2VyRGF0YUEsIHVzZXJEYXRhQik7XG4gICAgICAgICArK2k7XG4gICAgICAgICB3aGlsZSAoaSA8IF9fdGhpcy5tX3BhaXJDb3VudCkge1xuICAgICAgICAgICAgdmFyIHBhaXIgPSBfX3RoaXMubV9wYWlyQnVmZmVyW2ldO1xuICAgICAgICAgICAgaWYgKHBhaXIucHJveHlBICE9IHByaW1hcnlQYWlyLnByb3h5QSB8fCBwYWlyLnByb3h5QiAhPSBwcmltYXJ5UGFpci5wcm94eUIpIHtcbiAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfSsraTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgIH1cbiAgIGIyRHluYW1pY1RyZWVCcm9hZFBoYXNlLnByb3RvdHlwZS5RdWVyeSA9IGZ1bmN0aW9uIChjYWxsYmFjaywgYWFiYikge1xuICAgICAgdGhpcy5tX3RyZWUuUXVlcnkoY2FsbGJhY2ssIGFhYmIpO1xuICAgfVxuICAgYjJEeW5hbWljVHJlZUJyb2FkUGhhc2UucHJvdG90eXBlLlJheUNhc3QgPSBmdW5jdGlvbiAoY2FsbGJhY2ssIGlucHV0KSB7XG4gICAgICB0aGlzLm1fdHJlZS5SYXlDYXN0KGNhbGxiYWNrLCBpbnB1dCk7XG4gICB9XG4gICBiMkR5bmFtaWNUcmVlQnJvYWRQaGFzZS5wcm90b3R5cGUuVmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7fVxuICAgYjJEeW5hbWljVHJlZUJyb2FkUGhhc2UucHJvdG90eXBlLlJlYmFsYW5jZSA9IGZ1bmN0aW9uIChpdGVyYXRpb25zKSB7XG4gICAgICBpZiAoaXRlcmF0aW9ucyA9PT0gdW5kZWZpbmVkKSBpdGVyYXRpb25zID0gMDtcbiAgICAgIHRoaXMubV90cmVlLlJlYmFsYW5jZShpdGVyYXRpb25zKTtcbiAgIH1cbiAgIGIyRHluYW1pY1RyZWVCcm9hZFBoYXNlLnByb3RvdHlwZS5CdWZmZXJNb3ZlID0gZnVuY3Rpb24gKHByb3h5KSB7XG4gICAgICB0aGlzLm1fbW92ZUJ1ZmZlclt0aGlzLm1fbW92ZUJ1ZmZlci5sZW5ndGhdID0gcHJveHk7XG4gICB9XG4gICBiMkR5bmFtaWNUcmVlQnJvYWRQaGFzZS5wcm90b3R5cGUuVW5CdWZmZXJNb3ZlID0gZnVuY3Rpb24gKHByb3h5KSB7XG4gICAgICB2YXIgaSA9IHBhcnNlSW50KHRoaXMubV9tb3ZlQnVmZmVyLmluZGV4T2YocHJveHkpKTtcbiAgICAgIHRoaXMubV9tb3ZlQnVmZmVyLnNwbGljZShpLCAxKTtcbiAgIH1cbiAgIGIyRHluYW1pY1RyZWVCcm9hZFBoYXNlLnByb3RvdHlwZS5Db21wYXJlUGFpcnMgPSBmdW5jdGlvbiAocGFpcjEsIHBhaXIyKSB7XG4gICAgICByZXR1cm4gMDtcbiAgIH1cbiAgIGIyRHluYW1pY1RyZWVCcm9hZFBoYXNlLl9faW1wbGVtZW50cyA9IHt9O1xuICAgYjJEeW5hbWljVHJlZUJyb2FkUGhhc2UuX19pbXBsZW1lbnRzW0lCcm9hZFBoYXNlXSA9IHRydWU7XG4gICBiMkR5bmFtaWNUcmVlTm9kZS5iMkR5bmFtaWNUcmVlTm9kZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuYWFiYiA9IG5ldyBiMkFBQkIoKTtcbiAgIH07XG4gICBiMkR5bmFtaWNUcmVlTm9kZS5wcm90b3R5cGUuSXNMZWFmID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuY2hpbGQxID09IG51bGw7XG4gICB9XG4gICBiMkR5bmFtaWNUcmVlUGFpci5iMkR5bmFtaWNUcmVlUGFpciA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJNYW5pZm9sZC5iMk1hbmlmb2xkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX3BvaW50Q291bnQgPSAwO1xuICAgfTtcbiAgIGIyTWFuaWZvbGQucHJvdG90eXBlLmIyTWFuaWZvbGQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1fcG9pbnRzID0gbmV3IFZlY3RvcihiMlNldHRpbmdzLmIyX21heE1hbmlmb2xkUG9pbnRzKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYjJTZXR0aW5ncy5iMl9tYXhNYW5pZm9sZFBvaW50czsgaSsrKSB7XG4gICAgICAgICB0aGlzLm1fcG9pbnRzW2ldID0gbmV3IGIyTWFuaWZvbGRQb2ludCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5tX2xvY2FsUGxhbmVOb3JtYWwgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fbG9jYWxQb2ludCA9IG5ldyBiMlZlYzIoKTtcbiAgIH1cbiAgIGIyTWFuaWZvbGQucHJvdG90eXBlLlJlc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiMlNldHRpbmdzLmIyX21heE1hbmlmb2xkUG9pbnRzOyBpKyspIHtcbiAgICAgICAgICgodGhpcy5tX3BvaW50c1tpXSBpbnN0YW5jZW9mIGIyTWFuaWZvbGRQb2ludCA/IHRoaXMubV9wb2ludHNbaV0gOiBudWxsKSkuUmVzZXQoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubV9sb2NhbFBsYW5lTm9ybWFsLlNldFplcm8oKTtcbiAgICAgIHRoaXMubV9sb2NhbFBvaW50LlNldFplcm8oKTtcbiAgICAgIHRoaXMubV90eXBlID0gMDtcbiAgICAgIHRoaXMubV9wb2ludENvdW50ID0gMDtcbiAgIH1cbiAgIGIyTWFuaWZvbGQucHJvdG90eXBlLlNldCA9IGZ1bmN0aW9uIChtKSB7XG4gICAgICB0aGlzLm1fcG9pbnRDb3VudCA9IG0ubV9wb2ludENvdW50O1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiMlNldHRpbmdzLmIyX21heE1hbmlmb2xkUG9pbnRzOyBpKyspIHtcbiAgICAgICAgICgodGhpcy5tX3BvaW50c1tpXSBpbnN0YW5jZW9mIGIyTWFuaWZvbGRQb2ludCA/IHRoaXMubV9wb2ludHNbaV0gOiBudWxsKSkuU2V0KG0ubV9wb2ludHNbaV0pO1xuICAgICAgfVxuICAgICAgdGhpcy5tX2xvY2FsUGxhbmVOb3JtYWwuU2V0VihtLm1fbG9jYWxQbGFuZU5vcm1hbCk7XG4gICAgICB0aGlzLm1fbG9jYWxQb2ludC5TZXRWKG0ubV9sb2NhbFBvaW50KTtcbiAgICAgIHRoaXMubV90eXBlID0gbS5tX3R5cGU7XG4gICB9XG4gICBiMk1hbmlmb2xkLnByb3RvdHlwZS5Db3B5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGNvcHkgPSBuZXcgYjJNYW5pZm9sZCgpO1xuICAgICAgY29weS5TZXQodGhpcyk7XG4gICAgICByZXR1cm4gY29weTtcbiAgIH1cbiAgIEJveDJELnBvc3REZWZzLnB1c2goZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuQ29sbGlzaW9uLmIyTWFuaWZvbGQuZV9jaXJjbGVzID0gMHgwMDAxO1xuICAgICAgQm94MkQuQ29sbGlzaW9uLmIyTWFuaWZvbGQuZV9mYWNlQSA9IDB4MDAwMjtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5iMk1hbmlmb2xkLmVfZmFjZUIgPSAweDAwMDQ7XG4gICB9KTtcbiAgIGIyTWFuaWZvbGRQb2ludC5iMk1hbmlmb2xkUG9pbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1fbG9jYWxQb2ludCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9pZCA9IG5ldyBiMkNvbnRhY3RJRCgpO1xuICAgfTtcbiAgIGIyTWFuaWZvbGRQb2ludC5wcm90b3R5cGUuYjJNYW5pZm9sZFBvaW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5SZXNldCgpO1xuICAgfVxuICAgYjJNYW5pZm9sZFBvaW50LnByb3RvdHlwZS5SZXNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubV9sb2NhbFBvaW50LlNldFplcm8oKTtcbiAgICAgIHRoaXMubV9ub3JtYWxJbXB1bHNlID0gMC4wO1xuICAgICAgdGhpcy5tX3RhbmdlbnRJbXB1bHNlID0gMC4wO1xuICAgICAgdGhpcy5tX2lkLmtleSA9IDA7XG4gICB9XG4gICBiMk1hbmlmb2xkUG9pbnQucHJvdG90eXBlLlNldCA9IGZ1bmN0aW9uIChtKSB7XG4gICAgICB0aGlzLm1fbG9jYWxQb2ludC5TZXRWKG0ubV9sb2NhbFBvaW50KTtcbiAgICAgIHRoaXMubV9ub3JtYWxJbXB1bHNlID0gbS5tX25vcm1hbEltcHVsc2U7XG4gICAgICB0aGlzLm1fdGFuZ2VudEltcHVsc2UgPSBtLm1fdGFuZ2VudEltcHVsc2U7XG4gICAgICB0aGlzLm1faWQuU2V0KG0ubV9pZCk7XG4gICB9XG4gICBiMlBvaW50LmIyUG9pbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnAgPSBuZXcgYjJWZWMyKCk7XG4gICB9O1xuICAgYjJQb2ludC5wcm90b3R5cGUuU3VwcG9ydCA9IGZ1bmN0aW9uICh4ZiwgdlgsIHZZKSB7XG4gICAgICBpZiAodlggPT09IHVuZGVmaW5lZCkgdlggPSAwO1xuICAgICAgaWYgKHZZID09PSB1bmRlZmluZWQpIHZZID0gMDtcbiAgICAgIHJldHVybiB0aGlzLnA7XG4gICB9XG4gICBiMlBvaW50LnByb3RvdHlwZS5HZXRGaXJzdFZlcnRleCA9IGZ1bmN0aW9uICh4Zikge1xuICAgICAgcmV0dXJuIHRoaXMucDtcbiAgIH1cbiAgIGIyUmF5Q2FzdElucHV0LmIyUmF5Q2FzdElucHV0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5wMSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMucDIgPSBuZXcgYjJWZWMyKCk7XG4gICB9O1xuICAgYjJSYXlDYXN0SW5wdXQucHJvdG90eXBlLmIyUmF5Q2FzdElucHV0ID0gZnVuY3Rpb24gKHAxLCBwMiwgbWF4RnJhY3Rpb24pIHtcbiAgICAgIGlmIChwMSA9PT0gdW5kZWZpbmVkKSBwMSA9IG51bGw7XG4gICAgICBpZiAocDIgPT09IHVuZGVmaW5lZCkgcDIgPSBudWxsO1xuICAgICAgaWYgKG1heEZyYWN0aW9uID09PSB1bmRlZmluZWQpIG1heEZyYWN0aW9uID0gMTtcbiAgICAgIGlmIChwMSkgdGhpcy5wMS5TZXRWKHAxKTtcbiAgICAgIGlmIChwMikgdGhpcy5wMi5TZXRWKHAyKTtcbiAgICAgIHRoaXMubWF4RnJhY3Rpb24gPSBtYXhGcmFjdGlvbjtcbiAgIH1cbiAgIGIyUmF5Q2FzdE91dHB1dC5iMlJheUNhc3RPdXRwdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm5vcm1hbCA9IG5ldyBiMlZlYzIoKTtcbiAgIH07XG4gICBiMlNlZ21lbnQuYjJTZWdtZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5wMSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMucDIgPSBuZXcgYjJWZWMyKCk7XG4gICB9O1xuICAgYjJTZWdtZW50LnByb3RvdHlwZS5UZXN0U2VnbWVudCA9IGZ1bmN0aW9uIChsYW1iZGEsIG5vcm1hbCwgc2VnbWVudCwgbWF4TGFtYmRhKSB7XG4gICAgICBpZiAobWF4TGFtYmRhID09PSB1bmRlZmluZWQpIG1heExhbWJkYSA9IDA7XG4gICAgICB2YXIgcyA9IHNlZ21lbnQucDE7XG4gICAgICB2YXIgclggPSBzZWdtZW50LnAyLnggLSBzLng7XG4gICAgICB2YXIgclkgPSBzZWdtZW50LnAyLnkgLSBzLnk7XG4gICAgICB2YXIgZFggPSB0aGlzLnAyLnggLSB0aGlzLnAxLng7XG4gICAgICB2YXIgZFkgPSB0aGlzLnAyLnkgLSB0aGlzLnAxLnk7XG4gICAgICB2YXIgblggPSBkWTtcbiAgICAgIHZhciBuWSA9ICgtZFgpO1xuICAgICAgdmFyIGtfc2xvcCA9IDEwMC4wICogTnVtYmVyLk1JTl9WQUxVRTtcbiAgICAgIHZhciBkZW5vbSA9ICgtKHJYICogblggKyByWSAqIG5ZKSk7XG4gICAgICBpZiAoZGVub20gPiBrX3Nsb3ApIHtcbiAgICAgICAgIHZhciBiWCA9IHMueCAtIHRoaXMucDEueDtcbiAgICAgICAgIHZhciBiWSA9IHMueSAtIHRoaXMucDEueTtcbiAgICAgICAgIHZhciBhID0gKGJYICogblggKyBiWSAqIG5ZKTtcbiAgICAgICAgIGlmICgwLjAgPD0gYSAmJiBhIDw9IG1heExhbWJkYSAqIGRlbm9tKSB7XG4gICAgICAgICAgICB2YXIgbXUyID0gKC1yWCAqIGJZKSArIHJZICogYlg7XG4gICAgICAgICAgICBpZiAoKC1rX3Nsb3AgKiBkZW5vbSkgPD0gbXUyICYmIG11MiA8PSBkZW5vbSAqICgxLjAgKyBrX3Nsb3ApKSB7XG4gICAgICAgICAgICAgICBhIC89IGRlbm9tO1xuICAgICAgICAgICAgICAgdmFyIG5MZW4gPSBNYXRoLnNxcnQoblggKiBuWCArIG5ZICogblkpO1xuICAgICAgICAgICAgICAgblggLz0gbkxlbjtcbiAgICAgICAgICAgICAgIG5ZIC89IG5MZW47XG4gICAgICAgICAgICAgICBsYW1iZGFbMF0gPSBhO1xuICAgICAgICAgICAgICAgbm9ybWFsLlNldChuWCwgblkpO1xuICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICB9XG4gICBiMlNlZ21lbnQucHJvdG90eXBlLkV4dGVuZCA9IGZ1bmN0aW9uIChhYWJiKSB7XG4gICAgICB0aGlzLkV4dGVuZEZvcndhcmQoYWFiYik7XG4gICAgICB0aGlzLkV4dGVuZEJhY2t3YXJkKGFhYmIpO1xuICAgfVxuICAgYjJTZWdtZW50LnByb3RvdHlwZS5FeHRlbmRGb3J3YXJkID0gZnVuY3Rpb24gKGFhYmIpIHtcbiAgICAgIHZhciBkWCA9IHRoaXMucDIueCAtIHRoaXMucDEueDtcbiAgICAgIHZhciBkWSA9IHRoaXMucDIueSAtIHRoaXMucDEueTtcbiAgICAgIHZhciBsYW1iZGEgPSBNYXRoLm1pbihkWCA+IDAgPyAoYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLnAxLngpIC8gZFggOiBkWCA8IDAgPyAoYWFiYi5sb3dlckJvdW5kLnggLSB0aGlzLnAxLngpIC8gZFggOiBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksXG4gICAgICBkWSA+IDAgPyAoYWFiYi51cHBlckJvdW5kLnkgLSB0aGlzLnAxLnkpIC8gZFkgOiBkWSA8IDAgPyAoYWFiYi5sb3dlckJvdW5kLnkgLSB0aGlzLnAxLnkpIC8gZFkgOiBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO1xuICAgICAgdGhpcy5wMi54ID0gdGhpcy5wMS54ICsgZFggKiBsYW1iZGE7XG4gICAgICB0aGlzLnAyLnkgPSB0aGlzLnAxLnkgKyBkWSAqIGxhbWJkYTtcbiAgIH1cbiAgIGIyU2VnbWVudC5wcm90b3R5cGUuRXh0ZW5kQmFja3dhcmQgPSBmdW5jdGlvbiAoYWFiYikge1xuICAgICAgdmFyIGRYID0gKC10aGlzLnAyLngpICsgdGhpcy5wMS54O1xuICAgICAgdmFyIGRZID0gKC10aGlzLnAyLnkpICsgdGhpcy5wMS55O1xuICAgICAgdmFyIGxhbWJkYSA9IE1hdGgubWluKGRYID4gMCA/IChhYWJiLnVwcGVyQm91bmQueCAtIHRoaXMucDIueCkgLyBkWCA6IGRYIDwgMCA/IChhYWJiLmxvd2VyQm91bmQueCAtIHRoaXMucDIueCkgLyBkWCA6IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSxcbiAgICAgIGRZID4gMCA/IChhYWJiLnVwcGVyQm91bmQueSAtIHRoaXMucDIueSkgLyBkWSA6IGRZIDwgMCA/IChhYWJiLmxvd2VyQm91bmQueSAtIHRoaXMucDIueSkgLyBkWSA6IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSk7XG4gICAgICB0aGlzLnAxLnggPSB0aGlzLnAyLnggKyBkWCAqIGxhbWJkYTtcbiAgICAgIHRoaXMucDEueSA9IHRoaXMucDIueSArIGRZICogbGFtYmRhO1xuICAgfVxuICAgYjJTZXBhcmF0aW9uRnVuY3Rpb24uYjJTZXBhcmF0aW9uRnVuY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1fbG9jYWxQb2ludCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9heGlzID0gbmV3IGIyVmVjMigpO1xuICAgfTtcbiAgIGIyU2VwYXJhdGlvbkZ1bmN0aW9uLnByb3RvdHlwZS5Jbml0aWFsaXplID0gZnVuY3Rpb24gKGNhY2hlLCBwcm94eUEsIHRyYW5zZm9ybUEsIHByb3h5QiwgdHJhbnNmb3JtQikge1xuICAgICAgdGhpcy5tX3Byb3h5QSA9IHByb3h5QTtcbiAgICAgIHRoaXMubV9wcm94eUIgPSBwcm94eUI7XG4gICAgICB2YXIgY291bnQgPSBwYXJzZUludChjYWNoZS5jb3VudCk7XG4gICAgICBiMlNldHRpbmdzLmIyQXNzZXJ0KDAgPCBjb3VudCAmJiBjb3VudCA8IDMpO1xuICAgICAgdmFyIGxvY2FsUG9pbnRBO1xuICAgICAgdmFyIGxvY2FsUG9pbnRBMTtcbiAgICAgIHZhciBsb2NhbFBvaW50QTI7XG4gICAgICB2YXIgbG9jYWxQb2ludEI7XG4gICAgICB2YXIgbG9jYWxQb2ludEIxO1xuICAgICAgdmFyIGxvY2FsUG9pbnRCMjtcbiAgICAgIHZhciBwb2ludEFYID0gMDtcbiAgICAgIHZhciBwb2ludEFZID0gMDtcbiAgICAgIHZhciBwb2ludEJYID0gMDtcbiAgICAgIHZhciBwb2ludEJZID0gMDtcbiAgICAgIHZhciBub3JtYWxYID0gMDtcbiAgICAgIHZhciBub3JtYWxZID0gMDtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIHRWZWM7XG4gICAgICB2YXIgcyA9IDA7XG4gICAgICB2YXIgc2duID0gMDtcbiAgICAgIGlmIChjb3VudCA9PSAxKSB7XG4gICAgICAgICB0aGlzLm1fdHlwZSA9IGIyU2VwYXJhdGlvbkZ1bmN0aW9uLmVfcG9pbnRzO1xuICAgICAgICAgbG9jYWxQb2ludEEgPSB0aGlzLm1fcHJveHlBLkdldFZlcnRleChjYWNoZS5pbmRleEFbMF0pO1xuICAgICAgICAgbG9jYWxQb2ludEIgPSB0aGlzLm1fcHJveHlCLkdldFZlcnRleChjYWNoZS5pbmRleEJbMF0pO1xuICAgICAgICAgdFZlYyA9IGxvY2FsUG9pbnRBO1xuICAgICAgICAgdE1hdCA9IHRyYW5zZm9ybUEuUjtcbiAgICAgICAgIHBvaW50QVggPSB0cmFuc2Zvcm1BLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICAgICBwb2ludEFZID0gdHJhbnNmb3JtQS5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgICAgdFZlYyA9IGxvY2FsUG9pbnRCO1xuICAgICAgICAgdE1hdCA9IHRyYW5zZm9ybUIuUjtcbiAgICAgICAgIHBvaW50QlggPSB0cmFuc2Zvcm1CLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICAgICBwb2ludEJZID0gdHJhbnNmb3JtQi5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgICAgdGhpcy5tX2F4aXMueCA9IHBvaW50QlggLSBwb2ludEFYO1xuICAgICAgICAgdGhpcy5tX2F4aXMueSA9IHBvaW50QlkgLSBwb2ludEFZO1xuICAgICAgICAgdGhpcy5tX2F4aXMuTm9ybWFsaXplKCk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChjYWNoZS5pbmRleEJbMF0gPT0gY2FjaGUuaW5kZXhCWzFdKSB7XG4gICAgICAgICB0aGlzLm1fdHlwZSA9IGIyU2VwYXJhdGlvbkZ1bmN0aW9uLmVfZmFjZUE7XG4gICAgICAgICBsb2NhbFBvaW50QTEgPSB0aGlzLm1fcHJveHlBLkdldFZlcnRleChjYWNoZS5pbmRleEFbMF0pO1xuICAgICAgICAgbG9jYWxQb2ludEEyID0gdGhpcy5tX3Byb3h5QS5HZXRWZXJ0ZXgoY2FjaGUuaW5kZXhBWzFdKTtcbiAgICAgICAgIGxvY2FsUG9pbnRCID0gdGhpcy5tX3Byb3h5Qi5HZXRWZXJ0ZXgoY2FjaGUuaW5kZXhCWzBdKTtcbiAgICAgICAgIHRoaXMubV9sb2NhbFBvaW50LnggPSAwLjUgKiAobG9jYWxQb2ludEExLnggKyBsb2NhbFBvaW50QTIueCk7XG4gICAgICAgICB0aGlzLm1fbG9jYWxQb2ludC55ID0gMC41ICogKGxvY2FsUG9pbnRBMS55ICsgbG9jYWxQb2ludEEyLnkpO1xuICAgICAgICAgdGhpcy5tX2F4aXMgPSBiMk1hdGguQ3Jvc3NWRihiMk1hdGguU3VidHJhY3RWVihsb2NhbFBvaW50QTIsIGxvY2FsUG9pbnRBMSksIDEuMCk7XG4gICAgICAgICB0aGlzLm1fYXhpcy5Ob3JtYWxpemUoKTtcbiAgICAgICAgIHRWZWMgPSB0aGlzLm1fYXhpcztcbiAgICAgICAgIHRNYXQgPSB0cmFuc2Zvcm1BLlI7XG4gICAgICAgICBub3JtYWxYID0gdE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueTtcbiAgICAgICAgIG5vcm1hbFkgPSB0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55O1xuICAgICAgICAgdFZlYyA9IHRoaXMubV9sb2NhbFBvaW50O1xuICAgICAgICAgdE1hdCA9IHRyYW5zZm9ybUEuUjtcbiAgICAgICAgIHBvaW50QVggPSB0cmFuc2Zvcm1BLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICAgICBwb2ludEFZID0gdHJhbnNmb3JtQS5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgICAgdFZlYyA9IGxvY2FsUG9pbnRCO1xuICAgICAgICAgdE1hdCA9IHRyYW5zZm9ybUIuUjtcbiAgICAgICAgIHBvaW50QlggPSB0cmFuc2Zvcm1CLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICAgICBwb2ludEJZID0gdHJhbnNmb3JtQi5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgICAgcyA9IChwb2ludEJYIC0gcG9pbnRBWCkgKiBub3JtYWxYICsgKHBvaW50QlkgLSBwb2ludEFZKSAqIG5vcm1hbFk7XG4gICAgICAgICBpZiAocyA8IDAuMCkge1xuICAgICAgICAgICAgdGhpcy5tX2F4aXMuTmVnYXRpdmVTZWxmKCk7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChjYWNoZS5pbmRleEFbMF0gPT0gY2FjaGUuaW5kZXhBWzBdKSB7XG4gICAgICAgICB0aGlzLm1fdHlwZSA9IGIyU2VwYXJhdGlvbkZ1bmN0aW9uLmVfZmFjZUI7XG4gICAgICAgICBsb2NhbFBvaW50QjEgPSB0aGlzLm1fcHJveHlCLkdldFZlcnRleChjYWNoZS5pbmRleEJbMF0pO1xuICAgICAgICAgbG9jYWxQb2ludEIyID0gdGhpcy5tX3Byb3h5Qi5HZXRWZXJ0ZXgoY2FjaGUuaW5kZXhCWzFdKTtcbiAgICAgICAgIGxvY2FsUG9pbnRBID0gdGhpcy5tX3Byb3h5QS5HZXRWZXJ0ZXgoY2FjaGUuaW5kZXhBWzBdKTtcbiAgICAgICAgIHRoaXMubV9sb2NhbFBvaW50LnggPSAwLjUgKiAobG9jYWxQb2ludEIxLnggKyBsb2NhbFBvaW50QjIueCk7XG4gICAgICAgICB0aGlzLm1fbG9jYWxQb2ludC55ID0gMC41ICogKGxvY2FsUG9pbnRCMS55ICsgbG9jYWxQb2ludEIyLnkpO1xuICAgICAgICAgdGhpcy5tX2F4aXMgPSBiMk1hdGguQ3Jvc3NWRihiMk1hdGguU3VidHJhY3RWVihsb2NhbFBvaW50QjIsIGxvY2FsUG9pbnRCMSksIDEuMCk7XG4gICAgICAgICB0aGlzLm1fYXhpcy5Ob3JtYWxpemUoKTtcbiAgICAgICAgIHRWZWMgPSB0aGlzLm1fYXhpcztcbiAgICAgICAgIHRNYXQgPSB0cmFuc2Zvcm1CLlI7XG4gICAgICAgICBub3JtYWxYID0gdE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueTtcbiAgICAgICAgIG5vcm1hbFkgPSB0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55O1xuICAgICAgICAgdFZlYyA9IHRoaXMubV9sb2NhbFBvaW50O1xuICAgICAgICAgdE1hdCA9IHRyYW5zZm9ybUIuUjtcbiAgICAgICAgIHBvaW50QlggPSB0cmFuc2Zvcm1CLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICAgICBwb2ludEJZID0gdHJhbnNmb3JtQi5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgICAgdFZlYyA9IGxvY2FsUG9pbnRBO1xuICAgICAgICAgdE1hdCA9IHRyYW5zZm9ybUEuUjtcbiAgICAgICAgIHBvaW50QVggPSB0cmFuc2Zvcm1BLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICAgICBwb2ludEFZID0gdHJhbnNmb3JtQS5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgICAgcyA9IChwb2ludEFYIC0gcG9pbnRCWCkgKiBub3JtYWxYICsgKHBvaW50QVkgLSBwb2ludEJZKSAqIG5vcm1hbFk7XG4gICAgICAgICBpZiAocyA8IDAuMCkge1xuICAgICAgICAgICAgdGhpcy5tX2F4aXMuTmVnYXRpdmVTZWxmKCk7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIGxvY2FsUG9pbnRBMSA9IHRoaXMubV9wcm94eUEuR2V0VmVydGV4KGNhY2hlLmluZGV4QVswXSk7XG4gICAgICAgICBsb2NhbFBvaW50QTIgPSB0aGlzLm1fcHJveHlBLkdldFZlcnRleChjYWNoZS5pbmRleEFbMV0pO1xuICAgICAgICAgbG9jYWxQb2ludEIxID0gdGhpcy5tX3Byb3h5Qi5HZXRWZXJ0ZXgoY2FjaGUuaW5kZXhCWzBdKTtcbiAgICAgICAgIGxvY2FsUG9pbnRCMiA9IHRoaXMubV9wcm94eUIuR2V0VmVydGV4KGNhY2hlLmluZGV4QlsxXSk7XG4gICAgICAgICB2YXIgcEEgPSBiMk1hdGguTXVsWCh0cmFuc2Zvcm1BLCBsb2NhbFBvaW50QSk7XG4gICAgICAgICB2YXIgZEEgPSBiMk1hdGguTXVsTVYodHJhbnNmb3JtQS5SLCBiMk1hdGguU3VidHJhY3RWVihsb2NhbFBvaW50QTIsIGxvY2FsUG9pbnRBMSkpO1xuICAgICAgICAgdmFyIHBCID0gYjJNYXRoLk11bFgodHJhbnNmb3JtQiwgbG9jYWxQb2ludEIpO1xuICAgICAgICAgdmFyIGRCID0gYjJNYXRoLk11bE1WKHRyYW5zZm9ybUIuUiwgYjJNYXRoLlN1YnRyYWN0VlYobG9jYWxQb2ludEIyLCBsb2NhbFBvaW50QjEpKTtcbiAgICAgICAgIHZhciBhID0gZEEueCAqIGRBLnggKyBkQS55ICogZEEueTtcbiAgICAgICAgIHZhciBlID0gZEIueCAqIGRCLnggKyBkQi55ICogZEIueTtcbiAgICAgICAgIHZhciByID0gYjJNYXRoLlN1YnRyYWN0VlYoZEIsIGRBKTtcbiAgICAgICAgIHZhciBjID0gZEEueCAqIHIueCArIGRBLnkgKiByLnk7XG4gICAgICAgICB2YXIgZiA9IGRCLnggKiByLnggKyBkQi55ICogci55O1xuICAgICAgICAgdmFyIGIgPSBkQS54ICogZEIueCArIGRBLnkgKiBkQi55O1xuICAgICAgICAgdmFyIGRlbm9tID0gYSAqIGUgLSBiICogYjtcbiAgICAgICAgIHMgPSAwLjA7XG4gICAgICAgICBpZiAoZGVub20gIT0gMC4wKSB7XG4gICAgICAgICAgICBzID0gYjJNYXRoLkNsYW1wKChiICogZiAtIGMgKiBlKSAvIGRlbm9tLCAwLjAsIDEuMCk7XG4gICAgICAgICB9XG4gICAgICAgICB2YXIgdCA9IChiICogcyArIGYpIC8gZTtcbiAgICAgICAgIGlmICh0IDwgMC4wKSB7XG4gICAgICAgICAgICB0ID0gMC4wO1xuICAgICAgICAgICAgcyA9IGIyTWF0aC5DbGFtcCgoYiAtIGMpIC8gYSwgMC4wLCAxLjApO1xuICAgICAgICAgfVxuICAgICAgICAgbG9jYWxQb2ludEEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICAgICBsb2NhbFBvaW50QS54ID0gbG9jYWxQb2ludEExLnggKyBzICogKGxvY2FsUG9pbnRBMi54IC0gbG9jYWxQb2ludEExLngpO1xuICAgICAgICAgbG9jYWxQb2ludEEueSA9IGxvY2FsUG9pbnRBMS55ICsgcyAqIChsb2NhbFBvaW50QTIueSAtIGxvY2FsUG9pbnRBMS55KTtcbiAgICAgICAgIGxvY2FsUG9pbnRCID0gbmV3IGIyVmVjMigpO1xuICAgICAgICAgbG9jYWxQb2ludEIueCA9IGxvY2FsUG9pbnRCMS54ICsgcyAqIChsb2NhbFBvaW50QjIueCAtIGxvY2FsUG9pbnRCMS54KTtcbiAgICAgICAgIGxvY2FsUG9pbnRCLnkgPSBsb2NhbFBvaW50QjEueSArIHMgKiAobG9jYWxQb2ludEIyLnkgLSBsb2NhbFBvaW50QjEueSk7XG4gICAgICAgICBpZiAocyA9PSAwLjAgfHwgcyA9PSAxLjApIHtcbiAgICAgICAgICAgIHRoaXMubV90eXBlID0gYjJTZXBhcmF0aW9uRnVuY3Rpb24uZV9mYWNlQjtcbiAgICAgICAgICAgIHRoaXMubV9heGlzID0gYjJNYXRoLkNyb3NzVkYoYjJNYXRoLlN1YnRyYWN0VlYobG9jYWxQb2ludEIyLCBsb2NhbFBvaW50QjEpLCAxLjApO1xuICAgICAgICAgICAgdGhpcy5tX2F4aXMuTm9ybWFsaXplKCk7XG4gICAgICAgICAgICB0aGlzLm1fbG9jYWxQb2ludCA9IGxvY2FsUG9pbnRCO1xuICAgICAgICAgICAgdFZlYyA9IHRoaXMubV9heGlzO1xuICAgICAgICAgICAgdE1hdCA9IHRyYW5zZm9ybUIuUjtcbiAgICAgICAgICAgIG5vcm1hbFggPSB0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55O1xuICAgICAgICAgICAgbm9ybWFsWSA9IHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnk7XG4gICAgICAgICAgICB0VmVjID0gdGhpcy5tX2xvY2FsUG9pbnQ7XG4gICAgICAgICAgICB0TWF0ID0gdHJhbnNmb3JtQi5SO1xuICAgICAgICAgICAgcG9pbnRCWCA9IHRyYW5zZm9ybUIucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55KTtcbiAgICAgICAgICAgIHBvaW50QlkgPSB0cmFuc2Zvcm1CLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueSk7XG4gICAgICAgICAgICB0VmVjID0gbG9jYWxQb2ludEE7XG4gICAgICAgICAgICB0TWF0ID0gdHJhbnNmb3JtQS5SO1xuICAgICAgICAgICAgcG9pbnRBWCA9IHRyYW5zZm9ybUEucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55KTtcbiAgICAgICAgICAgIHBvaW50QVkgPSB0cmFuc2Zvcm1BLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueSk7XG4gICAgICAgICAgICBzZ24gPSAocG9pbnRBWCAtIHBvaW50QlgpICogbm9ybWFsWCArIChwb2ludEFZIC0gcG9pbnRCWSkgKiBub3JtYWxZO1xuICAgICAgICAgICAgaWYgKHMgPCAwLjApIHtcbiAgICAgICAgICAgICAgIHRoaXMubV9heGlzLk5lZ2F0aXZlU2VsZigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm1fdHlwZSA9IGIyU2VwYXJhdGlvbkZ1bmN0aW9uLmVfZmFjZUE7XG4gICAgICAgICAgICB0aGlzLm1fYXhpcyA9IGIyTWF0aC5Dcm9zc1ZGKGIyTWF0aC5TdWJ0cmFjdFZWKGxvY2FsUG9pbnRBMiwgbG9jYWxQb2ludEExKSwgMS4wKTtcbiAgICAgICAgICAgIHRoaXMubV9sb2NhbFBvaW50ID0gbG9jYWxQb2ludEE7XG4gICAgICAgICAgICB0VmVjID0gdGhpcy5tX2F4aXM7XG4gICAgICAgICAgICB0TWF0ID0gdHJhbnNmb3JtQS5SO1xuICAgICAgICAgICAgbm9ybWFsWCA9IHRNYXQuY29sMS54ICogdFZlYy54ICsgdE1hdC5jb2wyLnggKiB0VmVjLnk7XG4gICAgICAgICAgICBub3JtYWxZID0gdE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueTtcbiAgICAgICAgICAgIHRWZWMgPSB0aGlzLm1fbG9jYWxQb2ludDtcbiAgICAgICAgICAgIHRNYXQgPSB0cmFuc2Zvcm1BLlI7XG4gICAgICAgICAgICBwb2ludEFYID0gdHJhbnNmb3JtQS5wb3NpdGlvbi54ICsgKHRNYXQuY29sMS54ICogdFZlYy54ICsgdE1hdC5jb2wyLnggKiB0VmVjLnkpO1xuICAgICAgICAgICAgcG9pbnRBWSA9IHRyYW5zZm9ybUEucG9zaXRpb24ueSArICh0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55KTtcbiAgICAgICAgICAgIHRWZWMgPSBsb2NhbFBvaW50QjtcbiAgICAgICAgICAgIHRNYXQgPSB0cmFuc2Zvcm1CLlI7XG4gICAgICAgICAgICBwb2ludEJYID0gdHJhbnNmb3JtQi5wb3NpdGlvbi54ICsgKHRNYXQuY29sMS54ICogdFZlYy54ICsgdE1hdC5jb2wyLnggKiB0VmVjLnkpO1xuICAgICAgICAgICAgcG9pbnRCWSA9IHRyYW5zZm9ybUIucG9zaXRpb24ueSArICh0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55KTtcbiAgICAgICAgICAgIHNnbiA9IChwb2ludEJYIC0gcG9pbnRBWCkgKiBub3JtYWxYICsgKHBvaW50QlkgLSBwb2ludEFZKSAqIG5vcm1hbFk7XG4gICAgICAgICAgICBpZiAocyA8IDAuMCkge1xuICAgICAgICAgICAgICAgdGhpcy5tX2F4aXMuTmVnYXRpdmVTZWxmKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICB9XG4gICB9XG4gICBiMlNlcGFyYXRpb25GdW5jdGlvbi5wcm90b3R5cGUuRXZhbHVhdGUgPSBmdW5jdGlvbiAodHJhbnNmb3JtQSwgdHJhbnNmb3JtQikge1xuICAgICAgdmFyIGF4aXNBO1xuICAgICAgdmFyIGF4aXNCO1xuICAgICAgdmFyIGxvY2FsUG9pbnRBO1xuICAgICAgdmFyIGxvY2FsUG9pbnRCO1xuICAgICAgdmFyIHBvaW50QTtcbiAgICAgIHZhciBwb2ludEI7XG4gICAgICB2YXIgc2VwZXJhdGlvbiA9IDA7XG4gICAgICB2YXIgbm9ybWFsO1xuICAgICAgc3dpdGNoICh0aGlzLm1fdHlwZSkge1xuICAgICAgY2FzZSBiMlNlcGFyYXRpb25GdW5jdGlvbi5lX3BvaW50czpcbiAgICAgICAgIHtcbiAgICAgICAgICAgIGF4aXNBID0gYjJNYXRoLk11bFRNVih0cmFuc2Zvcm1BLlIsIHRoaXMubV9heGlzKTtcbiAgICAgICAgICAgIGF4aXNCID0gYjJNYXRoLk11bFRNVih0cmFuc2Zvcm1CLlIsIHRoaXMubV9heGlzLkdldE5lZ2F0aXZlKCkpO1xuICAgICAgICAgICAgbG9jYWxQb2ludEEgPSB0aGlzLm1fcHJveHlBLkdldFN1cHBvcnRWZXJ0ZXgoYXhpc0EpO1xuICAgICAgICAgICAgbG9jYWxQb2ludEIgPSB0aGlzLm1fcHJveHlCLkdldFN1cHBvcnRWZXJ0ZXgoYXhpc0IpO1xuICAgICAgICAgICAgcG9pbnRBID0gYjJNYXRoLk11bFgodHJhbnNmb3JtQSwgbG9jYWxQb2ludEEpO1xuICAgICAgICAgICAgcG9pbnRCID0gYjJNYXRoLk11bFgodHJhbnNmb3JtQiwgbG9jYWxQb2ludEIpO1xuICAgICAgICAgICAgc2VwZXJhdGlvbiA9IChwb2ludEIueCAtIHBvaW50QS54KSAqIHRoaXMubV9heGlzLnggKyAocG9pbnRCLnkgLSBwb2ludEEueSkgKiB0aGlzLm1fYXhpcy55O1xuICAgICAgICAgICAgcmV0dXJuIHNlcGVyYXRpb247XG4gICAgICAgICB9XG4gICAgICBjYXNlIGIyU2VwYXJhdGlvbkZ1bmN0aW9uLmVfZmFjZUE6XG4gICAgICAgICB7XG4gICAgICAgICAgICBub3JtYWwgPSBiMk1hdGguTXVsTVYodHJhbnNmb3JtQS5SLCB0aGlzLm1fYXhpcyk7XG4gICAgICAgICAgICBwb2ludEEgPSBiMk1hdGguTXVsWCh0cmFuc2Zvcm1BLCB0aGlzLm1fbG9jYWxQb2ludCk7XG4gICAgICAgICAgICBheGlzQiA9IGIyTWF0aC5NdWxUTVYodHJhbnNmb3JtQi5SLCBub3JtYWwuR2V0TmVnYXRpdmUoKSk7XG4gICAgICAgICAgICBsb2NhbFBvaW50QiA9IHRoaXMubV9wcm94eUIuR2V0U3VwcG9ydFZlcnRleChheGlzQik7XG4gICAgICAgICAgICBwb2ludEIgPSBiMk1hdGguTXVsWCh0cmFuc2Zvcm1CLCBsb2NhbFBvaW50Qik7XG4gICAgICAgICAgICBzZXBlcmF0aW9uID0gKHBvaW50Qi54IC0gcG9pbnRBLngpICogbm9ybWFsLnggKyAocG9pbnRCLnkgLSBwb2ludEEueSkgKiBub3JtYWwueTtcbiAgICAgICAgICAgIHJldHVybiBzZXBlcmF0aW9uO1xuICAgICAgICAgfVxuICAgICAgY2FzZSBiMlNlcGFyYXRpb25GdW5jdGlvbi5lX2ZhY2VCOlxuICAgICAgICAge1xuICAgICAgICAgICAgbm9ybWFsID0gYjJNYXRoLk11bE1WKHRyYW5zZm9ybUIuUiwgdGhpcy5tX2F4aXMpO1xuICAgICAgICAgICAgcG9pbnRCID0gYjJNYXRoLk11bFgodHJhbnNmb3JtQiwgdGhpcy5tX2xvY2FsUG9pbnQpO1xuICAgICAgICAgICAgYXhpc0EgPSBiMk1hdGguTXVsVE1WKHRyYW5zZm9ybUEuUiwgbm9ybWFsLkdldE5lZ2F0aXZlKCkpO1xuICAgICAgICAgICAgbG9jYWxQb2ludEEgPSB0aGlzLm1fcHJveHlBLkdldFN1cHBvcnRWZXJ0ZXgoYXhpc0EpO1xuICAgICAgICAgICAgcG9pbnRBID0gYjJNYXRoLk11bFgodHJhbnNmb3JtQSwgbG9jYWxQb2ludEEpO1xuICAgICAgICAgICAgc2VwZXJhdGlvbiA9IChwb2ludEEueCAtIHBvaW50Qi54KSAqIG5vcm1hbC54ICsgKHBvaW50QS55IC0gcG9pbnRCLnkpICogbm9ybWFsLnk7XG4gICAgICAgICAgICByZXR1cm4gc2VwZXJhdGlvbjtcbiAgICAgICAgIH1cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgICBiMlNldHRpbmdzLmIyQXNzZXJ0KGZhbHNlKTtcbiAgICAgICAgIHJldHVybiAwLjA7XG4gICAgICB9XG4gICB9XG4gICBCb3gyRC5wb3N0RGVmcy5wdXNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5iMlNlcGFyYXRpb25GdW5jdGlvbi5lX3BvaW50cyA9IDB4MDE7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJTZXBhcmF0aW9uRnVuY3Rpb24uZV9mYWNlQSA9IDB4MDI7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJTZXBhcmF0aW9uRnVuY3Rpb24uZV9mYWNlQiA9IDB4MDQ7XG4gICB9KTtcbiAgIGIyU2ltcGxleC5iMlNpbXBsZXggPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1fdjEgPSBuZXcgYjJTaW1wbGV4VmVydGV4KCk7XG4gICAgICB0aGlzLm1fdjIgPSBuZXcgYjJTaW1wbGV4VmVydGV4KCk7XG4gICAgICB0aGlzLm1fdjMgPSBuZXcgYjJTaW1wbGV4VmVydGV4KCk7XG4gICAgICB0aGlzLm1fdmVydGljZXMgPSBuZXcgVmVjdG9yKDMpO1xuICAgfTtcbiAgIGIyU2ltcGxleC5wcm90b3R5cGUuYjJTaW1wbGV4ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX3ZlcnRpY2VzWzBdID0gdGhpcy5tX3YxO1xuICAgICAgdGhpcy5tX3ZlcnRpY2VzWzFdID0gdGhpcy5tX3YyO1xuICAgICAgdGhpcy5tX3ZlcnRpY2VzWzJdID0gdGhpcy5tX3YzO1xuICAgfVxuICAgYjJTaW1wbGV4LnByb3RvdHlwZS5SZWFkQ2FjaGUgPSBmdW5jdGlvbiAoY2FjaGUsIHByb3h5QSwgdHJhbnNmb3JtQSwgcHJveHlCLCB0cmFuc2Zvcm1CKSB7XG4gICAgICBiMlNldHRpbmdzLmIyQXNzZXJ0KDAgPD0gY2FjaGUuY291bnQgJiYgY2FjaGUuY291bnQgPD0gMyk7XG4gICAgICB2YXIgd0FMb2NhbDtcbiAgICAgIHZhciB3QkxvY2FsO1xuICAgICAgdGhpcy5tX2NvdW50ID0gY2FjaGUuY291bnQ7XG4gICAgICB2YXIgdmVydGljZXMgPSB0aGlzLm1fdmVydGljZXM7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubV9jb3VudDsgaSsrKSB7XG4gICAgICAgICB2YXIgdiA9IHZlcnRpY2VzW2ldO1xuICAgICAgICAgdi5pbmRleEEgPSBjYWNoZS5pbmRleEFbaV07XG4gICAgICAgICB2LmluZGV4QiA9IGNhY2hlLmluZGV4QltpXTtcbiAgICAgICAgIHdBTG9jYWwgPSBwcm94eUEuR2V0VmVydGV4KHYuaW5kZXhBKTtcbiAgICAgICAgIHdCTG9jYWwgPSBwcm94eUIuR2V0VmVydGV4KHYuaW5kZXhCKTtcbiAgICAgICAgIHYud0EgPSBiMk1hdGguTXVsWCh0cmFuc2Zvcm1BLCB3QUxvY2FsKTtcbiAgICAgICAgIHYud0IgPSBiMk1hdGguTXVsWCh0cmFuc2Zvcm1CLCB3QkxvY2FsKTtcbiAgICAgICAgIHYudyA9IGIyTWF0aC5TdWJ0cmFjdFZWKHYud0IsIHYud0EpO1xuICAgICAgICAgdi5hID0gMDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm1fY291bnQgPiAxKSB7XG4gICAgICAgICB2YXIgbWV0cmljMSA9IGNhY2hlLm1ldHJpYztcbiAgICAgICAgIHZhciBtZXRyaWMyID0gdGhpcy5HZXRNZXRyaWMoKTtcbiAgICAgICAgIGlmIChtZXRyaWMyIDwgLjUgKiBtZXRyaWMxIHx8IDIuMCAqIG1ldHJpYzEgPCBtZXRyaWMyIHx8IG1ldHJpYzIgPCBOdW1iZXIuTUlOX1ZBTFVFKSB7XG4gICAgICAgICAgICB0aGlzLm1fY291bnQgPSAwO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMubV9jb3VudCA9PSAwKSB7XG4gICAgICAgICB2ID0gdmVydGljZXNbMF07XG4gICAgICAgICB2LmluZGV4QSA9IDA7XG4gICAgICAgICB2LmluZGV4QiA9IDA7XG4gICAgICAgICB3QUxvY2FsID0gcHJveHlBLkdldFZlcnRleCgwKTtcbiAgICAgICAgIHdCTG9jYWwgPSBwcm94eUIuR2V0VmVydGV4KDApO1xuICAgICAgICAgdi53QSA9IGIyTWF0aC5NdWxYKHRyYW5zZm9ybUEsIHdBTG9jYWwpO1xuICAgICAgICAgdi53QiA9IGIyTWF0aC5NdWxYKHRyYW5zZm9ybUIsIHdCTG9jYWwpO1xuICAgICAgICAgdi53ID0gYjJNYXRoLlN1YnRyYWN0VlYodi53Qiwgdi53QSk7XG4gICAgICAgICB0aGlzLm1fY291bnQgPSAxO1xuICAgICAgfVxuICAgfVxuICAgYjJTaW1wbGV4LnByb3RvdHlwZS5Xcml0ZUNhY2hlID0gZnVuY3Rpb24gKGNhY2hlKSB7XG4gICAgICBjYWNoZS5tZXRyaWMgPSB0aGlzLkdldE1ldHJpYygpO1xuICAgICAgY2FjaGUuY291bnQgPSBCb3gyRC5wYXJzZVVJbnQodGhpcy5tX2NvdW50KTtcbiAgICAgIHZhciB2ZXJ0aWNlcyA9IHRoaXMubV92ZXJ0aWNlcztcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tX2NvdW50OyBpKyspIHtcbiAgICAgICAgIGNhY2hlLmluZGV4QVtpXSA9IEJveDJELnBhcnNlVUludCh2ZXJ0aWNlc1tpXS5pbmRleEEpO1xuICAgICAgICAgY2FjaGUuaW5kZXhCW2ldID0gQm94MkQucGFyc2VVSW50KHZlcnRpY2VzW2ldLmluZGV4Qik7XG4gICAgICB9XG4gICB9XG4gICBiMlNpbXBsZXgucHJvdG90eXBlLkdldFNlYXJjaERpcmVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHN3aXRjaCAodGhpcy5tX2NvdW50KSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgICByZXR1cm4gdGhpcy5tX3YxLncuR2V0TmVnYXRpdmUoKTtcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgIHtcbiAgICAgICAgICAgIHZhciBlMTIgPSBiMk1hdGguU3VidHJhY3RWVih0aGlzLm1fdjIudywgdGhpcy5tX3YxLncpO1xuICAgICAgICAgICAgdmFyIHNnbiA9IGIyTWF0aC5Dcm9zc1ZWKGUxMiwgdGhpcy5tX3YxLncuR2V0TmVnYXRpdmUoKSk7XG4gICAgICAgICAgICBpZiAoc2duID4gMC4wKSB7XG4gICAgICAgICAgICAgICByZXR1cm4gYjJNYXRoLkNyb3NzRlYoMS4wLCBlMTIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICByZXR1cm4gYjJNYXRoLkNyb3NzVkYoZTEyLCAxLjApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgIGIyU2V0dGluZ3MuYjJBc3NlcnQoZmFsc2UpO1xuICAgICAgICAgcmV0dXJuIG5ldyBiMlZlYzIoKTtcbiAgICAgIH1cbiAgIH1cbiAgIGIyU2ltcGxleC5wcm90b3R5cGUuR2V0Q2xvc2VzdFBvaW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgc3dpdGNoICh0aGlzLm1fY291bnQpIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgIGIyU2V0dGluZ3MuYjJBc3NlcnQoZmFsc2UpO1xuICAgICAgICAgcmV0dXJuIG5ldyBiMlZlYzIoKTtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgIHJldHVybiB0aGlzLm1fdjEudztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgIHJldHVybiBuZXcgYjJWZWMyKHRoaXMubV92MS5hICogdGhpcy5tX3YxLncueCArIHRoaXMubV92Mi5hICogdGhpcy5tX3YyLncueCwgdGhpcy5tX3YxLmEgKiB0aGlzLm1fdjEudy55ICsgdGhpcy5tX3YyLmEgKiB0aGlzLm1fdjIudy55KTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgICBiMlNldHRpbmdzLmIyQXNzZXJ0KGZhbHNlKTtcbiAgICAgICAgIHJldHVybiBuZXcgYjJWZWMyKCk7XG4gICAgICB9XG4gICB9XG4gICBiMlNpbXBsZXgucHJvdG90eXBlLkdldFdpdG5lc3NQb2ludHMgPSBmdW5jdGlvbiAocEEsIHBCKSB7XG4gICAgICBzd2l0Y2ggKHRoaXMubV9jb3VudCkge1xuICAgICAgY2FzZSAwOlxuICAgICAgICAgYjJTZXR0aW5ncy5iMkFzc2VydChmYWxzZSk7XG4gICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgIHBBLlNldFYodGhpcy5tX3YxLndBKTtcbiAgICAgICAgIHBCLlNldFYodGhpcy5tX3YxLndCKTtcbiAgICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICAgcEEueCA9IHRoaXMubV92MS5hICogdGhpcy5tX3YxLndBLnggKyB0aGlzLm1fdjIuYSAqIHRoaXMubV92Mi53QS54O1xuICAgICAgICAgcEEueSA9IHRoaXMubV92MS5hICogdGhpcy5tX3YxLndBLnkgKyB0aGlzLm1fdjIuYSAqIHRoaXMubV92Mi53QS55O1xuICAgICAgICAgcEIueCA9IHRoaXMubV92MS5hICogdGhpcy5tX3YxLndCLnggKyB0aGlzLm1fdjIuYSAqIHRoaXMubV92Mi53Qi54O1xuICAgICAgICAgcEIueSA9IHRoaXMubV92MS5hICogdGhpcy5tX3YxLndCLnkgKyB0aGlzLm1fdjIuYSAqIHRoaXMubV92Mi53Qi55O1xuICAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgICBwQi54ID0gcEEueCA9IHRoaXMubV92MS5hICogdGhpcy5tX3YxLndBLnggKyB0aGlzLm1fdjIuYSAqIHRoaXMubV92Mi53QS54ICsgdGhpcy5tX3YzLmEgKiB0aGlzLm1fdjMud0EueDtcbiAgICAgICAgIHBCLnkgPSBwQS55ID0gdGhpcy5tX3YxLmEgKiB0aGlzLm1fdjEud0EueSArIHRoaXMubV92Mi5hICogdGhpcy5tX3YyLndBLnkgKyB0aGlzLm1fdjMuYSAqIHRoaXMubV92My53QS55O1xuICAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICAgYjJTZXR0aW5ncy5iMkFzc2VydChmYWxzZSk7XG4gICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgIH1cbiAgIGIyU2ltcGxleC5wcm90b3R5cGUuR2V0TWV0cmljID0gZnVuY3Rpb24gKCkge1xuICAgICAgc3dpdGNoICh0aGlzLm1fY291bnQpIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgIGIyU2V0dGluZ3MuYjJBc3NlcnQoZmFsc2UpO1xuICAgICAgICAgcmV0dXJuIDAuMDtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgIHJldHVybiAwLjA7XG4gICAgICBjYXNlIDI6XG4gICAgICAgICByZXR1cm4gYjJNYXRoLlN1YnRyYWN0VlYodGhpcy5tX3YxLncsIHRoaXMubV92Mi53KS5MZW5ndGgoKTtcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgIHJldHVybiBiMk1hdGguQ3Jvc3NWVihiMk1hdGguU3VidHJhY3RWVih0aGlzLm1fdjIudywgdGhpcy5tX3YxLncpLCBiMk1hdGguU3VidHJhY3RWVih0aGlzLm1fdjMudywgdGhpcy5tX3YxLncpKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgICBiMlNldHRpbmdzLmIyQXNzZXJ0KGZhbHNlKTtcbiAgICAgICAgIHJldHVybiAwLjA7XG4gICAgICB9XG4gICB9XG4gICBiMlNpbXBsZXgucHJvdG90eXBlLlNvbHZlMiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB3MSA9IHRoaXMubV92MS53O1xuICAgICAgdmFyIHcyID0gdGhpcy5tX3YyLnc7XG4gICAgICB2YXIgZTEyID0gYjJNYXRoLlN1YnRyYWN0VlYodzIsIHcxKTtcbiAgICAgIHZhciBkMTJfMiA9ICgtKHcxLnggKiBlMTIueCArIHcxLnkgKiBlMTIueSkpO1xuICAgICAgaWYgKGQxMl8yIDw9IDAuMCkge1xuICAgICAgICAgdGhpcy5tX3YxLmEgPSAxLjA7XG4gICAgICAgICB0aGlzLm1fY291bnQgPSAxO1xuICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGQxMl8xID0gKHcyLnggKiBlMTIueCArIHcyLnkgKiBlMTIueSk7XG4gICAgICBpZiAoZDEyXzEgPD0gMC4wKSB7XG4gICAgICAgICB0aGlzLm1fdjIuYSA9IDEuMDtcbiAgICAgICAgIHRoaXMubV9jb3VudCA9IDE7XG4gICAgICAgICB0aGlzLm1fdjEuU2V0KHRoaXMubV92Mik7XG4gICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgaW52X2QxMiA9IDEuMCAvIChkMTJfMSArIGQxMl8yKTtcbiAgICAgIHRoaXMubV92MS5hID0gZDEyXzEgKiBpbnZfZDEyO1xuICAgICAgdGhpcy5tX3YyLmEgPSBkMTJfMiAqIGludl9kMTI7XG4gICAgICB0aGlzLm1fY291bnQgPSAyO1xuICAgfVxuICAgYjJTaW1wbGV4LnByb3RvdHlwZS5Tb2x2ZTMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgdzEgPSB0aGlzLm1fdjEudztcbiAgICAgIHZhciB3MiA9IHRoaXMubV92Mi53O1xuICAgICAgdmFyIHczID0gdGhpcy5tX3YzLnc7XG4gICAgICB2YXIgZTEyID0gYjJNYXRoLlN1YnRyYWN0VlYodzIsIHcxKTtcbiAgICAgIHZhciB3MWUxMiA9IGIyTWF0aC5Eb3QodzEsIGUxMik7XG4gICAgICB2YXIgdzJlMTIgPSBiMk1hdGguRG90KHcyLCBlMTIpO1xuICAgICAgdmFyIGQxMl8xID0gdzJlMTI7XG4gICAgICB2YXIgZDEyXzIgPSAoLXcxZTEyKTtcbiAgICAgIHZhciBlMTMgPSBiMk1hdGguU3VidHJhY3RWVih3MywgdzEpO1xuICAgICAgdmFyIHcxZTEzID0gYjJNYXRoLkRvdCh3MSwgZTEzKTtcbiAgICAgIHZhciB3M2UxMyA9IGIyTWF0aC5Eb3QodzMsIGUxMyk7XG4gICAgICB2YXIgZDEzXzEgPSB3M2UxMztcbiAgICAgIHZhciBkMTNfMiA9ICgtdzFlMTMpO1xuICAgICAgdmFyIGUyMyA9IGIyTWF0aC5TdWJ0cmFjdFZWKHczLCB3Mik7XG4gICAgICB2YXIgdzJlMjMgPSBiMk1hdGguRG90KHcyLCBlMjMpO1xuICAgICAgdmFyIHczZTIzID0gYjJNYXRoLkRvdCh3MywgZTIzKTtcbiAgICAgIHZhciBkMjNfMSA9IHczZTIzO1xuICAgICAgdmFyIGQyM18yID0gKC13MmUyMyk7XG4gICAgICB2YXIgbjEyMyA9IGIyTWF0aC5Dcm9zc1ZWKGUxMiwgZTEzKTtcbiAgICAgIHZhciBkMTIzXzEgPSBuMTIzICogYjJNYXRoLkNyb3NzVlYodzIsIHczKTtcbiAgICAgIHZhciBkMTIzXzIgPSBuMTIzICogYjJNYXRoLkNyb3NzVlYodzMsIHcxKTtcbiAgICAgIHZhciBkMTIzXzMgPSBuMTIzICogYjJNYXRoLkNyb3NzVlYodzEsIHcyKTtcbiAgICAgIGlmIChkMTJfMiA8PSAwLjAgJiYgZDEzXzIgPD0gMC4wKSB7XG4gICAgICAgICB0aGlzLm1fdjEuYSA9IDEuMDtcbiAgICAgICAgIHRoaXMubV9jb3VudCA9IDE7XG4gICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZDEyXzEgPiAwLjAgJiYgZDEyXzIgPiAwLjAgJiYgZDEyM18zIDw9IDAuMCkge1xuICAgICAgICAgdmFyIGludl9kMTIgPSAxLjAgLyAoZDEyXzEgKyBkMTJfMik7XG4gICAgICAgICB0aGlzLm1fdjEuYSA9IGQxMl8xICogaW52X2QxMjtcbiAgICAgICAgIHRoaXMubV92Mi5hID0gZDEyXzIgKiBpbnZfZDEyO1xuICAgICAgICAgdGhpcy5tX2NvdW50ID0gMjtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChkMTNfMSA+IDAuMCAmJiBkMTNfMiA+IDAuMCAmJiBkMTIzXzIgPD0gMC4wKSB7XG4gICAgICAgICB2YXIgaW52X2QxMyA9IDEuMCAvIChkMTNfMSArIGQxM18yKTtcbiAgICAgICAgIHRoaXMubV92MS5hID0gZDEzXzEgKiBpbnZfZDEzO1xuICAgICAgICAgdGhpcy5tX3YzLmEgPSBkMTNfMiAqIGludl9kMTM7XG4gICAgICAgICB0aGlzLm1fY291bnQgPSAyO1xuICAgICAgICAgdGhpcy5tX3YyLlNldCh0aGlzLm1fdjMpO1xuICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKGQxMl8xIDw9IDAuMCAmJiBkMjNfMiA8PSAwLjApIHtcbiAgICAgICAgIHRoaXMubV92Mi5hID0gMS4wO1xuICAgICAgICAgdGhpcy5tX2NvdW50ID0gMTtcbiAgICAgICAgIHRoaXMubV92MS5TZXQodGhpcy5tX3YyKTtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChkMTNfMSA8PSAwLjAgJiYgZDIzXzEgPD0gMC4wKSB7XG4gICAgICAgICB0aGlzLm1fdjMuYSA9IDEuMDtcbiAgICAgICAgIHRoaXMubV9jb3VudCA9IDE7XG4gICAgICAgICB0aGlzLm1fdjEuU2V0KHRoaXMubV92Myk7XG4gICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoZDIzXzEgPiAwLjAgJiYgZDIzXzIgPiAwLjAgJiYgZDEyM18xIDw9IDAuMCkge1xuICAgICAgICAgdmFyIGludl9kMjMgPSAxLjAgLyAoZDIzXzEgKyBkMjNfMik7XG4gICAgICAgICB0aGlzLm1fdjIuYSA9IGQyM18xICogaW52X2QyMztcbiAgICAgICAgIHRoaXMubV92My5hID0gZDIzXzIgKiBpbnZfZDIzO1xuICAgICAgICAgdGhpcy5tX2NvdW50ID0gMjtcbiAgICAgICAgIHRoaXMubV92MS5TZXQodGhpcy5tX3YzKTtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBpbnZfZDEyMyA9IDEuMCAvIChkMTIzXzEgKyBkMTIzXzIgKyBkMTIzXzMpO1xuICAgICAgdGhpcy5tX3YxLmEgPSBkMTIzXzEgKiBpbnZfZDEyMztcbiAgICAgIHRoaXMubV92Mi5hID0gZDEyM18yICogaW52X2QxMjM7XG4gICAgICB0aGlzLm1fdjMuYSA9IGQxMjNfMyAqIGludl9kMTIzO1xuICAgICAgdGhpcy5tX2NvdW50ID0gMztcbiAgIH1cbiAgIGIyU2ltcGxleENhY2hlLmIyU2ltcGxleENhY2hlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5pbmRleEEgPSBuZXcgVmVjdG9yX2Eyal9OdW1iZXIoMyk7XG4gICAgICB0aGlzLmluZGV4QiA9IG5ldyBWZWN0b3JfYTJqX051bWJlcigzKTtcbiAgIH07XG4gICBiMlNpbXBsZXhWZXJ0ZXguYjJTaW1wbGV4VmVydGV4ID0gZnVuY3Rpb24gKCkge307XG4gICBiMlNpbXBsZXhWZXJ0ZXgucHJvdG90eXBlLlNldCA9IGZ1bmN0aW9uIChvdGhlcikge1xuICAgICAgdGhpcy53QS5TZXRWKG90aGVyLndBKTtcbiAgICAgIHRoaXMud0IuU2V0VihvdGhlci53Qik7XG4gICAgICB0aGlzLncuU2V0VihvdGhlci53KTtcbiAgICAgIHRoaXMuYSA9IG90aGVyLmE7XG4gICAgICB0aGlzLmluZGV4QSA9IG90aGVyLmluZGV4QTtcbiAgICAgIHRoaXMuaW5kZXhCID0gb3RoZXIuaW5kZXhCO1xuICAgfVxuICAgYjJUaW1lT2ZJbXBhY3QuYjJUaW1lT2ZJbXBhY3QgPSBmdW5jdGlvbiAoKSB7fTtcbiAgIGIyVGltZU9mSW1wYWN0LlRpbWVPZkltcGFjdCA9IGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgKytiMlRpbWVPZkltcGFjdC5iMl90b2lDYWxscztcbiAgICAgIHZhciBwcm94eUEgPSBpbnB1dC5wcm94eUE7XG4gICAgICB2YXIgcHJveHlCID0gaW5wdXQucHJveHlCO1xuICAgICAgdmFyIHN3ZWVwQSA9IGlucHV0LnN3ZWVwQTtcbiAgICAgIHZhciBzd2VlcEIgPSBpbnB1dC5zd2VlcEI7XG4gICAgICBiMlNldHRpbmdzLmIyQXNzZXJ0KHN3ZWVwQS50MCA9PSBzd2VlcEIudDApO1xuICAgICAgYjJTZXR0aW5ncy5iMkFzc2VydCgxLjAgLSBzd2VlcEEudDAgPiBOdW1iZXIuTUlOX1ZBTFVFKTtcbiAgICAgIHZhciByYWRpdXMgPSBwcm94eUEubV9yYWRpdXMgKyBwcm94eUIubV9yYWRpdXM7XG4gICAgICB2YXIgdG9sZXJhbmNlID0gaW5wdXQudG9sZXJhbmNlO1xuICAgICAgdmFyIGFscGhhID0gMC4wO1xuICAgICAgdmFyIGtfbWF4SXRlcmF0aW9ucyA9IDEwMDA7XG4gICAgICB2YXIgaXRlciA9IDA7XG4gICAgICB2YXIgdGFyZ2V0ID0gMC4wO1xuICAgICAgYjJUaW1lT2ZJbXBhY3Quc19jYWNoZS5jb3VudCA9IDA7XG4gICAgICBiMlRpbWVPZkltcGFjdC5zX2Rpc3RhbmNlSW5wdXQudXNlUmFkaWkgPSBmYWxzZTtcbiAgICAgIGZvciAoOzspIHtcbiAgICAgICAgIHN3ZWVwQS5HZXRUcmFuc2Zvcm0oYjJUaW1lT2ZJbXBhY3Quc194ZkEsIGFscGhhKTtcbiAgICAgICAgIHN3ZWVwQi5HZXRUcmFuc2Zvcm0oYjJUaW1lT2ZJbXBhY3Quc194ZkIsIGFscGhhKTtcbiAgICAgICAgIGIyVGltZU9mSW1wYWN0LnNfZGlzdGFuY2VJbnB1dC5wcm94eUEgPSBwcm94eUE7XG4gICAgICAgICBiMlRpbWVPZkltcGFjdC5zX2Rpc3RhbmNlSW5wdXQucHJveHlCID0gcHJveHlCO1xuICAgICAgICAgYjJUaW1lT2ZJbXBhY3Quc19kaXN0YW5jZUlucHV0LnRyYW5zZm9ybUEgPSBiMlRpbWVPZkltcGFjdC5zX3hmQTtcbiAgICAgICAgIGIyVGltZU9mSW1wYWN0LnNfZGlzdGFuY2VJbnB1dC50cmFuc2Zvcm1CID0gYjJUaW1lT2ZJbXBhY3Quc194ZkI7XG4gICAgICAgICBiMkRpc3RhbmNlLkRpc3RhbmNlKGIyVGltZU9mSW1wYWN0LnNfZGlzdGFuY2VPdXRwdXQsIGIyVGltZU9mSW1wYWN0LnNfY2FjaGUsIGIyVGltZU9mSW1wYWN0LnNfZGlzdGFuY2VJbnB1dCk7XG4gICAgICAgICBpZiAoYjJUaW1lT2ZJbXBhY3Quc19kaXN0YW5jZU91dHB1dC5kaXN0YW5jZSA8PSAwLjApIHtcbiAgICAgICAgICAgIGFscGhhID0gMS4wO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICB9XG4gICAgICAgICBiMlRpbWVPZkltcGFjdC5zX2Zjbi5Jbml0aWFsaXplKGIyVGltZU9mSW1wYWN0LnNfY2FjaGUsIHByb3h5QSwgYjJUaW1lT2ZJbXBhY3Quc194ZkEsIHByb3h5QiwgYjJUaW1lT2ZJbXBhY3Quc194ZkIpO1xuICAgICAgICAgdmFyIHNlcGFyYXRpb24gPSBiMlRpbWVPZkltcGFjdC5zX2Zjbi5FdmFsdWF0ZShiMlRpbWVPZkltcGFjdC5zX3hmQSwgYjJUaW1lT2ZJbXBhY3Quc194ZkIpO1xuICAgICAgICAgaWYgKHNlcGFyYXRpb24gPD0gMC4wKSB7XG4gICAgICAgICAgICBhbHBoYSA9IDEuMDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgfVxuICAgICAgICAgaWYgKGl0ZXIgPT0gMCkge1xuICAgICAgICAgICAgaWYgKHNlcGFyYXRpb24gPiByYWRpdXMpIHtcbiAgICAgICAgICAgICAgIHRhcmdldCA9IGIyTWF0aC5NYXgocmFkaXVzIC0gdG9sZXJhbmNlLCAwLjc1ICogcmFkaXVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgdGFyZ2V0ID0gYjJNYXRoLk1heChzZXBhcmF0aW9uIC0gdG9sZXJhbmNlLCAwLjAyICogcmFkaXVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgICAgIGlmIChzZXBhcmF0aW9uIC0gdGFyZ2V0IDwgMC41ICogdG9sZXJhbmNlKSB7XG4gICAgICAgICAgICBpZiAoaXRlciA9PSAwKSB7XG4gICAgICAgICAgICAgICBhbHBoYSA9IDEuMDtcbiAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICB9XG4gICAgICAgICB2YXIgbmV3QWxwaGEgPSBhbHBoYTsge1xuICAgICAgICAgICAgdmFyIHgxID0gYWxwaGE7XG4gICAgICAgICAgICB2YXIgeDIgPSAxLjA7XG4gICAgICAgICAgICB2YXIgZjEgPSBzZXBhcmF0aW9uO1xuICAgICAgICAgICAgc3dlZXBBLkdldFRyYW5zZm9ybShiMlRpbWVPZkltcGFjdC5zX3hmQSwgeDIpO1xuICAgICAgICAgICAgc3dlZXBCLkdldFRyYW5zZm9ybShiMlRpbWVPZkltcGFjdC5zX3hmQiwgeDIpO1xuICAgICAgICAgICAgdmFyIGYyID0gYjJUaW1lT2ZJbXBhY3Quc19mY24uRXZhbHVhdGUoYjJUaW1lT2ZJbXBhY3Quc194ZkEsIGIyVGltZU9mSW1wYWN0LnNfeGZCKTtcbiAgICAgICAgICAgIGlmIChmMiA+PSB0YXJnZXQpIHtcbiAgICAgICAgICAgICAgIGFscGhhID0gMS4wO1xuICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcm9vdEl0ZXJDb3VudCA9IDA7XG4gICAgICAgICAgICBmb3IgKDs7KSB7XG4gICAgICAgICAgICAgICB2YXIgeCA9IDA7XG4gICAgICAgICAgICAgICBpZiAocm9vdEl0ZXJDb3VudCAmIDEpIHtcbiAgICAgICAgICAgICAgICAgIHggPSB4MSArICh0YXJnZXQgLSBmMSkgKiAoeDIgLSB4MSkgLyAoZjIgLSBmMSk7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHggPSAwLjUgKiAoeDEgKyB4Mik7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBzd2VlcEEuR2V0VHJhbnNmb3JtKGIyVGltZU9mSW1wYWN0LnNfeGZBLCB4KTtcbiAgICAgICAgICAgICAgIHN3ZWVwQi5HZXRUcmFuc2Zvcm0oYjJUaW1lT2ZJbXBhY3Quc194ZkIsIHgpO1xuICAgICAgICAgICAgICAgdmFyIGYgPSBiMlRpbWVPZkltcGFjdC5zX2Zjbi5FdmFsdWF0ZShiMlRpbWVPZkltcGFjdC5zX3hmQSwgYjJUaW1lT2ZJbXBhY3Quc194ZkIpO1xuICAgICAgICAgICAgICAgaWYgKGIyTWF0aC5BYnMoZiAtIHRhcmdldCkgPCAwLjAyNSAqIHRvbGVyYW5jZSkge1xuICAgICAgICAgICAgICAgICAgbmV3QWxwaGEgPSB4O1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBpZiAoZiA+IHRhcmdldCkge1xuICAgICAgICAgICAgICAgICAgeDEgPSB4O1xuICAgICAgICAgICAgICAgICAgZjEgPSBmO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICB4MiA9IHg7XG4gICAgICAgICAgICAgICAgICBmMiA9IGY7XG4gICAgICAgICAgICAgICB9Kytyb290SXRlckNvdW50O1xuICAgICAgICAgICAgICAgKytiMlRpbWVPZkltcGFjdC5iMl90b2lSb290SXRlcnM7XG4gICAgICAgICAgICAgICBpZiAocm9vdEl0ZXJDb3VudCA9PSA1MCkge1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBiMlRpbWVPZkltcGFjdC5iMl90b2lNYXhSb290SXRlcnMgPSBiMk1hdGguTWF4KGIyVGltZU9mSW1wYWN0LmIyX3RvaU1heFJvb3RJdGVycywgcm9vdEl0ZXJDb3VudCk7XG4gICAgICAgICB9XG4gICAgICAgICBpZiAobmV3QWxwaGEgPCAoMS4wICsgMTAwLjAgKiBOdW1iZXIuTUlOX1ZBTFVFKSAqIGFscGhhKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgIH1cbiAgICAgICAgIGFscGhhID0gbmV3QWxwaGE7XG4gICAgICAgICBpdGVyKys7XG4gICAgICAgICArK2IyVGltZU9mSW1wYWN0LmIyX3RvaUl0ZXJzO1xuICAgICAgICAgaWYgKGl0ZXIgPT0ga19tYXhJdGVyYXRpb25zKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGIyVGltZU9mSW1wYWN0LmIyX3RvaU1heEl0ZXJzID0gYjJNYXRoLk1heChiMlRpbWVPZkltcGFjdC5iMl90b2lNYXhJdGVycywgaXRlcik7XG4gICAgICByZXR1cm4gYWxwaGE7XG4gICB9XG4gICBCb3gyRC5wb3N0RGVmcy5wdXNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5iMlRpbWVPZkltcGFjdC5iMl90b2lDYWxscyA9IDA7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJUaW1lT2ZJbXBhY3QuYjJfdG9pSXRlcnMgPSAwO1xuICAgICAgQm94MkQuQ29sbGlzaW9uLmIyVGltZU9mSW1wYWN0LmIyX3RvaU1heEl0ZXJzID0gMDtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5iMlRpbWVPZkltcGFjdC5iMl90b2lSb290SXRlcnMgPSAwO1xuICAgICAgQm94MkQuQ29sbGlzaW9uLmIyVGltZU9mSW1wYWN0LmIyX3RvaU1heFJvb3RJdGVycyA9IDA7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJUaW1lT2ZJbXBhY3Quc19jYWNoZSA9IG5ldyBiMlNpbXBsZXhDYWNoZSgpO1xuICAgICAgQm94MkQuQ29sbGlzaW9uLmIyVGltZU9mSW1wYWN0LnNfZGlzdGFuY2VJbnB1dCA9IG5ldyBiMkRpc3RhbmNlSW5wdXQoKTtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5iMlRpbWVPZkltcGFjdC5zX3hmQSA9IG5ldyBiMlRyYW5zZm9ybSgpO1xuICAgICAgQm94MkQuQ29sbGlzaW9uLmIyVGltZU9mSW1wYWN0LnNfeGZCID0gbmV3IGIyVHJhbnNmb3JtKCk7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uYjJUaW1lT2ZJbXBhY3Quc19mY24gPSBuZXcgYjJTZXBhcmF0aW9uRnVuY3Rpb24oKTtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5iMlRpbWVPZkltcGFjdC5zX2Rpc3RhbmNlT3V0cHV0ID0gbmV3IGIyRGlzdGFuY2VPdXRwdXQoKTtcbiAgIH0pO1xuICAgYjJUT0lJbnB1dC5iMlRPSUlucHV0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5wcm94eUEgPSBuZXcgYjJEaXN0YW5jZVByb3h5KCk7XG4gICAgICB0aGlzLnByb3h5QiA9IG5ldyBiMkRpc3RhbmNlUHJveHkoKTtcbiAgICAgIHRoaXMuc3dlZXBBID0gbmV3IGIyU3dlZXAoKTtcbiAgICAgIHRoaXMuc3dlZXBCID0gbmV3IGIyU3dlZXAoKTtcbiAgIH07XG4gICBiMldvcmxkTWFuaWZvbGQuYjJXb3JsZE1hbmlmb2xkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX25vcm1hbCA9IG5ldyBiMlZlYzIoKTtcbiAgIH07XG4gICBiMldvcmxkTWFuaWZvbGQucHJvdG90eXBlLmIyV29ybGRNYW5pZm9sZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubV9wb2ludHMgPSBuZXcgVmVjdG9yKGIyU2V0dGluZ3MuYjJfbWF4TWFuaWZvbGRQb2ludHMpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiMlNldHRpbmdzLmIyX21heE1hbmlmb2xkUG9pbnRzOyBpKyspIHtcbiAgICAgICAgIHRoaXMubV9wb2ludHNbaV0gPSBuZXcgYjJWZWMyKCk7XG4gICAgICB9XG4gICB9XG4gICBiMldvcmxkTWFuaWZvbGQucHJvdG90eXBlLkluaXRpYWxpemUgPSBmdW5jdGlvbiAobWFuaWZvbGQsIHhmQSwgcmFkaXVzQSwgeGZCLCByYWRpdXNCKSB7XG4gICAgICBpZiAocmFkaXVzQSA9PT0gdW5kZWZpbmVkKSByYWRpdXNBID0gMDtcbiAgICAgIGlmIChyYWRpdXNCID09PSB1bmRlZmluZWQpIHJhZGl1c0IgPSAwO1xuICAgICAgaWYgKG1hbmlmb2xkLm1fcG9pbnRDb3VudCA9PSAwKSB7XG4gICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgaSA9IDA7XG4gICAgICB2YXIgdFZlYztcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIG5vcm1hbFggPSAwO1xuICAgICAgdmFyIG5vcm1hbFkgPSAwO1xuICAgICAgdmFyIHBsYW5lUG9pbnRYID0gMDtcbiAgICAgIHZhciBwbGFuZVBvaW50WSA9IDA7XG4gICAgICB2YXIgY2xpcFBvaW50WCA9IDA7XG4gICAgICB2YXIgY2xpcFBvaW50WSA9IDA7XG4gICAgICBzd2l0Y2ggKG1hbmlmb2xkLm1fdHlwZSkge1xuICAgICAgY2FzZSBiMk1hbmlmb2xkLmVfY2lyY2xlczpcbiAgICAgICAgIHtcbiAgICAgICAgICAgIHRNYXQgPSB4ZkEuUjtcbiAgICAgICAgICAgIHRWZWMgPSBtYW5pZm9sZC5tX2xvY2FsUG9pbnQ7XG4gICAgICAgICAgICB2YXIgcG9pbnRBWCA9IHhmQS5wb3NpdGlvbi54ICsgdE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueTtcbiAgICAgICAgICAgIHZhciBwb2ludEFZID0geGZBLnBvc2l0aW9uLnkgKyB0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55O1xuICAgICAgICAgICAgdE1hdCA9IHhmQi5SO1xuICAgICAgICAgICAgdFZlYyA9IG1hbmlmb2xkLm1fcG9pbnRzWzBdLm1fbG9jYWxQb2ludDtcbiAgICAgICAgICAgIHZhciBwb2ludEJYID0geGZCLnBvc2l0aW9uLnggKyB0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55O1xuICAgICAgICAgICAgdmFyIHBvaW50QlkgPSB4ZkIucG9zaXRpb24ueSArIHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnk7XG4gICAgICAgICAgICB2YXIgZFggPSBwb2ludEJYIC0gcG9pbnRBWDtcbiAgICAgICAgICAgIHZhciBkWSA9IHBvaW50QlkgLSBwb2ludEFZO1xuICAgICAgICAgICAgdmFyIGQyID0gZFggKiBkWCArIGRZICogZFk7XG4gICAgICAgICAgICBpZiAoZDIgPiBOdW1iZXIuTUlOX1ZBTFVFICogTnVtYmVyLk1JTl9WQUxVRSkge1xuICAgICAgICAgICAgICAgdmFyIGQgPSBNYXRoLnNxcnQoZDIpO1xuICAgICAgICAgICAgICAgdGhpcy5tX25vcm1hbC54ID0gZFggLyBkO1xuICAgICAgICAgICAgICAgdGhpcy5tX25vcm1hbC55ID0gZFkgLyBkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICB0aGlzLm1fbm9ybWFsLnggPSAxO1xuICAgICAgICAgICAgICAgdGhpcy5tX25vcm1hbC55ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjQVggPSBwb2ludEFYICsgcmFkaXVzQSAqIHRoaXMubV9ub3JtYWwueDtcbiAgICAgICAgICAgIHZhciBjQVkgPSBwb2ludEFZICsgcmFkaXVzQSAqIHRoaXMubV9ub3JtYWwueTtcbiAgICAgICAgICAgIHZhciBjQlggPSBwb2ludEJYIC0gcmFkaXVzQiAqIHRoaXMubV9ub3JtYWwueDtcbiAgICAgICAgICAgIHZhciBjQlkgPSBwb2ludEJZIC0gcmFkaXVzQiAqIHRoaXMubV9ub3JtYWwueTtcbiAgICAgICAgICAgIHRoaXMubV9wb2ludHNbMF0ueCA9IDAuNSAqIChjQVggKyBjQlgpO1xuICAgICAgICAgICAgdGhpcy5tX3BvaW50c1swXS55ID0gMC41ICogKGNBWSArIGNCWSk7XG4gICAgICAgICB9XG4gICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgYjJNYW5pZm9sZC5lX2ZhY2VBOlxuICAgICAgICAge1xuICAgICAgICAgICAgdE1hdCA9IHhmQS5SO1xuICAgICAgICAgICAgdFZlYyA9IG1hbmlmb2xkLm1fbG9jYWxQbGFuZU5vcm1hbDtcbiAgICAgICAgICAgIG5vcm1hbFggPSB0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55O1xuICAgICAgICAgICAgbm9ybWFsWSA9IHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnk7XG4gICAgICAgICAgICB0TWF0ID0geGZBLlI7XG4gICAgICAgICAgICB0VmVjID0gbWFuaWZvbGQubV9sb2NhbFBvaW50O1xuICAgICAgICAgICAgcGxhbmVQb2ludFggPSB4ZkEucG9zaXRpb24ueCArIHRNYXQuY29sMS54ICogdFZlYy54ICsgdE1hdC5jb2wyLnggKiB0VmVjLnk7XG4gICAgICAgICAgICBwbGFuZVBvaW50WSA9IHhmQS5wb3NpdGlvbi55ICsgdE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueTtcbiAgICAgICAgICAgIHRoaXMubV9ub3JtYWwueCA9IG5vcm1hbFg7XG4gICAgICAgICAgICB0aGlzLm1fbm9ybWFsLnkgPSBub3JtYWxZO1xuICAgICAgICAgICAgZm9yIChpID0gMDtcbiAgICAgICAgICAgIGkgPCBtYW5pZm9sZC5tX3BvaW50Q291bnQ7IGkrKykge1xuICAgICAgICAgICAgICAgdE1hdCA9IHhmQi5SO1xuICAgICAgICAgICAgICAgdFZlYyA9IG1hbmlmb2xkLm1fcG9pbnRzW2ldLm1fbG9jYWxQb2ludDtcbiAgICAgICAgICAgICAgIGNsaXBQb2ludFggPSB4ZkIucG9zaXRpb24ueCArIHRNYXQuY29sMS54ICogdFZlYy54ICsgdE1hdC5jb2wyLnggKiB0VmVjLnk7XG4gICAgICAgICAgICAgICBjbGlwUG9pbnRZID0geGZCLnBvc2l0aW9uLnkgKyB0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55O1xuICAgICAgICAgICAgICAgdGhpcy5tX3BvaW50c1tpXS54ID0gY2xpcFBvaW50WCArIDAuNSAqIChyYWRpdXNBIC0gKGNsaXBQb2ludFggLSBwbGFuZVBvaW50WCkgKiBub3JtYWxYIC0gKGNsaXBQb2ludFkgLSBwbGFuZVBvaW50WSkgKiBub3JtYWxZIC0gcmFkaXVzQikgKiBub3JtYWxYO1xuICAgICAgICAgICAgICAgdGhpcy5tX3BvaW50c1tpXS55ID0gY2xpcFBvaW50WSArIDAuNSAqIChyYWRpdXNBIC0gKGNsaXBQb2ludFggLSBwbGFuZVBvaW50WCkgKiBub3JtYWxYIC0gKGNsaXBQb2ludFkgLSBwbGFuZVBvaW50WSkgKiBub3JtYWxZIC0gcmFkaXVzQikgKiBub3JtYWxZO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGIyTWFuaWZvbGQuZV9mYWNlQjpcbiAgICAgICAgIHtcbiAgICAgICAgICAgIHRNYXQgPSB4ZkIuUjtcbiAgICAgICAgICAgIHRWZWMgPSBtYW5pZm9sZC5tX2xvY2FsUGxhbmVOb3JtYWw7XG4gICAgICAgICAgICBub3JtYWxYID0gdE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueTtcbiAgICAgICAgICAgIG5vcm1hbFkgPSB0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55O1xuICAgICAgICAgICAgdE1hdCA9IHhmQi5SO1xuICAgICAgICAgICAgdFZlYyA9IG1hbmlmb2xkLm1fbG9jYWxQb2ludDtcbiAgICAgICAgICAgIHBsYW5lUG9pbnRYID0geGZCLnBvc2l0aW9uLnggKyB0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55O1xuICAgICAgICAgICAgcGxhbmVQb2ludFkgPSB4ZkIucG9zaXRpb24ueSArIHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnk7XG4gICAgICAgICAgICB0aGlzLm1fbm9ybWFsLnggPSAoLW5vcm1hbFgpO1xuICAgICAgICAgICAgdGhpcy5tX25vcm1hbC55ID0gKC1ub3JtYWxZKTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7XG4gICAgICAgICAgICBpIDwgbWFuaWZvbGQubV9wb2ludENvdW50OyBpKyspIHtcbiAgICAgICAgICAgICAgIHRNYXQgPSB4ZkEuUjtcbiAgICAgICAgICAgICAgIHRWZWMgPSBtYW5pZm9sZC5tX3BvaW50c1tpXS5tX2xvY2FsUG9pbnQ7XG4gICAgICAgICAgICAgICBjbGlwUG9pbnRYID0geGZBLnBvc2l0aW9uLnggKyB0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55O1xuICAgICAgICAgICAgICAgY2xpcFBvaW50WSA9IHhmQS5wb3NpdGlvbi55ICsgdE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueTtcbiAgICAgICAgICAgICAgIHRoaXMubV9wb2ludHNbaV0ueCA9IGNsaXBQb2ludFggKyAwLjUgKiAocmFkaXVzQiAtIChjbGlwUG9pbnRYIC0gcGxhbmVQb2ludFgpICogbm9ybWFsWCAtIChjbGlwUG9pbnRZIC0gcGxhbmVQb2ludFkpICogbm9ybWFsWSAtIHJhZGl1c0EpICogbm9ybWFsWDtcbiAgICAgICAgICAgICAgIHRoaXMubV9wb2ludHNbaV0ueSA9IGNsaXBQb2ludFkgKyAwLjUgKiAocmFkaXVzQiAtIChjbGlwUG9pbnRYIC0gcGxhbmVQb2ludFgpICogbm9ybWFsWCAtIChjbGlwUG9pbnRZIC0gcGxhbmVQb2ludFkpICogbm9ybWFsWSAtIHJhZGl1c0EpICogbm9ybWFsWTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgfVxuICAgQ2xpcFZlcnRleC5DbGlwVmVydGV4ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy52ID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5pZCA9IG5ldyBiMkNvbnRhY3RJRCgpO1xuICAgfTtcbiAgIENsaXBWZXJ0ZXgucHJvdG90eXBlLlNldCA9IGZ1bmN0aW9uIChvdGhlcikge1xuICAgICAgdGhpcy52LlNldFYob3RoZXIudik7XG4gICAgICB0aGlzLmlkLlNldChvdGhlci5pZCk7XG4gICB9XG4gICBGZWF0dXJlcy5GZWF0dXJlcyA9IGZ1bmN0aW9uICgpIHt9O1xuICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEZlYXR1cmVzLnByb3RvdHlwZSwgJ3JlZmVyZW5jZUVkZ2UnLCB7XG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgcmV0dXJuIHRoaXMuX3JlZmVyZW5jZUVkZ2U7XG4gICAgICB9XG4gICB9KTtcbiAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGZWF0dXJlcy5wcm90b3R5cGUsICdyZWZlcmVuY2VFZGdlJywge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHZhbHVlID0gMDtcbiAgICAgICAgIHRoaXMuX3JlZmVyZW5jZUVkZ2UgPSB2YWx1ZTtcbiAgICAgICAgIHRoaXMuX21faWQuX2tleSA9ICh0aGlzLl9tX2lkLl9rZXkgJiAweGZmZmZmZjAwKSB8ICh0aGlzLl9yZWZlcmVuY2VFZGdlICYgMHgwMDAwMDBmZik7XG4gICAgICB9XG4gICB9KTtcbiAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGZWF0dXJlcy5wcm90b3R5cGUsICdpbmNpZGVudEVkZ2UnLCB7XG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgcmV0dXJuIHRoaXMuX2luY2lkZW50RWRnZTtcbiAgICAgIH1cbiAgIH0pO1xuICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEZlYXR1cmVzLnByb3RvdHlwZSwgJ2luY2lkZW50RWRnZScsIHtcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB2YWx1ZSA9IDA7XG4gICAgICAgICB0aGlzLl9pbmNpZGVudEVkZ2UgPSB2YWx1ZTtcbiAgICAgICAgIHRoaXMuX21faWQuX2tleSA9ICh0aGlzLl9tX2lkLl9rZXkgJiAweGZmZmYwMGZmKSB8ICgodGhpcy5faW5jaWRlbnRFZGdlIDw8IDgpICYgMHgwMDAwZmYwMCk7XG4gICAgICB9XG4gICB9KTtcbiAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGZWF0dXJlcy5wcm90b3R5cGUsICdpbmNpZGVudFZlcnRleCcsIHtcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICByZXR1cm4gdGhpcy5faW5jaWRlbnRWZXJ0ZXg7XG4gICAgICB9XG4gICB9KTtcbiAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGZWF0dXJlcy5wcm90b3R5cGUsICdpbmNpZGVudFZlcnRleCcsIHtcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB2YWx1ZSA9IDA7XG4gICAgICAgICB0aGlzLl9pbmNpZGVudFZlcnRleCA9IHZhbHVlO1xuICAgICAgICAgdGhpcy5fbV9pZC5fa2V5ID0gKHRoaXMuX21faWQuX2tleSAmIDB4ZmYwMGZmZmYpIHwgKCh0aGlzLl9pbmNpZGVudFZlcnRleCA8PCAxNikgJiAweDAwZmYwMDAwKTtcbiAgICAgIH1cbiAgIH0pO1xuICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEZlYXR1cmVzLnByb3RvdHlwZSwgJ2ZsaXAnLCB7XG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgcmV0dXJuIHRoaXMuX2ZsaXA7XG4gICAgICB9XG4gICB9KTtcbiAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGZWF0dXJlcy5wcm90b3R5cGUsICdmbGlwJywge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHZhbHVlID0gMDtcbiAgICAgICAgIHRoaXMuX2ZsaXAgPSB2YWx1ZTtcbiAgICAgICAgIHRoaXMuX21faWQuX2tleSA9ICh0aGlzLl9tX2lkLl9rZXkgJiAweDAwZmZmZmZmKSB8ICgodGhpcy5fZmxpcCA8PCAyNCkgJiAweGZmMDAwMDAwKTtcbiAgICAgIH1cbiAgIH0pO1xufSkoKTtcbihmdW5jdGlvbiAoKSB7XG4gICB2YXIgYjJDb2xvciA9IEJveDJELkNvbW1vbi5iMkNvbG9yLFxuICAgICAgYjJpbnRlcm5hbCA9IEJveDJELkNvbW1vbi5iMmludGVybmFsLFxuICAgICAgYjJTZXR0aW5ncyA9IEJveDJELkNvbW1vbi5iMlNldHRpbmdzLFxuICAgICAgYjJDaXJjbGVTaGFwZSA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJDaXJjbGVTaGFwZSxcbiAgICAgIGIyRWRnZUNoYWluRGVmID0gQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMkVkZ2VDaGFpbkRlZixcbiAgICAgIGIyRWRnZVNoYXBlID0gQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMkVkZ2VTaGFwZSxcbiAgICAgIGIyTWFzc0RhdGEgPSBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyTWFzc0RhdGEsXG4gICAgICBiMlBvbHlnb25TaGFwZSA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJQb2x5Z29uU2hhcGUsXG4gICAgICBiMlNoYXBlID0gQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMlNoYXBlLFxuICAgICAgYjJNYXQyMiA9IEJveDJELkNvbW1vbi5NYXRoLmIyTWF0MjIsXG4gICAgICBiMk1hdDMzID0gQm94MkQuQ29tbW9uLk1hdGguYjJNYXQzMyxcbiAgICAgIGIyTWF0aCA9IEJveDJELkNvbW1vbi5NYXRoLmIyTWF0aCxcbiAgICAgIGIyU3dlZXAgPSBCb3gyRC5Db21tb24uTWF0aC5iMlN3ZWVwLFxuICAgICAgYjJUcmFuc2Zvcm0gPSBCb3gyRC5Db21tb24uTWF0aC5iMlRyYW5zZm9ybSxcbiAgICAgIGIyVmVjMiA9IEJveDJELkNvbW1vbi5NYXRoLmIyVmVjMixcbiAgICAgIGIyVmVjMyA9IEJveDJELkNvbW1vbi5NYXRoLmIyVmVjMyxcbiAgICAgIGIyQm9keSA9IEJveDJELkR5bmFtaWNzLmIyQm9keSxcbiAgICAgIGIyQm9keURlZiA9IEJveDJELkR5bmFtaWNzLmIyQm9keURlZixcbiAgICAgIGIyQ29udGFjdEZpbHRlciA9IEJveDJELkR5bmFtaWNzLmIyQ29udGFjdEZpbHRlcixcbiAgICAgIGIyQ29udGFjdEltcHVsc2UgPSBCb3gyRC5EeW5hbWljcy5iMkNvbnRhY3RJbXB1bHNlLFxuICAgICAgYjJDb250YWN0TGlzdGVuZXIgPSBCb3gyRC5EeW5hbWljcy5iMkNvbnRhY3RMaXN0ZW5lcixcbiAgICAgIGIyQ29udGFjdE1hbmFnZXIgPSBCb3gyRC5EeW5hbWljcy5iMkNvbnRhY3RNYW5hZ2VyLFxuICAgICAgYjJEZWJ1Z0RyYXcgPSBCb3gyRC5EeW5hbWljcy5iMkRlYnVnRHJhdyxcbiAgICAgIGIyRGVzdHJ1Y3Rpb25MaXN0ZW5lciA9IEJveDJELkR5bmFtaWNzLmIyRGVzdHJ1Y3Rpb25MaXN0ZW5lcixcbiAgICAgIGIyRmlsdGVyRGF0YSA9IEJveDJELkR5bmFtaWNzLmIyRmlsdGVyRGF0YSxcbiAgICAgIGIyRml4dHVyZSA9IEJveDJELkR5bmFtaWNzLmIyRml4dHVyZSxcbiAgICAgIGIyRml4dHVyZURlZiA9IEJveDJELkR5bmFtaWNzLmIyRml4dHVyZURlZixcbiAgICAgIGIySXNsYW5kID0gQm94MkQuRHluYW1pY3MuYjJJc2xhbmQsXG4gICAgICBiMlRpbWVTdGVwID0gQm94MkQuRHluYW1pY3MuYjJUaW1lU3RlcCxcbiAgICAgIGIyV29ybGQgPSBCb3gyRC5EeW5hbWljcy5iMldvcmxkLFxuICAgICAgYjJBQUJCID0gQm94MkQuQ29sbGlzaW9uLmIyQUFCQixcbiAgICAgIGIyQm91bmQgPSBCb3gyRC5Db2xsaXNpb24uYjJCb3VuZCxcbiAgICAgIGIyQm91bmRWYWx1ZXMgPSBCb3gyRC5Db2xsaXNpb24uYjJCb3VuZFZhbHVlcyxcbiAgICAgIGIyQ29sbGlzaW9uID0gQm94MkQuQ29sbGlzaW9uLmIyQ29sbGlzaW9uLFxuICAgICAgYjJDb250YWN0SUQgPSBCb3gyRC5Db2xsaXNpb24uYjJDb250YWN0SUQsXG4gICAgICBiMkNvbnRhY3RQb2ludCA9IEJveDJELkNvbGxpc2lvbi5iMkNvbnRhY3RQb2ludCxcbiAgICAgIGIyRGlzdGFuY2UgPSBCb3gyRC5Db2xsaXNpb24uYjJEaXN0YW5jZSxcbiAgICAgIGIyRGlzdGFuY2VJbnB1dCA9IEJveDJELkNvbGxpc2lvbi5iMkRpc3RhbmNlSW5wdXQsXG4gICAgICBiMkRpc3RhbmNlT3V0cHV0ID0gQm94MkQuQ29sbGlzaW9uLmIyRGlzdGFuY2VPdXRwdXQsXG4gICAgICBiMkRpc3RhbmNlUHJveHkgPSBCb3gyRC5Db2xsaXNpb24uYjJEaXN0YW5jZVByb3h5LFxuICAgICAgYjJEeW5hbWljVHJlZSA9IEJveDJELkNvbGxpc2lvbi5iMkR5bmFtaWNUcmVlLFxuICAgICAgYjJEeW5hbWljVHJlZUJyb2FkUGhhc2UgPSBCb3gyRC5Db2xsaXNpb24uYjJEeW5hbWljVHJlZUJyb2FkUGhhc2UsXG4gICAgICBiMkR5bmFtaWNUcmVlTm9kZSA9IEJveDJELkNvbGxpc2lvbi5iMkR5bmFtaWNUcmVlTm9kZSxcbiAgICAgIGIyRHluYW1pY1RyZWVQYWlyID0gQm94MkQuQ29sbGlzaW9uLmIyRHluYW1pY1RyZWVQYWlyLFxuICAgICAgYjJNYW5pZm9sZCA9IEJveDJELkNvbGxpc2lvbi5iMk1hbmlmb2xkLFxuICAgICAgYjJNYW5pZm9sZFBvaW50ID0gQm94MkQuQ29sbGlzaW9uLmIyTWFuaWZvbGRQb2ludCxcbiAgICAgIGIyUG9pbnQgPSBCb3gyRC5Db2xsaXNpb24uYjJQb2ludCxcbiAgICAgIGIyUmF5Q2FzdElucHV0ID0gQm94MkQuQ29sbGlzaW9uLmIyUmF5Q2FzdElucHV0LFxuICAgICAgYjJSYXlDYXN0T3V0cHV0ID0gQm94MkQuQ29sbGlzaW9uLmIyUmF5Q2FzdE91dHB1dCxcbiAgICAgIGIyU2VnbWVudCA9IEJveDJELkNvbGxpc2lvbi5iMlNlZ21lbnQsXG4gICAgICBiMlNlcGFyYXRpb25GdW5jdGlvbiA9IEJveDJELkNvbGxpc2lvbi5iMlNlcGFyYXRpb25GdW5jdGlvbixcbiAgICAgIGIyU2ltcGxleCA9IEJveDJELkNvbGxpc2lvbi5iMlNpbXBsZXgsXG4gICAgICBiMlNpbXBsZXhDYWNoZSA9IEJveDJELkNvbGxpc2lvbi5iMlNpbXBsZXhDYWNoZSxcbiAgICAgIGIyU2ltcGxleFZlcnRleCA9IEJveDJELkNvbGxpc2lvbi5iMlNpbXBsZXhWZXJ0ZXgsXG4gICAgICBiMlRpbWVPZkltcGFjdCA9IEJveDJELkNvbGxpc2lvbi5iMlRpbWVPZkltcGFjdCxcbiAgICAgIGIyVE9JSW5wdXQgPSBCb3gyRC5Db2xsaXNpb24uYjJUT0lJbnB1dCxcbiAgICAgIGIyV29ybGRNYW5pZm9sZCA9IEJveDJELkNvbGxpc2lvbi5iMldvcmxkTWFuaWZvbGQsXG4gICAgICBDbGlwVmVydGV4ID0gQm94MkQuQ29sbGlzaW9uLkNsaXBWZXJ0ZXgsXG4gICAgICBGZWF0dXJlcyA9IEJveDJELkNvbGxpc2lvbi5GZWF0dXJlcyxcbiAgICAgIElCcm9hZFBoYXNlID0gQm94MkQuQ29sbGlzaW9uLklCcm9hZFBoYXNlO1xuXG4gICBCb3gyRC5pbmhlcml0KGIyQ2lyY2xlU2hhcGUsIEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJTaGFwZSk7XG4gICBiMkNpcmNsZVNoYXBlLnByb3RvdHlwZS5fX3N1cGVyID0gQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMlNoYXBlLnByb3RvdHlwZTtcbiAgIGIyQ2lyY2xlU2hhcGUuYjJDaXJjbGVTaGFwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJTaGFwZS5iMlNoYXBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLm1fcCA9IG5ldyBiMlZlYzIoKTtcbiAgIH07XG4gICBiMkNpcmNsZVNoYXBlLnByb3RvdHlwZS5Db3B5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHMgPSBuZXcgYjJDaXJjbGVTaGFwZSgpO1xuICAgICAgcy5TZXQodGhpcyk7XG4gICAgICByZXR1cm4gcztcbiAgIH1cbiAgIGIyQ2lyY2xlU2hhcGUucHJvdG90eXBlLlNldCA9IGZ1bmN0aW9uIChvdGhlcikge1xuICAgICAgdGhpcy5fX3N1cGVyLlNldC5jYWxsKHRoaXMsIG90aGVyKTtcbiAgICAgIGlmIChCb3gyRC5pcyhvdGhlciwgYjJDaXJjbGVTaGFwZSkpIHtcbiAgICAgICAgIHZhciBvdGhlcjIgPSAob3RoZXIgaW5zdGFuY2VvZiBiMkNpcmNsZVNoYXBlID8gb3RoZXIgOiBudWxsKTtcbiAgICAgICAgIHRoaXMubV9wLlNldFYob3RoZXIyLm1fcCk7XG4gICAgICB9XG4gICB9XG4gICBiMkNpcmNsZVNoYXBlLnByb3RvdHlwZS5UZXN0UG9pbnQgPSBmdW5jdGlvbiAodHJhbnNmb3JtLCBwKSB7XG4gICAgICB2YXIgdE1hdCA9IHRyYW5zZm9ybS5SO1xuICAgICAgdmFyIGRYID0gdHJhbnNmb3JtLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0aGlzLm1fcC54ICsgdE1hdC5jb2wyLnggKiB0aGlzLm1fcC55KTtcbiAgICAgIHZhciBkWSA9IHRyYW5zZm9ybS5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdGhpcy5tX3AueCArIHRNYXQuY29sMi55ICogdGhpcy5tX3AueSk7XG4gICAgICBkWCA9IHAueCAtIGRYO1xuICAgICAgZFkgPSBwLnkgLSBkWTtcbiAgICAgIHJldHVybiAoZFggKiBkWCArIGRZICogZFkpIDw9IHRoaXMubV9yYWRpdXMgKiB0aGlzLm1fcmFkaXVzO1xuICAgfVxuICAgYjJDaXJjbGVTaGFwZS5wcm90b3R5cGUuUmF5Q2FzdCA9IGZ1bmN0aW9uIChvdXRwdXQsIGlucHV0LCB0cmFuc2Zvcm0pIHtcbiAgICAgIHZhciB0TWF0ID0gdHJhbnNmb3JtLlI7XG4gICAgICB2YXIgcG9zaXRpb25YID0gdHJhbnNmb3JtLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0aGlzLm1fcC54ICsgdE1hdC5jb2wyLnggKiB0aGlzLm1fcC55KTtcbiAgICAgIHZhciBwb3NpdGlvblkgPSB0cmFuc2Zvcm0ucG9zaXRpb24ueSArICh0TWF0LmNvbDEueSAqIHRoaXMubV9wLnggKyB0TWF0LmNvbDIueSAqIHRoaXMubV9wLnkpO1xuICAgICAgdmFyIHNYID0gaW5wdXQucDEueCAtIHBvc2l0aW9uWDtcbiAgICAgIHZhciBzWSA9IGlucHV0LnAxLnkgLSBwb3NpdGlvblk7XG4gICAgICB2YXIgYiA9IChzWCAqIHNYICsgc1kgKiBzWSkgLSB0aGlzLm1fcmFkaXVzICogdGhpcy5tX3JhZGl1cztcbiAgICAgIHZhciByWCA9IGlucHV0LnAyLnggLSBpbnB1dC5wMS54O1xuICAgICAgdmFyIHJZID0gaW5wdXQucDIueSAtIGlucHV0LnAxLnk7XG4gICAgICB2YXIgYyA9IChzWCAqIHJYICsgc1kgKiByWSk7XG4gICAgICB2YXIgcnIgPSAoclggKiByWCArIHJZICogclkpO1xuICAgICAgdmFyIHNpZ21hID0gYyAqIGMgLSByciAqIGI7XG4gICAgICBpZiAoc2lnbWEgPCAwLjAgfHwgcnIgPCBOdW1iZXIuTUlOX1ZBTFVFKSB7XG4gICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICB2YXIgYSA9ICgtKGMgKyBNYXRoLnNxcnQoc2lnbWEpKSk7XG4gICAgICBpZiAoMC4wIDw9IGEgJiYgYSA8PSBpbnB1dC5tYXhGcmFjdGlvbiAqIHJyKSB7XG4gICAgICAgICBhIC89IHJyO1xuICAgICAgICAgb3V0cHV0LmZyYWN0aW9uID0gYTtcbiAgICAgICAgIG91dHB1dC5ub3JtYWwueCA9IHNYICsgYSAqIHJYO1xuICAgICAgICAgb3V0cHV0Lm5vcm1hbC55ID0gc1kgKyBhICogclk7XG4gICAgICAgICBvdXRwdXQubm9ybWFsLk5vcm1hbGl6ZSgpO1xuICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICB9XG4gICBiMkNpcmNsZVNoYXBlLnByb3RvdHlwZS5Db21wdXRlQUFCQiA9IGZ1bmN0aW9uIChhYWJiLCB0cmFuc2Zvcm0pIHtcbiAgICAgIHZhciB0TWF0ID0gdHJhbnNmb3JtLlI7XG4gICAgICB2YXIgcFggPSB0cmFuc2Zvcm0ucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRoaXMubV9wLnggKyB0TWF0LmNvbDIueCAqIHRoaXMubV9wLnkpO1xuICAgICAgdmFyIHBZID0gdHJhbnNmb3JtLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiB0aGlzLm1fcC54ICsgdE1hdC5jb2wyLnkgKiB0aGlzLm1fcC55KTtcbiAgICAgIGFhYmIubG93ZXJCb3VuZC5TZXQocFggLSB0aGlzLm1fcmFkaXVzLCBwWSAtIHRoaXMubV9yYWRpdXMpO1xuICAgICAgYWFiYi51cHBlckJvdW5kLlNldChwWCArIHRoaXMubV9yYWRpdXMsIHBZICsgdGhpcy5tX3JhZGl1cyk7XG4gICB9XG4gICBiMkNpcmNsZVNoYXBlLnByb3RvdHlwZS5Db21wdXRlTWFzcyA9IGZ1bmN0aW9uIChtYXNzRGF0YSwgZGVuc2l0eSkge1xuICAgICAgaWYgKGRlbnNpdHkgPT09IHVuZGVmaW5lZCkgZGVuc2l0eSA9IDA7XG4gICAgICBtYXNzRGF0YS5tYXNzID0gZGVuc2l0eSAqIGIyU2V0dGluZ3MuYjJfcGkgKiB0aGlzLm1fcmFkaXVzICogdGhpcy5tX3JhZGl1cztcbiAgICAgIG1hc3NEYXRhLmNlbnRlci5TZXRWKHRoaXMubV9wKTtcbiAgICAgIG1hc3NEYXRhLkkgPSBtYXNzRGF0YS5tYXNzICogKDAuNSAqIHRoaXMubV9yYWRpdXMgKiB0aGlzLm1fcmFkaXVzICsgKHRoaXMubV9wLnggKiB0aGlzLm1fcC54ICsgdGhpcy5tX3AueSAqIHRoaXMubV9wLnkpKTtcbiAgIH1cbiAgIGIyQ2lyY2xlU2hhcGUucHJvdG90eXBlLkNvbXB1dGVTdWJtZXJnZWRBcmVhID0gZnVuY3Rpb24gKG5vcm1hbCwgb2Zmc2V0LCB4ZiwgYykge1xuICAgICAgaWYgKG9mZnNldCA9PT0gdW5kZWZpbmVkKSBvZmZzZXQgPSAwO1xuICAgICAgdmFyIHAgPSBiMk1hdGguTXVsWCh4ZiwgdGhpcy5tX3ApO1xuICAgICAgdmFyIGwgPSAoLShiMk1hdGguRG90KG5vcm1hbCwgcCkgLSBvZmZzZXQpKTtcbiAgICAgIGlmIChsIDwgKC10aGlzLm1fcmFkaXVzKSArIE51bWJlci5NSU5fVkFMVUUpIHtcbiAgICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgaWYgKGwgPiB0aGlzLm1fcmFkaXVzKSB7XG4gICAgICAgICBjLlNldFYocCk7XG4gICAgICAgICByZXR1cm4gTWF0aC5QSSAqIHRoaXMubV9yYWRpdXMgKiB0aGlzLm1fcmFkaXVzO1xuICAgICAgfVxuICAgICAgdmFyIHIyID0gdGhpcy5tX3JhZGl1cyAqIHRoaXMubV9yYWRpdXM7XG4gICAgICB2YXIgbDIgPSBsICogbDtcbiAgICAgIHZhciBhcmVhID0gcjIgKiAoTWF0aC5hc2luKGwgLyB0aGlzLm1fcmFkaXVzKSArIE1hdGguUEkgLyAyKSArIGwgKiBNYXRoLnNxcnQocjIgLSBsMik7XG4gICAgICB2YXIgY29tID0gKC0yIC8gMyAqIE1hdGgucG93KHIyIC0gbDIsIDEuNSkgLyBhcmVhKTtcbiAgICAgIGMueCA9IHAueCArIG5vcm1hbC54ICogY29tO1xuICAgICAgYy55ID0gcC55ICsgbm9ybWFsLnkgKiBjb207XG4gICAgICByZXR1cm4gYXJlYTtcbiAgIH1cbiAgIGIyQ2lyY2xlU2hhcGUucHJvdG90eXBlLkdldExvY2FsUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3A7XG4gICB9XG4gICBiMkNpcmNsZVNoYXBlLnByb3RvdHlwZS5TZXRMb2NhbFBvc2l0aW9uID0gZnVuY3Rpb24gKHBvc2l0aW9uKSB7XG4gICAgICB0aGlzLm1fcC5TZXRWKHBvc2l0aW9uKTtcbiAgIH1cbiAgIGIyQ2lyY2xlU2hhcGUucHJvdG90eXBlLkdldFJhZGl1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fcmFkaXVzO1xuICAgfVxuICAgYjJDaXJjbGVTaGFwZS5wcm90b3R5cGUuU2V0UmFkaXVzID0gZnVuY3Rpb24gKHJhZGl1cykge1xuICAgICAgaWYgKHJhZGl1cyA9PT0gdW5kZWZpbmVkKSByYWRpdXMgPSAwO1xuICAgICAgdGhpcy5tX3JhZGl1cyA9IHJhZGl1cztcbiAgIH1cbiAgIGIyQ2lyY2xlU2hhcGUucHJvdG90eXBlLmIyQ2lyY2xlU2hhcGUgPSBmdW5jdGlvbiAocmFkaXVzKSB7XG4gICAgICBpZiAocmFkaXVzID09PSB1bmRlZmluZWQpIHJhZGl1cyA9IDA7XG4gICAgICB0aGlzLl9fc3VwZXIuYjJTaGFwZS5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy5tX3R5cGUgPSBiMlNoYXBlLmVfY2lyY2xlU2hhcGU7XG4gICAgICB0aGlzLm1fcmFkaXVzID0gcmFkaXVzO1xuICAgfVxuICAgYjJFZGdlQ2hhaW5EZWYuYjJFZGdlQ2hhaW5EZWYgPSBmdW5jdGlvbiAoKSB7fTtcbiAgIGIyRWRnZUNoYWluRGVmLnByb3RvdHlwZS5iMkVkZ2VDaGFpbkRlZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMudmVydGV4Q291bnQgPSAwO1xuICAgICAgdGhpcy5pc0FMb29wID0gdHJ1ZTtcbiAgICAgIHRoaXMudmVydGljZXMgPSBbXTtcbiAgIH1cbiAgIEJveDJELmluaGVyaXQoYjJFZGdlU2hhcGUsIEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJTaGFwZSk7XG4gICBiMkVkZ2VTaGFwZS5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJTaGFwZS5wcm90b3R5cGU7XG4gICBiMkVkZ2VTaGFwZS5iMkVkZ2VTaGFwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJTaGFwZS5iMlNoYXBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLnNfc3VwcG9ydFZlYyA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV92MSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV92MiA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9jb3JlVjEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fY29yZVYyID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX25vcm1hbCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9kaXJlY3Rpb24gPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fY29ybmVyRGlyMSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9jb3JuZXJEaXIyID0gbmV3IGIyVmVjMigpO1xuICAgfTtcbiAgIGIyRWRnZVNoYXBlLnByb3RvdHlwZS5UZXN0UG9pbnQgPSBmdW5jdGlvbiAodHJhbnNmb3JtLCBwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICB9XG4gICBiMkVkZ2VTaGFwZS5wcm90b3R5cGUuUmF5Q2FzdCA9IGZ1bmN0aW9uIChvdXRwdXQsIGlucHV0LCB0cmFuc2Zvcm0pIHtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIHJYID0gaW5wdXQucDIueCAtIGlucHV0LnAxLng7XG4gICAgICB2YXIgclkgPSBpbnB1dC5wMi55IC0gaW5wdXQucDEueTtcbiAgICAgIHRNYXQgPSB0cmFuc2Zvcm0uUjtcbiAgICAgIHZhciB2MVggPSB0cmFuc2Zvcm0ucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRoaXMubV92MS54ICsgdE1hdC5jb2wyLnggKiB0aGlzLm1fdjEueSk7XG4gICAgICB2YXIgdjFZID0gdHJhbnNmb3JtLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiB0aGlzLm1fdjEueCArIHRNYXQuY29sMi55ICogdGhpcy5tX3YxLnkpO1xuICAgICAgdmFyIG5YID0gdHJhbnNmb3JtLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiB0aGlzLm1fdjIueCArIHRNYXQuY29sMi55ICogdGhpcy5tX3YyLnkpIC0gdjFZO1xuICAgICAgdmFyIG5ZID0gKC0odHJhbnNmb3JtLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0aGlzLm1fdjIueCArIHRNYXQuY29sMi54ICogdGhpcy5tX3YyLnkpIC0gdjFYKSk7XG4gICAgICB2YXIga19zbG9wID0gMTAwLjAgKiBOdW1iZXIuTUlOX1ZBTFVFO1xuICAgICAgdmFyIGRlbm9tID0gKC0oclggKiBuWCArIHJZICogblkpKTtcbiAgICAgIGlmIChkZW5vbSA+IGtfc2xvcCkge1xuICAgICAgICAgdmFyIGJYID0gaW5wdXQucDEueCAtIHYxWDtcbiAgICAgICAgIHZhciBiWSA9IGlucHV0LnAxLnkgLSB2MVk7XG4gICAgICAgICB2YXIgYSA9IChiWCAqIG5YICsgYlkgKiBuWSk7XG4gICAgICAgICBpZiAoMC4wIDw9IGEgJiYgYSA8PSBpbnB1dC5tYXhGcmFjdGlvbiAqIGRlbm9tKSB7XG4gICAgICAgICAgICB2YXIgbXUyID0gKC1yWCAqIGJZKSArIHJZICogYlg7XG4gICAgICAgICAgICBpZiAoKC1rX3Nsb3AgKiBkZW5vbSkgPD0gbXUyICYmIG11MiA8PSBkZW5vbSAqICgxLjAgKyBrX3Nsb3ApKSB7XG4gICAgICAgICAgICAgICBhIC89IGRlbm9tO1xuICAgICAgICAgICAgICAgb3V0cHV0LmZyYWN0aW9uID0gYTtcbiAgICAgICAgICAgICAgIHZhciBuTGVuID0gTWF0aC5zcXJ0KG5YICogblggKyBuWSAqIG5ZKTtcbiAgICAgICAgICAgICAgIG91dHB1dC5ub3JtYWwueCA9IG5YIC8gbkxlbjtcbiAgICAgICAgICAgICAgIG91dHB1dC5ub3JtYWwueSA9IG5ZIC8gbkxlbjtcbiAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgfVxuICAgYjJFZGdlU2hhcGUucHJvdG90eXBlLkNvbXB1dGVBQUJCID0gZnVuY3Rpb24gKGFhYmIsIHRyYW5zZm9ybSkge1xuICAgICAgdmFyIHRNYXQgPSB0cmFuc2Zvcm0uUjtcbiAgICAgIHZhciB2MVggPSB0cmFuc2Zvcm0ucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRoaXMubV92MS54ICsgdE1hdC5jb2wyLnggKiB0aGlzLm1fdjEueSk7XG4gICAgICB2YXIgdjFZID0gdHJhbnNmb3JtLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiB0aGlzLm1fdjEueCArIHRNYXQuY29sMi55ICogdGhpcy5tX3YxLnkpO1xuICAgICAgdmFyIHYyWCA9IHRyYW5zZm9ybS5wb3NpdGlvbi54ICsgKHRNYXQuY29sMS54ICogdGhpcy5tX3YyLnggKyB0TWF0LmNvbDIueCAqIHRoaXMubV92Mi55KTtcbiAgICAgIHZhciB2MlkgPSB0cmFuc2Zvcm0ucG9zaXRpb24ueSArICh0TWF0LmNvbDEueSAqIHRoaXMubV92Mi54ICsgdE1hdC5jb2wyLnkgKiB0aGlzLm1fdjIueSk7XG4gICAgICBpZiAodjFYIDwgdjJYKSB7XG4gICAgICAgICBhYWJiLmxvd2VyQm91bmQueCA9IHYxWDtcbiAgICAgICAgIGFhYmIudXBwZXJCb3VuZC54ID0gdjJYO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICBhYWJiLmxvd2VyQm91bmQueCA9IHYyWDtcbiAgICAgICAgIGFhYmIudXBwZXJCb3VuZC54ID0gdjFYO1xuICAgICAgfVxuICAgICAgaWYgKHYxWSA8IHYyWSkge1xuICAgICAgICAgYWFiYi5sb3dlckJvdW5kLnkgPSB2MVk7XG4gICAgICAgICBhYWJiLnVwcGVyQm91bmQueSA9IHYyWTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgYWFiYi5sb3dlckJvdW5kLnkgPSB2Mlk7XG4gICAgICAgICBhYWJiLnVwcGVyQm91bmQueSA9IHYxWTtcbiAgICAgIH1cbiAgIH1cbiAgIGIyRWRnZVNoYXBlLnByb3RvdHlwZS5Db21wdXRlTWFzcyA9IGZ1bmN0aW9uIChtYXNzRGF0YSwgZGVuc2l0eSkge1xuICAgICAgaWYgKGRlbnNpdHkgPT09IHVuZGVmaW5lZCkgZGVuc2l0eSA9IDA7XG4gICAgICBtYXNzRGF0YS5tYXNzID0gMDtcbiAgICAgIG1hc3NEYXRhLmNlbnRlci5TZXRWKHRoaXMubV92MSk7XG4gICAgICBtYXNzRGF0YS5JID0gMDtcbiAgIH1cbiAgIGIyRWRnZVNoYXBlLnByb3RvdHlwZS5Db21wdXRlU3VibWVyZ2VkQXJlYSA9IGZ1bmN0aW9uIChub3JtYWwsIG9mZnNldCwgeGYsIGMpIHtcbiAgICAgIGlmIChvZmZzZXQgPT09IHVuZGVmaW5lZCkgb2Zmc2V0ID0gMDtcbiAgICAgIHZhciB2MCA9IG5ldyBiMlZlYzIobm9ybWFsLnggKiBvZmZzZXQsIG5vcm1hbC55ICogb2Zmc2V0KTtcbiAgICAgIHZhciB2MSA9IGIyTWF0aC5NdWxYKHhmLCB0aGlzLm1fdjEpO1xuICAgICAgdmFyIHYyID0gYjJNYXRoLk11bFgoeGYsIHRoaXMubV92Mik7XG4gICAgICB2YXIgZDEgPSBiMk1hdGguRG90KG5vcm1hbCwgdjEpIC0gb2Zmc2V0O1xuICAgICAgdmFyIGQyID0gYjJNYXRoLkRvdChub3JtYWwsIHYyKSAtIG9mZnNldDtcbiAgICAgIGlmIChkMSA+IDApIHtcbiAgICAgICAgIGlmIChkMiA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2MS54ID0gKC1kMiAvIChkMSAtIGQyKSAqIHYxLngpICsgZDEgLyAoZDEgLSBkMikgKiB2Mi54O1xuICAgICAgICAgICAgdjEueSA9ICgtZDIgLyAoZDEgLSBkMikgKiB2MS55KSArIGQxIC8gKGQxIC0gZDIpICogdjIueTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgaWYgKGQyID4gMCkge1xuICAgICAgICAgICAgdjIueCA9ICgtZDIgLyAoZDEgLSBkMikgKiB2MS54KSArIGQxIC8gKGQxIC0gZDIpICogdjIueDtcbiAgICAgICAgICAgIHYyLnkgPSAoLWQyIC8gKGQxIC0gZDIpICogdjEueSkgKyBkMSAvIChkMSAtIGQyKSAqIHYyLnk7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHt9XG4gICAgICB9XG4gICAgICBjLnggPSAodjAueCArIHYxLnggKyB2Mi54KSAvIDM7XG4gICAgICBjLnkgPSAodjAueSArIHYxLnkgKyB2Mi55KSAvIDM7XG4gICAgICByZXR1cm4gMC41ICogKCh2MS54IC0gdjAueCkgKiAodjIueSAtIHYwLnkpIC0gKHYxLnkgLSB2MC55KSAqICh2Mi54IC0gdjAueCkpO1xuICAgfVxuICAgYjJFZGdlU2hhcGUucHJvdG90eXBlLkdldExlbmd0aCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fbGVuZ3RoO1xuICAgfVxuICAgYjJFZGdlU2hhcGUucHJvdG90eXBlLkdldFZlcnRleDEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3YxO1xuICAgfVxuICAgYjJFZGdlU2hhcGUucHJvdG90eXBlLkdldFZlcnRleDIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3YyO1xuICAgfVxuICAgYjJFZGdlU2hhcGUucHJvdG90eXBlLkdldENvcmVWZXJ0ZXgxID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9jb3JlVjE7XG4gICB9XG4gICBiMkVkZ2VTaGFwZS5wcm90b3R5cGUuR2V0Q29yZVZlcnRleDIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2NvcmVWMjtcbiAgIH1cbiAgIGIyRWRnZVNoYXBlLnByb3RvdHlwZS5HZXROb3JtYWxWZWN0b3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX25vcm1hbDtcbiAgIH1cbiAgIGIyRWRnZVNoYXBlLnByb3RvdHlwZS5HZXREaXJlY3Rpb25WZWN0b3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2RpcmVjdGlvbjtcbiAgIH1cbiAgIGIyRWRnZVNoYXBlLnByb3RvdHlwZS5HZXRDb3JuZXIxVmVjdG9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9jb3JuZXJEaXIxO1xuICAgfVxuICAgYjJFZGdlU2hhcGUucHJvdG90eXBlLkdldENvcm5lcjJWZWN0b3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2Nvcm5lckRpcjI7XG4gICB9XG4gICBiMkVkZ2VTaGFwZS5wcm90b3R5cGUuQ29ybmVyMUlzQ29udmV4ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9jb3JuZXJDb252ZXgxO1xuICAgfVxuICAgYjJFZGdlU2hhcGUucHJvdG90eXBlLkNvcm5lcjJJc0NvbnZleCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fY29ybmVyQ29udmV4MjtcbiAgIH1cbiAgIGIyRWRnZVNoYXBlLnByb3RvdHlwZS5HZXRGaXJzdFZlcnRleCA9IGZ1bmN0aW9uICh4Zikge1xuICAgICAgdmFyIHRNYXQgPSB4Zi5SO1xuICAgICAgcmV0dXJuIG5ldyBiMlZlYzIoeGYucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRoaXMubV9jb3JlVjEueCArIHRNYXQuY29sMi54ICogdGhpcy5tX2NvcmVWMS55KSwgeGYucG9zaXRpb24ueSArICh0TWF0LmNvbDEueSAqIHRoaXMubV9jb3JlVjEueCArIHRNYXQuY29sMi55ICogdGhpcy5tX2NvcmVWMS55KSk7XG4gICB9XG4gICBiMkVkZ2VTaGFwZS5wcm90b3R5cGUuR2V0TmV4dEVkZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX25leHRFZGdlO1xuICAgfVxuICAgYjJFZGdlU2hhcGUucHJvdG90eXBlLkdldFByZXZFZGdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9wcmV2RWRnZTtcbiAgIH1cbiAgIGIyRWRnZVNoYXBlLnByb3RvdHlwZS5TdXBwb3J0ID0gZnVuY3Rpb24gKHhmLCBkWCwgZFkpIHtcbiAgICAgIGlmIChkWCA9PT0gdW5kZWZpbmVkKSBkWCA9IDA7XG4gICAgICBpZiAoZFkgPT09IHVuZGVmaW5lZCkgZFkgPSAwO1xuICAgICAgdmFyIHRNYXQgPSB4Zi5SO1xuICAgICAgdmFyIHYxWCA9IHhmLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0aGlzLm1fY29yZVYxLnggKyB0TWF0LmNvbDIueCAqIHRoaXMubV9jb3JlVjEueSk7XG4gICAgICB2YXIgdjFZID0geGYucG9zaXRpb24ueSArICh0TWF0LmNvbDEueSAqIHRoaXMubV9jb3JlVjEueCArIHRNYXQuY29sMi55ICogdGhpcy5tX2NvcmVWMS55KTtcbiAgICAgIHZhciB2MlggPSB4Zi5wb3NpdGlvbi54ICsgKHRNYXQuY29sMS54ICogdGhpcy5tX2NvcmVWMi54ICsgdE1hdC5jb2wyLnggKiB0aGlzLm1fY29yZVYyLnkpO1xuICAgICAgdmFyIHYyWSA9IHhmLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiB0aGlzLm1fY29yZVYyLnggKyB0TWF0LmNvbDIueSAqIHRoaXMubV9jb3JlVjIueSk7XG4gICAgICBpZiAoKHYxWCAqIGRYICsgdjFZICogZFkpID4gKHYyWCAqIGRYICsgdjJZICogZFkpKSB7XG4gICAgICAgICB0aGlzLnNfc3VwcG9ydFZlYy54ID0gdjFYO1xuICAgICAgICAgdGhpcy5zX3N1cHBvcnRWZWMueSA9IHYxWTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdGhpcy5zX3N1cHBvcnRWZWMueCA9IHYyWDtcbiAgICAgICAgIHRoaXMuc19zdXBwb3J0VmVjLnkgPSB2Mlk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5zX3N1cHBvcnRWZWM7XG4gICB9XG4gICBiMkVkZ2VTaGFwZS5wcm90b3R5cGUuYjJFZGdlU2hhcGUgPSBmdW5jdGlvbiAodjEsIHYyKSB7XG4gICAgICB0aGlzLl9fc3VwZXIuYjJTaGFwZS5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy5tX3R5cGUgPSBiMlNoYXBlLmVfZWRnZVNoYXBlO1xuICAgICAgdGhpcy5tX3ByZXZFZGdlID0gbnVsbDtcbiAgICAgIHRoaXMubV9uZXh0RWRnZSA9IG51bGw7XG4gICAgICB0aGlzLm1fdjEgPSB2MTtcbiAgICAgIHRoaXMubV92MiA9IHYyO1xuICAgICAgdGhpcy5tX2RpcmVjdGlvbi5TZXQodGhpcy5tX3YyLnggLSB0aGlzLm1fdjEueCwgdGhpcy5tX3YyLnkgLSB0aGlzLm1fdjEueSk7XG4gICAgICB0aGlzLm1fbGVuZ3RoID0gdGhpcy5tX2RpcmVjdGlvbi5Ob3JtYWxpemUoKTtcbiAgICAgIHRoaXMubV9ub3JtYWwuU2V0KHRoaXMubV9kaXJlY3Rpb24ueSwgKC10aGlzLm1fZGlyZWN0aW9uLngpKTtcbiAgICAgIHRoaXMubV9jb3JlVjEuU2V0KCgtYjJTZXR0aW5ncy5iMl90b2lTbG9wICogKHRoaXMubV9ub3JtYWwueCAtIHRoaXMubV9kaXJlY3Rpb24ueCkpICsgdGhpcy5tX3YxLngsICgtYjJTZXR0aW5ncy5iMl90b2lTbG9wICogKHRoaXMubV9ub3JtYWwueSAtIHRoaXMubV9kaXJlY3Rpb24ueSkpICsgdGhpcy5tX3YxLnkpO1xuICAgICAgdGhpcy5tX2NvcmVWMi5TZXQoKC1iMlNldHRpbmdzLmIyX3RvaVNsb3AgKiAodGhpcy5tX25vcm1hbC54ICsgdGhpcy5tX2RpcmVjdGlvbi54KSkgKyB0aGlzLm1fdjIueCwgKC1iMlNldHRpbmdzLmIyX3RvaVNsb3AgKiAodGhpcy5tX25vcm1hbC55ICsgdGhpcy5tX2RpcmVjdGlvbi55KSkgKyB0aGlzLm1fdjIueSk7XG4gICAgICB0aGlzLm1fY29ybmVyRGlyMSA9IHRoaXMubV9ub3JtYWw7XG4gICAgICB0aGlzLm1fY29ybmVyRGlyMi5TZXQoKC10aGlzLm1fbm9ybWFsLngpLCAoLXRoaXMubV9ub3JtYWwueSkpO1xuICAgfVxuICAgYjJFZGdlU2hhcGUucHJvdG90eXBlLlNldFByZXZFZGdlID0gZnVuY3Rpb24gKGVkZ2UsIGNvcmUsIGNvcm5lckRpciwgY29udmV4KSB7XG4gICAgICB0aGlzLm1fcHJldkVkZ2UgPSBlZGdlO1xuICAgICAgdGhpcy5tX2NvcmVWMSA9IGNvcmU7XG4gICAgICB0aGlzLm1fY29ybmVyRGlyMSA9IGNvcm5lckRpcjtcbiAgICAgIHRoaXMubV9jb3JuZXJDb252ZXgxID0gY29udmV4O1xuICAgfVxuICAgYjJFZGdlU2hhcGUucHJvdG90eXBlLlNldE5leHRFZGdlID0gZnVuY3Rpb24gKGVkZ2UsIGNvcmUsIGNvcm5lckRpciwgY29udmV4KSB7XG4gICAgICB0aGlzLm1fbmV4dEVkZ2UgPSBlZGdlO1xuICAgICAgdGhpcy5tX2NvcmVWMiA9IGNvcmU7XG4gICAgICB0aGlzLm1fY29ybmVyRGlyMiA9IGNvcm5lckRpcjtcbiAgICAgIHRoaXMubV9jb3JuZXJDb252ZXgyID0gY29udmV4O1xuICAgfVxuICAgYjJNYXNzRGF0YS5iMk1hc3NEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tYXNzID0gMC4wO1xuICAgICAgdGhpcy5jZW50ZXIgPSBuZXcgYjJWZWMyKDAsIDApO1xuICAgICAgdGhpcy5JID0gMC4wO1xuICAgfTtcbiAgIEJveDJELmluaGVyaXQoYjJQb2x5Z29uU2hhcGUsIEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJTaGFwZSk7XG4gICBiMlBvbHlnb25TaGFwZS5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJTaGFwZS5wcm90b3R5cGU7XG4gICBiMlBvbHlnb25TaGFwZS5iMlBvbHlnb25TaGFwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJTaGFwZS5iMlNoYXBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgYjJQb2x5Z29uU2hhcGUucHJvdG90eXBlLkNvcHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcyA9IG5ldyBiMlBvbHlnb25TaGFwZSgpO1xuICAgICAgcy5TZXQodGhpcyk7XG4gICAgICByZXR1cm4gcztcbiAgIH1cbiAgIGIyUG9seWdvblNoYXBlLnByb3RvdHlwZS5TZXQgPSBmdW5jdGlvbiAob3RoZXIpIHtcbiAgICAgIHRoaXMuX19zdXBlci5TZXQuY2FsbCh0aGlzLCBvdGhlcik7XG4gICAgICBpZiAoQm94MkQuaXMob3RoZXIsIGIyUG9seWdvblNoYXBlKSkge1xuICAgICAgICAgdmFyIG90aGVyMiA9IChvdGhlciBpbnN0YW5jZW9mIGIyUG9seWdvblNoYXBlID8gb3RoZXIgOiBudWxsKTtcbiAgICAgICAgIHRoaXMubV9jZW50cm9pZC5TZXRWKG90aGVyMi5tX2NlbnRyb2lkKTtcbiAgICAgICAgIHRoaXMubV92ZXJ0ZXhDb3VudCA9IG90aGVyMi5tX3ZlcnRleENvdW50O1xuICAgICAgICAgdGhpcy5SZXNlcnZlKHRoaXMubV92ZXJ0ZXhDb3VudCk7XG4gICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubV92ZXJ0ZXhDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLm1fdmVydGljZXNbaV0uU2V0VihvdGhlcjIubV92ZXJ0aWNlc1tpXSk7XG4gICAgICAgICAgICB0aGlzLm1fbm9ybWFsc1tpXS5TZXRWKG90aGVyMi5tX25vcm1hbHNbaV0pO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgfVxuICAgYjJQb2x5Z29uU2hhcGUucHJvdG90eXBlLlNldEFzQXJyYXkgPSBmdW5jdGlvbiAodmVydGljZXMsIHZlcnRleENvdW50KSB7XG4gICAgICBpZiAodmVydGV4Q291bnQgPT09IHVuZGVmaW5lZCkgdmVydGV4Q291bnQgPSAwO1xuICAgICAgdmFyIHYgPSBuZXcgVmVjdG9yKCk7XG4gICAgICB2YXIgaSA9IDAsXG4gICAgICAgICB0VmVjO1xuICAgICAgZm9yIChpID0gMDtcbiAgICAgIGkgPCB2ZXJ0aWNlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgdFZlYyA9IHZlcnRpY2VzW2ldO1xuICAgICAgICAgdi5wdXNoKHRWZWMpO1xuICAgICAgfVxuICAgICAgdGhpcy5TZXRBc1ZlY3Rvcih2LCB2ZXJ0ZXhDb3VudCk7XG4gICB9XG4gICBiMlBvbHlnb25TaGFwZS5Bc0FycmF5ID0gZnVuY3Rpb24gKHZlcnRpY2VzLCB2ZXJ0ZXhDb3VudCkge1xuICAgICAgaWYgKHZlcnRleENvdW50ID09PSB1bmRlZmluZWQpIHZlcnRleENvdW50ID0gMDtcbiAgICAgIHZhciBwb2x5Z29uU2hhcGUgPSBuZXcgYjJQb2x5Z29uU2hhcGUoKTtcbiAgICAgIHBvbHlnb25TaGFwZS5TZXRBc0FycmF5KHZlcnRpY2VzLCB2ZXJ0ZXhDb3VudCk7XG4gICAgICByZXR1cm4gcG9seWdvblNoYXBlO1xuICAgfVxuICAgYjJQb2x5Z29uU2hhcGUucHJvdG90eXBlLlNldEFzVmVjdG9yID0gZnVuY3Rpb24gKHZlcnRpY2VzLCB2ZXJ0ZXhDb3VudCkge1xuICAgICAgaWYgKHZlcnRleENvdW50ID09PSB1bmRlZmluZWQpIHZlcnRleENvdW50ID0gMDtcbiAgICAgIGlmICh2ZXJ0ZXhDb3VudCA9PSAwKSB2ZXJ0ZXhDb3VudCA9IHZlcnRpY2VzLmxlbmd0aDtcbiAgICAgIGIyU2V0dGluZ3MuYjJBc3NlcnQoMiA8PSB2ZXJ0ZXhDb3VudCk7XG4gICAgICB0aGlzLm1fdmVydGV4Q291bnQgPSB2ZXJ0ZXhDb3VudDtcbiAgICAgIHRoaXMuUmVzZXJ2ZSh2ZXJ0ZXhDb3VudCk7XG4gICAgICB2YXIgaSA9IDA7XG4gICAgICBmb3IgKGkgPSAwO1xuICAgICAgaSA8IHRoaXMubV92ZXJ0ZXhDb3VudDsgaSsrKSB7XG4gICAgICAgICB0aGlzLm1fdmVydGljZXNbaV0uU2V0Vih2ZXJ0aWNlc1tpXSk7XG4gICAgICB9XG4gICAgICBmb3IgKGkgPSAwO1xuICAgICAgaSA8IHRoaXMubV92ZXJ0ZXhDb3VudDsgKytpKSB7XG4gICAgICAgICB2YXIgaTEgPSBwYXJzZUludChpKTtcbiAgICAgICAgIHZhciBpMiA9IHBhcnNlSW50KGkgKyAxIDwgdGhpcy5tX3ZlcnRleENvdW50ID8gaSArIDEgOiAwKTtcbiAgICAgICAgIHZhciBlZGdlID0gYjJNYXRoLlN1YnRyYWN0VlYodGhpcy5tX3ZlcnRpY2VzW2kyXSwgdGhpcy5tX3ZlcnRpY2VzW2kxXSk7XG4gICAgICAgICBiMlNldHRpbmdzLmIyQXNzZXJ0KGVkZ2UuTGVuZ3RoU3F1YXJlZCgpID4gTnVtYmVyLk1JTl9WQUxVRSk7XG4gICAgICAgICB0aGlzLm1fbm9ybWFsc1tpXS5TZXRWKGIyTWF0aC5Dcm9zc1ZGKGVkZ2UsIDEuMCkpO1xuICAgICAgICAgdGhpcy5tX25vcm1hbHNbaV0uTm9ybWFsaXplKCk7XG4gICAgICB9XG4gICAgICB0aGlzLm1fY2VudHJvaWQgPSBiMlBvbHlnb25TaGFwZS5Db21wdXRlQ2VudHJvaWQodGhpcy5tX3ZlcnRpY2VzLCB0aGlzLm1fdmVydGV4Q291bnQpO1xuICAgfVxuICAgYjJQb2x5Z29uU2hhcGUuQXNWZWN0b3IgPSBmdW5jdGlvbiAodmVydGljZXMsIHZlcnRleENvdW50KSB7XG4gICAgICBpZiAodmVydGV4Q291bnQgPT09IHVuZGVmaW5lZCkgdmVydGV4Q291bnQgPSAwO1xuICAgICAgdmFyIHBvbHlnb25TaGFwZSA9IG5ldyBiMlBvbHlnb25TaGFwZSgpO1xuICAgICAgcG9seWdvblNoYXBlLlNldEFzVmVjdG9yKHZlcnRpY2VzLCB2ZXJ0ZXhDb3VudCk7XG4gICAgICByZXR1cm4gcG9seWdvblNoYXBlO1xuICAgfVxuICAgYjJQb2x5Z29uU2hhcGUucHJvdG90eXBlLlNldEFzQm94ID0gZnVuY3Rpb24gKGh4LCBoeSkge1xuICAgICAgaWYgKGh4ID09PSB1bmRlZmluZWQpIGh4ID0gMDtcbiAgICAgIGlmIChoeSA9PT0gdW5kZWZpbmVkKSBoeSA9IDA7XG4gICAgICB0aGlzLm1fdmVydGV4Q291bnQgPSA0O1xuICAgICAgdGhpcy5SZXNlcnZlKDQpO1xuICAgICAgdGhpcy5tX3ZlcnRpY2VzWzBdLlNldCgoLWh4KSwgKC1oeSkpO1xuICAgICAgdGhpcy5tX3ZlcnRpY2VzWzFdLlNldChoeCwgKC1oeSkpO1xuICAgICAgdGhpcy5tX3ZlcnRpY2VzWzJdLlNldChoeCwgaHkpO1xuICAgICAgdGhpcy5tX3ZlcnRpY2VzWzNdLlNldCgoLWh4KSwgaHkpO1xuICAgICAgdGhpcy5tX25vcm1hbHNbMF0uU2V0KDAuMCwgKC0xLjApKTtcbiAgICAgIHRoaXMubV9ub3JtYWxzWzFdLlNldCgxLjAsIDAuMCk7XG4gICAgICB0aGlzLm1fbm9ybWFsc1syXS5TZXQoMC4wLCAxLjApO1xuICAgICAgdGhpcy5tX25vcm1hbHNbM10uU2V0KCgtMS4wKSwgMC4wKTtcbiAgICAgIHRoaXMubV9jZW50cm9pZC5TZXRaZXJvKCk7XG4gICB9XG4gICBiMlBvbHlnb25TaGFwZS5Bc0JveCA9IGZ1bmN0aW9uIChoeCwgaHkpIHtcbiAgICAgIGlmIChoeCA9PT0gdW5kZWZpbmVkKSBoeCA9IDA7XG4gICAgICBpZiAoaHkgPT09IHVuZGVmaW5lZCkgaHkgPSAwO1xuICAgICAgdmFyIHBvbHlnb25TaGFwZSA9IG5ldyBiMlBvbHlnb25TaGFwZSgpO1xuICAgICAgcG9seWdvblNoYXBlLlNldEFzQm94KGh4LCBoeSk7XG4gICAgICByZXR1cm4gcG9seWdvblNoYXBlO1xuICAgfVxuICAgYjJQb2x5Z29uU2hhcGUucHJvdG90eXBlLlNldEFzT3JpZW50ZWRCb3ggPSBmdW5jdGlvbiAoaHgsIGh5LCBjZW50ZXIsIGFuZ2xlKSB7XG4gICAgICBpZiAoaHggPT09IHVuZGVmaW5lZCkgaHggPSAwO1xuICAgICAgaWYgKGh5ID09PSB1bmRlZmluZWQpIGh5ID0gMDtcbiAgICAgIGlmIChjZW50ZXIgPT09IHVuZGVmaW5lZCkgY2VudGVyID0gbnVsbDtcbiAgICAgIGlmIChhbmdsZSA9PT0gdW5kZWZpbmVkKSBhbmdsZSA9IDAuMDtcbiAgICAgIHRoaXMubV92ZXJ0ZXhDb3VudCA9IDQ7XG4gICAgICB0aGlzLlJlc2VydmUoNCk7XG4gICAgICB0aGlzLm1fdmVydGljZXNbMF0uU2V0KCgtaHgpLCAoLWh5KSk7XG4gICAgICB0aGlzLm1fdmVydGljZXNbMV0uU2V0KGh4LCAoLWh5KSk7XG4gICAgICB0aGlzLm1fdmVydGljZXNbMl0uU2V0KGh4LCBoeSk7XG4gICAgICB0aGlzLm1fdmVydGljZXNbM10uU2V0KCgtaHgpLCBoeSk7XG4gICAgICB0aGlzLm1fbm9ybWFsc1swXS5TZXQoMC4wLCAoLTEuMCkpO1xuICAgICAgdGhpcy5tX25vcm1hbHNbMV0uU2V0KDEuMCwgMC4wKTtcbiAgICAgIHRoaXMubV9ub3JtYWxzWzJdLlNldCgwLjAsIDEuMCk7XG4gICAgICB0aGlzLm1fbm9ybWFsc1szXS5TZXQoKC0xLjApLCAwLjApO1xuICAgICAgdGhpcy5tX2NlbnRyb2lkID0gY2VudGVyO1xuICAgICAgdmFyIHhmID0gbmV3IGIyVHJhbnNmb3JtKCk7XG4gICAgICB4Zi5wb3NpdGlvbiA9IGNlbnRlcjtcbiAgICAgIHhmLlIuU2V0KGFuZ2xlKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tX3ZlcnRleENvdW50OyArK2kpIHtcbiAgICAgICAgIHRoaXMubV92ZXJ0aWNlc1tpXSA9IGIyTWF0aC5NdWxYKHhmLCB0aGlzLm1fdmVydGljZXNbaV0pO1xuICAgICAgICAgdGhpcy5tX25vcm1hbHNbaV0gPSBiMk1hdGguTXVsTVYoeGYuUiwgdGhpcy5tX25vcm1hbHNbaV0pO1xuICAgICAgfVxuICAgfVxuICAgYjJQb2x5Z29uU2hhcGUuQXNPcmllbnRlZEJveCA9IGZ1bmN0aW9uIChoeCwgaHksIGNlbnRlciwgYW5nbGUpIHtcbiAgICAgIGlmIChoeCA9PT0gdW5kZWZpbmVkKSBoeCA9IDA7XG4gICAgICBpZiAoaHkgPT09IHVuZGVmaW5lZCkgaHkgPSAwO1xuICAgICAgaWYgKGNlbnRlciA9PT0gdW5kZWZpbmVkKSBjZW50ZXIgPSBudWxsO1xuICAgICAgaWYgKGFuZ2xlID09PSB1bmRlZmluZWQpIGFuZ2xlID0gMC4wO1xuICAgICAgdmFyIHBvbHlnb25TaGFwZSA9IG5ldyBiMlBvbHlnb25TaGFwZSgpO1xuICAgICAgcG9seWdvblNoYXBlLlNldEFzT3JpZW50ZWRCb3goaHgsIGh5LCBjZW50ZXIsIGFuZ2xlKTtcbiAgICAgIHJldHVybiBwb2x5Z29uU2hhcGU7XG4gICB9XG4gICBiMlBvbHlnb25TaGFwZS5wcm90b3R5cGUuU2V0QXNFZGdlID0gZnVuY3Rpb24gKHYxLCB2Mikge1xuICAgICAgdGhpcy5tX3ZlcnRleENvdW50ID0gMjtcbiAgICAgIHRoaXMuUmVzZXJ2ZSgyKTtcbiAgICAgIHRoaXMubV92ZXJ0aWNlc1swXS5TZXRWKHYxKTtcbiAgICAgIHRoaXMubV92ZXJ0aWNlc1sxXS5TZXRWKHYyKTtcbiAgICAgIHRoaXMubV9jZW50cm9pZC54ID0gMC41ICogKHYxLnggKyB2Mi54KTtcbiAgICAgIHRoaXMubV9jZW50cm9pZC55ID0gMC41ICogKHYxLnkgKyB2Mi55KTtcbiAgICAgIHRoaXMubV9ub3JtYWxzWzBdID0gYjJNYXRoLkNyb3NzVkYoYjJNYXRoLlN1YnRyYWN0VlYodjIsIHYxKSwgMS4wKTtcbiAgICAgIHRoaXMubV9ub3JtYWxzWzBdLk5vcm1hbGl6ZSgpO1xuICAgICAgdGhpcy5tX25vcm1hbHNbMV0ueCA9ICgtdGhpcy5tX25vcm1hbHNbMF0ueCk7XG4gICAgICB0aGlzLm1fbm9ybWFsc1sxXS55ID0gKC10aGlzLm1fbm9ybWFsc1swXS55KTtcbiAgIH1cbiAgIGIyUG9seWdvblNoYXBlLkFzRWRnZSA9IGZ1bmN0aW9uICh2MSwgdjIpIHtcbiAgICAgIHZhciBwb2x5Z29uU2hhcGUgPSBuZXcgYjJQb2x5Z29uU2hhcGUoKTtcbiAgICAgIHBvbHlnb25TaGFwZS5TZXRBc0VkZ2UodjEsIHYyKTtcbiAgICAgIHJldHVybiBwb2x5Z29uU2hhcGU7XG4gICB9XG4gICBiMlBvbHlnb25TaGFwZS5wcm90b3R5cGUuVGVzdFBvaW50ID0gZnVuY3Rpb24gKHhmLCBwKSB7XG4gICAgICB2YXIgdFZlYztcbiAgICAgIHZhciB0TWF0ID0geGYuUjtcbiAgICAgIHZhciB0WCA9IHAueCAtIHhmLnBvc2l0aW9uLng7XG4gICAgICB2YXIgdFkgPSBwLnkgLSB4Zi5wb3NpdGlvbi55O1xuICAgICAgdmFyIHBMb2NhbFggPSAodFggKiB0TWF0LmNvbDEueCArIHRZICogdE1hdC5jb2wxLnkpO1xuICAgICAgdmFyIHBMb2NhbFkgPSAodFggKiB0TWF0LmNvbDIueCArIHRZICogdE1hdC5jb2wyLnkpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1fdmVydGV4Q291bnQ7ICsraSkge1xuICAgICAgICAgdFZlYyA9IHRoaXMubV92ZXJ0aWNlc1tpXTtcbiAgICAgICAgIHRYID0gcExvY2FsWCAtIHRWZWMueDtcbiAgICAgICAgIHRZID0gcExvY2FsWSAtIHRWZWMueTtcbiAgICAgICAgIHRWZWMgPSB0aGlzLm1fbm9ybWFsc1tpXTtcbiAgICAgICAgIHZhciBkb3QgPSAodFZlYy54ICogdFggKyB0VmVjLnkgKiB0WSk7XG4gICAgICAgICBpZiAoZG90ID4gMC4wKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgIH1cbiAgIGIyUG9seWdvblNoYXBlLnByb3RvdHlwZS5SYXlDYXN0ID0gZnVuY3Rpb24gKG91dHB1dCwgaW5wdXQsIHRyYW5zZm9ybSkge1xuICAgICAgdmFyIGxvd2VyID0gMC4wO1xuICAgICAgdmFyIHVwcGVyID0gaW5wdXQubWF4RnJhY3Rpb247XG4gICAgICB2YXIgdFggPSAwO1xuICAgICAgdmFyIHRZID0gMDtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIHRWZWM7XG4gICAgICB0WCA9IGlucHV0LnAxLnggLSB0cmFuc2Zvcm0ucG9zaXRpb24ueDtcbiAgICAgIHRZID0gaW5wdXQucDEueSAtIHRyYW5zZm9ybS5wb3NpdGlvbi55O1xuICAgICAgdE1hdCA9IHRyYW5zZm9ybS5SO1xuICAgICAgdmFyIHAxWCA9ICh0WCAqIHRNYXQuY29sMS54ICsgdFkgKiB0TWF0LmNvbDEueSk7XG4gICAgICB2YXIgcDFZID0gKHRYICogdE1hdC5jb2wyLnggKyB0WSAqIHRNYXQuY29sMi55KTtcbiAgICAgIHRYID0gaW5wdXQucDIueCAtIHRyYW5zZm9ybS5wb3NpdGlvbi54O1xuICAgICAgdFkgPSBpbnB1dC5wMi55IC0gdHJhbnNmb3JtLnBvc2l0aW9uLnk7XG4gICAgICB0TWF0ID0gdHJhbnNmb3JtLlI7XG4gICAgICB2YXIgcDJYID0gKHRYICogdE1hdC5jb2wxLnggKyB0WSAqIHRNYXQuY29sMS55KTtcbiAgICAgIHZhciBwMlkgPSAodFggKiB0TWF0LmNvbDIueCArIHRZICogdE1hdC5jb2wyLnkpO1xuICAgICAgdmFyIGRYID0gcDJYIC0gcDFYO1xuICAgICAgdmFyIGRZID0gcDJZIC0gcDFZO1xuICAgICAgdmFyIGluZGV4ID0gcGFyc2VJbnQoKC0xKSk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubV92ZXJ0ZXhDb3VudDsgKytpKSB7XG4gICAgICAgICB0VmVjID0gdGhpcy5tX3ZlcnRpY2VzW2ldO1xuICAgICAgICAgdFggPSB0VmVjLnggLSBwMVg7XG4gICAgICAgICB0WSA9IHRWZWMueSAtIHAxWTtcbiAgICAgICAgIHRWZWMgPSB0aGlzLm1fbm9ybWFsc1tpXTtcbiAgICAgICAgIHZhciBudW1lcmF0b3IgPSAodFZlYy54ICogdFggKyB0VmVjLnkgKiB0WSk7XG4gICAgICAgICB2YXIgZGVub21pbmF0b3IgPSAodFZlYy54ICogZFggKyB0VmVjLnkgKiBkWSk7XG4gICAgICAgICBpZiAoZGVub21pbmF0b3IgPT0gMC4wKSB7XG4gICAgICAgICAgICBpZiAobnVtZXJhdG9yIDwgMC4wKSB7XG4gICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChkZW5vbWluYXRvciA8IDAuMCAmJiBudW1lcmF0b3IgPCBsb3dlciAqIGRlbm9taW5hdG9yKSB7XG4gICAgICAgICAgICAgICBsb3dlciA9IG51bWVyYXRvciAvIGRlbm9taW5hdG9yO1xuICAgICAgICAgICAgICAgaW5kZXggPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZGVub21pbmF0b3IgPiAwLjAgJiYgbnVtZXJhdG9yIDwgdXBwZXIgKiBkZW5vbWluYXRvcikge1xuICAgICAgICAgICAgICAgdXBwZXIgPSBudW1lcmF0b3IgLyBkZW5vbWluYXRvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgICAgIGlmICh1cHBlciA8IGxvd2VyIC0gTnVtYmVyLk1JTl9WQUxVRSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgIG91dHB1dC5mcmFjdGlvbiA9IGxvd2VyO1xuICAgICAgICAgdE1hdCA9IHRyYW5zZm9ybS5SO1xuICAgICAgICAgdFZlYyA9IHRoaXMubV9ub3JtYWxzW2luZGV4XTtcbiAgICAgICAgIG91dHB1dC5ub3JtYWwueCA9ICh0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55KTtcbiAgICAgICAgIG91dHB1dC5ub3JtYWwueSA9ICh0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55KTtcbiAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgfVxuICAgYjJQb2x5Z29uU2hhcGUucHJvdG90eXBlLkNvbXB1dGVBQUJCID0gZnVuY3Rpb24gKGFhYmIsIHhmKSB7XG4gICAgICB2YXIgdE1hdCA9IHhmLlI7XG4gICAgICB2YXIgdFZlYyA9IHRoaXMubV92ZXJ0aWNlc1swXTtcbiAgICAgIHZhciBsb3dlclggPSB4Zi5wb3NpdGlvbi54ICsgKHRNYXQuY29sMS54ICogdFZlYy54ICsgdE1hdC5jb2wyLnggKiB0VmVjLnkpO1xuICAgICAgdmFyIGxvd2VyWSA9IHhmLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueSk7XG4gICAgICB2YXIgdXBwZXJYID0gbG93ZXJYO1xuICAgICAgdmFyIHVwcGVyWSA9IGxvd2VyWTtcbiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdGhpcy5tX3ZlcnRleENvdW50OyArK2kpIHtcbiAgICAgICAgIHRWZWMgPSB0aGlzLm1fdmVydGljZXNbaV07XG4gICAgICAgICB2YXIgdlggPSB4Zi5wb3NpdGlvbi54ICsgKHRNYXQuY29sMS54ICogdFZlYy54ICsgdE1hdC5jb2wyLnggKiB0VmVjLnkpO1xuICAgICAgICAgdmFyIHZZID0geGYucG9zaXRpb24ueSArICh0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55KTtcbiAgICAgICAgIGxvd2VyWCA9IGxvd2VyWCA8IHZYID8gbG93ZXJYIDogdlg7XG4gICAgICAgICBsb3dlclkgPSBsb3dlclkgPCB2WSA/IGxvd2VyWSA6IHZZO1xuICAgICAgICAgdXBwZXJYID0gdXBwZXJYID4gdlggPyB1cHBlclggOiB2WDtcbiAgICAgICAgIHVwcGVyWSA9IHVwcGVyWSA+IHZZID8gdXBwZXJZIDogdlk7XG4gICAgICB9XG4gICAgICBhYWJiLmxvd2VyQm91bmQueCA9IGxvd2VyWCAtIHRoaXMubV9yYWRpdXM7XG4gICAgICBhYWJiLmxvd2VyQm91bmQueSA9IGxvd2VyWSAtIHRoaXMubV9yYWRpdXM7XG4gICAgICBhYWJiLnVwcGVyQm91bmQueCA9IHVwcGVyWCArIHRoaXMubV9yYWRpdXM7XG4gICAgICBhYWJiLnVwcGVyQm91bmQueSA9IHVwcGVyWSArIHRoaXMubV9yYWRpdXM7XG4gICB9XG4gICBiMlBvbHlnb25TaGFwZS5wcm90b3R5cGUuQ29tcHV0ZU1hc3MgPSBmdW5jdGlvbiAobWFzc0RhdGEsIGRlbnNpdHkpIHtcbiAgICAgIGlmIChkZW5zaXR5ID09PSB1bmRlZmluZWQpIGRlbnNpdHkgPSAwO1xuICAgICAgaWYgKHRoaXMubV92ZXJ0ZXhDb3VudCA9PSAyKSB7XG4gICAgICAgICBtYXNzRGF0YS5jZW50ZXIueCA9IDAuNSAqICh0aGlzLm1fdmVydGljZXNbMF0ueCArIHRoaXMubV92ZXJ0aWNlc1sxXS54KTtcbiAgICAgICAgIG1hc3NEYXRhLmNlbnRlci55ID0gMC41ICogKHRoaXMubV92ZXJ0aWNlc1swXS55ICsgdGhpcy5tX3ZlcnRpY2VzWzFdLnkpO1xuICAgICAgICAgbWFzc0RhdGEubWFzcyA9IDAuMDtcbiAgICAgICAgIG1hc3NEYXRhLkkgPSAwLjA7XG4gICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgY2VudGVyWCA9IDAuMDtcbiAgICAgIHZhciBjZW50ZXJZID0gMC4wO1xuICAgICAgdmFyIGFyZWEgPSAwLjA7XG4gICAgICB2YXIgSSA9IDAuMDtcbiAgICAgIHZhciBwMVggPSAwLjA7XG4gICAgICB2YXIgcDFZID0gMC4wO1xuICAgICAgdmFyIGtfaW52MyA9IDEuMCAvIDMuMDtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tX3ZlcnRleENvdW50OyArK2kpIHtcbiAgICAgICAgIHZhciBwMiA9IHRoaXMubV92ZXJ0aWNlc1tpXTtcbiAgICAgICAgIHZhciBwMyA9IGkgKyAxIDwgdGhpcy5tX3ZlcnRleENvdW50ID8gdGhpcy5tX3ZlcnRpY2VzW3BhcnNlSW50KGkgKyAxKV0gOiB0aGlzLm1fdmVydGljZXNbMF07XG4gICAgICAgICB2YXIgZTFYID0gcDIueCAtIHAxWDtcbiAgICAgICAgIHZhciBlMVkgPSBwMi55IC0gcDFZO1xuICAgICAgICAgdmFyIGUyWCA9IHAzLnggLSBwMVg7XG4gICAgICAgICB2YXIgZTJZID0gcDMueSAtIHAxWTtcbiAgICAgICAgIHZhciBEID0gZTFYICogZTJZIC0gZTFZICogZTJYO1xuICAgICAgICAgdmFyIHRyaWFuZ2xlQXJlYSA9IDAuNSAqIEQ7YXJlYSArPSB0cmlhbmdsZUFyZWE7XG4gICAgICAgICBjZW50ZXJYICs9IHRyaWFuZ2xlQXJlYSAqIGtfaW52MyAqIChwMVggKyBwMi54ICsgcDMueCk7XG4gICAgICAgICBjZW50ZXJZICs9IHRyaWFuZ2xlQXJlYSAqIGtfaW52MyAqIChwMVkgKyBwMi55ICsgcDMueSk7XG4gICAgICAgICB2YXIgcHggPSBwMVg7XG4gICAgICAgICB2YXIgcHkgPSBwMVk7XG4gICAgICAgICB2YXIgZXgxID0gZTFYO1xuICAgICAgICAgdmFyIGV5MSA9IGUxWTtcbiAgICAgICAgIHZhciBleDIgPSBlMlg7XG4gICAgICAgICB2YXIgZXkyID0gZTJZO1xuICAgICAgICAgdmFyIGludHgyID0ga19pbnYzICogKDAuMjUgKiAoZXgxICogZXgxICsgZXgyICogZXgxICsgZXgyICogZXgyKSArIChweCAqIGV4MSArIHB4ICogZXgyKSkgKyAwLjUgKiBweCAqIHB4O1xuICAgICAgICAgdmFyIGludHkyID0ga19pbnYzICogKDAuMjUgKiAoZXkxICogZXkxICsgZXkyICogZXkxICsgZXkyICogZXkyKSArIChweSAqIGV5MSArIHB5ICogZXkyKSkgKyAwLjUgKiBweSAqIHB5O0kgKz0gRCAqIChpbnR4MiArIGludHkyKTtcbiAgICAgIH1cbiAgICAgIG1hc3NEYXRhLm1hc3MgPSBkZW5zaXR5ICogYXJlYTtcbiAgICAgIGNlbnRlclggKj0gMS4wIC8gYXJlYTtcbiAgICAgIGNlbnRlclkgKj0gMS4wIC8gYXJlYTtcbiAgICAgIG1hc3NEYXRhLmNlbnRlci5TZXQoY2VudGVyWCwgY2VudGVyWSk7XG4gICAgICBtYXNzRGF0YS5JID0gZGVuc2l0eSAqIEk7XG4gICB9XG4gICBiMlBvbHlnb25TaGFwZS5wcm90b3R5cGUuQ29tcHV0ZVN1Ym1lcmdlZEFyZWEgPSBmdW5jdGlvbiAobm9ybWFsLCBvZmZzZXQsIHhmLCBjKSB7XG4gICAgICBpZiAob2Zmc2V0ID09PSB1bmRlZmluZWQpIG9mZnNldCA9IDA7XG4gICAgICB2YXIgbm9ybWFsTCA9IGIyTWF0aC5NdWxUTVYoeGYuUiwgbm9ybWFsKTtcbiAgICAgIHZhciBvZmZzZXRMID0gb2Zmc2V0IC0gYjJNYXRoLkRvdChub3JtYWwsIHhmLnBvc2l0aW9uKTtcbiAgICAgIHZhciBkZXB0aHMgPSBuZXcgVmVjdG9yX2Eyal9OdW1iZXIoKTtcbiAgICAgIHZhciBkaXZlQ291bnQgPSAwO1xuICAgICAgdmFyIGludG9JbmRleCA9IHBhcnNlSW50KCgtMSkpO1xuICAgICAgdmFyIG91dG9JbmRleCA9IHBhcnNlSW50KCgtMSkpO1xuICAgICAgdmFyIGxhc3RTdWJtZXJnZWQgPSBmYWxzZTtcbiAgICAgIHZhciBpID0gMDtcbiAgICAgIGZvciAoaSA9IDA7XG4gICAgICBpIDwgdGhpcy5tX3ZlcnRleENvdW50OyArK2kpIHtcbiAgICAgICAgIGRlcHRoc1tpXSA9IGIyTWF0aC5Eb3Qobm9ybWFsTCwgdGhpcy5tX3ZlcnRpY2VzW2ldKSAtIG9mZnNldEw7XG4gICAgICAgICB2YXIgaXNTdWJtZXJnZWQgPSBkZXB0aHNbaV0gPCAoLU51bWJlci5NSU5fVkFMVUUpO1xuICAgICAgICAgaWYgKGkgPiAwKSB7XG4gICAgICAgICAgICBpZiAoaXNTdWJtZXJnZWQpIHtcbiAgICAgICAgICAgICAgIGlmICghbGFzdFN1Ym1lcmdlZCkge1xuICAgICAgICAgICAgICAgICAgaW50b0luZGV4ID0gaSAtIDE7XG4gICAgICAgICAgICAgICAgICBkaXZlQ291bnQrKztcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgaWYgKGxhc3RTdWJtZXJnZWQpIHtcbiAgICAgICAgICAgICAgICAgIG91dG9JbmRleCA9IGkgLSAxO1xuICAgICAgICAgICAgICAgICAgZGl2ZUNvdW50Kys7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICAgICBsYXN0U3VibWVyZ2VkID0gaXNTdWJtZXJnZWQ7XG4gICAgICB9XG4gICAgICBzd2l0Y2ggKGRpdmVDb3VudCkge1xuICAgICAgY2FzZSAwOlxuICAgICAgICAgaWYgKGxhc3RTdWJtZXJnZWQpIHtcbiAgICAgICAgICAgIHZhciBtZCA9IG5ldyBiMk1hc3NEYXRhKCk7XG4gICAgICAgICAgICB0aGlzLkNvbXB1dGVNYXNzKG1kLCAxKTtcbiAgICAgICAgICAgIGMuU2V0VihiMk1hdGguTXVsWCh4ZiwgbWQuY2VudGVyKSk7XG4gICAgICAgICAgICByZXR1cm4gbWQubWFzcztcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICB9XG4gICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgIGlmIChpbnRvSW5kZXggPT0gKC0xKSkge1xuICAgICAgICAgICAgaW50b0luZGV4ID0gdGhpcy5tX3ZlcnRleENvdW50IC0gMTtcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgb3V0b0luZGV4ID0gdGhpcy5tX3ZlcnRleENvdW50IC0gMTtcbiAgICAgICAgIH1cbiAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgdmFyIGludG9JbmRleDIgPSBwYXJzZUludCgoaW50b0luZGV4ICsgMSkgJSB0aGlzLm1fdmVydGV4Q291bnQpO1xuICAgICAgdmFyIG91dG9JbmRleDIgPSBwYXJzZUludCgob3V0b0luZGV4ICsgMSkgJSB0aGlzLm1fdmVydGV4Q291bnQpO1xuICAgICAgdmFyIGludG9MYW1kZGEgPSAoMCAtIGRlcHRoc1tpbnRvSW5kZXhdKSAvIChkZXB0aHNbaW50b0luZGV4Ml0gLSBkZXB0aHNbaW50b0luZGV4XSk7XG4gICAgICB2YXIgb3V0b0xhbWRkYSA9ICgwIC0gZGVwdGhzW291dG9JbmRleF0pIC8gKGRlcHRoc1tvdXRvSW5kZXgyXSAtIGRlcHRoc1tvdXRvSW5kZXhdKTtcbiAgICAgIHZhciBpbnRvVmVjID0gbmV3IGIyVmVjMih0aGlzLm1fdmVydGljZXNbaW50b0luZGV4XS54ICogKDEgLSBpbnRvTGFtZGRhKSArIHRoaXMubV92ZXJ0aWNlc1tpbnRvSW5kZXgyXS54ICogaW50b0xhbWRkYSwgdGhpcy5tX3ZlcnRpY2VzW2ludG9JbmRleF0ueSAqICgxIC0gaW50b0xhbWRkYSkgKyB0aGlzLm1fdmVydGljZXNbaW50b0luZGV4Ml0ueSAqIGludG9MYW1kZGEpO1xuICAgICAgdmFyIG91dG9WZWMgPSBuZXcgYjJWZWMyKHRoaXMubV92ZXJ0aWNlc1tvdXRvSW5kZXhdLnggKiAoMSAtIG91dG9MYW1kZGEpICsgdGhpcy5tX3ZlcnRpY2VzW291dG9JbmRleDJdLnggKiBvdXRvTGFtZGRhLCB0aGlzLm1fdmVydGljZXNbb3V0b0luZGV4XS55ICogKDEgLSBvdXRvTGFtZGRhKSArIHRoaXMubV92ZXJ0aWNlc1tvdXRvSW5kZXgyXS55ICogb3V0b0xhbWRkYSk7XG4gICAgICB2YXIgYXJlYSA9IDA7XG4gICAgICB2YXIgY2VudGVyID0gbmV3IGIyVmVjMigpO1xuICAgICAgdmFyIHAyID0gdGhpcy5tX3ZlcnRpY2VzW2ludG9JbmRleDJdO1xuICAgICAgdmFyIHAzO1xuICAgICAgaSA9IGludG9JbmRleDI7XG4gICAgICB3aGlsZSAoaSAhPSBvdXRvSW5kZXgyKSB7XG4gICAgICAgICBpID0gKGkgKyAxKSAlIHRoaXMubV92ZXJ0ZXhDb3VudDtcbiAgICAgICAgIGlmIChpID09IG91dG9JbmRleDIpIHAzID0gb3V0b1ZlYztcbiAgICAgICAgIGVsc2UgcDMgPSB0aGlzLm1fdmVydGljZXNbaV07XG4gICAgICAgICB2YXIgdHJpYW5nbGVBcmVhID0gMC41ICogKChwMi54IC0gaW50b1ZlYy54KSAqIChwMy55IC0gaW50b1ZlYy55KSAtIChwMi55IC0gaW50b1ZlYy55KSAqIChwMy54IC0gaW50b1ZlYy54KSk7XG4gICAgICAgICBhcmVhICs9IHRyaWFuZ2xlQXJlYTtcbiAgICAgICAgIGNlbnRlci54ICs9IHRyaWFuZ2xlQXJlYSAqIChpbnRvVmVjLnggKyBwMi54ICsgcDMueCkgLyAzO1xuICAgICAgICAgY2VudGVyLnkgKz0gdHJpYW5nbGVBcmVhICogKGludG9WZWMueSArIHAyLnkgKyBwMy55KSAvIDM7XG4gICAgICAgICBwMiA9IHAzO1xuICAgICAgfVxuICAgICAgY2VudGVyLk11bHRpcGx5KDEgLyBhcmVhKTtcbiAgICAgIGMuU2V0VihiMk1hdGguTXVsWCh4ZiwgY2VudGVyKSk7XG4gICAgICByZXR1cm4gYXJlYTtcbiAgIH1cbiAgIGIyUG9seWdvblNoYXBlLnByb3RvdHlwZS5HZXRWZXJ0ZXhDb3VudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fdmVydGV4Q291bnQ7XG4gICB9XG4gICBiMlBvbHlnb25TaGFwZS5wcm90b3R5cGUuR2V0VmVydGljZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3ZlcnRpY2VzO1xuICAgfVxuICAgYjJQb2x5Z29uU2hhcGUucHJvdG90eXBlLkdldE5vcm1hbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX25vcm1hbHM7XG4gICB9XG4gICBiMlBvbHlnb25TaGFwZS5wcm90b3R5cGUuR2V0U3VwcG9ydCA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICB2YXIgYmVzdEluZGV4ID0gMDtcbiAgICAgIHZhciBiZXN0VmFsdWUgPSB0aGlzLm1fdmVydGljZXNbMF0ueCAqIGQueCArIHRoaXMubV92ZXJ0aWNlc1swXS55ICogZC55O1xuICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0aGlzLm1fdmVydGV4Q291bnQ7ICsraSkge1xuICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5tX3ZlcnRpY2VzW2ldLnggKiBkLnggKyB0aGlzLm1fdmVydGljZXNbaV0ueSAqIGQueTtcbiAgICAgICAgIGlmICh2YWx1ZSA+IGJlc3RWYWx1ZSkge1xuICAgICAgICAgICAgYmVzdEluZGV4ID0gaTtcbiAgICAgICAgICAgIGJlc3RWYWx1ZSA9IHZhbHVlO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGJlc3RJbmRleDtcbiAgIH1cbiAgIGIyUG9seWdvblNoYXBlLnByb3RvdHlwZS5HZXRTdXBwb3J0VmVydGV4ID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgIHZhciBiZXN0SW5kZXggPSAwO1xuICAgICAgdmFyIGJlc3RWYWx1ZSA9IHRoaXMubV92ZXJ0aWNlc1swXS54ICogZC54ICsgdGhpcy5tX3ZlcnRpY2VzWzBdLnkgKiBkLnk7XG4gICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHRoaXMubV92ZXJ0ZXhDb3VudDsgKytpKSB7XG4gICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLm1fdmVydGljZXNbaV0ueCAqIGQueCArIHRoaXMubV92ZXJ0aWNlc1tpXS55ICogZC55O1xuICAgICAgICAgaWYgKHZhbHVlID4gYmVzdFZhbHVlKSB7XG4gICAgICAgICAgICBiZXN0SW5kZXggPSBpO1xuICAgICAgICAgICAgYmVzdFZhbHVlID0gdmFsdWU7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5tX3ZlcnRpY2VzW2Jlc3RJbmRleF07XG4gICB9XG4gICBiMlBvbHlnb25TaGFwZS5wcm90b3R5cGUuVmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICB9XG4gICBiMlBvbHlnb25TaGFwZS5wcm90b3R5cGUuYjJQb2x5Z29uU2hhcGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9fc3VwZXIuYjJTaGFwZS5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy5tX3R5cGUgPSBiMlNoYXBlLmVfcG9seWdvblNoYXBlO1xuICAgICAgdGhpcy5tX2NlbnRyb2lkID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX3ZlcnRpY2VzID0gbmV3IFZlY3RvcigpO1xuICAgICAgdGhpcy5tX25vcm1hbHMgPSBuZXcgVmVjdG9yKCk7XG4gICB9XG4gICBiMlBvbHlnb25TaGFwZS5wcm90b3R5cGUuUmVzZXJ2ZSA9IGZ1bmN0aW9uIChjb3VudCkge1xuICAgICAgaWYgKGNvdW50ID09PSB1bmRlZmluZWQpIGNvdW50ID0gMDtcbiAgICAgIGZvciAodmFyIGkgPSBwYXJzZUludCh0aGlzLm1fdmVydGljZXMubGVuZ3RoKTsgaSA8IGNvdW50OyBpKyspIHtcbiAgICAgICAgIHRoaXMubV92ZXJ0aWNlc1tpXSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgICAgIHRoaXMubV9ub3JtYWxzW2ldID0gbmV3IGIyVmVjMigpO1xuICAgICAgfVxuICAgfVxuICAgYjJQb2x5Z29uU2hhcGUuQ29tcHV0ZUNlbnRyb2lkID0gZnVuY3Rpb24gKHZzLCBjb3VudCkge1xuICAgICAgaWYgKGNvdW50ID09PSB1bmRlZmluZWQpIGNvdW50ID0gMDtcbiAgICAgIHZhciBjID0gbmV3IGIyVmVjMigpO1xuICAgICAgdmFyIGFyZWEgPSAwLjA7XG4gICAgICB2YXIgcDFYID0gMC4wO1xuICAgICAgdmFyIHAxWSA9IDAuMDtcbiAgICAgIHZhciBpbnYzID0gMS4wIC8gMy4wO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7XG4gICAgICAgICB2YXIgcDIgPSB2c1tpXTtcbiAgICAgICAgIHZhciBwMyA9IGkgKyAxIDwgY291bnQgPyB2c1twYXJzZUludChpICsgMSldIDogdnNbMF07XG4gICAgICAgICB2YXIgZTFYID0gcDIueCAtIHAxWDtcbiAgICAgICAgIHZhciBlMVkgPSBwMi55IC0gcDFZO1xuICAgICAgICAgdmFyIGUyWCA9IHAzLnggLSBwMVg7XG4gICAgICAgICB2YXIgZTJZID0gcDMueSAtIHAxWTtcbiAgICAgICAgIHZhciBEID0gKGUxWCAqIGUyWSAtIGUxWSAqIGUyWCk7XG4gICAgICAgICB2YXIgdHJpYW5nbGVBcmVhID0gMC41ICogRDthcmVhICs9IHRyaWFuZ2xlQXJlYTtcbiAgICAgICAgIGMueCArPSB0cmlhbmdsZUFyZWEgKiBpbnYzICogKHAxWCArIHAyLnggKyBwMy54KTtcbiAgICAgICAgIGMueSArPSB0cmlhbmdsZUFyZWEgKiBpbnYzICogKHAxWSArIHAyLnkgKyBwMy55KTtcbiAgICAgIH1cbiAgICAgIGMueCAqPSAxLjAgLyBhcmVhO1xuICAgICAgYy55ICo9IDEuMCAvIGFyZWE7XG4gICAgICByZXR1cm4gYztcbiAgIH1cbiAgIGIyUG9seWdvblNoYXBlLkNvbXB1dGVPQkIgPSBmdW5jdGlvbiAob2JiLCB2cywgY291bnQpIHtcbiAgICAgIGlmIChjb3VudCA9PT0gdW5kZWZpbmVkKSBjb3VudCA9IDA7XG4gICAgICB2YXIgaSA9IDA7XG4gICAgICB2YXIgcCA9IG5ldyBWZWN0b3IoY291bnQgKyAxKTtcbiAgICAgIGZvciAoaSA9IDA7XG4gICAgICBpIDwgY291bnQ7ICsraSkge1xuICAgICAgICAgcFtpXSA9IHZzW2ldO1xuICAgICAgfVxuICAgICAgcFtjb3VudF0gPSBwWzBdO1xuICAgICAgdmFyIG1pbkFyZWEgPSBOdW1iZXIuTUFYX1ZBTFVFO1xuICAgICAgZm9yIChpID0gMTtcbiAgICAgIGkgPD0gY291bnQ7ICsraSkge1xuICAgICAgICAgdmFyIHJvb3QgPSBwW3BhcnNlSW50KGkgLSAxKV07XG4gICAgICAgICB2YXIgdXhYID0gcFtpXS54IC0gcm9vdC54O1xuICAgICAgICAgdmFyIHV4WSA9IHBbaV0ueSAtIHJvb3QueTtcbiAgICAgICAgIHZhciBsZW5ndGggPSBNYXRoLnNxcnQodXhYICogdXhYICsgdXhZICogdXhZKTtcbiAgICAgICAgIHV4WCAvPSBsZW5ndGg7XG4gICAgICAgICB1eFkgLz0gbGVuZ3RoO1xuICAgICAgICAgdmFyIHV5WCA9ICgtdXhZKTtcbiAgICAgICAgIHZhciB1eVkgPSB1eFg7XG4gICAgICAgICB2YXIgbG93ZXJYID0gTnVtYmVyLk1BWF9WQUxVRTtcbiAgICAgICAgIHZhciBsb3dlclkgPSBOdW1iZXIuTUFYX1ZBTFVFO1xuICAgICAgICAgdmFyIHVwcGVyWCA9ICgtTnVtYmVyLk1BWF9WQUxVRSk7XG4gICAgICAgICB2YXIgdXBwZXJZID0gKC1OdW1iZXIuTUFYX1ZBTFVFKTtcbiAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY291bnQ7ICsraikge1xuICAgICAgICAgICAgdmFyIGRYID0gcFtqXS54IC0gcm9vdC54O1xuICAgICAgICAgICAgdmFyIGRZID0gcFtqXS55IC0gcm9vdC55O1xuICAgICAgICAgICAgdmFyIHJYID0gKHV4WCAqIGRYICsgdXhZICogZFkpO1xuICAgICAgICAgICAgdmFyIHJZID0gKHV5WCAqIGRYICsgdXlZICogZFkpO1xuICAgICAgICAgICAgaWYgKHJYIDwgbG93ZXJYKSBsb3dlclggPSByWDtcbiAgICAgICAgICAgIGlmIChyWSA8IGxvd2VyWSkgbG93ZXJZID0gclk7XG4gICAgICAgICAgICBpZiAoclggPiB1cHBlclgpIHVwcGVyWCA9IHJYO1xuICAgICAgICAgICAgaWYgKHJZID4gdXBwZXJZKSB1cHBlclkgPSByWTtcbiAgICAgICAgIH1cbiAgICAgICAgIHZhciBhcmVhID0gKHVwcGVyWCAtIGxvd2VyWCkgKiAodXBwZXJZIC0gbG93ZXJZKTtcbiAgICAgICAgIGlmIChhcmVhIDwgMC45NSAqIG1pbkFyZWEpIHtcbiAgICAgICAgICAgIG1pbkFyZWEgPSBhcmVhO1xuICAgICAgICAgICAgb2JiLlIuY29sMS54ID0gdXhYO1xuICAgICAgICAgICAgb2JiLlIuY29sMS55ID0gdXhZO1xuICAgICAgICAgICAgb2JiLlIuY29sMi54ID0gdXlYO1xuICAgICAgICAgICAgb2JiLlIuY29sMi55ID0gdXlZO1xuICAgICAgICAgICAgdmFyIGNlbnRlclggPSAwLjUgKiAobG93ZXJYICsgdXBwZXJYKTtcbiAgICAgICAgICAgIHZhciBjZW50ZXJZID0gMC41ICogKGxvd2VyWSArIHVwcGVyWSk7XG4gICAgICAgICAgICB2YXIgdE1hdCA9IG9iYi5SO1xuICAgICAgICAgICAgb2JiLmNlbnRlci54ID0gcm9vdC54ICsgKHRNYXQuY29sMS54ICogY2VudGVyWCArIHRNYXQuY29sMi54ICogY2VudGVyWSk7XG4gICAgICAgICAgICBvYmIuY2VudGVyLnkgPSByb290LnkgKyAodE1hdC5jb2wxLnkgKiBjZW50ZXJYICsgdE1hdC5jb2wyLnkgKiBjZW50ZXJZKTtcbiAgICAgICAgICAgIG9iYi5leHRlbnRzLnggPSAwLjUgKiAodXBwZXJYIC0gbG93ZXJYKTtcbiAgICAgICAgICAgIG9iYi5leHRlbnRzLnkgPSAwLjUgKiAodXBwZXJZIC0gbG93ZXJZKTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgIH1cbiAgIEJveDJELnBvc3REZWZzLnB1c2goZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMlBvbHlnb25TaGFwZS5zX21hdCA9IG5ldyBiMk1hdDIyKCk7XG4gICB9KTtcbiAgIGIyU2hhcGUuYjJTaGFwZSA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJTaGFwZS5wcm90b3R5cGUuQ29weSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgfVxuICAgYjJTaGFwZS5wcm90b3R5cGUuU2V0ID0gZnVuY3Rpb24gKG90aGVyKSB7XG4gICAgICB0aGlzLm1fcmFkaXVzID0gb3RoZXIubV9yYWRpdXM7XG4gICB9XG4gICBiMlNoYXBlLnByb3RvdHlwZS5HZXRUeXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV90eXBlO1xuICAgfVxuICAgYjJTaGFwZS5wcm90b3R5cGUuVGVzdFBvaW50ID0gZnVuY3Rpb24gKHhmLCBwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICB9XG4gICBiMlNoYXBlLnByb3RvdHlwZS5SYXlDYXN0ID0gZnVuY3Rpb24gKG91dHB1dCwgaW5wdXQsIHRyYW5zZm9ybSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgfVxuICAgYjJTaGFwZS5wcm90b3R5cGUuQ29tcHV0ZUFBQkIgPSBmdW5jdGlvbiAoYWFiYiwgeGYpIHt9XG4gICBiMlNoYXBlLnByb3RvdHlwZS5Db21wdXRlTWFzcyA9IGZ1bmN0aW9uIChtYXNzRGF0YSwgZGVuc2l0eSkge1xuICAgICAgaWYgKGRlbnNpdHkgPT09IHVuZGVmaW5lZCkgZGVuc2l0eSA9IDA7XG4gICB9XG4gICBiMlNoYXBlLnByb3RvdHlwZS5Db21wdXRlU3VibWVyZ2VkQXJlYSA9IGZ1bmN0aW9uIChub3JtYWwsIG9mZnNldCwgeGYsIGMpIHtcbiAgICAgIGlmIChvZmZzZXQgPT09IHVuZGVmaW5lZCkgb2Zmc2V0ID0gMDtcbiAgICAgIHJldHVybiAwO1xuICAgfVxuICAgYjJTaGFwZS5UZXN0T3ZlcmxhcCA9IGZ1bmN0aW9uIChzaGFwZTEsIHRyYW5zZm9ybTEsIHNoYXBlMiwgdHJhbnNmb3JtMikge1xuICAgICAgdmFyIGlucHV0ID0gbmV3IGIyRGlzdGFuY2VJbnB1dCgpO1xuICAgICAgaW5wdXQucHJveHlBID0gbmV3IGIyRGlzdGFuY2VQcm94eSgpO1xuICAgICAgaW5wdXQucHJveHlBLlNldChzaGFwZTEpO1xuICAgICAgaW5wdXQucHJveHlCID0gbmV3IGIyRGlzdGFuY2VQcm94eSgpO1xuICAgICAgaW5wdXQucHJveHlCLlNldChzaGFwZTIpO1xuICAgICAgaW5wdXQudHJhbnNmb3JtQSA9IHRyYW5zZm9ybTE7XG4gICAgICBpbnB1dC50cmFuc2Zvcm1CID0gdHJhbnNmb3JtMjtcbiAgICAgIGlucHV0LnVzZVJhZGlpID0gdHJ1ZTtcbiAgICAgIHZhciBzaW1wbGV4Q2FjaGUgPSBuZXcgYjJTaW1wbGV4Q2FjaGUoKTtcbiAgICAgIHNpbXBsZXhDYWNoZS5jb3VudCA9IDA7XG4gICAgICB2YXIgb3V0cHV0ID0gbmV3IGIyRGlzdGFuY2VPdXRwdXQoKTtcbiAgICAgIGIyRGlzdGFuY2UuRGlzdGFuY2Uob3V0cHV0LCBzaW1wbGV4Q2FjaGUsIGlucHV0KTtcbiAgICAgIHJldHVybiBvdXRwdXQuZGlzdGFuY2UgPCAxMC4wICogTnVtYmVyLk1JTl9WQUxVRTtcbiAgIH1cbiAgIGIyU2hhcGUucHJvdG90eXBlLmIyU2hhcGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1fdHlwZSA9IGIyU2hhcGUuZV91bmtub3duU2hhcGU7XG4gICAgICB0aGlzLm1fcmFkaXVzID0gYjJTZXR0aW5ncy5iMl9saW5lYXJTbG9wO1xuICAgfVxuICAgQm94MkQucG9zdERlZnMucHVzaChmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyU2hhcGUuZV91bmtub3duU2hhcGUgPSBwYXJzZUludCgoLTEpKTtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJTaGFwZS5lX2NpcmNsZVNoYXBlID0gMDtcbiAgICAgIEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJTaGFwZS5lX3BvbHlnb25TaGFwZSA9IDE7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyU2hhcGUuZV9lZGdlU2hhcGUgPSAyO1xuICAgICAgQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMlNoYXBlLmVfc2hhcGVUeXBlQ291bnQgPSAzO1xuICAgICAgQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMlNoYXBlLmVfaGl0Q29sbGlkZSA9IDE7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyU2hhcGUuZV9taXNzQ29sbGlkZSA9IDA7XG4gICAgICBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyU2hhcGUuZV9zdGFydHNJbnNpZGVDb2xsaWRlID0gcGFyc2VJbnQoKC0xKSk7XG4gICB9KTtcbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgdmFyIGIyQ29sb3IgPSBCb3gyRC5Db21tb24uYjJDb2xvcixcbiAgICAgIGIyaW50ZXJuYWwgPSBCb3gyRC5Db21tb24uYjJpbnRlcm5hbCxcbiAgICAgIGIyU2V0dGluZ3MgPSBCb3gyRC5Db21tb24uYjJTZXR0aW5ncyxcbiAgICAgIGIyTWF0MjIgPSBCb3gyRC5Db21tb24uTWF0aC5iMk1hdDIyLFxuICAgICAgYjJNYXQzMyA9IEJveDJELkNvbW1vbi5NYXRoLmIyTWF0MzMsXG4gICAgICBiMk1hdGggPSBCb3gyRC5Db21tb24uTWF0aC5iMk1hdGgsXG4gICAgICBiMlN3ZWVwID0gQm94MkQuQ29tbW9uLk1hdGguYjJTd2VlcCxcbiAgICAgIGIyVHJhbnNmb3JtID0gQm94MkQuQ29tbW9uLk1hdGguYjJUcmFuc2Zvcm0sXG4gICAgICBiMlZlYzIgPSBCb3gyRC5Db21tb24uTWF0aC5iMlZlYzIsXG4gICAgICBiMlZlYzMgPSBCb3gyRC5Db21tb24uTWF0aC5iMlZlYzM7XG5cbiAgIGIyQ29sb3IuYjJDb2xvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX3IgPSAwO1xuICAgICAgdGhpcy5fZyA9IDA7XG4gICAgICB0aGlzLl9iID0gMDtcbiAgIH07XG4gICBiMkNvbG9yLnByb3RvdHlwZS5iMkNvbG9yID0gZnVuY3Rpb24gKHJyLCBnZywgYmIpIHtcbiAgICAgIGlmIChyciA9PT0gdW5kZWZpbmVkKSByciA9IDA7XG4gICAgICBpZiAoZ2cgPT09IHVuZGVmaW5lZCkgZ2cgPSAwO1xuICAgICAgaWYgKGJiID09PSB1bmRlZmluZWQpIGJiID0gMDtcbiAgICAgIHRoaXMuX3IgPSBCb3gyRC5wYXJzZVVJbnQoMjU1ICogYjJNYXRoLkNsYW1wKHJyLCAwLjAsIDEuMCkpO1xuICAgICAgdGhpcy5fZyA9IEJveDJELnBhcnNlVUludCgyNTUgKiBiMk1hdGguQ2xhbXAoZ2csIDAuMCwgMS4wKSk7XG4gICAgICB0aGlzLl9iID0gQm94MkQucGFyc2VVSW50KDI1NSAqIGIyTWF0aC5DbGFtcChiYiwgMC4wLCAxLjApKTtcbiAgIH1cbiAgIGIyQ29sb3IucHJvdG90eXBlLlNldCA9IGZ1bmN0aW9uIChyciwgZ2csIGJiKSB7XG4gICAgICBpZiAocnIgPT09IHVuZGVmaW5lZCkgcnIgPSAwO1xuICAgICAgaWYgKGdnID09PSB1bmRlZmluZWQpIGdnID0gMDtcbiAgICAgIGlmIChiYiA9PT0gdW5kZWZpbmVkKSBiYiA9IDA7XG4gICAgICB0aGlzLl9yID0gQm94MkQucGFyc2VVSW50KDI1NSAqIGIyTWF0aC5DbGFtcChyciwgMC4wLCAxLjApKTtcbiAgICAgIHRoaXMuX2cgPSBCb3gyRC5wYXJzZVVJbnQoMjU1ICogYjJNYXRoLkNsYW1wKGdnLCAwLjAsIDEuMCkpO1xuICAgICAgdGhpcy5fYiA9IEJveDJELnBhcnNlVUludCgyNTUgKiBiMk1hdGguQ2xhbXAoYmIsIDAuMCwgMS4wKSk7XG4gICB9XG4gICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYjJDb2xvci5wcm90b3R5cGUsICdyJywge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBzZXQ6IGZ1bmN0aW9uIChycikge1xuICAgICAgICAgaWYgKHJyID09PSB1bmRlZmluZWQpIHJyID0gMDtcbiAgICAgICAgIHRoaXMuX3IgPSBCb3gyRC5wYXJzZVVJbnQoMjU1ICogYjJNYXRoLkNsYW1wKHJyLCAwLjAsIDEuMCkpO1xuICAgICAgfVxuICAgfSk7XG4gICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYjJDb2xvci5wcm90b3R5cGUsICdnJywge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBzZXQ6IGZ1bmN0aW9uIChnZykge1xuICAgICAgICAgaWYgKGdnID09PSB1bmRlZmluZWQpIGdnID0gMDtcbiAgICAgICAgIHRoaXMuX2cgPSBCb3gyRC5wYXJzZVVJbnQoMjU1ICogYjJNYXRoLkNsYW1wKGdnLCAwLjAsIDEuMCkpO1xuICAgICAgfVxuICAgfSk7XG4gICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYjJDb2xvci5wcm90b3R5cGUsICdiJywge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBzZXQ6IGZ1bmN0aW9uIChiYikge1xuICAgICAgICAgaWYgKGJiID09PSB1bmRlZmluZWQpIGJiID0gMDtcbiAgICAgICAgIHRoaXMuX2IgPSBCb3gyRC5wYXJzZVVJbnQoMjU1ICogYjJNYXRoLkNsYW1wKGJiLCAwLjAsIDEuMCkpO1xuICAgICAgfVxuICAgfSk7XG4gICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYjJDb2xvci5wcm90b3R5cGUsICdjb2xvcicsIHtcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICByZXR1cm4gKHRoaXMuX3IgPDwgMTYpIHwgKHRoaXMuX2cgPDwgOCkgfCAodGhpcy5fYik7XG4gICAgICB9XG4gICB9KTtcbiAgIGIyU2V0dGluZ3MuYjJTZXR0aW5ncyA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJTZXR0aW5ncy5iMk1peEZyaWN0aW9uID0gZnVuY3Rpb24gKGZyaWN0aW9uMSwgZnJpY3Rpb24yKSB7XG4gICAgICBpZiAoZnJpY3Rpb24xID09PSB1bmRlZmluZWQpIGZyaWN0aW9uMSA9IDA7XG4gICAgICBpZiAoZnJpY3Rpb24yID09PSB1bmRlZmluZWQpIGZyaWN0aW9uMiA9IDA7XG4gICAgICByZXR1cm4gTWF0aC5zcXJ0KGZyaWN0aW9uMSAqIGZyaWN0aW9uMik7XG4gICB9XG4gICBiMlNldHRpbmdzLmIyTWl4UmVzdGl0dXRpb24gPSBmdW5jdGlvbiAocmVzdGl0dXRpb24xLCByZXN0aXR1dGlvbjIpIHtcbiAgICAgIGlmIChyZXN0aXR1dGlvbjEgPT09IHVuZGVmaW5lZCkgcmVzdGl0dXRpb24xID0gMDtcbiAgICAgIGlmIChyZXN0aXR1dGlvbjIgPT09IHVuZGVmaW5lZCkgcmVzdGl0dXRpb24yID0gMDtcbiAgICAgIHJldHVybiByZXN0aXR1dGlvbjEgPiByZXN0aXR1dGlvbjIgPyByZXN0aXR1dGlvbjEgOiByZXN0aXR1dGlvbjI7XG4gICB9XG4gICBiMlNldHRpbmdzLmIyQXNzZXJ0ID0gZnVuY3Rpb24gKGEpIHtcbiAgICAgIGlmICghYSkge1xuICAgICAgICAgdGhyb3cgXCJBc3NlcnRpb24gRmFpbGVkXCI7XG4gICAgICB9XG4gICB9XG4gICBCb3gyRC5wb3N0RGVmcy5wdXNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkNvbW1vbi5iMlNldHRpbmdzLlZFUlNJT04gPSBcIjIuMWFscGhhXCI7XG4gICAgICBCb3gyRC5Db21tb24uYjJTZXR0aW5ncy5VU0hSVF9NQVggPSAweDAwMDBmZmZmO1xuICAgICAgQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MuYjJfcGkgPSBNYXRoLlBJO1xuICAgICAgQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MuYjJfbWF4TWFuaWZvbGRQb2ludHMgPSAyO1xuICAgICAgQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MuYjJfYWFiYkV4dGVuc2lvbiA9IDAuMTtcbiAgICAgIEJveDJELkNvbW1vbi5iMlNldHRpbmdzLmIyX2FhYmJNdWx0aXBsaWVyID0gMi4wO1xuICAgICAgQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MuYjJfcG9seWdvblJhZGl1cyA9IDIuMCAqIGIyU2V0dGluZ3MuYjJfbGluZWFyU2xvcDtcbiAgICAgIEJveDJELkNvbW1vbi5iMlNldHRpbmdzLmIyX2xpbmVhclNsb3AgPSAwLjAwNTtcbiAgICAgIEJveDJELkNvbW1vbi5iMlNldHRpbmdzLmIyX2FuZ3VsYXJTbG9wID0gMi4wIC8gMTgwLjAgKiBiMlNldHRpbmdzLmIyX3BpO1xuICAgICAgQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MuYjJfdG9pU2xvcCA9IDguMCAqIGIyU2V0dGluZ3MuYjJfbGluZWFyU2xvcDtcbiAgICAgIEJveDJELkNvbW1vbi5iMlNldHRpbmdzLmIyX21heFRPSUNvbnRhY3RzUGVySXNsYW5kID0gMzI7XG4gICAgICBCb3gyRC5Db21tb24uYjJTZXR0aW5ncy5iMl9tYXhUT0lKb2ludHNQZXJJc2xhbmQgPSAzMjtcbiAgICAgIEJveDJELkNvbW1vbi5iMlNldHRpbmdzLmIyX3ZlbG9jaXR5VGhyZXNob2xkID0gMS4wO1xuICAgICAgQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MuYjJfbWF4TGluZWFyQ29ycmVjdGlvbiA9IDAuMjtcbiAgICAgIEJveDJELkNvbW1vbi5iMlNldHRpbmdzLmIyX21heEFuZ3VsYXJDb3JyZWN0aW9uID0gOC4wIC8gMTgwLjAgKiBiMlNldHRpbmdzLmIyX3BpO1xuICAgICAgQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MuYjJfbWF4VHJhbnNsYXRpb24gPSAyLjA7XG4gICAgICBCb3gyRC5Db21tb24uYjJTZXR0aW5ncy5iMl9tYXhUcmFuc2xhdGlvblNxdWFyZWQgPSBiMlNldHRpbmdzLmIyX21heFRyYW5zbGF0aW9uICogYjJTZXR0aW5ncy5iMl9tYXhUcmFuc2xhdGlvbjtcbiAgICAgIEJveDJELkNvbW1vbi5iMlNldHRpbmdzLmIyX21heFJvdGF0aW9uID0gMC41ICogYjJTZXR0aW5ncy5iMl9waTtcbiAgICAgIEJveDJELkNvbW1vbi5iMlNldHRpbmdzLmIyX21heFJvdGF0aW9uU3F1YXJlZCA9IGIyU2V0dGluZ3MuYjJfbWF4Um90YXRpb24gKiBiMlNldHRpbmdzLmIyX21heFJvdGF0aW9uO1xuICAgICAgQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MuYjJfY29udGFjdEJhdW1nYXJ0ZSA9IDAuMjtcbiAgICAgIEJveDJELkNvbW1vbi5iMlNldHRpbmdzLmIyX3RpbWVUb1NsZWVwID0gMC41O1xuICAgICAgQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MuYjJfbGluZWFyU2xlZXBUb2xlcmFuY2UgPSAwLjAxO1xuICAgICAgQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MuYjJfYW5ndWxhclNsZWVwVG9sZXJhbmNlID0gMi4wIC8gMTgwLjAgKiBiMlNldHRpbmdzLmIyX3BpO1xuICAgfSk7XG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcbiAgIHZhciBiMkFBQkIgPSBCb3gyRC5Db2xsaXNpb24uYjJBQUJCLFxuICAgICAgYjJDb2xvciA9IEJveDJELkNvbW1vbi5iMkNvbG9yLFxuICAgICAgYjJpbnRlcm5hbCA9IEJveDJELkNvbW1vbi5iMmludGVybmFsLFxuICAgICAgYjJTZXR0aW5ncyA9IEJveDJELkNvbW1vbi5iMlNldHRpbmdzLFxuICAgICAgYjJNYXQyMiA9IEJveDJELkNvbW1vbi5NYXRoLmIyTWF0MjIsXG4gICAgICBiMk1hdDMzID0gQm94MkQuQ29tbW9uLk1hdGguYjJNYXQzMyxcbiAgICAgIGIyTWF0aCA9IEJveDJELkNvbW1vbi5NYXRoLmIyTWF0aCxcbiAgICAgIGIyU3dlZXAgPSBCb3gyRC5Db21tb24uTWF0aC5iMlN3ZWVwLFxuICAgICAgYjJUcmFuc2Zvcm0gPSBCb3gyRC5Db21tb24uTWF0aC5iMlRyYW5zZm9ybSxcbiAgICAgIGIyVmVjMiA9IEJveDJELkNvbW1vbi5NYXRoLmIyVmVjMixcbiAgICAgIGIyVmVjMyA9IEJveDJELkNvbW1vbi5NYXRoLmIyVmVjMztcblxuICAgYjJNYXQyMi5iMk1hdDIyID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5jb2wxID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5jb2wyID0gbmV3IGIyVmVjMigpO1xuICAgfTtcbiAgIGIyTWF0MjIucHJvdG90eXBlLmIyTWF0MjIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLlNldElkZW50aXR5KCk7XG4gICB9XG4gICBiMk1hdDIyLkZyb21BbmdsZSA9IGZ1bmN0aW9uIChhbmdsZSkge1xuICAgICAgaWYgKGFuZ2xlID09PSB1bmRlZmluZWQpIGFuZ2xlID0gMDtcbiAgICAgIHZhciBtYXQgPSBuZXcgYjJNYXQyMigpO1xuICAgICAgbWF0LlNldChhbmdsZSk7XG4gICAgICByZXR1cm4gbWF0O1xuICAgfVxuICAgYjJNYXQyMi5Gcm9tVlYgPSBmdW5jdGlvbiAoYzEsIGMyKSB7XG4gICAgICB2YXIgbWF0ID0gbmV3IGIyTWF0MjIoKTtcbiAgICAgIG1hdC5TZXRWVihjMSwgYzIpO1xuICAgICAgcmV0dXJuIG1hdDtcbiAgIH1cbiAgIGIyTWF0MjIucHJvdG90eXBlLlNldCA9IGZ1bmN0aW9uIChhbmdsZSkge1xuICAgICAgaWYgKGFuZ2xlID09PSB1bmRlZmluZWQpIGFuZ2xlID0gMDtcbiAgICAgIHZhciBjID0gTWF0aC5jb3MoYW5nbGUpO1xuICAgICAgdmFyIHMgPSBNYXRoLnNpbihhbmdsZSk7XG4gICAgICB0aGlzLmNvbDEueCA9IGM7XG4gICAgICB0aGlzLmNvbDIueCA9ICgtcyk7XG4gICAgICB0aGlzLmNvbDEueSA9IHM7XG4gICAgICB0aGlzLmNvbDIueSA9IGM7XG4gICB9XG4gICBiMk1hdDIyLnByb3RvdHlwZS5TZXRWViA9IGZ1bmN0aW9uIChjMSwgYzIpIHtcbiAgICAgIHRoaXMuY29sMS5TZXRWKGMxKTtcbiAgICAgIHRoaXMuY29sMi5TZXRWKGMyKTtcbiAgIH1cbiAgIGIyTWF0MjIucHJvdG90eXBlLkNvcHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbWF0ID0gbmV3IGIyTWF0MjIoKTtcbiAgICAgIG1hdC5TZXRNKHRoaXMpO1xuICAgICAgcmV0dXJuIG1hdDtcbiAgIH1cbiAgIGIyTWF0MjIucHJvdG90eXBlLlNldE0gPSBmdW5jdGlvbiAobSkge1xuICAgICAgdGhpcy5jb2wxLlNldFYobS5jb2wxKTtcbiAgICAgIHRoaXMuY29sMi5TZXRWKG0uY29sMik7XG4gICB9XG4gICBiMk1hdDIyLnByb3RvdHlwZS5BZGRNID0gZnVuY3Rpb24gKG0pIHtcbiAgICAgIHRoaXMuY29sMS54ICs9IG0uY29sMS54O1xuICAgICAgdGhpcy5jb2wxLnkgKz0gbS5jb2wxLnk7XG4gICAgICB0aGlzLmNvbDIueCArPSBtLmNvbDIueDtcbiAgICAgIHRoaXMuY29sMi55ICs9IG0uY29sMi55O1xuICAgfVxuICAgYjJNYXQyMi5wcm90b3R5cGUuU2V0SWRlbnRpdHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmNvbDEueCA9IDEuMDtcbiAgICAgIHRoaXMuY29sMi54ID0gMC4wO1xuICAgICAgdGhpcy5jb2wxLnkgPSAwLjA7XG4gICAgICB0aGlzLmNvbDIueSA9IDEuMDtcbiAgIH1cbiAgIGIyTWF0MjIucHJvdG90eXBlLlNldFplcm8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmNvbDEueCA9IDAuMDtcbiAgICAgIHRoaXMuY29sMi54ID0gMC4wO1xuICAgICAgdGhpcy5jb2wxLnkgPSAwLjA7XG4gICAgICB0aGlzLmNvbDIueSA9IDAuMDtcbiAgIH1cbiAgIGIyTWF0MjIucHJvdG90eXBlLkdldEFuZ2xlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIE1hdGguYXRhbjIodGhpcy5jb2wxLnksIHRoaXMuY29sMS54KTtcbiAgIH1cbiAgIGIyTWF0MjIucHJvdG90eXBlLkdldEludmVyc2UgPSBmdW5jdGlvbiAob3V0KSB7XG4gICAgICB2YXIgYSA9IHRoaXMuY29sMS54O1xuICAgICAgdmFyIGIgPSB0aGlzLmNvbDIueDtcbiAgICAgIHZhciBjID0gdGhpcy5jb2wxLnk7XG4gICAgICB2YXIgZCA9IHRoaXMuY29sMi55O1xuICAgICAgdmFyIGRldCA9IGEgKiBkIC0gYiAqIGM7XG4gICAgICBpZiAoZGV0ICE9IDAuMCkge1xuICAgICAgICAgZGV0ID0gMS4wIC8gZGV0O1xuICAgICAgfVxuICAgICAgb3V0LmNvbDEueCA9IGRldCAqIGQ7XG4gICAgICBvdXQuY29sMi54ID0gKC1kZXQgKiBiKTtcbiAgICAgIG91dC5jb2wxLnkgPSAoLWRldCAqIGMpO1xuICAgICAgb3V0LmNvbDIueSA9IGRldCAqIGE7XG4gICAgICByZXR1cm4gb3V0O1xuICAgfVxuICAgYjJNYXQyMi5wcm90b3R5cGUuU29sdmUgPSBmdW5jdGlvbiAob3V0LCBiWCwgYlkpIHtcbiAgICAgIGlmIChiWCA9PT0gdW5kZWZpbmVkKSBiWCA9IDA7XG4gICAgICBpZiAoYlkgPT09IHVuZGVmaW5lZCkgYlkgPSAwO1xuICAgICAgdmFyIGExMSA9IHRoaXMuY29sMS54O1xuICAgICAgdmFyIGExMiA9IHRoaXMuY29sMi54O1xuICAgICAgdmFyIGEyMSA9IHRoaXMuY29sMS55O1xuICAgICAgdmFyIGEyMiA9IHRoaXMuY29sMi55O1xuICAgICAgdmFyIGRldCA9IGExMSAqIGEyMiAtIGExMiAqIGEyMTtcbiAgICAgIGlmIChkZXQgIT0gMC4wKSB7XG4gICAgICAgICBkZXQgPSAxLjAgLyBkZXQ7XG4gICAgICB9XG4gICAgICBvdXQueCA9IGRldCAqIChhMjIgKiBiWCAtIGExMiAqIGJZKTtcbiAgICAgIG91dC55ID0gZGV0ICogKGExMSAqIGJZIC0gYTIxICogYlgpO1xuICAgICAgcmV0dXJuIG91dDtcbiAgIH1cbiAgIGIyTWF0MjIucHJvdG90eXBlLkFicyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuY29sMS5BYnMoKTtcbiAgICAgIHRoaXMuY29sMi5BYnMoKTtcbiAgIH1cbiAgIGIyTWF0MzMuYjJNYXQzMyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuY29sMSA9IG5ldyBiMlZlYzMoKTtcbiAgICAgIHRoaXMuY29sMiA9IG5ldyBiMlZlYzMoKTtcbiAgICAgIHRoaXMuY29sMyA9IG5ldyBiMlZlYzMoKTtcbiAgIH07XG4gICBiMk1hdDMzLnByb3RvdHlwZS5iMk1hdDMzID0gZnVuY3Rpb24gKGMxLCBjMiwgYzMpIHtcbiAgICAgIGlmIChjMSA9PT0gdW5kZWZpbmVkKSBjMSA9IG51bGw7XG4gICAgICBpZiAoYzIgPT09IHVuZGVmaW5lZCkgYzIgPSBudWxsO1xuICAgICAgaWYgKGMzID09PSB1bmRlZmluZWQpIGMzID0gbnVsbDtcbiAgICAgIGlmICghYzEgJiYgIWMyICYmICFjMykge1xuICAgICAgICAgdGhpcy5jb2wxLlNldFplcm8oKTtcbiAgICAgICAgIHRoaXMuY29sMi5TZXRaZXJvKCk7XG4gICAgICAgICB0aGlzLmNvbDMuU2V0WmVybygpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICB0aGlzLmNvbDEuU2V0VihjMSk7XG4gICAgICAgICB0aGlzLmNvbDIuU2V0VihjMik7XG4gICAgICAgICB0aGlzLmNvbDMuU2V0VihjMyk7XG4gICAgICB9XG4gICB9XG4gICBiMk1hdDMzLnByb3RvdHlwZS5TZXRWVlYgPSBmdW5jdGlvbiAoYzEsIGMyLCBjMykge1xuICAgICAgdGhpcy5jb2wxLlNldFYoYzEpO1xuICAgICAgdGhpcy5jb2wyLlNldFYoYzIpO1xuICAgICAgdGhpcy5jb2wzLlNldFYoYzMpO1xuICAgfVxuICAgYjJNYXQzMy5wcm90b3R5cGUuQ29weSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBuZXcgYjJNYXQzMyh0aGlzLmNvbDEsIHRoaXMuY29sMiwgdGhpcy5jb2wzKTtcbiAgIH1cbiAgIGIyTWF0MzMucHJvdG90eXBlLlNldE0gPSBmdW5jdGlvbiAobSkge1xuICAgICAgdGhpcy5jb2wxLlNldFYobS5jb2wxKTtcbiAgICAgIHRoaXMuY29sMi5TZXRWKG0uY29sMik7XG4gICAgICB0aGlzLmNvbDMuU2V0VihtLmNvbDMpO1xuICAgfVxuICAgYjJNYXQzMy5wcm90b3R5cGUuQWRkTSA9IGZ1bmN0aW9uIChtKSB7XG4gICAgICB0aGlzLmNvbDEueCArPSBtLmNvbDEueDtcbiAgICAgIHRoaXMuY29sMS55ICs9IG0uY29sMS55O1xuICAgICAgdGhpcy5jb2wxLnogKz0gbS5jb2wxLno7XG4gICAgICB0aGlzLmNvbDIueCArPSBtLmNvbDIueDtcbiAgICAgIHRoaXMuY29sMi55ICs9IG0uY29sMi55O1xuICAgICAgdGhpcy5jb2wyLnogKz0gbS5jb2wyLno7XG4gICAgICB0aGlzLmNvbDMueCArPSBtLmNvbDMueDtcbiAgICAgIHRoaXMuY29sMy55ICs9IG0uY29sMy55O1xuICAgICAgdGhpcy5jb2wzLnogKz0gbS5jb2wzLno7XG4gICB9XG4gICBiMk1hdDMzLnByb3RvdHlwZS5TZXRJZGVudGl0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuY29sMS54ID0gMS4wO1xuICAgICAgdGhpcy5jb2wyLnggPSAwLjA7XG4gICAgICB0aGlzLmNvbDMueCA9IDAuMDtcbiAgICAgIHRoaXMuY29sMS55ID0gMC4wO1xuICAgICAgdGhpcy5jb2wyLnkgPSAxLjA7XG4gICAgICB0aGlzLmNvbDMueSA9IDAuMDtcbiAgICAgIHRoaXMuY29sMS56ID0gMC4wO1xuICAgICAgdGhpcy5jb2wyLnogPSAwLjA7XG4gICAgICB0aGlzLmNvbDMueiA9IDEuMDtcbiAgIH1cbiAgIGIyTWF0MzMucHJvdG90eXBlLlNldFplcm8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmNvbDEueCA9IDAuMDtcbiAgICAgIHRoaXMuY29sMi54ID0gMC4wO1xuICAgICAgdGhpcy5jb2wzLnggPSAwLjA7XG4gICAgICB0aGlzLmNvbDEueSA9IDAuMDtcbiAgICAgIHRoaXMuY29sMi55ID0gMC4wO1xuICAgICAgdGhpcy5jb2wzLnkgPSAwLjA7XG4gICAgICB0aGlzLmNvbDEueiA9IDAuMDtcbiAgICAgIHRoaXMuY29sMi56ID0gMC4wO1xuICAgICAgdGhpcy5jb2wzLnogPSAwLjA7XG4gICB9XG4gICBiMk1hdDMzLnByb3RvdHlwZS5Tb2x2ZTIyID0gZnVuY3Rpb24gKG91dCwgYlgsIGJZKSB7XG4gICAgICBpZiAoYlggPT09IHVuZGVmaW5lZCkgYlggPSAwO1xuICAgICAgaWYgKGJZID09PSB1bmRlZmluZWQpIGJZID0gMDtcbiAgICAgIHZhciBhMTEgPSB0aGlzLmNvbDEueDtcbiAgICAgIHZhciBhMTIgPSB0aGlzLmNvbDIueDtcbiAgICAgIHZhciBhMjEgPSB0aGlzLmNvbDEueTtcbiAgICAgIHZhciBhMjIgPSB0aGlzLmNvbDIueTtcbiAgICAgIHZhciBkZXQgPSBhMTEgKiBhMjIgLSBhMTIgKiBhMjE7XG4gICAgICBpZiAoZGV0ICE9IDAuMCkge1xuICAgICAgICAgZGV0ID0gMS4wIC8gZGV0O1xuICAgICAgfVxuICAgICAgb3V0LnggPSBkZXQgKiAoYTIyICogYlggLSBhMTIgKiBiWSk7XG4gICAgICBvdXQueSA9IGRldCAqIChhMTEgKiBiWSAtIGEyMSAqIGJYKTtcbiAgICAgIHJldHVybiBvdXQ7XG4gICB9XG4gICBiMk1hdDMzLnByb3RvdHlwZS5Tb2x2ZTMzID0gZnVuY3Rpb24gKG91dCwgYlgsIGJZLCBiWikge1xuICAgICAgaWYgKGJYID09PSB1bmRlZmluZWQpIGJYID0gMDtcbiAgICAgIGlmIChiWSA9PT0gdW5kZWZpbmVkKSBiWSA9IDA7XG4gICAgICBpZiAoYlogPT09IHVuZGVmaW5lZCkgYlogPSAwO1xuICAgICAgdmFyIGExMSA9IHRoaXMuY29sMS54O1xuICAgICAgdmFyIGEyMSA9IHRoaXMuY29sMS55O1xuICAgICAgdmFyIGEzMSA9IHRoaXMuY29sMS56O1xuICAgICAgdmFyIGExMiA9IHRoaXMuY29sMi54O1xuICAgICAgdmFyIGEyMiA9IHRoaXMuY29sMi55O1xuICAgICAgdmFyIGEzMiA9IHRoaXMuY29sMi56O1xuICAgICAgdmFyIGExMyA9IHRoaXMuY29sMy54O1xuICAgICAgdmFyIGEyMyA9IHRoaXMuY29sMy55O1xuICAgICAgdmFyIGEzMyA9IHRoaXMuY29sMy56O1xuICAgICAgdmFyIGRldCA9IGExMSAqIChhMjIgKiBhMzMgLSBhMzIgKiBhMjMpICsgYTIxICogKGEzMiAqIGExMyAtIGExMiAqIGEzMykgKyBhMzEgKiAoYTEyICogYTIzIC0gYTIyICogYTEzKTtcbiAgICAgIGlmIChkZXQgIT0gMC4wKSB7XG4gICAgICAgICBkZXQgPSAxLjAgLyBkZXQ7XG4gICAgICB9XG4gICAgICBvdXQueCA9IGRldCAqIChiWCAqIChhMjIgKiBhMzMgLSBhMzIgKiBhMjMpICsgYlkgKiAoYTMyICogYTEzIC0gYTEyICogYTMzKSArIGJaICogKGExMiAqIGEyMyAtIGEyMiAqIGExMykpO1xuICAgICAgb3V0LnkgPSBkZXQgKiAoYTExICogKGJZICogYTMzIC0gYlogKiBhMjMpICsgYTIxICogKGJaICogYTEzIC0gYlggKiBhMzMpICsgYTMxICogKGJYICogYTIzIC0gYlkgKiBhMTMpKTtcbiAgICAgIG91dC56ID0gZGV0ICogKGExMSAqIChhMjIgKiBiWiAtIGEzMiAqIGJZKSArIGEyMSAqIChhMzIgKiBiWCAtIGExMiAqIGJaKSArIGEzMSAqIChhMTIgKiBiWSAtIGEyMiAqIGJYKSk7XG4gICAgICByZXR1cm4gb3V0O1xuICAgfVxuICAgYjJNYXRoLmIyTWF0aCA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJNYXRoLklzVmFsaWQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgaWYgKHggPT09IHVuZGVmaW5lZCkgeCA9IDA7XG4gICAgICByZXR1cm4gaXNGaW5pdGUoeCk7XG4gICB9XG4gICBiMk1hdGguRG90ID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHJldHVybiBhLnggKiBiLnggKyBhLnkgKiBiLnk7XG4gICB9XG4gICBiMk1hdGguQ3Jvc3NWViA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICByZXR1cm4gYS54ICogYi55IC0gYS55ICogYi54O1xuICAgfVxuICAgYjJNYXRoLkNyb3NzVkYgPSBmdW5jdGlvbiAoYSwgcykge1xuICAgICAgaWYgKHMgPT09IHVuZGVmaW5lZCkgcyA9IDA7XG4gICAgICB2YXIgdiA9IG5ldyBiMlZlYzIocyAqIGEueSwgKC1zICogYS54KSk7XG4gICAgICByZXR1cm4gdjtcbiAgIH1cbiAgIGIyTWF0aC5Dcm9zc0ZWID0gZnVuY3Rpb24gKHMsIGEpIHtcbiAgICAgIGlmIChzID09PSB1bmRlZmluZWQpIHMgPSAwO1xuICAgICAgdmFyIHYgPSBuZXcgYjJWZWMyKCgtcyAqIGEueSksIHMgKiBhLngpO1xuICAgICAgcmV0dXJuIHY7XG4gICB9XG4gICBiMk1hdGguTXVsTVYgPSBmdW5jdGlvbiAoQSwgdikge1xuICAgICAgdmFyIHUgPSBuZXcgYjJWZWMyKEEuY29sMS54ICogdi54ICsgQS5jb2wyLnggKiB2LnksIEEuY29sMS55ICogdi54ICsgQS5jb2wyLnkgKiB2LnkpO1xuICAgICAgcmV0dXJuIHU7XG4gICB9XG4gICBiMk1hdGguTXVsVE1WID0gZnVuY3Rpb24gKEEsIHYpIHtcbiAgICAgIHZhciB1ID0gbmV3IGIyVmVjMihiMk1hdGguRG90KHYsIEEuY29sMSksIGIyTWF0aC5Eb3QodiwgQS5jb2wyKSk7XG4gICAgICByZXR1cm4gdTtcbiAgIH1cbiAgIGIyTWF0aC5NdWxYID0gZnVuY3Rpb24gKFQsIHYpIHtcbiAgICAgIHZhciBhID0gYjJNYXRoLk11bE1WKFQuUiwgdik7XG4gICAgICBhLnggKz0gVC5wb3NpdGlvbi54O1xuICAgICAgYS55ICs9IFQucG9zaXRpb24ueTtcbiAgICAgIHJldHVybiBhO1xuICAgfVxuICAgYjJNYXRoLk11bFhUID0gZnVuY3Rpb24gKFQsIHYpIHtcbiAgICAgIHZhciBhID0gYjJNYXRoLlN1YnRyYWN0VlYodiwgVC5wb3NpdGlvbik7XG4gICAgICB2YXIgdFggPSAoYS54ICogVC5SLmNvbDEueCArIGEueSAqIFQuUi5jb2wxLnkpO1xuICAgICAgYS55ID0gKGEueCAqIFQuUi5jb2wyLnggKyBhLnkgKiBULlIuY29sMi55KTtcbiAgICAgIGEueCA9IHRYO1xuICAgICAgcmV0dXJuIGE7XG4gICB9XG4gICBiMk1hdGguQWRkVlYgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgdmFyIHYgPSBuZXcgYjJWZWMyKGEueCArIGIueCwgYS55ICsgYi55KTtcbiAgICAgIHJldHVybiB2O1xuICAgfVxuICAgYjJNYXRoLlN1YnRyYWN0VlYgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgdmFyIHYgPSBuZXcgYjJWZWMyKGEueCAtIGIueCwgYS55IC0gYi55KTtcbiAgICAgIHJldHVybiB2O1xuICAgfVxuICAgYjJNYXRoLkRpc3RhbmNlID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHZhciBjWCA9IGEueCAtIGIueDtcbiAgICAgIHZhciBjWSA9IGEueSAtIGIueTtcbiAgICAgIHJldHVybiBNYXRoLnNxcnQoY1ggKiBjWCArIGNZICogY1kpO1xuICAgfVxuICAgYjJNYXRoLkRpc3RhbmNlU3F1YXJlZCA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICB2YXIgY1ggPSBhLnggLSBiLng7XG4gICAgICB2YXIgY1kgPSBhLnkgLSBiLnk7XG4gICAgICByZXR1cm4gKGNYICogY1ggKyBjWSAqIGNZKTtcbiAgIH1cbiAgIGIyTWF0aC5NdWxGViA9IGZ1bmN0aW9uIChzLCBhKSB7XG4gICAgICBpZiAocyA9PT0gdW5kZWZpbmVkKSBzID0gMDtcbiAgICAgIHZhciB2ID0gbmV3IGIyVmVjMihzICogYS54LCBzICogYS55KTtcbiAgICAgIHJldHVybiB2O1xuICAgfVxuICAgYjJNYXRoLkFkZE1NID0gZnVuY3Rpb24gKEEsIEIpIHtcbiAgICAgIHZhciBDID0gYjJNYXQyMi5Gcm9tVlYoYjJNYXRoLkFkZFZWKEEuY29sMSwgQi5jb2wxKSwgYjJNYXRoLkFkZFZWKEEuY29sMiwgQi5jb2wyKSk7XG4gICAgICByZXR1cm4gQztcbiAgIH1cbiAgIGIyTWF0aC5NdWxNTSA9IGZ1bmN0aW9uIChBLCBCKSB7XG4gICAgICB2YXIgQyA9IGIyTWF0MjIuRnJvbVZWKGIyTWF0aC5NdWxNVihBLCBCLmNvbDEpLCBiMk1hdGguTXVsTVYoQSwgQi5jb2wyKSk7XG4gICAgICByZXR1cm4gQztcbiAgIH1cbiAgIGIyTWF0aC5NdWxUTU0gPSBmdW5jdGlvbiAoQSwgQikge1xuICAgICAgdmFyIGMxID0gbmV3IGIyVmVjMihiMk1hdGguRG90KEEuY29sMSwgQi5jb2wxKSwgYjJNYXRoLkRvdChBLmNvbDIsIEIuY29sMSkpO1xuICAgICAgdmFyIGMyID0gbmV3IGIyVmVjMihiMk1hdGguRG90KEEuY29sMSwgQi5jb2wyKSwgYjJNYXRoLkRvdChBLmNvbDIsIEIuY29sMikpO1xuICAgICAgdmFyIEMgPSBiMk1hdDIyLkZyb21WVihjMSwgYzIpO1xuICAgICAgcmV0dXJuIEM7XG4gICB9XG4gICBiMk1hdGguQWJzID0gZnVuY3Rpb24gKGEpIHtcbiAgICAgIGlmIChhID09PSB1bmRlZmluZWQpIGEgPSAwO1xuICAgICAgcmV0dXJuIGEgPiAwLjAgPyBhIDogKC1hKTtcbiAgIH1cbiAgIGIyTWF0aC5BYnNWID0gZnVuY3Rpb24gKGEpIHtcbiAgICAgIHZhciBiID0gbmV3IGIyVmVjMihiMk1hdGguQWJzKGEueCksIGIyTWF0aC5BYnMoYS55KSk7XG4gICAgICByZXR1cm4gYjtcbiAgIH1cbiAgIGIyTWF0aC5BYnNNID0gZnVuY3Rpb24gKEEpIHtcbiAgICAgIHZhciBCID0gYjJNYXQyMi5Gcm9tVlYoYjJNYXRoLkFic1YoQS5jb2wxKSwgYjJNYXRoLkFic1YoQS5jb2wyKSk7XG4gICAgICByZXR1cm4gQjtcbiAgIH1cbiAgIGIyTWF0aC5NaW4gPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgaWYgKGEgPT09IHVuZGVmaW5lZCkgYSA9IDA7XG4gICAgICBpZiAoYiA9PT0gdW5kZWZpbmVkKSBiID0gMDtcbiAgICAgIHJldHVybiBhIDwgYiA/IGEgOiBiO1xuICAgfVxuICAgYjJNYXRoLk1pblYgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgdmFyIGMgPSBuZXcgYjJWZWMyKGIyTWF0aC5NaW4oYS54LCBiLngpLCBiMk1hdGguTWluKGEueSwgYi55KSk7XG4gICAgICByZXR1cm4gYztcbiAgIH1cbiAgIGIyTWF0aC5NYXggPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgaWYgKGEgPT09IHVuZGVmaW5lZCkgYSA9IDA7XG4gICAgICBpZiAoYiA9PT0gdW5kZWZpbmVkKSBiID0gMDtcbiAgICAgIHJldHVybiBhID4gYiA/IGEgOiBiO1xuICAgfVxuICAgYjJNYXRoLk1heFYgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgdmFyIGMgPSBuZXcgYjJWZWMyKGIyTWF0aC5NYXgoYS54LCBiLngpLCBiMk1hdGguTWF4KGEueSwgYi55KSk7XG4gICAgICByZXR1cm4gYztcbiAgIH1cbiAgIGIyTWF0aC5DbGFtcCA9IGZ1bmN0aW9uIChhLCBsb3csIGhpZ2gpIHtcbiAgICAgIGlmIChhID09PSB1bmRlZmluZWQpIGEgPSAwO1xuICAgICAgaWYgKGxvdyA9PT0gdW5kZWZpbmVkKSBsb3cgPSAwO1xuICAgICAgaWYgKGhpZ2ggPT09IHVuZGVmaW5lZCkgaGlnaCA9IDA7XG4gICAgICByZXR1cm4gYSA8IGxvdyA/IGxvdyA6IGEgPiBoaWdoID8gaGlnaCA6IGE7XG4gICB9XG4gICBiMk1hdGguQ2xhbXBWID0gZnVuY3Rpb24gKGEsIGxvdywgaGlnaCkge1xuICAgICAgcmV0dXJuIGIyTWF0aC5NYXhWKGxvdywgYjJNYXRoLk1pblYoYSwgaGlnaCkpO1xuICAgfVxuICAgYjJNYXRoLlN3YXAgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgdmFyIHRtcCA9IGFbMF07XG4gICAgICBhWzBdID0gYlswXTtcbiAgICAgIGJbMF0gPSB0bXA7XG4gICB9XG4gICBiMk1hdGguUmFuZG9tID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKCkgKiAyIC0gMTtcbiAgIH1cbiAgIGIyTWF0aC5SYW5kb21SYW5nZSA9IGZ1bmN0aW9uIChsbywgaGkpIHtcbiAgICAgIGlmIChsbyA9PT0gdW5kZWZpbmVkKSBsbyA9IDA7XG4gICAgICBpZiAoaGkgPT09IHVuZGVmaW5lZCkgaGkgPSAwO1xuICAgICAgdmFyIHIgPSBNYXRoLnJhbmRvbSgpO1xuICAgICAgciA9IChoaSAtIGxvKSAqIHIgKyBsbztcbiAgICAgIHJldHVybiByO1xuICAgfVxuICAgYjJNYXRoLk5leHRQb3dlck9mVHdvID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIGlmICh4ID09PSB1bmRlZmluZWQpIHggPSAwO1xuICAgICAgeCB8PSAoeCA+PiAxKSAmIDB4N0ZGRkZGRkY7XG4gICAgICB4IHw9ICh4ID4+IDIpICYgMHgzRkZGRkZGRjtcbiAgICAgIHggfD0gKHggPj4gNCkgJiAweDBGRkZGRkZGO1xuICAgICAgeCB8PSAoeCA+PiA4KSAmIDB4MDBGRkZGRkY7XG4gICAgICB4IHw9ICh4ID4+IDE2KSAmIDB4MDAwMEZGRkY7XG4gICAgICByZXR1cm4geCArIDE7XG4gICB9XG4gICBiMk1hdGguSXNQb3dlck9mVHdvID0gZnVuY3Rpb24gKHgpIHtcbiAgICAgIGlmICh4ID09PSB1bmRlZmluZWQpIHggPSAwO1xuICAgICAgdmFyIHJlc3VsdCA9IHggPiAwICYmICh4ICYgKHggLSAxKSkgPT0gMDtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICB9XG4gICBCb3gyRC5wb3N0RGVmcy5wdXNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkNvbW1vbi5NYXRoLmIyTWF0aC5iMlZlYzJfemVybyA9IG5ldyBiMlZlYzIoMC4wLCAwLjApO1xuICAgICAgQm94MkQuQ29tbW9uLk1hdGguYjJNYXRoLmIyTWF0MjJfaWRlbnRpdHkgPSBiMk1hdDIyLkZyb21WVihuZXcgYjJWZWMyKDEuMCwgMC4wKSwgbmV3IGIyVmVjMigwLjAsIDEuMCkpO1xuICAgICAgQm94MkQuQ29tbW9uLk1hdGguYjJNYXRoLmIyVHJhbnNmb3JtX2lkZW50aXR5ID0gbmV3IGIyVHJhbnNmb3JtKGIyTWF0aC5iMlZlYzJfemVybywgYjJNYXRoLmIyTWF0MjJfaWRlbnRpdHkpO1xuICAgfSk7XG4gICBiMlN3ZWVwLmIyU3dlZXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmxvY2FsQ2VudGVyID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5jMCA9IG5ldyBiMlZlYzI7XG4gICAgICB0aGlzLmMgPSBuZXcgYjJWZWMyKCk7XG4gICB9O1xuICAgYjJTd2VlcC5wcm90b3R5cGUuU2V0ID0gZnVuY3Rpb24gKG90aGVyKSB7XG4gICAgICB0aGlzLmxvY2FsQ2VudGVyLlNldFYob3RoZXIubG9jYWxDZW50ZXIpO1xuICAgICAgdGhpcy5jMC5TZXRWKG90aGVyLmMwKTtcbiAgICAgIHRoaXMuYy5TZXRWKG90aGVyLmMpO1xuICAgICAgdGhpcy5hMCA9IG90aGVyLmEwO1xuICAgICAgdGhpcy5hID0gb3RoZXIuYTtcbiAgICAgIHRoaXMudDAgPSBvdGhlci50MDtcbiAgIH1cbiAgIGIyU3dlZXAucHJvdG90eXBlLkNvcHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgY29weSA9IG5ldyBiMlN3ZWVwKCk7XG4gICAgICBjb3B5LmxvY2FsQ2VudGVyLlNldFYodGhpcy5sb2NhbENlbnRlcik7XG4gICAgICBjb3B5LmMwLlNldFYodGhpcy5jMCk7XG4gICAgICBjb3B5LmMuU2V0Vih0aGlzLmMpO1xuICAgICAgY29weS5hMCA9IHRoaXMuYTA7XG4gICAgICBjb3B5LmEgPSB0aGlzLmE7XG4gICAgICBjb3B5LnQwID0gdGhpcy50MDtcbiAgICAgIHJldHVybiBjb3B5O1xuICAgfVxuICAgYjJTd2VlcC5wcm90b3R5cGUuR2V0VHJhbnNmb3JtID0gZnVuY3Rpb24gKHhmLCBhbHBoYSkge1xuICAgICAgaWYgKGFscGhhID09PSB1bmRlZmluZWQpIGFscGhhID0gMDtcbiAgICAgIHhmLnBvc2l0aW9uLnggPSAoMS4wIC0gYWxwaGEpICogdGhpcy5jMC54ICsgYWxwaGEgKiB0aGlzLmMueDtcbiAgICAgIHhmLnBvc2l0aW9uLnkgPSAoMS4wIC0gYWxwaGEpICogdGhpcy5jMC55ICsgYWxwaGEgKiB0aGlzLmMueTtcbiAgICAgIHZhciBhbmdsZSA9ICgxLjAgLSBhbHBoYSkgKiB0aGlzLmEwICsgYWxwaGEgKiB0aGlzLmE7XG4gICAgICB4Zi5SLlNldChhbmdsZSk7XG4gICAgICB2YXIgdE1hdCA9IHhmLlI7XG4gICAgICB4Zi5wb3NpdGlvbi54IC09ICh0TWF0LmNvbDEueCAqIHRoaXMubG9jYWxDZW50ZXIueCArIHRNYXQuY29sMi54ICogdGhpcy5sb2NhbENlbnRlci55KTtcbiAgICAgIHhmLnBvc2l0aW9uLnkgLT0gKHRNYXQuY29sMS55ICogdGhpcy5sb2NhbENlbnRlci54ICsgdE1hdC5jb2wyLnkgKiB0aGlzLmxvY2FsQ2VudGVyLnkpO1xuICAgfVxuICAgYjJTd2VlcC5wcm90b3R5cGUuQWR2YW5jZSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICBpZiAodCA9PT0gdW5kZWZpbmVkKSB0ID0gMDtcbiAgICAgIGlmICh0aGlzLnQwIDwgdCAmJiAxLjAgLSB0aGlzLnQwID4gTnVtYmVyLk1JTl9WQUxVRSkge1xuICAgICAgICAgdmFyIGFscGhhID0gKHQgLSB0aGlzLnQwKSAvICgxLjAgLSB0aGlzLnQwKTtcbiAgICAgICAgIHRoaXMuYzAueCA9ICgxLjAgLSBhbHBoYSkgKiB0aGlzLmMwLnggKyBhbHBoYSAqIHRoaXMuYy54O1xuICAgICAgICAgdGhpcy5jMC55ID0gKDEuMCAtIGFscGhhKSAqIHRoaXMuYzAueSArIGFscGhhICogdGhpcy5jLnk7XG4gICAgICAgICB0aGlzLmEwID0gKDEuMCAtIGFscGhhKSAqIHRoaXMuYTAgKyBhbHBoYSAqIHRoaXMuYTtcbiAgICAgICAgIHRoaXMudDAgPSB0O1xuICAgICAgfVxuICAgfVxuICAgYjJUcmFuc2Zvcm0uYjJUcmFuc2Zvcm0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnBvc2l0aW9uID0gbmV3IGIyVmVjMjtcbiAgICAgIHRoaXMuUiA9IG5ldyBiMk1hdDIyKCk7XG4gICB9O1xuICAgYjJUcmFuc2Zvcm0ucHJvdG90eXBlLmIyVHJhbnNmb3JtID0gZnVuY3Rpb24gKHBvcywgcikge1xuICAgICAgaWYgKHBvcyA9PT0gdW5kZWZpbmVkKSBwb3MgPSBudWxsO1xuICAgICAgaWYgKHIgPT09IHVuZGVmaW5lZCkgciA9IG51bGw7XG4gICAgICBpZiAocG9zKSB7XG4gICAgICAgICB0aGlzLnBvc2l0aW9uLlNldFYocG9zKTtcbiAgICAgICAgIHRoaXMuUi5TZXRNKHIpO1xuICAgICAgfVxuICAgfVxuICAgYjJUcmFuc2Zvcm0ucHJvdG90eXBlLkluaXRpYWxpemUgPSBmdW5jdGlvbiAocG9zLCByKSB7XG4gICAgICB0aGlzLnBvc2l0aW9uLlNldFYocG9zKTtcbiAgICAgIHRoaXMuUi5TZXRNKHIpO1xuICAgfVxuICAgYjJUcmFuc2Zvcm0ucHJvdG90eXBlLlNldElkZW50aXR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5wb3NpdGlvbi5TZXRaZXJvKCk7XG4gICAgICB0aGlzLlIuU2V0SWRlbnRpdHkoKTtcbiAgIH1cbiAgIGIyVHJhbnNmb3JtLnByb3RvdHlwZS5TZXQgPSBmdW5jdGlvbiAoeCkge1xuICAgICAgdGhpcy5wb3NpdGlvbi5TZXRWKHgucG9zaXRpb24pO1xuICAgICAgdGhpcy5SLlNldE0oeC5SKTtcbiAgIH1cbiAgIGIyVHJhbnNmb3JtLnByb3RvdHlwZS5HZXRBbmdsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBNYXRoLmF0YW4yKHRoaXMuUi5jb2wxLnksIHRoaXMuUi5jb2wxLngpO1xuICAgfVxuICAgYjJWZWMyLmIyVmVjMiA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJWZWMyLnByb3RvdHlwZS5iMlZlYzIgPSBmdW5jdGlvbiAoeF8sIHlfKSB7XG4gICAgICBpZiAoeF8gPT09IHVuZGVmaW5lZCkgeF8gPSAwO1xuICAgICAgaWYgKHlfID09PSB1bmRlZmluZWQpIHlfID0gMDtcbiAgICAgIHRoaXMueCA9IHhfO1xuICAgICAgdGhpcy55ID0geV87XG4gICB9XG4gICBiMlZlYzIucHJvdG90eXBlLlNldFplcm8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnggPSAwLjA7XG4gICAgICB0aGlzLnkgPSAwLjA7XG4gICB9XG4gICBiMlZlYzIucHJvdG90eXBlLlNldCA9IGZ1bmN0aW9uICh4XywgeV8pIHtcbiAgICAgIGlmICh4XyA9PT0gdW5kZWZpbmVkKSB4XyA9IDA7XG4gICAgICBpZiAoeV8gPT09IHVuZGVmaW5lZCkgeV8gPSAwO1xuICAgICAgdGhpcy54ID0geF87XG4gICAgICB0aGlzLnkgPSB5XztcbiAgIH1cbiAgIGIyVmVjMi5wcm90b3R5cGUuU2V0ViA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICB0aGlzLnggPSB2Lng7XG4gICAgICB0aGlzLnkgPSB2Lnk7XG4gICB9XG4gICBiMlZlYzIucHJvdG90eXBlLkdldE5lZ2F0aXZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIG5ldyBiMlZlYzIoKC10aGlzLngpLCAoLXRoaXMueSkpO1xuICAgfVxuICAgYjJWZWMyLnByb3RvdHlwZS5OZWdhdGl2ZVNlbGYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnggPSAoLXRoaXMueCk7XG4gICAgICB0aGlzLnkgPSAoLXRoaXMueSk7XG4gICB9XG4gICBiMlZlYzIuTWFrZSA9IGZ1bmN0aW9uICh4XywgeV8pIHtcbiAgICAgIGlmICh4XyA9PT0gdW5kZWZpbmVkKSB4XyA9IDA7XG4gICAgICBpZiAoeV8gPT09IHVuZGVmaW5lZCkgeV8gPSAwO1xuICAgICAgcmV0dXJuIG5ldyBiMlZlYzIoeF8sIHlfKTtcbiAgIH1cbiAgIGIyVmVjMi5wcm90b3R5cGUuQ29weSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBuZXcgYjJWZWMyKHRoaXMueCwgdGhpcy55KTtcbiAgIH1cbiAgIGIyVmVjMi5wcm90b3R5cGUuQWRkID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgIHRoaXMueCArPSB2Lng7XG4gICAgICB0aGlzLnkgKz0gdi55O1xuICAgfVxuICAgYjJWZWMyLnByb3RvdHlwZS5TdWJ0cmFjdCA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICB0aGlzLnggLT0gdi54O1xuICAgICAgdGhpcy55IC09IHYueTtcbiAgIH1cbiAgIGIyVmVjMi5wcm90b3R5cGUuTXVsdGlwbHkgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgaWYgKGEgPT09IHVuZGVmaW5lZCkgYSA9IDA7XG4gICAgICB0aGlzLnggKj0gYTtcbiAgICAgIHRoaXMueSAqPSBhO1xuICAgfVxuICAgYjJWZWMyLnByb3RvdHlwZS5NdWxNID0gZnVuY3Rpb24gKEEpIHtcbiAgICAgIHZhciB0WCA9IHRoaXMueDtcbiAgICAgIHRoaXMueCA9IEEuY29sMS54ICogdFggKyBBLmNvbDIueCAqIHRoaXMueTtcbiAgICAgIHRoaXMueSA9IEEuY29sMS55ICogdFggKyBBLmNvbDIueSAqIHRoaXMueTtcbiAgIH1cbiAgIGIyVmVjMi5wcm90b3R5cGUuTXVsVE0gPSBmdW5jdGlvbiAoQSkge1xuICAgICAgdmFyIHRYID0gYjJNYXRoLkRvdCh0aGlzLCBBLmNvbDEpO1xuICAgICAgdGhpcy55ID0gYjJNYXRoLkRvdCh0aGlzLCBBLmNvbDIpO1xuICAgICAgdGhpcy54ID0gdFg7XG4gICB9XG4gICBiMlZlYzIucHJvdG90eXBlLkNyb3NzVkYgPSBmdW5jdGlvbiAocykge1xuICAgICAgaWYgKHMgPT09IHVuZGVmaW5lZCkgcyA9IDA7XG4gICAgICB2YXIgdFggPSB0aGlzLng7XG4gICAgICB0aGlzLnggPSBzICogdGhpcy55O1xuICAgICAgdGhpcy55ID0gKC1zICogdFgpO1xuICAgfVxuICAgYjJWZWMyLnByb3RvdHlwZS5Dcm9zc0ZWID0gZnVuY3Rpb24gKHMpIHtcbiAgICAgIGlmIChzID09PSB1bmRlZmluZWQpIHMgPSAwO1xuICAgICAgdmFyIHRYID0gdGhpcy54O1xuICAgICAgdGhpcy54ID0gKC1zICogdGhpcy55KTtcbiAgICAgIHRoaXMueSA9IHMgKiB0WDtcbiAgIH1cbiAgIGIyVmVjMi5wcm90b3R5cGUuTWluViA9IGZ1bmN0aW9uIChiKSB7XG4gICAgICB0aGlzLnggPSB0aGlzLnggPCBiLnggPyB0aGlzLnggOiBiLng7XG4gICAgICB0aGlzLnkgPSB0aGlzLnkgPCBiLnkgPyB0aGlzLnkgOiBiLnk7XG4gICB9XG4gICBiMlZlYzIucHJvdG90eXBlLk1heFYgPSBmdW5jdGlvbiAoYikge1xuICAgICAgdGhpcy54ID0gdGhpcy54ID4gYi54ID8gdGhpcy54IDogYi54O1xuICAgICAgdGhpcy55ID0gdGhpcy55ID4gYi55ID8gdGhpcy55IDogYi55O1xuICAgfVxuICAgYjJWZWMyLnByb3RvdHlwZS5BYnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy54IDwgMCkgdGhpcy54ID0gKC10aGlzLngpO1xuICAgICAgaWYgKHRoaXMueSA8IDApIHRoaXMueSA9ICgtdGhpcy55KTtcbiAgIH1cbiAgIGIyVmVjMi5wcm90b3R5cGUuTGVuZ3RoID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkpO1xuICAgfVxuICAgYjJWZWMyLnByb3RvdHlwZS5MZW5ndGhTcXVhcmVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuICh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkpO1xuICAgfVxuICAgYjJWZWMyLnByb3RvdHlwZS5Ob3JtYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbGVuZ3RoID0gTWF0aC5zcXJ0KHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSk7XG4gICAgICBpZiAobGVuZ3RoIDwgTnVtYmVyLk1JTl9WQUxVRSkge1xuICAgICAgICAgcmV0dXJuIDAuMDtcbiAgICAgIH1cbiAgICAgIHZhciBpbnZMZW5ndGggPSAxLjAgLyBsZW5ndGg7XG4gICAgICB0aGlzLnggKj0gaW52TGVuZ3RoO1xuICAgICAgdGhpcy55ICo9IGludkxlbmd0aDtcbiAgICAgIHJldHVybiBsZW5ndGg7XG4gICB9XG4gICBiMlZlYzIucHJvdG90eXBlLklzVmFsaWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gYjJNYXRoLklzVmFsaWQodGhpcy54KSAmJiBiMk1hdGguSXNWYWxpZCh0aGlzLnkpO1xuICAgfVxuICAgYjJWZWMzLmIyVmVjMyA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJWZWMzLnByb3RvdHlwZS5iMlZlYzMgPSBmdW5jdGlvbiAoeCwgeSwgeikge1xuICAgICAgaWYgKHggPT09IHVuZGVmaW5lZCkgeCA9IDA7XG4gICAgICBpZiAoeSA9PT0gdW5kZWZpbmVkKSB5ID0gMDtcbiAgICAgIGlmICh6ID09PSB1bmRlZmluZWQpIHogPSAwO1xuICAgICAgdGhpcy54ID0geDtcbiAgICAgIHRoaXMueSA9IHk7XG4gICAgICB0aGlzLnogPSB6O1xuICAgfVxuICAgYjJWZWMzLnByb3RvdHlwZS5TZXRaZXJvID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy54ID0gdGhpcy55ID0gdGhpcy56ID0gMC4wO1xuICAgfVxuICAgYjJWZWMzLnByb3RvdHlwZS5TZXQgPSBmdW5jdGlvbiAoeCwgeSwgeikge1xuICAgICAgaWYgKHggPT09IHVuZGVmaW5lZCkgeCA9IDA7XG4gICAgICBpZiAoeSA9PT0gdW5kZWZpbmVkKSB5ID0gMDtcbiAgICAgIGlmICh6ID09PSB1bmRlZmluZWQpIHogPSAwO1xuICAgICAgdGhpcy54ID0geDtcbiAgICAgIHRoaXMueSA9IHk7XG4gICAgICB0aGlzLnogPSB6O1xuICAgfVxuICAgYjJWZWMzLnByb3RvdHlwZS5TZXRWID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgIHRoaXMueCA9IHYueDtcbiAgICAgIHRoaXMueSA9IHYueTtcbiAgICAgIHRoaXMueiA9IHYuejtcbiAgIH1cbiAgIGIyVmVjMy5wcm90b3R5cGUuR2V0TmVnYXRpdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gbmV3IGIyVmVjMygoLXRoaXMueCksICgtdGhpcy55KSwgKC10aGlzLnopKTtcbiAgIH1cbiAgIGIyVmVjMy5wcm90b3R5cGUuTmVnYXRpdmVTZWxmID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy54ID0gKC10aGlzLngpO1xuICAgICAgdGhpcy55ID0gKC10aGlzLnkpO1xuICAgICAgdGhpcy56ID0gKC10aGlzLnopO1xuICAgfVxuICAgYjJWZWMzLnByb3RvdHlwZS5Db3B5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIG5ldyBiMlZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7XG4gICB9XG4gICBiMlZlYzMucHJvdG90eXBlLkFkZCA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICB0aGlzLnggKz0gdi54O1xuICAgICAgdGhpcy55ICs9IHYueTtcbiAgICAgIHRoaXMueiArPSB2Lno7XG4gICB9XG4gICBiMlZlYzMucHJvdG90eXBlLlN1YnRyYWN0ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgIHRoaXMueCAtPSB2Lng7XG4gICAgICB0aGlzLnkgLT0gdi55O1xuICAgICAgdGhpcy56IC09IHYuejtcbiAgIH1cbiAgIGIyVmVjMy5wcm90b3R5cGUuTXVsdGlwbHkgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgaWYgKGEgPT09IHVuZGVmaW5lZCkgYSA9IDA7XG4gICAgICB0aGlzLnggKj0gYTtcbiAgICAgIHRoaXMueSAqPSBhO1xuICAgICAgdGhpcy56ICo9IGE7XG4gICB9XG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcbiAgIHZhciBiMkNvbnRyb2xsZXJFZGdlID0gQm94MkQuRHluYW1pY3MuQ29udHJvbGxlcnMuYjJDb250cm9sbGVyRWRnZSxcbiAgICAgIGIyTWF0MjIgPSBCb3gyRC5Db21tb24uTWF0aC5iMk1hdDIyLFxuICAgICAgYjJNYXQzMyA9IEJveDJELkNvbW1vbi5NYXRoLmIyTWF0MzMsXG4gICAgICBiMk1hdGggPSBCb3gyRC5Db21tb24uTWF0aC5iMk1hdGgsXG4gICAgICBiMlN3ZWVwID0gQm94MkQuQ29tbW9uLk1hdGguYjJTd2VlcCxcbiAgICAgIGIyVHJhbnNmb3JtID0gQm94MkQuQ29tbW9uLk1hdGguYjJUcmFuc2Zvcm0sXG4gICAgICBiMlZlYzIgPSBCb3gyRC5Db21tb24uTWF0aC5iMlZlYzIsXG4gICAgICBiMlZlYzMgPSBCb3gyRC5Db21tb24uTWF0aC5iMlZlYzMsXG4gICAgICBiMkNvbG9yID0gQm94MkQuQ29tbW9uLmIyQ29sb3IsXG4gICAgICBiMmludGVybmFsID0gQm94MkQuQ29tbW9uLmIyaW50ZXJuYWwsXG4gICAgICBiMlNldHRpbmdzID0gQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MsXG4gICAgICBiMkFBQkIgPSBCb3gyRC5Db2xsaXNpb24uYjJBQUJCLFxuICAgICAgYjJCb3VuZCA9IEJveDJELkNvbGxpc2lvbi5iMkJvdW5kLFxuICAgICAgYjJCb3VuZFZhbHVlcyA9IEJveDJELkNvbGxpc2lvbi5iMkJvdW5kVmFsdWVzLFxuICAgICAgYjJDb2xsaXNpb24gPSBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24sXG4gICAgICBiMkNvbnRhY3RJRCA9IEJveDJELkNvbGxpc2lvbi5iMkNvbnRhY3RJRCxcbiAgICAgIGIyQ29udGFjdFBvaW50ID0gQm94MkQuQ29sbGlzaW9uLmIyQ29udGFjdFBvaW50LFxuICAgICAgYjJEaXN0YW5jZSA9IEJveDJELkNvbGxpc2lvbi5iMkRpc3RhbmNlLFxuICAgICAgYjJEaXN0YW5jZUlucHV0ID0gQm94MkQuQ29sbGlzaW9uLmIyRGlzdGFuY2VJbnB1dCxcbiAgICAgIGIyRGlzdGFuY2VPdXRwdXQgPSBCb3gyRC5Db2xsaXNpb24uYjJEaXN0YW5jZU91dHB1dCxcbiAgICAgIGIyRGlzdGFuY2VQcm94eSA9IEJveDJELkNvbGxpc2lvbi5iMkRpc3RhbmNlUHJveHksXG4gICAgICBiMkR5bmFtaWNUcmVlID0gQm94MkQuQ29sbGlzaW9uLmIyRHluYW1pY1RyZWUsXG4gICAgICBiMkR5bmFtaWNUcmVlQnJvYWRQaGFzZSA9IEJveDJELkNvbGxpc2lvbi5iMkR5bmFtaWNUcmVlQnJvYWRQaGFzZSxcbiAgICAgIGIyRHluYW1pY1RyZWVOb2RlID0gQm94MkQuQ29sbGlzaW9uLmIyRHluYW1pY1RyZWVOb2RlLFxuICAgICAgYjJEeW5hbWljVHJlZVBhaXIgPSBCb3gyRC5Db2xsaXNpb24uYjJEeW5hbWljVHJlZVBhaXIsXG4gICAgICBiMk1hbmlmb2xkID0gQm94MkQuQ29sbGlzaW9uLmIyTWFuaWZvbGQsXG4gICAgICBiMk1hbmlmb2xkUG9pbnQgPSBCb3gyRC5Db2xsaXNpb24uYjJNYW5pZm9sZFBvaW50LFxuICAgICAgYjJQb2ludCA9IEJveDJELkNvbGxpc2lvbi5iMlBvaW50LFxuICAgICAgYjJSYXlDYXN0SW5wdXQgPSBCb3gyRC5Db2xsaXNpb24uYjJSYXlDYXN0SW5wdXQsXG4gICAgICBiMlJheUNhc3RPdXRwdXQgPSBCb3gyRC5Db2xsaXNpb24uYjJSYXlDYXN0T3V0cHV0LFxuICAgICAgYjJTZWdtZW50ID0gQm94MkQuQ29sbGlzaW9uLmIyU2VnbWVudCxcbiAgICAgIGIyU2VwYXJhdGlvbkZ1bmN0aW9uID0gQm94MkQuQ29sbGlzaW9uLmIyU2VwYXJhdGlvbkZ1bmN0aW9uLFxuICAgICAgYjJTaW1wbGV4ID0gQm94MkQuQ29sbGlzaW9uLmIyU2ltcGxleCxcbiAgICAgIGIyU2ltcGxleENhY2hlID0gQm94MkQuQ29sbGlzaW9uLmIyU2ltcGxleENhY2hlLFxuICAgICAgYjJTaW1wbGV4VmVydGV4ID0gQm94MkQuQ29sbGlzaW9uLmIyU2ltcGxleFZlcnRleCxcbiAgICAgIGIyVGltZU9mSW1wYWN0ID0gQm94MkQuQ29sbGlzaW9uLmIyVGltZU9mSW1wYWN0LFxuICAgICAgYjJUT0lJbnB1dCA9IEJveDJELkNvbGxpc2lvbi5iMlRPSUlucHV0LFxuICAgICAgYjJXb3JsZE1hbmlmb2xkID0gQm94MkQuQ29sbGlzaW9uLmIyV29ybGRNYW5pZm9sZCxcbiAgICAgIENsaXBWZXJ0ZXggPSBCb3gyRC5Db2xsaXNpb24uQ2xpcFZlcnRleCxcbiAgICAgIEZlYXR1cmVzID0gQm94MkQuQ29sbGlzaW9uLkZlYXR1cmVzLFxuICAgICAgSUJyb2FkUGhhc2UgPSBCb3gyRC5Db2xsaXNpb24uSUJyb2FkUGhhc2UsXG4gICAgICBiMkNpcmNsZVNoYXBlID0gQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMkNpcmNsZVNoYXBlLFxuICAgICAgYjJFZGdlQ2hhaW5EZWYgPSBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyRWRnZUNoYWluRGVmLFxuICAgICAgYjJFZGdlU2hhcGUgPSBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyRWRnZVNoYXBlLFxuICAgICAgYjJNYXNzRGF0YSA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJNYXNzRGF0YSxcbiAgICAgIGIyUG9seWdvblNoYXBlID0gQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMlBvbHlnb25TaGFwZSxcbiAgICAgIGIyU2hhcGUgPSBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyU2hhcGUsXG4gICAgICBiMkJvZHkgPSBCb3gyRC5EeW5hbWljcy5iMkJvZHksXG4gICAgICBiMkJvZHlEZWYgPSBCb3gyRC5EeW5hbWljcy5iMkJvZHlEZWYsXG4gICAgICBiMkNvbnRhY3RGaWx0ZXIgPSBCb3gyRC5EeW5hbWljcy5iMkNvbnRhY3RGaWx0ZXIsXG4gICAgICBiMkNvbnRhY3RJbXB1bHNlID0gQm94MkQuRHluYW1pY3MuYjJDb250YWN0SW1wdWxzZSxcbiAgICAgIGIyQ29udGFjdExpc3RlbmVyID0gQm94MkQuRHluYW1pY3MuYjJDb250YWN0TGlzdGVuZXIsXG4gICAgICBiMkNvbnRhY3RNYW5hZ2VyID0gQm94MkQuRHluYW1pY3MuYjJDb250YWN0TWFuYWdlcixcbiAgICAgIGIyRGVidWdEcmF3ID0gQm94MkQuRHluYW1pY3MuYjJEZWJ1Z0RyYXcsXG4gICAgICBiMkRlc3RydWN0aW9uTGlzdGVuZXIgPSBCb3gyRC5EeW5hbWljcy5iMkRlc3RydWN0aW9uTGlzdGVuZXIsXG4gICAgICBiMkZpbHRlckRhdGEgPSBCb3gyRC5EeW5hbWljcy5iMkZpbHRlckRhdGEsXG4gICAgICBiMkZpeHR1cmUgPSBCb3gyRC5EeW5hbWljcy5iMkZpeHR1cmUsXG4gICAgICBiMkZpeHR1cmVEZWYgPSBCb3gyRC5EeW5hbWljcy5iMkZpeHR1cmVEZWYsXG4gICAgICBiMklzbGFuZCA9IEJveDJELkR5bmFtaWNzLmIySXNsYW5kLFxuICAgICAgYjJUaW1lU3RlcCA9IEJveDJELkR5bmFtaWNzLmIyVGltZVN0ZXAsXG4gICAgICBiMldvcmxkID0gQm94MkQuRHluYW1pY3MuYjJXb3JsZCxcbiAgICAgIGIyQ2lyY2xlQ29udGFjdCA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ2lyY2xlQ29udGFjdCxcbiAgICAgIGIyQ29udGFjdCA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdCxcbiAgICAgIGIyQ29udGFjdENvbnN0cmFpbnQgPSBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3RDb25zdHJhaW50LFxuICAgICAgYjJDb250YWN0Q29uc3RyYWludFBvaW50ID0gQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0Q29uc3RyYWludFBvaW50LFxuICAgICAgYjJDb250YWN0RWRnZSA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdEVkZ2UsXG4gICAgICBiMkNvbnRhY3RGYWN0b3J5ID0gQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0RmFjdG9yeSxcbiAgICAgIGIyQ29udGFjdFJlZ2lzdGVyID0gQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0UmVnaXN0ZXIsXG4gICAgICBiMkNvbnRhY3RSZXN1bHQgPSBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3RSZXN1bHQsXG4gICAgICBiMkNvbnRhY3RTb2x2ZXIgPSBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3RTb2x2ZXIsXG4gICAgICBiMkVkZ2VBbmRDaXJjbGVDb250YWN0ID0gQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJFZGdlQW5kQ2lyY2xlQ29udGFjdCxcbiAgICAgIGIyTnVsbENvbnRhY3QgPSBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMk51bGxDb250YWN0LFxuICAgICAgYjJQb2x5QW5kQ2lyY2xlQ29udGFjdCA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyUG9seUFuZENpcmNsZUNvbnRhY3QsXG4gICAgICBiMlBvbHlBbmRFZGdlQ29udGFjdCA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyUG9seUFuZEVkZ2VDb250YWN0LFxuICAgICAgYjJQb2x5Z29uQ29udGFjdCA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyUG9seWdvbkNvbnRhY3QsXG4gICAgICBiMlBvc2l0aW9uU29sdmVyTWFuaWZvbGQgPSBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMlBvc2l0aW9uU29sdmVyTWFuaWZvbGQsXG4gICAgICBiMkNvbnRyb2xsZXIgPSBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnRyb2xsZXIsXG4gICAgICBiMkRpc3RhbmNlSm9pbnQgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJEaXN0YW5jZUpvaW50LFxuICAgICAgYjJEaXN0YW5jZUpvaW50RGVmID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyRGlzdGFuY2VKb2ludERlZixcbiAgICAgIGIyRnJpY3Rpb25Kb2ludCA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkZyaWN0aW9uSm9pbnQsXG4gICAgICBiMkZyaWN0aW9uSm9pbnREZWYgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJGcmljdGlvbkpvaW50RGVmLFxuICAgICAgYjJHZWFySm9pbnQgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJHZWFySm9pbnQsXG4gICAgICBiMkdlYXJKb2ludERlZiA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkdlYXJKb2ludERlZixcbiAgICAgIGIySmFjb2JpYW4gPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKYWNvYmlhbixcbiAgICAgIGIySm9pbnQgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludCxcbiAgICAgIGIySm9pbnREZWYgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludERlZixcbiAgICAgIGIySm9pbnRFZGdlID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnRFZGdlLFxuICAgICAgYjJMaW5lSm9pbnQgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJMaW5lSm9pbnQsXG4gICAgICBiMkxpbmVKb2ludERlZiA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkxpbmVKb2ludERlZixcbiAgICAgIGIyTW91c2VKb2ludCA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMk1vdXNlSm9pbnQsXG4gICAgICBiMk1vdXNlSm9pbnREZWYgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJNb3VzZUpvaW50RGVmLFxuICAgICAgYjJQcmlzbWF0aWNKb2ludCA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMlByaXNtYXRpY0pvaW50LFxuICAgICAgYjJQcmlzbWF0aWNKb2ludERlZiA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMlByaXNtYXRpY0pvaW50RGVmLFxuICAgICAgYjJQdWxsZXlKb2ludCA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMlB1bGxleUpvaW50LFxuICAgICAgYjJQdWxsZXlKb2ludERlZiA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMlB1bGxleUpvaW50RGVmLFxuICAgICAgYjJSZXZvbHV0ZUpvaW50ID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyUmV2b2x1dGVKb2ludCxcbiAgICAgIGIyUmV2b2x1dGVKb2ludERlZiA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMlJldm9sdXRlSm9pbnREZWYsXG4gICAgICBiMldlbGRKb2ludCA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMldlbGRKb2ludCxcbiAgICAgIGIyV2VsZEpvaW50RGVmID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyV2VsZEpvaW50RGVmO1xuXG4gICBiMkJvZHkuYjJCb2R5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX3hmID0gbmV3IGIyVHJhbnNmb3JtKCk7XG4gICAgICB0aGlzLm1fc3dlZXAgPSBuZXcgYjJTd2VlcCgpO1xuICAgICAgdGhpcy5tX2xpbmVhclZlbG9jaXR5ID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX2ZvcmNlID0gbmV3IGIyVmVjMigpO1xuICAgfTtcbiAgIGIyQm9keS5wcm90b3R5cGUuY29ubmVjdEVkZ2VzID0gZnVuY3Rpb24gKHMxLCBzMiwgYW5nbGUxKSB7XG4gICAgICBpZiAoYW5nbGUxID09PSB1bmRlZmluZWQpIGFuZ2xlMSA9IDA7XG4gICAgICB2YXIgYW5nbGUyID0gTWF0aC5hdGFuMihzMi5HZXREaXJlY3Rpb25WZWN0b3IoKS55LCBzMi5HZXREaXJlY3Rpb25WZWN0b3IoKS54KTtcbiAgICAgIHZhciBjb3JlT2Zmc2V0ID0gTWF0aC50YW4oKGFuZ2xlMiAtIGFuZ2xlMSkgKiAwLjUpO1xuICAgICAgdmFyIGNvcmUgPSBiMk1hdGguTXVsRlYoY29yZU9mZnNldCwgczIuR2V0RGlyZWN0aW9uVmVjdG9yKCkpO1xuICAgICAgY29yZSA9IGIyTWF0aC5TdWJ0cmFjdFZWKGNvcmUsIHMyLkdldE5vcm1hbFZlY3RvcigpKTtcbiAgICAgIGNvcmUgPSBiMk1hdGguTXVsRlYoYjJTZXR0aW5ncy5iMl90b2lTbG9wLCBjb3JlKTtcbiAgICAgIGNvcmUgPSBiMk1hdGguQWRkVlYoY29yZSwgczIuR2V0VmVydGV4MSgpKTtcbiAgICAgIHZhciBjb3JuZXJEaXIgPSBiMk1hdGguQWRkVlYoczEuR2V0RGlyZWN0aW9uVmVjdG9yKCksIHMyLkdldERpcmVjdGlvblZlY3RvcigpKTtcbiAgICAgIGNvcm5lckRpci5Ob3JtYWxpemUoKTtcbiAgICAgIHZhciBjb252ZXggPSBiMk1hdGguRG90KHMxLkdldERpcmVjdGlvblZlY3RvcigpLCBzMi5HZXROb3JtYWxWZWN0b3IoKSkgPiAwLjA7XG4gICAgICBzMS5TZXROZXh0RWRnZShzMiwgY29yZSwgY29ybmVyRGlyLCBjb252ZXgpO1xuICAgICAgczIuU2V0UHJldkVkZ2UoczEsIGNvcmUsIGNvcm5lckRpciwgY29udmV4KTtcbiAgICAgIHJldHVybiBhbmdsZTI7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLkNyZWF0ZUZpeHR1cmUgPSBmdW5jdGlvbiAoZGVmKSB7XG4gICAgICBpZiAodGhpcy5tX3dvcmxkLklzTG9ja2VkKCkgPT0gdHJ1ZSkge1xuICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICB2YXIgZml4dHVyZSA9IG5ldyBiMkZpeHR1cmUoKTtcbiAgICAgIGZpeHR1cmUuQ3JlYXRlKHRoaXMsIHRoaXMubV94ZiwgZGVmKTtcbiAgICAgIGlmICh0aGlzLm1fZmxhZ3MgJiBiMkJvZHkuZV9hY3RpdmVGbGFnKSB7XG4gICAgICAgICB2YXIgYnJvYWRQaGFzZSA9IHRoaXMubV93b3JsZC5tX2NvbnRhY3RNYW5hZ2VyLm1fYnJvYWRQaGFzZTtcbiAgICAgICAgIGZpeHR1cmUuQ3JlYXRlUHJveHkoYnJvYWRQaGFzZSwgdGhpcy5tX3hmKTtcbiAgICAgIH1cbiAgICAgIGZpeHR1cmUubV9uZXh0ID0gdGhpcy5tX2ZpeHR1cmVMaXN0O1xuICAgICAgdGhpcy5tX2ZpeHR1cmVMaXN0ID0gZml4dHVyZTtcbiAgICAgICsrdGhpcy5tX2ZpeHR1cmVDb3VudDtcbiAgICAgIGZpeHR1cmUubV9ib2R5ID0gdGhpcztcbiAgICAgIGlmIChmaXh0dXJlLm1fZGVuc2l0eSA+IDAuMCkge1xuICAgICAgICAgdGhpcy5SZXNldE1hc3NEYXRhKCk7XG4gICAgICB9XG4gICAgICB0aGlzLm1fd29ybGQubV9mbGFncyB8PSBiMldvcmxkLmVfbmV3Rml4dHVyZTtcbiAgICAgIHJldHVybiBmaXh0dXJlO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5DcmVhdGVGaXh0dXJlMiA9IGZ1bmN0aW9uIChzaGFwZSwgZGVuc2l0eSkge1xuICAgICAgaWYgKGRlbnNpdHkgPT09IHVuZGVmaW5lZCkgZGVuc2l0eSA9IDAuMDtcbiAgICAgIHZhciBkZWYgPSBuZXcgYjJGaXh0dXJlRGVmKCk7XG4gICAgICBkZWYuc2hhcGUgPSBzaGFwZTtcbiAgICAgIGRlZi5kZW5zaXR5ID0gZGVuc2l0eTtcbiAgICAgIHJldHVybiB0aGlzLkNyZWF0ZUZpeHR1cmUoZGVmKTtcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuRGVzdHJveUZpeHR1cmUgPSBmdW5jdGlvbiAoZml4dHVyZSkge1xuICAgICAgaWYgKHRoaXMubV93b3JsZC5Jc0xvY2tlZCgpID09IHRydWUpIHtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBub2RlID0gdGhpcy5tX2ZpeHR1cmVMaXN0O1xuICAgICAgdmFyIHBwRiA9IG51bGw7XG4gICAgICB2YXIgZm91bmQgPSBmYWxzZTtcbiAgICAgIHdoaWxlIChub2RlICE9IG51bGwpIHtcbiAgICAgICAgIGlmIChub2RlID09IGZpeHR1cmUpIHtcbiAgICAgICAgICAgIGlmIChwcEYpIHBwRi5tX25leHQgPSBmaXh0dXJlLm1fbmV4dDtcbiAgICAgICAgICAgIGVsc2UgdGhpcy5tX2ZpeHR1cmVMaXN0ID0gZml4dHVyZS5tX25leHQ7XG4gICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgIH1cbiAgICAgICAgIHBwRiA9IG5vZGU7XG4gICAgICAgICBub2RlID0gbm9kZS5tX25leHQ7XG4gICAgICB9XG4gICAgICB2YXIgZWRnZSA9IHRoaXMubV9jb250YWN0TGlzdDtcbiAgICAgIHdoaWxlIChlZGdlKSB7XG4gICAgICAgICB2YXIgYyA9IGVkZ2UuY29udGFjdDtcbiAgICAgICAgIGVkZ2UgPSBlZGdlLm5leHQ7XG4gICAgICAgICB2YXIgZml4dHVyZUEgPSBjLkdldEZpeHR1cmVBKCk7XG4gICAgICAgICB2YXIgZml4dHVyZUIgPSBjLkdldEZpeHR1cmVCKCk7XG4gICAgICAgICBpZiAoZml4dHVyZSA9PSBmaXh0dXJlQSB8fCBmaXh0dXJlID09IGZpeHR1cmVCKSB7XG4gICAgICAgICAgICB0aGlzLm1fd29ybGQubV9jb250YWN0TWFuYWdlci5EZXN0cm95KGMpO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMubV9mbGFncyAmIGIyQm9keS5lX2FjdGl2ZUZsYWcpIHtcbiAgICAgICAgIHZhciBicm9hZFBoYXNlID0gdGhpcy5tX3dvcmxkLm1fY29udGFjdE1hbmFnZXIubV9icm9hZFBoYXNlO1xuICAgICAgICAgZml4dHVyZS5EZXN0cm95UHJveHkoYnJvYWRQaGFzZSk7XG4gICAgICB9XG4gICAgICBlbHNlIHt9XG4gICAgICBmaXh0dXJlLkRlc3Ryb3koKTtcbiAgICAgIGZpeHR1cmUubV9ib2R5ID0gbnVsbDtcbiAgICAgIGZpeHR1cmUubV9uZXh0ID0gbnVsbDtcbiAgICAgIC0tdGhpcy5tX2ZpeHR1cmVDb3VudDtcbiAgICAgIHRoaXMuUmVzZXRNYXNzRGF0YSgpO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5TZXRQb3NpdGlvbkFuZEFuZ2xlID0gZnVuY3Rpb24gKHBvc2l0aW9uLCBhbmdsZSkge1xuICAgICAgaWYgKGFuZ2xlID09PSB1bmRlZmluZWQpIGFuZ2xlID0gMDtcbiAgICAgIHZhciBmO1xuICAgICAgaWYgKHRoaXMubV93b3JsZC5Jc0xvY2tlZCgpID09IHRydWUpIHtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMubV94Zi5SLlNldChhbmdsZSk7XG4gICAgICB0aGlzLm1feGYucG9zaXRpb24uU2V0Vihwb3NpdGlvbik7XG4gICAgICB2YXIgdE1hdCA9IHRoaXMubV94Zi5SO1xuICAgICAgdmFyIHRWZWMgPSB0aGlzLm1fc3dlZXAubG9jYWxDZW50ZXI7XG4gICAgICB0aGlzLm1fc3dlZXAuYy54ID0gKHRNYXQuY29sMS54ICogdFZlYy54ICsgdE1hdC5jb2wyLnggKiB0VmVjLnkpO1xuICAgICAgdGhpcy5tX3N3ZWVwLmMueSA9ICh0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55KTtcbiAgICAgIHRoaXMubV9zd2VlcC5jLnggKz0gdGhpcy5tX3hmLnBvc2l0aW9uLng7XG4gICAgICB0aGlzLm1fc3dlZXAuYy55ICs9IHRoaXMubV94Zi5wb3NpdGlvbi55O1xuICAgICAgdGhpcy5tX3N3ZWVwLmMwLlNldFYodGhpcy5tX3N3ZWVwLmMpO1xuICAgICAgdGhpcy5tX3N3ZWVwLmEwID0gdGhpcy5tX3N3ZWVwLmEgPSBhbmdsZTtcbiAgICAgIHZhciBicm9hZFBoYXNlID0gdGhpcy5tX3dvcmxkLm1fY29udGFjdE1hbmFnZXIubV9icm9hZFBoYXNlO1xuICAgICAgZm9yIChmID0gdGhpcy5tX2ZpeHR1cmVMaXN0O1xuICAgICAgZjsgZiA9IGYubV9uZXh0KSB7XG4gICAgICAgICBmLlN5bmNocm9uaXplKGJyb2FkUGhhc2UsIHRoaXMubV94ZiwgdGhpcy5tX3hmKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubV93b3JsZC5tX2NvbnRhY3RNYW5hZ2VyLkZpbmROZXdDb250YWN0cygpO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5TZXRUcmFuc2Zvcm0gPSBmdW5jdGlvbiAoeGYpIHtcbiAgICAgIHRoaXMuU2V0UG9zaXRpb25BbmRBbmdsZSh4Zi5wb3NpdGlvbiwgeGYuR2V0QW5nbGUoKSk7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLkdldFRyYW5zZm9ybSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1feGY7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLkdldFBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV94Zi5wb3NpdGlvbjtcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuU2V0UG9zaXRpb24gPSBmdW5jdGlvbiAocG9zaXRpb24pIHtcbiAgICAgIHRoaXMuU2V0UG9zaXRpb25BbmRBbmdsZShwb3NpdGlvbiwgdGhpcy5HZXRBbmdsZSgpKTtcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuR2V0QW5nbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3N3ZWVwLmE7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLlNldEFuZ2xlID0gZnVuY3Rpb24gKGFuZ2xlKSB7XG4gICAgICBpZiAoYW5nbGUgPT09IHVuZGVmaW5lZCkgYW5nbGUgPSAwO1xuICAgICAgdGhpcy5TZXRQb3NpdGlvbkFuZEFuZ2xlKHRoaXMuR2V0UG9zaXRpb24oKSwgYW5nbGUpO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5HZXRXb3JsZENlbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fc3dlZXAuYztcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuR2V0TG9jYWxDZW50ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3N3ZWVwLmxvY2FsQ2VudGVyO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5TZXRMaW5lYXJWZWxvY2l0eSA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICBpZiAodGhpcy5tX3R5cGUgPT0gYjJCb2R5LmIyX3N0YXRpY0JvZHkpIHtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMubV9saW5lYXJWZWxvY2l0eS5TZXRWKHYpO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5HZXRMaW5lYXJWZWxvY2l0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fbGluZWFyVmVsb2NpdHk7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLlNldEFuZ3VsYXJWZWxvY2l0eSA9IGZ1bmN0aW9uIChvbWVnYSkge1xuICAgICAgaWYgKG9tZWdhID09PSB1bmRlZmluZWQpIG9tZWdhID0gMDtcbiAgICAgIGlmICh0aGlzLm1fdHlwZSA9PSBiMkJvZHkuYjJfc3RhdGljQm9keSkge1xuICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5tX2FuZ3VsYXJWZWxvY2l0eSA9IG9tZWdhO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5HZXRBbmd1bGFyVmVsb2NpdHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2FuZ3VsYXJWZWxvY2l0eTtcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuR2V0RGVmaW5pdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBiZCA9IG5ldyBiMkJvZHlEZWYoKTtcbiAgICAgIGJkLnR5cGUgPSB0aGlzLkdldFR5cGUoKTtcbiAgICAgIGJkLmFsbG93U2xlZXAgPSAodGhpcy5tX2ZsYWdzICYgYjJCb2R5LmVfYWxsb3dTbGVlcEZsYWcpID09IGIyQm9keS5lX2FsbG93U2xlZXBGbGFnO1xuICAgICAgYmQuYW5nbGUgPSB0aGlzLkdldEFuZ2xlKCk7XG4gICAgICBiZC5hbmd1bGFyRGFtcGluZyA9IHRoaXMubV9hbmd1bGFyRGFtcGluZztcbiAgICAgIGJkLmFuZ3VsYXJWZWxvY2l0eSA9IHRoaXMubV9hbmd1bGFyVmVsb2NpdHk7XG4gICAgICBiZC5maXhlZFJvdGF0aW9uID0gKHRoaXMubV9mbGFncyAmIGIyQm9keS5lX2ZpeGVkUm90YXRpb25GbGFnKSA9PSBiMkJvZHkuZV9maXhlZFJvdGF0aW9uRmxhZztcbiAgICAgIGJkLmJ1bGxldCA9ICh0aGlzLm1fZmxhZ3MgJiBiMkJvZHkuZV9idWxsZXRGbGFnKSA9PSBiMkJvZHkuZV9idWxsZXRGbGFnO1xuICAgICAgYmQuYXdha2UgPSAodGhpcy5tX2ZsYWdzICYgYjJCb2R5LmVfYXdha2VGbGFnKSA9PSBiMkJvZHkuZV9hd2FrZUZsYWc7XG4gICAgICBiZC5saW5lYXJEYW1waW5nID0gdGhpcy5tX2xpbmVhckRhbXBpbmc7XG4gICAgICBiZC5saW5lYXJWZWxvY2l0eS5TZXRWKHRoaXMuR2V0TGluZWFyVmVsb2NpdHkoKSk7XG4gICAgICBiZC5wb3NpdGlvbiA9IHRoaXMuR2V0UG9zaXRpb24oKTtcbiAgICAgIGJkLnVzZXJEYXRhID0gdGhpcy5HZXRVc2VyRGF0YSgpO1xuICAgICAgcmV0dXJuIGJkO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5BcHBseUZvcmNlID0gZnVuY3Rpb24gKGZvcmNlLCBwb2ludCkge1xuICAgICAgaWYgKHRoaXMubV90eXBlICE9IGIyQm9keS5iMl9keW5hbWljQm9keSkge1xuICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuSXNBd2FrZSgpID09IGZhbHNlKSB7XG4gICAgICAgICB0aGlzLlNldEF3YWtlKHRydWUpO1xuICAgICAgfVxuICAgICAgdGhpcy5tX2ZvcmNlLnggKz0gZm9yY2UueDtcbiAgICAgIHRoaXMubV9mb3JjZS55ICs9IGZvcmNlLnk7XG4gICAgICB0aGlzLm1fdG9ycXVlICs9ICgocG9pbnQueCAtIHRoaXMubV9zd2VlcC5jLngpICogZm9yY2UueSAtIChwb2ludC55IC0gdGhpcy5tX3N3ZWVwLmMueSkgKiBmb3JjZS54KTtcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuQXBwbHlUb3JxdWUgPSBmdW5jdGlvbiAodG9ycXVlKSB7XG4gICAgICBpZiAodG9ycXVlID09PSB1bmRlZmluZWQpIHRvcnF1ZSA9IDA7XG4gICAgICBpZiAodGhpcy5tX3R5cGUgIT0gYjJCb2R5LmIyX2R5bmFtaWNCb2R5KSB7XG4gICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5Jc0F3YWtlKCkgPT0gZmFsc2UpIHtcbiAgICAgICAgIHRoaXMuU2V0QXdha2UodHJ1ZSk7XG4gICAgICB9XG4gICAgICB0aGlzLm1fdG9ycXVlICs9IHRvcnF1ZTtcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuQXBwbHlJbXB1bHNlID0gZnVuY3Rpb24gKGltcHVsc2UsIHBvaW50KSB7XG4gICAgICBpZiAodGhpcy5tX3R5cGUgIT0gYjJCb2R5LmIyX2R5bmFtaWNCb2R5KSB7XG4gICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5Jc0F3YWtlKCkgPT0gZmFsc2UpIHtcbiAgICAgICAgIHRoaXMuU2V0QXdha2UodHJ1ZSk7XG4gICAgICB9XG4gICAgICB0aGlzLm1fbGluZWFyVmVsb2NpdHkueCArPSB0aGlzLm1faW52TWFzcyAqIGltcHVsc2UueDtcbiAgICAgIHRoaXMubV9saW5lYXJWZWxvY2l0eS55ICs9IHRoaXMubV9pbnZNYXNzICogaW1wdWxzZS55O1xuICAgICAgdGhpcy5tX2FuZ3VsYXJWZWxvY2l0eSArPSB0aGlzLm1faW52SSAqICgocG9pbnQueCAtIHRoaXMubV9zd2VlcC5jLngpICogaW1wdWxzZS55IC0gKHBvaW50LnkgLSB0aGlzLm1fc3dlZXAuYy55KSAqIGltcHVsc2UueCk7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLlNwbGl0ID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICB2YXIgbGluZWFyVmVsb2NpdHkgPSB0aGlzLkdldExpbmVhclZlbG9jaXR5KCkuQ29weSgpO1xuICAgICAgdmFyIGFuZ3VsYXJWZWxvY2l0eSA9IHRoaXMuR2V0QW5ndWxhclZlbG9jaXR5KCk7XG4gICAgICB2YXIgY2VudGVyID0gdGhpcy5HZXRXb3JsZENlbnRlcigpO1xuICAgICAgdmFyIGJvZHkxID0gdGhpcztcbiAgICAgIHZhciBib2R5MiA9IHRoaXMubV93b3JsZC5DcmVhdGVCb2R5KHRoaXMuR2V0RGVmaW5pdGlvbigpKTtcbiAgICAgIHZhciBwcmV2O1xuICAgICAgZm9yICh2YXIgZiA9IGJvZHkxLm1fZml4dHVyZUxpc3Q7IGY7KSB7XG4gICAgICAgICBpZiAoY2FsbGJhY2soZikpIHtcbiAgICAgICAgICAgIHZhciBuZXh0ID0gZi5tX25leHQ7XG4gICAgICAgICAgICBpZiAocHJldikge1xuICAgICAgICAgICAgICAgcHJldi5tX25leHQgPSBuZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICBib2R5MS5tX2ZpeHR1cmVMaXN0ID0gbmV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJvZHkxLm1fZml4dHVyZUNvdW50LS07XG4gICAgICAgICAgICBmLm1fbmV4dCA9IGJvZHkyLm1fZml4dHVyZUxpc3Q7XG4gICAgICAgICAgICBib2R5Mi5tX2ZpeHR1cmVMaXN0ID0gZjtcbiAgICAgICAgICAgIGJvZHkyLm1fZml4dHVyZUNvdW50Kys7XG4gICAgICAgICAgICBmLm1fYm9keSA9IGJvZHkyO1xuICAgICAgICAgICAgZiA9IG5leHQ7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHByZXYgPSBmO1xuICAgICAgICAgICAgZiA9IGYubV9uZXh0O1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgYm9keTEuUmVzZXRNYXNzRGF0YSgpO1xuICAgICAgYm9keTIuUmVzZXRNYXNzRGF0YSgpO1xuICAgICAgdmFyIGNlbnRlcjEgPSBib2R5MS5HZXRXb3JsZENlbnRlcigpO1xuICAgICAgdmFyIGNlbnRlcjIgPSBib2R5Mi5HZXRXb3JsZENlbnRlcigpO1xuICAgICAgdmFyIHZlbG9jaXR5MSA9IGIyTWF0aC5BZGRWVihsaW5lYXJWZWxvY2l0eSwgYjJNYXRoLkNyb3NzRlYoYW5ndWxhclZlbG9jaXR5LCBiMk1hdGguU3VidHJhY3RWVihjZW50ZXIxLCBjZW50ZXIpKSk7XG4gICAgICB2YXIgdmVsb2NpdHkyID0gYjJNYXRoLkFkZFZWKGxpbmVhclZlbG9jaXR5LCBiMk1hdGguQ3Jvc3NGVihhbmd1bGFyVmVsb2NpdHksIGIyTWF0aC5TdWJ0cmFjdFZWKGNlbnRlcjIsIGNlbnRlcikpKTtcbiAgICAgIGJvZHkxLlNldExpbmVhclZlbG9jaXR5KHZlbG9jaXR5MSk7XG4gICAgICBib2R5Mi5TZXRMaW5lYXJWZWxvY2l0eSh2ZWxvY2l0eTIpO1xuICAgICAgYm9keTEuU2V0QW5ndWxhclZlbG9jaXR5KGFuZ3VsYXJWZWxvY2l0eSk7XG4gICAgICBib2R5Mi5TZXRBbmd1bGFyVmVsb2NpdHkoYW5ndWxhclZlbG9jaXR5KTtcbiAgICAgIGJvZHkxLlN5bmNocm9uaXplRml4dHVyZXMoKTtcbiAgICAgIGJvZHkyLlN5bmNocm9uaXplRml4dHVyZXMoKTtcbiAgICAgIHJldHVybiBib2R5MjtcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuTWVyZ2UgPSBmdW5jdGlvbiAob3RoZXIpIHtcbiAgICAgIHZhciBmO1xuICAgICAgZm9yIChmID0gb3RoZXIubV9maXh0dXJlTGlzdDtcbiAgICAgIGY7KSB7XG4gICAgICAgICB2YXIgbmV4dCA9IGYubV9uZXh0O1xuICAgICAgICAgb3RoZXIubV9maXh0dXJlQ291bnQtLTtcbiAgICAgICAgIGYubV9uZXh0ID0gdGhpcy5tX2ZpeHR1cmVMaXN0O1xuICAgICAgICAgdGhpcy5tX2ZpeHR1cmVMaXN0ID0gZjtcbiAgICAgICAgIHRoaXMubV9maXh0dXJlQ291bnQrKztcbiAgICAgICAgIGYubV9ib2R5ID0gYm9keTI7XG4gICAgICAgICBmID0gbmV4dDtcbiAgICAgIH1cbiAgICAgIGJvZHkxLm1fZml4dHVyZUNvdW50ID0gMDtcbiAgICAgIHZhciBib2R5MSA9IHRoaXM7XG4gICAgICB2YXIgYm9keTIgPSBvdGhlcjtcbiAgICAgIHZhciBjZW50ZXIxID0gYm9keTEuR2V0V29ybGRDZW50ZXIoKTtcbiAgICAgIHZhciBjZW50ZXIyID0gYm9keTIuR2V0V29ybGRDZW50ZXIoKTtcbiAgICAgIHZhciB2ZWxvY2l0eTEgPSBib2R5MS5HZXRMaW5lYXJWZWxvY2l0eSgpLkNvcHkoKTtcbiAgICAgIHZhciB2ZWxvY2l0eTIgPSBib2R5Mi5HZXRMaW5lYXJWZWxvY2l0eSgpLkNvcHkoKTtcbiAgICAgIHZhciBhbmd1bGFyMSA9IGJvZHkxLkdldEFuZ3VsYXJWZWxvY2l0eSgpO1xuICAgICAgdmFyIGFuZ3VsYXIgPSBib2R5Mi5HZXRBbmd1bGFyVmVsb2NpdHkoKTtcbiAgICAgIGJvZHkxLlJlc2V0TWFzc0RhdGEoKTtcbiAgICAgIHRoaXMuU3luY2hyb25pemVGaXh0dXJlcygpO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5HZXRNYXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9tYXNzO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5HZXRJbmVydGlhID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9JO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5HZXRNYXNzRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICBkYXRhLm1hc3MgPSB0aGlzLm1fbWFzcztcbiAgICAgIGRhdGEuSSA9IHRoaXMubV9JO1xuICAgICAgZGF0YS5jZW50ZXIuU2V0Vih0aGlzLm1fc3dlZXAubG9jYWxDZW50ZXIpO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5TZXRNYXNzRGF0YSA9IGZ1bmN0aW9uIChtYXNzRGF0YSkge1xuICAgICAgYjJTZXR0aW5ncy5iMkFzc2VydCh0aGlzLm1fd29ybGQuSXNMb2NrZWQoKSA9PSBmYWxzZSk7XG4gICAgICBpZiAodGhpcy5tX3dvcmxkLklzTG9ja2VkKCkgPT0gdHJ1ZSkge1xuICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMubV90eXBlICE9IGIyQm9keS5iMl9keW5hbWljQm9keSkge1xuICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5tX2ludk1hc3MgPSAwLjA7XG4gICAgICB0aGlzLm1fSSA9IDAuMDtcbiAgICAgIHRoaXMubV9pbnZJID0gMC4wO1xuICAgICAgdGhpcy5tX21hc3MgPSBtYXNzRGF0YS5tYXNzO1xuICAgICAgaWYgKHRoaXMubV9tYXNzIDw9IDAuMCkge1xuICAgICAgICAgdGhpcy5tX21hc3MgPSAxLjA7XG4gICAgICB9XG4gICAgICB0aGlzLm1faW52TWFzcyA9IDEuMCAvIHRoaXMubV9tYXNzO1xuICAgICAgaWYgKG1hc3NEYXRhLkkgPiAwLjAgJiYgKHRoaXMubV9mbGFncyAmIGIyQm9keS5lX2ZpeGVkUm90YXRpb25GbGFnKSA9PSAwKSB7XG4gICAgICAgICB0aGlzLm1fSSA9IG1hc3NEYXRhLkkgLSB0aGlzLm1fbWFzcyAqIChtYXNzRGF0YS5jZW50ZXIueCAqIG1hc3NEYXRhLmNlbnRlci54ICsgbWFzc0RhdGEuY2VudGVyLnkgKiBtYXNzRGF0YS5jZW50ZXIueSk7XG4gICAgICAgICB0aGlzLm1faW52SSA9IDEuMCAvIHRoaXMubV9JO1xuICAgICAgfVxuICAgICAgdmFyIG9sZENlbnRlciA9IHRoaXMubV9zd2VlcC5jLkNvcHkoKTtcbiAgICAgIHRoaXMubV9zd2VlcC5sb2NhbENlbnRlci5TZXRWKG1hc3NEYXRhLmNlbnRlcik7XG4gICAgICB0aGlzLm1fc3dlZXAuYzAuU2V0VihiMk1hdGguTXVsWCh0aGlzLm1feGYsIHRoaXMubV9zd2VlcC5sb2NhbENlbnRlcikpO1xuICAgICAgdGhpcy5tX3N3ZWVwLmMuU2V0Vih0aGlzLm1fc3dlZXAuYzApO1xuICAgICAgdGhpcy5tX2xpbmVhclZlbG9jaXR5LnggKz0gdGhpcy5tX2FuZ3VsYXJWZWxvY2l0eSAqICgtKHRoaXMubV9zd2VlcC5jLnkgLSBvbGRDZW50ZXIueSkpO1xuICAgICAgdGhpcy5tX2xpbmVhclZlbG9jaXR5LnkgKz0gdGhpcy5tX2FuZ3VsYXJWZWxvY2l0eSAqICgrKHRoaXMubV9zd2VlcC5jLnggLSBvbGRDZW50ZXIueCkpO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5SZXNldE1hc3NEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX21hc3MgPSAwLjA7XG4gICAgICB0aGlzLm1faW52TWFzcyA9IDAuMDtcbiAgICAgIHRoaXMubV9JID0gMC4wO1xuICAgICAgdGhpcy5tX2ludkkgPSAwLjA7XG4gICAgICB0aGlzLm1fc3dlZXAubG9jYWxDZW50ZXIuU2V0WmVybygpO1xuICAgICAgaWYgKHRoaXMubV90eXBlID09IGIyQm9keS5iMl9zdGF0aWNCb2R5IHx8IHRoaXMubV90eXBlID09IGIyQm9keS5iMl9raW5lbWF0aWNCb2R5KSB7XG4gICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgY2VudGVyID0gYjJWZWMyLk1ha2UoMCwgMCk7XG4gICAgICBmb3IgKHZhciBmID0gdGhpcy5tX2ZpeHR1cmVMaXN0OyBmOyBmID0gZi5tX25leHQpIHtcbiAgICAgICAgIGlmIChmLm1fZGVuc2l0eSA9PSAwLjApIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgfVxuICAgICAgICAgdmFyIG1hc3NEYXRhID0gZi5HZXRNYXNzRGF0YSgpO1xuICAgICAgICAgdGhpcy5tX21hc3MgKz0gbWFzc0RhdGEubWFzcztcbiAgICAgICAgIGNlbnRlci54ICs9IG1hc3NEYXRhLmNlbnRlci54ICogbWFzc0RhdGEubWFzcztcbiAgICAgICAgIGNlbnRlci55ICs9IG1hc3NEYXRhLmNlbnRlci55ICogbWFzc0RhdGEubWFzcztcbiAgICAgICAgIHRoaXMubV9JICs9IG1hc3NEYXRhLkk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5tX21hc3MgPiAwLjApIHtcbiAgICAgICAgIHRoaXMubV9pbnZNYXNzID0gMS4wIC8gdGhpcy5tX21hc3M7XG4gICAgICAgICBjZW50ZXIueCAqPSB0aGlzLm1faW52TWFzcztcbiAgICAgICAgIGNlbnRlci55ICo9IHRoaXMubV9pbnZNYXNzO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICB0aGlzLm1fbWFzcyA9IDEuMDtcbiAgICAgICAgIHRoaXMubV9pbnZNYXNzID0gMS4wO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMubV9JID4gMC4wICYmICh0aGlzLm1fZmxhZ3MgJiBiMkJvZHkuZV9maXhlZFJvdGF0aW9uRmxhZykgPT0gMCkge1xuICAgICAgICAgdGhpcy5tX0kgLT0gdGhpcy5tX21hc3MgKiAoY2VudGVyLnggKiBjZW50ZXIueCArIGNlbnRlci55ICogY2VudGVyLnkpO1xuICAgICAgICAgdGhpcy5tX0kgKj0gdGhpcy5tX2luZXJ0aWFTY2FsZTtcbiAgICAgICAgIGIyU2V0dGluZ3MuYjJBc3NlcnQodGhpcy5tX0kgPiAwKTtcbiAgICAgICAgIHRoaXMubV9pbnZJID0gMS4wIC8gdGhpcy5tX0k7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV9JID0gMC4wO1xuICAgICAgICAgdGhpcy5tX2ludkkgPSAwLjA7XG4gICAgICB9XG4gICAgICB2YXIgb2xkQ2VudGVyID0gdGhpcy5tX3N3ZWVwLmMuQ29weSgpO1xuICAgICAgdGhpcy5tX3N3ZWVwLmxvY2FsQ2VudGVyLlNldFYoY2VudGVyKTtcbiAgICAgIHRoaXMubV9zd2VlcC5jMC5TZXRWKGIyTWF0aC5NdWxYKHRoaXMubV94ZiwgdGhpcy5tX3N3ZWVwLmxvY2FsQ2VudGVyKSk7XG4gICAgICB0aGlzLm1fc3dlZXAuYy5TZXRWKHRoaXMubV9zd2VlcC5jMCk7XG4gICAgICB0aGlzLm1fbGluZWFyVmVsb2NpdHkueCArPSB0aGlzLm1fYW5ndWxhclZlbG9jaXR5ICogKC0odGhpcy5tX3N3ZWVwLmMueSAtIG9sZENlbnRlci55KSk7XG4gICAgICB0aGlzLm1fbGluZWFyVmVsb2NpdHkueSArPSB0aGlzLm1fYW5ndWxhclZlbG9jaXR5ICogKCsodGhpcy5tX3N3ZWVwLmMueCAtIG9sZENlbnRlci54KSk7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLkdldFdvcmxkUG9pbnQgPSBmdW5jdGlvbiAobG9jYWxQb2ludCkge1xuICAgICAgdmFyIEEgPSB0aGlzLm1feGYuUjtcbiAgICAgIHZhciB1ID0gbmV3IGIyVmVjMihBLmNvbDEueCAqIGxvY2FsUG9pbnQueCArIEEuY29sMi54ICogbG9jYWxQb2ludC55LCBBLmNvbDEueSAqIGxvY2FsUG9pbnQueCArIEEuY29sMi55ICogbG9jYWxQb2ludC55KTtcbiAgICAgIHUueCArPSB0aGlzLm1feGYucG9zaXRpb24ueDtcbiAgICAgIHUueSArPSB0aGlzLm1feGYucG9zaXRpb24ueTtcbiAgICAgIHJldHVybiB1O1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5HZXRXb3JsZFZlY3RvciA9IGZ1bmN0aW9uIChsb2NhbFZlY3Rvcikge1xuICAgICAgcmV0dXJuIGIyTWF0aC5NdWxNVih0aGlzLm1feGYuUiwgbG9jYWxWZWN0b3IpO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5HZXRMb2NhbFBvaW50ID0gZnVuY3Rpb24gKHdvcmxkUG9pbnQpIHtcbiAgICAgIHJldHVybiBiMk1hdGguTXVsWFQodGhpcy5tX3hmLCB3b3JsZFBvaW50KTtcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuR2V0TG9jYWxWZWN0b3IgPSBmdW5jdGlvbiAod29ybGRWZWN0b3IpIHtcbiAgICAgIHJldHVybiBiMk1hdGguTXVsVE1WKHRoaXMubV94Zi5SLCB3b3JsZFZlY3Rvcik7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLkdldExpbmVhclZlbG9jaXR5RnJvbVdvcmxkUG9pbnQgPSBmdW5jdGlvbiAod29ybGRQb2ludCkge1xuICAgICAgcmV0dXJuIG5ldyBiMlZlYzIodGhpcy5tX2xpbmVhclZlbG9jaXR5LnggLSB0aGlzLm1fYW5ndWxhclZlbG9jaXR5ICogKHdvcmxkUG9pbnQueSAtIHRoaXMubV9zd2VlcC5jLnkpLCB0aGlzLm1fbGluZWFyVmVsb2NpdHkueSArIHRoaXMubV9hbmd1bGFyVmVsb2NpdHkgKiAod29ybGRQb2ludC54IC0gdGhpcy5tX3N3ZWVwLmMueCkpO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5HZXRMaW5lYXJWZWxvY2l0eUZyb21Mb2NhbFBvaW50ID0gZnVuY3Rpb24gKGxvY2FsUG9pbnQpIHtcbiAgICAgIHZhciBBID0gdGhpcy5tX3hmLlI7XG4gICAgICB2YXIgd29ybGRQb2ludCA9IG5ldyBiMlZlYzIoQS5jb2wxLnggKiBsb2NhbFBvaW50LnggKyBBLmNvbDIueCAqIGxvY2FsUG9pbnQueSwgQS5jb2wxLnkgKiBsb2NhbFBvaW50LnggKyBBLmNvbDIueSAqIGxvY2FsUG9pbnQueSk7XG4gICAgICB3b3JsZFBvaW50LnggKz0gdGhpcy5tX3hmLnBvc2l0aW9uLng7XG4gICAgICB3b3JsZFBvaW50LnkgKz0gdGhpcy5tX3hmLnBvc2l0aW9uLnk7XG4gICAgICByZXR1cm4gbmV3IGIyVmVjMih0aGlzLm1fbGluZWFyVmVsb2NpdHkueCAtIHRoaXMubV9hbmd1bGFyVmVsb2NpdHkgKiAod29ybGRQb2ludC55IC0gdGhpcy5tX3N3ZWVwLmMueSksIHRoaXMubV9saW5lYXJWZWxvY2l0eS55ICsgdGhpcy5tX2FuZ3VsYXJWZWxvY2l0eSAqICh3b3JsZFBvaW50LnggLSB0aGlzLm1fc3dlZXAuYy54KSk7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLkdldExpbmVhckRhbXBpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2xpbmVhckRhbXBpbmc7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLlNldExpbmVhckRhbXBpbmcgPSBmdW5jdGlvbiAobGluZWFyRGFtcGluZykge1xuICAgICAgaWYgKGxpbmVhckRhbXBpbmcgPT09IHVuZGVmaW5lZCkgbGluZWFyRGFtcGluZyA9IDA7XG4gICAgICB0aGlzLm1fbGluZWFyRGFtcGluZyA9IGxpbmVhckRhbXBpbmc7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLkdldEFuZ3VsYXJEYW1waW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9hbmd1bGFyRGFtcGluZztcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuU2V0QW5ndWxhckRhbXBpbmcgPSBmdW5jdGlvbiAoYW5ndWxhckRhbXBpbmcpIHtcbiAgICAgIGlmIChhbmd1bGFyRGFtcGluZyA9PT0gdW5kZWZpbmVkKSBhbmd1bGFyRGFtcGluZyA9IDA7XG4gICAgICB0aGlzLm1fYW5ndWxhckRhbXBpbmcgPSBhbmd1bGFyRGFtcGluZztcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuU2V0VHlwZSA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICBpZiAodHlwZSA9PT0gdW5kZWZpbmVkKSB0eXBlID0gMDtcbiAgICAgIGlmICh0aGlzLm1fdHlwZSA9PSB0eXBlKSB7XG4gICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLm1fdHlwZSA9IHR5cGU7XG4gICAgICB0aGlzLlJlc2V0TWFzc0RhdGEoKTtcbiAgICAgIGlmICh0aGlzLm1fdHlwZSA9PSBiMkJvZHkuYjJfc3RhdGljQm9keSkge1xuICAgICAgICAgdGhpcy5tX2xpbmVhclZlbG9jaXR5LlNldFplcm8oKTtcbiAgICAgICAgIHRoaXMubV9hbmd1bGFyVmVsb2NpdHkgPSAwLjA7XG4gICAgICB9XG4gICAgICB0aGlzLlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5tX2ZvcmNlLlNldFplcm8oKTtcbiAgICAgIHRoaXMubV90b3JxdWUgPSAwLjA7XG4gICAgICBmb3IgKHZhciBjZSA9IHRoaXMubV9jb250YWN0TGlzdDsgY2U7IGNlID0gY2UubmV4dCkge1xuICAgICAgICAgY2UuY29udGFjdC5GbGFnRm9yRmlsdGVyaW5nKCk7XG4gICAgICB9XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLkdldFR5cGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3R5cGU7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLlNldEJ1bGxldCA9IGZ1bmN0aW9uIChmbGFnKSB7XG4gICAgICBpZiAoZmxhZykge1xuICAgICAgICAgdGhpcy5tX2ZsYWdzIHw9IGIyQm9keS5lX2J1bGxldEZsYWc7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV9mbGFncyAmPSB+YjJCb2R5LmVfYnVsbGV0RmxhZztcbiAgICAgIH1cbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuSXNCdWxsZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gKHRoaXMubV9mbGFncyAmIGIyQm9keS5lX2J1bGxldEZsYWcpID09IGIyQm9keS5lX2J1bGxldEZsYWc7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLlNldFNsZWVwaW5nQWxsb3dlZCA9IGZ1bmN0aW9uIChmbGFnKSB7XG4gICAgICBpZiAoZmxhZykge1xuICAgICAgICAgdGhpcy5tX2ZsYWdzIHw9IGIyQm9keS5lX2FsbG93U2xlZXBGbGFnO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICB0aGlzLm1fZmxhZ3MgJj0gfmIyQm9keS5lX2FsbG93U2xlZXBGbGFnO1xuICAgICAgICAgdGhpcy5TZXRBd2FrZSh0cnVlKTtcbiAgICAgIH1cbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuU2V0QXdha2UgPSBmdW5jdGlvbiAoZmxhZykge1xuICAgICAgaWYgKGZsYWcpIHtcbiAgICAgICAgIHRoaXMubV9mbGFncyB8PSBiMkJvZHkuZV9hd2FrZUZsYWc7XG4gICAgICAgICB0aGlzLm1fc2xlZXBUaW1lID0gMC4wO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICB0aGlzLm1fZmxhZ3MgJj0gfmIyQm9keS5lX2F3YWtlRmxhZztcbiAgICAgICAgIHRoaXMubV9zbGVlcFRpbWUgPSAwLjA7XG4gICAgICAgICB0aGlzLm1fbGluZWFyVmVsb2NpdHkuU2V0WmVybygpO1xuICAgICAgICAgdGhpcy5tX2FuZ3VsYXJWZWxvY2l0eSA9IDAuMDtcbiAgICAgICAgIHRoaXMubV9mb3JjZS5TZXRaZXJvKCk7XG4gICAgICAgICB0aGlzLm1fdG9ycXVlID0gMC4wO1xuICAgICAgfVxuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5Jc0F3YWtlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuICh0aGlzLm1fZmxhZ3MgJiBiMkJvZHkuZV9hd2FrZUZsYWcpID09IGIyQm9keS5lX2F3YWtlRmxhZztcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuU2V0Rml4ZWRSb3RhdGlvbiA9IGZ1bmN0aW9uIChmaXhlZCkge1xuICAgICAgaWYgKGZpeGVkKSB7XG4gICAgICAgICB0aGlzLm1fZmxhZ3MgfD0gYjJCb2R5LmVfZml4ZWRSb3RhdGlvbkZsYWc7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV9mbGFncyAmPSB+YjJCb2R5LmVfZml4ZWRSb3RhdGlvbkZsYWc7XG4gICAgICB9XG4gICAgICB0aGlzLlJlc2V0TWFzc0RhdGEoKTtcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuSXNGaXhlZFJvdGF0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuICh0aGlzLm1fZmxhZ3MgJiBiMkJvZHkuZV9maXhlZFJvdGF0aW9uRmxhZykgPT0gYjJCb2R5LmVfZml4ZWRSb3RhdGlvbkZsYWc7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLlNldEFjdGl2ZSA9IGZ1bmN0aW9uIChmbGFnKSB7XG4gICAgICBpZiAoZmxhZyA9PSB0aGlzLklzQWN0aXZlKCkpIHtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBicm9hZFBoYXNlO1xuICAgICAgdmFyIGY7XG4gICAgICBpZiAoZmxhZykge1xuICAgICAgICAgdGhpcy5tX2ZsYWdzIHw9IGIyQm9keS5lX2FjdGl2ZUZsYWc7XG4gICAgICAgICBicm9hZFBoYXNlID0gdGhpcy5tX3dvcmxkLm1fY29udGFjdE1hbmFnZXIubV9icm9hZFBoYXNlO1xuICAgICAgICAgZm9yIChmID0gdGhpcy5tX2ZpeHR1cmVMaXN0O1xuICAgICAgICAgZjsgZiA9IGYubV9uZXh0KSB7XG4gICAgICAgICAgICBmLkNyZWF0ZVByb3h5KGJyb2FkUGhhc2UsIHRoaXMubV94Zik7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV9mbGFncyAmPSB+YjJCb2R5LmVfYWN0aXZlRmxhZztcbiAgICAgICAgIGJyb2FkUGhhc2UgPSB0aGlzLm1fd29ybGQubV9jb250YWN0TWFuYWdlci5tX2Jyb2FkUGhhc2U7XG4gICAgICAgICBmb3IgKGYgPSB0aGlzLm1fZml4dHVyZUxpc3Q7XG4gICAgICAgICBmOyBmID0gZi5tX25leHQpIHtcbiAgICAgICAgICAgIGYuRGVzdHJveVByb3h5KGJyb2FkUGhhc2UpO1xuICAgICAgICAgfVxuICAgICAgICAgdmFyIGNlID0gdGhpcy5tX2NvbnRhY3RMaXN0O1xuICAgICAgICAgd2hpbGUgKGNlKSB7XG4gICAgICAgICAgICB2YXIgY2UwID0gY2U7XG4gICAgICAgICAgICBjZSA9IGNlLm5leHQ7XG4gICAgICAgICAgICB0aGlzLm1fd29ybGQubV9jb250YWN0TWFuYWdlci5EZXN0cm95KGNlMC5jb250YWN0KTtcbiAgICAgICAgIH1cbiAgICAgICAgIHRoaXMubV9jb250YWN0TGlzdCA9IG51bGw7XG4gICAgICB9XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLklzQWN0aXZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuICh0aGlzLm1fZmxhZ3MgJiBiMkJvZHkuZV9hY3RpdmVGbGFnKSA9PSBiMkJvZHkuZV9hY3RpdmVGbGFnO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5Jc1NsZWVwaW5nQWxsb3dlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiAodGhpcy5tX2ZsYWdzICYgYjJCb2R5LmVfYWxsb3dTbGVlcEZsYWcpID09IGIyQm9keS5lX2FsbG93U2xlZXBGbGFnO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5HZXRGaXh0dXJlTGlzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fZml4dHVyZUxpc3Q7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLkdldEpvaW50TGlzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fam9pbnRMaXN0O1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5HZXRDb250cm9sbGVyTGlzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fY29udHJvbGxlckxpc3Q7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLkdldENvbnRhY3RMaXN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9jb250YWN0TGlzdDtcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuR2V0TmV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fbmV4dDtcbiAgIH1cbiAgIGIyQm9keS5wcm90b3R5cGUuR2V0VXNlckRhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3VzZXJEYXRhO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5TZXRVc2VyRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICB0aGlzLm1fdXNlckRhdGEgPSBkYXRhO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5HZXRXb3JsZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fd29ybGQ7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLmIyQm9keSA9IGZ1bmN0aW9uIChiZCwgd29ybGQpIHtcbiAgICAgIHRoaXMubV9mbGFncyA9IDA7XG4gICAgICBpZiAoYmQuYnVsbGV0KSB7XG4gICAgICAgICB0aGlzLm1fZmxhZ3MgfD0gYjJCb2R5LmVfYnVsbGV0RmxhZztcbiAgICAgIH1cbiAgICAgIGlmIChiZC5maXhlZFJvdGF0aW9uKSB7XG4gICAgICAgICB0aGlzLm1fZmxhZ3MgfD0gYjJCb2R5LmVfZml4ZWRSb3RhdGlvbkZsYWc7XG4gICAgICB9XG4gICAgICBpZiAoYmQuYWxsb3dTbGVlcCkge1xuICAgICAgICAgdGhpcy5tX2ZsYWdzIHw9IGIyQm9keS5lX2FsbG93U2xlZXBGbGFnO1xuICAgICAgfVxuICAgICAgaWYgKGJkLmF3YWtlKSB7XG4gICAgICAgICB0aGlzLm1fZmxhZ3MgfD0gYjJCb2R5LmVfYXdha2VGbGFnO1xuICAgICAgfVxuICAgICAgaWYgKGJkLmFjdGl2ZSkge1xuICAgICAgICAgdGhpcy5tX2ZsYWdzIHw9IGIyQm9keS5lX2FjdGl2ZUZsYWc7XG4gICAgICB9XG4gICAgICB0aGlzLm1fd29ybGQgPSB3b3JsZDtcbiAgICAgIHRoaXMubV94Zi5wb3NpdGlvbi5TZXRWKGJkLnBvc2l0aW9uKTtcbiAgICAgIHRoaXMubV94Zi5SLlNldChiZC5hbmdsZSk7XG4gICAgICB0aGlzLm1fc3dlZXAubG9jYWxDZW50ZXIuU2V0WmVybygpO1xuICAgICAgdGhpcy5tX3N3ZWVwLnQwID0gMS4wO1xuICAgICAgdGhpcy5tX3N3ZWVwLmEwID0gdGhpcy5tX3N3ZWVwLmEgPSBiZC5hbmdsZTtcbiAgICAgIHZhciB0TWF0ID0gdGhpcy5tX3hmLlI7XG4gICAgICB2YXIgdFZlYyA9IHRoaXMubV9zd2VlcC5sb2NhbENlbnRlcjtcbiAgICAgIHRoaXMubV9zd2VlcC5jLnggPSAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICB0aGlzLm1fc3dlZXAuYy55ID0gKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgdGhpcy5tX3N3ZWVwLmMueCArPSB0aGlzLm1feGYucG9zaXRpb24ueDtcbiAgICAgIHRoaXMubV9zd2VlcC5jLnkgKz0gdGhpcy5tX3hmLnBvc2l0aW9uLnk7XG4gICAgICB0aGlzLm1fc3dlZXAuYzAuU2V0Vih0aGlzLm1fc3dlZXAuYyk7XG4gICAgICB0aGlzLm1fam9pbnRMaXN0ID0gbnVsbDtcbiAgICAgIHRoaXMubV9jb250cm9sbGVyTGlzdCA9IG51bGw7XG4gICAgICB0aGlzLm1fY29udGFjdExpc3QgPSBudWxsO1xuICAgICAgdGhpcy5tX2NvbnRyb2xsZXJDb3VudCA9IDA7XG4gICAgICB0aGlzLm1fcHJldiA9IG51bGw7XG4gICAgICB0aGlzLm1fbmV4dCA9IG51bGw7XG4gICAgICB0aGlzLm1fbGluZWFyVmVsb2NpdHkuU2V0VihiZC5saW5lYXJWZWxvY2l0eSk7XG4gICAgICB0aGlzLm1fYW5ndWxhclZlbG9jaXR5ID0gYmQuYW5ndWxhclZlbG9jaXR5O1xuICAgICAgdGhpcy5tX2xpbmVhckRhbXBpbmcgPSBiZC5saW5lYXJEYW1waW5nO1xuICAgICAgdGhpcy5tX2FuZ3VsYXJEYW1waW5nID0gYmQuYW5ndWxhckRhbXBpbmc7XG4gICAgICB0aGlzLm1fZm9yY2UuU2V0KDAuMCwgMC4wKTtcbiAgICAgIHRoaXMubV90b3JxdWUgPSAwLjA7XG4gICAgICB0aGlzLm1fc2xlZXBUaW1lID0gMC4wO1xuICAgICAgdGhpcy5tX3R5cGUgPSBiZC50eXBlO1xuICAgICAgaWYgKHRoaXMubV90eXBlID09IGIyQm9keS5iMl9keW5hbWljQm9keSkge1xuICAgICAgICAgdGhpcy5tX21hc3MgPSAxLjA7XG4gICAgICAgICB0aGlzLm1faW52TWFzcyA9IDEuMDtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdGhpcy5tX21hc3MgPSAwLjA7XG4gICAgICAgICB0aGlzLm1faW52TWFzcyA9IDAuMDtcbiAgICAgIH1cbiAgICAgIHRoaXMubV9JID0gMC4wO1xuICAgICAgdGhpcy5tX2ludkkgPSAwLjA7XG4gICAgICB0aGlzLm1faW5lcnRpYVNjYWxlID0gYmQuaW5lcnRpYVNjYWxlO1xuICAgICAgdGhpcy5tX3VzZXJEYXRhID0gYmQudXNlckRhdGE7XG4gICAgICB0aGlzLm1fZml4dHVyZUxpc3QgPSBudWxsO1xuICAgICAgdGhpcy5tX2ZpeHR1cmVDb3VudCA9IDA7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLlN5bmNocm9uaXplRml4dHVyZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgeGYxID0gYjJCb2R5LnNfeGYxO1xuICAgICAgeGYxLlIuU2V0KHRoaXMubV9zd2VlcC5hMCk7XG4gICAgICB2YXIgdE1hdCA9IHhmMS5SO1xuICAgICAgdmFyIHRWZWMgPSB0aGlzLm1fc3dlZXAubG9jYWxDZW50ZXI7XG4gICAgICB4ZjEucG9zaXRpb24ueCA9IHRoaXMubV9zd2VlcC5jMC54IC0gKHRNYXQuY29sMS54ICogdFZlYy54ICsgdE1hdC5jb2wyLnggKiB0VmVjLnkpO1xuICAgICAgeGYxLnBvc2l0aW9uLnkgPSB0aGlzLm1fc3dlZXAuYzAueSAtICh0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55KTtcbiAgICAgIHZhciBmO1xuICAgICAgdmFyIGJyb2FkUGhhc2UgPSB0aGlzLm1fd29ybGQubV9jb250YWN0TWFuYWdlci5tX2Jyb2FkUGhhc2U7XG4gICAgICBmb3IgKGYgPSB0aGlzLm1fZml4dHVyZUxpc3Q7XG4gICAgICBmOyBmID0gZi5tX25leHQpIHtcbiAgICAgICAgIGYuU3luY2hyb25pemUoYnJvYWRQaGFzZSwgeGYxLCB0aGlzLm1feGYpO1xuICAgICAgfVxuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5TeW5jaHJvbml6ZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubV94Zi5SLlNldCh0aGlzLm1fc3dlZXAuYSk7XG4gICAgICB2YXIgdE1hdCA9IHRoaXMubV94Zi5SO1xuICAgICAgdmFyIHRWZWMgPSB0aGlzLm1fc3dlZXAubG9jYWxDZW50ZXI7XG4gICAgICB0aGlzLm1feGYucG9zaXRpb24ueCA9IHRoaXMubV9zd2VlcC5jLnggLSAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICB0aGlzLm1feGYucG9zaXRpb24ueSA9IHRoaXMubV9zd2VlcC5jLnkgLSAodE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueSk7XG4gICB9XG4gICBiMkJvZHkucHJvdG90eXBlLlNob3VsZENvbGxpZGUgPSBmdW5jdGlvbiAob3RoZXIpIHtcbiAgICAgIGlmICh0aGlzLm1fdHlwZSAhPSBiMkJvZHkuYjJfZHluYW1pY0JvZHkgJiYgb3RoZXIubV90eXBlICE9IGIyQm9keS5iMl9keW5hbWljQm9keSkge1xuICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgZm9yICh2YXIgam4gPSB0aGlzLm1fam9pbnRMaXN0OyBqbjsgam4gPSBqbi5uZXh0KSB7XG4gICAgICAgICBpZiAoam4ub3RoZXIgPT0gb3RoZXIpIGlmIChqbi5qb2ludC5tX2NvbGxpZGVDb25uZWN0ZWQgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgfVxuICAgYjJCb2R5LnByb3RvdHlwZS5BZHZhbmNlID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIGlmICh0ID09PSB1bmRlZmluZWQpIHQgPSAwO1xuICAgICAgdGhpcy5tX3N3ZWVwLkFkdmFuY2UodCk7XG4gICAgICB0aGlzLm1fc3dlZXAuYy5TZXRWKHRoaXMubV9zd2VlcC5jMCk7XG4gICAgICB0aGlzLm1fc3dlZXAuYSA9IHRoaXMubV9zd2VlcC5hMDtcbiAgICAgIHRoaXMuU3luY2hyb25pemVUcmFuc2Zvcm0oKTtcbiAgIH1cbiAgIEJveDJELnBvc3REZWZzLnB1c2goZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJCb2R5LnNfeGYxID0gbmV3IGIyVHJhbnNmb3JtKCk7XG4gICAgICBCb3gyRC5EeW5hbWljcy5iMkJvZHkuZV9pc2xhbmRGbGFnID0gMHgwMDAxO1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJCb2R5LmVfYXdha2VGbGFnID0gMHgwMDAyO1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJCb2R5LmVfYWxsb3dTbGVlcEZsYWcgPSAweDAwMDQ7XG4gICAgICBCb3gyRC5EeW5hbWljcy5iMkJvZHkuZV9idWxsZXRGbGFnID0gMHgwMDA4O1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJCb2R5LmVfZml4ZWRSb3RhdGlvbkZsYWcgPSAweDAwMTA7XG4gICAgICBCb3gyRC5EeW5hbWljcy5iMkJvZHkuZV9hY3RpdmVGbGFnID0gMHgwMDIwO1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJCb2R5LmIyX3N0YXRpY0JvZHkgPSAwO1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJCb2R5LmIyX2tpbmVtYXRpY0JvZHkgPSAxO1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJCb2R5LmIyX2R5bmFtaWNCb2R5ID0gMjtcbiAgIH0pO1xuICAgYjJCb2R5RGVmLmIyQm9keURlZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLmxpbmVhclZlbG9jaXR5ID0gbmV3IGIyVmVjMigpO1xuICAgfTtcbiAgIGIyQm9keURlZi5wcm90b3R5cGUuYjJCb2R5RGVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy51c2VyRGF0YSA9IG51bGw7XG4gICAgICB0aGlzLnBvc2l0aW9uLlNldCgwLjAsIDAuMCk7XG4gICAgICB0aGlzLmFuZ2xlID0gMC4wO1xuICAgICAgdGhpcy5saW5lYXJWZWxvY2l0eS5TZXQoMCwgMCk7XG4gICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IDAuMDtcbiAgICAgIHRoaXMubGluZWFyRGFtcGluZyA9IDAuMDtcbiAgICAgIHRoaXMuYW5ndWxhckRhbXBpbmcgPSAwLjA7XG4gICAgICB0aGlzLmFsbG93U2xlZXAgPSB0cnVlO1xuICAgICAgdGhpcy5hd2FrZSA9IHRydWU7XG4gICAgICB0aGlzLmZpeGVkUm90YXRpb24gPSBmYWxzZTtcbiAgICAgIHRoaXMuYnVsbGV0ID0gZmFsc2U7XG4gICAgICB0aGlzLnR5cGUgPSBiMkJvZHkuYjJfc3RhdGljQm9keTtcbiAgICAgIHRoaXMuYWN0aXZlID0gdHJ1ZTtcbiAgICAgIHRoaXMuaW5lcnRpYVNjYWxlID0gMS4wO1xuICAgfVxuICAgYjJDb250YWN0RmlsdGVyLmIyQ29udGFjdEZpbHRlciA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJDb250YWN0RmlsdGVyLnByb3RvdHlwZS5TaG91bGRDb2xsaWRlID0gZnVuY3Rpb24gKGZpeHR1cmVBLCBmaXh0dXJlQikge1xuICAgICAgdmFyIGZpbHRlcjEgPSBmaXh0dXJlQS5HZXRGaWx0ZXJEYXRhKCk7XG4gICAgICB2YXIgZmlsdGVyMiA9IGZpeHR1cmVCLkdldEZpbHRlckRhdGEoKTtcbiAgICAgIGlmIChmaWx0ZXIxLmdyb3VwSW5kZXggPT0gZmlsdGVyMi5ncm91cEluZGV4ICYmIGZpbHRlcjEuZ3JvdXBJbmRleCAhPSAwKSB7XG4gICAgICAgICByZXR1cm4gZmlsdGVyMS5ncm91cEluZGV4ID4gMDtcbiAgICAgIH1cbiAgICAgIHZhciBjb2xsaWRlID0gKGZpbHRlcjEubWFza0JpdHMgJiBmaWx0ZXIyLmNhdGVnb3J5Qml0cykgIT0gMCAmJiAoZmlsdGVyMS5jYXRlZ29yeUJpdHMgJiBmaWx0ZXIyLm1hc2tCaXRzKSAhPSAwO1xuICAgICAgcmV0dXJuIGNvbGxpZGU7XG4gICB9XG4gICBiMkNvbnRhY3RGaWx0ZXIucHJvdG90eXBlLlJheUNvbGxpZGUgPSBmdW5jdGlvbiAodXNlckRhdGEsIGZpeHR1cmUpIHtcbiAgICAgIGlmICghdXNlckRhdGEpIHJldHVybiB0cnVlO1xuICAgICAgcmV0dXJuIHRoaXMuU2hvdWxkQ29sbGlkZSgodXNlckRhdGEgaW5zdGFuY2VvZiBiMkZpeHR1cmUgPyB1c2VyRGF0YSA6IG51bGwpLCBmaXh0dXJlKTtcbiAgIH1cbiAgIEJveDJELnBvc3REZWZzLnB1c2goZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJDb250YWN0RmlsdGVyLmIyX2RlZmF1bHRGaWx0ZXIgPSBuZXcgYjJDb250YWN0RmlsdGVyKCk7XG4gICB9KTtcbiAgIGIyQ29udGFjdEltcHVsc2UuYjJDb250YWN0SW1wdWxzZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubm9ybWFsSW1wdWxzZXMgPSBuZXcgVmVjdG9yX2Eyal9OdW1iZXIoYjJTZXR0aW5ncy5iMl9tYXhNYW5pZm9sZFBvaW50cyk7XG4gICAgICB0aGlzLnRhbmdlbnRJbXB1bHNlcyA9IG5ldyBWZWN0b3JfYTJqX051bWJlcihiMlNldHRpbmdzLmIyX21heE1hbmlmb2xkUG9pbnRzKTtcbiAgIH07XG4gICBiMkNvbnRhY3RMaXN0ZW5lci5iMkNvbnRhY3RMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJDb250YWN0TGlzdGVuZXIucHJvdG90eXBlLkJlZ2luQ29udGFjdCA9IGZ1bmN0aW9uIChjb250YWN0KSB7fVxuICAgYjJDb250YWN0TGlzdGVuZXIucHJvdG90eXBlLkVuZENvbnRhY3QgPSBmdW5jdGlvbiAoY29udGFjdCkge31cbiAgIGIyQ29udGFjdExpc3RlbmVyLnByb3RvdHlwZS5QcmVTb2x2ZSA9IGZ1bmN0aW9uIChjb250YWN0LCBvbGRNYW5pZm9sZCkge31cbiAgIGIyQ29udGFjdExpc3RlbmVyLnByb3RvdHlwZS5Qb3N0U29sdmUgPSBmdW5jdGlvbiAoY29udGFjdCwgaW1wdWxzZSkge31cbiAgIEJveDJELnBvc3REZWZzLnB1c2goZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJDb250YWN0TGlzdGVuZXIuYjJfZGVmYXVsdExpc3RlbmVyID0gbmV3IGIyQ29udGFjdExpc3RlbmVyKCk7XG4gICB9KTtcbiAgIGIyQ29udGFjdE1hbmFnZXIuYjJDb250YWN0TWFuYWdlciA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJDb250YWN0TWFuYWdlci5wcm90b3R5cGUuYjJDb250YWN0TWFuYWdlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubV93b3JsZCA9IG51bGw7XG4gICAgICB0aGlzLm1fY29udGFjdENvdW50ID0gMDtcbiAgICAgIHRoaXMubV9jb250YWN0RmlsdGVyID0gYjJDb250YWN0RmlsdGVyLmIyX2RlZmF1bHRGaWx0ZXI7XG4gICAgICB0aGlzLm1fY29udGFjdExpc3RlbmVyID0gYjJDb250YWN0TGlzdGVuZXIuYjJfZGVmYXVsdExpc3RlbmVyO1xuICAgICAgdGhpcy5tX2NvbnRhY3RGYWN0b3J5ID0gbmV3IGIyQ29udGFjdEZhY3RvcnkodGhpcy5tX2FsbG9jYXRvcik7XG4gICAgICB0aGlzLm1fYnJvYWRQaGFzZSA9IG5ldyBiMkR5bmFtaWNUcmVlQnJvYWRQaGFzZSgpO1xuICAgfVxuICAgYjJDb250YWN0TWFuYWdlci5wcm90b3R5cGUuQWRkUGFpciA9IGZ1bmN0aW9uIChwcm94eVVzZXJEYXRhQSwgcHJveHlVc2VyRGF0YUIpIHtcbiAgICAgIHZhciBmaXh0dXJlQSA9IChwcm94eVVzZXJEYXRhQSBpbnN0YW5jZW9mIGIyRml4dHVyZSA/IHByb3h5VXNlckRhdGFBIDogbnVsbCk7XG4gICAgICB2YXIgZml4dHVyZUIgPSAocHJveHlVc2VyRGF0YUIgaW5zdGFuY2VvZiBiMkZpeHR1cmUgPyBwcm94eVVzZXJEYXRhQiA6IG51bGwpO1xuICAgICAgdmFyIGJvZHlBID0gZml4dHVyZUEuR2V0Qm9keSgpO1xuICAgICAgdmFyIGJvZHlCID0gZml4dHVyZUIuR2V0Qm9keSgpO1xuICAgICAgaWYgKGJvZHlBID09IGJvZHlCKSByZXR1cm47XG4gICAgICB2YXIgZWRnZSA9IGJvZHlCLkdldENvbnRhY3RMaXN0KCk7XG4gICAgICB3aGlsZSAoZWRnZSkge1xuICAgICAgICAgaWYgKGVkZ2Uub3RoZXIgPT0gYm9keUEpIHtcbiAgICAgICAgICAgIHZhciBmQSA9IGVkZ2UuY29udGFjdC5HZXRGaXh0dXJlQSgpO1xuICAgICAgICAgICAgdmFyIGZCID0gZWRnZS5jb250YWN0LkdldEZpeHR1cmVCKCk7XG4gICAgICAgICAgICBpZiAoZkEgPT0gZml4dHVyZUEgJiYgZkIgPT0gZml4dHVyZUIpIHJldHVybjtcbiAgICAgICAgICAgIGlmIChmQSA9PSBmaXh0dXJlQiAmJiBmQiA9PSBmaXh0dXJlQSkgcmV0dXJuO1xuICAgICAgICAgfVxuICAgICAgICAgZWRnZSA9IGVkZ2UubmV4dDtcbiAgICAgIH1cbiAgICAgIGlmIChib2R5Qi5TaG91bGRDb2xsaWRlKGJvZHlBKSA9PSBmYWxzZSkge1xuICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMubV9jb250YWN0RmlsdGVyLlNob3VsZENvbGxpZGUoZml4dHVyZUEsIGZpeHR1cmVCKSA9PSBmYWxzZSkge1xuICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGMgPSB0aGlzLm1fY29udGFjdEZhY3RvcnkuQ3JlYXRlKGZpeHR1cmVBLCBmaXh0dXJlQik7XG4gICAgICBmaXh0dXJlQSA9IGMuR2V0Rml4dHVyZUEoKTtcbiAgICAgIGZpeHR1cmVCID0gYy5HZXRGaXh0dXJlQigpO1xuICAgICAgYm9keUEgPSBmaXh0dXJlQS5tX2JvZHk7XG4gICAgICBib2R5QiA9IGZpeHR1cmVCLm1fYm9keTtcbiAgICAgIGMubV9wcmV2ID0gbnVsbDtcbiAgICAgIGMubV9uZXh0ID0gdGhpcy5tX3dvcmxkLm1fY29udGFjdExpc3Q7XG4gICAgICBpZiAodGhpcy5tX3dvcmxkLm1fY29udGFjdExpc3QgIT0gbnVsbCkge1xuICAgICAgICAgdGhpcy5tX3dvcmxkLm1fY29udGFjdExpc3QubV9wcmV2ID0gYztcbiAgICAgIH1cbiAgICAgIHRoaXMubV93b3JsZC5tX2NvbnRhY3RMaXN0ID0gYztcbiAgICAgIGMubV9ub2RlQS5jb250YWN0ID0gYztcbiAgICAgIGMubV9ub2RlQS5vdGhlciA9IGJvZHlCO1xuICAgICAgYy5tX25vZGVBLnByZXYgPSBudWxsO1xuICAgICAgYy5tX25vZGVBLm5leHQgPSBib2R5QS5tX2NvbnRhY3RMaXN0O1xuICAgICAgaWYgKGJvZHlBLm1fY29udGFjdExpc3QgIT0gbnVsbCkge1xuICAgICAgICAgYm9keUEubV9jb250YWN0TGlzdC5wcmV2ID0gYy5tX25vZGVBO1xuICAgICAgfVxuICAgICAgYm9keUEubV9jb250YWN0TGlzdCA9IGMubV9ub2RlQTtcbiAgICAgIGMubV9ub2RlQi5jb250YWN0ID0gYztcbiAgICAgIGMubV9ub2RlQi5vdGhlciA9IGJvZHlBO1xuICAgICAgYy5tX25vZGVCLnByZXYgPSBudWxsO1xuICAgICAgYy5tX25vZGVCLm5leHQgPSBib2R5Qi5tX2NvbnRhY3RMaXN0O1xuICAgICAgaWYgKGJvZHlCLm1fY29udGFjdExpc3QgIT0gbnVsbCkge1xuICAgICAgICAgYm9keUIubV9jb250YWN0TGlzdC5wcmV2ID0gYy5tX25vZGVCO1xuICAgICAgfVxuICAgICAgYm9keUIubV9jb250YWN0TGlzdCA9IGMubV9ub2RlQjtcbiAgICAgICsrdGhpcy5tX3dvcmxkLm1fY29udGFjdENvdW50O1xuICAgICAgcmV0dXJuO1xuICAgfVxuICAgYjJDb250YWN0TWFuYWdlci5wcm90b3R5cGUuRmluZE5ld0NvbnRhY3RzID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX2Jyb2FkUGhhc2UuVXBkYXRlUGFpcnMoQm94MkQuZ2VuZXJhdGVDYWxsYmFjayh0aGlzLCB0aGlzLkFkZFBhaXIpKTtcbiAgIH1cbiAgIGIyQ29udGFjdE1hbmFnZXIucHJvdG90eXBlLkRlc3Ryb3kgPSBmdW5jdGlvbiAoYykge1xuICAgICAgdmFyIGZpeHR1cmVBID0gYy5HZXRGaXh0dXJlQSgpO1xuICAgICAgdmFyIGZpeHR1cmVCID0gYy5HZXRGaXh0dXJlQigpO1xuICAgICAgdmFyIGJvZHlBID0gZml4dHVyZUEuR2V0Qm9keSgpO1xuICAgICAgdmFyIGJvZHlCID0gZml4dHVyZUIuR2V0Qm9keSgpO1xuICAgICAgaWYgKGMuSXNUb3VjaGluZygpKSB7XG4gICAgICAgICB0aGlzLm1fY29udGFjdExpc3RlbmVyLkVuZENvbnRhY3QoYyk7XG4gICAgICB9XG4gICAgICBpZiAoYy5tX3ByZXYpIHtcbiAgICAgICAgIGMubV9wcmV2Lm1fbmV4dCA9IGMubV9uZXh0O1xuICAgICAgfVxuICAgICAgaWYgKGMubV9uZXh0KSB7XG4gICAgICAgICBjLm1fbmV4dC5tX3ByZXYgPSBjLm1fcHJldjtcbiAgICAgIH1cbiAgICAgIGlmIChjID09IHRoaXMubV93b3JsZC5tX2NvbnRhY3RMaXN0KSB7XG4gICAgICAgICB0aGlzLm1fd29ybGQubV9jb250YWN0TGlzdCA9IGMubV9uZXh0O1xuICAgICAgfVxuICAgICAgaWYgKGMubV9ub2RlQS5wcmV2KSB7XG4gICAgICAgICBjLm1fbm9kZUEucHJldi5uZXh0ID0gYy5tX25vZGVBLm5leHQ7XG4gICAgICB9XG4gICAgICBpZiAoYy5tX25vZGVBLm5leHQpIHtcbiAgICAgICAgIGMubV9ub2RlQS5uZXh0LnByZXYgPSBjLm1fbm9kZUEucHJldjtcbiAgICAgIH1cbiAgICAgIGlmIChjLm1fbm9kZUEgPT0gYm9keUEubV9jb250YWN0TGlzdCkge1xuICAgICAgICAgYm9keUEubV9jb250YWN0TGlzdCA9IGMubV9ub2RlQS5uZXh0O1xuICAgICAgfVxuICAgICAgaWYgKGMubV9ub2RlQi5wcmV2KSB7XG4gICAgICAgICBjLm1fbm9kZUIucHJldi5uZXh0ID0gYy5tX25vZGVCLm5leHQ7XG4gICAgICB9XG4gICAgICBpZiAoYy5tX25vZGVCLm5leHQpIHtcbiAgICAgICAgIGMubV9ub2RlQi5uZXh0LnByZXYgPSBjLm1fbm9kZUIucHJldjtcbiAgICAgIH1cbiAgICAgIGlmIChjLm1fbm9kZUIgPT0gYm9keUIubV9jb250YWN0TGlzdCkge1xuICAgICAgICAgYm9keUIubV9jb250YWN0TGlzdCA9IGMubV9ub2RlQi5uZXh0O1xuICAgICAgfVxuICAgICAgdGhpcy5tX2NvbnRhY3RGYWN0b3J5LkRlc3Ryb3koYyk7XG4gICAgICAtLXRoaXMubV9jb250YWN0Q291bnQ7XG4gICB9XG4gICBiMkNvbnRhY3RNYW5hZ2VyLnByb3RvdHlwZS5Db2xsaWRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGMgPSB0aGlzLm1fd29ybGQubV9jb250YWN0TGlzdDtcbiAgICAgIHdoaWxlIChjKSB7XG4gICAgICAgICB2YXIgZml4dHVyZUEgPSBjLkdldEZpeHR1cmVBKCk7XG4gICAgICAgICB2YXIgZml4dHVyZUIgPSBjLkdldEZpeHR1cmVCKCk7XG4gICAgICAgICB2YXIgYm9keUEgPSBmaXh0dXJlQS5HZXRCb2R5KCk7XG4gICAgICAgICB2YXIgYm9keUIgPSBmaXh0dXJlQi5HZXRCb2R5KCk7XG4gICAgICAgICBpZiAoYm9keUEuSXNBd2FrZSgpID09IGZhbHNlICYmIGJvZHlCLklzQXdha2UoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgYyA9IGMuR2V0TmV4dCgpO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICB9XG4gICAgICAgICBpZiAoYy5tX2ZsYWdzICYgYjJDb250YWN0LmVfZmlsdGVyRmxhZykge1xuICAgICAgICAgICAgaWYgKGJvZHlCLlNob3VsZENvbGxpZGUoYm9keUEpID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICB2YXIgY051a2UgPSBjO1xuICAgICAgICAgICAgICAgYyA9IGNOdWtlLkdldE5leHQoKTtcbiAgICAgICAgICAgICAgIHRoaXMuRGVzdHJveShjTnVrZSk7XG4gICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLm1fY29udGFjdEZpbHRlci5TaG91bGRDb2xsaWRlKGZpeHR1cmVBLCBmaXh0dXJlQikgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgIGNOdWtlID0gYztcbiAgICAgICAgICAgICAgIGMgPSBjTnVrZS5HZXROZXh0KCk7XG4gICAgICAgICAgICAgICB0aGlzLkRlc3Ryb3koY051a2UpO1xuICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjLm1fZmxhZ3MgJj0gfmIyQ29udGFjdC5lX2ZpbHRlckZsYWc7XG4gICAgICAgICB9XG4gICAgICAgICB2YXIgcHJveHlBID0gZml4dHVyZUEubV9wcm94eTtcbiAgICAgICAgIHZhciBwcm94eUIgPSBmaXh0dXJlQi5tX3Byb3h5O1xuICAgICAgICAgdmFyIG92ZXJsYXAgPSB0aGlzLm1fYnJvYWRQaGFzZS5UZXN0T3ZlcmxhcChwcm94eUEsIHByb3h5Qik7XG4gICAgICAgICBpZiAob3ZlcmxhcCA9PSBmYWxzZSkge1xuICAgICAgICAgICAgY051a2UgPSBjO1xuICAgICAgICAgICAgYyA9IGNOdWtlLkdldE5leHQoKTtcbiAgICAgICAgICAgIHRoaXMuRGVzdHJveShjTnVrZSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgIH1cbiAgICAgICAgIGMuVXBkYXRlKHRoaXMubV9jb250YWN0TGlzdGVuZXIpO1xuICAgICAgICAgYyA9IGMuR2V0TmV4dCgpO1xuICAgICAgfVxuICAgfVxuICAgQm94MkQucG9zdERlZnMucHVzaChmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5iMkNvbnRhY3RNYW5hZ2VyLnNfZXZhbENQID0gbmV3IGIyQ29udGFjdFBvaW50KCk7XG4gICB9KTtcbiAgIGIyRGVidWdEcmF3LmIyRGVidWdEcmF3ID0gZnVuY3Rpb24gKCkge307XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuYjJEZWJ1Z0RyYXcgPSBmdW5jdGlvbiAoKSB7fVxuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLlNldEZsYWdzID0gZnVuY3Rpb24gKGZsYWdzKSB7XG4gICAgICBpZiAoZmxhZ3MgPT09IHVuZGVmaW5lZCkgZmxhZ3MgPSAwO1xuICAgfVxuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLkdldEZsYWdzID0gZnVuY3Rpb24gKCkge31cbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5BcHBlbmRGbGFncyA9IGZ1bmN0aW9uIChmbGFncykge1xuICAgICAgaWYgKGZsYWdzID09PSB1bmRlZmluZWQpIGZsYWdzID0gMDtcbiAgIH1cbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5DbGVhckZsYWdzID0gZnVuY3Rpb24gKGZsYWdzKSB7XG4gICAgICBpZiAoZmxhZ3MgPT09IHVuZGVmaW5lZCkgZmxhZ3MgPSAwO1xuICAgfVxuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLlNldFNwcml0ZSA9IGZ1bmN0aW9uIChzcHJpdGUpIHt9XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuR2V0U3ByaXRlID0gZnVuY3Rpb24gKCkge31cbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5TZXREcmF3U2NhbGUgPSBmdW5jdGlvbiAoZHJhd1NjYWxlKSB7XG4gICAgICBpZiAoZHJhd1NjYWxlID09PSB1bmRlZmluZWQpIGRyYXdTY2FsZSA9IDA7XG4gICB9XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuR2V0RHJhd1NjYWxlID0gZnVuY3Rpb24gKCkge31cbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5TZXRMaW5lVGhpY2tuZXNzID0gZnVuY3Rpb24gKGxpbmVUaGlja25lc3MpIHtcbiAgICAgIGlmIChsaW5lVGhpY2tuZXNzID09PSB1bmRlZmluZWQpIGxpbmVUaGlja25lc3MgPSAwO1xuICAgfVxuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLkdldExpbmVUaGlja25lc3MgPSBmdW5jdGlvbiAoKSB7fVxuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLlNldEFscGhhID0gZnVuY3Rpb24gKGFscGhhKSB7XG4gICAgICBpZiAoYWxwaGEgPT09IHVuZGVmaW5lZCkgYWxwaGEgPSAwO1xuICAgfVxuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLkdldEFscGhhID0gZnVuY3Rpb24gKCkge31cbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5TZXRGaWxsQWxwaGEgPSBmdW5jdGlvbiAoYWxwaGEpIHtcbiAgICAgIGlmIChhbHBoYSA9PT0gdW5kZWZpbmVkKSBhbHBoYSA9IDA7XG4gICB9XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuR2V0RmlsbEFscGhhID0gZnVuY3Rpb24gKCkge31cbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5TZXRYRm9ybVNjYWxlID0gZnVuY3Rpb24gKHhmb3JtU2NhbGUpIHtcbiAgICAgIGlmICh4Zm9ybVNjYWxlID09PSB1bmRlZmluZWQpIHhmb3JtU2NhbGUgPSAwO1xuICAgfVxuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLkdldFhGb3JtU2NhbGUgPSBmdW5jdGlvbiAoKSB7fVxuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLkRyYXdQb2x5Z29uID0gZnVuY3Rpb24gKHZlcnRpY2VzLCB2ZXJ0ZXhDb3VudCwgY29sb3IpIHtcbiAgICAgIGlmICh2ZXJ0ZXhDb3VudCA9PT0gdW5kZWZpbmVkKSB2ZXJ0ZXhDb3VudCA9IDA7XG4gICB9XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuRHJhd1NvbGlkUG9seWdvbiA9IGZ1bmN0aW9uICh2ZXJ0aWNlcywgdmVydGV4Q291bnQsIGNvbG9yKSB7XG4gICAgICBpZiAodmVydGV4Q291bnQgPT09IHVuZGVmaW5lZCkgdmVydGV4Q291bnQgPSAwO1xuICAgfVxuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLkRyYXdDaXJjbGUgPSBmdW5jdGlvbiAoY2VudGVyLCByYWRpdXMsIGNvbG9yKSB7XG4gICAgICBpZiAocmFkaXVzID09PSB1bmRlZmluZWQpIHJhZGl1cyA9IDA7XG4gICB9XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuRHJhd1NvbGlkQ2lyY2xlID0gZnVuY3Rpb24gKGNlbnRlciwgcmFkaXVzLCBheGlzLCBjb2xvcikge1xuICAgICAgaWYgKHJhZGl1cyA9PT0gdW5kZWZpbmVkKSByYWRpdXMgPSAwO1xuICAgfVxuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLkRyYXdTZWdtZW50ID0gZnVuY3Rpb24gKHAxLCBwMiwgY29sb3IpIHt9XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuRHJhd1RyYW5zZm9ybSA9IGZ1bmN0aW9uICh4Zikge31cbiAgIEJveDJELnBvc3REZWZzLnB1c2goZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJEZWJ1Z0RyYXcuZV9zaGFwZUJpdCA9IDB4MDAwMTtcbiAgICAgIEJveDJELkR5bmFtaWNzLmIyRGVidWdEcmF3LmVfam9pbnRCaXQgPSAweDAwMDI7XG4gICAgICBCb3gyRC5EeW5hbWljcy5iMkRlYnVnRHJhdy5lX2FhYmJCaXQgPSAweDAwMDQ7XG4gICAgICBCb3gyRC5EeW5hbWljcy5iMkRlYnVnRHJhdy5lX3BhaXJCaXQgPSAweDAwMDg7XG4gICAgICBCb3gyRC5EeW5hbWljcy5iMkRlYnVnRHJhdy5lX2NlbnRlck9mTWFzc0JpdCA9IDB4MDAxMDtcbiAgICAgIEJveDJELkR5bmFtaWNzLmIyRGVidWdEcmF3LmVfY29udHJvbGxlckJpdCA9IDB4MDAyMDtcbiAgIH0pO1xuICAgYjJEZXN0cnVjdGlvbkxpc3RlbmVyLmIyRGVzdHJ1Y3Rpb25MaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJEZXN0cnVjdGlvbkxpc3RlbmVyLnByb3RvdHlwZS5TYXlHb29kYnllSm9pbnQgPSBmdW5jdGlvbiAoam9pbnQpIHt9XG4gICBiMkRlc3RydWN0aW9uTGlzdGVuZXIucHJvdG90eXBlLlNheUdvb2RieWVGaXh0dXJlID0gZnVuY3Rpb24gKGZpeHR1cmUpIHt9XG4gICBiMkZpbHRlckRhdGEuYjJGaWx0ZXJEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5jYXRlZ29yeUJpdHMgPSAweDAwMDE7XG4gICAgICB0aGlzLm1hc2tCaXRzID0gMHhGRkZGO1xuICAgICAgdGhpcy5ncm91cEluZGV4ID0gMDtcbiAgIH07XG4gICBiMkZpbHRlckRhdGEucHJvdG90eXBlLkNvcHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgY29weSA9IG5ldyBiMkZpbHRlckRhdGEoKTtcbiAgICAgIGNvcHkuY2F0ZWdvcnlCaXRzID0gdGhpcy5jYXRlZ29yeUJpdHM7XG4gICAgICBjb3B5Lm1hc2tCaXRzID0gdGhpcy5tYXNrQml0cztcbiAgICAgIGNvcHkuZ3JvdXBJbmRleCA9IHRoaXMuZ3JvdXBJbmRleDtcbiAgICAgIHJldHVybiBjb3B5O1xuICAgfVxuICAgYjJGaXh0dXJlLmIyRml4dHVyZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubV9maWx0ZXIgPSBuZXcgYjJGaWx0ZXJEYXRhKCk7XG4gICB9O1xuICAgYjJGaXh0dXJlLnByb3RvdHlwZS5HZXRUeXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9zaGFwZS5HZXRUeXBlKCk7XG4gICB9XG4gICBiMkZpeHR1cmUucHJvdG90eXBlLkdldFNoYXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9zaGFwZTtcbiAgIH1cbiAgIGIyRml4dHVyZS5wcm90b3R5cGUuU2V0U2Vuc29yID0gZnVuY3Rpb24gKHNlbnNvcikge1xuICAgICAgaWYgKHRoaXMubV9pc1NlbnNvciA9PSBzZW5zb3IpIHJldHVybjtcbiAgICAgIHRoaXMubV9pc1NlbnNvciA9IHNlbnNvcjtcbiAgICAgIGlmICh0aGlzLm1fYm9keSA9PSBudWxsKSByZXR1cm47XG4gICAgICB2YXIgZWRnZSA9IHRoaXMubV9ib2R5LkdldENvbnRhY3RMaXN0KCk7XG4gICAgICB3aGlsZSAoZWRnZSkge1xuICAgICAgICAgdmFyIGNvbnRhY3QgPSBlZGdlLmNvbnRhY3Q7XG4gICAgICAgICB2YXIgZml4dHVyZUEgPSBjb250YWN0LkdldEZpeHR1cmVBKCk7XG4gICAgICAgICB2YXIgZml4dHVyZUIgPSBjb250YWN0LkdldEZpeHR1cmVCKCk7XG4gICAgICAgICBpZiAoZml4dHVyZUEgPT0gdGhpcyB8fCBmaXh0dXJlQiA9PSB0aGlzKSBjb250YWN0LlNldFNlbnNvcihmaXh0dXJlQS5Jc1NlbnNvcigpIHx8IGZpeHR1cmVCLklzU2Vuc29yKCkpO1xuICAgICAgICAgZWRnZSA9IGVkZ2UubmV4dDtcbiAgICAgIH1cbiAgIH1cbiAgIGIyRml4dHVyZS5wcm90b3R5cGUuSXNTZW5zb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2lzU2Vuc29yO1xuICAgfVxuICAgYjJGaXh0dXJlLnByb3RvdHlwZS5TZXRGaWx0ZXJEYXRhID0gZnVuY3Rpb24gKGZpbHRlcikge1xuICAgICAgdGhpcy5tX2ZpbHRlciA9IGZpbHRlci5Db3B5KCk7XG4gICAgICBpZiAodGhpcy5tX2JvZHkpIHJldHVybjtcbiAgICAgIHZhciBlZGdlID0gdGhpcy5tX2JvZHkuR2V0Q29udGFjdExpc3QoKTtcbiAgICAgIHdoaWxlIChlZGdlKSB7XG4gICAgICAgICB2YXIgY29udGFjdCA9IGVkZ2UuY29udGFjdDtcbiAgICAgICAgIHZhciBmaXh0dXJlQSA9IGNvbnRhY3QuR2V0Rml4dHVyZUEoKTtcbiAgICAgICAgIHZhciBmaXh0dXJlQiA9IGNvbnRhY3QuR2V0Rml4dHVyZUIoKTtcbiAgICAgICAgIGlmIChmaXh0dXJlQSA9PSB0aGlzIHx8IGZpeHR1cmVCID09IHRoaXMpIGNvbnRhY3QuRmxhZ0ZvckZpbHRlcmluZygpO1xuICAgICAgICAgZWRnZSA9IGVkZ2UubmV4dDtcbiAgICAgIH1cbiAgIH1cbiAgIGIyRml4dHVyZS5wcm90b3R5cGUuR2V0RmlsdGVyRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fZmlsdGVyLkNvcHkoKTtcbiAgIH1cbiAgIGIyRml4dHVyZS5wcm90b3R5cGUuR2V0Qm9keSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fYm9keTtcbiAgIH1cbiAgIGIyRml4dHVyZS5wcm90b3R5cGUuR2V0TmV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fbmV4dDtcbiAgIH1cbiAgIGIyRml4dHVyZS5wcm90b3R5cGUuR2V0VXNlckRhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3VzZXJEYXRhO1xuICAgfVxuICAgYjJGaXh0dXJlLnByb3RvdHlwZS5TZXRVc2VyRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICB0aGlzLm1fdXNlckRhdGEgPSBkYXRhO1xuICAgfVxuICAgYjJGaXh0dXJlLnByb3RvdHlwZS5UZXN0UG9pbnQgPSBmdW5jdGlvbiAocCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9zaGFwZS5UZXN0UG9pbnQodGhpcy5tX2JvZHkuR2V0VHJhbnNmb3JtKCksIHApO1xuICAgfVxuICAgYjJGaXh0dXJlLnByb3RvdHlwZS5SYXlDYXN0ID0gZnVuY3Rpb24gKG91dHB1dCwgaW5wdXQpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fc2hhcGUuUmF5Q2FzdChvdXRwdXQsIGlucHV0LCB0aGlzLm1fYm9keS5HZXRUcmFuc2Zvcm0oKSk7XG4gICB9XG4gICBiMkZpeHR1cmUucHJvdG90eXBlLkdldE1hc3NEYXRhID0gZnVuY3Rpb24gKG1hc3NEYXRhKSB7XG4gICAgICBpZiAobWFzc0RhdGEgPT09IHVuZGVmaW5lZCkgbWFzc0RhdGEgPSBudWxsO1xuICAgICAgaWYgKG1hc3NEYXRhID09IG51bGwpIHtcbiAgICAgICAgIG1hc3NEYXRhID0gbmV3IGIyTWFzc0RhdGEoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubV9zaGFwZS5Db21wdXRlTWFzcyhtYXNzRGF0YSwgdGhpcy5tX2RlbnNpdHkpO1xuICAgICAgcmV0dXJuIG1hc3NEYXRhO1xuICAgfVxuICAgYjJGaXh0dXJlLnByb3RvdHlwZS5TZXREZW5zaXR5ID0gZnVuY3Rpb24gKGRlbnNpdHkpIHtcbiAgICAgIGlmIChkZW5zaXR5ID09PSB1bmRlZmluZWQpIGRlbnNpdHkgPSAwO1xuICAgICAgdGhpcy5tX2RlbnNpdHkgPSBkZW5zaXR5O1xuICAgfVxuICAgYjJGaXh0dXJlLnByb3RvdHlwZS5HZXREZW5zaXR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9kZW5zaXR5O1xuICAgfVxuICAgYjJGaXh0dXJlLnByb3RvdHlwZS5HZXRGcmljdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fZnJpY3Rpb247XG4gICB9XG4gICBiMkZpeHR1cmUucHJvdG90eXBlLlNldEZyaWN0aW9uID0gZnVuY3Rpb24gKGZyaWN0aW9uKSB7XG4gICAgICBpZiAoZnJpY3Rpb24gPT09IHVuZGVmaW5lZCkgZnJpY3Rpb24gPSAwO1xuICAgICAgdGhpcy5tX2ZyaWN0aW9uID0gZnJpY3Rpb247XG4gICB9XG4gICBiMkZpeHR1cmUucHJvdG90eXBlLkdldFJlc3RpdHV0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9yZXN0aXR1dGlvbjtcbiAgIH1cbiAgIGIyRml4dHVyZS5wcm90b3R5cGUuU2V0UmVzdGl0dXRpb24gPSBmdW5jdGlvbiAocmVzdGl0dXRpb24pIHtcbiAgICAgIGlmIChyZXN0aXR1dGlvbiA9PT0gdW5kZWZpbmVkKSByZXN0aXR1dGlvbiA9IDA7XG4gICAgICB0aGlzLm1fcmVzdGl0dXRpb24gPSByZXN0aXR1dGlvbjtcbiAgIH1cbiAgIGIyRml4dHVyZS5wcm90b3R5cGUuR2V0QUFCQiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fYWFiYjtcbiAgIH1cbiAgIGIyRml4dHVyZS5wcm90b3R5cGUuYjJGaXh0dXJlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX2FhYmIgPSBuZXcgYjJBQUJCKCk7XG4gICAgICB0aGlzLm1fdXNlckRhdGEgPSBudWxsO1xuICAgICAgdGhpcy5tX2JvZHkgPSBudWxsO1xuICAgICAgdGhpcy5tX25leHQgPSBudWxsO1xuICAgICAgdGhpcy5tX3NoYXBlID0gbnVsbDtcbiAgICAgIHRoaXMubV9kZW5zaXR5ID0gMC4wO1xuICAgICAgdGhpcy5tX2ZyaWN0aW9uID0gMC4wO1xuICAgICAgdGhpcy5tX3Jlc3RpdHV0aW9uID0gMC4wO1xuICAgfVxuICAgYjJGaXh0dXJlLnByb3RvdHlwZS5DcmVhdGUgPSBmdW5jdGlvbiAoYm9keSwgeGYsIGRlZikge1xuICAgICAgdGhpcy5tX3VzZXJEYXRhID0gZGVmLnVzZXJEYXRhO1xuICAgICAgdGhpcy5tX2ZyaWN0aW9uID0gZGVmLmZyaWN0aW9uO1xuICAgICAgdGhpcy5tX3Jlc3RpdHV0aW9uID0gZGVmLnJlc3RpdHV0aW9uO1xuICAgICAgdGhpcy5tX2JvZHkgPSBib2R5O1xuICAgICAgdGhpcy5tX25leHQgPSBudWxsO1xuICAgICAgdGhpcy5tX2ZpbHRlciA9IGRlZi5maWx0ZXIuQ29weSgpO1xuICAgICAgdGhpcy5tX2lzU2Vuc29yID0gZGVmLmlzU2Vuc29yO1xuICAgICAgdGhpcy5tX3NoYXBlID0gZGVmLnNoYXBlLkNvcHkoKTtcbiAgICAgIHRoaXMubV9kZW5zaXR5ID0gZGVmLmRlbnNpdHk7XG4gICB9XG4gICBiMkZpeHR1cmUucHJvdG90eXBlLkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1fc2hhcGUgPSBudWxsO1xuICAgfVxuICAgYjJGaXh0dXJlLnByb3RvdHlwZS5DcmVhdGVQcm94eSA9IGZ1bmN0aW9uIChicm9hZFBoYXNlLCB4Zikge1xuICAgICAgdGhpcy5tX3NoYXBlLkNvbXB1dGVBQUJCKHRoaXMubV9hYWJiLCB4Zik7XG4gICAgICB0aGlzLm1fcHJveHkgPSBicm9hZFBoYXNlLkNyZWF0ZVByb3h5KHRoaXMubV9hYWJiLCB0aGlzKTtcbiAgIH1cbiAgIGIyRml4dHVyZS5wcm90b3R5cGUuRGVzdHJveVByb3h5ID0gZnVuY3Rpb24gKGJyb2FkUGhhc2UpIHtcbiAgICAgIGlmICh0aGlzLm1fcHJveHkgPT0gbnVsbCkge1xuICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgYnJvYWRQaGFzZS5EZXN0cm95UHJveHkodGhpcy5tX3Byb3h5KTtcbiAgICAgIHRoaXMubV9wcm94eSA9IG51bGw7XG4gICB9XG4gICBiMkZpeHR1cmUucHJvdG90eXBlLlN5bmNocm9uaXplID0gZnVuY3Rpb24gKGJyb2FkUGhhc2UsIHRyYW5zZm9ybTEsIHRyYW5zZm9ybTIpIHtcbiAgICAgIGlmICghdGhpcy5tX3Byb3h5KSByZXR1cm47XG4gICAgICB2YXIgYWFiYjEgPSBuZXcgYjJBQUJCKCk7XG4gICAgICB2YXIgYWFiYjIgPSBuZXcgYjJBQUJCKCk7XG4gICAgICB0aGlzLm1fc2hhcGUuQ29tcHV0ZUFBQkIoYWFiYjEsIHRyYW5zZm9ybTEpO1xuICAgICAgdGhpcy5tX3NoYXBlLkNvbXB1dGVBQUJCKGFhYmIyLCB0cmFuc2Zvcm0yKTtcbiAgICAgIHRoaXMubV9hYWJiLkNvbWJpbmUoYWFiYjEsIGFhYmIyKTtcbiAgICAgIHZhciBkaXNwbGFjZW1lbnQgPSBiMk1hdGguU3VidHJhY3RWVih0cmFuc2Zvcm0yLnBvc2l0aW9uLCB0cmFuc2Zvcm0xLnBvc2l0aW9uKTtcbiAgICAgIGJyb2FkUGhhc2UuTW92ZVByb3h5KHRoaXMubV9wcm94eSwgdGhpcy5tX2FhYmIsIGRpc3BsYWNlbWVudCk7XG4gICB9XG4gICBiMkZpeHR1cmVEZWYuYjJGaXh0dXJlRGVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5maWx0ZXIgPSBuZXcgYjJGaWx0ZXJEYXRhKCk7XG4gICB9O1xuICAgYjJGaXh0dXJlRGVmLnByb3RvdHlwZS5iMkZpeHR1cmVEZWYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnNoYXBlID0gbnVsbDtcbiAgICAgIHRoaXMudXNlckRhdGEgPSBudWxsO1xuICAgICAgdGhpcy5mcmljdGlvbiA9IDAuMjtcbiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7XG4gICAgICB0aGlzLmRlbnNpdHkgPSAwLjA7XG4gICAgICB0aGlzLmZpbHRlci5jYXRlZ29yeUJpdHMgPSAweDAwMDE7XG4gICAgICB0aGlzLmZpbHRlci5tYXNrQml0cyA9IDB4RkZGRjtcbiAgICAgIHRoaXMuZmlsdGVyLmdyb3VwSW5kZXggPSAwO1xuICAgICAgdGhpcy5pc1NlbnNvciA9IGZhbHNlO1xuICAgfVxuICAgYjJJc2xhbmQuYjJJc2xhbmQgPSBmdW5jdGlvbiAoKSB7fTtcbiAgIGIySXNsYW5kLnByb3RvdHlwZS5iMklzbGFuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubV9ib2RpZXMgPSBuZXcgVmVjdG9yKCk7XG4gICAgICB0aGlzLm1fY29udGFjdHMgPSBuZXcgVmVjdG9yKCk7XG4gICAgICB0aGlzLm1fam9pbnRzID0gbmV3IFZlY3RvcigpO1xuICAgfVxuICAgYjJJc2xhbmQucHJvdG90eXBlLkluaXRpYWxpemUgPSBmdW5jdGlvbiAoYm9keUNhcGFjaXR5LCBjb250YWN0Q2FwYWNpdHksIGpvaW50Q2FwYWNpdHksIGFsbG9jYXRvciwgbGlzdGVuZXIsIGNvbnRhY3RTb2x2ZXIpIHtcbiAgICAgIGlmIChib2R5Q2FwYWNpdHkgPT09IHVuZGVmaW5lZCkgYm9keUNhcGFjaXR5ID0gMDtcbiAgICAgIGlmIChjb250YWN0Q2FwYWNpdHkgPT09IHVuZGVmaW5lZCkgY29udGFjdENhcGFjaXR5ID0gMDtcbiAgICAgIGlmIChqb2ludENhcGFjaXR5ID09PSB1bmRlZmluZWQpIGpvaW50Q2FwYWNpdHkgPSAwO1xuICAgICAgdmFyIGkgPSAwO1xuICAgICAgdGhpcy5tX2JvZHlDYXBhY2l0eSA9IGJvZHlDYXBhY2l0eTtcbiAgICAgIHRoaXMubV9jb250YWN0Q2FwYWNpdHkgPSBjb250YWN0Q2FwYWNpdHk7XG4gICAgICB0aGlzLm1fam9pbnRDYXBhY2l0eSA9IGpvaW50Q2FwYWNpdHk7XG4gICAgICB0aGlzLm1fYm9keUNvdW50ID0gMDtcbiAgICAgIHRoaXMubV9jb250YWN0Q291bnQgPSAwO1xuICAgICAgdGhpcy5tX2pvaW50Q291bnQgPSAwO1xuICAgICAgdGhpcy5tX2FsbG9jYXRvciA9IGFsbG9jYXRvcjtcbiAgICAgIHRoaXMubV9saXN0ZW5lciA9IGxpc3RlbmVyO1xuICAgICAgdGhpcy5tX2NvbnRhY3RTb2x2ZXIgPSBjb250YWN0U29sdmVyO1xuICAgICAgZm9yIChpID0gdGhpcy5tX2JvZGllcy5sZW5ndGg7XG4gICAgICBpIDwgYm9keUNhcGFjaXR5OyBpKyspXG4gICAgICB0aGlzLm1fYm9kaWVzW2ldID0gbnVsbDtcbiAgICAgIGZvciAoaSA9IHRoaXMubV9jb250YWN0cy5sZW5ndGg7XG4gICAgICBpIDwgY29udGFjdENhcGFjaXR5OyBpKyspXG4gICAgICB0aGlzLm1fY29udGFjdHNbaV0gPSBudWxsO1xuICAgICAgZm9yIChpID0gdGhpcy5tX2pvaW50cy5sZW5ndGg7XG4gICAgICBpIDwgam9pbnRDYXBhY2l0eTsgaSsrKVxuICAgICAgdGhpcy5tX2pvaW50c1tpXSA9IG51bGw7XG4gICB9XG4gICBiMklzbGFuZC5wcm90b3R5cGUuQ2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1fYm9keUNvdW50ID0gMDtcbiAgICAgIHRoaXMubV9jb250YWN0Q291bnQgPSAwO1xuICAgICAgdGhpcy5tX2pvaW50Q291bnQgPSAwO1xuICAgfVxuICAgYjJJc2xhbmQucHJvdG90eXBlLlNvbHZlID0gZnVuY3Rpb24gKHN0ZXAsIGdyYXZpdHksIGFsbG93U2xlZXApIHtcbiAgICAgIHZhciBpID0gMDtcbiAgICAgIHZhciBqID0gMDtcbiAgICAgIHZhciBiO1xuICAgICAgdmFyIGpvaW50O1xuICAgICAgZm9yIChpID0gMDtcbiAgICAgIGkgPCB0aGlzLm1fYm9keUNvdW50OyArK2kpIHtcbiAgICAgICAgIGIgPSB0aGlzLm1fYm9kaWVzW2ldO1xuICAgICAgICAgaWYgKGIuR2V0VHlwZSgpICE9IGIyQm9keS5iMl9keW5hbWljQm9keSkgY29udGludWU7XG4gICAgICAgICBiLm1fbGluZWFyVmVsb2NpdHkueCArPSBzdGVwLmR0ICogKGdyYXZpdHkueCArIGIubV9pbnZNYXNzICogYi5tX2ZvcmNlLngpO1xuICAgICAgICAgYi5tX2xpbmVhclZlbG9jaXR5LnkgKz0gc3RlcC5kdCAqIChncmF2aXR5LnkgKyBiLm1faW52TWFzcyAqIGIubV9mb3JjZS55KTtcbiAgICAgICAgIGIubV9hbmd1bGFyVmVsb2NpdHkgKz0gc3RlcC5kdCAqIGIubV9pbnZJICogYi5tX3RvcnF1ZTtcbiAgICAgICAgIGIubV9saW5lYXJWZWxvY2l0eS5NdWx0aXBseShiMk1hdGguQ2xhbXAoMS4wIC0gc3RlcC5kdCAqIGIubV9saW5lYXJEYW1waW5nLCAwLjAsIDEuMCkpO1xuICAgICAgICAgYi5tX2FuZ3VsYXJWZWxvY2l0eSAqPSBiMk1hdGguQ2xhbXAoMS4wIC0gc3RlcC5kdCAqIGIubV9hbmd1bGFyRGFtcGluZywgMC4wLCAxLjApO1xuICAgICAgfVxuICAgICAgdGhpcy5tX2NvbnRhY3RTb2x2ZXIuSW5pdGlhbGl6ZShzdGVwLCB0aGlzLm1fY29udGFjdHMsIHRoaXMubV9jb250YWN0Q291bnQsIHRoaXMubV9hbGxvY2F0b3IpO1xuICAgICAgdmFyIGNvbnRhY3RTb2x2ZXIgPSB0aGlzLm1fY29udGFjdFNvbHZlcjtcbiAgICAgIGNvbnRhY3RTb2x2ZXIuSW5pdFZlbG9jaXR5Q29uc3RyYWludHMoc3RlcCk7XG4gICAgICBmb3IgKGkgPSAwO1xuICAgICAgaSA8IHRoaXMubV9qb2ludENvdW50OyArK2kpIHtcbiAgICAgICAgIGpvaW50ID0gdGhpcy5tX2pvaW50c1tpXTtcbiAgICAgICAgIGpvaW50LkluaXRWZWxvY2l0eUNvbnN0cmFpbnRzKHN0ZXApO1xuICAgICAgfVxuICAgICAgZm9yIChpID0gMDtcbiAgICAgIGkgPCBzdGVwLnZlbG9jaXR5SXRlcmF0aW9uczsgKytpKSB7XG4gICAgICAgICBmb3IgKGogPSAwO1xuICAgICAgICAgaiA8IHRoaXMubV9qb2ludENvdW50OyArK2opIHtcbiAgICAgICAgICAgIGpvaW50ID0gdGhpcy5tX2pvaW50c1tqXTtcbiAgICAgICAgICAgIGpvaW50LlNvbHZlVmVsb2NpdHlDb25zdHJhaW50cyhzdGVwKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGNvbnRhY3RTb2x2ZXIuU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzKCk7XG4gICAgICB9XG4gICAgICBmb3IgKGkgPSAwO1xuICAgICAgaSA8IHRoaXMubV9qb2ludENvdW50OyArK2kpIHtcbiAgICAgICAgIGpvaW50ID0gdGhpcy5tX2pvaW50c1tpXTtcbiAgICAgICAgIGpvaW50LkZpbmFsaXplVmVsb2NpdHlDb25zdHJhaW50cygpO1xuICAgICAgfVxuICAgICAgY29udGFjdFNvbHZlci5GaW5hbGl6ZVZlbG9jaXR5Q29uc3RyYWludHMoKTtcbiAgICAgIGZvciAoaSA9IDA7XG4gICAgICBpIDwgdGhpcy5tX2JvZHlDb3VudDsgKytpKSB7XG4gICAgICAgICBiID0gdGhpcy5tX2JvZGllc1tpXTtcbiAgICAgICAgIGlmIChiLkdldFR5cGUoKSA9PSBiMkJvZHkuYjJfc3RhdGljQm9keSkgY29udGludWU7XG4gICAgICAgICB2YXIgdHJhbnNsYXRpb25YID0gc3RlcC5kdCAqIGIubV9saW5lYXJWZWxvY2l0eS54O1xuICAgICAgICAgdmFyIHRyYW5zbGF0aW9uWSA9IHN0ZXAuZHQgKiBiLm1fbGluZWFyVmVsb2NpdHkueTtcbiAgICAgICAgIGlmICgodHJhbnNsYXRpb25YICogdHJhbnNsYXRpb25YICsgdHJhbnNsYXRpb25ZICogdHJhbnNsYXRpb25ZKSA+IGIyU2V0dGluZ3MuYjJfbWF4VHJhbnNsYXRpb25TcXVhcmVkKSB7XG4gICAgICAgICAgICBiLm1fbGluZWFyVmVsb2NpdHkuTm9ybWFsaXplKCk7XG4gICAgICAgICAgICBiLm1fbGluZWFyVmVsb2NpdHkueCAqPSBiMlNldHRpbmdzLmIyX21heFRyYW5zbGF0aW9uICogc3RlcC5pbnZfZHQ7XG4gICAgICAgICAgICBiLm1fbGluZWFyVmVsb2NpdHkueSAqPSBiMlNldHRpbmdzLmIyX21heFRyYW5zbGF0aW9uICogc3RlcC5pbnZfZHQ7XG4gICAgICAgICB9XG4gICAgICAgICB2YXIgcm90YXRpb24gPSBzdGVwLmR0ICogYi5tX2FuZ3VsYXJWZWxvY2l0eTtcbiAgICAgICAgIGlmIChyb3RhdGlvbiAqIHJvdGF0aW9uID4gYjJTZXR0aW5ncy5iMl9tYXhSb3RhdGlvblNxdWFyZWQpIHtcbiAgICAgICAgICAgIGlmIChiLm1fYW5ndWxhclZlbG9jaXR5IDwgMC4wKSB7XG4gICAgICAgICAgICAgICBiLm1fYW5ndWxhclZlbG9jaXR5ID0gKC1iMlNldHRpbmdzLmIyX21heFJvdGF0aW9uICogc3RlcC5pbnZfZHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICBiLm1fYW5ndWxhclZlbG9jaXR5ID0gYjJTZXR0aW5ncy5iMl9tYXhSb3RhdGlvbiAqIHN0ZXAuaW52X2R0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgICAgYi5tX3N3ZWVwLmMwLlNldFYoYi5tX3N3ZWVwLmMpO1xuICAgICAgICAgYi5tX3N3ZWVwLmEwID0gYi5tX3N3ZWVwLmE7XG4gICAgICAgICBiLm1fc3dlZXAuYy54ICs9IHN0ZXAuZHQgKiBiLm1fbGluZWFyVmVsb2NpdHkueDtcbiAgICAgICAgIGIubV9zd2VlcC5jLnkgKz0gc3RlcC5kdCAqIGIubV9saW5lYXJWZWxvY2l0eS55O1xuICAgICAgICAgYi5tX3N3ZWVwLmEgKz0gc3RlcC5kdCAqIGIubV9hbmd1bGFyVmVsb2NpdHk7XG4gICAgICAgICBiLlN5bmNocm9uaXplVHJhbnNmb3JtKCk7XG4gICAgICB9XG4gICAgICBmb3IgKGkgPSAwO1xuICAgICAgaSA8IHN0ZXAucG9zaXRpb25JdGVyYXRpb25zOyArK2kpIHtcbiAgICAgICAgIHZhciBjb250YWN0c09rYXkgPSBjb250YWN0U29sdmVyLlNvbHZlUG9zaXRpb25Db25zdHJhaW50cyhiMlNldHRpbmdzLmIyX2NvbnRhY3RCYXVtZ2FydGUpO1xuICAgICAgICAgdmFyIGpvaW50c09rYXkgPSB0cnVlO1xuICAgICAgICAgZm9yIChqID0gMDtcbiAgICAgICAgIGogPCB0aGlzLm1fam9pbnRDb3VudDsgKytqKSB7XG4gICAgICAgICAgICBqb2ludCA9IHRoaXMubV9qb2ludHNbal07XG4gICAgICAgICAgICB2YXIgam9pbnRPa2F5ID0gam9pbnQuU29sdmVQb3NpdGlvbkNvbnN0cmFpbnRzKGIyU2V0dGluZ3MuYjJfY29udGFjdEJhdW1nYXJ0ZSk7XG4gICAgICAgICAgICBqb2ludHNPa2F5ID0gam9pbnRzT2theSAmJiBqb2ludE9rYXk7XG4gICAgICAgICB9XG4gICAgICAgICBpZiAoY29udGFjdHNPa2F5ICYmIGpvaW50c09rYXkpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5SZXBvcnQoY29udGFjdFNvbHZlci5tX2NvbnN0cmFpbnRzKTtcbiAgICAgIGlmIChhbGxvd1NsZWVwKSB7XG4gICAgICAgICB2YXIgbWluU2xlZXBUaW1lID0gTnVtYmVyLk1BWF9WQUxVRTtcbiAgICAgICAgIHZhciBsaW5Ub2xTcXIgPSBiMlNldHRpbmdzLmIyX2xpbmVhclNsZWVwVG9sZXJhbmNlICogYjJTZXR0aW5ncy5iMl9saW5lYXJTbGVlcFRvbGVyYW5jZTtcbiAgICAgICAgIHZhciBhbmdUb2xTcXIgPSBiMlNldHRpbmdzLmIyX2FuZ3VsYXJTbGVlcFRvbGVyYW5jZSAqIGIyU2V0dGluZ3MuYjJfYW5ndWxhclNsZWVwVG9sZXJhbmNlO1xuICAgICAgICAgZm9yIChpID0gMDtcbiAgICAgICAgIGkgPCB0aGlzLm1fYm9keUNvdW50OyArK2kpIHtcbiAgICAgICAgICAgIGIgPSB0aGlzLm1fYm9kaWVzW2ldO1xuICAgICAgICAgICAgaWYgKGIuR2V0VHlwZSgpID09IGIyQm9keS5iMl9zdGF0aWNCb2R5KSB7XG4gICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgoYi5tX2ZsYWdzICYgYjJCb2R5LmVfYWxsb3dTbGVlcEZsYWcpID09IDApIHtcbiAgICAgICAgICAgICAgIGIubV9zbGVlcFRpbWUgPSAwLjA7XG4gICAgICAgICAgICAgICBtaW5TbGVlcFRpbWUgPSAwLjA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKGIubV9mbGFncyAmIGIyQm9keS5lX2FsbG93U2xlZXBGbGFnKSA9PSAwIHx8IGIubV9hbmd1bGFyVmVsb2NpdHkgKiBiLm1fYW5ndWxhclZlbG9jaXR5ID4gYW5nVG9sU3FyIHx8IGIyTWF0aC5Eb3QoYi5tX2xpbmVhclZlbG9jaXR5LCBiLm1fbGluZWFyVmVsb2NpdHkpID4gbGluVG9sU3FyKSB7XG4gICAgICAgICAgICAgICBiLm1fc2xlZXBUaW1lID0gMC4wO1xuICAgICAgICAgICAgICAgbWluU2xlZXBUaW1lID0gMC4wO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICBiLm1fc2xlZXBUaW1lICs9IHN0ZXAuZHQ7XG4gICAgICAgICAgICAgICBtaW5TbGVlcFRpbWUgPSBiMk1hdGguTWluKG1pblNsZWVwVGltZSwgYi5tX3NsZWVwVGltZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICAgICBpZiAobWluU2xlZXBUaW1lID49IGIyU2V0dGluZ3MuYjJfdGltZVRvU2xlZXApIHtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7XG4gICAgICAgICAgICBpIDwgdGhpcy5tX2JvZHlDb3VudDsgKytpKSB7XG4gICAgICAgICAgICAgICBiID0gdGhpcy5tX2JvZGllc1tpXTtcbiAgICAgICAgICAgICAgIGIuU2V0QXdha2UoZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgfVxuICAgfVxuICAgYjJJc2xhbmQucHJvdG90eXBlLlNvbHZlVE9JID0gZnVuY3Rpb24gKHN1YlN0ZXApIHtcbiAgICAgIHZhciBpID0gMDtcbiAgICAgIHZhciBqID0gMDtcbiAgICAgIHRoaXMubV9jb250YWN0U29sdmVyLkluaXRpYWxpemUoc3ViU3RlcCwgdGhpcy5tX2NvbnRhY3RzLCB0aGlzLm1fY29udGFjdENvdW50LCB0aGlzLm1fYWxsb2NhdG9yKTtcbiAgICAgIHZhciBjb250YWN0U29sdmVyID0gdGhpcy5tX2NvbnRhY3RTb2x2ZXI7XG4gICAgICBmb3IgKGkgPSAwO1xuICAgICAgaSA8IHRoaXMubV9qb2ludENvdW50OyArK2kpIHtcbiAgICAgICAgIHRoaXMubV9qb2ludHNbaV0uSW5pdFZlbG9jaXR5Q29uc3RyYWludHMoc3ViU3RlcCk7XG4gICAgICB9XG4gICAgICBmb3IgKGkgPSAwO1xuICAgICAgaSA8IHN1YlN0ZXAudmVsb2NpdHlJdGVyYXRpb25zOyArK2kpIHtcbiAgICAgICAgIGNvbnRhY3RTb2x2ZXIuU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzKCk7XG4gICAgICAgICBmb3IgKGogPSAwO1xuICAgICAgICAgaiA8IHRoaXMubV9qb2ludENvdW50OyArK2opIHtcbiAgICAgICAgICAgIHRoaXMubV9qb2ludHNbal0uU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzKHN1YlN0ZXApO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChpID0gMDtcbiAgICAgIGkgPCB0aGlzLm1fYm9keUNvdW50OyArK2kpIHtcbiAgICAgICAgIHZhciBiID0gdGhpcy5tX2JvZGllc1tpXTtcbiAgICAgICAgIGlmIChiLkdldFR5cGUoKSA9PSBiMkJvZHkuYjJfc3RhdGljQm9keSkgY29udGludWU7XG4gICAgICAgICB2YXIgdHJhbnNsYXRpb25YID0gc3ViU3RlcC5kdCAqIGIubV9saW5lYXJWZWxvY2l0eS54O1xuICAgICAgICAgdmFyIHRyYW5zbGF0aW9uWSA9IHN1YlN0ZXAuZHQgKiBiLm1fbGluZWFyVmVsb2NpdHkueTtcbiAgICAgICAgIGlmICgodHJhbnNsYXRpb25YICogdHJhbnNsYXRpb25YICsgdHJhbnNsYXRpb25ZICogdHJhbnNsYXRpb25ZKSA+IGIyU2V0dGluZ3MuYjJfbWF4VHJhbnNsYXRpb25TcXVhcmVkKSB7XG4gICAgICAgICAgICBiLm1fbGluZWFyVmVsb2NpdHkuTm9ybWFsaXplKCk7XG4gICAgICAgICAgICBiLm1fbGluZWFyVmVsb2NpdHkueCAqPSBiMlNldHRpbmdzLmIyX21heFRyYW5zbGF0aW9uICogc3ViU3RlcC5pbnZfZHQ7XG4gICAgICAgICAgICBiLm1fbGluZWFyVmVsb2NpdHkueSAqPSBiMlNldHRpbmdzLmIyX21heFRyYW5zbGF0aW9uICogc3ViU3RlcC5pbnZfZHQ7XG4gICAgICAgICB9XG4gICAgICAgICB2YXIgcm90YXRpb24gPSBzdWJTdGVwLmR0ICogYi5tX2FuZ3VsYXJWZWxvY2l0eTtcbiAgICAgICAgIGlmIChyb3RhdGlvbiAqIHJvdGF0aW9uID4gYjJTZXR0aW5ncy5iMl9tYXhSb3RhdGlvblNxdWFyZWQpIHtcbiAgICAgICAgICAgIGlmIChiLm1fYW5ndWxhclZlbG9jaXR5IDwgMC4wKSB7XG4gICAgICAgICAgICAgICBiLm1fYW5ndWxhclZlbG9jaXR5ID0gKC1iMlNldHRpbmdzLmIyX21heFJvdGF0aW9uICogc3ViU3RlcC5pbnZfZHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICBiLm1fYW5ndWxhclZlbG9jaXR5ID0gYjJTZXR0aW5ncy5iMl9tYXhSb3RhdGlvbiAqIHN1YlN0ZXAuaW52X2R0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgICAgYi5tX3N3ZWVwLmMwLlNldFYoYi5tX3N3ZWVwLmMpO1xuICAgICAgICAgYi5tX3N3ZWVwLmEwID0gYi5tX3N3ZWVwLmE7XG4gICAgICAgICBiLm1fc3dlZXAuYy54ICs9IHN1YlN0ZXAuZHQgKiBiLm1fbGluZWFyVmVsb2NpdHkueDtcbiAgICAgICAgIGIubV9zd2VlcC5jLnkgKz0gc3ViU3RlcC5kdCAqIGIubV9saW5lYXJWZWxvY2l0eS55O1xuICAgICAgICAgYi5tX3N3ZWVwLmEgKz0gc3ViU3RlcC5kdCAqIGIubV9hbmd1bGFyVmVsb2NpdHk7XG4gICAgICAgICBiLlN5bmNocm9uaXplVHJhbnNmb3JtKCk7XG4gICAgICB9XG4gICAgICB2YXIga190b2lCYXVtZ2FydGUgPSAwLjc1O1xuICAgICAgZm9yIChpID0gMDtcbiAgICAgIGkgPCBzdWJTdGVwLnBvc2l0aW9uSXRlcmF0aW9uczsgKytpKSB7XG4gICAgICAgICB2YXIgY29udGFjdHNPa2F5ID0gY29udGFjdFNvbHZlci5Tb2x2ZVBvc2l0aW9uQ29uc3RyYWludHMoa190b2lCYXVtZ2FydGUpO1xuICAgICAgICAgdmFyIGpvaW50c09rYXkgPSB0cnVlO1xuICAgICAgICAgZm9yIChqID0gMDtcbiAgICAgICAgIGogPCB0aGlzLm1fam9pbnRDb3VudDsgKytqKSB7XG4gICAgICAgICAgICB2YXIgam9pbnRPa2F5ID0gdGhpcy5tX2pvaW50c1tqXS5Tb2x2ZVBvc2l0aW9uQ29uc3RyYWludHMoYjJTZXR0aW5ncy5iMl9jb250YWN0QmF1bWdhcnRlKTtcbiAgICAgICAgICAgIGpvaW50c09rYXkgPSBqb2ludHNPa2F5ICYmIGpvaW50T2theTtcbiAgICAgICAgIH1cbiAgICAgICAgIGlmIChjb250YWN0c09rYXkgJiYgam9pbnRzT2theSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLlJlcG9ydChjb250YWN0U29sdmVyLm1fY29uc3RyYWludHMpO1xuICAgfVxuICAgYjJJc2xhbmQucHJvdG90eXBlLlJlcG9ydCA9IGZ1bmN0aW9uIChjb25zdHJhaW50cykge1xuICAgICAgaWYgKHRoaXMubV9saXN0ZW5lciA9PSBudWxsKSB7XG4gICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubV9jb250YWN0Q291bnQ7ICsraSkge1xuICAgICAgICAgdmFyIGMgPSB0aGlzLm1fY29udGFjdHNbaV07XG4gICAgICAgICB2YXIgY2MgPSBjb25zdHJhaW50c1tpXTtcbiAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY2MucG9pbnRDb3VudDsgKytqKSB7XG4gICAgICAgICAgICBiMklzbGFuZC5zX2ltcHVsc2Uubm9ybWFsSW1wdWxzZXNbal0gPSBjYy5wb2ludHNbal0ubm9ybWFsSW1wdWxzZTtcbiAgICAgICAgICAgIGIySXNsYW5kLnNfaW1wdWxzZS50YW5nZW50SW1wdWxzZXNbal0gPSBjYy5wb2ludHNbal0udGFuZ2VudEltcHVsc2U7XG4gICAgICAgICB9XG4gICAgICAgICB0aGlzLm1fbGlzdGVuZXIuUG9zdFNvbHZlKGMsIGIySXNsYW5kLnNfaW1wdWxzZSk7XG4gICAgICB9XG4gICB9XG4gICBiMklzbGFuZC5wcm90b3R5cGUuQWRkQm9keSA9IGZ1bmN0aW9uIChib2R5KSB7XG4gICAgICBib2R5Lm1faXNsYW5kSW5kZXggPSB0aGlzLm1fYm9keUNvdW50O1xuICAgICAgdGhpcy5tX2JvZGllc1t0aGlzLm1fYm9keUNvdW50KytdID0gYm9keTtcbiAgIH1cbiAgIGIySXNsYW5kLnByb3RvdHlwZS5BZGRDb250YWN0ID0gZnVuY3Rpb24gKGNvbnRhY3QpIHtcbiAgICAgIHRoaXMubV9jb250YWN0c1t0aGlzLm1fY29udGFjdENvdW50KytdID0gY29udGFjdDtcbiAgIH1cbiAgIGIySXNsYW5kLnByb3RvdHlwZS5BZGRKb2ludCA9IGZ1bmN0aW9uIChqb2ludCkge1xuICAgICAgdGhpcy5tX2pvaW50c1t0aGlzLm1fam9pbnRDb3VudCsrXSA9IGpvaW50O1xuICAgfVxuICAgQm94MkQucG9zdERlZnMucHVzaChmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5iMklzbGFuZC5zX2ltcHVsc2UgPSBuZXcgYjJDb250YWN0SW1wdWxzZSgpO1xuICAgfSk7XG4gICBiMlRpbWVTdGVwLmIyVGltZVN0ZXAgPSBmdW5jdGlvbiAoKSB7fTtcbiAgIGIyVGltZVN0ZXAucHJvdG90eXBlLlNldCA9IGZ1bmN0aW9uIChzdGVwKSB7XG4gICAgICB0aGlzLmR0ID0gc3RlcC5kdDtcbiAgICAgIHRoaXMuaW52X2R0ID0gc3RlcC5pbnZfZHQ7XG4gICAgICB0aGlzLnBvc2l0aW9uSXRlcmF0aW9ucyA9IHN0ZXAucG9zaXRpb25JdGVyYXRpb25zO1xuICAgICAgdGhpcy52ZWxvY2l0eUl0ZXJhdGlvbnMgPSBzdGVwLnZlbG9jaXR5SXRlcmF0aW9ucztcbiAgICAgIHRoaXMud2FybVN0YXJ0aW5nID0gc3RlcC53YXJtU3RhcnRpbmc7XG4gICB9XG4gICBiMldvcmxkLmIyV29ybGQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnNfc3RhY2sgPSBuZXcgVmVjdG9yKCk7XG4gICAgICB0aGlzLm1fY29udGFjdE1hbmFnZXIgPSBuZXcgYjJDb250YWN0TWFuYWdlcigpO1xuICAgICAgdGhpcy5tX2NvbnRhY3RTb2x2ZXIgPSBuZXcgYjJDb250YWN0U29sdmVyKCk7XG4gICAgICB0aGlzLm1faXNsYW5kID0gbmV3IGIySXNsYW5kKCk7XG4gICB9O1xuICAgYjJXb3JsZC5wcm90b3R5cGUuYjJXb3JsZCA9IGZ1bmN0aW9uIChncmF2aXR5LCBkb1NsZWVwKSB7XG4gICAgICB0aGlzLm1fZGVzdHJ1Y3Rpb25MaXN0ZW5lciA9IG51bGw7XG4gICAgICB0aGlzLm1fZGVidWdEcmF3ID0gbnVsbDtcbiAgICAgIHRoaXMubV9ib2R5TGlzdCA9IG51bGw7XG4gICAgICB0aGlzLm1fY29udGFjdExpc3QgPSBudWxsO1xuICAgICAgdGhpcy5tX2pvaW50TGlzdCA9IG51bGw7XG4gICAgICB0aGlzLm1fY29udHJvbGxlckxpc3QgPSBudWxsO1xuICAgICAgdGhpcy5tX2JvZHlDb3VudCA9IDA7XG4gICAgICB0aGlzLm1fY29udGFjdENvdW50ID0gMDtcbiAgICAgIHRoaXMubV9qb2ludENvdW50ID0gMDtcbiAgICAgIHRoaXMubV9jb250cm9sbGVyQ291bnQgPSAwO1xuICAgICAgYjJXb3JsZC5tX3dhcm1TdGFydGluZyA9IHRydWU7XG4gICAgICBiMldvcmxkLm1fY29udGludW91c1BoeXNpY3MgPSB0cnVlO1xuICAgICAgdGhpcy5tX2FsbG93U2xlZXAgPSBkb1NsZWVwO1xuICAgICAgdGhpcy5tX2dyYXZpdHkgPSBncmF2aXR5O1xuICAgICAgdGhpcy5tX2ludl9kdDAgPSAwLjA7XG4gICAgICB0aGlzLm1fY29udGFjdE1hbmFnZXIubV93b3JsZCA9IHRoaXM7XG4gICAgICB2YXIgYmQgPSBuZXcgYjJCb2R5RGVmKCk7XG4gICAgICB0aGlzLm1fZ3JvdW5kQm9keSA9IHRoaXMuQ3JlYXRlQm9keShiZCk7XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5TZXREZXN0cnVjdGlvbkxpc3RlbmVyID0gZnVuY3Rpb24gKGxpc3RlbmVyKSB7XG4gICAgICB0aGlzLm1fZGVzdHJ1Y3Rpb25MaXN0ZW5lciA9IGxpc3RlbmVyO1xuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuU2V0Q29udGFjdEZpbHRlciA9IGZ1bmN0aW9uIChmaWx0ZXIpIHtcbiAgICAgIHRoaXMubV9jb250YWN0TWFuYWdlci5tX2NvbnRhY3RGaWx0ZXIgPSBmaWx0ZXI7XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5TZXRDb250YWN0TGlzdGVuZXIgPSBmdW5jdGlvbiAobGlzdGVuZXIpIHtcbiAgICAgIHRoaXMubV9jb250YWN0TWFuYWdlci5tX2NvbnRhY3RMaXN0ZW5lciA9IGxpc3RlbmVyO1xuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuU2V0RGVidWdEcmF3ID0gZnVuY3Rpb24gKGRlYnVnRHJhdykge1xuICAgICAgdGhpcy5tX2RlYnVnRHJhdyA9IGRlYnVnRHJhdztcbiAgIH1cbiAgIGIyV29ybGQucHJvdG90eXBlLlNldEJyb2FkUGhhc2UgPSBmdW5jdGlvbiAoYnJvYWRQaGFzZSkge1xuICAgICAgdmFyIG9sZEJyb2FkUGhhc2UgPSB0aGlzLm1fY29udGFjdE1hbmFnZXIubV9icm9hZFBoYXNlO1xuICAgICAgdGhpcy5tX2NvbnRhY3RNYW5hZ2VyLm1fYnJvYWRQaGFzZSA9IGJyb2FkUGhhc2U7XG4gICAgICBmb3IgKHZhciBiID0gdGhpcy5tX2JvZHlMaXN0OyBiOyBiID0gYi5tX25leHQpIHtcbiAgICAgICAgIGZvciAodmFyIGYgPSBiLm1fZml4dHVyZUxpc3Q7IGY7IGYgPSBmLm1fbmV4dCkge1xuICAgICAgICAgICAgZi5tX3Byb3h5ID0gYnJvYWRQaGFzZS5DcmVhdGVQcm94eShvbGRCcm9hZFBoYXNlLkdldEZhdEFBQkIoZi5tX3Byb3h5KSwgZik7XG4gICAgICAgICB9XG4gICAgICB9XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5WYWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubV9jb250YWN0TWFuYWdlci5tX2Jyb2FkUGhhc2UuVmFsaWRhdGUoKTtcbiAgIH1cbiAgIGIyV29ybGQucHJvdG90eXBlLkdldFByb3h5Q291bnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2NvbnRhY3RNYW5hZ2VyLm1fYnJvYWRQaGFzZS5HZXRQcm94eUNvdW50KCk7XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5DcmVhdGVCb2R5ID0gZnVuY3Rpb24gKGRlZikge1xuICAgICAgaWYgKHRoaXMuSXNMb2NrZWQoKSA9PSB0cnVlKSB7XG4gICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIHZhciBiID0gbmV3IGIyQm9keShkZWYsIHRoaXMpO1xuICAgICAgYi5tX3ByZXYgPSBudWxsO1xuICAgICAgYi5tX25leHQgPSB0aGlzLm1fYm9keUxpc3Q7XG4gICAgICBpZiAodGhpcy5tX2JvZHlMaXN0KSB7XG4gICAgICAgICB0aGlzLm1fYm9keUxpc3QubV9wcmV2ID0gYjtcbiAgICAgIH1cbiAgICAgIHRoaXMubV9ib2R5TGlzdCA9IGI7XG4gICAgICArK3RoaXMubV9ib2R5Q291bnQ7XG4gICAgICByZXR1cm4gYjtcbiAgIH1cbiAgIGIyV29ybGQucHJvdG90eXBlLkRlc3Ryb3lCb2R5ID0gZnVuY3Rpb24gKGIpIHtcbiAgICAgIGlmICh0aGlzLklzTG9ja2VkKCkgPT0gdHJ1ZSkge1xuICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGpuID0gYi5tX2pvaW50TGlzdDtcbiAgICAgIHdoaWxlIChqbikge1xuICAgICAgICAgdmFyIGpuMCA9IGpuO1xuICAgICAgICAgam4gPSBqbi5uZXh0O1xuICAgICAgICAgaWYgKHRoaXMubV9kZXN0cnVjdGlvbkxpc3RlbmVyKSB7XG4gICAgICAgICAgICB0aGlzLm1fZGVzdHJ1Y3Rpb25MaXN0ZW5lci5TYXlHb29kYnllSm9pbnQoam4wLmpvaW50KTtcbiAgICAgICAgIH1cbiAgICAgICAgIHRoaXMuRGVzdHJveUpvaW50KGpuMC5qb2ludCk7XG4gICAgICB9XG4gICAgICB2YXIgY29lID0gYi5tX2NvbnRyb2xsZXJMaXN0O1xuICAgICAgd2hpbGUgKGNvZSkge1xuICAgICAgICAgdmFyIGNvZTAgPSBjb2U7XG4gICAgICAgICBjb2UgPSBjb2UubmV4dENvbnRyb2xsZXI7XG4gICAgICAgICBjb2UwLmNvbnRyb2xsZXIuUmVtb3ZlQm9keShiKTtcbiAgICAgIH1cbiAgICAgIHZhciBjZSA9IGIubV9jb250YWN0TGlzdDtcbiAgICAgIHdoaWxlIChjZSkge1xuICAgICAgICAgdmFyIGNlMCA9IGNlO1xuICAgICAgICAgY2UgPSBjZS5uZXh0O1xuICAgICAgICAgdGhpcy5tX2NvbnRhY3RNYW5hZ2VyLkRlc3Ryb3koY2UwLmNvbnRhY3QpO1xuICAgICAgfVxuICAgICAgYi5tX2NvbnRhY3RMaXN0ID0gbnVsbDtcbiAgICAgIHZhciBmID0gYi5tX2ZpeHR1cmVMaXN0O1xuICAgICAgd2hpbGUgKGYpIHtcbiAgICAgICAgIHZhciBmMCA9IGY7XG4gICAgICAgICBmID0gZi5tX25leHQ7XG4gICAgICAgICBpZiAodGhpcy5tX2Rlc3RydWN0aW9uTGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHRoaXMubV9kZXN0cnVjdGlvbkxpc3RlbmVyLlNheUdvb2RieWVGaXh0dXJlKGYwKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGYwLkRlc3Ryb3lQcm94eSh0aGlzLm1fY29udGFjdE1hbmFnZXIubV9icm9hZFBoYXNlKTtcbiAgICAgICAgIGYwLkRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICAgIGIubV9maXh0dXJlTGlzdCA9IG51bGw7XG4gICAgICBiLm1fZml4dHVyZUNvdW50ID0gMDtcbiAgICAgIGlmIChiLm1fcHJldikge1xuICAgICAgICAgYi5tX3ByZXYubV9uZXh0ID0gYi5tX25leHQ7XG4gICAgICB9XG4gICAgICBpZiAoYi5tX25leHQpIHtcbiAgICAgICAgIGIubV9uZXh0Lm1fcHJldiA9IGIubV9wcmV2O1xuICAgICAgfVxuICAgICAgaWYgKGIgPT0gdGhpcy5tX2JvZHlMaXN0KSB7XG4gICAgICAgICB0aGlzLm1fYm9keUxpc3QgPSBiLm1fbmV4dDtcbiAgICAgIH0tLXRoaXMubV9ib2R5Q291bnQ7XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5DcmVhdGVKb2ludCA9IGZ1bmN0aW9uIChkZWYpIHtcbiAgICAgIHZhciBqID0gYjJKb2ludC5DcmVhdGUoZGVmLCBudWxsKTtcbiAgICAgIGoubV9wcmV2ID0gbnVsbDtcbiAgICAgIGoubV9uZXh0ID0gdGhpcy5tX2pvaW50TGlzdDtcbiAgICAgIGlmICh0aGlzLm1fam9pbnRMaXN0KSB7XG4gICAgICAgICB0aGlzLm1fam9pbnRMaXN0Lm1fcHJldiA9IGo7XG4gICAgICB9XG4gICAgICB0aGlzLm1fam9pbnRMaXN0ID0gajtcbiAgICAgICsrdGhpcy5tX2pvaW50Q291bnQ7XG4gICAgICBqLm1fZWRnZUEuam9pbnQgPSBqO1xuICAgICAgai5tX2VkZ2VBLm90aGVyID0gai5tX2JvZHlCO1xuICAgICAgai5tX2VkZ2VBLnByZXYgPSBudWxsO1xuICAgICAgai5tX2VkZ2VBLm5leHQgPSBqLm1fYm9keUEubV9qb2ludExpc3Q7XG4gICAgICBpZiAoai5tX2JvZHlBLm1fam9pbnRMaXN0KSBqLm1fYm9keUEubV9qb2ludExpc3QucHJldiA9IGoubV9lZGdlQTtcbiAgICAgIGoubV9ib2R5QS5tX2pvaW50TGlzdCA9IGoubV9lZGdlQTtcbiAgICAgIGoubV9lZGdlQi5qb2ludCA9IGo7XG4gICAgICBqLm1fZWRnZUIub3RoZXIgPSBqLm1fYm9keUE7XG4gICAgICBqLm1fZWRnZUIucHJldiA9IG51bGw7XG4gICAgICBqLm1fZWRnZUIubmV4dCA9IGoubV9ib2R5Qi5tX2pvaW50TGlzdDtcbiAgICAgIGlmIChqLm1fYm9keUIubV9qb2ludExpc3QpIGoubV9ib2R5Qi5tX2pvaW50TGlzdC5wcmV2ID0gai5tX2VkZ2VCO1xuICAgICAgai5tX2JvZHlCLm1fam9pbnRMaXN0ID0gai5tX2VkZ2VCO1xuICAgICAgdmFyIGJvZHlBID0gZGVmLmJvZHlBO1xuICAgICAgdmFyIGJvZHlCID0gZGVmLmJvZHlCO1xuICAgICAgaWYgKGRlZi5jb2xsaWRlQ29ubmVjdGVkID09IGZhbHNlKSB7XG4gICAgICAgICB2YXIgZWRnZSA9IGJvZHlCLkdldENvbnRhY3RMaXN0KCk7XG4gICAgICAgICB3aGlsZSAoZWRnZSkge1xuICAgICAgICAgICAgaWYgKGVkZ2Uub3RoZXIgPT0gYm9keUEpIHtcbiAgICAgICAgICAgICAgIGVkZ2UuY29udGFjdC5GbGFnRm9yRmlsdGVyaW5nKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlZGdlID0gZWRnZS5uZXh0O1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGo7XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5EZXN0cm95Sm9pbnQgPSBmdW5jdGlvbiAoaikge1xuICAgICAgdmFyIGNvbGxpZGVDb25uZWN0ZWQgPSBqLm1fY29sbGlkZUNvbm5lY3RlZDtcbiAgICAgIGlmIChqLm1fcHJldikge1xuICAgICAgICAgai5tX3ByZXYubV9uZXh0ID0gai5tX25leHQ7XG4gICAgICB9XG4gICAgICBpZiAoai5tX25leHQpIHtcbiAgICAgICAgIGoubV9uZXh0Lm1fcHJldiA9IGoubV9wcmV2O1xuICAgICAgfVxuICAgICAgaWYgKGogPT0gdGhpcy5tX2pvaW50TGlzdCkge1xuICAgICAgICAgdGhpcy5tX2pvaW50TGlzdCA9IGoubV9uZXh0O1xuICAgICAgfVxuICAgICAgdmFyIGJvZHlBID0gai5tX2JvZHlBO1xuICAgICAgdmFyIGJvZHlCID0gai5tX2JvZHlCO1xuICAgICAgYm9keUEuU2V0QXdha2UodHJ1ZSk7XG4gICAgICBib2R5Qi5TZXRBd2FrZSh0cnVlKTtcbiAgICAgIGlmIChqLm1fZWRnZUEucHJldikge1xuICAgICAgICAgai5tX2VkZ2VBLnByZXYubmV4dCA9IGoubV9lZGdlQS5uZXh0O1xuICAgICAgfVxuICAgICAgaWYgKGoubV9lZGdlQS5uZXh0KSB7XG4gICAgICAgICBqLm1fZWRnZUEubmV4dC5wcmV2ID0gai5tX2VkZ2VBLnByZXY7XG4gICAgICB9XG4gICAgICBpZiAoai5tX2VkZ2VBID09IGJvZHlBLm1fam9pbnRMaXN0KSB7XG4gICAgICAgICBib2R5QS5tX2pvaW50TGlzdCA9IGoubV9lZGdlQS5uZXh0O1xuICAgICAgfVxuICAgICAgai5tX2VkZ2VBLnByZXYgPSBudWxsO1xuICAgICAgai5tX2VkZ2VBLm5leHQgPSBudWxsO1xuICAgICAgaWYgKGoubV9lZGdlQi5wcmV2KSB7XG4gICAgICAgICBqLm1fZWRnZUIucHJldi5uZXh0ID0gai5tX2VkZ2VCLm5leHQ7XG4gICAgICB9XG4gICAgICBpZiAoai5tX2VkZ2VCLm5leHQpIHtcbiAgICAgICAgIGoubV9lZGdlQi5uZXh0LnByZXYgPSBqLm1fZWRnZUIucHJldjtcbiAgICAgIH1cbiAgICAgIGlmIChqLm1fZWRnZUIgPT0gYm9keUIubV9qb2ludExpc3QpIHtcbiAgICAgICAgIGJvZHlCLm1fam9pbnRMaXN0ID0gai5tX2VkZ2VCLm5leHQ7XG4gICAgICB9XG4gICAgICBqLm1fZWRnZUIucHJldiA9IG51bGw7XG4gICAgICBqLm1fZWRnZUIubmV4dCA9IG51bGw7XG4gICAgICBiMkpvaW50LkRlc3Ryb3koaiwgbnVsbCk7XG4gICAgICAtLXRoaXMubV9qb2ludENvdW50O1xuICAgICAgaWYgKGNvbGxpZGVDb25uZWN0ZWQgPT0gZmFsc2UpIHtcbiAgICAgICAgIHZhciBlZGdlID0gYm9keUIuR2V0Q29udGFjdExpc3QoKTtcbiAgICAgICAgIHdoaWxlIChlZGdlKSB7XG4gICAgICAgICAgICBpZiAoZWRnZS5vdGhlciA9PSBib2R5QSkge1xuICAgICAgICAgICAgICAgZWRnZS5jb250YWN0LkZsYWdGb3JGaWx0ZXJpbmcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVkZ2UgPSBlZGdlLm5leHQ7XG4gICAgICAgICB9XG4gICAgICB9XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5BZGRDb250cm9sbGVyID0gZnVuY3Rpb24gKGMpIHtcbiAgICAgIGMubV9uZXh0ID0gdGhpcy5tX2NvbnRyb2xsZXJMaXN0O1xuICAgICAgYy5tX3ByZXYgPSBudWxsO1xuICAgICAgdGhpcy5tX2NvbnRyb2xsZXJMaXN0ID0gYztcbiAgICAgIGMubV93b3JsZCA9IHRoaXM7XG4gICAgICB0aGlzLm1fY29udHJvbGxlckNvdW50Kys7XG4gICAgICByZXR1cm4gYztcbiAgIH1cbiAgIGIyV29ybGQucHJvdG90eXBlLlJlbW92ZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoYykge1xuICAgICAgaWYgKGMubV9wcmV2KSBjLm1fcHJldi5tX25leHQgPSBjLm1fbmV4dDtcbiAgICAgIGlmIChjLm1fbmV4dCkgYy5tX25leHQubV9wcmV2ID0gYy5tX3ByZXY7XG4gICAgICBpZiAodGhpcy5tX2NvbnRyb2xsZXJMaXN0ID09IGMpIHRoaXMubV9jb250cm9sbGVyTGlzdCA9IGMubV9uZXh0O1xuICAgICAgdGhpcy5tX2NvbnRyb2xsZXJDb3VudC0tO1xuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuQ3JlYXRlQ29udHJvbGxlciA9IGZ1bmN0aW9uIChjb250cm9sbGVyKSB7XG4gICAgICBpZiAoY29udHJvbGxlci5tX3dvcmxkICE9IHRoaXMpIHRocm93IG5ldyBFcnJvcihcIkNvbnRyb2xsZXIgY2FuIG9ubHkgYmUgYSBtZW1iZXIgb2Ygb25lIHdvcmxkXCIpO1xuICAgICAgY29udHJvbGxlci5tX25leHQgPSB0aGlzLm1fY29udHJvbGxlckxpc3Q7XG4gICAgICBjb250cm9sbGVyLm1fcHJldiA9IG51bGw7XG4gICAgICBpZiAodGhpcy5tX2NvbnRyb2xsZXJMaXN0KSB0aGlzLm1fY29udHJvbGxlckxpc3QubV9wcmV2ID0gY29udHJvbGxlcjtcbiAgICAgIHRoaXMubV9jb250cm9sbGVyTGlzdCA9IGNvbnRyb2xsZXI7XG4gICAgICArK3RoaXMubV9jb250cm9sbGVyQ291bnQ7XG4gICAgICBjb250cm9sbGVyLm1fd29ybGQgPSB0aGlzO1xuICAgICAgcmV0dXJuIGNvbnRyb2xsZXI7XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5EZXN0cm95Q29udHJvbGxlciA9IGZ1bmN0aW9uIChjb250cm9sbGVyKSB7XG4gICAgICBjb250cm9sbGVyLkNsZWFyKCk7XG4gICAgICBpZiAoY29udHJvbGxlci5tX25leHQpIGNvbnRyb2xsZXIubV9uZXh0Lm1fcHJldiA9IGNvbnRyb2xsZXIubV9wcmV2O1xuICAgICAgaWYgKGNvbnRyb2xsZXIubV9wcmV2KSBjb250cm9sbGVyLm1fcHJldi5tX25leHQgPSBjb250cm9sbGVyLm1fbmV4dDtcbiAgICAgIGlmIChjb250cm9sbGVyID09IHRoaXMubV9jb250cm9sbGVyTGlzdCkgdGhpcy5tX2NvbnRyb2xsZXJMaXN0ID0gY29udHJvbGxlci5tX25leHQ7XG4gICAgICAtLXRoaXMubV9jb250cm9sbGVyQ291bnQ7XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5TZXRXYXJtU3RhcnRpbmcgPSBmdW5jdGlvbiAoZmxhZykge1xuICAgICAgYjJXb3JsZC5tX3dhcm1TdGFydGluZyA9IGZsYWc7XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5TZXRDb250aW51b3VzUGh5c2ljcyA9IGZ1bmN0aW9uIChmbGFnKSB7XG4gICAgICBiMldvcmxkLm1fY29udGludW91c1BoeXNpY3MgPSBmbGFnO1xuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuR2V0Qm9keUNvdW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5Q291bnQ7XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5HZXRKb2ludENvdW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9qb2ludENvdW50O1xuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuR2V0Q29udGFjdENvdW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9jb250YWN0Q291bnQ7XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5TZXRHcmF2aXR5ID0gZnVuY3Rpb24gKGdyYXZpdHkpIHtcbiAgICAgIHRoaXMubV9ncmF2aXR5ID0gZ3Jhdml0eTtcbiAgIH1cbiAgIGIyV29ybGQucHJvdG90eXBlLkdldEdyYXZpdHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2dyYXZpdHk7XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5HZXRHcm91bmRCb2R5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ncm91bmRCb2R5O1xuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuU3RlcCA9IGZ1bmN0aW9uIChkdCwgdmVsb2NpdHlJdGVyYXRpb25zLCBwb3NpdGlvbkl0ZXJhdGlvbnMpIHtcbiAgICAgIGlmIChkdCA9PT0gdW5kZWZpbmVkKSBkdCA9IDA7XG4gICAgICBpZiAodmVsb2NpdHlJdGVyYXRpb25zID09PSB1bmRlZmluZWQpIHZlbG9jaXR5SXRlcmF0aW9ucyA9IDA7XG4gICAgICBpZiAocG9zaXRpb25JdGVyYXRpb25zID09PSB1bmRlZmluZWQpIHBvc2l0aW9uSXRlcmF0aW9ucyA9IDA7XG4gICAgICBpZiAodGhpcy5tX2ZsYWdzICYgYjJXb3JsZC5lX25ld0ZpeHR1cmUpIHtcbiAgICAgICAgIHRoaXMubV9jb250YWN0TWFuYWdlci5GaW5kTmV3Q29udGFjdHMoKTtcbiAgICAgICAgIHRoaXMubV9mbGFncyAmPSB+YjJXb3JsZC5lX25ld0ZpeHR1cmU7XG4gICAgICB9XG4gICAgICB0aGlzLm1fZmxhZ3MgfD0gYjJXb3JsZC5lX2xvY2tlZDtcbiAgICAgIHZhciBzdGVwID0gYjJXb3JsZC5zX3RpbWVzdGVwMjtcbiAgICAgIHN0ZXAuZHQgPSBkdDtcbiAgICAgIHN0ZXAudmVsb2NpdHlJdGVyYXRpb25zID0gdmVsb2NpdHlJdGVyYXRpb25zO1xuICAgICAgc3RlcC5wb3NpdGlvbkl0ZXJhdGlvbnMgPSBwb3NpdGlvbkl0ZXJhdGlvbnM7XG4gICAgICBpZiAoZHQgPiAwLjApIHtcbiAgICAgICAgIHN0ZXAuaW52X2R0ID0gMS4wIC8gZHQ7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHN0ZXAuaW52X2R0ID0gMC4wO1xuICAgICAgfVxuICAgICAgc3RlcC5kdFJhdGlvID0gdGhpcy5tX2ludl9kdDAgKiBkdDtcbiAgICAgIHN0ZXAud2FybVN0YXJ0aW5nID0gYjJXb3JsZC5tX3dhcm1TdGFydGluZztcbiAgICAgIHRoaXMubV9jb250YWN0TWFuYWdlci5Db2xsaWRlKCk7XG4gICAgICBpZiAoc3RlcC5kdCA+IDAuMCkge1xuICAgICAgICAgdGhpcy5Tb2x2ZShzdGVwKTtcbiAgICAgIH1cbiAgICAgIGlmIChiMldvcmxkLm1fY29udGludW91c1BoeXNpY3MgJiYgc3RlcC5kdCA+IDAuMCkge1xuICAgICAgICAgdGhpcy5Tb2x2ZVRPSShzdGVwKTtcbiAgICAgIH1cbiAgICAgIGlmIChzdGVwLmR0ID4gMC4wKSB7XG4gICAgICAgICB0aGlzLm1faW52X2R0MCA9IHN0ZXAuaW52X2R0O1xuICAgICAgfVxuICAgICAgdGhpcy5tX2ZsYWdzICY9IH5iMldvcmxkLmVfbG9ja2VkO1xuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuQ2xlYXJGb3JjZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBmb3IgKHZhciBib2R5ID0gdGhpcy5tX2JvZHlMaXN0OyBib2R5OyBib2R5ID0gYm9keS5tX25leHQpIHtcbiAgICAgICAgIGJvZHkubV9mb3JjZS5TZXRaZXJvKCk7XG4gICAgICAgICBib2R5Lm1fdG9ycXVlID0gMC4wO1xuICAgICAgfVxuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuRHJhd0RlYnVnRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLm1fZGVidWdEcmF3ID09IG51bGwpIHtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMubV9kZWJ1Z0RyYXcubV9zcHJpdGUuZ3JhcGhpY3MuY2xlYXIoKTtcbiAgICAgIHZhciBmbGFncyA9IHRoaXMubV9kZWJ1Z0RyYXcuR2V0RmxhZ3MoKTtcbiAgICAgIHZhciBpID0gMDtcbiAgICAgIHZhciBiO1xuICAgICAgdmFyIGY7XG4gICAgICB2YXIgcztcbiAgICAgIHZhciBqO1xuICAgICAgdmFyIGJwO1xuICAgICAgdmFyIGludlEgPSBuZXcgYjJWZWMyO1xuICAgICAgdmFyIHgxID0gbmV3IGIyVmVjMjtcbiAgICAgIHZhciB4MiA9IG5ldyBiMlZlYzI7XG4gICAgICB2YXIgeGY7XG4gICAgICB2YXIgYjEgPSBuZXcgYjJBQUJCKCk7XG4gICAgICB2YXIgYjIgPSBuZXcgYjJBQUJCKCk7XG4gICAgICB2YXIgdnMgPSBbbmV3IGIyVmVjMigpLCBuZXcgYjJWZWMyKCksIG5ldyBiMlZlYzIoKSwgbmV3IGIyVmVjMigpXTtcbiAgICAgIHZhciBjb2xvciA9IG5ldyBiMkNvbG9yKDAsIDAsIDApO1xuICAgICAgaWYgKGZsYWdzICYgYjJEZWJ1Z0RyYXcuZV9zaGFwZUJpdCkge1xuICAgICAgICAgZm9yIChiID0gdGhpcy5tX2JvZHlMaXN0O1xuICAgICAgICAgYjsgYiA9IGIubV9uZXh0KSB7XG4gICAgICAgICAgICB4ZiA9IGIubV94ZjtcbiAgICAgICAgICAgIGZvciAoZiA9IGIuR2V0Rml4dHVyZUxpc3QoKTtcbiAgICAgICAgICAgIGY7IGYgPSBmLm1fbmV4dCkge1xuICAgICAgICAgICAgICAgcyA9IGYuR2V0U2hhcGUoKTtcbiAgICAgICAgICAgICAgIGlmIChiLklzQWN0aXZlKCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgIGNvbG9yLlNldCgwLjUsIDAuNSwgMC4zKTtcbiAgICAgICAgICAgICAgICAgIHRoaXMuRHJhd1NoYXBlKHMsIHhmLCBjb2xvcik7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBlbHNlIGlmIChiLkdldFR5cGUoKSA9PSBiMkJvZHkuYjJfc3RhdGljQm9keSkge1xuICAgICAgICAgICAgICAgICAgY29sb3IuU2V0KDAuNSwgMC45LCAwLjUpO1xuICAgICAgICAgICAgICAgICAgdGhpcy5EcmF3U2hhcGUocywgeGYsIGNvbG9yKTtcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIGVsc2UgaWYgKGIuR2V0VHlwZSgpID09IGIyQm9keS5iMl9raW5lbWF0aWNCb2R5KSB7XG4gICAgICAgICAgICAgICAgICBjb2xvci5TZXQoMC41LCAwLjUsIDAuOSk7XG4gICAgICAgICAgICAgICAgICB0aGlzLkRyYXdTaGFwZShzLCB4ZiwgY29sb3IpO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgZWxzZSBpZiAoYi5Jc0F3YWtlKCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgIGNvbG9yLlNldCgwLjYsIDAuNiwgMC42KTtcbiAgICAgICAgICAgICAgICAgIHRoaXMuRHJhd1NoYXBlKHMsIHhmLCBjb2xvcik7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIGNvbG9yLlNldCgwLjksIDAuNywgMC43KTtcbiAgICAgICAgICAgICAgICAgIHRoaXMuRHJhd1NoYXBlKHMsIHhmLCBjb2xvcik7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoZmxhZ3MgJiBiMkRlYnVnRHJhdy5lX2pvaW50Qml0KSB7XG4gICAgICAgICBmb3IgKGogPSB0aGlzLm1fam9pbnRMaXN0O1xuICAgICAgICAgajsgaiA9IGoubV9uZXh0KSB7XG4gICAgICAgICAgICB0aGlzLkRyYXdKb2ludChqKTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChmbGFncyAmIGIyRGVidWdEcmF3LmVfY29udHJvbGxlckJpdCkge1xuICAgICAgICAgZm9yICh2YXIgYyA9IHRoaXMubV9jb250cm9sbGVyTGlzdDsgYzsgYyA9IGMubV9uZXh0KSB7XG4gICAgICAgICAgICBjLkRyYXcodGhpcy5tX2RlYnVnRHJhdyk7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoZmxhZ3MgJiBiMkRlYnVnRHJhdy5lX3BhaXJCaXQpIHtcbiAgICAgICAgIGNvbG9yLlNldCgwLjMsIDAuOSwgMC45KTtcbiAgICAgICAgIGZvciAodmFyIGNvbnRhY3QgPSB0aGlzLm1fY29udGFjdE1hbmFnZXIubV9jb250YWN0TGlzdDsgY29udGFjdDsgY29udGFjdCA9IGNvbnRhY3QuR2V0TmV4dCgpKSB7XG4gICAgICAgICAgICB2YXIgZml4dHVyZUEgPSBjb250YWN0LkdldEZpeHR1cmVBKCk7XG4gICAgICAgICAgICB2YXIgZml4dHVyZUIgPSBjb250YWN0LkdldEZpeHR1cmVCKCk7XG4gICAgICAgICAgICB2YXIgY0EgPSBmaXh0dXJlQS5HZXRBQUJCKCkuR2V0Q2VudGVyKCk7XG4gICAgICAgICAgICB2YXIgY0IgPSBmaXh0dXJlQi5HZXRBQUJCKCkuR2V0Q2VudGVyKCk7XG4gICAgICAgICAgICB0aGlzLm1fZGVidWdEcmF3LkRyYXdTZWdtZW50KGNBLCBjQiwgY29sb3IpO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGZsYWdzICYgYjJEZWJ1Z0RyYXcuZV9hYWJiQml0KSB7XG4gICAgICAgICBicCA9IHRoaXMubV9jb250YWN0TWFuYWdlci5tX2Jyb2FkUGhhc2U7XG4gICAgICAgICB2cyA9IFtuZXcgYjJWZWMyKCksIG5ldyBiMlZlYzIoKSwgbmV3IGIyVmVjMigpLCBuZXcgYjJWZWMyKCldO1xuICAgICAgICAgZm9yIChiID0gdGhpcy5tX2JvZHlMaXN0O1xuICAgICAgICAgYjsgYiA9IGIuR2V0TmV4dCgpKSB7XG4gICAgICAgICAgICBpZiAoYi5Jc0FjdGl2ZSgpID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoZiA9IGIuR2V0Rml4dHVyZUxpc3QoKTtcbiAgICAgICAgICAgIGY7IGYgPSBmLkdldE5leHQoKSkge1xuICAgICAgICAgICAgICAgdmFyIGFhYmIgPSBicC5HZXRGYXRBQUJCKGYubV9wcm94eSk7XG4gICAgICAgICAgICAgICB2c1swXS5TZXQoYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55KTtcbiAgICAgICAgICAgICAgIHZzWzFdLlNldChhYWJiLnVwcGVyQm91bmQueCwgYWFiYi5sb3dlckJvdW5kLnkpO1xuICAgICAgICAgICAgICAgdnNbMl0uU2V0KGFhYmIudXBwZXJCb3VuZC54LCBhYWJiLnVwcGVyQm91bmQueSk7XG4gICAgICAgICAgICAgICB2c1szXS5TZXQoYWFiYi5sb3dlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55KTtcbiAgICAgICAgICAgICAgIHRoaXMubV9kZWJ1Z0RyYXcuRHJhd1BvbHlnb24odnMsIDQsIGNvbG9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChmbGFncyAmIGIyRGVidWdEcmF3LmVfY2VudGVyT2ZNYXNzQml0KSB7XG4gICAgICAgICBmb3IgKGIgPSB0aGlzLm1fYm9keUxpc3Q7XG4gICAgICAgICBiOyBiID0gYi5tX25leHQpIHtcbiAgICAgICAgICAgIHhmID0gYjJXb3JsZC5zX3hmO1xuICAgICAgICAgICAgeGYuUiA9IGIubV94Zi5SO1xuICAgICAgICAgICAgeGYucG9zaXRpb24gPSBiLkdldFdvcmxkQ2VudGVyKCk7XG4gICAgICAgICAgICB0aGlzLm1fZGVidWdEcmF3LkRyYXdUcmFuc2Zvcm0oeGYpO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuUXVlcnlBQUJCID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBhYWJiKSB7XG4gICAgICB2YXIgX190aGlzID0gdGhpcztcbiAgICAgIHZhciBicm9hZFBoYXNlID0gX190aGlzLm1fY29udGFjdE1hbmFnZXIubV9icm9hZFBoYXNlO1xuXG4gICAgICBmdW5jdGlvbiBXb3JsZFF1ZXJ5V3JhcHBlcihwcm94eSkge1xuICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGJyb2FkUGhhc2UuR2V0VXNlckRhdGEocHJveHkpKTtcbiAgICAgIH07XG4gICAgICBicm9hZFBoYXNlLlF1ZXJ5KFdvcmxkUXVlcnlXcmFwcGVyLCBhYWJiKTtcbiAgIH1cbiAgIGIyV29ybGQucHJvdG90eXBlLlF1ZXJ5U2hhcGUgPSBmdW5jdGlvbiAoY2FsbGJhY2ssIHNoYXBlLCB0cmFuc2Zvcm0pIHtcbiAgICAgIHZhciBfX3RoaXMgPSB0aGlzO1xuICAgICAgaWYgKHRyYW5zZm9ybSA9PT0gdW5kZWZpbmVkKSB0cmFuc2Zvcm0gPSBudWxsO1xuICAgICAgaWYgKHRyYW5zZm9ybSA9PSBudWxsKSB7XG4gICAgICAgICB0cmFuc2Zvcm0gPSBuZXcgYjJUcmFuc2Zvcm0oKTtcbiAgICAgICAgIHRyYW5zZm9ybS5TZXRJZGVudGl0eSgpO1xuICAgICAgfVxuICAgICAgdmFyIGJyb2FkUGhhc2UgPSBfX3RoaXMubV9jb250YWN0TWFuYWdlci5tX2Jyb2FkUGhhc2U7XG5cbiAgICAgIGZ1bmN0aW9uIFdvcmxkUXVlcnlXcmFwcGVyKHByb3h5KSB7XG4gICAgICAgICB2YXIgZml4dHVyZSA9IChicm9hZFBoYXNlLkdldFVzZXJEYXRhKHByb3h5KSBpbnN0YW5jZW9mIGIyRml4dHVyZSA/IGJyb2FkUGhhc2UuR2V0VXNlckRhdGEocHJveHkpIDogbnVsbCk7XG4gICAgICAgICBpZiAoYjJTaGFwZS5UZXN0T3ZlcmxhcChzaGFwZSwgdHJhbnNmb3JtLCBmaXh0dXJlLkdldFNoYXBlKCksIGZpeHR1cmUuR2V0Qm9keSgpLkdldFRyYW5zZm9ybSgpKSkgcmV0dXJuIGNhbGxiYWNrKGZpeHR1cmUpO1xuICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9O1xuICAgICAgdmFyIGFhYmIgPSBuZXcgYjJBQUJCKCk7XG4gICAgICBzaGFwZS5Db21wdXRlQUFCQihhYWJiLCB0cmFuc2Zvcm0pO1xuICAgICAgYnJvYWRQaGFzZS5RdWVyeShXb3JsZFF1ZXJ5V3JhcHBlciwgYWFiYik7XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5RdWVyeVBvaW50ID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBwKSB7XG4gICAgICB2YXIgX190aGlzID0gdGhpcztcbiAgICAgIHZhciBicm9hZFBoYXNlID0gX190aGlzLm1fY29udGFjdE1hbmFnZXIubV9icm9hZFBoYXNlO1xuXG4gICAgICBmdW5jdGlvbiBXb3JsZFF1ZXJ5V3JhcHBlcihwcm94eSkge1xuICAgICAgICAgdmFyIGZpeHR1cmUgPSAoYnJvYWRQaGFzZS5HZXRVc2VyRGF0YShwcm94eSkgaW5zdGFuY2VvZiBiMkZpeHR1cmUgPyBicm9hZFBoYXNlLkdldFVzZXJEYXRhKHByb3h5KSA6IG51bGwpO1xuICAgICAgICAgaWYgKGZpeHR1cmUuVGVzdFBvaW50KHApKSByZXR1cm4gY2FsbGJhY2soZml4dHVyZSk7XG4gICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH07XG4gICAgICB2YXIgYWFiYiA9IG5ldyBiMkFBQkIoKTtcbiAgICAgIGFhYmIubG93ZXJCb3VuZC5TZXQocC54IC0gYjJTZXR0aW5ncy5iMl9saW5lYXJTbG9wLCBwLnkgLSBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3ApO1xuICAgICAgYWFiYi51cHBlckJvdW5kLlNldChwLnggKyBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3AsIHAueSArIGIyU2V0dGluZ3MuYjJfbGluZWFyU2xvcCk7XG4gICAgICBicm9hZFBoYXNlLlF1ZXJ5KFdvcmxkUXVlcnlXcmFwcGVyLCBhYWJiKTtcbiAgIH1cbiAgIGIyV29ybGQucHJvdG90eXBlLlJheUNhc3QgPSBmdW5jdGlvbiAoY2FsbGJhY2ssIHBvaW50MSwgcG9pbnQyKSB7XG4gICAgICB2YXIgX190aGlzID0gdGhpcztcbiAgICAgIHZhciBicm9hZFBoYXNlID0gX190aGlzLm1fY29udGFjdE1hbmFnZXIubV9icm9hZFBoYXNlO1xuICAgICAgdmFyIG91dHB1dCA9IG5ldyBiMlJheUNhc3RPdXRwdXQ7XG5cbiAgICAgIGZ1bmN0aW9uIFJheUNhc3RXcmFwcGVyKGlucHV0LCBwcm94eSkge1xuICAgICAgICAgdmFyIHVzZXJEYXRhID0gYnJvYWRQaGFzZS5HZXRVc2VyRGF0YShwcm94eSk7XG4gICAgICAgICB2YXIgZml4dHVyZSA9ICh1c2VyRGF0YSBpbnN0YW5jZW9mIGIyRml4dHVyZSA/IHVzZXJEYXRhIDogbnVsbCk7XG4gICAgICAgICB2YXIgaGl0ID0gZml4dHVyZS5SYXlDYXN0KG91dHB1dCwgaW5wdXQpO1xuICAgICAgICAgaWYgKGhpdCkge1xuICAgICAgICAgICAgdmFyIGZyYWN0aW9uID0gb3V0cHV0LmZyYWN0aW9uO1xuICAgICAgICAgICAgdmFyIHBvaW50ID0gbmV3IGIyVmVjMigoMS4wIC0gZnJhY3Rpb24pICogcG9pbnQxLnggKyBmcmFjdGlvbiAqIHBvaW50Mi54LCAoMS4wIC0gZnJhY3Rpb24pICogcG9pbnQxLnkgKyBmcmFjdGlvbiAqIHBvaW50Mi55KTtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhmaXh0dXJlLCBwb2ludCwgb3V0cHV0Lm5vcm1hbCwgZnJhY3Rpb24pO1xuICAgICAgICAgfVxuICAgICAgICAgcmV0dXJuIGlucHV0Lm1heEZyYWN0aW9uO1xuICAgICAgfTtcbiAgICAgIHZhciBpbnB1dCA9IG5ldyBiMlJheUNhc3RJbnB1dChwb2ludDEsIHBvaW50Mik7XG4gICAgICBicm9hZFBoYXNlLlJheUNhc3QoUmF5Q2FzdFdyYXBwZXIsIGlucHV0KTtcbiAgIH1cbiAgIGIyV29ybGQucHJvdG90eXBlLlJheUNhc3RPbmUgPSBmdW5jdGlvbiAocG9pbnQxLCBwb2ludDIpIHtcbiAgICAgIHZhciBfX3RoaXMgPSB0aGlzO1xuICAgICAgdmFyIHJlc3VsdDtcblxuICAgICAgZnVuY3Rpb24gUmF5Q2FzdE9uZVdyYXBwZXIoZml4dHVyZSwgcG9pbnQsIG5vcm1hbCwgZnJhY3Rpb24pIHtcbiAgICAgICAgIGlmIChmcmFjdGlvbiA9PT0gdW5kZWZpbmVkKSBmcmFjdGlvbiA9IDA7XG4gICAgICAgICByZXN1bHQgPSBmaXh0dXJlO1xuICAgICAgICAgcmV0dXJuIGZyYWN0aW9uO1xuICAgICAgfTtcbiAgICAgIF9fdGhpcy5SYXlDYXN0KFJheUNhc3RPbmVXcmFwcGVyLCBwb2ludDEsIHBvaW50Mik7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuUmF5Q2FzdEFsbCA9IGZ1bmN0aW9uIChwb2ludDEsIHBvaW50Mikge1xuICAgICAgdmFyIF9fdGhpcyA9IHRoaXM7XG4gICAgICB2YXIgcmVzdWx0ID0gbmV3IFZlY3RvcigpO1xuXG4gICAgICBmdW5jdGlvbiBSYXlDYXN0QWxsV3JhcHBlcihmaXh0dXJlLCBwb2ludCwgbm9ybWFsLCBmcmFjdGlvbikge1xuICAgICAgICAgaWYgKGZyYWN0aW9uID09PSB1bmRlZmluZWQpIGZyYWN0aW9uID0gMDtcbiAgICAgICAgIHJlc3VsdFtyZXN1bHQubGVuZ3RoXSA9IGZpeHR1cmU7XG4gICAgICAgICByZXR1cm4gMTtcbiAgICAgIH07XG4gICAgICBfX3RoaXMuUmF5Q2FzdChSYXlDYXN0QWxsV3JhcHBlciwgcG9pbnQxLCBwb2ludDIpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgIH1cbiAgIGIyV29ybGQucHJvdG90eXBlLkdldEJvZHlMaXN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5TGlzdDtcbiAgIH1cbiAgIGIyV29ybGQucHJvdG90eXBlLkdldEpvaW50TGlzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fam9pbnRMaXN0O1xuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuR2V0Q29udGFjdExpc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2NvbnRhY3RMaXN0O1xuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuSXNMb2NrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gKHRoaXMubV9mbGFncyAmIGIyV29ybGQuZV9sb2NrZWQpID4gMDtcbiAgIH1cbiAgIGIyV29ybGQucHJvdG90eXBlLlNvbHZlID0gZnVuY3Rpb24gKHN0ZXApIHtcbiAgICAgIHZhciBiO1xuICAgICAgZm9yICh2YXIgY29udHJvbGxlciA9IHRoaXMubV9jb250cm9sbGVyTGlzdDsgY29udHJvbGxlcjsgY29udHJvbGxlciA9IGNvbnRyb2xsZXIubV9uZXh0KSB7XG4gICAgICAgICBjb250cm9sbGVyLlN0ZXAoc3RlcCk7XG4gICAgICB9XG4gICAgICB2YXIgaXNsYW5kID0gdGhpcy5tX2lzbGFuZDtcbiAgICAgIGlzbGFuZC5Jbml0aWFsaXplKHRoaXMubV9ib2R5Q291bnQsIHRoaXMubV9jb250YWN0Q291bnQsIHRoaXMubV9qb2ludENvdW50LCBudWxsLCB0aGlzLm1fY29udGFjdE1hbmFnZXIubV9jb250YWN0TGlzdGVuZXIsIHRoaXMubV9jb250YWN0U29sdmVyKTtcbiAgICAgIGZvciAoYiA9IHRoaXMubV9ib2R5TGlzdDtcbiAgICAgIGI7IGIgPSBiLm1fbmV4dCkge1xuICAgICAgICAgYi5tX2ZsYWdzICY9IH5iMkJvZHkuZV9pc2xhbmRGbGFnO1xuICAgICAgfVxuICAgICAgZm9yICh2YXIgYyA9IHRoaXMubV9jb250YWN0TGlzdDsgYzsgYyA9IGMubV9uZXh0KSB7XG4gICAgICAgICBjLm1fZmxhZ3MgJj0gfmIyQ29udGFjdC5lX2lzbGFuZEZsYWc7XG4gICAgICB9XG4gICAgICBmb3IgKHZhciBqID0gdGhpcy5tX2pvaW50TGlzdDsgajsgaiA9IGoubV9uZXh0KSB7XG4gICAgICAgICBqLm1faXNsYW5kRmxhZyA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgdmFyIHN0YWNrU2l6ZSA9IHBhcnNlSW50KHRoaXMubV9ib2R5Q291bnQpO1xuICAgICAgdmFyIHN0YWNrID0gdGhpcy5zX3N0YWNrO1xuICAgICAgZm9yICh2YXIgc2VlZCA9IHRoaXMubV9ib2R5TGlzdDsgc2VlZDsgc2VlZCA9IHNlZWQubV9uZXh0KSB7XG4gICAgICAgICBpZiAoc2VlZC5tX2ZsYWdzICYgYjJCb2R5LmVfaXNsYW5kRmxhZykge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICB9XG4gICAgICAgICBpZiAoc2VlZC5Jc0F3YWtlKCkgPT0gZmFsc2UgfHwgc2VlZC5Jc0FjdGl2ZSgpID09IGZhbHNlKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgIH1cbiAgICAgICAgIGlmIChzZWVkLkdldFR5cGUoKSA9PSBiMkJvZHkuYjJfc3RhdGljQm9keSkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICB9XG4gICAgICAgICBpc2xhbmQuQ2xlYXIoKTtcbiAgICAgICAgIHZhciBzdGFja0NvdW50ID0gMDtcbiAgICAgICAgIHN0YWNrW3N0YWNrQ291bnQrK10gPSBzZWVkO1xuICAgICAgICAgc2VlZC5tX2ZsYWdzIHw9IGIyQm9keS5lX2lzbGFuZEZsYWc7XG4gICAgICAgICB3aGlsZSAoc3RhY2tDb3VudCA+IDApIHtcbiAgICAgICAgICAgIGIgPSBzdGFja1stLXN0YWNrQ291bnRdO1xuICAgICAgICAgICAgaXNsYW5kLkFkZEJvZHkoYik7XG4gICAgICAgICAgICBpZiAoYi5Jc0F3YWtlKCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgIGIuU2V0QXdha2UodHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYi5HZXRUeXBlKCkgPT0gYjJCb2R5LmIyX3N0YXRpY0JvZHkpIHtcbiAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG90aGVyO1xuICAgICAgICAgICAgZm9yICh2YXIgY2UgPSBiLm1fY29udGFjdExpc3Q7IGNlOyBjZSA9IGNlLm5leHQpIHtcbiAgICAgICAgICAgICAgIGlmIChjZS5jb250YWN0Lm1fZmxhZ3MgJiBiMkNvbnRhY3QuZV9pc2xhbmRGbGFnKSB7XG4gICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIGlmIChjZS5jb250YWN0LklzU2Vuc29yKCkgPT0gdHJ1ZSB8fCBjZS5jb250YWN0LklzRW5hYmxlZCgpID09IGZhbHNlIHx8IGNlLmNvbnRhY3QuSXNUb3VjaGluZygpID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIGlzbGFuZC5BZGRDb250YWN0KGNlLmNvbnRhY3QpO1xuICAgICAgICAgICAgICAgY2UuY29udGFjdC5tX2ZsYWdzIHw9IGIyQ29udGFjdC5lX2lzbGFuZEZsYWc7XG4gICAgICAgICAgICAgICBvdGhlciA9IGNlLm90aGVyO1xuICAgICAgICAgICAgICAgaWYgKG90aGVyLm1fZmxhZ3MgJiBiMkJvZHkuZV9pc2xhbmRGbGFnKSB7XG4gICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIHN0YWNrW3N0YWNrQ291bnQrK10gPSBvdGhlcjtcbiAgICAgICAgICAgICAgIG90aGVyLm1fZmxhZ3MgfD0gYjJCb2R5LmVfaXNsYW5kRmxhZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGpuID0gYi5tX2pvaW50TGlzdDsgam47IGpuID0gam4ubmV4dCkge1xuICAgICAgICAgICAgICAgaWYgKGpuLmpvaW50Lm1faXNsYW5kRmxhZyA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIG90aGVyID0gam4ub3RoZXI7XG4gICAgICAgICAgICAgICBpZiAob3RoZXIuSXNBY3RpdmUoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBpc2xhbmQuQWRkSm9pbnQoam4uam9pbnQpO1xuICAgICAgICAgICAgICAgam4uam9pbnQubV9pc2xhbmRGbGFnID0gdHJ1ZTtcbiAgICAgICAgICAgICAgIGlmIChvdGhlci5tX2ZsYWdzICYgYjJCb2R5LmVfaXNsYW5kRmxhZykge1xuICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBzdGFja1tzdGFja0NvdW50KytdID0gb3RoZXI7XG4gICAgICAgICAgICAgICBvdGhlci5tX2ZsYWdzIHw9IGIyQm9keS5lX2lzbGFuZEZsYWc7XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICAgICBpc2xhbmQuU29sdmUoc3RlcCwgdGhpcy5tX2dyYXZpdHksIHRoaXMubV9hbGxvd1NsZWVwKTtcbiAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXNsYW5kLm1fYm9keUNvdW50OyArK2kpIHtcbiAgICAgICAgICAgIGIgPSBpc2xhbmQubV9ib2RpZXNbaV07XG4gICAgICAgICAgICBpZiAoYi5HZXRUeXBlKCkgPT0gYjJCb2R5LmIyX3N0YXRpY0JvZHkpIHtcbiAgICAgICAgICAgICAgIGIubV9mbGFncyAmPSB+YjJCb2R5LmVfaXNsYW5kRmxhZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoaSA9IDA7XG4gICAgICBpIDwgc3RhY2subGVuZ3RoOyArK2kpIHtcbiAgICAgICAgIGlmICghc3RhY2tbaV0pIGJyZWFrO1xuICAgICAgICAgc3RhY2tbaV0gPSBudWxsO1xuICAgICAgfVxuICAgICAgZm9yIChiID0gdGhpcy5tX2JvZHlMaXN0O1xuICAgICAgYjsgYiA9IGIubV9uZXh0KSB7XG4gICAgICAgICBpZiAoYi5Jc0F3YWtlKCkgPT0gZmFsc2UgfHwgYi5Jc0FjdGl2ZSgpID09IGZhbHNlKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgIH1cbiAgICAgICAgIGlmIChiLkdldFR5cGUoKSA9PSBiMkJvZHkuYjJfc3RhdGljQm9keSkge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICB9XG4gICAgICAgICBiLlN5bmNocm9uaXplRml4dHVyZXMoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubV9jb250YWN0TWFuYWdlci5GaW5kTmV3Q29udGFjdHMoKTtcbiAgIH1cbiAgIGIyV29ybGQucHJvdG90eXBlLlNvbHZlVE9JID0gZnVuY3Rpb24gKHN0ZXApIHtcbiAgICAgIHZhciBiO1xuICAgICAgdmFyIGZBO1xuICAgICAgdmFyIGZCO1xuICAgICAgdmFyIGJBO1xuICAgICAgdmFyIGJCO1xuICAgICAgdmFyIGNFZGdlO1xuICAgICAgdmFyIGo7XG4gICAgICB2YXIgaXNsYW5kID0gdGhpcy5tX2lzbGFuZDtcbiAgICAgIGlzbGFuZC5Jbml0aWFsaXplKHRoaXMubV9ib2R5Q291bnQsIGIyU2V0dGluZ3MuYjJfbWF4VE9JQ29udGFjdHNQZXJJc2xhbmQsIGIyU2V0dGluZ3MuYjJfbWF4VE9JSm9pbnRzUGVySXNsYW5kLCBudWxsLCB0aGlzLm1fY29udGFjdE1hbmFnZXIubV9jb250YWN0TGlzdGVuZXIsIHRoaXMubV9jb250YWN0U29sdmVyKTtcbiAgICAgIHZhciBxdWV1ZSA9IGIyV29ybGQuc19xdWV1ZTtcbiAgICAgIGZvciAoYiA9IHRoaXMubV9ib2R5TGlzdDtcbiAgICAgIGI7IGIgPSBiLm1fbmV4dCkge1xuICAgICAgICAgYi5tX2ZsYWdzICY9IH5iMkJvZHkuZV9pc2xhbmRGbGFnO1xuICAgICAgICAgYi5tX3N3ZWVwLnQwID0gMC4wO1xuICAgICAgfVxuICAgICAgdmFyIGM7XG4gICAgICBmb3IgKGMgPSB0aGlzLm1fY29udGFjdExpc3Q7XG4gICAgICBjOyBjID0gYy5tX25leHQpIHtcbiAgICAgICAgIGMubV9mbGFncyAmPSB+IChiMkNvbnRhY3QuZV90b2lGbGFnIHwgYjJDb250YWN0LmVfaXNsYW5kRmxhZyk7XG4gICAgICB9XG4gICAgICBmb3IgKGogPSB0aGlzLm1fam9pbnRMaXN0O1xuICAgICAgajsgaiA9IGoubV9uZXh0KSB7XG4gICAgICAgICBqLm1faXNsYW5kRmxhZyA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgZm9yICg7Oykge1xuICAgICAgICAgdmFyIG1pbkNvbnRhY3QgPSBudWxsO1xuICAgICAgICAgdmFyIG1pblRPSSA9IDEuMDtcbiAgICAgICAgIGZvciAoYyA9IHRoaXMubV9jb250YWN0TGlzdDtcbiAgICAgICAgIGM7IGMgPSBjLm1fbmV4dCkge1xuICAgICAgICAgICAgaWYgKGMuSXNTZW5zb3IoKSA9PSB0cnVlIHx8IGMuSXNFbmFibGVkKCkgPT0gZmFsc2UgfHwgYy5Jc0NvbnRpbnVvdXMoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdG9pID0gMS4wO1xuICAgICAgICAgICAgaWYgKGMubV9mbGFncyAmIGIyQ29udGFjdC5lX3RvaUZsYWcpIHtcbiAgICAgICAgICAgICAgIHRvaSA9IGMubV90b2k7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgIGZBID0gYy5tX2ZpeHR1cmVBO1xuICAgICAgICAgICAgICAgZkIgPSBjLm1fZml4dHVyZUI7XG4gICAgICAgICAgICAgICBiQSA9IGZBLm1fYm9keTtcbiAgICAgICAgICAgICAgIGJCID0gZkIubV9ib2R5O1xuICAgICAgICAgICAgICAgaWYgKChiQS5HZXRUeXBlKCkgIT0gYjJCb2R5LmIyX2R5bmFtaWNCb2R5IHx8IGJBLklzQXdha2UoKSA9PSBmYWxzZSkgJiYgKGJCLkdldFR5cGUoKSAhPSBiMkJvZHkuYjJfZHluYW1pY0JvZHkgfHwgYkIuSXNBd2FrZSgpID09IGZhbHNlKSkge1xuICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICB2YXIgdDAgPSBiQS5tX3N3ZWVwLnQwO1xuICAgICAgICAgICAgICAgaWYgKGJBLm1fc3dlZXAudDAgPCBiQi5tX3N3ZWVwLnQwKSB7XG4gICAgICAgICAgICAgICAgICB0MCA9IGJCLm1fc3dlZXAudDA7XG4gICAgICAgICAgICAgICAgICBiQS5tX3N3ZWVwLkFkdmFuY2UodDApO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgZWxzZSBpZiAoYkIubV9zd2VlcC50MCA8IGJBLm1fc3dlZXAudDApIHtcbiAgICAgICAgICAgICAgICAgIHQwID0gYkEubV9zd2VlcC50MDtcbiAgICAgICAgICAgICAgICAgIGJCLm1fc3dlZXAuQWR2YW5jZSh0MCk7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICB0b2kgPSBjLkNvbXB1dGVUT0koYkEubV9zd2VlcCwgYkIubV9zd2VlcCk7XG4gICAgICAgICAgICAgICBiMlNldHRpbmdzLmIyQXNzZXJ0KDAuMCA8PSB0b2kgJiYgdG9pIDw9IDEuMCk7XG4gICAgICAgICAgICAgICBpZiAodG9pID4gMC4wICYmIHRvaSA8IDEuMCkge1xuICAgICAgICAgICAgICAgICAgdG9pID0gKDEuMCAtIHRvaSkgKiB0MCArIHRvaTtcbiAgICAgICAgICAgICAgICAgIGlmICh0b2kgPiAxKSB0b2kgPSAxO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgYy5tX3RvaSA9IHRvaTtcbiAgICAgICAgICAgICAgIGMubV9mbGFncyB8PSBiMkNvbnRhY3QuZV90b2lGbGFnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKE51bWJlci5NSU5fVkFMVUUgPCB0b2kgJiYgdG9pIDwgbWluVE9JKSB7XG4gICAgICAgICAgICAgICBtaW5Db250YWN0ID0gYztcbiAgICAgICAgICAgICAgIG1pblRPSSA9IHRvaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgICAgIGlmIChtaW5Db250YWN0ID09IG51bGwgfHwgMS4wIC0gMTAwLjAgKiBOdW1iZXIuTUlOX1ZBTFVFIDwgbWluVE9JKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgIH1cbiAgICAgICAgIGZBID0gbWluQ29udGFjdC5tX2ZpeHR1cmVBO1xuICAgICAgICAgZkIgPSBtaW5Db250YWN0Lm1fZml4dHVyZUI7XG4gICAgICAgICBiQSA9IGZBLm1fYm9keTtcbiAgICAgICAgIGJCID0gZkIubV9ib2R5O1xuICAgICAgICAgYjJXb3JsZC5zX2JhY2t1cEEuU2V0KGJBLm1fc3dlZXApO1xuICAgICAgICAgYjJXb3JsZC5zX2JhY2t1cEIuU2V0KGJCLm1fc3dlZXApO1xuICAgICAgICAgYkEuQWR2YW5jZShtaW5UT0kpO1xuICAgICAgICAgYkIuQWR2YW5jZShtaW5UT0kpO1xuICAgICAgICAgbWluQ29udGFjdC5VcGRhdGUodGhpcy5tX2NvbnRhY3RNYW5hZ2VyLm1fY29udGFjdExpc3RlbmVyKTtcbiAgICAgICAgIG1pbkNvbnRhY3QubV9mbGFncyAmPSB+YjJDb250YWN0LmVfdG9pRmxhZztcbiAgICAgICAgIGlmIChtaW5Db250YWN0LklzU2Vuc29yKCkgPT0gdHJ1ZSB8fCBtaW5Db250YWN0LklzRW5hYmxlZCgpID09IGZhbHNlKSB7XG4gICAgICAgICAgICBiQS5tX3N3ZWVwLlNldChiMldvcmxkLnNfYmFja3VwQSk7XG4gICAgICAgICAgICBiQi5tX3N3ZWVwLlNldChiMldvcmxkLnNfYmFja3VwQik7XG4gICAgICAgICAgICBiQS5TeW5jaHJvbml6ZVRyYW5zZm9ybSgpO1xuICAgICAgICAgICAgYkIuU3luY2hyb25pemVUcmFuc2Zvcm0oKTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgfVxuICAgICAgICAgaWYgKG1pbkNvbnRhY3QuSXNUb3VjaGluZygpID09IGZhbHNlKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgIH1cbiAgICAgICAgIHZhciBzZWVkID0gYkE7XG4gICAgICAgICBpZiAoc2VlZC5HZXRUeXBlKCkgIT0gYjJCb2R5LmIyX2R5bmFtaWNCb2R5KSB7XG4gICAgICAgICAgICBzZWVkID0gYkI7XG4gICAgICAgICB9XG4gICAgICAgICBpc2xhbmQuQ2xlYXIoKTtcbiAgICAgICAgIHZhciBxdWV1ZVN0YXJ0ID0gMDtcbiAgICAgICAgIHZhciBxdWV1ZVNpemUgPSAwO1xuICAgICAgICAgcXVldWVbcXVldWVTdGFydCArIHF1ZXVlU2l6ZSsrXSA9IHNlZWQ7XG4gICAgICAgICBzZWVkLm1fZmxhZ3MgfD0gYjJCb2R5LmVfaXNsYW5kRmxhZztcbiAgICAgICAgIHdoaWxlIChxdWV1ZVNpemUgPiAwKSB7XG4gICAgICAgICAgICBiID0gcXVldWVbcXVldWVTdGFydCsrXTtcbiAgICAgICAgICAgIC0tcXVldWVTaXplO1xuICAgICAgICAgICAgaXNsYW5kLkFkZEJvZHkoYik7XG4gICAgICAgICAgICBpZiAoYi5Jc0F3YWtlKCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgIGIuU2V0QXdha2UodHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYi5HZXRUeXBlKCkgIT0gYjJCb2R5LmIyX2R5bmFtaWNCb2R5KSB7XG4gICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoY0VkZ2UgPSBiLm1fY29udGFjdExpc3Q7XG4gICAgICAgICAgICBjRWRnZTsgY0VkZ2UgPSBjRWRnZS5uZXh0KSB7XG4gICAgICAgICAgICAgICBpZiAoaXNsYW5kLm1fY29udGFjdENvdW50ID09IGlzbGFuZC5tX2NvbnRhY3RDYXBhY2l0eSkge1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBpZiAoY0VkZ2UuY29udGFjdC5tX2ZsYWdzICYgYjJDb250YWN0LmVfaXNsYW5kRmxhZykge1xuICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBpZiAoY0VkZ2UuY29udGFjdC5Jc1NlbnNvcigpID09IHRydWUgfHwgY0VkZ2UuY29udGFjdC5Jc0VuYWJsZWQoKSA9PSBmYWxzZSB8fCBjRWRnZS5jb250YWN0LklzVG91Y2hpbmcoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBpc2xhbmQuQWRkQ29udGFjdChjRWRnZS5jb250YWN0KTtcbiAgICAgICAgICAgICAgIGNFZGdlLmNvbnRhY3QubV9mbGFncyB8PSBiMkNvbnRhY3QuZV9pc2xhbmRGbGFnO1xuICAgICAgICAgICAgICAgdmFyIG90aGVyID0gY0VkZ2Uub3RoZXI7XG4gICAgICAgICAgICAgICBpZiAob3RoZXIubV9mbGFncyAmIGIyQm9keS5lX2lzbGFuZEZsYWcpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgaWYgKG90aGVyLkdldFR5cGUoKSAhPSBiMkJvZHkuYjJfc3RhdGljQm9keSkge1xuICAgICAgICAgICAgICAgICAgb3RoZXIuQWR2YW5jZShtaW5UT0kpO1xuICAgICAgICAgICAgICAgICAgb3RoZXIuU2V0QXdha2UodHJ1ZSk7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBxdWV1ZVtxdWV1ZVN0YXJ0ICsgcXVldWVTaXplXSA9IG90aGVyO1xuICAgICAgICAgICAgICAgKytxdWV1ZVNpemU7XG4gICAgICAgICAgICAgICBvdGhlci5tX2ZsYWdzIHw9IGIyQm9keS5lX2lzbGFuZEZsYWc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKHZhciBqRWRnZSA9IGIubV9qb2ludExpc3Q7IGpFZGdlOyBqRWRnZSA9IGpFZGdlLm5leHQpIHtcbiAgICAgICAgICAgICAgIGlmIChpc2xhbmQubV9qb2ludENvdW50ID09IGlzbGFuZC5tX2pvaW50Q2FwYWNpdHkpIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgaWYgKGpFZGdlLmpvaW50Lm1faXNsYW5kRmxhZyA9PSB0cnVlKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgIG90aGVyID0gakVkZ2Uub3RoZXI7XG4gICAgICAgICAgICAgICBpZiAob3RoZXIuSXNBY3RpdmUoKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBpc2xhbmQuQWRkSm9pbnQoakVkZ2Uuam9pbnQpO1xuICAgICAgICAgICAgICAgakVkZ2Uuam9pbnQubV9pc2xhbmRGbGFnID0gdHJ1ZTtcbiAgICAgICAgICAgICAgIGlmIChvdGhlci5tX2ZsYWdzICYgYjJCb2R5LmVfaXNsYW5kRmxhZykgY29udGludWU7XG4gICAgICAgICAgICAgICBpZiAob3RoZXIuR2V0VHlwZSgpICE9IGIyQm9keS5iMl9zdGF0aWNCb2R5KSB7XG4gICAgICAgICAgICAgICAgICBvdGhlci5BZHZhbmNlKG1pblRPSSk7XG4gICAgICAgICAgICAgICAgICBvdGhlci5TZXRBd2FrZSh0cnVlKTtcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIHF1ZXVlW3F1ZXVlU3RhcnQgKyBxdWV1ZVNpemVdID0gb3RoZXI7XG4gICAgICAgICAgICAgICArK3F1ZXVlU2l6ZTtcbiAgICAgICAgICAgICAgIG90aGVyLm1fZmxhZ3MgfD0gYjJCb2R5LmVfaXNsYW5kRmxhZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgICAgIHZhciBzdWJTdGVwID0gYjJXb3JsZC5zX3RpbWVzdGVwO1xuICAgICAgICAgc3ViU3RlcC53YXJtU3RhcnRpbmcgPSBmYWxzZTtcbiAgICAgICAgIHN1YlN0ZXAuZHQgPSAoMS4wIC0gbWluVE9JKSAqIHN0ZXAuZHQ7XG4gICAgICAgICBzdWJTdGVwLmludl9kdCA9IDEuMCAvIHN1YlN0ZXAuZHQ7XG4gICAgICAgICBzdWJTdGVwLmR0UmF0aW8gPSAwLjA7XG4gICAgICAgICBzdWJTdGVwLnZlbG9jaXR5SXRlcmF0aW9ucyA9IHN0ZXAudmVsb2NpdHlJdGVyYXRpb25zO1xuICAgICAgICAgc3ViU3RlcC5wb3NpdGlvbkl0ZXJhdGlvbnMgPSBzdGVwLnBvc2l0aW9uSXRlcmF0aW9ucztcbiAgICAgICAgIGlzbGFuZC5Tb2x2ZVRPSShzdWJTdGVwKTtcbiAgICAgICAgIHZhciBpID0gMDtcbiAgICAgICAgIGZvciAoaSA9IDA7XG4gICAgICAgICBpIDwgaXNsYW5kLm1fYm9keUNvdW50OyArK2kpIHtcbiAgICAgICAgICAgIGIgPSBpc2xhbmQubV9ib2RpZXNbaV07XG4gICAgICAgICAgICBiLm1fZmxhZ3MgJj0gfmIyQm9keS5lX2lzbGFuZEZsYWc7XG4gICAgICAgICAgICBpZiAoYi5Jc0F3YWtlKCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGIuR2V0VHlwZSgpICE9IGIyQm9keS5iMl9keW5hbWljQm9keSkge1xuICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBiLlN5bmNocm9uaXplRml4dHVyZXMoKTtcbiAgICAgICAgICAgIGZvciAoY0VkZ2UgPSBiLm1fY29udGFjdExpc3Q7XG4gICAgICAgICAgICBjRWRnZTsgY0VkZ2UgPSBjRWRnZS5uZXh0KSB7XG4gICAgICAgICAgICAgICBjRWRnZS5jb250YWN0Lm1fZmxhZ3MgJj0gfmIyQ29udGFjdC5lX3RvaUZsYWc7XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICAgICBmb3IgKGkgPSAwO1xuICAgICAgICAgaSA8IGlzbGFuZC5tX2NvbnRhY3RDb3VudDsgKytpKSB7XG4gICAgICAgICAgICBjID0gaXNsYW5kLm1fY29udGFjdHNbaV07XG4gICAgICAgICAgICBjLm1fZmxhZ3MgJj0gfiAoYjJDb250YWN0LmVfdG9pRmxhZyB8IGIyQ29udGFjdC5lX2lzbGFuZEZsYWcpO1xuICAgICAgICAgfVxuICAgICAgICAgZm9yIChpID0gMDtcbiAgICAgICAgIGkgPCBpc2xhbmQubV9qb2ludENvdW50OyArK2kpIHtcbiAgICAgICAgICAgIGogPSBpc2xhbmQubV9qb2ludHNbaV07XG4gICAgICAgICAgICBqLm1faXNsYW5kRmxhZyA9IGZhbHNlO1xuICAgICAgICAgfVxuICAgICAgICAgdGhpcy5tX2NvbnRhY3RNYW5hZ2VyLkZpbmROZXdDb250YWN0cygpO1xuICAgICAgfVxuICAgfVxuICAgYjJXb3JsZC5wcm90b3R5cGUuRHJhd0pvaW50ID0gZnVuY3Rpb24gKGpvaW50KSB7XG4gICAgICB2YXIgYjEgPSBqb2ludC5HZXRCb2R5QSgpO1xuICAgICAgdmFyIGIyID0gam9pbnQuR2V0Qm9keUIoKTtcbiAgICAgIHZhciB4ZjEgPSBiMS5tX3hmO1xuICAgICAgdmFyIHhmMiA9IGIyLm1feGY7XG4gICAgICB2YXIgeDEgPSB4ZjEucG9zaXRpb247XG4gICAgICB2YXIgeDIgPSB4ZjIucG9zaXRpb247XG4gICAgICB2YXIgcDEgPSBqb2ludC5HZXRBbmNob3JBKCk7XG4gICAgICB2YXIgcDIgPSBqb2ludC5HZXRBbmNob3JCKCk7XG4gICAgICB2YXIgY29sb3IgPSBiMldvcmxkLnNfam9pbnRDb2xvcjtcbiAgICAgIHN3aXRjaCAoam9pbnQubV90eXBlKSB7XG4gICAgICBjYXNlIGIySm9pbnQuZV9kaXN0YW5jZUpvaW50OlxuICAgICAgICAgdGhpcy5tX2RlYnVnRHJhdy5EcmF3U2VnbWVudChwMSwgcDIsIGNvbG9yKTtcbiAgICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBiMkpvaW50LmVfcHVsbGV5Sm9pbnQ6XG4gICAgICAgICB7XG4gICAgICAgICAgICB2YXIgcHVsbGV5ID0gKChqb2ludCBpbnN0YW5jZW9mIGIyUHVsbGV5Sm9pbnQgPyBqb2ludCA6IG51bGwpKTtcbiAgICAgICAgICAgIHZhciBzMSA9IHB1bGxleS5HZXRHcm91bmRBbmNob3JBKCk7XG4gICAgICAgICAgICB2YXIgczIgPSBwdWxsZXkuR2V0R3JvdW5kQW5jaG9yQigpO1xuICAgICAgICAgICAgdGhpcy5tX2RlYnVnRHJhdy5EcmF3U2VnbWVudChzMSwgcDEsIGNvbG9yKTtcbiAgICAgICAgICAgIHRoaXMubV9kZWJ1Z0RyYXcuRHJhd1NlZ21lbnQoczIsIHAyLCBjb2xvcik7XG4gICAgICAgICAgICB0aGlzLm1fZGVidWdEcmF3LkRyYXdTZWdtZW50KHMxLCBzMiwgY29sb3IpO1xuICAgICAgICAgfVxuICAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGIySm9pbnQuZV9tb3VzZUpvaW50OlxuICAgICAgICAgdGhpcy5tX2RlYnVnRHJhdy5EcmF3U2VnbWVudChwMSwgcDIsIGNvbG9yKTtcbiAgICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgIGlmIChiMSAhPSB0aGlzLm1fZ3JvdW5kQm9keSkgdGhpcy5tX2RlYnVnRHJhdy5EcmF3U2VnbWVudCh4MSwgcDEsIGNvbG9yKTtcbiAgICAgICAgIHRoaXMubV9kZWJ1Z0RyYXcuRHJhd1NlZ21lbnQocDEsIHAyLCBjb2xvcik7XG4gICAgICAgICBpZiAoYjIgIT0gdGhpcy5tX2dyb3VuZEJvZHkpIHRoaXMubV9kZWJ1Z0RyYXcuRHJhd1NlZ21lbnQoeDIsIHAyLCBjb2xvcik7XG4gICAgICB9XG4gICB9XG4gICBiMldvcmxkLnByb3RvdHlwZS5EcmF3U2hhcGUgPSBmdW5jdGlvbiAoc2hhcGUsIHhmLCBjb2xvcikge1xuICAgICAgc3dpdGNoIChzaGFwZS5tX3R5cGUpIHtcbiAgICAgIGNhc2UgYjJTaGFwZS5lX2NpcmNsZVNoYXBlOlxuICAgICAgICAge1xuICAgICAgICAgICAgdmFyIGNpcmNsZSA9ICgoc2hhcGUgaW5zdGFuY2VvZiBiMkNpcmNsZVNoYXBlID8gc2hhcGUgOiBudWxsKSk7XG4gICAgICAgICAgICB2YXIgY2VudGVyID0gYjJNYXRoLk11bFgoeGYsIGNpcmNsZS5tX3ApO1xuICAgICAgICAgICAgdmFyIHJhZGl1cyA9IGNpcmNsZS5tX3JhZGl1cztcbiAgICAgICAgICAgIHZhciBheGlzID0geGYuUi5jb2wxO1xuICAgICAgICAgICAgdGhpcy5tX2RlYnVnRHJhdy5EcmF3U29saWRDaXJjbGUoY2VudGVyLCByYWRpdXMsIGF4aXMsIGNvbG9yKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBiMlNoYXBlLmVfcG9seWdvblNoYXBlOlxuICAgICAgICAge1xuICAgICAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICAgICAgdmFyIHBvbHkgPSAoKHNoYXBlIGluc3RhbmNlb2YgYjJQb2x5Z29uU2hhcGUgPyBzaGFwZSA6IG51bGwpKTtcbiAgICAgICAgICAgIHZhciB2ZXJ0ZXhDb3VudCA9IHBhcnNlSW50KHBvbHkuR2V0VmVydGV4Q291bnQoKSk7XG4gICAgICAgICAgICB2YXIgbG9jYWxWZXJ0aWNlcyA9IHBvbHkuR2V0VmVydGljZXMoKTtcbiAgICAgICAgICAgIHZhciB2ZXJ0aWNlcyA9IG5ldyBWZWN0b3IodmVydGV4Q291bnQpO1xuICAgICAgICAgICAgZm9yIChpID0gMDtcbiAgICAgICAgICAgIGkgPCB2ZXJ0ZXhDb3VudDsgKytpKSB7XG4gICAgICAgICAgICAgICB2ZXJ0aWNlc1tpXSA9IGIyTWF0aC5NdWxYKHhmLCBsb2NhbFZlcnRpY2VzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubV9kZWJ1Z0RyYXcuRHJhd1NvbGlkUG9seWdvbih2ZXJ0aWNlcywgdmVydGV4Q291bnQsIGNvbG9yKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBiMlNoYXBlLmVfZWRnZVNoYXBlOlxuICAgICAgICAge1xuICAgICAgICAgICAgdmFyIGVkZ2UgPSAoc2hhcGUgaW5zdGFuY2VvZiBiMkVkZ2VTaGFwZSA/IHNoYXBlIDogbnVsbCk7XG4gICAgICAgICAgICB0aGlzLm1fZGVidWdEcmF3LkRyYXdTZWdtZW50KGIyTWF0aC5NdWxYKHhmLCBlZGdlLkdldFZlcnRleDEoKSksIGIyTWF0aC5NdWxYKHhmLCBlZGdlLkdldFZlcnRleDIoKSksIGNvbG9yKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgfVxuICAgQm94MkQucG9zdERlZnMucHVzaChmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5iMldvcmxkLnNfdGltZXN0ZXAyID0gbmV3IGIyVGltZVN0ZXAoKTtcbiAgICAgIEJveDJELkR5bmFtaWNzLmIyV29ybGQuc194ZiA9IG5ldyBiMlRyYW5zZm9ybSgpO1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJXb3JsZC5zX2JhY2t1cEEgPSBuZXcgYjJTd2VlcCgpO1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJXb3JsZC5zX2JhY2t1cEIgPSBuZXcgYjJTd2VlcCgpO1xuICAgICAgQm94MkQuRHluYW1pY3MuYjJXb3JsZC5zX3RpbWVzdGVwID0gbmV3IGIyVGltZVN0ZXAoKTtcbiAgICAgIEJveDJELkR5bmFtaWNzLmIyV29ybGQuc19xdWV1ZSA9IG5ldyBWZWN0b3IoKTtcbiAgICAgIEJveDJELkR5bmFtaWNzLmIyV29ybGQuc19qb2ludENvbG9yID0gbmV3IGIyQ29sb3IoMC41LCAwLjgsIDAuOCk7XG4gICAgICBCb3gyRC5EeW5hbWljcy5iMldvcmxkLmVfbmV3Rml4dHVyZSA9IDB4MDAwMTtcbiAgICAgIEJveDJELkR5bmFtaWNzLmIyV29ybGQuZV9sb2NrZWQgPSAweDAwMDI7XG4gICB9KTtcbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgdmFyIGIyQ2lyY2xlU2hhcGUgPSBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyQ2lyY2xlU2hhcGUsXG4gICAgICBiMkVkZ2VDaGFpbkRlZiA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJFZGdlQ2hhaW5EZWYsXG4gICAgICBiMkVkZ2VTaGFwZSA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJFZGdlU2hhcGUsXG4gICAgICBiMk1hc3NEYXRhID0gQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMk1hc3NEYXRhLFxuICAgICAgYjJQb2x5Z29uU2hhcGUgPSBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyUG9seWdvblNoYXBlLFxuICAgICAgYjJTaGFwZSA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJTaGFwZSxcbiAgICAgIGIyQ2lyY2xlQ29udGFjdCA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ2lyY2xlQ29udGFjdCxcbiAgICAgIGIyQ29udGFjdCA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdCxcbiAgICAgIGIyQ29udGFjdENvbnN0cmFpbnQgPSBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3RDb25zdHJhaW50LFxuICAgICAgYjJDb250YWN0Q29uc3RyYWludFBvaW50ID0gQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0Q29uc3RyYWludFBvaW50LFxuICAgICAgYjJDb250YWN0RWRnZSA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdEVkZ2UsXG4gICAgICBiMkNvbnRhY3RGYWN0b3J5ID0gQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0RmFjdG9yeSxcbiAgICAgIGIyQ29udGFjdFJlZ2lzdGVyID0gQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0UmVnaXN0ZXIsXG4gICAgICBiMkNvbnRhY3RSZXN1bHQgPSBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3RSZXN1bHQsXG4gICAgICBiMkNvbnRhY3RTb2x2ZXIgPSBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3RTb2x2ZXIsXG4gICAgICBiMkVkZ2VBbmRDaXJjbGVDb250YWN0ID0gQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJFZGdlQW5kQ2lyY2xlQ29udGFjdCxcbiAgICAgIGIyTnVsbENvbnRhY3QgPSBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMk51bGxDb250YWN0LFxuICAgICAgYjJQb2x5QW5kQ2lyY2xlQ29udGFjdCA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyUG9seUFuZENpcmNsZUNvbnRhY3QsXG4gICAgICBiMlBvbHlBbmRFZGdlQ29udGFjdCA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyUG9seUFuZEVkZ2VDb250YWN0LFxuICAgICAgYjJQb2x5Z29uQ29udGFjdCA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyUG9seWdvbkNvbnRhY3QsXG4gICAgICBiMlBvc2l0aW9uU29sdmVyTWFuaWZvbGQgPSBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMlBvc2l0aW9uU29sdmVyTWFuaWZvbGQsXG4gICAgICBiMkJvZHkgPSBCb3gyRC5EeW5hbWljcy5iMkJvZHksXG4gICAgICBiMkJvZHlEZWYgPSBCb3gyRC5EeW5hbWljcy5iMkJvZHlEZWYsXG4gICAgICBiMkNvbnRhY3RGaWx0ZXIgPSBCb3gyRC5EeW5hbWljcy5iMkNvbnRhY3RGaWx0ZXIsXG4gICAgICBiMkNvbnRhY3RJbXB1bHNlID0gQm94MkQuRHluYW1pY3MuYjJDb250YWN0SW1wdWxzZSxcbiAgICAgIGIyQ29udGFjdExpc3RlbmVyID0gQm94MkQuRHluYW1pY3MuYjJDb250YWN0TGlzdGVuZXIsXG4gICAgICBiMkNvbnRhY3RNYW5hZ2VyID0gQm94MkQuRHluYW1pY3MuYjJDb250YWN0TWFuYWdlcixcbiAgICAgIGIyRGVidWdEcmF3ID0gQm94MkQuRHluYW1pY3MuYjJEZWJ1Z0RyYXcsXG4gICAgICBiMkRlc3RydWN0aW9uTGlzdGVuZXIgPSBCb3gyRC5EeW5hbWljcy5iMkRlc3RydWN0aW9uTGlzdGVuZXIsXG4gICAgICBiMkZpbHRlckRhdGEgPSBCb3gyRC5EeW5hbWljcy5iMkZpbHRlckRhdGEsXG4gICAgICBiMkZpeHR1cmUgPSBCb3gyRC5EeW5hbWljcy5iMkZpeHR1cmUsXG4gICAgICBiMkZpeHR1cmVEZWYgPSBCb3gyRC5EeW5hbWljcy5iMkZpeHR1cmVEZWYsXG4gICAgICBiMklzbGFuZCA9IEJveDJELkR5bmFtaWNzLmIySXNsYW5kLFxuICAgICAgYjJUaW1lU3RlcCA9IEJveDJELkR5bmFtaWNzLmIyVGltZVN0ZXAsXG4gICAgICBiMldvcmxkID0gQm94MkQuRHluYW1pY3MuYjJXb3JsZCxcbiAgICAgIGIyQ29sb3IgPSBCb3gyRC5Db21tb24uYjJDb2xvcixcbiAgICAgIGIyaW50ZXJuYWwgPSBCb3gyRC5Db21tb24uYjJpbnRlcm5hbCxcbiAgICAgIGIyU2V0dGluZ3MgPSBCb3gyRC5Db21tb24uYjJTZXR0aW5ncyxcbiAgICAgIGIyTWF0MjIgPSBCb3gyRC5Db21tb24uTWF0aC5iMk1hdDIyLFxuICAgICAgYjJNYXQzMyA9IEJveDJELkNvbW1vbi5NYXRoLmIyTWF0MzMsXG4gICAgICBiMk1hdGggPSBCb3gyRC5Db21tb24uTWF0aC5iMk1hdGgsXG4gICAgICBiMlN3ZWVwID0gQm94MkQuQ29tbW9uLk1hdGguYjJTd2VlcCxcbiAgICAgIGIyVHJhbnNmb3JtID0gQm94MkQuQ29tbW9uLk1hdGguYjJUcmFuc2Zvcm0sXG4gICAgICBiMlZlYzIgPSBCb3gyRC5Db21tb24uTWF0aC5iMlZlYzIsXG4gICAgICBiMlZlYzMgPSBCb3gyRC5Db21tb24uTWF0aC5iMlZlYzMsXG4gICAgICBiMkFBQkIgPSBCb3gyRC5Db2xsaXNpb24uYjJBQUJCLFxuICAgICAgYjJCb3VuZCA9IEJveDJELkNvbGxpc2lvbi5iMkJvdW5kLFxuICAgICAgYjJCb3VuZFZhbHVlcyA9IEJveDJELkNvbGxpc2lvbi5iMkJvdW5kVmFsdWVzLFxuICAgICAgYjJDb2xsaXNpb24gPSBCb3gyRC5Db2xsaXNpb24uYjJDb2xsaXNpb24sXG4gICAgICBiMkNvbnRhY3RJRCA9IEJveDJELkNvbGxpc2lvbi5iMkNvbnRhY3RJRCxcbiAgICAgIGIyQ29udGFjdFBvaW50ID0gQm94MkQuQ29sbGlzaW9uLmIyQ29udGFjdFBvaW50LFxuICAgICAgYjJEaXN0YW5jZSA9IEJveDJELkNvbGxpc2lvbi5iMkRpc3RhbmNlLFxuICAgICAgYjJEaXN0YW5jZUlucHV0ID0gQm94MkQuQ29sbGlzaW9uLmIyRGlzdGFuY2VJbnB1dCxcbiAgICAgIGIyRGlzdGFuY2VPdXRwdXQgPSBCb3gyRC5Db2xsaXNpb24uYjJEaXN0YW5jZU91dHB1dCxcbiAgICAgIGIyRGlzdGFuY2VQcm94eSA9IEJveDJELkNvbGxpc2lvbi5iMkRpc3RhbmNlUHJveHksXG4gICAgICBiMkR5bmFtaWNUcmVlID0gQm94MkQuQ29sbGlzaW9uLmIyRHluYW1pY1RyZWUsXG4gICAgICBiMkR5bmFtaWNUcmVlQnJvYWRQaGFzZSA9IEJveDJELkNvbGxpc2lvbi5iMkR5bmFtaWNUcmVlQnJvYWRQaGFzZSxcbiAgICAgIGIyRHluYW1pY1RyZWVOb2RlID0gQm94MkQuQ29sbGlzaW9uLmIyRHluYW1pY1RyZWVOb2RlLFxuICAgICAgYjJEeW5hbWljVHJlZVBhaXIgPSBCb3gyRC5Db2xsaXNpb24uYjJEeW5hbWljVHJlZVBhaXIsXG4gICAgICBiMk1hbmlmb2xkID0gQm94MkQuQ29sbGlzaW9uLmIyTWFuaWZvbGQsXG4gICAgICBiMk1hbmlmb2xkUG9pbnQgPSBCb3gyRC5Db2xsaXNpb24uYjJNYW5pZm9sZFBvaW50LFxuICAgICAgYjJQb2ludCA9IEJveDJELkNvbGxpc2lvbi5iMlBvaW50LFxuICAgICAgYjJSYXlDYXN0SW5wdXQgPSBCb3gyRC5Db2xsaXNpb24uYjJSYXlDYXN0SW5wdXQsXG4gICAgICBiMlJheUNhc3RPdXRwdXQgPSBCb3gyRC5Db2xsaXNpb24uYjJSYXlDYXN0T3V0cHV0LFxuICAgICAgYjJTZWdtZW50ID0gQm94MkQuQ29sbGlzaW9uLmIyU2VnbWVudCxcbiAgICAgIGIyU2VwYXJhdGlvbkZ1bmN0aW9uID0gQm94MkQuQ29sbGlzaW9uLmIyU2VwYXJhdGlvbkZ1bmN0aW9uLFxuICAgICAgYjJTaW1wbGV4ID0gQm94MkQuQ29sbGlzaW9uLmIyU2ltcGxleCxcbiAgICAgIGIyU2ltcGxleENhY2hlID0gQm94MkQuQ29sbGlzaW9uLmIyU2ltcGxleENhY2hlLFxuICAgICAgYjJTaW1wbGV4VmVydGV4ID0gQm94MkQuQ29sbGlzaW9uLmIyU2ltcGxleFZlcnRleCxcbiAgICAgIGIyVGltZU9mSW1wYWN0ID0gQm94MkQuQ29sbGlzaW9uLmIyVGltZU9mSW1wYWN0LFxuICAgICAgYjJUT0lJbnB1dCA9IEJveDJELkNvbGxpc2lvbi5iMlRPSUlucHV0LFxuICAgICAgYjJXb3JsZE1hbmlmb2xkID0gQm94MkQuQ29sbGlzaW9uLmIyV29ybGRNYW5pZm9sZCxcbiAgICAgIENsaXBWZXJ0ZXggPSBCb3gyRC5Db2xsaXNpb24uQ2xpcFZlcnRleCxcbiAgICAgIEZlYXR1cmVzID0gQm94MkQuQ29sbGlzaW9uLkZlYXR1cmVzLFxuICAgICAgSUJyb2FkUGhhc2UgPSBCb3gyRC5Db2xsaXNpb24uSUJyb2FkUGhhc2U7XG5cbiAgIEJveDJELmluaGVyaXQoYjJDaXJjbGVDb250YWN0LCBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3QpO1xuICAgYjJDaXJjbGVDb250YWN0LnByb3RvdHlwZS5fX3N1cGVyID0gQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0LnByb3RvdHlwZTtcbiAgIGIyQ2lyY2xlQ29udGFjdC5iMkNpcmNsZUNvbnRhY3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3QuYjJDb250YWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgYjJDaXJjbGVDb250YWN0LkNyZWF0ZSA9IGZ1bmN0aW9uIChhbGxvY2F0b3IpIHtcbiAgICAgIHJldHVybiBuZXcgYjJDaXJjbGVDb250YWN0KCk7XG4gICB9XG4gICBiMkNpcmNsZUNvbnRhY3QuRGVzdHJveSA9IGZ1bmN0aW9uIChjb250YWN0LCBhbGxvY2F0b3IpIHt9XG4gICBiMkNpcmNsZUNvbnRhY3QucHJvdG90eXBlLlJlc2V0ID0gZnVuY3Rpb24gKGZpeHR1cmVBLCBmaXh0dXJlQikge1xuICAgICAgdGhpcy5fX3N1cGVyLlJlc2V0LmNhbGwodGhpcywgZml4dHVyZUEsIGZpeHR1cmVCKTtcbiAgIH1cbiAgIGIyQ2lyY2xlQ29udGFjdC5wcm90b3R5cGUuRXZhbHVhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgYkEgPSB0aGlzLm1fZml4dHVyZUEuR2V0Qm9keSgpO1xuICAgICAgdmFyIGJCID0gdGhpcy5tX2ZpeHR1cmVCLkdldEJvZHkoKTtcbiAgICAgIGIyQ29sbGlzaW9uLkNvbGxpZGVDaXJjbGVzKHRoaXMubV9tYW5pZm9sZCwgKHRoaXMubV9maXh0dXJlQS5HZXRTaGFwZSgpIGluc3RhbmNlb2YgYjJDaXJjbGVTaGFwZSA/IHRoaXMubV9maXh0dXJlQS5HZXRTaGFwZSgpIDogbnVsbCksIGJBLm1feGYsICh0aGlzLm1fZml4dHVyZUIuR2V0U2hhcGUoKSBpbnN0YW5jZW9mIGIyQ2lyY2xlU2hhcGUgPyB0aGlzLm1fZml4dHVyZUIuR2V0U2hhcGUoKSA6IG51bGwpLCBiQi5tX3hmKTtcbiAgIH1cbiAgIGIyQ29udGFjdC5iMkNvbnRhY3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1fbm9kZUEgPSBuZXcgYjJDb250YWN0RWRnZSgpO1xuICAgICAgdGhpcy5tX25vZGVCID0gbmV3IGIyQ29udGFjdEVkZ2UoKTtcbiAgICAgIHRoaXMubV9tYW5pZm9sZCA9IG5ldyBiMk1hbmlmb2xkKCk7XG4gICAgICB0aGlzLm1fb2xkTWFuaWZvbGQgPSBuZXcgYjJNYW5pZm9sZCgpO1xuICAgfTtcbiAgIGIyQ29udGFjdC5wcm90b3R5cGUuR2V0TWFuaWZvbGQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX21hbmlmb2xkO1xuICAgfVxuICAgYjJDb250YWN0LnByb3RvdHlwZS5HZXRXb3JsZE1hbmlmb2xkID0gZnVuY3Rpb24gKHdvcmxkTWFuaWZvbGQpIHtcbiAgICAgIHZhciBib2R5QSA9IHRoaXMubV9maXh0dXJlQS5HZXRCb2R5KCk7XG4gICAgICB2YXIgYm9keUIgPSB0aGlzLm1fZml4dHVyZUIuR2V0Qm9keSgpO1xuICAgICAgdmFyIHNoYXBlQSA9IHRoaXMubV9maXh0dXJlQS5HZXRTaGFwZSgpO1xuICAgICAgdmFyIHNoYXBlQiA9IHRoaXMubV9maXh0dXJlQi5HZXRTaGFwZSgpO1xuICAgICAgd29ybGRNYW5pZm9sZC5Jbml0aWFsaXplKHRoaXMubV9tYW5pZm9sZCwgYm9keUEuR2V0VHJhbnNmb3JtKCksIHNoYXBlQS5tX3JhZGl1cywgYm9keUIuR2V0VHJhbnNmb3JtKCksIHNoYXBlQi5tX3JhZGl1cyk7XG4gICB9XG4gICBiMkNvbnRhY3QucHJvdG90eXBlLklzVG91Y2hpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gKHRoaXMubV9mbGFncyAmIGIyQ29udGFjdC5lX3RvdWNoaW5nRmxhZykgPT0gYjJDb250YWN0LmVfdG91Y2hpbmdGbGFnO1xuICAgfVxuICAgYjJDb250YWN0LnByb3RvdHlwZS5Jc0NvbnRpbnVvdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gKHRoaXMubV9mbGFncyAmIGIyQ29udGFjdC5lX2NvbnRpbnVvdXNGbGFnKSA9PSBiMkNvbnRhY3QuZV9jb250aW51b3VzRmxhZztcbiAgIH1cbiAgIGIyQ29udGFjdC5wcm90b3R5cGUuU2V0U2Vuc29yID0gZnVuY3Rpb24gKHNlbnNvcikge1xuICAgICAgaWYgKHNlbnNvcikge1xuICAgICAgICAgdGhpcy5tX2ZsYWdzIHw9IGIyQ29udGFjdC5lX3NlbnNvckZsYWc7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV9mbGFncyAmPSB+YjJDb250YWN0LmVfc2Vuc29yRmxhZztcbiAgICAgIH1cbiAgIH1cbiAgIGIyQ29udGFjdC5wcm90b3R5cGUuSXNTZW5zb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gKHRoaXMubV9mbGFncyAmIGIyQ29udGFjdC5lX3NlbnNvckZsYWcpID09IGIyQ29udGFjdC5lX3NlbnNvckZsYWc7XG4gICB9XG4gICBiMkNvbnRhY3QucHJvdG90eXBlLlNldEVuYWJsZWQgPSBmdW5jdGlvbiAoZmxhZykge1xuICAgICAgaWYgKGZsYWcpIHtcbiAgICAgICAgIHRoaXMubV9mbGFncyB8PSBiMkNvbnRhY3QuZV9lbmFibGVkRmxhZztcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdGhpcy5tX2ZsYWdzICY9IH5iMkNvbnRhY3QuZV9lbmFibGVkRmxhZztcbiAgICAgIH1cbiAgIH1cbiAgIGIyQ29udGFjdC5wcm90b3R5cGUuSXNFbmFibGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuICh0aGlzLm1fZmxhZ3MgJiBiMkNvbnRhY3QuZV9lbmFibGVkRmxhZykgPT0gYjJDb250YWN0LmVfZW5hYmxlZEZsYWc7XG4gICB9XG4gICBiMkNvbnRhY3QucHJvdG90eXBlLkdldE5leHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX25leHQ7XG4gICB9XG4gICBiMkNvbnRhY3QucHJvdG90eXBlLkdldEZpeHR1cmVBID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9maXh0dXJlQTtcbiAgIH1cbiAgIGIyQ29udGFjdC5wcm90b3R5cGUuR2V0Rml4dHVyZUIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2ZpeHR1cmVCO1xuICAgfVxuICAgYjJDb250YWN0LnByb3RvdHlwZS5GbGFnRm9yRmlsdGVyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX2ZsYWdzIHw9IGIyQ29udGFjdC5lX2ZpbHRlckZsYWc7XG4gICB9XG4gICBiMkNvbnRhY3QucHJvdG90eXBlLmIyQ29udGFjdCA9IGZ1bmN0aW9uICgpIHt9XG4gICBiMkNvbnRhY3QucHJvdG90eXBlLlJlc2V0ID0gZnVuY3Rpb24gKGZpeHR1cmVBLCBmaXh0dXJlQikge1xuICAgICAgaWYgKGZpeHR1cmVBID09PSB1bmRlZmluZWQpIGZpeHR1cmVBID0gbnVsbDtcbiAgICAgIGlmIChmaXh0dXJlQiA9PT0gdW5kZWZpbmVkKSBmaXh0dXJlQiA9IG51bGw7XG4gICAgICB0aGlzLm1fZmxhZ3MgPSBiMkNvbnRhY3QuZV9lbmFibGVkRmxhZztcbiAgICAgIGlmICghZml4dHVyZUEgfHwgIWZpeHR1cmVCKSB7XG4gICAgICAgICB0aGlzLm1fZml4dHVyZUEgPSBudWxsO1xuICAgICAgICAgdGhpcy5tX2ZpeHR1cmVCID0gbnVsbDtcbiAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChmaXh0dXJlQS5Jc1NlbnNvcigpIHx8IGZpeHR1cmVCLklzU2Vuc29yKCkpIHtcbiAgICAgICAgIHRoaXMubV9mbGFncyB8PSBiMkNvbnRhY3QuZV9zZW5zb3JGbGFnO1xuICAgICAgfVxuICAgICAgdmFyIGJvZHlBID0gZml4dHVyZUEuR2V0Qm9keSgpO1xuICAgICAgdmFyIGJvZHlCID0gZml4dHVyZUIuR2V0Qm9keSgpO1xuICAgICAgaWYgKGJvZHlBLkdldFR5cGUoKSAhPSBiMkJvZHkuYjJfZHluYW1pY0JvZHkgfHwgYm9keUEuSXNCdWxsZXQoKSB8fCBib2R5Qi5HZXRUeXBlKCkgIT0gYjJCb2R5LmIyX2R5bmFtaWNCb2R5IHx8IGJvZHlCLklzQnVsbGV0KCkpIHtcbiAgICAgICAgIHRoaXMubV9mbGFncyB8PSBiMkNvbnRhY3QuZV9jb250aW51b3VzRmxhZztcbiAgICAgIH1cbiAgICAgIHRoaXMubV9maXh0dXJlQSA9IGZpeHR1cmVBO1xuICAgICAgdGhpcy5tX2ZpeHR1cmVCID0gZml4dHVyZUI7XG4gICAgICB0aGlzLm1fbWFuaWZvbGQubV9wb2ludENvdW50ID0gMDtcbiAgICAgIHRoaXMubV9wcmV2ID0gbnVsbDtcbiAgICAgIHRoaXMubV9uZXh0ID0gbnVsbDtcbiAgICAgIHRoaXMubV9ub2RlQS5jb250YWN0ID0gbnVsbDtcbiAgICAgIHRoaXMubV9ub2RlQS5wcmV2ID0gbnVsbDtcbiAgICAgIHRoaXMubV9ub2RlQS5uZXh0ID0gbnVsbDtcbiAgICAgIHRoaXMubV9ub2RlQS5vdGhlciA9IG51bGw7XG4gICAgICB0aGlzLm1fbm9kZUIuY29udGFjdCA9IG51bGw7XG4gICAgICB0aGlzLm1fbm9kZUIucHJldiA9IG51bGw7XG4gICAgICB0aGlzLm1fbm9kZUIubmV4dCA9IG51bGw7XG4gICAgICB0aGlzLm1fbm9kZUIub3RoZXIgPSBudWxsO1xuICAgfVxuICAgYjJDb250YWN0LnByb3RvdHlwZS5VcGRhdGUgPSBmdW5jdGlvbiAobGlzdGVuZXIpIHtcbiAgICAgIHZhciB0TWFuaWZvbGQgPSB0aGlzLm1fb2xkTWFuaWZvbGQ7XG4gICAgICB0aGlzLm1fb2xkTWFuaWZvbGQgPSB0aGlzLm1fbWFuaWZvbGQ7XG4gICAgICB0aGlzLm1fbWFuaWZvbGQgPSB0TWFuaWZvbGQ7XG4gICAgICB0aGlzLm1fZmxhZ3MgfD0gYjJDb250YWN0LmVfZW5hYmxlZEZsYWc7XG4gICAgICB2YXIgdG91Y2hpbmcgPSBmYWxzZTtcbiAgICAgIHZhciB3YXNUb3VjaGluZyA9ICh0aGlzLm1fZmxhZ3MgJiBiMkNvbnRhY3QuZV90b3VjaGluZ0ZsYWcpID09IGIyQ29udGFjdC5lX3RvdWNoaW5nRmxhZztcbiAgICAgIHZhciBib2R5QSA9IHRoaXMubV9maXh0dXJlQS5tX2JvZHk7XG4gICAgICB2YXIgYm9keUIgPSB0aGlzLm1fZml4dHVyZUIubV9ib2R5O1xuICAgICAgdmFyIGFhYmJPdmVybGFwID0gdGhpcy5tX2ZpeHR1cmVBLm1fYWFiYi5UZXN0T3ZlcmxhcCh0aGlzLm1fZml4dHVyZUIubV9hYWJiKTtcbiAgICAgIGlmICh0aGlzLm1fZmxhZ3MgJiBiMkNvbnRhY3QuZV9zZW5zb3JGbGFnKSB7XG4gICAgICAgICBpZiAoYWFiYk92ZXJsYXApIHtcbiAgICAgICAgICAgIHZhciBzaGFwZUEgPSB0aGlzLm1fZml4dHVyZUEuR2V0U2hhcGUoKTtcbiAgICAgICAgICAgIHZhciBzaGFwZUIgPSB0aGlzLm1fZml4dHVyZUIuR2V0U2hhcGUoKTtcbiAgICAgICAgICAgIHZhciB4ZkEgPSBib2R5QS5HZXRUcmFuc2Zvcm0oKTtcbiAgICAgICAgICAgIHZhciB4ZkIgPSBib2R5Qi5HZXRUcmFuc2Zvcm0oKTtcbiAgICAgICAgICAgIHRvdWNoaW5nID0gYjJTaGFwZS5UZXN0T3ZlcmxhcChzaGFwZUEsIHhmQSwgc2hhcGVCLCB4ZkIpO1xuICAgICAgICAgfVxuICAgICAgICAgdGhpcy5tX21hbmlmb2xkLm1fcG9pbnRDb3VudCA9IDA7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIGlmIChib2R5QS5HZXRUeXBlKCkgIT0gYjJCb2R5LmIyX2R5bmFtaWNCb2R5IHx8IGJvZHlBLklzQnVsbGV0KCkgfHwgYm9keUIuR2V0VHlwZSgpICE9IGIyQm9keS5iMl9keW5hbWljQm9keSB8fCBib2R5Qi5Jc0J1bGxldCgpKSB7XG4gICAgICAgICAgICB0aGlzLm1fZmxhZ3MgfD0gYjJDb250YWN0LmVfY29udGludW91c0ZsYWc7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubV9mbGFncyAmPSB+YjJDb250YWN0LmVfY29udGludW91c0ZsYWc7XG4gICAgICAgICB9XG4gICAgICAgICBpZiAoYWFiYk92ZXJsYXApIHtcbiAgICAgICAgICAgIHRoaXMuRXZhbHVhdGUoKTtcbiAgICAgICAgICAgIHRvdWNoaW5nID0gdGhpcy5tX21hbmlmb2xkLm1fcG9pbnRDb3VudCA+IDA7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubV9tYW5pZm9sZC5tX3BvaW50Q291bnQ7ICsraSkge1xuICAgICAgICAgICAgICAgdmFyIG1wMiA9IHRoaXMubV9tYW5pZm9sZC5tX3BvaW50c1tpXTtcbiAgICAgICAgICAgICAgIG1wMi5tX25vcm1hbEltcHVsc2UgPSAwLjA7XG4gICAgICAgICAgICAgICBtcDIubV90YW5nZW50SW1wdWxzZSA9IDAuMDtcbiAgICAgICAgICAgICAgIHZhciBpZDIgPSBtcDIubV9pZDtcbiAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5tX29sZE1hbmlmb2xkLm1fcG9pbnRDb3VudDsgKytqKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgbXAxID0gdGhpcy5tX29sZE1hbmlmb2xkLm1fcG9pbnRzW2pdO1xuICAgICAgICAgICAgICAgICAgaWYgKG1wMS5tX2lkLmtleSA9PSBpZDIua2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICBtcDIubV9ub3JtYWxJbXB1bHNlID0gbXAxLm1fbm9ybWFsSW1wdWxzZTtcbiAgICAgICAgICAgICAgICAgICAgIG1wMi5tX3RhbmdlbnRJbXB1bHNlID0gbXAxLm1fdGFuZ2VudEltcHVsc2U7XG4gICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tX21hbmlmb2xkLm1fcG9pbnRDb3VudCA9IDA7XG4gICAgICAgICB9XG4gICAgICAgICBpZiAodG91Y2hpbmcgIT0gd2FzVG91Y2hpbmcpIHtcbiAgICAgICAgICAgIGJvZHlBLlNldEF3YWtlKHRydWUpO1xuICAgICAgICAgICAgYm9keUIuU2V0QXdha2UodHJ1ZSk7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAodG91Y2hpbmcpIHtcbiAgICAgICAgIHRoaXMubV9mbGFncyB8PSBiMkNvbnRhY3QuZV90b3VjaGluZ0ZsYWc7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV9mbGFncyAmPSB+YjJDb250YWN0LmVfdG91Y2hpbmdGbGFnO1xuICAgICAgfVxuICAgICAgaWYgKHdhc1RvdWNoaW5nID09IGZhbHNlICYmIHRvdWNoaW5nID09IHRydWUpIHtcbiAgICAgICAgIGxpc3RlbmVyLkJlZ2luQ29udGFjdCh0aGlzKTtcbiAgICAgIH1cbiAgICAgIGlmICh3YXNUb3VjaGluZyA9PSB0cnVlICYmIHRvdWNoaW5nID09IGZhbHNlKSB7XG4gICAgICAgICBsaXN0ZW5lci5FbmRDb250YWN0KHRoaXMpO1xuICAgICAgfVxuICAgICAgaWYgKCh0aGlzLm1fZmxhZ3MgJiBiMkNvbnRhY3QuZV9zZW5zb3JGbGFnKSA9PSAwKSB7XG4gICAgICAgICBsaXN0ZW5lci5QcmVTb2x2ZSh0aGlzLCB0aGlzLm1fb2xkTWFuaWZvbGQpO1xuICAgICAgfVxuICAgfVxuICAgYjJDb250YWN0LnByb3RvdHlwZS5FdmFsdWF0ZSA9IGZ1bmN0aW9uICgpIHt9XG4gICBiMkNvbnRhY3QucHJvdG90eXBlLkNvbXB1dGVUT0kgPSBmdW5jdGlvbiAoc3dlZXBBLCBzd2VlcEIpIHtcbiAgICAgIGIyQ29udGFjdC5zX2lucHV0LnByb3h5QS5TZXQodGhpcy5tX2ZpeHR1cmVBLkdldFNoYXBlKCkpO1xuICAgICAgYjJDb250YWN0LnNfaW5wdXQucHJveHlCLlNldCh0aGlzLm1fZml4dHVyZUIuR2V0U2hhcGUoKSk7XG4gICAgICBiMkNvbnRhY3Quc19pbnB1dC5zd2VlcEEgPSBzd2VlcEE7XG4gICAgICBiMkNvbnRhY3Quc19pbnB1dC5zd2VlcEIgPSBzd2VlcEI7XG4gICAgICBiMkNvbnRhY3Quc19pbnB1dC50b2xlcmFuY2UgPSBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3A7XG4gICAgICByZXR1cm4gYjJUaW1lT2ZJbXBhY3QuVGltZU9mSW1wYWN0KGIyQ29udGFjdC5zX2lucHV0KTtcbiAgIH1cbiAgIEJveDJELnBvc3REZWZzLnB1c2goZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0LmVfc2Vuc29yRmxhZyA9IDB4MDAwMTtcbiAgICAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdC5lX2NvbnRpbnVvdXNGbGFnID0gMHgwMDAyO1xuICAgICAgQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0LmVfaXNsYW5kRmxhZyA9IDB4MDAwNDtcbiAgICAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdC5lX3RvaUZsYWcgPSAweDAwMDg7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3QuZV90b3VjaGluZ0ZsYWcgPSAweDAwMTA7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3QuZV9lbmFibGVkRmxhZyA9IDB4MDAyMDtcbiAgICAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdC5lX2ZpbHRlckZsYWcgPSAweDAwNDA7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3Quc19pbnB1dCA9IG5ldyBiMlRPSUlucHV0KCk7XG4gICB9KTtcbiAgIGIyQ29udGFjdENvbnN0cmFpbnQuYjJDb250YWN0Q29uc3RyYWludCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubG9jYWxQbGFuZU5vcm1hbCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubG9jYWxQb2ludCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubm9ybWFsID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5ub3JtYWxNYXNzID0gbmV3IGIyTWF0MjIoKTtcbiAgICAgIHRoaXMuSyA9IG5ldyBiMk1hdDIyKCk7XG4gICB9O1xuICAgYjJDb250YWN0Q29uc3RyYWludC5wcm90b3R5cGUuYjJDb250YWN0Q29uc3RyYWludCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMucG9pbnRzID0gbmV3IFZlY3RvcihiMlNldHRpbmdzLmIyX21heE1hbmlmb2xkUG9pbnRzKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYjJTZXR0aW5ncy5iMl9tYXhNYW5pZm9sZFBvaW50czsgaSsrKSB7XG4gICAgICAgICB0aGlzLnBvaW50c1tpXSA9IG5ldyBiMkNvbnRhY3RDb25zdHJhaW50UG9pbnQoKTtcbiAgICAgIH1cbiAgIH1cbiAgIGIyQ29udGFjdENvbnN0cmFpbnRQb2ludC5iMkNvbnRhY3RDb25zdHJhaW50UG9pbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmxvY2FsUG9pbnQgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLnJBID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5yQiA9IG5ldyBiMlZlYzIoKTtcbiAgIH07XG4gICBiMkNvbnRhY3RFZGdlLmIyQ29udGFjdEVkZ2UgPSBmdW5jdGlvbiAoKSB7fTtcbiAgIGIyQ29udGFjdEZhY3RvcnkuYjJDb250YWN0RmFjdG9yeSA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJDb250YWN0RmFjdG9yeS5wcm90b3R5cGUuYjJDb250YWN0RmFjdG9yeSA9IGZ1bmN0aW9uIChhbGxvY2F0b3IpIHtcbiAgICAgIHRoaXMubV9hbGxvY2F0b3IgPSBhbGxvY2F0b3I7XG4gICAgICB0aGlzLkluaXRpYWxpemVSZWdpc3RlcnMoKTtcbiAgIH1cbiAgIGIyQ29udGFjdEZhY3RvcnkucHJvdG90eXBlLkFkZFR5cGUgPSBmdW5jdGlvbiAoY3JlYXRlRmNuLCBkZXN0cm95RmNuLCB0eXBlMSwgdHlwZTIpIHtcbiAgICAgIGlmICh0eXBlMSA9PT0gdW5kZWZpbmVkKSB0eXBlMSA9IDA7XG4gICAgICBpZiAodHlwZTIgPT09IHVuZGVmaW5lZCkgdHlwZTIgPSAwO1xuICAgICAgdGhpcy5tX3JlZ2lzdGVyc1t0eXBlMV1bdHlwZTJdLmNyZWF0ZUZjbiA9IGNyZWF0ZUZjbjtcbiAgICAgIHRoaXMubV9yZWdpc3RlcnNbdHlwZTFdW3R5cGUyXS5kZXN0cm95RmNuID0gZGVzdHJveUZjbjtcbiAgICAgIHRoaXMubV9yZWdpc3RlcnNbdHlwZTFdW3R5cGUyXS5wcmltYXJ5ID0gdHJ1ZTtcbiAgICAgIGlmICh0eXBlMSAhPSB0eXBlMikge1xuICAgICAgICAgdGhpcy5tX3JlZ2lzdGVyc1t0eXBlMl1bdHlwZTFdLmNyZWF0ZUZjbiA9IGNyZWF0ZUZjbjtcbiAgICAgICAgIHRoaXMubV9yZWdpc3RlcnNbdHlwZTJdW3R5cGUxXS5kZXN0cm95RmNuID0gZGVzdHJveUZjbjtcbiAgICAgICAgIHRoaXMubV9yZWdpc3RlcnNbdHlwZTJdW3R5cGUxXS5wcmltYXJ5ID0gZmFsc2U7XG4gICAgICB9XG4gICB9XG4gICBiMkNvbnRhY3RGYWN0b3J5LnByb3RvdHlwZS5Jbml0aWFsaXplUmVnaXN0ZXJzID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX3JlZ2lzdGVycyA9IG5ldyBWZWN0b3IoYjJTaGFwZS5lX3NoYXBlVHlwZUNvdW50KTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYjJTaGFwZS5lX3NoYXBlVHlwZUNvdW50OyBpKyspIHtcbiAgICAgICAgIHRoaXMubV9yZWdpc3RlcnNbaV0gPSBuZXcgVmVjdG9yKGIyU2hhcGUuZV9zaGFwZVR5cGVDb3VudCk7XG4gICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGIyU2hhcGUuZV9zaGFwZVR5cGVDb3VudDsgaisrKSB7XG4gICAgICAgICAgICB0aGlzLm1fcmVnaXN0ZXJzW2ldW2pdID0gbmV3IGIyQ29udGFjdFJlZ2lzdGVyKCk7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLkFkZFR5cGUoYjJDaXJjbGVDb250YWN0LkNyZWF0ZSwgYjJDaXJjbGVDb250YWN0LkRlc3Ryb3ksIGIyU2hhcGUuZV9jaXJjbGVTaGFwZSwgYjJTaGFwZS5lX2NpcmNsZVNoYXBlKTtcbiAgICAgIHRoaXMuQWRkVHlwZShiMlBvbHlBbmRDaXJjbGVDb250YWN0LkNyZWF0ZSwgYjJQb2x5QW5kQ2lyY2xlQ29udGFjdC5EZXN0cm95LCBiMlNoYXBlLmVfcG9seWdvblNoYXBlLCBiMlNoYXBlLmVfY2lyY2xlU2hhcGUpO1xuICAgICAgdGhpcy5BZGRUeXBlKGIyUG9seWdvbkNvbnRhY3QuQ3JlYXRlLCBiMlBvbHlnb25Db250YWN0LkRlc3Ryb3ksIGIyU2hhcGUuZV9wb2x5Z29uU2hhcGUsIGIyU2hhcGUuZV9wb2x5Z29uU2hhcGUpO1xuICAgICAgdGhpcy5BZGRUeXBlKGIyRWRnZUFuZENpcmNsZUNvbnRhY3QuQ3JlYXRlLCBiMkVkZ2VBbmRDaXJjbGVDb250YWN0LkRlc3Ryb3ksIGIyU2hhcGUuZV9lZGdlU2hhcGUsIGIyU2hhcGUuZV9jaXJjbGVTaGFwZSk7XG4gICAgICB0aGlzLkFkZFR5cGUoYjJQb2x5QW5kRWRnZUNvbnRhY3QuQ3JlYXRlLCBiMlBvbHlBbmRFZGdlQ29udGFjdC5EZXN0cm95LCBiMlNoYXBlLmVfcG9seWdvblNoYXBlLCBiMlNoYXBlLmVfZWRnZVNoYXBlKTtcbiAgIH1cbiAgIGIyQ29udGFjdEZhY3RvcnkucHJvdG90eXBlLkNyZWF0ZSA9IGZ1bmN0aW9uIChmaXh0dXJlQSwgZml4dHVyZUIpIHtcbiAgICAgIHZhciB0eXBlMSA9IHBhcnNlSW50KGZpeHR1cmVBLkdldFR5cGUoKSk7XG4gICAgICB2YXIgdHlwZTIgPSBwYXJzZUludChmaXh0dXJlQi5HZXRUeXBlKCkpO1xuICAgICAgdmFyIHJlZyA9IHRoaXMubV9yZWdpc3RlcnNbdHlwZTFdW3R5cGUyXTtcbiAgICAgIHZhciBjO1xuICAgICAgaWYgKHJlZy5wb29sKSB7XG4gICAgICAgICBjID0gcmVnLnBvb2w7XG4gICAgICAgICByZWcucG9vbCA9IGMubV9uZXh0O1xuICAgICAgICAgcmVnLnBvb2xDb3VudC0tO1xuICAgICAgICAgYy5SZXNldChmaXh0dXJlQSwgZml4dHVyZUIpO1xuICAgICAgICAgcmV0dXJuIGM7XG4gICAgICB9XG4gICAgICB2YXIgY3JlYXRlRmNuID0gcmVnLmNyZWF0ZUZjbjtcbiAgICAgIGlmIChjcmVhdGVGY24gIT0gbnVsbCkge1xuICAgICAgICAgaWYgKHJlZy5wcmltYXJ5KSB7XG4gICAgICAgICAgICBjID0gY3JlYXRlRmNuKHRoaXMubV9hbGxvY2F0b3IpO1xuICAgICAgICAgICAgYy5SZXNldChmaXh0dXJlQSwgZml4dHVyZUIpO1xuICAgICAgICAgICAgcmV0dXJuIGM7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGMgPSBjcmVhdGVGY24odGhpcy5tX2FsbG9jYXRvcik7XG4gICAgICAgICAgICBjLlJlc2V0KGZpeHR1cmVCLCBmaXh0dXJlQSk7XG4gICAgICAgICAgICByZXR1cm4gYztcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICB9XG4gICBiMkNvbnRhY3RGYWN0b3J5LnByb3RvdHlwZS5EZXN0cm95ID0gZnVuY3Rpb24gKGNvbnRhY3QpIHtcbiAgICAgIGlmIChjb250YWN0Lm1fbWFuaWZvbGQubV9wb2ludENvdW50ID4gMCkge1xuICAgICAgICAgY29udGFjdC5tX2ZpeHR1cmVBLm1fYm9keS5TZXRBd2FrZSh0cnVlKTtcbiAgICAgICAgIGNvbnRhY3QubV9maXh0dXJlQi5tX2JvZHkuU2V0QXdha2UodHJ1ZSk7XG4gICAgICB9XG4gICAgICB2YXIgdHlwZTEgPSBwYXJzZUludChjb250YWN0Lm1fZml4dHVyZUEuR2V0VHlwZSgpKTtcbiAgICAgIHZhciB0eXBlMiA9IHBhcnNlSW50KGNvbnRhY3QubV9maXh0dXJlQi5HZXRUeXBlKCkpO1xuICAgICAgdmFyIHJlZyA9IHRoaXMubV9yZWdpc3RlcnNbdHlwZTFdW3R5cGUyXTtcbiAgICAgIGlmICh0cnVlKSB7XG4gICAgICAgICByZWcucG9vbENvdW50Kys7XG4gICAgICAgICBjb250YWN0Lm1fbmV4dCA9IHJlZy5wb29sO1xuICAgICAgICAgcmVnLnBvb2wgPSBjb250YWN0O1xuICAgICAgfVxuICAgICAgdmFyIGRlc3Ryb3lGY24gPSByZWcuZGVzdHJveUZjbjtcbiAgICAgIGRlc3Ryb3lGY24oY29udGFjdCwgdGhpcy5tX2FsbG9jYXRvcik7XG4gICB9XG4gICBiMkNvbnRhY3RSZWdpc3Rlci5iMkNvbnRhY3RSZWdpc3RlciA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJDb250YWN0UmVzdWx0LmIyQ29udGFjdFJlc3VsdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm5vcm1hbCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMuaWQgPSBuZXcgYjJDb250YWN0SUQoKTtcbiAgIH07XG4gICBiMkNvbnRhY3RTb2x2ZXIuYjJDb250YWN0U29sdmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX3N0ZXAgPSBuZXcgYjJUaW1lU3RlcCgpO1xuICAgICAgdGhpcy5tX2NvbnN0cmFpbnRzID0gbmV3IFZlY3RvcigpO1xuICAgfTtcbiAgIGIyQ29udGFjdFNvbHZlci5wcm90b3R5cGUuYjJDb250YWN0U29sdmVyID0gZnVuY3Rpb24gKCkge31cbiAgIGIyQ29udGFjdFNvbHZlci5wcm90b3R5cGUuSW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChzdGVwLCBjb250YWN0cywgY29udGFjdENvdW50LCBhbGxvY2F0b3IpIHtcbiAgICAgIGlmIChjb250YWN0Q291bnQgPT09IHVuZGVmaW5lZCkgY29udGFjdENvdW50ID0gMDtcbiAgICAgIHZhciBjb250YWN0O1xuICAgICAgdGhpcy5tX3N0ZXAuU2V0KHN0ZXApO1xuICAgICAgdGhpcy5tX2FsbG9jYXRvciA9IGFsbG9jYXRvcjtcbiAgICAgIHZhciBpID0gMDtcbiAgICAgIHZhciB0VmVjO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB0aGlzLm1fY29uc3RyYWludENvdW50ID0gY29udGFjdENvdW50O1xuICAgICAgd2hpbGUgKHRoaXMubV9jb25zdHJhaW50cy5sZW5ndGggPCB0aGlzLm1fY29uc3RyYWludENvdW50KSB7XG4gICAgICAgICB0aGlzLm1fY29uc3RyYWludHNbdGhpcy5tX2NvbnN0cmFpbnRzLmxlbmd0aF0gPSBuZXcgYjJDb250YWN0Q29uc3RyYWludCgpO1xuICAgICAgfVxuICAgICAgZm9yIChpID0gMDtcbiAgICAgIGkgPCBjb250YWN0Q291bnQ7ICsraSkge1xuICAgICAgICAgY29udGFjdCA9IGNvbnRhY3RzW2ldO1xuICAgICAgICAgdmFyIGZpeHR1cmVBID0gY29udGFjdC5tX2ZpeHR1cmVBO1xuICAgICAgICAgdmFyIGZpeHR1cmVCID0gY29udGFjdC5tX2ZpeHR1cmVCO1xuICAgICAgICAgdmFyIHNoYXBlQSA9IGZpeHR1cmVBLm1fc2hhcGU7XG4gICAgICAgICB2YXIgc2hhcGVCID0gZml4dHVyZUIubV9zaGFwZTtcbiAgICAgICAgIHZhciByYWRpdXNBID0gc2hhcGVBLm1fcmFkaXVzO1xuICAgICAgICAgdmFyIHJhZGl1c0IgPSBzaGFwZUIubV9yYWRpdXM7XG4gICAgICAgICB2YXIgYm9keUEgPSBmaXh0dXJlQS5tX2JvZHk7XG4gICAgICAgICB2YXIgYm9keUIgPSBmaXh0dXJlQi5tX2JvZHk7XG4gICAgICAgICB2YXIgbWFuaWZvbGQgPSBjb250YWN0LkdldE1hbmlmb2xkKCk7XG4gICAgICAgICB2YXIgZnJpY3Rpb24gPSBiMlNldHRpbmdzLmIyTWl4RnJpY3Rpb24oZml4dHVyZUEuR2V0RnJpY3Rpb24oKSwgZml4dHVyZUIuR2V0RnJpY3Rpb24oKSk7XG4gICAgICAgICB2YXIgcmVzdGl0dXRpb24gPSBiMlNldHRpbmdzLmIyTWl4UmVzdGl0dXRpb24oZml4dHVyZUEuR2V0UmVzdGl0dXRpb24oKSwgZml4dHVyZUIuR2V0UmVzdGl0dXRpb24oKSk7XG4gICAgICAgICB2YXIgdkFYID0gYm9keUEubV9saW5lYXJWZWxvY2l0eS54O1xuICAgICAgICAgdmFyIHZBWSA9IGJvZHlBLm1fbGluZWFyVmVsb2NpdHkueTtcbiAgICAgICAgIHZhciB2QlggPSBib2R5Qi5tX2xpbmVhclZlbG9jaXR5Lng7XG4gICAgICAgICB2YXIgdkJZID0gYm9keUIubV9saW5lYXJWZWxvY2l0eS55O1xuICAgICAgICAgdmFyIHdBID0gYm9keUEubV9hbmd1bGFyVmVsb2NpdHk7XG4gICAgICAgICB2YXIgd0IgPSBib2R5Qi5tX2FuZ3VsYXJWZWxvY2l0eTtcbiAgICAgICAgIGIyU2V0dGluZ3MuYjJBc3NlcnQobWFuaWZvbGQubV9wb2ludENvdW50ID4gMCk7XG4gICAgICAgICBiMkNvbnRhY3RTb2x2ZXIuc193b3JsZE1hbmlmb2xkLkluaXRpYWxpemUobWFuaWZvbGQsIGJvZHlBLm1feGYsIHJhZGl1c0EsIGJvZHlCLm1feGYsIHJhZGl1c0IpO1xuICAgICAgICAgdmFyIG5vcm1hbFggPSBiMkNvbnRhY3RTb2x2ZXIuc193b3JsZE1hbmlmb2xkLm1fbm9ybWFsLng7XG4gICAgICAgICB2YXIgbm9ybWFsWSA9IGIyQ29udGFjdFNvbHZlci5zX3dvcmxkTWFuaWZvbGQubV9ub3JtYWwueTtcbiAgICAgICAgIHZhciBjYyA9IHRoaXMubV9jb25zdHJhaW50c1tpXTtcbiAgICAgICAgIGNjLmJvZHlBID0gYm9keUE7XG4gICAgICAgICBjYy5ib2R5QiA9IGJvZHlCO1xuICAgICAgICAgY2MubWFuaWZvbGQgPSBtYW5pZm9sZDtcbiAgICAgICAgIGNjLm5vcm1hbC54ID0gbm9ybWFsWDtcbiAgICAgICAgIGNjLm5vcm1hbC55ID0gbm9ybWFsWTtcbiAgICAgICAgIGNjLnBvaW50Q291bnQgPSBtYW5pZm9sZC5tX3BvaW50Q291bnQ7XG4gICAgICAgICBjYy5mcmljdGlvbiA9IGZyaWN0aW9uO1xuICAgICAgICAgY2MucmVzdGl0dXRpb24gPSByZXN0aXR1dGlvbjtcbiAgICAgICAgIGNjLmxvY2FsUGxhbmVOb3JtYWwueCA9IG1hbmlmb2xkLm1fbG9jYWxQbGFuZU5vcm1hbC54O1xuICAgICAgICAgY2MubG9jYWxQbGFuZU5vcm1hbC55ID0gbWFuaWZvbGQubV9sb2NhbFBsYW5lTm9ybWFsLnk7XG4gICAgICAgICBjYy5sb2NhbFBvaW50LnggPSBtYW5pZm9sZC5tX2xvY2FsUG9pbnQueDtcbiAgICAgICAgIGNjLmxvY2FsUG9pbnQueSA9IG1hbmlmb2xkLm1fbG9jYWxQb2ludC55O1xuICAgICAgICAgY2MucmFkaXVzID0gcmFkaXVzQSArIHJhZGl1c0I7XG4gICAgICAgICBjYy50eXBlID0gbWFuaWZvbGQubV90eXBlO1xuICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBjYy5wb2ludENvdW50OyArK2spIHtcbiAgICAgICAgICAgIHZhciBjcCA9IG1hbmlmb2xkLm1fcG9pbnRzW2tdO1xuICAgICAgICAgICAgdmFyIGNjcCA9IGNjLnBvaW50c1trXTtcbiAgICAgICAgICAgIGNjcC5ub3JtYWxJbXB1bHNlID0gY3AubV9ub3JtYWxJbXB1bHNlO1xuICAgICAgICAgICAgY2NwLnRhbmdlbnRJbXB1bHNlID0gY3AubV90YW5nZW50SW1wdWxzZTtcbiAgICAgICAgICAgIGNjcC5sb2NhbFBvaW50LlNldFYoY3AubV9sb2NhbFBvaW50KTtcbiAgICAgICAgICAgIHZhciByQVggPSBjY3AuckEueCA9IGIyQ29udGFjdFNvbHZlci5zX3dvcmxkTWFuaWZvbGQubV9wb2ludHNba10ueCAtIGJvZHlBLm1fc3dlZXAuYy54O1xuICAgICAgICAgICAgdmFyIHJBWSA9IGNjcC5yQS55ID0gYjJDb250YWN0U29sdmVyLnNfd29ybGRNYW5pZm9sZC5tX3BvaW50c1trXS55IC0gYm9keUEubV9zd2VlcC5jLnk7XG4gICAgICAgICAgICB2YXIgckJYID0gY2NwLnJCLnggPSBiMkNvbnRhY3RTb2x2ZXIuc193b3JsZE1hbmlmb2xkLm1fcG9pbnRzW2tdLnggLSBib2R5Qi5tX3N3ZWVwLmMueDtcbiAgICAgICAgICAgIHZhciByQlkgPSBjY3AuckIueSA9IGIyQ29udGFjdFNvbHZlci5zX3dvcmxkTWFuaWZvbGQubV9wb2ludHNba10ueSAtIGJvZHlCLm1fc3dlZXAuYy55O1xuICAgICAgICAgICAgdmFyIHJuQSA9IHJBWCAqIG5vcm1hbFkgLSByQVkgKiBub3JtYWxYO1xuICAgICAgICAgICAgdmFyIHJuQiA9IHJCWCAqIG5vcm1hbFkgLSByQlkgKiBub3JtYWxYO1xuICAgICAgICAgICAgcm5BICo9IHJuQTtcbiAgICAgICAgICAgIHJuQiAqPSBybkI7XG4gICAgICAgICAgICB2YXIga05vcm1hbCA9IGJvZHlBLm1faW52TWFzcyArIGJvZHlCLm1faW52TWFzcyArIGJvZHlBLm1faW52SSAqIHJuQSArIGJvZHlCLm1faW52SSAqIHJuQjtcbiAgICAgICAgICAgIGNjcC5ub3JtYWxNYXNzID0gMS4wIC8ga05vcm1hbDtcbiAgICAgICAgICAgIHZhciBrRXF1YWxpemVkID0gYm9keUEubV9tYXNzICogYm9keUEubV9pbnZNYXNzICsgYm9keUIubV9tYXNzICogYm9keUIubV9pbnZNYXNzO1xuICAgICAgICAgICAga0VxdWFsaXplZCArPSBib2R5QS5tX21hc3MgKiBib2R5QS5tX2ludkkgKiBybkEgKyBib2R5Qi5tX21hc3MgKiBib2R5Qi5tX2ludkkgKiBybkI7XG4gICAgICAgICAgICBjY3AuZXF1YWxpemVkTWFzcyA9IDEuMCAvIGtFcXVhbGl6ZWQ7XG4gICAgICAgICAgICB2YXIgdGFuZ2VudFggPSBub3JtYWxZO1xuICAgICAgICAgICAgdmFyIHRhbmdlbnRZID0gKC1ub3JtYWxYKTtcbiAgICAgICAgICAgIHZhciBydEEgPSByQVggKiB0YW5nZW50WSAtIHJBWSAqIHRhbmdlbnRYO1xuICAgICAgICAgICAgdmFyIHJ0QiA9IHJCWCAqIHRhbmdlbnRZIC0gckJZICogdGFuZ2VudFg7XG4gICAgICAgICAgICBydEEgKj0gcnRBO1xuICAgICAgICAgICAgcnRCICo9IHJ0QjtcbiAgICAgICAgICAgIHZhciBrVGFuZ2VudCA9IGJvZHlBLm1faW52TWFzcyArIGJvZHlCLm1faW52TWFzcyArIGJvZHlBLm1faW52SSAqIHJ0QSArIGJvZHlCLm1faW52SSAqIHJ0QjtcbiAgICAgICAgICAgIGNjcC50YW5nZW50TWFzcyA9IDEuMCAvIGtUYW5nZW50O1xuICAgICAgICAgICAgY2NwLnZlbG9jaXR5QmlhcyA9IDAuMDtcbiAgICAgICAgICAgIHZhciB0WCA9IHZCWCArICgoLXdCICogckJZKSkgLSB2QVggLSAoKC13QSAqIHJBWSkpO1xuICAgICAgICAgICAgdmFyIHRZID0gdkJZICsgKHdCICogckJYKSAtIHZBWSAtICh3QSAqIHJBWCk7XG4gICAgICAgICAgICB2YXIgdlJlbCA9IGNjLm5vcm1hbC54ICogdFggKyBjYy5ub3JtYWwueSAqIHRZO1xuICAgICAgICAgICAgaWYgKHZSZWwgPCAoLWIyU2V0dGluZ3MuYjJfdmVsb2NpdHlUaHJlc2hvbGQpKSB7XG4gICAgICAgICAgICAgICBjY3AudmVsb2NpdHlCaWFzICs9ICgtY2MucmVzdGl0dXRpb24gKiB2UmVsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgICAgIGlmIChjYy5wb2ludENvdW50ID09IDIpIHtcbiAgICAgICAgICAgIHZhciBjY3AxID0gY2MucG9pbnRzWzBdO1xuICAgICAgICAgICAgdmFyIGNjcDIgPSBjYy5wb2ludHNbMV07XG4gICAgICAgICAgICB2YXIgaW52TWFzc0EgPSBib2R5QS5tX2ludk1hc3M7XG4gICAgICAgICAgICB2YXIgaW52SUEgPSBib2R5QS5tX2ludkk7XG4gICAgICAgICAgICB2YXIgaW52TWFzc0IgPSBib2R5Qi5tX2ludk1hc3M7XG4gICAgICAgICAgICB2YXIgaW52SUIgPSBib2R5Qi5tX2ludkk7XG4gICAgICAgICAgICB2YXIgcm4xQSA9IGNjcDEuckEueCAqIG5vcm1hbFkgLSBjY3AxLnJBLnkgKiBub3JtYWxYO1xuICAgICAgICAgICAgdmFyIHJuMUIgPSBjY3AxLnJCLnggKiBub3JtYWxZIC0gY2NwMS5yQi55ICogbm9ybWFsWDtcbiAgICAgICAgICAgIHZhciBybjJBID0gY2NwMi5yQS54ICogbm9ybWFsWSAtIGNjcDIuckEueSAqIG5vcm1hbFg7XG4gICAgICAgICAgICB2YXIgcm4yQiA9IGNjcDIuckIueCAqIG5vcm1hbFkgLSBjY3AyLnJCLnkgKiBub3JtYWxYO1xuICAgICAgICAgICAgdmFyIGsxMSA9IGludk1hc3NBICsgaW52TWFzc0IgKyBpbnZJQSAqIHJuMUEgKiBybjFBICsgaW52SUIgKiBybjFCICogcm4xQjtcbiAgICAgICAgICAgIHZhciBrMjIgPSBpbnZNYXNzQSArIGludk1hc3NCICsgaW52SUEgKiBybjJBICogcm4yQSArIGludklCICogcm4yQiAqIHJuMkI7XG4gICAgICAgICAgICB2YXIgazEyID0gaW52TWFzc0EgKyBpbnZNYXNzQiArIGludklBICogcm4xQSAqIHJuMkEgKyBpbnZJQiAqIHJuMUIgKiBybjJCO1xuICAgICAgICAgICAgdmFyIGtfbWF4Q29uZGl0aW9uTnVtYmVyID0gMTAwLjA7XG4gICAgICAgICAgICBpZiAoazExICogazExIDwga19tYXhDb25kaXRpb25OdW1iZXIgKiAoazExICogazIyIC0gazEyICogazEyKSkge1xuICAgICAgICAgICAgICAgY2MuSy5jb2wxLlNldChrMTEsIGsxMik7XG4gICAgICAgICAgICAgICBjYy5LLmNvbDIuU2V0KGsxMiwgazIyKTtcbiAgICAgICAgICAgICAgIGNjLksuR2V0SW52ZXJzZShjYy5ub3JtYWxNYXNzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgY2MucG9pbnRDb3VudCA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICB9XG4gICB9XG4gICBiMkNvbnRhY3RTb2x2ZXIucHJvdG90eXBlLkluaXRWZWxvY2l0eUNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKHN0ZXApIHtcbiAgICAgIHZhciB0VmVjO1xuICAgICAgdmFyIHRWZWMyO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubV9jb25zdHJhaW50Q291bnQ7ICsraSkge1xuICAgICAgICAgdmFyIGMgPSB0aGlzLm1fY29uc3RyYWludHNbaV07XG4gICAgICAgICB2YXIgYm9keUEgPSBjLmJvZHlBO1xuICAgICAgICAgdmFyIGJvZHlCID0gYy5ib2R5QjtcbiAgICAgICAgIHZhciBpbnZNYXNzQSA9IGJvZHlBLm1faW52TWFzcztcbiAgICAgICAgIHZhciBpbnZJQSA9IGJvZHlBLm1faW52STtcbiAgICAgICAgIHZhciBpbnZNYXNzQiA9IGJvZHlCLm1faW52TWFzcztcbiAgICAgICAgIHZhciBpbnZJQiA9IGJvZHlCLm1faW52STtcbiAgICAgICAgIHZhciBub3JtYWxYID0gYy5ub3JtYWwueDtcbiAgICAgICAgIHZhciBub3JtYWxZID0gYy5ub3JtYWwueTtcbiAgICAgICAgIHZhciB0YW5nZW50WCA9IG5vcm1hbFk7XG4gICAgICAgICB2YXIgdGFuZ2VudFkgPSAoLW5vcm1hbFgpO1xuICAgICAgICAgdmFyIHRYID0gMDtcbiAgICAgICAgIHZhciBqID0gMDtcbiAgICAgICAgIHZhciB0Q291bnQgPSAwO1xuICAgICAgICAgaWYgKHN0ZXAud2FybVN0YXJ0aW5nKSB7XG4gICAgICAgICAgICB0Q291bnQgPSBjLnBvaW50Q291bnQ7XG4gICAgICAgICAgICBmb3IgKGogPSAwO1xuICAgICAgICAgICAgaiA8IHRDb3VudDsgKytqKSB7XG4gICAgICAgICAgICAgICB2YXIgY2NwID0gYy5wb2ludHNbal07XG4gICAgICAgICAgICAgICBjY3Aubm9ybWFsSW1wdWxzZSAqPSBzdGVwLmR0UmF0aW87XG4gICAgICAgICAgICAgICBjY3AudGFuZ2VudEltcHVsc2UgKj0gc3RlcC5kdFJhdGlvO1xuICAgICAgICAgICAgICAgdmFyIFBYID0gY2NwLm5vcm1hbEltcHVsc2UgKiBub3JtYWxYICsgY2NwLnRhbmdlbnRJbXB1bHNlICogdGFuZ2VudFg7XG4gICAgICAgICAgICAgICB2YXIgUFkgPSBjY3Aubm9ybWFsSW1wdWxzZSAqIG5vcm1hbFkgKyBjY3AudGFuZ2VudEltcHVsc2UgKiB0YW5nZW50WTtcbiAgICAgICAgICAgICAgIGJvZHlBLm1fYW5ndWxhclZlbG9jaXR5IC09IGludklBICogKGNjcC5yQS54ICogUFkgLSBjY3AuckEueSAqIFBYKTtcbiAgICAgICAgICAgICAgIGJvZHlBLm1fbGluZWFyVmVsb2NpdHkueCAtPSBpbnZNYXNzQSAqIFBYO1xuICAgICAgICAgICAgICAgYm9keUEubV9saW5lYXJWZWxvY2l0eS55IC09IGludk1hc3NBICogUFk7XG4gICAgICAgICAgICAgICBib2R5Qi5tX2FuZ3VsYXJWZWxvY2l0eSArPSBpbnZJQiAqIChjY3AuckIueCAqIFBZIC0gY2NwLnJCLnkgKiBQWCk7XG4gICAgICAgICAgICAgICBib2R5Qi5tX2xpbmVhclZlbG9jaXR5LnggKz0gaW52TWFzc0IgKiBQWDtcbiAgICAgICAgICAgICAgIGJvZHlCLm1fbGluZWFyVmVsb2NpdHkueSArPSBpbnZNYXNzQiAqIFBZO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0Q291bnQgPSBjLnBvaW50Q291bnQ7XG4gICAgICAgICAgICBmb3IgKGogPSAwO1xuICAgICAgICAgICAgaiA8IHRDb3VudDsgKytqKSB7XG4gICAgICAgICAgICAgICB2YXIgY2NwMiA9IGMucG9pbnRzW2pdO1xuICAgICAgICAgICAgICAgY2NwMi5ub3JtYWxJbXB1bHNlID0gMC4wO1xuICAgICAgICAgICAgICAgY2NwMi50YW5nZW50SW1wdWxzZSA9IDAuMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgIH1cbiAgIH1cbiAgIGIyQ29udGFjdFNvbHZlci5wcm90b3R5cGUuU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGogPSAwO1xuICAgICAgdmFyIGNjcDtcbiAgICAgIHZhciByQVggPSAwO1xuICAgICAgdmFyIHJBWSA9IDA7XG4gICAgICB2YXIgckJYID0gMDtcbiAgICAgIHZhciByQlkgPSAwO1xuICAgICAgdmFyIGR2WCA9IDA7XG4gICAgICB2YXIgZHZZID0gMDtcbiAgICAgIHZhciB2biA9IDA7XG4gICAgICB2YXIgdnQgPSAwO1xuICAgICAgdmFyIGxhbWJkYSA9IDA7XG4gICAgICB2YXIgbWF4RnJpY3Rpb24gPSAwO1xuICAgICAgdmFyIG5ld0ltcHVsc2UgPSAwO1xuICAgICAgdmFyIFBYID0gMDtcbiAgICAgIHZhciBQWSA9IDA7XG4gICAgICB2YXIgZFggPSAwO1xuICAgICAgdmFyIGRZID0gMDtcbiAgICAgIHZhciBQMVggPSAwO1xuICAgICAgdmFyIFAxWSA9IDA7XG4gICAgICB2YXIgUDJYID0gMDtcbiAgICAgIHZhciBQMlkgPSAwO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB2YXIgdFZlYztcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tX2NvbnN0cmFpbnRDb3VudDsgKytpKSB7XG4gICAgICAgICB2YXIgYyA9IHRoaXMubV9jb25zdHJhaW50c1tpXTtcbiAgICAgICAgIHZhciBib2R5QSA9IGMuYm9keUE7XG4gICAgICAgICB2YXIgYm9keUIgPSBjLmJvZHlCO1xuICAgICAgICAgdmFyIHdBID0gYm9keUEubV9hbmd1bGFyVmVsb2NpdHk7XG4gICAgICAgICB2YXIgd0IgPSBib2R5Qi5tX2FuZ3VsYXJWZWxvY2l0eTtcbiAgICAgICAgIHZhciB2QSA9IGJvZHlBLm1fbGluZWFyVmVsb2NpdHk7XG4gICAgICAgICB2YXIgdkIgPSBib2R5Qi5tX2xpbmVhclZlbG9jaXR5O1xuICAgICAgICAgdmFyIGludk1hc3NBID0gYm9keUEubV9pbnZNYXNzO1xuICAgICAgICAgdmFyIGludklBID0gYm9keUEubV9pbnZJO1xuICAgICAgICAgdmFyIGludk1hc3NCID0gYm9keUIubV9pbnZNYXNzO1xuICAgICAgICAgdmFyIGludklCID0gYm9keUIubV9pbnZJO1xuICAgICAgICAgdmFyIG5vcm1hbFggPSBjLm5vcm1hbC54O1xuICAgICAgICAgdmFyIG5vcm1hbFkgPSBjLm5vcm1hbC55O1xuICAgICAgICAgdmFyIHRhbmdlbnRYID0gbm9ybWFsWTtcbiAgICAgICAgIHZhciB0YW5nZW50WSA9ICgtbm9ybWFsWCk7XG4gICAgICAgICB2YXIgZnJpY3Rpb24gPSBjLmZyaWN0aW9uO1xuICAgICAgICAgdmFyIHRYID0gMDtcbiAgICAgICAgIGZvciAoaiA9IDA7XG4gICAgICAgICBqIDwgYy5wb2ludENvdW50OyBqKyspIHtcbiAgICAgICAgICAgIGNjcCA9IGMucG9pbnRzW2pdO1xuICAgICAgICAgICAgZHZYID0gdkIueCAtIHdCICogY2NwLnJCLnkgLSB2QS54ICsgd0EgKiBjY3AuckEueTtcbiAgICAgICAgICAgIGR2WSA9IHZCLnkgKyB3QiAqIGNjcC5yQi54IC0gdkEueSAtIHdBICogY2NwLnJBLng7XG4gICAgICAgICAgICB2dCA9IGR2WCAqIHRhbmdlbnRYICsgZHZZICogdGFuZ2VudFk7XG4gICAgICAgICAgICBsYW1iZGEgPSBjY3AudGFuZ2VudE1hc3MgKiAoLXZ0KTtcbiAgICAgICAgICAgIG1heEZyaWN0aW9uID0gZnJpY3Rpb24gKiBjY3Aubm9ybWFsSW1wdWxzZTtcbiAgICAgICAgICAgIG5ld0ltcHVsc2UgPSBiMk1hdGguQ2xhbXAoY2NwLnRhbmdlbnRJbXB1bHNlICsgbGFtYmRhLCAoLW1heEZyaWN0aW9uKSwgbWF4RnJpY3Rpb24pO1xuICAgICAgICAgICAgbGFtYmRhID0gbmV3SW1wdWxzZSAtIGNjcC50YW5nZW50SW1wdWxzZTtcbiAgICAgICAgICAgIFBYID0gbGFtYmRhICogdGFuZ2VudFg7XG4gICAgICAgICAgICBQWSA9IGxhbWJkYSAqIHRhbmdlbnRZO1xuICAgICAgICAgICAgdkEueCAtPSBpbnZNYXNzQSAqIFBYO1xuICAgICAgICAgICAgdkEueSAtPSBpbnZNYXNzQSAqIFBZO1xuICAgICAgICAgICAgd0EgLT0gaW52SUEgKiAoY2NwLnJBLnggKiBQWSAtIGNjcC5yQS55ICogUFgpO1xuICAgICAgICAgICAgdkIueCArPSBpbnZNYXNzQiAqIFBYO1xuICAgICAgICAgICAgdkIueSArPSBpbnZNYXNzQiAqIFBZO1xuICAgICAgICAgICAgd0IgKz0gaW52SUIgKiAoY2NwLnJCLnggKiBQWSAtIGNjcC5yQi55ICogUFgpO1xuICAgICAgICAgICAgY2NwLnRhbmdlbnRJbXB1bHNlID0gbmV3SW1wdWxzZTtcbiAgICAgICAgIH1cbiAgICAgICAgIHZhciB0Q291bnQgPSBwYXJzZUludChjLnBvaW50Q291bnQpO1xuICAgICAgICAgaWYgKGMucG9pbnRDb3VudCA9PSAxKSB7XG4gICAgICAgICAgICBjY3AgPSBjLnBvaW50c1swXTtcbiAgICAgICAgICAgIGR2WCA9IHZCLnggKyAoKC13QiAqIGNjcC5yQi55KSkgLSB2QS54IC0gKCgtd0EgKiBjY3AuckEueSkpO1xuICAgICAgICAgICAgZHZZID0gdkIueSArICh3QiAqIGNjcC5yQi54KSAtIHZBLnkgLSAod0EgKiBjY3AuckEueCk7XG4gICAgICAgICAgICB2biA9IGR2WCAqIG5vcm1hbFggKyBkdlkgKiBub3JtYWxZO1xuICAgICAgICAgICAgbGFtYmRhID0gKC1jY3Aubm9ybWFsTWFzcyAqICh2biAtIGNjcC52ZWxvY2l0eUJpYXMpKTtcbiAgICAgICAgICAgIG5ld0ltcHVsc2UgPSBjY3Aubm9ybWFsSW1wdWxzZSArIGxhbWJkYTtcbiAgICAgICAgICAgIG5ld0ltcHVsc2UgPSBuZXdJbXB1bHNlID4gMCA/IG5ld0ltcHVsc2UgOiAwLjA7XG4gICAgICAgICAgICBsYW1iZGEgPSBuZXdJbXB1bHNlIC0gY2NwLm5vcm1hbEltcHVsc2U7XG4gICAgICAgICAgICBQWCA9IGxhbWJkYSAqIG5vcm1hbFg7XG4gICAgICAgICAgICBQWSA9IGxhbWJkYSAqIG5vcm1hbFk7XG4gICAgICAgICAgICB2QS54IC09IGludk1hc3NBICogUFg7XG4gICAgICAgICAgICB2QS55IC09IGludk1hc3NBICogUFk7XG4gICAgICAgICAgICB3QSAtPSBpbnZJQSAqIChjY3AuckEueCAqIFBZIC0gY2NwLnJBLnkgKiBQWCk7XG4gICAgICAgICAgICB2Qi54ICs9IGludk1hc3NCICogUFg7XG4gICAgICAgICAgICB2Qi55ICs9IGludk1hc3NCICogUFk7XG4gICAgICAgICAgICB3QiArPSBpbnZJQiAqIChjY3AuckIueCAqIFBZIC0gY2NwLnJCLnkgKiBQWCk7XG4gICAgICAgICAgICBjY3Aubm9ybWFsSW1wdWxzZSA9IG5ld0ltcHVsc2U7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBjcDEgPSBjLnBvaW50c1swXTtcbiAgICAgICAgICAgIHZhciBjcDIgPSBjLnBvaW50c1sxXTtcbiAgICAgICAgICAgIHZhciBhWCA9IGNwMS5ub3JtYWxJbXB1bHNlO1xuICAgICAgICAgICAgdmFyIGFZID0gY3AyLm5vcm1hbEltcHVsc2U7XG4gICAgICAgICAgICB2YXIgZHYxWCA9IHZCLnggLSB3QiAqIGNwMS5yQi55IC0gdkEueCArIHdBICogY3AxLnJBLnk7XG4gICAgICAgICAgICB2YXIgZHYxWSA9IHZCLnkgKyB3QiAqIGNwMS5yQi54IC0gdkEueSAtIHdBICogY3AxLnJBLng7XG4gICAgICAgICAgICB2YXIgZHYyWCA9IHZCLnggLSB3QiAqIGNwMi5yQi55IC0gdkEueCArIHdBICogY3AyLnJBLnk7XG4gICAgICAgICAgICB2YXIgZHYyWSA9IHZCLnkgKyB3QiAqIGNwMi5yQi54IC0gdkEueSAtIHdBICogY3AyLnJBLng7XG4gICAgICAgICAgICB2YXIgdm4xID0gZHYxWCAqIG5vcm1hbFggKyBkdjFZICogbm9ybWFsWTtcbiAgICAgICAgICAgIHZhciB2bjIgPSBkdjJYICogbm9ybWFsWCArIGR2MlkgKiBub3JtYWxZO1xuICAgICAgICAgICAgdmFyIGJYID0gdm4xIC0gY3AxLnZlbG9jaXR5QmlhcztcbiAgICAgICAgICAgIHZhciBiWSA9IHZuMiAtIGNwMi52ZWxvY2l0eUJpYXM7XG4gICAgICAgICAgICB0TWF0ID0gYy5LO1xuICAgICAgICAgICAgYlggLT0gdE1hdC5jb2wxLnggKiBhWCArIHRNYXQuY29sMi54ICogYVk7XG4gICAgICAgICAgICBiWSAtPSB0TWF0LmNvbDEueSAqIGFYICsgdE1hdC5jb2wyLnkgKiBhWTtcbiAgICAgICAgICAgIHZhciBrX2Vycm9yVG9sID0gMC4wMDE7XG4gICAgICAgICAgICBmb3IgKDs7KSB7XG4gICAgICAgICAgICAgICB0TWF0ID0gYy5ub3JtYWxNYXNzO1xuICAgICAgICAgICAgICAgdmFyIHhYID0gKC0odE1hdC5jb2wxLnggKiBiWCArIHRNYXQuY29sMi54ICogYlkpKTtcbiAgICAgICAgICAgICAgIHZhciB4WSA9ICgtKHRNYXQuY29sMS55ICogYlggKyB0TWF0LmNvbDIueSAqIGJZKSk7XG4gICAgICAgICAgICAgICBpZiAoeFggPj0gMC4wICYmIHhZID49IDAuMCkge1xuICAgICAgICAgICAgICAgICAgZFggPSB4WCAtIGFYO1xuICAgICAgICAgICAgICAgICAgZFkgPSB4WSAtIGFZO1xuICAgICAgICAgICAgICAgICAgUDFYID0gZFggKiBub3JtYWxYO1xuICAgICAgICAgICAgICAgICAgUDFZID0gZFggKiBub3JtYWxZO1xuICAgICAgICAgICAgICAgICAgUDJYID0gZFkgKiBub3JtYWxYO1xuICAgICAgICAgICAgICAgICAgUDJZID0gZFkgKiBub3JtYWxZO1xuICAgICAgICAgICAgICAgICAgdkEueCAtPSBpbnZNYXNzQSAqIChQMVggKyBQMlgpO1xuICAgICAgICAgICAgICAgICAgdkEueSAtPSBpbnZNYXNzQSAqIChQMVkgKyBQMlkpO1xuICAgICAgICAgICAgICAgICAgd0EgLT0gaW52SUEgKiAoY3AxLnJBLnggKiBQMVkgLSBjcDEuckEueSAqIFAxWCArIGNwMi5yQS54ICogUDJZIC0gY3AyLnJBLnkgKiBQMlgpO1xuICAgICAgICAgICAgICAgICAgdkIueCArPSBpbnZNYXNzQiAqIChQMVggKyBQMlgpO1xuICAgICAgICAgICAgICAgICAgdkIueSArPSBpbnZNYXNzQiAqIChQMVkgKyBQMlkpO1xuICAgICAgICAgICAgICAgICAgd0IgKz0gaW52SUIgKiAoY3AxLnJCLnggKiBQMVkgLSBjcDEuckIueSAqIFAxWCArIGNwMi5yQi54ICogUDJZIC0gY3AyLnJCLnkgKiBQMlgpO1xuICAgICAgICAgICAgICAgICAgY3AxLm5vcm1hbEltcHVsc2UgPSB4WDtcbiAgICAgICAgICAgICAgICAgIGNwMi5ub3JtYWxJbXB1bHNlID0geFk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIHhYID0gKC1jcDEubm9ybWFsTWFzcyAqIGJYKTtcbiAgICAgICAgICAgICAgIHhZID0gMC4wO1xuICAgICAgICAgICAgICAgdm4xID0gMC4wO1xuICAgICAgICAgICAgICAgdm4yID0gYy5LLmNvbDEueSAqIHhYICsgYlk7XG4gICAgICAgICAgICAgICBpZiAoeFggPj0gMC4wICYmIHZuMiA+PSAwLjApIHtcbiAgICAgICAgICAgICAgICAgIGRYID0geFggLSBhWDtcbiAgICAgICAgICAgICAgICAgIGRZID0geFkgLSBhWTtcbiAgICAgICAgICAgICAgICAgIFAxWCA9IGRYICogbm9ybWFsWDtcbiAgICAgICAgICAgICAgICAgIFAxWSA9IGRYICogbm9ybWFsWTtcbiAgICAgICAgICAgICAgICAgIFAyWCA9IGRZICogbm9ybWFsWDtcbiAgICAgICAgICAgICAgICAgIFAyWSA9IGRZICogbm9ybWFsWTtcbiAgICAgICAgICAgICAgICAgIHZBLnggLT0gaW52TWFzc0EgKiAoUDFYICsgUDJYKTtcbiAgICAgICAgICAgICAgICAgIHZBLnkgLT0gaW52TWFzc0EgKiAoUDFZICsgUDJZKTtcbiAgICAgICAgICAgICAgICAgIHdBIC09IGludklBICogKGNwMS5yQS54ICogUDFZIC0gY3AxLnJBLnkgKiBQMVggKyBjcDIuckEueCAqIFAyWSAtIGNwMi5yQS55ICogUDJYKTtcbiAgICAgICAgICAgICAgICAgIHZCLnggKz0gaW52TWFzc0IgKiAoUDFYICsgUDJYKTtcbiAgICAgICAgICAgICAgICAgIHZCLnkgKz0gaW52TWFzc0IgKiAoUDFZICsgUDJZKTtcbiAgICAgICAgICAgICAgICAgIHdCICs9IGludklCICogKGNwMS5yQi54ICogUDFZIC0gY3AxLnJCLnkgKiBQMVggKyBjcDIuckIueCAqIFAyWSAtIGNwMi5yQi55ICogUDJYKTtcbiAgICAgICAgICAgICAgICAgIGNwMS5ub3JtYWxJbXB1bHNlID0geFg7XG4gICAgICAgICAgICAgICAgICBjcDIubm9ybWFsSW1wdWxzZSA9IHhZO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICB4WCA9IDAuMDtcbiAgICAgICAgICAgICAgIHhZID0gKC1jcDIubm9ybWFsTWFzcyAqIGJZKTtcbiAgICAgICAgICAgICAgIHZuMSA9IGMuSy5jb2wyLnggKiB4WSArIGJYO1xuICAgICAgICAgICAgICAgdm4yID0gMC4wO1xuICAgICAgICAgICAgICAgaWYgKHhZID49IDAuMCAmJiB2bjEgPj0gMC4wKSB7XG4gICAgICAgICAgICAgICAgICBkWCA9IHhYIC0gYVg7XG4gICAgICAgICAgICAgICAgICBkWSA9IHhZIC0gYVk7XG4gICAgICAgICAgICAgICAgICBQMVggPSBkWCAqIG5vcm1hbFg7XG4gICAgICAgICAgICAgICAgICBQMVkgPSBkWCAqIG5vcm1hbFk7XG4gICAgICAgICAgICAgICAgICBQMlggPSBkWSAqIG5vcm1hbFg7XG4gICAgICAgICAgICAgICAgICBQMlkgPSBkWSAqIG5vcm1hbFk7XG4gICAgICAgICAgICAgICAgICB2QS54IC09IGludk1hc3NBICogKFAxWCArIFAyWCk7XG4gICAgICAgICAgICAgICAgICB2QS55IC09IGludk1hc3NBICogKFAxWSArIFAyWSk7XG4gICAgICAgICAgICAgICAgICB3QSAtPSBpbnZJQSAqIChjcDEuckEueCAqIFAxWSAtIGNwMS5yQS55ICogUDFYICsgY3AyLnJBLnggKiBQMlkgLSBjcDIuckEueSAqIFAyWCk7XG4gICAgICAgICAgICAgICAgICB2Qi54ICs9IGludk1hc3NCICogKFAxWCArIFAyWCk7XG4gICAgICAgICAgICAgICAgICB2Qi55ICs9IGludk1hc3NCICogKFAxWSArIFAyWSk7XG4gICAgICAgICAgICAgICAgICB3QiArPSBpbnZJQiAqIChjcDEuckIueCAqIFAxWSAtIGNwMS5yQi55ICogUDFYICsgY3AyLnJCLnggKiBQMlkgLSBjcDIuckIueSAqIFAyWCk7XG4gICAgICAgICAgICAgICAgICBjcDEubm9ybWFsSW1wdWxzZSA9IHhYO1xuICAgICAgICAgICAgICAgICAgY3AyLm5vcm1hbEltcHVsc2UgPSB4WTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgeFggPSAwLjA7XG4gICAgICAgICAgICAgICB4WSA9IDAuMDtcbiAgICAgICAgICAgICAgIHZuMSA9IGJYO1xuICAgICAgICAgICAgICAgdm4yID0gYlk7XG4gICAgICAgICAgICAgICBpZiAodm4xID49IDAuMCAmJiB2bjIgPj0gMC4wKSB7XG4gICAgICAgICAgICAgICAgICBkWCA9IHhYIC0gYVg7XG4gICAgICAgICAgICAgICAgICBkWSA9IHhZIC0gYVk7XG4gICAgICAgICAgICAgICAgICBQMVggPSBkWCAqIG5vcm1hbFg7XG4gICAgICAgICAgICAgICAgICBQMVkgPSBkWCAqIG5vcm1hbFk7XG4gICAgICAgICAgICAgICAgICBQMlggPSBkWSAqIG5vcm1hbFg7XG4gICAgICAgICAgICAgICAgICBQMlkgPSBkWSAqIG5vcm1hbFk7XG4gICAgICAgICAgICAgICAgICB2QS54IC09IGludk1hc3NBICogKFAxWCArIFAyWCk7XG4gICAgICAgICAgICAgICAgICB2QS55IC09IGludk1hc3NBICogKFAxWSArIFAyWSk7XG4gICAgICAgICAgICAgICAgICB3QSAtPSBpbnZJQSAqIChjcDEuckEueCAqIFAxWSAtIGNwMS5yQS55ICogUDFYICsgY3AyLnJBLnggKiBQMlkgLSBjcDIuckEueSAqIFAyWCk7XG4gICAgICAgICAgICAgICAgICB2Qi54ICs9IGludk1hc3NCICogKFAxWCArIFAyWCk7XG4gICAgICAgICAgICAgICAgICB2Qi55ICs9IGludk1hc3NCICogKFAxWSArIFAyWSk7XG4gICAgICAgICAgICAgICAgICB3QiArPSBpbnZJQiAqIChjcDEuckIueCAqIFAxWSAtIGNwMS5yQi55ICogUDFYICsgY3AyLnJCLnggKiBQMlkgLSBjcDIuckIueSAqIFAyWCk7XG4gICAgICAgICAgICAgICAgICBjcDEubm9ybWFsSW1wdWxzZSA9IHhYO1xuICAgICAgICAgICAgICAgICAgY3AyLm5vcm1hbEltcHVsc2UgPSB4WTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICAgICBib2R5QS5tX2FuZ3VsYXJWZWxvY2l0eSA9IHdBO1xuICAgICAgICAgYm9keUIubV9hbmd1bGFyVmVsb2NpdHkgPSB3QjtcbiAgICAgIH1cbiAgIH1cbiAgIGIyQ29udGFjdFNvbHZlci5wcm90b3R5cGUuRmluYWxpemVWZWxvY2l0eUNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1fY29uc3RyYWludENvdW50OyArK2kpIHtcbiAgICAgICAgIHZhciBjID0gdGhpcy5tX2NvbnN0cmFpbnRzW2ldO1xuICAgICAgICAgdmFyIG0gPSBjLm1hbmlmb2xkO1xuICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBjLnBvaW50Q291bnQ7ICsraikge1xuICAgICAgICAgICAgdmFyIHBvaW50MSA9IG0ubV9wb2ludHNbal07XG4gICAgICAgICAgICB2YXIgcG9pbnQyID0gYy5wb2ludHNbal07XG4gICAgICAgICAgICBwb2ludDEubV9ub3JtYWxJbXB1bHNlID0gcG9pbnQyLm5vcm1hbEltcHVsc2U7XG4gICAgICAgICAgICBwb2ludDEubV90YW5nZW50SW1wdWxzZSA9IHBvaW50Mi50YW5nZW50SW1wdWxzZTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgIH1cbiAgIGIyQ29udGFjdFNvbHZlci5wcm90b3R5cGUuU29sdmVQb3NpdGlvbkNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKGJhdW1nYXJ0ZSkge1xuICAgICAgaWYgKGJhdW1nYXJ0ZSA9PT0gdW5kZWZpbmVkKSBiYXVtZ2FydGUgPSAwO1xuICAgICAgdmFyIG1pblNlcGFyYXRpb24gPSAwLjA7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubV9jb25zdHJhaW50Q291bnQ7IGkrKykge1xuICAgICAgICAgdmFyIGMgPSB0aGlzLm1fY29uc3RyYWludHNbaV07XG4gICAgICAgICB2YXIgYm9keUEgPSBjLmJvZHlBO1xuICAgICAgICAgdmFyIGJvZHlCID0gYy5ib2R5QjtcbiAgICAgICAgIHZhciBpbnZNYXNzQSA9IGJvZHlBLm1fbWFzcyAqIGJvZHlBLm1faW52TWFzcztcbiAgICAgICAgIHZhciBpbnZJQSA9IGJvZHlBLm1fbWFzcyAqIGJvZHlBLm1faW52STtcbiAgICAgICAgIHZhciBpbnZNYXNzQiA9IGJvZHlCLm1fbWFzcyAqIGJvZHlCLm1faW52TWFzcztcbiAgICAgICAgIHZhciBpbnZJQiA9IGJvZHlCLm1fbWFzcyAqIGJvZHlCLm1faW52STtcbiAgICAgICAgIGIyQ29udGFjdFNvbHZlci5zX3BzbS5Jbml0aWFsaXplKGMpO1xuICAgICAgICAgdmFyIG5vcm1hbCA9IGIyQ29udGFjdFNvbHZlci5zX3BzbS5tX25vcm1hbDtcbiAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgYy5wb2ludENvdW50OyBqKyspIHtcbiAgICAgICAgICAgIHZhciBjY3AgPSBjLnBvaW50c1tqXTtcbiAgICAgICAgICAgIHZhciBwb2ludCA9IGIyQ29udGFjdFNvbHZlci5zX3BzbS5tX3BvaW50c1tqXTtcbiAgICAgICAgICAgIHZhciBzZXBhcmF0aW9uID0gYjJDb250YWN0U29sdmVyLnNfcHNtLm1fc2VwYXJhdGlvbnNbal07XG4gICAgICAgICAgICB2YXIgckFYID0gcG9pbnQueCAtIGJvZHlBLm1fc3dlZXAuYy54O1xuICAgICAgICAgICAgdmFyIHJBWSA9IHBvaW50LnkgLSBib2R5QS5tX3N3ZWVwLmMueTtcbiAgICAgICAgICAgIHZhciByQlggPSBwb2ludC54IC0gYm9keUIubV9zd2VlcC5jLng7XG4gICAgICAgICAgICB2YXIgckJZID0gcG9pbnQueSAtIGJvZHlCLm1fc3dlZXAuYy55O1xuICAgICAgICAgICAgbWluU2VwYXJhdGlvbiA9IG1pblNlcGFyYXRpb24gPCBzZXBhcmF0aW9uID8gbWluU2VwYXJhdGlvbiA6IHNlcGFyYXRpb247XG4gICAgICAgICAgICB2YXIgQyA9IGIyTWF0aC5DbGFtcChiYXVtZ2FydGUgKiAoc2VwYXJhdGlvbiArIGIyU2V0dGluZ3MuYjJfbGluZWFyU2xvcCksICgtYjJTZXR0aW5ncy5iMl9tYXhMaW5lYXJDb3JyZWN0aW9uKSwgMC4wKTtcbiAgICAgICAgICAgIHZhciBpbXB1bHNlID0gKC1jY3AuZXF1YWxpemVkTWFzcyAqIEMpO1xuICAgICAgICAgICAgdmFyIFBYID0gaW1wdWxzZSAqIG5vcm1hbC54O1xuICAgICAgICAgICAgdmFyIFBZID0gaW1wdWxzZSAqIG5vcm1hbC55O2JvZHlBLm1fc3dlZXAuYy54IC09IGludk1hc3NBICogUFg7XG4gICAgICAgICAgICBib2R5QS5tX3N3ZWVwLmMueSAtPSBpbnZNYXNzQSAqIFBZO1xuICAgICAgICAgICAgYm9keUEubV9zd2VlcC5hIC09IGludklBICogKHJBWCAqIFBZIC0gckFZICogUFgpO1xuICAgICAgICAgICAgYm9keUEuU3luY2hyb25pemVUcmFuc2Zvcm0oKTtcbiAgICAgICAgICAgIGJvZHlCLm1fc3dlZXAuYy54ICs9IGludk1hc3NCICogUFg7XG4gICAgICAgICAgICBib2R5Qi5tX3N3ZWVwLmMueSArPSBpbnZNYXNzQiAqIFBZO1xuICAgICAgICAgICAgYm9keUIubV9zd2VlcC5hICs9IGludklCICogKHJCWCAqIFBZIC0gckJZICogUFgpO1xuICAgICAgICAgICAgYm9keUIuU3luY2hyb25pemVUcmFuc2Zvcm0oKTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBtaW5TZXBhcmF0aW9uID4gKC0xLjUgKiBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3ApO1xuICAgfVxuICAgQm94MkQucG9zdERlZnMucHVzaChmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3RTb2x2ZXIuc193b3JsZE1hbmlmb2xkID0gbmV3IGIyV29ybGRNYW5pZm9sZCgpO1xuICAgICAgQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0U29sdmVyLnNfcHNtID0gbmV3IGIyUG9zaXRpb25Tb2x2ZXJNYW5pZm9sZCgpO1xuICAgfSk7XG4gICBCb3gyRC5pbmhlcml0KGIyRWRnZUFuZENpcmNsZUNvbnRhY3QsIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdCk7XG4gICBiMkVkZ2VBbmRDaXJjbGVDb250YWN0LnByb3RvdHlwZS5fX3N1cGVyID0gQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0LnByb3RvdHlwZTtcbiAgIGIyRWRnZUFuZENpcmNsZUNvbnRhY3QuYjJFZGdlQW5kQ2lyY2xlQ29udGFjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdC5iMkNvbnRhY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBiMkVkZ2VBbmRDaXJjbGVDb250YWN0LkNyZWF0ZSA9IGZ1bmN0aW9uIChhbGxvY2F0b3IpIHtcbiAgICAgIHJldHVybiBuZXcgYjJFZGdlQW5kQ2lyY2xlQ29udGFjdCgpO1xuICAgfVxuICAgYjJFZGdlQW5kQ2lyY2xlQ29udGFjdC5EZXN0cm95ID0gZnVuY3Rpb24gKGNvbnRhY3QsIGFsbG9jYXRvcikge31cbiAgIGIyRWRnZUFuZENpcmNsZUNvbnRhY3QucHJvdG90eXBlLlJlc2V0ID0gZnVuY3Rpb24gKGZpeHR1cmVBLCBmaXh0dXJlQikge1xuICAgICAgdGhpcy5fX3N1cGVyLlJlc2V0LmNhbGwodGhpcywgZml4dHVyZUEsIGZpeHR1cmVCKTtcbiAgIH1cbiAgIGIyRWRnZUFuZENpcmNsZUNvbnRhY3QucHJvdG90eXBlLkV2YWx1YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGJBID0gdGhpcy5tX2ZpeHR1cmVBLkdldEJvZHkoKTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9maXh0dXJlQi5HZXRCb2R5KCk7XG4gICAgICB0aGlzLmIyQ29sbGlkZUVkZ2VBbmRDaXJjbGUodGhpcy5tX21hbmlmb2xkLCAodGhpcy5tX2ZpeHR1cmVBLkdldFNoYXBlKCkgaW5zdGFuY2VvZiBiMkVkZ2VTaGFwZSA/IHRoaXMubV9maXh0dXJlQS5HZXRTaGFwZSgpIDogbnVsbCksIGJBLm1feGYsICh0aGlzLm1fZml4dHVyZUIuR2V0U2hhcGUoKSBpbnN0YW5jZW9mIGIyQ2lyY2xlU2hhcGUgPyB0aGlzLm1fZml4dHVyZUIuR2V0U2hhcGUoKSA6IG51bGwpLCBiQi5tX3hmKTtcbiAgIH1cbiAgIGIyRWRnZUFuZENpcmNsZUNvbnRhY3QucHJvdG90eXBlLmIyQ29sbGlkZUVkZ2VBbmRDaXJjbGUgPSBmdW5jdGlvbiAobWFuaWZvbGQsIGVkZ2UsIHhmMSwgY2lyY2xlLCB4ZjIpIHt9XG4gICBCb3gyRC5pbmhlcml0KGIyTnVsbENvbnRhY3QsIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdCk7XG4gICBiMk51bGxDb250YWN0LnByb3RvdHlwZS5fX3N1cGVyID0gQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0LnByb3RvdHlwZTtcbiAgIGIyTnVsbENvbnRhY3QuYjJOdWxsQ29udGFjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdC5iMkNvbnRhY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBiMk51bGxDb250YWN0LnByb3RvdHlwZS5iMk51bGxDb250YWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fX3N1cGVyLmIyQ29udGFjdC5jYWxsKHRoaXMpO1xuICAgfVxuICAgYjJOdWxsQ29udGFjdC5wcm90b3R5cGUuRXZhbHVhdGUgPSBmdW5jdGlvbiAoKSB7fVxuICAgQm94MkQuaW5oZXJpdChiMlBvbHlBbmRDaXJjbGVDb250YWN0LCBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3QpO1xuICAgYjJQb2x5QW5kQ2lyY2xlQ29udGFjdC5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdC5wcm90b3R5cGU7XG4gICBiMlBvbHlBbmRDaXJjbGVDb250YWN0LmIyUG9seUFuZENpcmNsZUNvbnRhY3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3QuYjJDb250YWN0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICB9O1xuICAgYjJQb2x5QW5kQ2lyY2xlQ29udGFjdC5DcmVhdGUgPSBmdW5jdGlvbiAoYWxsb2NhdG9yKSB7XG4gICAgICByZXR1cm4gbmV3IGIyUG9seUFuZENpcmNsZUNvbnRhY3QoKTtcbiAgIH1cbiAgIGIyUG9seUFuZENpcmNsZUNvbnRhY3QuRGVzdHJveSA9IGZ1bmN0aW9uIChjb250YWN0LCBhbGxvY2F0b3IpIHt9XG4gICBiMlBvbHlBbmRDaXJjbGVDb250YWN0LnByb3RvdHlwZS5SZXNldCA9IGZ1bmN0aW9uIChmaXh0dXJlQSwgZml4dHVyZUIpIHtcbiAgICAgIHRoaXMuX19zdXBlci5SZXNldC5jYWxsKHRoaXMsIGZpeHR1cmVBLCBmaXh0dXJlQik7XG4gICAgICBiMlNldHRpbmdzLmIyQXNzZXJ0KGZpeHR1cmVBLkdldFR5cGUoKSA9PSBiMlNoYXBlLmVfcG9seWdvblNoYXBlKTtcbiAgICAgIGIyU2V0dGluZ3MuYjJBc3NlcnQoZml4dHVyZUIuR2V0VHlwZSgpID09IGIyU2hhcGUuZV9jaXJjbGVTaGFwZSk7XG4gICB9XG4gICBiMlBvbHlBbmRDaXJjbGVDb250YWN0LnByb3RvdHlwZS5FdmFsdWF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9maXh0dXJlQS5tX2JvZHk7XG4gICAgICB2YXIgYkIgPSB0aGlzLm1fZml4dHVyZUIubV9ib2R5O1xuICAgICAgYjJDb2xsaXNpb24uQ29sbGlkZVBvbHlnb25BbmRDaXJjbGUodGhpcy5tX21hbmlmb2xkLCAodGhpcy5tX2ZpeHR1cmVBLkdldFNoYXBlKCkgaW5zdGFuY2VvZiBiMlBvbHlnb25TaGFwZSA/IHRoaXMubV9maXh0dXJlQS5HZXRTaGFwZSgpIDogbnVsbCksIGJBLm1feGYsICh0aGlzLm1fZml4dHVyZUIuR2V0U2hhcGUoKSBpbnN0YW5jZW9mIGIyQ2lyY2xlU2hhcGUgPyB0aGlzLm1fZml4dHVyZUIuR2V0U2hhcGUoKSA6IG51bGwpLCBiQi5tX3hmKTtcbiAgIH1cbiAgIEJveDJELmluaGVyaXQoYjJQb2x5QW5kRWRnZUNvbnRhY3QsIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdCk7XG4gICBiMlBvbHlBbmRFZGdlQ29udGFjdC5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdC5wcm90b3R5cGU7XG4gICBiMlBvbHlBbmRFZGdlQ29udGFjdC5iMlBvbHlBbmRFZGdlQ29udGFjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyQ29udGFjdC5iMkNvbnRhY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgIH07XG4gICBiMlBvbHlBbmRFZGdlQ29udGFjdC5DcmVhdGUgPSBmdW5jdGlvbiAoYWxsb2NhdG9yKSB7XG4gICAgICByZXR1cm4gbmV3IGIyUG9seUFuZEVkZ2VDb250YWN0KCk7XG4gICB9XG4gICBiMlBvbHlBbmRFZGdlQ29udGFjdC5EZXN0cm95ID0gZnVuY3Rpb24gKGNvbnRhY3QsIGFsbG9jYXRvcikge31cbiAgIGIyUG9seUFuZEVkZ2VDb250YWN0LnByb3RvdHlwZS5SZXNldCA9IGZ1bmN0aW9uIChmaXh0dXJlQSwgZml4dHVyZUIpIHtcbiAgICAgIHRoaXMuX19zdXBlci5SZXNldC5jYWxsKHRoaXMsIGZpeHR1cmVBLCBmaXh0dXJlQik7XG4gICAgICBiMlNldHRpbmdzLmIyQXNzZXJ0KGZpeHR1cmVBLkdldFR5cGUoKSA9PSBiMlNoYXBlLmVfcG9seWdvblNoYXBlKTtcbiAgICAgIGIyU2V0dGluZ3MuYjJBc3NlcnQoZml4dHVyZUIuR2V0VHlwZSgpID09IGIyU2hhcGUuZV9lZGdlU2hhcGUpO1xuICAgfVxuICAgYjJQb2x5QW5kRWRnZUNvbnRhY3QucHJvdG90eXBlLkV2YWx1YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGJBID0gdGhpcy5tX2ZpeHR1cmVBLkdldEJvZHkoKTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9maXh0dXJlQi5HZXRCb2R5KCk7XG4gICAgICB0aGlzLmIyQ29sbGlkZVBvbHlBbmRFZGdlKHRoaXMubV9tYW5pZm9sZCwgKHRoaXMubV9maXh0dXJlQS5HZXRTaGFwZSgpIGluc3RhbmNlb2YgYjJQb2x5Z29uU2hhcGUgPyB0aGlzLm1fZml4dHVyZUEuR2V0U2hhcGUoKSA6IG51bGwpLCBiQS5tX3hmLCAodGhpcy5tX2ZpeHR1cmVCLkdldFNoYXBlKCkgaW5zdGFuY2VvZiBiMkVkZ2VTaGFwZSA/IHRoaXMubV9maXh0dXJlQi5HZXRTaGFwZSgpIDogbnVsbCksIGJCLm1feGYpO1xuICAgfVxuICAgYjJQb2x5QW5kRWRnZUNvbnRhY3QucHJvdG90eXBlLmIyQ29sbGlkZVBvbHlBbmRFZGdlID0gZnVuY3Rpb24gKG1hbmlmb2xkLCBwb2x5Z29uLCB4ZjEsIGVkZ2UsIHhmMikge31cbiAgIEJveDJELmluaGVyaXQoYjJQb2x5Z29uQ29udGFjdCwgQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0KTtcbiAgIGIyUG9seWdvbkNvbnRhY3QucHJvdG90eXBlLl9fc3VwZXIgPSBCb3gyRC5EeW5hbWljcy5Db250YWN0cy5iMkNvbnRhY3QucHJvdG90eXBlO1xuICAgYjJQb2x5Z29uQ29udGFjdC5iMlBvbHlnb25Db250YWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJDb250YWN0LmIyQ29udGFjdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIGIyUG9seWdvbkNvbnRhY3QuQ3JlYXRlID0gZnVuY3Rpb24gKGFsbG9jYXRvcikge1xuICAgICAgcmV0dXJuIG5ldyBiMlBvbHlnb25Db250YWN0KCk7XG4gICB9XG4gICBiMlBvbHlnb25Db250YWN0LkRlc3Ryb3kgPSBmdW5jdGlvbiAoY29udGFjdCwgYWxsb2NhdG9yKSB7fVxuICAgYjJQb2x5Z29uQ29udGFjdC5wcm90b3R5cGUuUmVzZXQgPSBmdW5jdGlvbiAoZml4dHVyZUEsIGZpeHR1cmVCKSB7XG4gICAgICB0aGlzLl9fc3VwZXIuUmVzZXQuY2FsbCh0aGlzLCBmaXh0dXJlQSwgZml4dHVyZUIpO1xuICAgfVxuICAgYjJQb2x5Z29uQ29udGFjdC5wcm90b3R5cGUuRXZhbHVhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgYkEgPSB0aGlzLm1fZml4dHVyZUEuR2V0Qm9keSgpO1xuICAgICAgdmFyIGJCID0gdGhpcy5tX2ZpeHR1cmVCLkdldEJvZHkoKTtcbiAgICAgIGIyQ29sbGlzaW9uLkNvbGxpZGVQb2x5Z29ucyh0aGlzLm1fbWFuaWZvbGQsICh0aGlzLm1fZml4dHVyZUEuR2V0U2hhcGUoKSBpbnN0YW5jZW9mIGIyUG9seWdvblNoYXBlID8gdGhpcy5tX2ZpeHR1cmVBLkdldFNoYXBlKCkgOiBudWxsKSwgYkEubV94ZiwgKHRoaXMubV9maXh0dXJlQi5HZXRTaGFwZSgpIGluc3RhbmNlb2YgYjJQb2x5Z29uU2hhcGUgPyB0aGlzLm1fZml4dHVyZUIuR2V0U2hhcGUoKSA6IG51bGwpLCBiQi5tX3hmKTtcbiAgIH1cbiAgIGIyUG9zaXRpb25Tb2x2ZXJNYW5pZm9sZC5iMlBvc2l0aW9uU29sdmVyTWFuaWZvbGQgPSBmdW5jdGlvbiAoKSB7fTtcbiAgIGIyUG9zaXRpb25Tb2x2ZXJNYW5pZm9sZC5wcm90b3R5cGUuYjJQb3NpdGlvblNvbHZlck1hbmlmb2xkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX25vcm1hbCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9zZXBhcmF0aW9ucyA9IG5ldyBWZWN0b3JfYTJqX051bWJlcihiMlNldHRpbmdzLmIyX21heE1hbmlmb2xkUG9pbnRzKTtcbiAgICAgIHRoaXMubV9wb2ludHMgPSBuZXcgVmVjdG9yKGIyU2V0dGluZ3MuYjJfbWF4TWFuaWZvbGRQb2ludHMpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiMlNldHRpbmdzLmIyX21heE1hbmlmb2xkUG9pbnRzOyBpKyspIHtcbiAgICAgICAgIHRoaXMubV9wb2ludHNbaV0gPSBuZXcgYjJWZWMyKCk7XG4gICAgICB9XG4gICB9XG4gICBiMlBvc2l0aW9uU29sdmVyTWFuaWZvbGQucHJvdG90eXBlLkluaXRpYWxpemUgPSBmdW5jdGlvbiAoY2MpIHtcbiAgICAgIGIyU2V0dGluZ3MuYjJBc3NlcnQoY2MucG9pbnRDb3VudCA+IDApO1xuICAgICAgdmFyIGkgPSAwO1xuICAgICAgdmFyIGNsaXBQb2ludFggPSAwO1xuICAgICAgdmFyIGNsaXBQb2ludFkgPSAwO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB2YXIgdFZlYztcbiAgICAgIHZhciBwbGFuZVBvaW50WCA9IDA7XG4gICAgICB2YXIgcGxhbmVQb2ludFkgPSAwO1xuICAgICAgc3dpdGNoIChjYy50eXBlKSB7XG4gICAgICBjYXNlIGIyTWFuaWZvbGQuZV9jaXJjbGVzOlxuICAgICAgICAge1xuICAgICAgICAgICAgdE1hdCA9IGNjLmJvZHlBLm1feGYuUjtcbiAgICAgICAgICAgIHRWZWMgPSBjYy5sb2NhbFBvaW50O1xuICAgICAgICAgICAgdmFyIHBvaW50QVggPSBjYy5ib2R5QS5tX3hmLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICAgICAgICB2YXIgcG9pbnRBWSA9IGNjLmJvZHlBLm1feGYucG9zaXRpb24ueSArICh0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55KTtcbiAgICAgICAgICAgIHRNYXQgPSBjYy5ib2R5Qi5tX3hmLlI7XG4gICAgICAgICAgICB0VmVjID0gY2MucG9pbnRzWzBdLmxvY2FsUG9pbnQ7XG4gICAgICAgICAgICB2YXIgcG9pbnRCWCA9IGNjLmJvZHlCLm1feGYucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55KTtcbiAgICAgICAgICAgIHZhciBwb2ludEJZID0gY2MuYm9keUIubV94Zi5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgICAgICAgdmFyIGRYID0gcG9pbnRCWCAtIHBvaW50QVg7XG4gICAgICAgICAgICB2YXIgZFkgPSBwb2ludEJZIC0gcG9pbnRBWTtcbiAgICAgICAgICAgIHZhciBkMiA9IGRYICogZFggKyBkWSAqIGRZO1xuICAgICAgICAgICAgaWYgKGQyID4gTnVtYmVyLk1JTl9WQUxVRSAqIE51bWJlci5NSU5fVkFMVUUpIHtcbiAgICAgICAgICAgICAgIHZhciBkID0gTWF0aC5zcXJ0KGQyKTtcbiAgICAgICAgICAgICAgIHRoaXMubV9ub3JtYWwueCA9IGRYIC8gZDtcbiAgICAgICAgICAgICAgIHRoaXMubV9ub3JtYWwueSA9IGRZIC8gZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgdGhpcy5tX25vcm1hbC54ID0gMS4wO1xuICAgICAgICAgICAgICAgdGhpcy5tX25vcm1hbC55ID0gMC4wO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5tX3BvaW50c1swXS54ID0gMC41ICogKHBvaW50QVggKyBwb2ludEJYKTtcbiAgICAgICAgICAgIHRoaXMubV9wb2ludHNbMF0ueSA9IDAuNSAqIChwb2ludEFZICsgcG9pbnRCWSk7XG4gICAgICAgICAgICB0aGlzLm1fc2VwYXJhdGlvbnNbMF0gPSBkWCAqIHRoaXMubV9ub3JtYWwueCArIGRZICogdGhpcy5tX25vcm1hbC55IC0gY2MucmFkaXVzO1xuICAgICAgICAgfVxuICAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGIyTWFuaWZvbGQuZV9mYWNlQTpcbiAgICAgICAgIHtcbiAgICAgICAgICAgIHRNYXQgPSBjYy5ib2R5QS5tX3hmLlI7XG4gICAgICAgICAgICB0VmVjID0gY2MubG9jYWxQbGFuZU5vcm1hbDtcbiAgICAgICAgICAgIHRoaXMubV9ub3JtYWwueCA9IHRNYXQuY29sMS54ICogdFZlYy54ICsgdE1hdC5jb2wyLnggKiB0VmVjLnk7XG4gICAgICAgICAgICB0aGlzLm1fbm9ybWFsLnkgPSB0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55O1xuICAgICAgICAgICAgdE1hdCA9IGNjLmJvZHlBLm1feGYuUjtcbiAgICAgICAgICAgIHRWZWMgPSBjYy5sb2NhbFBvaW50O1xuICAgICAgICAgICAgcGxhbmVQb2ludFggPSBjYy5ib2R5QS5tX3hmLnBvc2l0aW9uLnggKyAodE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueSk7XG4gICAgICAgICAgICBwbGFuZVBvaW50WSA9IGNjLmJvZHlBLm1feGYucG9zaXRpb24ueSArICh0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55KTtcbiAgICAgICAgICAgIHRNYXQgPSBjYy5ib2R5Qi5tX3hmLlI7XG4gICAgICAgICAgICBmb3IgKGkgPSAwO1xuICAgICAgICAgICAgaSA8IGNjLnBvaW50Q291bnQ7ICsraSkge1xuICAgICAgICAgICAgICAgdFZlYyA9IGNjLnBvaW50c1tpXS5sb2NhbFBvaW50O1xuICAgICAgICAgICAgICAgY2xpcFBvaW50WCA9IGNjLmJvZHlCLm1feGYucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55KTtcbiAgICAgICAgICAgICAgIGNsaXBQb2ludFkgPSBjYy5ib2R5Qi5tX3hmLnBvc2l0aW9uLnkgKyAodE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueSk7XG4gICAgICAgICAgICAgICB0aGlzLm1fc2VwYXJhdGlvbnNbaV0gPSAoY2xpcFBvaW50WCAtIHBsYW5lUG9pbnRYKSAqIHRoaXMubV9ub3JtYWwueCArIChjbGlwUG9pbnRZIC0gcGxhbmVQb2ludFkpICogdGhpcy5tX25vcm1hbC55IC0gY2MucmFkaXVzO1xuICAgICAgICAgICAgICAgdGhpcy5tX3BvaW50c1tpXS54ID0gY2xpcFBvaW50WDtcbiAgICAgICAgICAgICAgIHRoaXMubV9wb2ludHNbaV0ueSA9IGNsaXBQb2ludFk7XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgYjJNYW5pZm9sZC5lX2ZhY2VCOlxuICAgICAgICAge1xuICAgICAgICAgICAgdE1hdCA9IGNjLmJvZHlCLm1feGYuUjtcbiAgICAgICAgICAgIHRWZWMgPSBjYy5sb2NhbFBsYW5lTm9ybWFsO1xuICAgICAgICAgICAgdGhpcy5tX25vcm1hbC54ID0gdE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueTtcbiAgICAgICAgICAgIHRoaXMubV9ub3JtYWwueSA9IHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnk7XG4gICAgICAgICAgICB0TWF0ID0gY2MuYm9keUIubV94Zi5SO1xuICAgICAgICAgICAgdFZlYyA9IGNjLmxvY2FsUG9pbnQ7XG4gICAgICAgICAgICBwbGFuZVBvaW50WCA9IGNjLmJvZHlCLm1feGYucG9zaXRpb24ueCArICh0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55KTtcbiAgICAgICAgICAgIHBsYW5lUG9pbnRZID0gY2MuYm9keUIubV94Zi5wb3NpdGlvbi55ICsgKHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnkpO1xuICAgICAgICAgICAgdE1hdCA9IGNjLmJvZHlBLm1feGYuUjtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7XG4gICAgICAgICAgICBpIDwgY2MucG9pbnRDb3VudDsgKytpKSB7XG4gICAgICAgICAgICAgICB0VmVjID0gY2MucG9pbnRzW2ldLmxvY2FsUG9pbnQ7XG4gICAgICAgICAgICAgICBjbGlwUG9pbnRYID0gY2MuYm9keUEubV94Zi5wb3NpdGlvbi54ICsgKHRNYXQuY29sMS54ICogdFZlYy54ICsgdE1hdC5jb2wyLnggKiB0VmVjLnkpO1xuICAgICAgICAgICAgICAgY2xpcFBvaW50WSA9IGNjLmJvZHlBLm1feGYucG9zaXRpb24ueSArICh0TWF0LmNvbDEueSAqIHRWZWMueCArIHRNYXQuY29sMi55ICogdFZlYy55KTtcbiAgICAgICAgICAgICAgIHRoaXMubV9zZXBhcmF0aW9uc1tpXSA9IChjbGlwUG9pbnRYIC0gcGxhbmVQb2ludFgpICogdGhpcy5tX25vcm1hbC54ICsgKGNsaXBQb2ludFkgLSBwbGFuZVBvaW50WSkgKiB0aGlzLm1fbm9ybWFsLnkgLSBjYy5yYWRpdXM7XG4gICAgICAgICAgICAgICB0aGlzLm1fcG9pbnRzW2ldLlNldChjbGlwUG9pbnRYLCBjbGlwUG9pbnRZKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubV9ub3JtYWwueCAqPSAoLTEpO1xuICAgICAgICAgICAgdGhpcy5tX25vcm1hbC55ICo9ICgtMSk7XG4gICAgICAgICB9XG4gICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgIH1cbiAgIEJveDJELnBvc3REZWZzLnB1c2goZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuQ29udGFjdHMuYjJQb3NpdGlvblNvbHZlck1hbmlmb2xkLmNpcmNsZVBvaW50QSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIEJveDJELkR5bmFtaWNzLkNvbnRhY3RzLmIyUG9zaXRpb25Tb2x2ZXJNYW5pZm9sZC5jaXJjbGVQb2ludEIgPSBuZXcgYjJWZWMyKCk7XG4gICB9KTtcbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgdmFyIGIyQm9keSA9IEJveDJELkR5bmFtaWNzLmIyQm9keSxcbiAgICAgIGIyQm9keURlZiA9IEJveDJELkR5bmFtaWNzLmIyQm9keURlZixcbiAgICAgIGIyQ29udGFjdEZpbHRlciA9IEJveDJELkR5bmFtaWNzLmIyQ29udGFjdEZpbHRlcixcbiAgICAgIGIyQ29udGFjdEltcHVsc2UgPSBCb3gyRC5EeW5hbWljcy5iMkNvbnRhY3RJbXB1bHNlLFxuICAgICAgYjJDb250YWN0TGlzdGVuZXIgPSBCb3gyRC5EeW5hbWljcy5iMkNvbnRhY3RMaXN0ZW5lcixcbiAgICAgIGIyQ29udGFjdE1hbmFnZXIgPSBCb3gyRC5EeW5hbWljcy5iMkNvbnRhY3RNYW5hZ2VyLFxuICAgICAgYjJEZWJ1Z0RyYXcgPSBCb3gyRC5EeW5hbWljcy5iMkRlYnVnRHJhdyxcbiAgICAgIGIyRGVzdHJ1Y3Rpb25MaXN0ZW5lciA9IEJveDJELkR5bmFtaWNzLmIyRGVzdHJ1Y3Rpb25MaXN0ZW5lcixcbiAgICAgIGIyRmlsdGVyRGF0YSA9IEJveDJELkR5bmFtaWNzLmIyRmlsdGVyRGF0YSxcbiAgICAgIGIyRml4dHVyZSA9IEJveDJELkR5bmFtaWNzLmIyRml4dHVyZSxcbiAgICAgIGIyRml4dHVyZURlZiA9IEJveDJELkR5bmFtaWNzLmIyRml4dHVyZURlZixcbiAgICAgIGIySXNsYW5kID0gQm94MkQuRHluYW1pY3MuYjJJc2xhbmQsXG4gICAgICBiMlRpbWVTdGVwID0gQm94MkQuRHluYW1pY3MuYjJUaW1lU3RlcCxcbiAgICAgIGIyV29ybGQgPSBCb3gyRC5EeW5hbWljcy5iMldvcmxkLFxuICAgICAgYjJNYXQyMiA9IEJveDJELkNvbW1vbi5NYXRoLmIyTWF0MjIsXG4gICAgICBiMk1hdDMzID0gQm94MkQuQ29tbW9uLk1hdGguYjJNYXQzMyxcbiAgICAgIGIyTWF0aCA9IEJveDJELkNvbW1vbi5NYXRoLmIyTWF0aCxcbiAgICAgIGIyU3dlZXAgPSBCb3gyRC5Db21tb24uTWF0aC5iMlN3ZWVwLFxuICAgICAgYjJUcmFuc2Zvcm0gPSBCb3gyRC5Db21tb24uTWF0aC5iMlRyYW5zZm9ybSxcbiAgICAgIGIyVmVjMiA9IEJveDJELkNvbW1vbi5NYXRoLmIyVmVjMixcbiAgICAgIGIyVmVjMyA9IEJveDJELkNvbW1vbi5NYXRoLmIyVmVjMyxcbiAgICAgIGIyQ29sb3IgPSBCb3gyRC5Db21tb24uYjJDb2xvcixcbiAgICAgIGIyaW50ZXJuYWwgPSBCb3gyRC5Db21tb24uYjJpbnRlcm5hbCxcbiAgICAgIGIyU2V0dGluZ3MgPSBCb3gyRC5Db21tb24uYjJTZXR0aW5ncyxcbiAgICAgIGIyQ2lyY2xlU2hhcGUgPSBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyQ2lyY2xlU2hhcGUsXG4gICAgICBiMkVkZ2VDaGFpbkRlZiA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJFZGdlQ2hhaW5EZWYsXG4gICAgICBiMkVkZ2VTaGFwZSA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJFZGdlU2hhcGUsXG4gICAgICBiMk1hc3NEYXRhID0gQm94MkQuQ29sbGlzaW9uLlNoYXBlcy5iMk1hc3NEYXRhLFxuICAgICAgYjJQb2x5Z29uU2hhcGUgPSBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyUG9seWdvblNoYXBlLFxuICAgICAgYjJTaGFwZSA9IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJTaGFwZSxcbiAgICAgIGIyQnVveWFuY3lDb250cm9sbGVyID0gQm94MkQuRHluYW1pY3MuQ29udHJvbGxlcnMuYjJCdW95YW5jeUNvbnRyb2xsZXIsXG4gICAgICBiMkNvbnN0YW50QWNjZWxDb250cm9sbGVyID0gQm94MkQuRHluYW1pY3MuQ29udHJvbGxlcnMuYjJDb25zdGFudEFjY2VsQ29udHJvbGxlcixcbiAgICAgIGIyQ29uc3RhbnRGb3JjZUNvbnRyb2xsZXIgPSBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnN0YW50Rm9yY2VDb250cm9sbGVyLFxuICAgICAgYjJDb250cm9sbGVyID0gQm94MkQuRHluYW1pY3MuQ29udHJvbGxlcnMuYjJDb250cm9sbGVyLFxuICAgICAgYjJDb250cm9sbGVyRWRnZSA9IEJveDJELkR5bmFtaWNzLkNvbnRyb2xsZXJzLmIyQ29udHJvbGxlckVkZ2UsXG4gICAgICBiMkdyYXZpdHlDb250cm9sbGVyID0gQm94MkQuRHluYW1pY3MuQ29udHJvbGxlcnMuYjJHcmF2aXR5Q29udHJvbGxlcixcbiAgICAgIGIyVGVuc29yRGFtcGluZ0NvbnRyb2xsZXIgPSBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMlRlbnNvckRhbXBpbmdDb250cm9sbGVyO1xuXG4gICBCb3gyRC5pbmhlcml0KGIyQnVveWFuY3lDb250cm9sbGVyLCBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnRyb2xsZXIpO1xuICAgYjJCdW95YW5jeUNvbnRyb2xsZXIucHJvdG90eXBlLl9fc3VwZXIgPSBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnRyb2xsZXIucHJvdG90eXBlO1xuICAgYjJCdW95YW5jeUNvbnRyb2xsZXIuYjJCdW95YW5jeUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnRyb2xsZXIuYjJDb250cm9sbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLm5vcm1hbCA9IG5ldyBiMlZlYzIoMCwgKC0xKSk7XG4gICAgICB0aGlzLm9mZnNldCA9IDA7XG4gICAgICB0aGlzLmRlbnNpdHkgPSAwO1xuICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBiMlZlYzIoMCwgMCk7XG4gICAgICB0aGlzLmxpbmVhckRyYWcgPSAyO1xuICAgICAgdGhpcy5hbmd1bGFyRHJhZyA9IDE7XG4gICAgICB0aGlzLnVzZURlbnNpdHkgPSBmYWxzZTtcbiAgICAgIHRoaXMudXNlV29ybGRHcmF2aXR5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ3Jhdml0eSA9IG51bGw7XG4gICB9O1xuICAgYjJCdW95YW5jeUNvbnRyb2xsZXIucHJvdG90eXBlLlN0ZXAgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgaWYgKCF0aGlzLm1fYm9keUxpc3QpIHJldHVybjtcbiAgICAgIGlmICh0aGlzLnVzZVdvcmxkR3Jhdml0eSkge1xuICAgICAgICAgdGhpcy5ncmF2aXR5ID0gdGhpcy5HZXRXb3JsZCgpLkdldEdyYXZpdHkoKS5Db3B5KCk7XG4gICAgICB9XG4gICAgICBmb3IgKHZhciBpID0gdGhpcy5tX2JvZHlMaXN0OyBpOyBpID0gaS5uZXh0Qm9keSkge1xuICAgICAgICAgdmFyIGJvZHkgPSBpLmJvZHk7XG4gICAgICAgICBpZiAoYm9keS5Jc0F3YWtlKCkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgfVxuICAgICAgICAgdmFyIGFyZWFjID0gbmV3IGIyVmVjMigpO1xuICAgICAgICAgdmFyIG1hc3NjID0gbmV3IGIyVmVjMigpO1xuICAgICAgICAgdmFyIGFyZWEgPSAwLjA7XG4gICAgICAgICB2YXIgbWFzcyA9IDAuMDtcbiAgICAgICAgIGZvciAodmFyIGZpeHR1cmUgPSBib2R5LkdldEZpeHR1cmVMaXN0KCk7IGZpeHR1cmU7IGZpeHR1cmUgPSBmaXh0dXJlLkdldE5leHQoKSkge1xuICAgICAgICAgICAgdmFyIHNjID0gbmV3IGIyVmVjMigpO1xuICAgICAgICAgICAgdmFyIHNhcmVhID0gZml4dHVyZS5HZXRTaGFwZSgpLkNvbXB1dGVTdWJtZXJnZWRBcmVhKHRoaXMubm9ybWFsLCB0aGlzLm9mZnNldCwgYm9keS5HZXRUcmFuc2Zvcm0oKSwgc2MpO1xuICAgICAgICAgICAgYXJlYSArPSBzYXJlYTtcbiAgICAgICAgICAgIGFyZWFjLnggKz0gc2FyZWEgKiBzYy54O1xuICAgICAgICAgICAgYXJlYWMueSArPSBzYXJlYSAqIHNjLnk7XG4gICAgICAgICAgICB2YXIgc2hhcGVEZW5zaXR5ID0gMDtcbiAgICAgICAgICAgIGlmICh0aGlzLnVzZURlbnNpdHkpIHtcbiAgICAgICAgICAgICAgIHNoYXBlRGVuc2l0eSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgIHNoYXBlRGVuc2l0eSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtYXNzICs9IHNhcmVhICogc2hhcGVEZW5zaXR5O1xuICAgICAgICAgICAgbWFzc2MueCArPSBzYXJlYSAqIHNjLnggKiBzaGFwZURlbnNpdHk7XG4gICAgICAgICAgICBtYXNzYy55ICs9IHNhcmVhICogc2MueSAqIHNoYXBlRGVuc2l0eTtcbiAgICAgICAgIH1cbiAgICAgICAgIGFyZWFjLnggLz0gYXJlYTtcbiAgICAgICAgIGFyZWFjLnkgLz0gYXJlYTtcbiAgICAgICAgIG1hc3NjLnggLz0gbWFzcztcbiAgICAgICAgIG1hc3NjLnkgLz0gbWFzcztcbiAgICAgICAgIGlmIChhcmVhIDwgTnVtYmVyLk1JTl9WQUxVRSkgY29udGludWU7XG4gICAgICAgICB2YXIgYnVveWFuY3lGb3JjZSA9IHRoaXMuZ3Jhdml0eS5HZXROZWdhdGl2ZSgpO1xuICAgICAgICAgYnVveWFuY3lGb3JjZS5NdWx0aXBseSh0aGlzLmRlbnNpdHkgKiBhcmVhKTtcbiAgICAgICAgIGJvZHkuQXBwbHlGb3JjZShidW95YW5jeUZvcmNlLCBtYXNzYyk7XG4gICAgICAgICB2YXIgZHJhZ0ZvcmNlID0gYm9keS5HZXRMaW5lYXJWZWxvY2l0eUZyb21Xb3JsZFBvaW50KGFyZWFjKTtcbiAgICAgICAgIGRyYWdGb3JjZS5TdWJ0cmFjdCh0aGlzLnZlbG9jaXR5KTtcbiAgICAgICAgIGRyYWdGb3JjZS5NdWx0aXBseSgoLXRoaXMubGluZWFyRHJhZyAqIGFyZWEpKTtcbiAgICAgICAgIGJvZHkuQXBwbHlGb3JjZShkcmFnRm9yY2UsIGFyZWFjKTtcbiAgICAgICAgIGJvZHkuQXBwbHlUb3JxdWUoKC1ib2R5LkdldEluZXJ0aWEoKSAvIGJvZHkuR2V0TWFzcygpICogYXJlYSAqIGJvZHkuR2V0QW5ndWxhclZlbG9jaXR5KCkgKiB0aGlzLmFuZ3VsYXJEcmFnKSk7XG4gICAgICB9XG4gICB9XG4gICBiMkJ1b3lhbmN5Q29udHJvbGxlci5wcm90b3R5cGUuRHJhdyA9IGZ1bmN0aW9uIChkZWJ1Z0RyYXcpIHtcbiAgICAgIHZhciByID0gMTAwMDtcbiAgICAgIHZhciBwMSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHZhciBwMiA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHAxLnggPSB0aGlzLm5vcm1hbC54ICogdGhpcy5vZmZzZXQgKyB0aGlzLm5vcm1hbC55ICogcjtcbiAgICAgIHAxLnkgPSB0aGlzLm5vcm1hbC55ICogdGhpcy5vZmZzZXQgLSB0aGlzLm5vcm1hbC54ICogcjtcbiAgICAgIHAyLnggPSB0aGlzLm5vcm1hbC54ICogdGhpcy5vZmZzZXQgLSB0aGlzLm5vcm1hbC55ICogcjtcbiAgICAgIHAyLnkgPSB0aGlzLm5vcm1hbC55ICogdGhpcy5vZmZzZXQgKyB0aGlzLm5vcm1hbC54ICogcjtcbiAgICAgIHZhciBjb2xvciA9IG5ldyBiMkNvbG9yKDAsIDAsIDEpO1xuICAgICAgZGVidWdEcmF3LkRyYXdTZWdtZW50KHAxLCBwMiwgY29sb3IpO1xuICAgfVxuICAgQm94MkQuaW5oZXJpdChiMkNvbnN0YW50QWNjZWxDb250cm9sbGVyLCBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnRyb2xsZXIpO1xuICAgYjJDb25zdGFudEFjY2VsQ29udHJvbGxlci5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkR5bmFtaWNzLkNvbnRyb2xsZXJzLmIyQ29udHJvbGxlci5wcm90b3R5cGU7XG4gICBiMkNvbnN0YW50QWNjZWxDb250cm9sbGVyLmIyQ29uc3RhbnRBY2NlbENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnRyb2xsZXIuYjJDb250cm9sbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLkEgPSBuZXcgYjJWZWMyKDAsIDApO1xuICAgfTtcbiAgIGIyQ29uc3RhbnRBY2NlbENvbnRyb2xsZXIucHJvdG90eXBlLlN0ZXAgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgdmFyIHNtYWxsQSA9IG5ldyBiMlZlYzIodGhpcy5BLnggKiBzdGVwLmR0LCB0aGlzLkEueSAqIHN0ZXAuZHQpO1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMubV9ib2R5TGlzdDsgaTsgaSA9IGkubmV4dEJvZHkpIHtcbiAgICAgICAgIHZhciBib2R5ID0gaS5ib2R5O1xuICAgICAgICAgaWYgKCFib2R5LklzQXdha2UoKSkgY29udGludWU7XG4gICAgICAgICBib2R5LlNldExpbmVhclZlbG9jaXR5KG5ldyBiMlZlYzIoYm9keS5HZXRMaW5lYXJWZWxvY2l0eSgpLnggKyBzbWFsbEEueCwgYm9keS5HZXRMaW5lYXJWZWxvY2l0eSgpLnkgKyBzbWFsbEEueSkpO1xuICAgICAgfVxuICAgfVxuICAgQm94MkQuaW5oZXJpdChiMkNvbnN0YW50Rm9yY2VDb250cm9sbGVyLCBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnRyb2xsZXIpO1xuICAgYjJDb25zdGFudEZvcmNlQ29udHJvbGxlci5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkR5bmFtaWNzLkNvbnRyb2xsZXJzLmIyQ29udHJvbGxlci5wcm90b3R5cGU7XG4gICBiMkNvbnN0YW50Rm9yY2VDb250cm9sbGVyLmIyQ29uc3RhbnRGb3JjZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnRyb2xsZXIuYjJDb250cm9sbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLkYgPSBuZXcgYjJWZWMyKDAsIDApO1xuICAgfTtcbiAgIGIyQ29uc3RhbnRGb3JjZUNvbnRyb2xsZXIucHJvdG90eXBlLlN0ZXAgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMubV9ib2R5TGlzdDsgaTsgaSA9IGkubmV4dEJvZHkpIHtcbiAgICAgICAgIHZhciBib2R5ID0gaS5ib2R5O1xuICAgICAgICAgaWYgKCFib2R5LklzQXdha2UoKSkgY29udGludWU7XG4gICAgICAgICBib2R5LkFwcGx5Rm9yY2UodGhpcy5GLCBib2R5LkdldFdvcmxkQ2VudGVyKCkpO1xuICAgICAgfVxuICAgfVxuICAgYjJDb250cm9sbGVyLmIyQ29udHJvbGxlciA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJDb250cm9sbGVyLnByb3RvdHlwZS5TdGVwID0gZnVuY3Rpb24gKHN0ZXApIHt9XG4gICBiMkNvbnRyb2xsZXIucHJvdG90eXBlLkRyYXcgPSBmdW5jdGlvbiAoZGVidWdEcmF3KSB7fVxuICAgYjJDb250cm9sbGVyLnByb3RvdHlwZS5BZGRCb2R5ID0gZnVuY3Rpb24gKGJvZHkpIHtcbiAgICAgIHZhciBlZGdlID0gbmV3IGIyQ29udHJvbGxlckVkZ2UoKTtcbiAgICAgIGVkZ2UuY29udHJvbGxlciA9IHRoaXM7XG4gICAgICBlZGdlLmJvZHkgPSBib2R5O1xuICAgICAgZWRnZS5uZXh0Qm9keSA9IHRoaXMubV9ib2R5TGlzdDtcbiAgICAgIGVkZ2UucHJldkJvZHkgPSBudWxsO1xuICAgICAgdGhpcy5tX2JvZHlMaXN0ID0gZWRnZTtcbiAgICAgIGlmIChlZGdlLm5leHRCb2R5KSBlZGdlLm5leHRCb2R5LnByZXZCb2R5ID0gZWRnZTtcbiAgICAgIHRoaXMubV9ib2R5Q291bnQrKztcbiAgICAgIGVkZ2UubmV4dENvbnRyb2xsZXIgPSBib2R5Lm1fY29udHJvbGxlckxpc3Q7XG4gICAgICBlZGdlLnByZXZDb250cm9sbGVyID0gbnVsbDtcbiAgICAgIGJvZHkubV9jb250cm9sbGVyTGlzdCA9IGVkZ2U7XG4gICAgICBpZiAoZWRnZS5uZXh0Q29udHJvbGxlcikgZWRnZS5uZXh0Q29udHJvbGxlci5wcmV2Q29udHJvbGxlciA9IGVkZ2U7XG4gICAgICBib2R5Lm1fY29udHJvbGxlckNvdW50Kys7XG4gICB9XG4gICBiMkNvbnRyb2xsZXIucHJvdG90eXBlLlJlbW92ZUJvZHkgPSBmdW5jdGlvbiAoYm9keSkge1xuICAgICAgdmFyIGVkZ2UgPSBib2R5Lm1fY29udHJvbGxlckxpc3Q7XG4gICAgICB3aGlsZSAoZWRnZSAmJiBlZGdlLmNvbnRyb2xsZXIgIT0gdGhpcylcbiAgICAgIGVkZ2UgPSBlZGdlLm5leHRDb250cm9sbGVyO1xuICAgICAgaWYgKGVkZ2UucHJldkJvZHkpIGVkZ2UucHJldkJvZHkubmV4dEJvZHkgPSBlZGdlLm5leHRCb2R5O1xuICAgICAgaWYgKGVkZ2UubmV4dEJvZHkpIGVkZ2UubmV4dEJvZHkucHJldkJvZHkgPSBlZGdlLnByZXZCb2R5O1xuICAgICAgaWYgKGVkZ2UubmV4dENvbnRyb2xsZXIpIGVkZ2UubmV4dENvbnRyb2xsZXIucHJldkNvbnRyb2xsZXIgPSBlZGdlLnByZXZDb250cm9sbGVyO1xuICAgICAgaWYgKGVkZ2UucHJldkNvbnRyb2xsZXIpIGVkZ2UucHJldkNvbnRyb2xsZXIubmV4dENvbnRyb2xsZXIgPSBlZGdlLm5leHRDb250cm9sbGVyO1xuICAgICAgaWYgKHRoaXMubV9ib2R5TGlzdCA9PSBlZGdlKSB0aGlzLm1fYm9keUxpc3QgPSBlZGdlLm5leHRCb2R5O1xuICAgICAgaWYgKGJvZHkubV9jb250cm9sbGVyTGlzdCA9PSBlZGdlKSBib2R5Lm1fY29udHJvbGxlckxpc3QgPSBlZGdlLm5leHRDb250cm9sbGVyO1xuICAgICAgYm9keS5tX2NvbnRyb2xsZXJDb3VudC0tO1xuICAgICAgdGhpcy5tX2JvZHlDb3VudC0tO1xuICAgfVxuICAgYjJDb250cm9sbGVyLnByb3RvdHlwZS5DbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHdoaWxlICh0aGlzLm1fYm9keUxpc3QpXG4gICAgICB0aGlzLlJlbW92ZUJvZHkodGhpcy5tX2JvZHlMaXN0LmJvZHkpO1xuICAgfVxuICAgYjJDb250cm9sbGVyLnByb3RvdHlwZS5HZXROZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9uZXh0O1xuICAgfVxuICAgYjJDb250cm9sbGVyLnByb3RvdHlwZS5HZXRXb3JsZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fd29ybGQ7XG4gICB9XG4gICBiMkNvbnRyb2xsZXIucHJvdG90eXBlLkdldEJvZHlMaXN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5TGlzdDtcbiAgIH1cbiAgIGIyQ29udHJvbGxlckVkZ2UuYjJDb250cm9sbGVyRWRnZSA9IGZ1bmN0aW9uICgpIHt9O1xuICAgQm94MkQuaW5oZXJpdChiMkdyYXZpdHlDb250cm9sbGVyLCBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnRyb2xsZXIpO1xuICAgYjJHcmF2aXR5Q29udHJvbGxlci5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkR5bmFtaWNzLkNvbnRyb2xsZXJzLmIyQ29udHJvbGxlci5wcm90b3R5cGU7XG4gICBiMkdyYXZpdHlDb250cm9sbGVyLmIyR3Jhdml0eUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnRyb2xsZXIuYjJDb250cm9sbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLkcgPSAxO1xuICAgICAgdGhpcy5pbnZTcXIgPSB0cnVlO1xuICAgfTtcbiAgIGIyR3Jhdml0eUNvbnRyb2xsZXIucHJvdG90eXBlLlN0ZXAgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgdmFyIGkgPSBudWxsO1xuICAgICAgdmFyIGJvZHkxID0gbnVsbDtcbiAgICAgIHZhciBwMSA9IG51bGw7XG4gICAgICB2YXIgbWFzczEgPSAwO1xuICAgICAgdmFyIGogPSBudWxsO1xuICAgICAgdmFyIGJvZHkyID0gbnVsbDtcbiAgICAgIHZhciBwMiA9IG51bGw7XG4gICAgICB2YXIgZHggPSAwO1xuICAgICAgdmFyIGR5ID0gMDtcbiAgICAgIHZhciByMiA9IDA7XG4gICAgICB2YXIgZiA9IG51bGw7XG4gICAgICBpZiAodGhpcy5pbnZTcXIpIHtcbiAgICAgICAgIGZvciAoaSA9IHRoaXMubV9ib2R5TGlzdDtcbiAgICAgICAgIGk7IGkgPSBpLm5leHRCb2R5KSB7XG4gICAgICAgICAgICBib2R5MSA9IGkuYm9keTtcbiAgICAgICAgICAgIHAxID0gYm9keTEuR2V0V29ybGRDZW50ZXIoKTtcbiAgICAgICAgICAgIG1hc3MxID0gYm9keTEuR2V0TWFzcygpO1xuICAgICAgICAgICAgZm9yIChqID0gdGhpcy5tX2JvZHlMaXN0O1xuICAgICAgICAgICAgaiAhPSBpOyBqID0gai5uZXh0Qm9keSkge1xuICAgICAgICAgICAgICAgYm9keTIgPSBqLmJvZHk7XG4gICAgICAgICAgICAgICBwMiA9IGJvZHkyLkdldFdvcmxkQ2VudGVyKCk7XG4gICAgICAgICAgICAgICBkeCA9IHAyLnggLSBwMS54O1xuICAgICAgICAgICAgICAgZHkgPSBwMi55IC0gcDEueTtcbiAgICAgICAgICAgICAgIHIyID0gZHggKiBkeCArIGR5ICogZHk7XG4gICAgICAgICAgICAgICBpZiAocjIgPCBOdW1iZXIuTUlOX1ZBTFVFKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgIGYgPSBuZXcgYjJWZWMyKGR4LCBkeSk7XG4gICAgICAgICAgICAgICBmLk11bHRpcGx5KHRoaXMuRyAvIHIyIC8gTWF0aC5zcXJ0KHIyKSAqIG1hc3MxICogYm9keTIuR2V0TWFzcygpKTtcbiAgICAgICAgICAgICAgIGlmIChib2R5MS5Jc0F3YWtlKCkpIGJvZHkxLkFwcGx5Rm9yY2UoZiwgcDEpO1xuICAgICAgICAgICAgICAgZi5NdWx0aXBseSgoLTEpKTtcbiAgICAgICAgICAgICAgIGlmIChib2R5Mi5Jc0F3YWtlKCkpIGJvZHkyLkFwcGx5Rm9yY2UoZiwgcDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICBmb3IgKGkgPSB0aGlzLm1fYm9keUxpc3Q7XG4gICAgICAgICBpOyBpID0gaS5uZXh0Qm9keSkge1xuICAgICAgICAgICAgYm9keTEgPSBpLmJvZHk7XG4gICAgICAgICAgICBwMSA9IGJvZHkxLkdldFdvcmxkQ2VudGVyKCk7XG4gICAgICAgICAgICBtYXNzMSA9IGJvZHkxLkdldE1hc3MoKTtcbiAgICAgICAgICAgIGZvciAoaiA9IHRoaXMubV9ib2R5TGlzdDtcbiAgICAgICAgICAgIGogIT0gaTsgaiA9IGoubmV4dEJvZHkpIHtcbiAgICAgICAgICAgICAgIGJvZHkyID0gai5ib2R5O1xuICAgICAgICAgICAgICAgcDIgPSBib2R5Mi5HZXRXb3JsZENlbnRlcigpO1xuICAgICAgICAgICAgICAgZHggPSBwMi54IC0gcDEueDtcbiAgICAgICAgICAgICAgIGR5ID0gcDIueSAtIHAxLnk7XG4gICAgICAgICAgICAgICByMiA9IGR4ICogZHggKyBkeSAqIGR5O1xuICAgICAgICAgICAgICAgaWYgKHIyIDwgTnVtYmVyLk1JTl9WQUxVRSkgY29udGludWU7XG4gICAgICAgICAgICAgICBmID0gbmV3IGIyVmVjMihkeCwgZHkpO1xuICAgICAgICAgICAgICAgZi5NdWx0aXBseSh0aGlzLkcgLyByMiAqIG1hc3MxICogYm9keTIuR2V0TWFzcygpKTtcbiAgICAgICAgICAgICAgIGlmIChib2R5MS5Jc0F3YWtlKCkpIGJvZHkxLkFwcGx5Rm9yY2UoZiwgcDEpO1xuICAgICAgICAgICAgICAgZi5NdWx0aXBseSgoLTEpKTtcbiAgICAgICAgICAgICAgIGlmIChib2R5Mi5Jc0F3YWtlKCkpIGJvZHkyLkFwcGx5Rm9yY2UoZiwgcDIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgfVxuICAgfVxuICAgQm94MkQuaW5oZXJpdChiMlRlbnNvckRhbXBpbmdDb250cm9sbGVyLCBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnRyb2xsZXIpO1xuICAgYjJUZW5zb3JEYW1waW5nQ29udHJvbGxlci5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkR5bmFtaWNzLkNvbnRyb2xsZXJzLmIyQ29udHJvbGxlci5wcm90b3R5cGU7XG4gICBiMlRlbnNvckRhbXBpbmdDb250cm9sbGVyLmIyVGVuc29yRGFtcGluZ0NvbnRyb2xsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Db250cm9sbGVycy5iMkNvbnRyb2xsZXIuYjJDb250cm9sbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLlQgPSBuZXcgYjJNYXQyMigpO1xuICAgICAgdGhpcy5tYXhUaW1lc3RlcCA9IDA7XG4gICB9O1xuICAgYjJUZW5zb3JEYW1waW5nQ29udHJvbGxlci5wcm90b3R5cGUuU2V0QXhpc0FsaWduZWQgPSBmdW5jdGlvbiAoeERhbXBpbmcsIHlEYW1waW5nKSB7XG4gICAgICBpZiAoeERhbXBpbmcgPT09IHVuZGVmaW5lZCkgeERhbXBpbmcgPSAwO1xuICAgICAgaWYgKHlEYW1waW5nID09PSB1bmRlZmluZWQpIHlEYW1waW5nID0gMDtcbiAgICAgIHRoaXMuVC5jb2wxLnggPSAoLXhEYW1waW5nKTtcbiAgICAgIHRoaXMuVC5jb2wxLnkgPSAwO1xuICAgICAgdGhpcy5ULmNvbDIueCA9IDA7XG4gICAgICB0aGlzLlQuY29sMi55ID0gKC15RGFtcGluZyk7XG4gICAgICBpZiAoeERhbXBpbmcgPiAwIHx8IHlEYW1waW5nID4gMCkge1xuICAgICAgICAgdGhpcy5tYXhUaW1lc3RlcCA9IDEgLyBNYXRoLm1heCh4RGFtcGluZywgeURhbXBpbmcpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICB0aGlzLm1heFRpbWVzdGVwID0gMDtcbiAgICAgIH1cbiAgIH1cbiAgIGIyVGVuc29yRGFtcGluZ0NvbnRyb2xsZXIucHJvdG90eXBlLlN0ZXAgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgdmFyIHRpbWVzdGVwID0gc3RlcC5kdDtcbiAgICAgIGlmICh0aW1lc3RlcCA8PSBOdW1iZXIuTUlOX1ZBTFVFKSByZXR1cm47XG4gICAgICBpZiAodGltZXN0ZXAgPiB0aGlzLm1heFRpbWVzdGVwICYmIHRoaXMubWF4VGltZXN0ZXAgPiAwKSB0aW1lc3RlcCA9IHRoaXMubWF4VGltZXN0ZXA7XG4gICAgICBmb3IgKHZhciBpID0gdGhpcy5tX2JvZHlMaXN0OyBpOyBpID0gaS5uZXh0Qm9keSkge1xuICAgICAgICAgdmFyIGJvZHkgPSBpLmJvZHk7XG4gICAgICAgICBpZiAoIWJvZHkuSXNBd2FrZSgpKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgIH1cbiAgICAgICAgIHZhciBkYW1waW5nID0gYm9keS5HZXRXb3JsZFZlY3RvcihiMk1hdGguTXVsTVYodGhpcy5ULCBib2R5LkdldExvY2FsVmVjdG9yKGJvZHkuR2V0TGluZWFyVmVsb2NpdHkoKSkpKTtcbiAgICAgICAgIGJvZHkuU2V0TGluZWFyVmVsb2NpdHkobmV3IGIyVmVjMihib2R5LkdldExpbmVhclZlbG9jaXR5KCkueCArIGRhbXBpbmcueCAqIHRpbWVzdGVwLCBib2R5LkdldExpbmVhclZlbG9jaXR5KCkueSArIGRhbXBpbmcueSAqIHRpbWVzdGVwKSk7XG4gICAgICB9XG4gICB9XG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcbiAgIHZhciBiMkNvbG9yID0gQm94MkQuQ29tbW9uLmIyQ29sb3IsXG4gICAgICBiMmludGVybmFsID0gQm94MkQuQ29tbW9uLmIyaW50ZXJuYWwsXG4gICAgICBiMlNldHRpbmdzID0gQm94MkQuQ29tbW9uLmIyU2V0dGluZ3MsXG4gICAgICBiMk1hdDIyID0gQm94MkQuQ29tbW9uLk1hdGguYjJNYXQyMixcbiAgICAgIGIyTWF0MzMgPSBCb3gyRC5Db21tb24uTWF0aC5iMk1hdDMzLFxuICAgICAgYjJNYXRoID0gQm94MkQuQ29tbW9uLk1hdGguYjJNYXRoLFxuICAgICAgYjJTd2VlcCA9IEJveDJELkNvbW1vbi5NYXRoLmIyU3dlZXAsXG4gICAgICBiMlRyYW5zZm9ybSA9IEJveDJELkNvbW1vbi5NYXRoLmIyVHJhbnNmb3JtLFxuICAgICAgYjJWZWMyID0gQm94MkQuQ29tbW9uLk1hdGguYjJWZWMyLFxuICAgICAgYjJWZWMzID0gQm94MkQuQ29tbW9uLk1hdGguYjJWZWMzLFxuICAgICAgYjJEaXN0YW5jZUpvaW50ID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyRGlzdGFuY2VKb2ludCxcbiAgICAgIGIyRGlzdGFuY2VKb2ludERlZiA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkRpc3RhbmNlSm9pbnREZWYsXG4gICAgICBiMkZyaWN0aW9uSm9pbnQgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJGcmljdGlvbkpvaW50LFxuICAgICAgYjJGcmljdGlvbkpvaW50RGVmID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyRnJpY3Rpb25Kb2ludERlZixcbiAgICAgIGIyR2VhckpvaW50ID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyR2VhckpvaW50LFxuICAgICAgYjJHZWFySm9pbnREZWYgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJHZWFySm9pbnREZWYsXG4gICAgICBiMkphY29iaWFuID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySmFjb2JpYW4sXG4gICAgICBiMkpvaW50ID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQsXG4gICAgICBiMkpvaW50RGVmID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnREZWYsXG4gICAgICBiMkpvaW50RWRnZSA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50RWRnZSxcbiAgICAgIGIyTGluZUpvaW50ID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyTGluZUpvaW50LFxuICAgICAgYjJMaW5lSm9pbnREZWYgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJMaW5lSm9pbnREZWYsXG4gICAgICBiMk1vdXNlSm9pbnQgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJNb3VzZUpvaW50LFxuICAgICAgYjJNb3VzZUpvaW50RGVmID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIyTW91c2VKb2ludERlZixcbiAgICAgIGIyUHJpc21hdGljSm9pbnQgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJQcmlzbWF0aWNKb2ludCxcbiAgICAgIGIyUHJpc21hdGljSm9pbnREZWYgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJQcmlzbWF0aWNKb2ludERlZixcbiAgICAgIGIyUHVsbGV5Sm9pbnQgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJQdWxsZXlKb2ludCxcbiAgICAgIGIyUHVsbGV5Sm9pbnREZWYgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJQdWxsZXlKb2ludERlZixcbiAgICAgIGIyUmV2b2x1dGVKb2ludCA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMlJldm9sdXRlSm9pbnQsXG4gICAgICBiMlJldm9sdXRlSm9pbnREZWYgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJSZXZvbHV0ZUpvaW50RGVmLFxuICAgICAgYjJXZWxkSm9pbnQgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJXZWxkSm9pbnQsXG4gICAgICBiMldlbGRKb2ludERlZiA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMldlbGRKb2ludERlZixcbiAgICAgIGIyQm9keSA9IEJveDJELkR5bmFtaWNzLmIyQm9keSxcbiAgICAgIGIyQm9keURlZiA9IEJveDJELkR5bmFtaWNzLmIyQm9keURlZixcbiAgICAgIGIyQ29udGFjdEZpbHRlciA9IEJveDJELkR5bmFtaWNzLmIyQ29udGFjdEZpbHRlcixcbiAgICAgIGIyQ29udGFjdEltcHVsc2UgPSBCb3gyRC5EeW5hbWljcy5iMkNvbnRhY3RJbXB1bHNlLFxuICAgICAgYjJDb250YWN0TGlzdGVuZXIgPSBCb3gyRC5EeW5hbWljcy5iMkNvbnRhY3RMaXN0ZW5lcixcbiAgICAgIGIyQ29udGFjdE1hbmFnZXIgPSBCb3gyRC5EeW5hbWljcy5iMkNvbnRhY3RNYW5hZ2VyLFxuICAgICAgYjJEZWJ1Z0RyYXcgPSBCb3gyRC5EeW5hbWljcy5iMkRlYnVnRHJhdyxcbiAgICAgIGIyRGVzdHJ1Y3Rpb25MaXN0ZW5lciA9IEJveDJELkR5bmFtaWNzLmIyRGVzdHJ1Y3Rpb25MaXN0ZW5lcixcbiAgICAgIGIyRmlsdGVyRGF0YSA9IEJveDJELkR5bmFtaWNzLmIyRmlsdGVyRGF0YSxcbiAgICAgIGIyRml4dHVyZSA9IEJveDJELkR5bmFtaWNzLmIyRml4dHVyZSxcbiAgICAgIGIyRml4dHVyZURlZiA9IEJveDJELkR5bmFtaWNzLmIyRml4dHVyZURlZixcbiAgICAgIGIySXNsYW5kID0gQm94MkQuRHluYW1pY3MuYjJJc2xhbmQsXG4gICAgICBiMlRpbWVTdGVwID0gQm94MkQuRHluYW1pY3MuYjJUaW1lU3RlcCxcbiAgICAgIGIyV29ybGQgPSBCb3gyRC5EeW5hbWljcy5iMldvcmxkO1xuXG4gICBCb3gyRC5pbmhlcml0KGIyRGlzdGFuY2VKb2ludCwgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQpO1xuICAgYjJEaXN0YW5jZUpvaW50LnByb3RvdHlwZS5fX3N1cGVyID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQucHJvdG90eXBlO1xuICAgYjJEaXN0YW5jZUpvaW50LmIyRGlzdGFuY2VKb2ludCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LmIySm9pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIHRoaXMubV9sb2NhbEFuY2hvcjEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fbG9jYWxBbmNob3IyID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX3UgPSBuZXcgYjJWZWMyKCk7XG4gICB9O1xuICAgYjJEaXN0YW5jZUpvaW50LnByb3RvdHlwZS5HZXRBbmNob3JBID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5QS5HZXRXb3JsZFBvaW50KHRoaXMubV9sb2NhbEFuY2hvcjEpO1xuICAgfVxuICAgYjJEaXN0YW5jZUpvaW50LnByb3RvdHlwZS5HZXRBbmNob3JCID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5Qi5HZXRXb3JsZFBvaW50KHRoaXMubV9sb2NhbEFuY2hvcjIpO1xuICAgfVxuICAgYjJEaXN0YW5jZUpvaW50LnByb3RvdHlwZS5HZXRSZWFjdGlvbkZvcmNlID0gZnVuY3Rpb24gKGludl9kdCkge1xuICAgICAgaWYgKGludl9kdCA9PT0gdW5kZWZpbmVkKSBpbnZfZHQgPSAwO1xuICAgICAgcmV0dXJuIG5ldyBiMlZlYzIoaW52X2R0ICogdGhpcy5tX2ltcHVsc2UgKiB0aGlzLm1fdS54LCBpbnZfZHQgKiB0aGlzLm1faW1wdWxzZSAqIHRoaXMubV91LnkpO1xuICAgfVxuICAgYjJEaXN0YW5jZUpvaW50LnByb3RvdHlwZS5HZXRSZWFjdGlvblRvcnF1ZSA9IGZ1bmN0aW9uIChpbnZfZHQpIHtcbiAgICAgIGlmIChpbnZfZHQgPT09IHVuZGVmaW5lZCkgaW52X2R0ID0gMDtcbiAgICAgIHJldHVybiAwLjA7XG4gICB9XG4gICBiMkRpc3RhbmNlSm9pbnQucHJvdG90eXBlLkdldExlbmd0aCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fbGVuZ3RoO1xuICAgfVxuICAgYjJEaXN0YW5jZUpvaW50LnByb3RvdHlwZS5TZXRMZW5ndGggPSBmdW5jdGlvbiAobGVuZ3RoKSB7XG4gICAgICBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQpIGxlbmd0aCA9IDA7XG4gICAgICB0aGlzLm1fbGVuZ3RoID0gbGVuZ3RoO1xuICAgfVxuICAgYjJEaXN0YW5jZUpvaW50LnByb3RvdHlwZS5HZXRGcmVxdWVuY3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2ZyZXF1ZW5jeUh6O1xuICAgfVxuICAgYjJEaXN0YW5jZUpvaW50LnByb3RvdHlwZS5TZXRGcmVxdWVuY3kgPSBmdW5jdGlvbiAoaHopIHtcbiAgICAgIGlmIChoeiA9PT0gdW5kZWZpbmVkKSBoeiA9IDA7XG4gICAgICB0aGlzLm1fZnJlcXVlbmN5SHogPSBoejtcbiAgIH1cbiAgIGIyRGlzdGFuY2VKb2ludC5wcm90b3R5cGUuR2V0RGFtcGluZ1JhdGlvID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9kYW1waW5nUmF0aW87XG4gICB9XG4gICBiMkRpc3RhbmNlSm9pbnQucHJvdG90eXBlLlNldERhbXBpbmdSYXRpbyA9IGZ1bmN0aW9uIChyYXRpbykge1xuICAgICAgaWYgKHJhdGlvID09PSB1bmRlZmluZWQpIHJhdGlvID0gMDtcbiAgICAgIHRoaXMubV9kYW1waW5nUmF0aW8gPSByYXRpbztcbiAgIH1cbiAgIGIyRGlzdGFuY2VKb2ludC5wcm90b3R5cGUuYjJEaXN0YW5jZUpvaW50ID0gZnVuY3Rpb24gKGRlZikge1xuICAgICAgdGhpcy5fX3N1cGVyLmIySm9pbnQuY2FsbCh0aGlzLCBkZWYpO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB2YXIgdFggPSAwO1xuICAgICAgdmFyIHRZID0gMDtcbiAgICAgIHRoaXMubV9sb2NhbEFuY2hvcjEuU2V0VihkZWYubG9jYWxBbmNob3JBKTtcbiAgICAgIHRoaXMubV9sb2NhbEFuY2hvcjIuU2V0VihkZWYubG9jYWxBbmNob3JCKTtcbiAgICAgIHRoaXMubV9sZW5ndGggPSBkZWYubGVuZ3RoO1xuICAgICAgdGhpcy5tX2ZyZXF1ZW5jeUh6ID0gZGVmLmZyZXF1ZW5jeUh6O1xuICAgICAgdGhpcy5tX2RhbXBpbmdSYXRpbyA9IGRlZi5kYW1waW5nUmF0aW87XG4gICAgICB0aGlzLm1faW1wdWxzZSA9IDAuMDtcbiAgICAgIHRoaXMubV9nYW1tYSA9IDAuMDtcbiAgICAgIHRoaXMubV9iaWFzID0gMC4wO1xuICAgfVxuICAgYjJEaXN0YW5jZUpvaW50LnByb3RvdHlwZS5Jbml0VmVsb2NpdHlDb25zdHJhaW50cyA9IGZ1bmN0aW9uIChzdGVwKSB7XG4gICAgICB2YXIgdE1hdDtcbiAgICAgIHZhciB0WCA9IDA7XG4gICAgICB2YXIgYkEgPSB0aGlzLm1fYm9keUE7XG4gICAgICB2YXIgYkIgPSB0aGlzLm1fYm9keUI7XG4gICAgICB0TWF0ID0gYkEubV94Zi5SO1xuICAgICAgdmFyIHIxWCA9IHRoaXMubV9sb2NhbEFuY2hvcjEueCAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgIHZhciByMVkgPSB0aGlzLm1fbG9jYWxBbmNob3IxLnkgLSBiQS5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHIxWCArIHRNYXQuY29sMi54ICogcjFZKTtcbiAgICAgIHIxWSA9ICh0TWF0LmNvbDEueSAqIHIxWCArIHRNYXQuY29sMi55ICogcjFZKTtcbiAgICAgIHIxWCA9IHRYO1xuICAgICAgdE1hdCA9IGJCLm1feGYuUjtcbiAgICAgIHZhciByMlggPSB0aGlzLm1fbG9jYWxBbmNob3IyLnggLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLng7XG4gICAgICB2YXIgcjJZID0gdGhpcy5tX2xvY2FsQW5jaG9yMi55IC0gYkIubV9zd2VlcC5sb2NhbENlbnRlci55O1xuICAgICAgdFggPSAodE1hdC5jb2wxLnggKiByMlggKyB0TWF0LmNvbDIueCAqIHIyWSk7XG4gICAgICByMlkgPSAodE1hdC5jb2wxLnkgKiByMlggKyB0TWF0LmNvbDIueSAqIHIyWSk7XG4gICAgICByMlggPSB0WDtcbiAgICAgIHRoaXMubV91LnggPSBiQi5tX3N3ZWVwLmMueCArIHIyWCAtIGJBLm1fc3dlZXAuYy54IC0gcjFYO1xuICAgICAgdGhpcy5tX3UueSA9IGJCLm1fc3dlZXAuYy55ICsgcjJZIC0gYkEubV9zd2VlcC5jLnkgLSByMVk7XG4gICAgICB2YXIgbGVuZ3RoID0gTWF0aC5zcXJ0KHRoaXMubV91LnggKiB0aGlzLm1fdS54ICsgdGhpcy5tX3UueSAqIHRoaXMubV91LnkpO1xuICAgICAgaWYgKGxlbmd0aCA+IGIyU2V0dGluZ3MuYjJfbGluZWFyU2xvcCkge1xuICAgICAgICAgdGhpcy5tX3UuTXVsdGlwbHkoMS4wIC8gbGVuZ3RoKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdGhpcy5tX3UuU2V0WmVybygpO1xuICAgICAgfVxuICAgICAgdmFyIGNyMXUgPSAocjFYICogdGhpcy5tX3UueSAtIHIxWSAqIHRoaXMubV91LngpO1xuICAgICAgdmFyIGNyMnUgPSAocjJYICogdGhpcy5tX3UueSAtIHIyWSAqIHRoaXMubV91LngpO1xuICAgICAgdmFyIGludk1hc3MgPSBiQS5tX2ludk1hc3MgKyBiQS5tX2ludkkgKiBjcjF1ICogY3IxdSArIGJCLm1faW52TWFzcyArIGJCLm1faW52SSAqIGNyMnUgKiBjcjJ1O1xuICAgICAgdGhpcy5tX21hc3MgPSBpbnZNYXNzICE9IDAuMCA/IDEuMCAvIGludk1hc3MgOiAwLjA7XG4gICAgICBpZiAodGhpcy5tX2ZyZXF1ZW5jeUh6ID4gMC4wKSB7XG4gICAgICAgICB2YXIgQyA9IGxlbmd0aCAtIHRoaXMubV9sZW5ndGg7XG4gICAgICAgICB2YXIgb21lZ2EgPSAyLjAgKiBNYXRoLlBJICogdGhpcy5tX2ZyZXF1ZW5jeUh6O1xuICAgICAgICAgdmFyIGQgPSAyLjAgKiB0aGlzLm1fbWFzcyAqIHRoaXMubV9kYW1waW5nUmF0aW8gKiBvbWVnYTtcbiAgICAgICAgIHZhciBrID0gdGhpcy5tX21hc3MgKiBvbWVnYSAqIG9tZWdhO1xuICAgICAgICAgdGhpcy5tX2dhbW1hID0gc3RlcC5kdCAqIChkICsgc3RlcC5kdCAqIGspO1xuICAgICAgICAgdGhpcy5tX2dhbW1hID0gdGhpcy5tX2dhbW1hICE9IDAuMCA/IDEgLyB0aGlzLm1fZ2FtbWEgOiAwLjA7XG4gICAgICAgICB0aGlzLm1fYmlhcyA9IEMgKiBzdGVwLmR0ICogayAqIHRoaXMubV9nYW1tYTtcbiAgICAgICAgIHRoaXMubV9tYXNzID0gaW52TWFzcyArIHRoaXMubV9nYW1tYTtcbiAgICAgICAgIHRoaXMubV9tYXNzID0gdGhpcy5tX21hc3MgIT0gMC4wID8gMS4wIC8gdGhpcy5tX21hc3MgOiAwLjA7XG4gICAgICB9XG4gICAgICBpZiAoc3RlcC53YXJtU3RhcnRpbmcpIHtcbiAgICAgICAgIHRoaXMubV9pbXB1bHNlICo9IHN0ZXAuZHRSYXRpbztcbiAgICAgICAgIHZhciBQWCA9IHRoaXMubV9pbXB1bHNlICogdGhpcy5tX3UueDtcbiAgICAgICAgIHZhciBQWSA9IHRoaXMubV9pbXB1bHNlICogdGhpcy5tX3UueTtcbiAgICAgICAgIGJBLm1fbGluZWFyVmVsb2NpdHkueCAtPSBiQS5tX2ludk1hc3MgKiBQWDtcbiAgICAgICAgIGJBLm1fbGluZWFyVmVsb2NpdHkueSAtPSBiQS5tX2ludk1hc3MgKiBQWTtcbiAgICAgICAgIGJBLm1fYW5ndWxhclZlbG9jaXR5IC09IGJBLm1faW52SSAqIChyMVggKiBQWSAtIHIxWSAqIFBYKTtcbiAgICAgICAgIGJCLm1fbGluZWFyVmVsb2NpdHkueCArPSBiQi5tX2ludk1hc3MgKiBQWDtcbiAgICAgICAgIGJCLm1fbGluZWFyVmVsb2NpdHkueSArPSBiQi5tX2ludk1hc3MgKiBQWTtcbiAgICAgICAgIGJCLm1fYW5ndWxhclZlbG9jaXR5ICs9IGJCLm1faW52SSAqIChyMlggKiBQWSAtIHIyWSAqIFBYKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdGhpcy5tX2ltcHVsc2UgPSAwLjA7XG4gICAgICB9XG4gICB9XG4gICBiMkRpc3RhbmNlSm9pbnQucHJvdG90eXBlLlNvbHZlVmVsb2NpdHlDb25zdHJhaW50cyA9IGZ1bmN0aW9uIChzdGVwKSB7XG4gICAgICB2YXIgdE1hdDtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9ib2R5QTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHRNYXQgPSBiQS5tX3hmLlI7XG4gICAgICB2YXIgcjFYID0gdGhpcy5tX2xvY2FsQW5jaG9yMS54IC0gYkEubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgdmFyIHIxWSA9IHRoaXMubV9sb2NhbEFuY2hvcjEueSAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgIHZhciB0WCA9ICh0TWF0LmNvbDEueCAqIHIxWCArIHRNYXQuY29sMi54ICogcjFZKTtcbiAgICAgIHIxWSA9ICh0TWF0LmNvbDEueSAqIHIxWCArIHRNYXQuY29sMi55ICogcjFZKTtcbiAgICAgIHIxWCA9IHRYO1xuICAgICAgdE1hdCA9IGJCLm1feGYuUjtcbiAgICAgIHZhciByMlggPSB0aGlzLm1fbG9jYWxBbmNob3IyLnggLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLng7XG4gICAgICB2YXIgcjJZID0gdGhpcy5tX2xvY2FsQW5jaG9yMi55IC0gYkIubV9zd2VlcC5sb2NhbENlbnRlci55O1xuICAgICAgdFggPSAodE1hdC5jb2wxLnggKiByMlggKyB0TWF0LmNvbDIueCAqIHIyWSk7XG4gICAgICByMlkgPSAodE1hdC5jb2wxLnkgKiByMlggKyB0TWF0LmNvbDIueSAqIHIyWSk7XG4gICAgICByMlggPSB0WDtcbiAgICAgIHZhciB2MVggPSBiQS5tX2xpbmVhclZlbG9jaXR5LnggKyAoKC1iQS5tX2FuZ3VsYXJWZWxvY2l0eSAqIHIxWSkpO1xuICAgICAgdmFyIHYxWSA9IGJBLm1fbGluZWFyVmVsb2NpdHkueSArIChiQS5tX2FuZ3VsYXJWZWxvY2l0eSAqIHIxWCk7XG4gICAgICB2YXIgdjJYID0gYkIubV9saW5lYXJWZWxvY2l0eS54ICsgKCgtYkIubV9hbmd1bGFyVmVsb2NpdHkgKiByMlkpKTtcbiAgICAgIHZhciB2MlkgPSBiQi5tX2xpbmVhclZlbG9jaXR5LnkgKyAoYkIubV9hbmd1bGFyVmVsb2NpdHkgKiByMlgpO1xuICAgICAgdmFyIENkb3QgPSAodGhpcy5tX3UueCAqICh2MlggLSB2MVgpICsgdGhpcy5tX3UueSAqICh2MlkgLSB2MVkpKTtcbiAgICAgIHZhciBpbXB1bHNlID0gKC10aGlzLm1fbWFzcyAqIChDZG90ICsgdGhpcy5tX2JpYXMgKyB0aGlzLm1fZ2FtbWEgKiB0aGlzLm1faW1wdWxzZSkpO1xuICAgICAgdGhpcy5tX2ltcHVsc2UgKz0gaW1wdWxzZTtcbiAgICAgIHZhciBQWCA9IGltcHVsc2UgKiB0aGlzLm1fdS54O1xuICAgICAgdmFyIFBZID0gaW1wdWxzZSAqIHRoaXMubV91Lnk7XG4gICAgICBiQS5tX2xpbmVhclZlbG9jaXR5LnggLT0gYkEubV9pbnZNYXNzICogUFg7XG4gICAgICBiQS5tX2xpbmVhclZlbG9jaXR5LnkgLT0gYkEubV9pbnZNYXNzICogUFk7XG4gICAgICBiQS5tX2FuZ3VsYXJWZWxvY2l0eSAtPSBiQS5tX2ludkkgKiAocjFYICogUFkgLSByMVkgKiBQWCk7XG4gICAgICBiQi5tX2xpbmVhclZlbG9jaXR5LnggKz0gYkIubV9pbnZNYXNzICogUFg7XG4gICAgICBiQi5tX2xpbmVhclZlbG9jaXR5LnkgKz0gYkIubV9pbnZNYXNzICogUFk7XG4gICAgICBiQi5tX2FuZ3VsYXJWZWxvY2l0eSArPSBiQi5tX2ludkkgKiAocjJYICogUFkgLSByMlkgKiBQWCk7XG4gICB9XG4gICBiMkRpc3RhbmNlSm9pbnQucHJvdG90eXBlLlNvbHZlUG9zaXRpb25Db25zdHJhaW50cyA9IGZ1bmN0aW9uIChiYXVtZ2FydGUpIHtcbiAgICAgIGlmIChiYXVtZ2FydGUgPT09IHVuZGVmaW5lZCkgYmF1bWdhcnRlID0gMDtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgaWYgKHRoaXMubV9mcmVxdWVuY3lIeiA+IDAuMCkge1xuICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICB2YXIgYkEgPSB0aGlzLm1fYm9keUE7XG4gICAgICB2YXIgYkIgPSB0aGlzLm1fYm9keUI7XG4gICAgICB0TWF0ID0gYkEubV94Zi5SO1xuICAgICAgdmFyIHIxWCA9IHRoaXMubV9sb2NhbEFuY2hvcjEueCAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgIHZhciByMVkgPSB0aGlzLm1fbG9jYWxBbmNob3IxLnkgLSBiQS5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICB2YXIgdFggPSAodE1hdC5jb2wxLnggKiByMVggKyB0TWF0LmNvbDIueCAqIHIxWSk7XG4gICAgICByMVkgPSAodE1hdC5jb2wxLnkgKiByMVggKyB0TWF0LmNvbDIueSAqIHIxWSk7XG4gICAgICByMVggPSB0WDtcbiAgICAgIHRNYXQgPSBiQi5tX3hmLlI7XG4gICAgICB2YXIgcjJYID0gdGhpcy5tX2xvY2FsQW5jaG9yMi54IC0gYkIubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgdmFyIHIyWSA9IHRoaXMubV9sb2NhbEFuY2hvcjIueSAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgIHRYID0gKHRNYXQuY29sMS54ICogcjJYICsgdE1hdC5jb2wyLnggKiByMlkpO1xuICAgICAgcjJZID0gKHRNYXQuY29sMS55ICogcjJYICsgdE1hdC5jb2wyLnkgKiByMlkpO1xuICAgICAgcjJYID0gdFg7XG4gICAgICB2YXIgZFggPSBiQi5tX3N3ZWVwLmMueCArIHIyWCAtIGJBLm1fc3dlZXAuYy54IC0gcjFYO1xuICAgICAgdmFyIGRZID0gYkIubV9zd2VlcC5jLnkgKyByMlkgLSBiQS5tX3N3ZWVwLmMueSAtIHIxWTtcbiAgICAgIHZhciBsZW5ndGggPSBNYXRoLnNxcnQoZFggKiBkWCArIGRZICogZFkpO1xuICAgICAgZFggLz0gbGVuZ3RoO1xuICAgICAgZFkgLz0gbGVuZ3RoO1xuICAgICAgdmFyIEMgPSBsZW5ndGggLSB0aGlzLm1fbGVuZ3RoO1xuICAgICAgQyA9IGIyTWF0aC5DbGFtcChDLCAoLWIyU2V0dGluZ3MuYjJfbWF4TGluZWFyQ29ycmVjdGlvbiksIGIyU2V0dGluZ3MuYjJfbWF4TGluZWFyQ29ycmVjdGlvbik7XG4gICAgICB2YXIgaW1wdWxzZSA9ICgtdGhpcy5tX21hc3MgKiBDKTtcbiAgICAgIHRoaXMubV91LlNldChkWCwgZFkpO1xuICAgICAgdmFyIFBYID0gaW1wdWxzZSAqIHRoaXMubV91Lng7XG4gICAgICB2YXIgUFkgPSBpbXB1bHNlICogdGhpcy5tX3UueTtcbiAgICAgIGJBLm1fc3dlZXAuYy54IC09IGJBLm1faW52TWFzcyAqIFBYO1xuICAgICAgYkEubV9zd2VlcC5jLnkgLT0gYkEubV9pbnZNYXNzICogUFk7XG4gICAgICBiQS5tX3N3ZWVwLmEgLT0gYkEubV9pbnZJICogKHIxWCAqIFBZIC0gcjFZICogUFgpO1xuICAgICAgYkIubV9zd2VlcC5jLnggKz0gYkIubV9pbnZNYXNzICogUFg7XG4gICAgICBiQi5tX3N3ZWVwLmMueSArPSBiQi5tX2ludk1hc3MgKiBQWTtcbiAgICAgIGJCLm1fc3dlZXAuYSArPSBiQi5tX2ludkkgKiAocjJYICogUFkgLSByMlkgKiBQWCk7XG4gICAgICBiQS5TeW5jaHJvbml6ZVRyYW5zZm9ybSgpO1xuICAgICAgYkIuU3luY2hyb25pemVUcmFuc2Zvcm0oKTtcbiAgICAgIHJldHVybiBiMk1hdGguQWJzKEMpIDwgYjJTZXR0aW5ncy5iMl9saW5lYXJTbG9wO1xuICAgfVxuICAgQm94MkQuaW5oZXJpdChiMkRpc3RhbmNlSm9pbnREZWYsIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50RGVmKTtcbiAgIGIyRGlzdGFuY2VKb2ludERlZi5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50RGVmLnByb3RvdHlwZTtcbiAgIGIyRGlzdGFuY2VKb2ludERlZi5iMkRpc3RhbmNlSm9pbnREZWYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludERlZi5iMkpvaW50RGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubG9jYWxBbmNob3JCID0gbmV3IGIyVmVjMigpO1xuICAgfTtcbiAgIGIyRGlzdGFuY2VKb2ludERlZi5wcm90b3R5cGUuYjJEaXN0YW5jZUpvaW50RGVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fX3N1cGVyLmIySm9pbnREZWYuY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMudHlwZSA9IGIySm9pbnQuZV9kaXN0YW5jZUpvaW50O1xuICAgICAgdGhpcy5sZW5ndGggPSAxLjA7XG4gICAgICB0aGlzLmZyZXF1ZW5jeUh6ID0gMC4wO1xuICAgICAgdGhpcy5kYW1waW5nUmF0aW8gPSAwLjA7XG4gICB9XG4gICBiMkRpc3RhbmNlSm9pbnREZWYucHJvdG90eXBlLkluaXRpYWxpemUgPSBmdW5jdGlvbiAoYkEsIGJCLCBhbmNob3JBLCBhbmNob3JCKSB7XG4gICAgICB0aGlzLmJvZHlBID0gYkE7XG4gICAgICB0aGlzLmJvZHlCID0gYkI7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQS5TZXRWKHRoaXMuYm9keUEuR2V0TG9jYWxQb2ludChhbmNob3JBKSk7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQi5TZXRWKHRoaXMuYm9keUIuR2V0TG9jYWxQb2ludChhbmNob3JCKSk7XG4gICAgICB2YXIgZFggPSBhbmNob3JCLnggLSBhbmNob3JBLng7XG4gICAgICB2YXIgZFkgPSBhbmNob3JCLnkgLSBhbmNob3JBLnk7XG4gICAgICB0aGlzLmxlbmd0aCA9IE1hdGguc3FydChkWCAqIGRYICsgZFkgKiBkWSk7XG4gICAgICB0aGlzLmZyZXF1ZW5jeUh6ID0gMC4wO1xuICAgICAgdGhpcy5kYW1waW5nUmF0aW8gPSAwLjA7XG4gICB9XG4gICBCb3gyRC5pbmhlcml0KGIyRnJpY3Rpb25Kb2ludCwgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQpO1xuICAgYjJGcmljdGlvbkpvaW50LnByb3RvdHlwZS5fX3N1cGVyID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQucHJvdG90eXBlO1xuICAgYjJGcmljdGlvbkpvaW50LmIyRnJpY3Rpb25Kb2ludCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LmIySm9pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIHRoaXMubV9sb2NhbEFuY2hvckEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fbG9jYWxBbmNob3JCID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX2xpbmVhck1hc3MgPSBuZXcgYjJNYXQyMigpO1xuICAgICAgdGhpcy5tX2xpbmVhckltcHVsc2UgPSBuZXcgYjJWZWMyKCk7XG4gICB9O1xuICAgYjJGcmljdGlvbkpvaW50LnByb3RvdHlwZS5HZXRBbmNob3JBID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5QS5HZXRXb3JsZFBvaW50KHRoaXMubV9sb2NhbEFuY2hvckEpO1xuICAgfVxuICAgYjJGcmljdGlvbkpvaW50LnByb3RvdHlwZS5HZXRBbmNob3JCID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5Qi5HZXRXb3JsZFBvaW50KHRoaXMubV9sb2NhbEFuY2hvckIpO1xuICAgfVxuICAgYjJGcmljdGlvbkpvaW50LnByb3RvdHlwZS5HZXRSZWFjdGlvbkZvcmNlID0gZnVuY3Rpb24gKGludl9kdCkge1xuICAgICAgaWYgKGludl9kdCA9PT0gdW5kZWZpbmVkKSBpbnZfZHQgPSAwO1xuICAgICAgcmV0dXJuIG5ldyBiMlZlYzIoaW52X2R0ICogdGhpcy5tX2xpbmVhckltcHVsc2UueCwgaW52X2R0ICogdGhpcy5tX2xpbmVhckltcHVsc2UueSk7XG4gICB9XG4gICBiMkZyaWN0aW9uSm9pbnQucHJvdG90eXBlLkdldFJlYWN0aW9uVG9ycXVlID0gZnVuY3Rpb24gKGludl9kdCkge1xuICAgICAgaWYgKGludl9kdCA9PT0gdW5kZWZpbmVkKSBpbnZfZHQgPSAwO1xuICAgICAgcmV0dXJuIGludl9kdCAqIHRoaXMubV9hbmd1bGFySW1wdWxzZTtcbiAgIH1cbiAgIGIyRnJpY3Rpb25Kb2ludC5wcm90b3R5cGUuU2V0TWF4Rm9yY2UgPSBmdW5jdGlvbiAoZm9yY2UpIHtcbiAgICAgIGlmIChmb3JjZSA9PT0gdW5kZWZpbmVkKSBmb3JjZSA9IDA7XG4gICAgICB0aGlzLm1fbWF4Rm9yY2UgPSBmb3JjZTtcbiAgIH1cbiAgIGIyRnJpY3Rpb25Kb2ludC5wcm90b3R5cGUuR2V0TWF4Rm9yY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX21heEZvcmNlO1xuICAgfVxuICAgYjJGcmljdGlvbkpvaW50LnByb3RvdHlwZS5TZXRNYXhUb3JxdWUgPSBmdW5jdGlvbiAodG9ycXVlKSB7XG4gICAgICBpZiAodG9ycXVlID09PSB1bmRlZmluZWQpIHRvcnF1ZSA9IDA7XG4gICAgICB0aGlzLm1fbWF4VG9ycXVlID0gdG9ycXVlO1xuICAgfVxuICAgYjJGcmljdGlvbkpvaW50LnByb3RvdHlwZS5HZXRNYXhUb3JxdWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX21heFRvcnF1ZTtcbiAgIH1cbiAgIGIyRnJpY3Rpb25Kb2ludC5wcm90b3R5cGUuYjJGcmljdGlvbkpvaW50ID0gZnVuY3Rpb24gKGRlZikge1xuICAgICAgdGhpcy5fX3N1cGVyLmIySm9pbnQuY2FsbCh0aGlzLCBkZWYpO1xuICAgICAgdGhpcy5tX2xvY2FsQW5jaG9yQS5TZXRWKGRlZi5sb2NhbEFuY2hvckEpO1xuICAgICAgdGhpcy5tX2xvY2FsQW5jaG9yQi5TZXRWKGRlZi5sb2NhbEFuY2hvckIpO1xuICAgICAgdGhpcy5tX2xpbmVhck1hc3MuU2V0WmVybygpO1xuICAgICAgdGhpcy5tX2FuZ3VsYXJNYXNzID0gMC4wO1xuICAgICAgdGhpcy5tX2xpbmVhckltcHVsc2UuU2V0WmVybygpO1xuICAgICAgdGhpcy5tX2FuZ3VsYXJJbXB1bHNlID0gMC4wO1xuICAgICAgdGhpcy5tX21heEZvcmNlID0gZGVmLm1heEZvcmNlO1xuICAgICAgdGhpcy5tX21heFRvcnF1ZSA9IGRlZi5tYXhUb3JxdWU7XG4gICB9XG4gICBiMkZyaWN0aW9uSm9pbnQucHJvdG90eXBlLkluaXRWZWxvY2l0eUNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKHN0ZXApIHtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIHRYID0gMDtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9ib2R5QTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHRNYXQgPSBiQS5tX3hmLlI7XG4gICAgICB2YXIgckFYID0gdGhpcy5tX2xvY2FsQW5jaG9yQS54IC0gYkEubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgdmFyIHJBWSA9IHRoaXMubV9sb2NhbEFuY2hvckEueSAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgIHRYID0gKHRNYXQuY29sMS54ICogckFYICsgdE1hdC5jb2wyLnggKiByQVkpO1xuICAgICAgckFZID0gKHRNYXQuY29sMS55ICogckFYICsgdE1hdC5jb2wyLnkgKiByQVkpO1xuICAgICAgckFYID0gdFg7XG4gICAgICB0TWF0ID0gYkIubV94Zi5SO1xuICAgICAgdmFyIHJCWCA9IHRoaXMubV9sb2NhbEFuY2hvckIueCAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgIHZhciByQlkgPSB0aGlzLm1fbG9jYWxBbmNob3JCLnkgLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHJCWCArIHRNYXQuY29sMi54ICogckJZKTtcbiAgICAgIHJCWSA9ICh0TWF0LmNvbDEueSAqIHJCWCArIHRNYXQuY29sMi55ICogckJZKTtcbiAgICAgIHJCWCA9IHRYO1xuICAgICAgdmFyIG1BID0gYkEubV9pbnZNYXNzO1xuICAgICAgdmFyIG1CID0gYkIubV9pbnZNYXNzO1xuICAgICAgdmFyIGlBID0gYkEubV9pbnZJO1xuICAgICAgdmFyIGlCID0gYkIubV9pbnZJO1xuICAgICAgdmFyIEsgPSBuZXcgYjJNYXQyMigpO1xuICAgICAgSy5jb2wxLnggPSBtQSArIG1CO1xuICAgICAgSy5jb2wyLnggPSAwLjA7XG4gICAgICBLLmNvbDEueSA9IDAuMDtcbiAgICAgIEsuY29sMi55ID0gbUEgKyBtQjtcbiAgICAgIEsuY29sMS54ICs9IGlBICogckFZICogckFZO1xuICAgICAgSy5jb2wyLnggKz0gKC1pQSAqIHJBWCAqIHJBWSk7XG4gICAgICBLLmNvbDEueSArPSAoLWlBICogckFYICogckFZKTtcbiAgICAgIEsuY29sMi55ICs9IGlBICogckFYICogckFYO1xuICAgICAgSy5jb2wxLnggKz0gaUIgKiByQlkgKiByQlk7XG4gICAgICBLLmNvbDIueCArPSAoLWlCICogckJYICogckJZKTtcbiAgICAgIEsuY29sMS55ICs9ICgtaUIgKiByQlggKiByQlkpO1xuICAgICAgSy5jb2wyLnkgKz0gaUIgKiByQlggKiByQlg7XG4gICAgICBLLkdldEludmVyc2UodGhpcy5tX2xpbmVhck1hc3MpO1xuICAgICAgdGhpcy5tX2FuZ3VsYXJNYXNzID0gaUEgKyBpQjtcbiAgICAgIGlmICh0aGlzLm1fYW5ndWxhck1hc3MgPiAwLjApIHtcbiAgICAgICAgIHRoaXMubV9hbmd1bGFyTWFzcyA9IDEuMCAvIHRoaXMubV9hbmd1bGFyTWFzcztcbiAgICAgIH1cbiAgICAgIGlmIChzdGVwLndhcm1TdGFydGluZykge1xuICAgICAgICAgdGhpcy5tX2xpbmVhckltcHVsc2UueCAqPSBzdGVwLmR0UmF0aW87XG4gICAgICAgICB0aGlzLm1fbGluZWFySW1wdWxzZS55ICo9IHN0ZXAuZHRSYXRpbztcbiAgICAgICAgIHRoaXMubV9hbmd1bGFySW1wdWxzZSAqPSBzdGVwLmR0UmF0aW87XG4gICAgICAgICB2YXIgUCA9IHRoaXMubV9saW5lYXJJbXB1bHNlO1xuICAgICAgICAgYkEubV9saW5lYXJWZWxvY2l0eS54IC09IG1BICogUC54O1xuICAgICAgICAgYkEubV9saW5lYXJWZWxvY2l0eS55IC09IG1BICogUC55O1xuICAgICAgICAgYkEubV9hbmd1bGFyVmVsb2NpdHkgLT0gaUEgKiAockFYICogUC55IC0gckFZICogUC54ICsgdGhpcy5tX2FuZ3VsYXJJbXB1bHNlKTtcbiAgICAgICAgIGJCLm1fbGluZWFyVmVsb2NpdHkueCArPSBtQiAqIFAueDtcbiAgICAgICAgIGJCLm1fbGluZWFyVmVsb2NpdHkueSArPSBtQiAqIFAueTtcbiAgICAgICAgIGJCLm1fYW5ndWxhclZlbG9jaXR5ICs9IGlCICogKHJCWCAqIFAueSAtIHJCWSAqIFAueCArIHRoaXMubV9hbmd1bGFySW1wdWxzZSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV9saW5lYXJJbXB1bHNlLlNldFplcm8oKTtcbiAgICAgICAgIHRoaXMubV9hbmd1bGFySW1wdWxzZSA9IDAuMDtcbiAgICAgIH1cbiAgIH1cbiAgIGIyRnJpY3Rpb25Kb2ludC5wcm90b3R5cGUuU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKHN0ZXApIHtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIHRYID0gMDtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9ib2R5QTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHZhciB2QSA9IGJBLm1fbGluZWFyVmVsb2NpdHk7XG4gICAgICB2YXIgd0EgPSBiQS5tX2FuZ3VsYXJWZWxvY2l0eTtcbiAgICAgIHZhciB2QiA9IGJCLm1fbGluZWFyVmVsb2NpdHk7XG4gICAgICB2YXIgd0IgPSBiQi5tX2FuZ3VsYXJWZWxvY2l0eTtcbiAgICAgIHZhciBtQSA9IGJBLm1faW52TWFzcztcbiAgICAgIHZhciBtQiA9IGJCLm1faW52TWFzcztcbiAgICAgIHZhciBpQSA9IGJBLm1faW52STtcbiAgICAgIHZhciBpQiA9IGJCLm1faW52STtcbiAgICAgIHRNYXQgPSBiQS5tX3hmLlI7XG4gICAgICB2YXIgckFYID0gdGhpcy5tX2xvY2FsQW5jaG9yQS54IC0gYkEubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgdmFyIHJBWSA9IHRoaXMubV9sb2NhbEFuY2hvckEueSAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgIHRYID0gKHRNYXQuY29sMS54ICogckFYICsgdE1hdC5jb2wyLnggKiByQVkpO1xuICAgICAgckFZID0gKHRNYXQuY29sMS55ICogckFYICsgdE1hdC5jb2wyLnkgKiByQVkpO1xuICAgICAgckFYID0gdFg7XG4gICAgICB0TWF0ID0gYkIubV94Zi5SO1xuICAgICAgdmFyIHJCWCA9IHRoaXMubV9sb2NhbEFuY2hvckIueCAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgIHZhciByQlkgPSB0aGlzLm1fbG9jYWxBbmNob3JCLnkgLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHJCWCArIHRNYXQuY29sMi54ICogckJZKTtcbiAgICAgIHJCWSA9ICh0TWF0LmNvbDEueSAqIHJCWCArIHRNYXQuY29sMi55ICogckJZKTtcbiAgICAgIHJCWCA9IHRYO1xuICAgICAgdmFyIG1heEltcHVsc2UgPSAwOyB7XG4gICAgICAgICB2YXIgQ2RvdCA9IHdCIC0gd0E7XG4gICAgICAgICB2YXIgaW1wdWxzZSA9ICgtdGhpcy5tX2FuZ3VsYXJNYXNzICogQ2RvdCk7XG4gICAgICAgICB2YXIgb2xkSW1wdWxzZSA9IHRoaXMubV9hbmd1bGFySW1wdWxzZTtcbiAgICAgICAgIG1heEltcHVsc2UgPSBzdGVwLmR0ICogdGhpcy5tX21heFRvcnF1ZTtcbiAgICAgICAgIHRoaXMubV9hbmd1bGFySW1wdWxzZSA9IGIyTWF0aC5DbGFtcCh0aGlzLm1fYW5ndWxhckltcHVsc2UgKyBpbXB1bHNlLCAoLW1heEltcHVsc2UpLCBtYXhJbXB1bHNlKTtcbiAgICAgICAgIGltcHVsc2UgPSB0aGlzLm1fYW5ndWxhckltcHVsc2UgLSBvbGRJbXB1bHNlO1xuICAgICAgICAgd0EgLT0gaUEgKiBpbXB1bHNlO1xuICAgICAgICAgd0IgKz0gaUIgKiBpbXB1bHNlO1xuICAgICAgfSB7XG4gICAgICAgICB2YXIgQ2RvdFggPSB2Qi54IC0gd0IgKiByQlkgLSB2QS54ICsgd0EgKiByQVk7XG4gICAgICAgICB2YXIgQ2RvdFkgPSB2Qi55ICsgd0IgKiByQlggLSB2QS55IC0gd0EgKiByQVg7XG4gICAgICAgICB2YXIgaW1wdWxzZVYgPSBiMk1hdGguTXVsTVYodGhpcy5tX2xpbmVhck1hc3MsIG5ldyBiMlZlYzIoKC1DZG90WCksICgtQ2RvdFkpKSk7XG4gICAgICAgICB2YXIgb2xkSW1wdWxzZVYgPSB0aGlzLm1fbGluZWFySW1wdWxzZS5Db3B5KCk7XG4gICAgICAgICB0aGlzLm1fbGluZWFySW1wdWxzZS5BZGQoaW1wdWxzZVYpO1xuICAgICAgICAgbWF4SW1wdWxzZSA9IHN0ZXAuZHQgKiB0aGlzLm1fbWF4Rm9yY2U7XG4gICAgICAgICBpZiAodGhpcy5tX2xpbmVhckltcHVsc2UuTGVuZ3RoU3F1YXJlZCgpID4gbWF4SW1wdWxzZSAqIG1heEltcHVsc2UpIHtcbiAgICAgICAgICAgIHRoaXMubV9saW5lYXJJbXB1bHNlLk5vcm1hbGl6ZSgpO1xuICAgICAgICAgICAgdGhpcy5tX2xpbmVhckltcHVsc2UuTXVsdGlwbHkobWF4SW1wdWxzZSk7XG4gICAgICAgICB9XG4gICAgICAgICBpbXB1bHNlViA9IGIyTWF0aC5TdWJ0cmFjdFZWKHRoaXMubV9saW5lYXJJbXB1bHNlLCBvbGRJbXB1bHNlVik7XG4gICAgICAgICB2QS54IC09IG1BICogaW1wdWxzZVYueDtcbiAgICAgICAgIHZBLnkgLT0gbUEgKiBpbXB1bHNlVi55O1xuICAgICAgICAgd0EgLT0gaUEgKiAockFYICogaW1wdWxzZVYueSAtIHJBWSAqIGltcHVsc2VWLngpO1xuICAgICAgICAgdkIueCArPSBtQiAqIGltcHVsc2VWLng7XG4gICAgICAgICB2Qi55ICs9IG1CICogaW1wdWxzZVYueTtcbiAgICAgICAgIHdCICs9IGlCICogKHJCWCAqIGltcHVsc2VWLnkgLSByQlkgKiBpbXB1bHNlVi54KTtcbiAgICAgIH1cbiAgICAgIGJBLm1fYW5ndWxhclZlbG9jaXR5ID0gd0E7XG4gICAgICBiQi5tX2FuZ3VsYXJWZWxvY2l0eSA9IHdCO1xuICAgfVxuICAgYjJGcmljdGlvbkpvaW50LnByb3RvdHlwZS5Tb2x2ZVBvc2l0aW9uQ29uc3RyYWludHMgPSBmdW5jdGlvbiAoYmF1bWdhcnRlKSB7XG4gICAgICBpZiAoYmF1bWdhcnRlID09PSB1bmRlZmluZWQpIGJhdW1nYXJ0ZSA9IDA7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgIH1cbiAgIEJveDJELmluaGVyaXQoYjJGcmljdGlvbkpvaW50RGVmLCBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludERlZik7XG4gICBiMkZyaWN0aW9uSm9pbnREZWYucHJvdG90eXBlLl9fc3VwZXIgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludERlZi5wcm90b3R5cGU7XG4gICBiMkZyaWN0aW9uSm9pbnREZWYuYjJGcmljdGlvbkpvaW50RGVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnREZWYuYjJKb2ludERlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgdGhpcy5sb2NhbEFuY2hvckEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQiA9IG5ldyBiMlZlYzIoKTtcbiAgIH07XG4gICBiMkZyaWN0aW9uSm9pbnREZWYucHJvdG90eXBlLmIyRnJpY3Rpb25Kb2ludERlZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX19zdXBlci5iMkpvaW50RGVmLmNhbGwodGhpcyk7XG4gICAgICB0aGlzLnR5cGUgPSBiMkpvaW50LmVfZnJpY3Rpb25Kb2ludDtcbiAgICAgIHRoaXMubWF4Rm9yY2UgPSAwLjA7XG4gICAgICB0aGlzLm1heFRvcnF1ZSA9IDAuMDtcbiAgIH1cbiAgIGIyRnJpY3Rpb25Kb2ludERlZi5wcm90b3R5cGUuSW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChiQSwgYkIsIGFuY2hvcikge1xuICAgICAgdGhpcy5ib2R5QSA9IGJBO1xuICAgICAgdGhpcy5ib2R5QiA9IGJCO1xuICAgICAgdGhpcy5sb2NhbEFuY2hvckEuU2V0Vih0aGlzLmJvZHlBLkdldExvY2FsUG9pbnQoYW5jaG9yKSk7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQi5TZXRWKHRoaXMuYm9keUIuR2V0TG9jYWxQb2ludChhbmNob3IpKTtcbiAgIH1cbiAgIEJveDJELmluaGVyaXQoYjJHZWFySm9pbnQsIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50KTtcbiAgIGIyR2VhckpvaW50LnByb3RvdHlwZS5fX3N1cGVyID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQucHJvdG90eXBlO1xuICAgYjJHZWFySm9pbnQuYjJHZWFySm9pbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludC5iMkpvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLm1fZ3JvdW5kQW5jaG9yMSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9ncm91bmRBbmNob3IyID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX2xvY2FsQW5jaG9yMSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9sb2NhbEFuY2hvcjIgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fSiA9IG5ldyBiMkphY29iaWFuKCk7XG4gICB9O1xuICAgYjJHZWFySm9pbnQucHJvdG90eXBlLkdldEFuY2hvckEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2JvZHlBLkdldFdvcmxkUG9pbnQodGhpcy5tX2xvY2FsQW5jaG9yMSk7XG4gICB9XG4gICBiMkdlYXJKb2ludC5wcm90b3R5cGUuR2V0QW5jaG9yQiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fYm9keUIuR2V0V29ybGRQb2ludCh0aGlzLm1fbG9jYWxBbmNob3IyKTtcbiAgIH1cbiAgIGIyR2VhckpvaW50LnByb3RvdHlwZS5HZXRSZWFjdGlvbkZvcmNlID0gZnVuY3Rpb24gKGludl9kdCkge1xuICAgICAgaWYgKGludl9kdCA9PT0gdW5kZWZpbmVkKSBpbnZfZHQgPSAwO1xuICAgICAgcmV0dXJuIG5ldyBiMlZlYzIoaW52X2R0ICogdGhpcy5tX2ltcHVsc2UgKiB0aGlzLm1fSi5saW5lYXJCLngsIGludl9kdCAqIHRoaXMubV9pbXB1bHNlICogdGhpcy5tX0oubGluZWFyQi55KTtcbiAgIH1cbiAgIGIyR2VhckpvaW50LnByb3RvdHlwZS5HZXRSZWFjdGlvblRvcnF1ZSA9IGZ1bmN0aW9uIChpbnZfZHQpIHtcbiAgICAgIGlmIChpbnZfZHQgPT09IHVuZGVmaW5lZCkgaW52X2R0ID0gMDtcbiAgICAgIHZhciB0TWF0ID0gdGhpcy5tX2JvZHlCLm1feGYuUjtcbiAgICAgIHZhciByWCA9IHRoaXMubV9sb2NhbEFuY2hvcjEueCAtIHRoaXMubV9ib2R5Qi5tX3N3ZWVwLmxvY2FsQ2VudGVyLng7XG4gICAgICB2YXIgclkgPSB0aGlzLm1fbG9jYWxBbmNob3IxLnkgLSB0aGlzLm1fYm9keUIubV9zd2VlcC5sb2NhbENlbnRlci55O1xuICAgICAgdmFyIHRYID0gdE1hdC5jb2wxLnggKiByWCArIHRNYXQuY29sMi54ICogclk7XG4gICAgICByWSA9IHRNYXQuY29sMS55ICogclggKyB0TWF0LmNvbDIueSAqIHJZO1xuICAgICAgclggPSB0WDtcbiAgICAgIHZhciBQWCA9IHRoaXMubV9pbXB1bHNlICogdGhpcy5tX0oubGluZWFyQi54O1xuICAgICAgdmFyIFBZID0gdGhpcy5tX2ltcHVsc2UgKiB0aGlzLm1fSi5saW5lYXJCLnk7XG4gICAgICByZXR1cm4gaW52X2R0ICogKHRoaXMubV9pbXB1bHNlICogdGhpcy5tX0ouYW5ndWxhckIgLSByWCAqIFBZICsgclkgKiBQWCk7XG4gICB9XG4gICBiMkdlYXJKb2ludC5wcm90b3R5cGUuR2V0UmF0aW8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3JhdGlvO1xuICAgfVxuICAgYjJHZWFySm9pbnQucHJvdG90eXBlLlNldFJhdGlvID0gZnVuY3Rpb24gKHJhdGlvKSB7XG4gICAgICBpZiAocmF0aW8gPT09IHVuZGVmaW5lZCkgcmF0aW8gPSAwO1xuICAgICAgdGhpcy5tX3JhdGlvID0gcmF0aW87XG4gICB9XG4gICBiMkdlYXJKb2ludC5wcm90b3R5cGUuYjJHZWFySm9pbnQgPSBmdW5jdGlvbiAoZGVmKSB7XG4gICAgICB0aGlzLl9fc3VwZXIuYjJKb2ludC5jYWxsKHRoaXMsIGRlZik7XG4gICAgICB2YXIgdHlwZTEgPSBwYXJzZUludChkZWYuam9pbnQxLm1fdHlwZSk7XG4gICAgICB2YXIgdHlwZTIgPSBwYXJzZUludChkZWYuam9pbnQyLm1fdHlwZSk7XG4gICAgICB0aGlzLm1fcmV2b2x1dGUxID0gbnVsbDtcbiAgICAgIHRoaXMubV9wcmlzbWF0aWMxID0gbnVsbDtcbiAgICAgIHRoaXMubV9yZXZvbHV0ZTIgPSBudWxsO1xuICAgICAgdGhpcy5tX3ByaXNtYXRpYzIgPSBudWxsO1xuICAgICAgdmFyIGNvb3JkaW5hdGUxID0gMDtcbiAgICAgIHZhciBjb29yZGluYXRlMiA9IDA7XG4gICAgICB0aGlzLm1fZ3JvdW5kMSA9IGRlZi5qb2ludDEuR2V0Qm9keUEoKTtcbiAgICAgIHRoaXMubV9ib2R5QSA9IGRlZi5qb2ludDEuR2V0Qm9keUIoKTtcbiAgICAgIGlmICh0eXBlMSA9PSBiMkpvaW50LmVfcmV2b2x1dGVKb2ludCkge1xuICAgICAgICAgdGhpcy5tX3Jldm9sdXRlMSA9IChkZWYuam9pbnQxIGluc3RhbmNlb2YgYjJSZXZvbHV0ZUpvaW50ID8gZGVmLmpvaW50MSA6IG51bGwpO1xuICAgICAgICAgdGhpcy5tX2dyb3VuZEFuY2hvcjEuU2V0Vih0aGlzLm1fcmV2b2x1dGUxLm1fbG9jYWxBbmNob3IxKTtcbiAgICAgICAgIHRoaXMubV9sb2NhbEFuY2hvcjEuU2V0Vih0aGlzLm1fcmV2b2x1dGUxLm1fbG9jYWxBbmNob3IyKTtcbiAgICAgICAgIGNvb3JkaW5hdGUxID0gdGhpcy5tX3Jldm9sdXRlMS5HZXRKb2ludEFuZ2xlKCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV9wcmlzbWF0aWMxID0gKGRlZi5qb2ludDEgaW5zdGFuY2VvZiBiMlByaXNtYXRpY0pvaW50ID8gZGVmLmpvaW50MSA6IG51bGwpO1xuICAgICAgICAgdGhpcy5tX2dyb3VuZEFuY2hvcjEuU2V0Vih0aGlzLm1fcHJpc21hdGljMS5tX2xvY2FsQW5jaG9yMSk7XG4gICAgICAgICB0aGlzLm1fbG9jYWxBbmNob3IxLlNldFYodGhpcy5tX3ByaXNtYXRpYzEubV9sb2NhbEFuY2hvcjIpO1xuICAgICAgICAgY29vcmRpbmF0ZTEgPSB0aGlzLm1fcHJpc21hdGljMS5HZXRKb2ludFRyYW5zbGF0aW9uKCk7XG4gICAgICB9XG4gICAgICB0aGlzLm1fZ3JvdW5kMiA9IGRlZi5qb2ludDIuR2V0Qm9keUEoKTtcbiAgICAgIHRoaXMubV9ib2R5QiA9IGRlZi5qb2ludDIuR2V0Qm9keUIoKTtcbiAgICAgIGlmICh0eXBlMiA9PSBiMkpvaW50LmVfcmV2b2x1dGVKb2ludCkge1xuICAgICAgICAgdGhpcy5tX3Jldm9sdXRlMiA9IChkZWYuam9pbnQyIGluc3RhbmNlb2YgYjJSZXZvbHV0ZUpvaW50ID8gZGVmLmpvaW50MiA6IG51bGwpO1xuICAgICAgICAgdGhpcy5tX2dyb3VuZEFuY2hvcjIuU2V0Vih0aGlzLm1fcmV2b2x1dGUyLm1fbG9jYWxBbmNob3IxKTtcbiAgICAgICAgIHRoaXMubV9sb2NhbEFuY2hvcjIuU2V0Vih0aGlzLm1fcmV2b2x1dGUyLm1fbG9jYWxBbmNob3IyKTtcbiAgICAgICAgIGNvb3JkaW5hdGUyID0gdGhpcy5tX3Jldm9sdXRlMi5HZXRKb2ludEFuZ2xlKCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV9wcmlzbWF0aWMyID0gKGRlZi5qb2ludDIgaW5zdGFuY2VvZiBiMlByaXNtYXRpY0pvaW50ID8gZGVmLmpvaW50MiA6IG51bGwpO1xuICAgICAgICAgdGhpcy5tX2dyb3VuZEFuY2hvcjIuU2V0Vih0aGlzLm1fcHJpc21hdGljMi5tX2xvY2FsQW5jaG9yMSk7XG4gICAgICAgICB0aGlzLm1fbG9jYWxBbmNob3IyLlNldFYodGhpcy5tX3ByaXNtYXRpYzIubV9sb2NhbEFuY2hvcjIpO1xuICAgICAgICAgY29vcmRpbmF0ZTIgPSB0aGlzLm1fcHJpc21hdGljMi5HZXRKb2ludFRyYW5zbGF0aW9uKCk7XG4gICAgICB9XG4gICAgICB0aGlzLm1fcmF0aW8gPSBkZWYucmF0aW87XG4gICAgICB0aGlzLm1fY29uc3RhbnQgPSBjb29yZGluYXRlMSArIHRoaXMubV9yYXRpbyAqIGNvb3JkaW5hdGUyO1xuICAgICAgdGhpcy5tX2ltcHVsc2UgPSAwLjA7XG4gICB9XG4gICBiMkdlYXJKb2ludC5wcm90b3R5cGUuSW5pdFZlbG9jaXR5Q29uc3RyYWludHMgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgdmFyIGcxID0gdGhpcy5tX2dyb3VuZDE7XG4gICAgICB2YXIgZzIgPSB0aGlzLm1fZ3JvdW5kMjtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9ib2R5QTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHZhciB1Z1ggPSAwO1xuICAgICAgdmFyIHVnWSA9IDA7XG4gICAgICB2YXIgclggPSAwO1xuICAgICAgdmFyIHJZID0gMDtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIHRWZWM7XG4gICAgICB2YXIgY3J1ZyA9IDA7XG4gICAgICB2YXIgdFggPSAwO1xuICAgICAgdmFyIEsgPSAwLjA7XG4gICAgICB0aGlzLm1fSi5TZXRaZXJvKCk7XG4gICAgICBpZiAodGhpcy5tX3Jldm9sdXRlMSkge1xuICAgICAgICAgdGhpcy5tX0ouYW5ndWxhckEgPSAoLTEuMCk7XG4gICAgICAgICBLICs9IGJBLm1faW52STtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdE1hdCA9IGcxLm1feGYuUjtcbiAgICAgICAgIHRWZWMgPSB0aGlzLm1fcHJpc21hdGljMS5tX2xvY2FsWEF4aXMxO1xuICAgICAgICAgdWdYID0gdE1hdC5jb2wxLnggKiB0VmVjLnggKyB0TWF0LmNvbDIueCAqIHRWZWMueTtcbiAgICAgICAgIHVnWSA9IHRNYXQuY29sMS55ICogdFZlYy54ICsgdE1hdC5jb2wyLnkgKiB0VmVjLnk7XG4gICAgICAgICB0TWF0ID0gYkEubV94Zi5SO1xuICAgICAgICAgclggPSB0aGlzLm1fbG9jYWxBbmNob3IxLnggLSBiQS5tX3N3ZWVwLmxvY2FsQ2VudGVyLng7XG4gICAgICAgICByWSA9IHRoaXMubV9sb2NhbEFuY2hvcjEueSAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgICAgIHRYID0gdE1hdC5jb2wxLnggKiByWCArIHRNYXQuY29sMi54ICogclk7XG4gICAgICAgICByWSA9IHRNYXQuY29sMS55ICogclggKyB0TWF0LmNvbDIueSAqIHJZO1xuICAgICAgICAgclggPSB0WDtcbiAgICAgICAgIGNydWcgPSByWCAqIHVnWSAtIHJZICogdWdYO1xuICAgICAgICAgdGhpcy5tX0oubGluZWFyQS5TZXQoKC11Z1gpLCAoLXVnWSkpO1xuICAgICAgICAgdGhpcy5tX0ouYW5ndWxhckEgPSAoLWNydWcpO1xuICAgICAgICAgSyArPSBiQS5tX2ludk1hc3MgKyBiQS5tX2ludkkgKiBjcnVnICogY3J1ZztcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm1fcmV2b2x1dGUyKSB7XG4gICAgICAgICB0aGlzLm1fSi5hbmd1bGFyQiA9ICgtdGhpcy5tX3JhdGlvKTtcbiAgICAgICAgIEsgKz0gdGhpcy5tX3JhdGlvICogdGhpcy5tX3JhdGlvICogYkIubV9pbnZJO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICB0TWF0ID0gZzIubV94Zi5SO1xuICAgICAgICAgdFZlYyA9IHRoaXMubV9wcmlzbWF0aWMyLm1fbG9jYWxYQXhpczE7XG4gICAgICAgICB1Z1ggPSB0TWF0LmNvbDEueCAqIHRWZWMueCArIHRNYXQuY29sMi54ICogdFZlYy55O1xuICAgICAgICAgdWdZID0gdE1hdC5jb2wxLnkgKiB0VmVjLnggKyB0TWF0LmNvbDIueSAqIHRWZWMueTtcbiAgICAgICAgIHRNYXQgPSBiQi5tX3hmLlI7XG4gICAgICAgICByWCA9IHRoaXMubV9sb2NhbEFuY2hvcjIueCAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgICAgIHJZID0gdGhpcy5tX2xvY2FsQW5jaG9yMi55IC0gYkIubV9zd2VlcC5sb2NhbENlbnRlci55O1xuICAgICAgICAgdFggPSB0TWF0LmNvbDEueCAqIHJYICsgdE1hdC5jb2wyLnggKiByWTtcbiAgICAgICAgIHJZID0gdE1hdC5jb2wxLnkgKiByWCArIHRNYXQuY29sMi55ICogclk7XG4gICAgICAgICByWCA9IHRYO1xuICAgICAgICAgY3J1ZyA9IHJYICogdWdZIC0gclkgKiB1Z1g7XG4gICAgICAgICB0aGlzLm1fSi5saW5lYXJCLlNldCgoLXRoaXMubV9yYXRpbyAqIHVnWCksICgtdGhpcy5tX3JhdGlvICogdWdZKSk7XG4gICAgICAgICB0aGlzLm1fSi5hbmd1bGFyQiA9ICgtdGhpcy5tX3JhdGlvICogY3J1Zyk7XG4gICAgICAgICBLICs9IHRoaXMubV9yYXRpbyAqIHRoaXMubV9yYXRpbyAqIChiQi5tX2ludk1hc3MgKyBiQi5tX2ludkkgKiBjcnVnICogY3J1Zyk7XG4gICAgICB9XG4gICAgICB0aGlzLm1fbWFzcyA9IEsgPiAwLjAgPyAxLjAgLyBLIDogMC4wO1xuICAgICAgaWYgKHN0ZXAud2FybVN0YXJ0aW5nKSB7XG4gICAgICAgICBiQS5tX2xpbmVhclZlbG9jaXR5LnggKz0gYkEubV9pbnZNYXNzICogdGhpcy5tX2ltcHVsc2UgKiB0aGlzLm1fSi5saW5lYXJBLng7XG4gICAgICAgICBiQS5tX2xpbmVhclZlbG9jaXR5LnkgKz0gYkEubV9pbnZNYXNzICogdGhpcy5tX2ltcHVsc2UgKiB0aGlzLm1fSi5saW5lYXJBLnk7XG4gICAgICAgICBiQS5tX2FuZ3VsYXJWZWxvY2l0eSArPSBiQS5tX2ludkkgKiB0aGlzLm1faW1wdWxzZSAqIHRoaXMubV9KLmFuZ3VsYXJBO1xuICAgICAgICAgYkIubV9saW5lYXJWZWxvY2l0eS54ICs9IGJCLm1faW52TWFzcyAqIHRoaXMubV9pbXB1bHNlICogdGhpcy5tX0oubGluZWFyQi54O1xuICAgICAgICAgYkIubV9saW5lYXJWZWxvY2l0eS55ICs9IGJCLm1faW52TWFzcyAqIHRoaXMubV9pbXB1bHNlICogdGhpcy5tX0oubGluZWFyQi55O1xuICAgICAgICAgYkIubV9hbmd1bGFyVmVsb2NpdHkgKz0gYkIubV9pbnZJICogdGhpcy5tX2ltcHVsc2UgKiB0aGlzLm1fSi5hbmd1bGFyQjtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdGhpcy5tX2ltcHVsc2UgPSAwLjA7XG4gICAgICB9XG4gICB9XG4gICBiMkdlYXJKb2ludC5wcm90b3R5cGUuU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKHN0ZXApIHtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9ib2R5QTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHZhciBDZG90ID0gdGhpcy5tX0ouQ29tcHV0ZShiQS5tX2xpbmVhclZlbG9jaXR5LCBiQS5tX2FuZ3VsYXJWZWxvY2l0eSwgYkIubV9saW5lYXJWZWxvY2l0eSwgYkIubV9hbmd1bGFyVmVsb2NpdHkpO1xuICAgICAgdmFyIGltcHVsc2UgPSAoLXRoaXMubV9tYXNzICogQ2RvdCk7XG4gICAgICB0aGlzLm1faW1wdWxzZSArPSBpbXB1bHNlO1xuICAgICAgYkEubV9saW5lYXJWZWxvY2l0eS54ICs9IGJBLm1faW52TWFzcyAqIGltcHVsc2UgKiB0aGlzLm1fSi5saW5lYXJBLng7XG4gICAgICBiQS5tX2xpbmVhclZlbG9jaXR5LnkgKz0gYkEubV9pbnZNYXNzICogaW1wdWxzZSAqIHRoaXMubV9KLmxpbmVhckEueTtcbiAgICAgIGJBLm1fYW5ndWxhclZlbG9jaXR5ICs9IGJBLm1faW52SSAqIGltcHVsc2UgKiB0aGlzLm1fSi5hbmd1bGFyQTtcbiAgICAgIGJCLm1fbGluZWFyVmVsb2NpdHkueCArPSBiQi5tX2ludk1hc3MgKiBpbXB1bHNlICogdGhpcy5tX0oubGluZWFyQi54O1xuICAgICAgYkIubV9saW5lYXJWZWxvY2l0eS55ICs9IGJCLm1faW52TWFzcyAqIGltcHVsc2UgKiB0aGlzLm1fSi5saW5lYXJCLnk7XG4gICAgICBiQi5tX2FuZ3VsYXJWZWxvY2l0eSArPSBiQi5tX2ludkkgKiBpbXB1bHNlICogdGhpcy5tX0ouYW5ndWxhckI7XG4gICB9XG4gICBiMkdlYXJKb2ludC5wcm90b3R5cGUuU29sdmVQb3NpdGlvbkNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKGJhdW1nYXJ0ZSkge1xuICAgICAgaWYgKGJhdW1nYXJ0ZSA9PT0gdW5kZWZpbmVkKSBiYXVtZ2FydGUgPSAwO1xuICAgICAgdmFyIGxpbmVhckVycm9yID0gMC4wO1xuICAgICAgdmFyIGJBID0gdGhpcy5tX2JvZHlBO1xuICAgICAgdmFyIGJCID0gdGhpcy5tX2JvZHlCO1xuICAgICAgdmFyIGNvb3JkaW5hdGUxID0gMDtcbiAgICAgIHZhciBjb29yZGluYXRlMiA9IDA7XG4gICAgICBpZiAodGhpcy5tX3Jldm9sdXRlMSkge1xuICAgICAgICAgY29vcmRpbmF0ZTEgPSB0aGlzLm1fcmV2b2x1dGUxLkdldEpvaW50QW5nbGUoKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgY29vcmRpbmF0ZTEgPSB0aGlzLm1fcHJpc21hdGljMS5HZXRKb2ludFRyYW5zbGF0aW9uKCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5tX3Jldm9sdXRlMikge1xuICAgICAgICAgY29vcmRpbmF0ZTIgPSB0aGlzLm1fcmV2b2x1dGUyLkdldEpvaW50QW5nbGUoKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgY29vcmRpbmF0ZTIgPSB0aGlzLm1fcHJpc21hdGljMi5HZXRKb2ludFRyYW5zbGF0aW9uKCk7XG4gICAgICB9XG4gICAgICB2YXIgQyA9IHRoaXMubV9jb25zdGFudCAtIChjb29yZGluYXRlMSArIHRoaXMubV9yYXRpbyAqIGNvb3JkaW5hdGUyKTtcbiAgICAgIHZhciBpbXB1bHNlID0gKC10aGlzLm1fbWFzcyAqIEMpO1xuICAgICAgYkEubV9zd2VlcC5jLnggKz0gYkEubV9pbnZNYXNzICogaW1wdWxzZSAqIHRoaXMubV9KLmxpbmVhckEueDtcbiAgICAgIGJBLm1fc3dlZXAuYy55ICs9IGJBLm1faW52TWFzcyAqIGltcHVsc2UgKiB0aGlzLm1fSi5saW5lYXJBLnk7XG4gICAgICBiQS5tX3N3ZWVwLmEgKz0gYkEubV9pbnZJICogaW1wdWxzZSAqIHRoaXMubV9KLmFuZ3VsYXJBO1xuICAgICAgYkIubV9zd2VlcC5jLnggKz0gYkIubV9pbnZNYXNzICogaW1wdWxzZSAqIHRoaXMubV9KLmxpbmVhckIueDtcbiAgICAgIGJCLm1fc3dlZXAuYy55ICs9IGJCLm1faW52TWFzcyAqIGltcHVsc2UgKiB0aGlzLm1fSi5saW5lYXJCLnk7XG4gICAgICBiQi5tX3N3ZWVwLmEgKz0gYkIubV9pbnZJICogaW1wdWxzZSAqIHRoaXMubV9KLmFuZ3VsYXJCO1xuICAgICAgYkEuU3luY2hyb25pemVUcmFuc2Zvcm0oKTtcbiAgICAgIGJCLlN5bmNocm9uaXplVHJhbnNmb3JtKCk7XG4gICAgICByZXR1cm4gbGluZWFyRXJyb3IgPCBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3A7XG4gICB9XG4gICBCb3gyRC5pbmhlcml0KGIyR2VhckpvaW50RGVmLCBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludERlZik7XG4gICBiMkdlYXJKb2ludERlZi5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50RGVmLnByb3RvdHlwZTtcbiAgIGIyR2VhckpvaW50RGVmLmIyR2VhckpvaW50RGVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnREZWYuYjJKb2ludERlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgfTtcbiAgIGIyR2VhckpvaW50RGVmLnByb3RvdHlwZS5iMkdlYXJKb2ludERlZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX19zdXBlci5iMkpvaW50RGVmLmNhbGwodGhpcyk7XG4gICAgICB0aGlzLnR5cGUgPSBiMkpvaW50LmVfZ2VhckpvaW50O1xuICAgICAgdGhpcy5qb2ludDEgPSBudWxsO1xuICAgICAgdGhpcy5qb2ludDIgPSBudWxsO1xuICAgICAgdGhpcy5yYXRpbyA9IDEuMDtcbiAgIH1cbiAgIGIySmFjb2JpYW4uYjJKYWNvYmlhbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubGluZWFyQSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubGluZWFyQiA9IG5ldyBiMlZlYzIoKTtcbiAgIH07XG4gICBiMkphY29iaWFuLnByb3RvdHlwZS5TZXRaZXJvID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5saW5lYXJBLlNldFplcm8oKTtcbiAgICAgIHRoaXMuYW5ndWxhckEgPSAwLjA7XG4gICAgICB0aGlzLmxpbmVhckIuU2V0WmVybygpO1xuICAgICAgdGhpcy5hbmd1bGFyQiA9IDAuMDtcbiAgIH1cbiAgIGIySmFjb2JpYW4ucHJvdG90eXBlLlNldCA9IGZ1bmN0aW9uICh4MSwgYTEsIHgyLCBhMikge1xuICAgICAgaWYgKGExID09PSB1bmRlZmluZWQpIGExID0gMDtcbiAgICAgIGlmIChhMiA9PT0gdW5kZWZpbmVkKSBhMiA9IDA7XG4gICAgICB0aGlzLmxpbmVhckEuU2V0Vih4MSk7XG4gICAgICB0aGlzLmFuZ3VsYXJBID0gYTE7XG4gICAgICB0aGlzLmxpbmVhckIuU2V0Vih4Mik7XG4gICAgICB0aGlzLmFuZ3VsYXJCID0gYTI7XG4gICB9XG4gICBiMkphY29iaWFuLnByb3RvdHlwZS5Db21wdXRlID0gZnVuY3Rpb24gKHgxLCBhMSwgeDIsIGEyKSB7XG4gICAgICBpZiAoYTEgPT09IHVuZGVmaW5lZCkgYTEgPSAwO1xuICAgICAgaWYgKGEyID09PSB1bmRlZmluZWQpIGEyID0gMDtcbiAgICAgIHJldHVybiAodGhpcy5saW5lYXJBLnggKiB4MS54ICsgdGhpcy5saW5lYXJBLnkgKiB4MS55KSArIHRoaXMuYW5ndWxhckEgKiBhMSArICh0aGlzLmxpbmVhckIueCAqIHgyLnggKyB0aGlzLmxpbmVhckIueSAqIHgyLnkpICsgdGhpcy5hbmd1bGFyQiAqIGEyO1xuICAgfVxuICAgYjJKb2ludC5iMkpvaW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX2VkZ2VBID0gbmV3IGIySm9pbnRFZGdlKCk7XG4gICAgICB0aGlzLm1fZWRnZUIgPSBuZXcgYjJKb2ludEVkZ2UoKTtcbiAgICAgIHRoaXMubV9sb2NhbENlbnRlckEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fbG9jYWxDZW50ZXJCID0gbmV3IGIyVmVjMigpO1xuICAgfTtcbiAgIGIySm9pbnQucHJvdG90eXBlLkdldFR5cGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3R5cGU7XG4gICB9XG4gICBiMkpvaW50LnByb3RvdHlwZS5HZXRBbmNob3JBID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICB9XG4gICBiMkpvaW50LnByb3RvdHlwZS5HZXRBbmNob3JCID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICB9XG4gICBiMkpvaW50LnByb3RvdHlwZS5HZXRSZWFjdGlvbkZvcmNlID0gZnVuY3Rpb24gKGludl9kdCkge1xuICAgICAgaWYgKGludl9kdCA9PT0gdW5kZWZpbmVkKSBpbnZfZHQgPSAwO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICB9XG4gICBiMkpvaW50LnByb3RvdHlwZS5HZXRSZWFjdGlvblRvcnF1ZSA9IGZ1bmN0aW9uIChpbnZfZHQpIHtcbiAgICAgIGlmIChpbnZfZHQgPT09IHVuZGVmaW5lZCkgaW52X2R0ID0gMDtcbiAgICAgIHJldHVybiAwLjA7XG4gICB9XG4gICBiMkpvaW50LnByb3RvdHlwZS5HZXRCb2R5QSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fYm9keUE7XG4gICB9XG4gICBiMkpvaW50LnByb3RvdHlwZS5HZXRCb2R5QiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fYm9keUI7XG4gICB9XG4gICBiMkpvaW50LnByb3RvdHlwZS5HZXROZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9uZXh0O1xuICAgfVxuICAgYjJKb2ludC5wcm90b3R5cGUuR2V0VXNlckRhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3VzZXJEYXRhO1xuICAgfVxuICAgYjJKb2ludC5wcm90b3R5cGUuU2V0VXNlckRhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgdGhpcy5tX3VzZXJEYXRhID0gZGF0YTtcbiAgIH1cbiAgIGIySm9pbnQucHJvdG90eXBlLklzQWN0aXZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5QS5Jc0FjdGl2ZSgpICYmIHRoaXMubV9ib2R5Qi5Jc0FjdGl2ZSgpO1xuICAgfVxuICAgYjJKb2ludC5DcmVhdGUgPSBmdW5jdGlvbiAoZGVmLCBhbGxvY2F0b3IpIHtcbiAgICAgIHZhciBqb2ludCA9IG51bGw7XG4gICAgICBzd2l0Y2ggKGRlZi50eXBlKSB7XG4gICAgICBjYXNlIGIySm9pbnQuZV9kaXN0YW5jZUpvaW50OlxuICAgICAgICAge1xuICAgICAgICAgICAgam9pbnQgPSBuZXcgYjJEaXN0YW5jZUpvaW50KChkZWYgaW5zdGFuY2VvZiBiMkRpc3RhbmNlSm9pbnREZWYgPyBkZWYgOiBudWxsKSk7XG4gICAgICAgICB9XG4gICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgYjJKb2ludC5lX21vdXNlSm9pbnQ6XG4gICAgICAgICB7XG4gICAgICAgICAgICBqb2ludCA9IG5ldyBiMk1vdXNlSm9pbnQoKGRlZiBpbnN0YW5jZW9mIGIyTW91c2VKb2ludERlZiA/IGRlZiA6IG51bGwpKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBiMkpvaW50LmVfcHJpc21hdGljSm9pbnQ6XG4gICAgICAgICB7XG4gICAgICAgICAgICBqb2ludCA9IG5ldyBiMlByaXNtYXRpY0pvaW50KChkZWYgaW5zdGFuY2VvZiBiMlByaXNtYXRpY0pvaW50RGVmID8gZGVmIDogbnVsbCkpO1xuICAgICAgICAgfVxuICAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGIySm9pbnQuZV9yZXZvbHV0ZUpvaW50OlxuICAgICAgICAge1xuICAgICAgICAgICAgam9pbnQgPSBuZXcgYjJSZXZvbHV0ZUpvaW50KChkZWYgaW5zdGFuY2VvZiBiMlJldm9sdXRlSm9pbnREZWYgPyBkZWYgOiBudWxsKSk7XG4gICAgICAgICB9XG4gICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgYjJKb2ludC5lX3B1bGxleUpvaW50OlxuICAgICAgICAge1xuICAgICAgICAgICAgam9pbnQgPSBuZXcgYjJQdWxsZXlKb2ludCgoZGVmIGluc3RhbmNlb2YgYjJQdWxsZXlKb2ludERlZiA/IGRlZiA6IG51bGwpKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBiMkpvaW50LmVfZ2VhckpvaW50OlxuICAgICAgICAge1xuICAgICAgICAgICAgam9pbnQgPSBuZXcgYjJHZWFySm9pbnQoKGRlZiBpbnN0YW5jZW9mIGIyR2VhckpvaW50RGVmID8gZGVmIDogbnVsbCkpO1xuICAgICAgICAgfVxuICAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGIySm9pbnQuZV9saW5lSm9pbnQ6XG4gICAgICAgICB7XG4gICAgICAgICAgICBqb2ludCA9IG5ldyBiMkxpbmVKb2ludCgoZGVmIGluc3RhbmNlb2YgYjJMaW5lSm9pbnREZWYgPyBkZWYgOiBudWxsKSk7XG4gICAgICAgICB9XG4gICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgYjJKb2ludC5lX3dlbGRKb2ludDpcbiAgICAgICAgIHtcbiAgICAgICAgICAgIGpvaW50ID0gbmV3IGIyV2VsZEpvaW50KChkZWYgaW5zdGFuY2VvZiBiMldlbGRKb2ludERlZiA/IGRlZiA6IG51bGwpKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBiMkpvaW50LmVfZnJpY3Rpb25Kb2ludDpcbiAgICAgICAgIHtcbiAgICAgICAgICAgIGpvaW50ID0gbmV3IGIyRnJpY3Rpb25Kb2ludCgoZGVmIGluc3RhbmNlb2YgYjJGcmljdGlvbkpvaW50RGVmID8gZGVmIDogbnVsbCkpO1xuICAgICAgICAgfVxuICAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICByZXR1cm4gam9pbnQ7XG4gICB9XG4gICBiMkpvaW50LkRlc3Ryb3kgPSBmdW5jdGlvbiAoam9pbnQsIGFsbG9jYXRvcikge31cbiAgIGIySm9pbnQucHJvdG90eXBlLmIySm9pbnQgPSBmdW5jdGlvbiAoZGVmKSB7XG4gICAgICBiMlNldHRpbmdzLmIyQXNzZXJ0KGRlZi5ib2R5QSAhPSBkZWYuYm9keUIpO1xuICAgICAgdGhpcy5tX3R5cGUgPSBkZWYudHlwZTtcbiAgICAgIHRoaXMubV9wcmV2ID0gbnVsbDtcbiAgICAgIHRoaXMubV9uZXh0ID0gbnVsbDtcbiAgICAgIHRoaXMubV9ib2R5QSA9IGRlZi5ib2R5QTtcbiAgICAgIHRoaXMubV9ib2R5QiA9IGRlZi5ib2R5QjtcbiAgICAgIHRoaXMubV9jb2xsaWRlQ29ubmVjdGVkID0gZGVmLmNvbGxpZGVDb25uZWN0ZWQ7XG4gICAgICB0aGlzLm1faXNsYW5kRmxhZyA9IGZhbHNlO1xuICAgICAgdGhpcy5tX3VzZXJEYXRhID0gZGVmLnVzZXJEYXRhO1xuICAgfVxuICAgYjJKb2ludC5wcm90b3R5cGUuSW5pdFZlbG9jaXR5Q29uc3RyYWludHMgPSBmdW5jdGlvbiAoc3RlcCkge31cbiAgIGIySm9pbnQucHJvdG90eXBlLlNvbHZlVmVsb2NpdHlDb25zdHJhaW50cyA9IGZ1bmN0aW9uIChzdGVwKSB7fVxuICAgYjJKb2ludC5wcm90b3R5cGUuRmluYWxpemVWZWxvY2l0eUNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKCkge31cbiAgIGIySm9pbnQucHJvdG90eXBlLlNvbHZlUG9zaXRpb25Db25zdHJhaW50cyA9IGZ1bmN0aW9uIChiYXVtZ2FydGUpIHtcbiAgICAgIGlmIChiYXVtZ2FydGUgPT09IHVuZGVmaW5lZCkgYmF1bWdhcnRlID0gMDtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgIH1cbiAgIEJveDJELnBvc3REZWZzLnB1c2goZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQuZV91bmtub3duSm9pbnQgPSAwO1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQuZV9yZXZvbHV0ZUpvaW50ID0gMTtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LmVfcHJpc21hdGljSm9pbnQgPSAyO1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQuZV9kaXN0YW5jZUpvaW50ID0gMztcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LmVfcHVsbGV5Sm9pbnQgPSA0O1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQuZV9tb3VzZUpvaW50ID0gNTtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LmVfZ2VhckpvaW50ID0gNjtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LmVfbGluZUpvaW50ID0gNztcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LmVfd2VsZEpvaW50ID0gODtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LmVfZnJpY3Rpb25Kb2ludCA9IDk7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludC5lX2luYWN0aXZlTGltaXQgPSAwO1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQuZV9hdExvd2VyTGltaXQgPSAxO1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQuZV9hdFVwcGVyTGltaXQgPSAyO1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQuZV9lcXVhbExpbWl0cyA9IDM7XG4gICB9KTtcbiAgIGIySm9pbnREZWYuYjJKb2ludERlZiA9IGZ1bmN0aW9uICgpIHt9O1xuICAgYjJKb2ludERlZi5wcm90b3R5cGUuYjJKb2ludERlZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMudHlwZSA9IGIySm9pbnQuZV91bmtub3duSm9pbnQ7XG4gICAgICB0aGlzLnVzZXJEYXRhID0gbnVsbDtcbiAgICAgIHRoaXMuYm9keUEgPSBudWxsO1xuICAgICAgdGhpcy5ib2R5QiA9IG51bGw7XG4gICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSBmYWxzZTtcbiAgIH1cbiAgIGIySm9pbnRFZGdlLmIySm9pbnRFZGdlID0gZnVuY3Rpb24gKCkge307XG4gICBCb3gyRC5pbmhlcml0KGIyTGluZUpvaW50LCBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludCk7XG4gICBiMkxpbmVKb2ludC5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LnByb3RvdHlwZTtcbiAgIGIyTGluZUpvaW50LmIyTGluZUpvaW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQuYjJKb2ludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgdGhpcy5tX2xvY2FsQW5jaG9yMSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9sb2NhbEFuY2hvcjIgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fbG9jYWxYQXhpczEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fbG9jYWxZQXhpczEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fYXhpcyA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9wZXJwID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX0sgPSBuZXcgYjJNYXQyMigpO1xuICAgICAgdGhpcy5tX2ltcHVsc2UgPSBuZXcgYjJWZWMyKCk7XG4gICB9O1xuICAgYjJMaW5lSm9pbnQucHJvdG90eXBlLkdldEFuY2hvckEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2JvZHlBLkdldFdvcmxkUG9pbnQodGhpcy5tX2xvY2FsQW5jaG9yMSk7XG4gICB9XG4gICBiMkxpbmVKb2ludC5wcm90b3R5cGUuR2V0QW5jaG9yQiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fYm9keUIuR2V0V29ybGRQb2ludCh0aGlzLm1fbG9jYWxBbmNob3IyKTtcbiAgIH1cbiAgIGIyTGluZUpvaW50LnByb3RvdHlwZS5HZXRSZWFjdGlvbkZvcmNlID0gZnVuY3Rpb24gKGludl9kdCkge1xuICAgICAgaWYgKGludl9kdCA9PT0gdW5kZWZpbmVkKSBpbnZfZHQgPSAwO1xuICAgICAgcmV0dXJuIG5ldyBiMlZlYzIoaW52X2R0ICogKHRoaXMubV9pbXB1bHNlLnggKiB0aGlzLm1fcGVycC54ICsgKHRoaXMubV9tb3RvckltcHVsc2UgKyB0aGlzLm1faW1wdWxzZS55KSAqIHRoaXMubV9heGlzLngpLCBpbnZfZHQgKiAodGhpcy5tX2ltcHVsc2UueCAqIHRoaXMubV9wZXJwLnkgKyAodGhpcy5tX21vdG9ySW1wdWxzZSArIHRoaXMubV9pbXB1bHNlLnkpICogdGhpcy5tX2F4aXMueSkpO1xuICAgfVxuICAgYjJMaW5lSm9pbnQucHJvdG90eXBlLkdldFJlYWN0aW9uVG9ycXVlID0gZnVuY3Rpb24gKGludl9kdCkge1xuICAgICAgaWYgKGludl9kdCA9PT0gdW5kZWZpbmVkKSBpbnZfZHQgPSAwO1xuICAgICAgcmV0dXJuIGludl9kdCAqIHRoaXMubV9pbXB1bHNlLnk7XG4gICB9XG4gICBiMkxpbmVKb2ludC5wcm90b3R5cGUuR2V0Sm9pbnRUcmFuc2xhdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9ib2R5QTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIHAxID0gYkEuR2V0V29ybGRQb2ludCh0aGlzLm1fbG9jYWxBbmNob3IxKTtcbiAgICAgIHZhciBwMiA9IGJCLkdldFdvcmxkUG9pbnQodGhpcy5tX2xvY2FsQW5jaG9yMik7XG4gICAgICB2YXIgZFggPSBwMi54IC0gcDEueDtcbiAgICAgIHZhciBkWSA9IHAyLnkgLSBwMS55O1xuICAgICAgdmFyIGF4aXMgPSBiQS5HZXRXb3JsZFZlY3Rvcih0aGlzLm1fbG9jYWxYQXhpczEpO1xuICAgICAgdmFyIHRyYW5zbGF0aW9uID0gYXhpcy54ICogZFggKyBheGlzLnkgKiBkWTtcbiAgICAgIHJldHVybiB0cmFuc2xhdGlvbjtcbiAgIH1cbiAgIGIyTGluZUpvaW50LnByb3RvdHlwZS5HZXRKb2ludFNwZWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGJBID0gdGhpcy5tX2JvZHlBO1xuICAgICAgdmFyIGJCID0gdGhpcy5tX2JvZHlCO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB0TWF0ID0gYkEubV94Zi5SO1xuICAgICAgdmFyIHIxWCA9IHRoaXMubV9sb2NhbEFuY2hvcjEueCAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgIHZhciByMVkgPSB0aGlzLm1fbG9jYWxBbmNob3IxLnkgLSBiQS5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICB2YXIgdFggPSAodE1hdC5jb2wxLnggKiByMVggKyB0TWF0LmNvbDIueCAqIHIxWSk7XG4gICAgICByMVkgPSAodE1hdC5jb2wxLnkgKiByMVggKyB0TWF0LmNvbDIueSAqIHIxWSk7XG4gICAgICByMVggPSB0WDtcbiAgICAgIHRNYXQgPSBiQi5tX3hmLlI7XG4gICAgICB2YXIgcjJYID0gdGhpcy5tX2xvY2FsQW5jaG9yMi54IC0gYkIubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgdmFyIHIyWSA9IHRoaXMubV9sb2NhbEFuY2hvcjIueSAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgIHRYID0gKHRNYXQuY29sMS54ICogcjJYICsgdE1hdC5jb2wyLnggKiByMlkpO1xuICAgICAgcjJZID0gKHRNYXQuY29sMS55ICogcjJYICsgdE1hdC5jb2wyLnkgKiByMlkpO1xuICAgICAgcjJYID0gdFg7XG4gICAgICB2YXIgcDFYID0gYkEubV9zd2VlcC5jLnggKyByMVg7XG4gICAgICB2YXIgcDFZID0gYkEubV9zd2VlcC5jLnkgKyByMVk7XG4gICAgICB2YXIgcDJYID0gYkIubV9zd2VlcC5jLnggKyByMlg7XG4gICAgICB2YXIgcDJZID0gYkIubV9zd2VlcC5jLnkgKyByMlk7XG4gICAgICB2YXIgZFggPSBwMlggLSBwMVg7XG4gICAgICB2YXIgZFkgPSBwMlkgLSBwMVk7XG4gICAgICB2YXIgYXhpcyA9IGJBLkdldFdvcmxkVmVjdG9yKHRoaXMubV9sb2NhbFhBeGlzMSk7XG4gICAgICB2YXIgdjEgPSBiQS5tX2xpbmVhclZlbG9jaXR5O1xuICAgICAgdmFyIHYyID0gYkIubV9saW5lYXJWZWxvY2l0eTtcbiAgICAgIHZhciB3MSA9IGJBLm1fYW5ndWxhclZlbG9jaXR5O1xuICAgICAgdmFyIHcyID0gYkIubV9hbmd1bGFyVmVsb2NpdHk7XG4gICAgICB2YXIgc3BlZWQgPSAoZFggKiAoKC13MSAqIGF4aXMueSkpICsgZFkgKiAodzEgKiBheGlzLngpKSArIChheGlzLnggKiAoKCh2Mi54ICsgKCgtdzIgKiByMlkpKSkgLSB2MS54KSAtICgoLXcxICogcjFZKSkpICsgYXhpcy55ICogKCgodjIueSArICh3MiAqIHIyWCkpIC0gdjEueSkgLSAodzEgKiByMVgpKSk7XG4gICAgICByZXR1cm4gc3BlZWQ7XG4gICB9XG4gICBiMkxpbmVKb2ludC5wcm90b3R5cGUuSXNMaW1pdEVuYWJsZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2VuYWJsZUxpbWl0O1xuICAgfVxuICAgYjJMaW5lSm9pbnQucHJvdG90eXBlLkVuYWJsZUxpbWl0ID0gZnVuY3Rpb24gKGZsYWcpIHtcbiAgICAgIHRoaXMubV9ib2R5QS5TZXRBd2FrZSh0cnVlKTtcbiAgICAgIHRoaXMubV9ib2R5Qi5TZXRBd2FrZSh0cnVlKTtcbiAgICAgIHRoaXMubV9lbmFibGVMaW1pdCA9IGZsYWc7XG4gICB9XG4gICBiMkxpbmVKb2ludC5wcm90b3R5cGUuR2V0TG93ZXJMaW1pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fbG93ZXJUcmFuc2xhdGlvbjtcbiAgIH1cbiAgIGIyTGluZUpvaW50LnByb3RvdHlwZS5HZXRVcHBlckxpbWl0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV91cHBlclRyYW5zbGF0aW9uO1xuICAgfVxuICAgYjJMaW5lSm9pbnQucHJvdG90eXBlLlNldExpbWl0cyA9IGZ1bmN0aW9uIChsb3dlciwgdXBwZXIpIHtcbiAgICAgIGlmIChsb3dlciA9PT0gdW5kZWZpbmVkKSBsb3dlciA9IDA7XG4gICAgICBpZiAodXBwZXIgPT09IHVuZGVmaW5lZCkgdXBwZXIgPSAwO1xuICAgICAgdGhpcy5tX2JvZHlBLlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5tX2JvZHlCLlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5tX2xvd2VyVHJhbnNsYXRpb24gPSBsb3dlcjtcbiAgICAgIHRoaXMubV91cHBlclRyYW5zbGF0aW9uID0gdXBwZXI7XG4gICB9XG4gICBiMkxpbmVKb2ludC5wcm90b3R5cGUuSXNNb3RvckVuYWJsZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2VuYWJsZU1vdG9yO1xuICAgfVxuICAgYjJMaW5lSm9pbnQucHJvdG90eXBlLkVuYWJsZU1vdG9yID0gZnVuY3Rpb24gKGZsYWcpIHtcbiAgICAgIHRoaXMubV9ib2R5QS5TZXRBd2FrZSh0cnVlKTtcbiAgICAgIHRoaXMubV9ib2R5Qi5TZXRBd2FrZSh0cnVlKTtcbiAgICAgIHRoaXMubV9lbmFibGVNb3RvciA9IGZsYWc7XG4gICB9XG4gICBiMkxpbmVKb2ludC5wcm90b3R5cGUuU2V0TW90b3JTcGVlZCA9IGZ1bmN0aW9uIChzcGVlZCkge1xuICAgICAgaWYgKHNwZWVkID09PSB1bmRlZmluZWQpIHNwZWVkID0gMDtcbiAgICAgIHRoaXMubV9ib2R5QS5TZXRBd2FrZSh0cnVlKTtcbiAgICAgIHRoaXMubV9ib2R5Qi5TZXRBd2FrZSh0cnVlKTtcbiAgICAgIHRoaXMubV9tb3RvclNwZWVkID0gc3BlZWQ7XG4gICB9XG4gICBiMkxpbmVKb2ludC5wcm90b3R5cGUuR2V0TW90b3JTcGVlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fbW90b3JTcGVlZDtcbiAgIH1cbiAgIGIyTGluZUpvaW50LnByb3RvdHlwZS5TZXRNYXhNb3RvckZvcmNlID0gZnVuY3Rpb24gKGZvcmNlKSB7XG4gICAgICBpZiAoZm9yY2UgPT09IHVuZGVmaW5lZCkgZm9yY2UgPSAwO1xuICAgICAgdGhpcy5tX2JvZHlBLlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5tX2JvZHlCLlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5tX21heE1vdG9yRm9yY2UgPSBmb3JjZTtcbiAgIH1cbiAgIGIyTGluZUpvaW50LnByb3RvdHlwZS5HZXRNYXhNb3RvckZvcmNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9tYXhNb3RvckZvcmNlO1xuICAgfVxuICAgYjJMaW5lSm9pbnQucHJvdG90eXBlLkdldE1vdG9yRm9yY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX21vdG9ySW1wdWxzZTtcbiAgIH1cbiAgIGIyTGluZUpvaW50LnByb3RvdHlwZS5iMkxpbmVKb2ludCA9IGZ1bmN0aW9uIChkZWYpIHtcbiAgICAgIHRoaXMuX19zdXBlci5iMkpvaW50LmNhbGwodGhpcywgZGVmKTtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIHRYID0gMDtcbiAgICAgIHZhciB0WSA9IDA7XG4gICAgICB0aGlzLm1fbG9jYWxBbmNob3IxLlNldFYoZGVmLmxvY2FsQW5jaG9yQSk7XG4gICAgICB0aGlzLm1fbG9jYWxBbmNob3IyLlNldFYoZGVmLmxvY2FsQW5jaG9yQik7XG4gICAgICB0aGlzLm1fbG9jYWxYQXhpczEuU2V0VihkZWYubG9jYWxBeGlzQSk7XG4gICAgICB0aGlzLm1fbG9jYWxZQXhpczEueCA9ICgtdGhpcy5tX2xvY2FsWEF4aXMxLnkpO1xuICAgICAgdGhpcy5tX2xvY2FsWUF4aXMxLnkgPSB0aGlzLm1fbG9jYWxYQXhpczEueDtcbiAgICAgIHRoaXMubV9pbXB1bHNlLlNldFplcm8oKTtcbiAgICAgIHRoaXMubV9tb3Rvck1hc3MgPSAwLjA7XG4gICAgICB0aGlzLm1fbW90b3JJbXB1bHNlID0gMC4wO1xuICAgICAgdGhpcy5tX2xvd2VyVHJhbnNsYXRpb24gPSBkZWYubG93ZXJUcmFuc2xhdGlvbjtcbiAgICAgIHRoaXMubV91cHBlclRyYW5zbGF0aW9uID0gZGVmLnVwcGVyVHJhbnNsYXRpb247XG4gICAgICB0aGlzLm1fbWF4TW90b3JGb3JjZSA9IGRlZi5tYXhNb3RvckZvcmNlO1xuICAgICAgdGhpcy5tX21vdG9yU3BlZWQgPSBkZWYubW90b3JTcGVlZDtcbiAgICAgIHRoaXMubV9lbmFibGVMaW1pdCA9IGRlZi5lbmFibGVMaW1pdDtcbiAgICAgIHRoaXMubV9lbmFibGVNb3RvciA9IGRlZi5lbmFibGVNb3RvcjtcbiAgICAgIHRoaXMubV9saW1pdFN0YXRlID0gYjJKb2ludC5lX2luYWN0aXZlTGltaXQ7XG4gICAgICB0aGlzLm1fYXhpcy5TZXRaZXJvKCk7XG4gICAgICB0aGlzLm1fcGVycC5TZXRaZXJvKCk7XG4gICB9XG4gICBiMkxpbmVKb2ludC5wcm90b3R5cGUuSW5pdFZlbG9jaXR5Q29uc3RyYWludHMgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgdmFyIGJBID0gdGhpcy5tX2JvZHlBO1xuICAgICAgdmFyIGJCID0gdGhpcy5tX2JvZHlCO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB2YXIgdFggPSAwO1xuICAgICAgdGhpcy5tX2xvY2FsQ2VudGVyQS5TZXRWKGJBLkdldExvY2FsQ2VudGVyKCkpO1xuICAgICAgdGhpcy5tX2xvY2FsQ2VudGVyQi5TZXRWKGJCLkdldExvY2FsQ2VudGVyKCkpO1xuICAgICAgdmFyIHhmMSA9IGJBLkdldFRyYW5zZm9ybSgpO1xuICAgICAgdmFyIHhmMiA9IGJCLkdldFRyYW5zZm9ybSgpO1xuICAgICAgdE1hdCA9IGJBLm1feGYuUjtcbiAgICAgIHZhciByMVggPSB0aGlzLm1fbG9jYWxBbmNob3IxLnggLSB0aGlzLm1fbG9jYWxDZW50ZXJBLng7XG4gICAgICB2YXIgcjFZID0gdGhpcy5tX2xvY2FsQW5jaG9yMS55IC0gdGhpcy5tX2xvY2FsQ2VudGVyQS55O1xuICAgICAgdFggPSAodE1hdC5jb2wxLnggKiByMVggKyB0TWF0LmNvbDIueCAqIHIxWSk7XG4gICAgICByMVkgPSAodE1hdC5jb2wxLnkgKiByMVggKyB0TWF0LmNvbDIueSAqIHIxWSk7XG4gICAgICByMVggPSB0WDtcbiAgICAgIHRNYXQgPSBiQi5tX3hmLlI7XG4gICAgICB2YXIgcjJYID0gdGhpcy5tX2xvY2FsQW5jaG9yMi54IC0gdGhpcy5tX2xvY2FsQ2VudGVyQi54O1xuICAgICAgdmFyIHIyWSA9IHRoaXMubV9sb2NhbEFuY2hvcjIueSAtIHRoaXMubV9sb2NhbENlbnRlckIueTtcbiAgICAgIHRYID0gKHRNYXQuY29sMS54ICogcjJYICsgdE1hdC5jb2wyLnggKiByMlkpO1xuICAgICAgcjJZID0gKHRNYXQuY29sMS55ICogcjJYICsgdE1hdC5jb2wyLnkgKiByMlkpO1xuICAgICAgcjJYID0gdFg7XG4gICAgICB2YXIgZFggPSBiQi5tX3N3ZWVwLmMueCArIHIyWCAtIGJBLm1fc3dlZXAuYy54IC0gcjFYO1xuICAgICAgdmFyIGRZID0gYkIubV9zd2VlcC5jLnkgKyByMlkgLSBiQS5tX3N3ZWVwLmMueSAtIHIxWTtcbiAgICAgIHRoaXMubV9pbnZNYXNzQSA9IGJBLm1faW52TWFzcztcbiAgICAgIHRoaXMubV9pbnZNYXNzQiA9IGJCLm1faW52TWFzcztcbiAgICAgIHRoaXMubV9pbnZJQSA9IGJBLm1faW52STtcbiAgICAgIHRoaXMubV9pbnZJQiA9IGJCLm1faW52STsge1xuICAgICAgICAgdGhpcy5tX2F4aXMuU2V0VihiMk1hdGguTXVsTVYoeGYxLlIsIHRoaXMubV9sb2NhbFhBeGlzMSkpO1xuICAgICAgICAgdGhpcy5tX2ExID0gKGRYICsgcjFYKSAqIHRoaXMubV9heGlzLnkgLSAoZFkgKyByMVkpICogdGhpcy5tX2F4aXMueDtcbiAgICAgICAgIHRoaXMubV9hMiA9IHIyWCAqIHRoaXMubV9heGlzLnkgLSByMlkgKiB0aGlzLm1fYXhpcy54O1xuICAgICAgICAgdGhpcy5tX21vdG9yTWFzcyA9IHRoaXMubV9pbnZNYXNzQSArIHRoaXMubV9pbnZNYXNzQiArIHRoaXMubV9pbnZJQSAqIHRoaXMubV9hMSAqIHRoaXMubV9hMSArIHRoaXMubV9pbnZJQiAqIHRoaXMubV9hMiAqIHRoaXMubV9hMjtcbiAgICAgICAgIHRoaXMubV9tb3Rvck1hc3MgPSB0aGlzLm1fbW90b3JNYXNzID4gTnVtYmVyLk1JTl9WQUxVRSA/IDEuMCAvIHRoaXMubV9tb3Rvck1hc3MgOiAwLjA7XG4gICAgICB9IHtcbiAgICAgICAgIHRoaXMubV9wZXJwLlNldFYoYjJNYXRoLk11bE1WKHhmMS5SLCB0aGlzLm1fbG9jYWxZQXhpczEpKTtcbiAgICAgICAgIHRoaXMubV9zMSA9IChkWCArIHIxWCkgKiB0aGlzLm1fcGVycC55IC0gKGRZICsgcjFZKSAqIHRoaXMubV9wZXJwLng7XG4gICAgICAgICB0aGlzLm1fczIgPSByMlggKiB0aGlzLm1fcGVycC55IC0gcjJZICogdGhpcy5tX3BlcnAueDtcbiAgICAgICAgIHZhciBtMSA9IHRoaXMubV9pbnZNYXNzQTtcbiAgICAgICAgIHZhciBtMiA9IHRoaXMubV9pbnZNYXNzQjtcbiAgICAgICAgIHZhciBpMSA9IHRoaXMubV9pbnZJQTtcbiAgICAgICAgIHZhciBpMiA9IHRoaXMubV9pbnZJQjtcbiAgICAgICAgIHRoaXMubV9LLmNvbDEueCA9IG0xICsgbTIgKyBpMSAqIHRoaXMubV9zMSAqIHRoaXMubV9zMSArIGkyICogdGhpcy5tX3MyICogdGhpcy5tX3MyO1xuICAgICAgICAgdGhpcy5tX0suY29sMS55ID0gaTEgKiB0aGlzLm1fczEgKiB0aGlzLm1fYTEgKyBpMiAqIHRoaXMubV9zMiAqIHRoaXMubV9hMjtcbiAgICAgICAgIHRoaXMubV9LLmNvbDIueCA9IHRoaXMubV9LLmNvbDEueTtcbiAgICAgICAgIHRoaXMubV9LLmNvbDIueSA9IG0xICsgbTIgKyBpMSAqIHRoaXMubV9hMSAqIHRoaXMubV9hMSArIGkyICogdGhpcy5tX2EyICogdGhpcy5tX2EyO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMubV9lbmFibGVMaW1pdCkge1xuICAgICAgICAgdmFyIGpvaW50VHJhbnNpdGlvbiA9IHRoaXMubV9heGlzLnggKiBkWCArIHRoaXMubV9heGlzLnkgKiBkWTtcbiAgICAgICAgIGlmIChiMk1hdGguQWJzKHRoaXMubV91cHBlclRyYW5zbGF0aW9uIC0gdGhpcy5tX2xvd2VyVHJhbnNsYXRpb24pIDwgMi4wICogYjJTZXR0aW5ncy5iMl9saW5lYXJTbG9wKSB7XG4gICAgICAgICAgICB0aGlzLm1fbGltaXRTdGF0ZSA9IGIySm9pbnQuZV9lcXVhbExpbWl0cztcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2UgaWYgKGpvaW50VHJhbnNpdGlvbiA8PSB0aGlzLm1fbG93ZXJUcmFuc2xhdGlvbikge1xuICAgICAgICAgICAgaWYgKHRoaXMubV9saW1pdFN0YXRlICE9IGIySm9pbnQuZV9hdExvd2VyTGltaXQpIHtcbiAgICAgICAgICAgICAgIHRoaXMubV9saW1pdFN0YXRlID0gYjJKb2ludC5lX2F0TG93ZXJMaW1pdDtcbiAgICAgICAgICAgICAgIHRoaXMubV9pbXB1bHNlLnkgPSAwLjA7XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIGlmIChqb2ludFRyYW5zaXRpb24gPj0gdGhpcy5tX3VwcGVyVHJhbnNsYXRpb24pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1fbGltaXRTdGF0ZSAhPSBiMkpvaW50LmVfYXRVcHBlckxpbWl0KSB7XG4gICAgICAgICAgICAgICB0aGlzLm1fbGltaXRTdGF0ZSA9IGIySm9pbnQuZV9hdFVwcGVyTGltaXQ7XG4gICAgICAgICAgICAgICB0aGlzLm1faW1wdWxzZS55ID0gMC4wO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm1fbGltaXRTdGF0ZSA9IGIySm9pbnQuZV9pbmFjdGl2ZUxpbWl0O1xuICAgICAgICAgICAgdGhpcy5tX2ltcHVsc2UueSA9IDAuMDtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdGhpcy5tX2xpbWl0U3RhdGUgPSBiMkpvaW50LmVfaW5hY3RpdmVMaW1pdDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm1fZW5hYmxlTW90b3IgPT0gZmFsc2UpIHtcbiAgICAgICAgIHRoaXMubV9tb3RvckltcHVsc2UgPSAwLjA7XG4gICAgICB9XG4gICAgICBpZiAoc3RlcC53YXJtU3RhcnRpbmcpIHtcbiAgICAgICAgIHRoaXMubV9pbXB1bHNlLnggKj0gc3RlcC5kdFJhdGlvO1xuICAgICAgICAgdGhpcy5tX2ltcHVsc2UueSAqPSBzdGVwLmR0UmF0aW87XG4gICAgICAgICB0aGlzLm1fbW90b3JJbXB1bHNlICo9IHN0ZXAuZHRSYXRpbztcbiAgICAgICAgIHZhciBQWCA9IHRoaXMubV9pbXB1bHNlLnggKiB0aGlzLm1fcGVycC54ICsgKHRoaXMubV9tb3RvckltcHVsc2UgKyB0aGlzLm1faW1wdWxzZS55KSAqIHRoaXMubV9heGlzLng7XG4gICAgICAgICB2YXIgUFkgPSB0aGlzLm1faW1wdWxzZS54ICogdGhpcy5tX3BlcnAueSArICh0aGlzLm1fbW90b3JJbXB1bHNlICsgdGhpcy5tX2ltcHVsc2UueSkgKiB0aGlzLm1fYXhpcy55O1xuICAgICAgICAgdmFyIEwxID0gdGhpcy5tX2ltcHVsc2UueCAqIHRoaXMubV9zMSArICh0aGlzLm1fbW90b3JJbXB1bHNlICsgdGhpcy5tX2ltcHVsc2UueSkgKiB0aGlzLm1fYTE7XG4gICAgICAgICB2YXIgTDIgPSB0aGlzLm1faW1wdWxzZS54ICogdGhpcy5tX3MyICsgKHRoaXMubV9tb3RvckltcHVsc2UgKyB0aGlzLm1faW1wdWxzZS55KSAqIHRoaXMubV9hMjtcbiAgICAgICAgIGJBLm1fbGluZWFyVmVsb2NpdHkueCAtPSB0aGlzLm1faW52TWFzc0EgKiBQWDtcbiAgICAgICAgIGJBLm1fbGluZWFyVmVsb2NpdHkueSAtPSB0aGlzLm1faW52TWFzc0EgKiBQWTtcbiAgICAgICAgIGJBLm1fYW5ndWxhclZlbG9jaXR5IC09IHRoaXMubV9pbnZJQSAqIEwxO1xuICAgICAgICAgYkIubV9saW5lYXJWZWxvY2l0eS54ICs9IHRoaXMubV9pbnZNYXNzQiAqIFBYO1xuICAgICAgICAgYkIubV9saW5lYXJWZWxvY2l0eS55ICs9IHRoaXMubV9pbnZNYXNzQiAqIFBZO1xuICAgICAgICAgYkIubV9hbmd1bGFyVmVsb2NpdHkgKz0gdGhpcy5tX2ludklCICogTDI7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV9pbXB1bHNlLlNldFplcm8oKTtcbiAgICAgICAgIHRoaXMubV9tb3RvckltcHVsc2UgPSAwLjA7XG4gICAgICB9XG4gICB9XG4gICBiMkxpbmVKb2ludC5wcm90b3R5cGUuU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKHN0ZXApIHtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9ib2R5QTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHZhciB2MSA9IGJBLm1fbGluZWFyVmVsb2NpdHk7XG4gICAgICB2YXIgdzEgPSBiQS5tX2FuZ3VsYXJWZWxvY2l0eTtcbiAgICAgIHZhciB2MiA9IGJCLm1fbGluZWFyVmVsb2NpdHk7XG4gICAgICB2YXIgdzIgPSBiQi5tX2FuZ3VsYXJWZWxvY2l0eTtcbiAgICAgIHZhciBQWCA9IDA7XG4gICAgICB2YXIgUFkgPSAwO1xuICAgICAgdmFyIEwxID0gMDtcbiAgICAgIHZhciBMMiA9IDA7XG4gICAgICBpZiAodGhpcy5tX2VuYWJsZU1vdG9yICYmIHRoaXMubV9saW1pdFN0YXRlICE9IGIySm9pbnQuZV9lcXVhbExpbWl0cykge1xuICAgICAgICAgdmFyIENkb3QgPSB0aGlzLm1fYXhpcy54ICogKHYyLnggLSB2MS54KSArIHRoaXMubV9heGlzLnkgKiAodjIueSAtIHYxLnkpICsgdGhpcy5tX2EyICogdzIgLSB0aGlzLm1fYTEgKiB3MTtcbiAgICAgICAgIHZhciBpbXB1bHNlID0gdGhpcy5tX21vdG9yTWFzcyAqICh0aGlzLm1fbW90b3JTcGVlZCAtIENkb3QpO1xuICAgICAgICAgdmFyIG9sZEltcHVsc2UgPSB0aGlzLm1fbW90b3JJbXB1bHNlO1xuICAgICAgICAgdmFyIG1heEltcHVsc2UgPSBzdGVwLmR0ICogdGhpcy5tX21heE1vdG9yRm9yY2U7XG4gICAgICAgICB0aGlzLm1fbW90b3JJbXB1bHNlID0gYjJNYXRoLkNsYW1wKHRoaXMubV9tb3RvckltcHVsc2UgKyBpbXB1bHNlLCAoLW1heEltcHVsc2UpLCBtYXhJbXB1bHNlKTtcbiAgICAgICAgIGltcHVsc2UgPSB0aGlzLm1fbW90b3JJbXB1bHNlIC0gb2xkSW1wdWxzZTtcbiAgICAgICAgIFBYID0gaW1wdWxzZSAqIHRoaXMubV9heGlzLng7XG4gICAgICAgICBQWSA9IGltcHVsc2UgKiB0aGlzLm1fYXhpcy55O1xuICAgICAgICAgTDEgPSBpbXB1bHNlICogdGhpcy5tX2ExO1xuICAgICAgICAgTDIgPSBpbXB1bHNlICogdGhpcy5tX2EyO1xuICAgICAgICAgdjEueCAtPSB0aGlzLm1faW52TWFzc0EgKiBQWDtcbiAgICAgICAgIHYxLnkgLT0gdGhpcy5tX2ludk1hc3NBICogUFk7XG4gICAgICAgICB3MSAtPSB0aGlzLm1faW52SUEgKiBMMTtcbiAgICAgICAgIHYyLnggKz0gdGhpcy5tX2ludk1hc3NCICogUFg7XG4gICAgICAgICB2Mi55ICs9IHRoaXMubV9pbnZNYXNzQiAqIFBZO1xuICAgICAgICAgdzIgKz0gdGhpcy5tX2ludklCICogTDI7XG4gICAgICB9XG4gICAgICB2YXIgQ2RvdDEgPSB0aGlzLm1fcGVycC54ICogKHYyLnggLSB2MS54KSArIHRoaXMubV9wZXJwLnkgKiAodjIueSAtIHYxLnkpICsgdGhpcy5tX3MyICogdzIgLSB0aGlzLm1fczEgKiB3MTtcbiAgICAgIGlmICh0aGlzLm1fZW5hYmxlTGltaXQgJiYgdGhpcy5tX2xpbWl0U3RhdGUgIT0gYjJKb2ludC5lX2luYWN0aXZlTGltaXQpIHtcbiAgICAgICAgIHZhciBDZG90MiA9IHRoaXMubV9heGlzLnggKiAodjIueCAtIHYxLngpICsgdGhpcy5tX2F4aXMueSAqICh2Mi55IC0gdjEueSkgKyB0aGlzLm1fYTIgKiB3MiAtIHRoaXMubV9hMSAqIHcxO1xuICAgICAgICAgdmFyIGYxID0gdGhpcy5tX2ltcHVsc2UuQ29weSgpO1xuICAgICAgICAgdmFyIGRmID0gdGhpcy5tX0suU29sdmUobmV3IGIyVmVjMigpLCAoLUNkb3QxKSwgKC1DZG90MikpO1xuICAgICAgICAgdGhpcy5tX2ltcHVsc2UuQWRkKGRmKTtcbiAgICAgICAgIGlmICh0aGlzLm1fbGltaXRTdGF0ZSA9PSBiMkpvaW50LmVfYXRMb3dlckxpbWl0KSB7XG4gICAgICAgICAgICB0aGlzLm1faW1wdWxzZS55ID0gYjJNYXRoLk1heCh0aGlzLm1faW1wdWxzZS55LCAwLjApO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSBpZiAodGhpcy5tX2xpbWl0U3RhdGUgPT0gYjJKb2ludC5lX2F0VXBwZXJMaW1pdCkge1xuICAgICAgICAgICAgdGhpcy5tX2ltcHVsc2UueSA9IGIyTWF0aC5NaW4odGhpcy5tX2ltcHVsc2UueSwgMC4wKTtcbiAgICAgICAgIH1cbiAgICAgICAgIHZhciBiID0gKC1DZG90MSkgLSAodGhpcy5tX2ltcHVsc2UueSAtIGYxLnkpICogdGhpcy5tX0suY29sMi54O1xuICAgICAgICAgdmFyIGYyciA9IDA7XG4gICAgICAgICBpZiAodGhpcy5tX0suY29sMS54ICE9IDAuMCkge1xuICAgICAgICAgICAgZjJyID0gYiAvIHRoaXMubV9LLmNvbDEueCArIGYxLng7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGYyciA9IGYxLng7XG4gICAgICAgICB9XG4gICAgICAgICB0aGlzLm1faW1wdWxzZS54ID0gZjJyO1xuICAgICAgICAgZGYueCA9IHRoaXMubV9pbXB1bHNlLnggLSBmMS54O1xuICAgICAgICAgZGYueSA9IHRoaXMubV9pbXB1bHNlLnkgLSBmMS55O1xuICAgICAgICAgUFggPSBkZi54ICogdGhpcy5tX3BlcnAueCArIGRmLnkgKiB0aGlzLm1fYXhpcy54O1xuICAgICAgICAgUFkgPSBkZi54ICogdGhpcy5tX3BlcnAueSArIGRmLnkgKiB0aGlzLm1fYXhpcy55O1xuICAgICAgICAgTDEgPSBkZi54ICogdGhpcy5tX3MxICsgZGYueSAqIHRoaXMubV9hMTtcbiAgICAgICAgIEwyID0gZGYueCAqIHRoaXMubV9zMiArIGRmLnkgKiB0aGlzLm1fYTI7XG4gICAgICAgICB2MS54IC09IHRoaXMubV9pbnZNYXNzQSAqIFBYO1xuICAgICAgICAgdjEueSAtPSB0aGlzLm1faW52TWFzc0EgKiBQWTtcbiAgICAgICAgIHcxIC09IHRoaXMubV9pbnZJQSAqIEwxO1xuICAgICAgICAgdjIueCArPSB0aGlzLm1faW52TWFzc0IgKiBQWDtcbiAgICAgICAgIHYyLnkgKz0gdGhpcy5tX2ludk1hc3NCICogUFk7XG4gICAgICAgICB3MiArPSB0aGlzLm1faW52SUIgKiBMMjtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdmFyIGRmMiA9IDA7XG4gICAgICAgICBpZiAodGhpcy5tX0suY29sMS54ICE9IDAuMCkge1xuICAgICAgICAgICAgZGYyID0gKCgtQ2RvdDEpKSAvIHRoaXMubV9LLmNvbDEueDtcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZGYyID0gMC4wO1xuICAgICAgICAgfVxuICAgICAgICAgdGhpcy5tX2ltcHVsc2UueCArPSBkZjI7XG4gICAgICAgICBQWCA9IGRmMiAqIHRoaXMubV9wZXJwLng7XG4gICAgICAgICBQWSA9IGRmMiAqIHRoaXMubV9wZXJwLnk7XG4gICAgICAgICBMMSA9IGRmMiAqIHRoaXMubV9zMTtcbiAgICAgICAgIEwyID0gZGYyICogdGhpcy5tX3MyO1xuICAgICAgICAgdjEueCAtPSB0aGlzLm1faW52TWFzc0EgKiBQWDtcbiAgICAgICAgIHYxLnkgLT0gdGhpcy5tX2ludk1hc3NBICogUFk7XG4gICAgICAgICB3MSAtPSB0aGlzLm1faW52SUEgKiBMMTtcbiAgICAgICAgIHYyLnggKz0gdGhpcy5tX2ludk1hc3NCICogUFg7XG4gICAgICAgICB2Mi55ICs9IHRoaXMubV9pbnZNYXNzQiAqIFBZO1xuICAgICAgICAgdzIgKz0gdGhpcy5tX2ludklCICogTDI7XG4gICAgICB9XG4gICAgICBiQS5tX2xpbmVhclZlbG9jaXR5LlNldFYodjEpO1xuICAgICAgYkEubV9hbmd1bGFyVmVsb2NpdHkgPSB3MTtcbiAgICAgIGJCLm1fbGluZWFyVmVsb2NpdHkuU2V0Vih2Mik7XG4gICAgICBiQi5tX2FuZ3VsYXJWZWxvY2l0eSA9IHcyO1xuICAgfVxuICAgYjJMaW5lSm9pbnQucHJvdG90eXBlLlNvbHZlUG9zaXRpb25Db25zdHJhaW50cyA9IGZ1bmN0aW9uIChiYXVtZ2FydGUpIHtcbiAgICAgIGlmIChiYXVtZ2FydGUgPT09IHVuZGVmaW5lZCkgYmF1bWdhcnRlID0gMDtcbiAgICAgIHZhciBsaW1pdEMgPSAwO1xuICAgICAgdmFyIG9sZExpbWl0SW1wdWxzZSA9IDA7XG4gICAgICB2YXIgYkEgPSB0aGlzLm1fYm9keUE7XG4gICAgICB2YXIgYkIgPSB0aGlzLm1fYm9keUI7XG4gICAgICB2YXIgYzEgPSBiQS5tX3N3ZWVwLmM7XG4gICAgICB2YXIgYTEgPSBiQS5tX3N3ZWVwLmE7XG4gICAgICB2YXIgYzIgPSBiQi5tX3N3ZWVwLmM7XG4gICAgICB2YXIgYTIgPSBiQi5tX3N3ZWVwLmE7XG4gICAgICB2YXIgdE1hdDtcbiAgICAgIHZhciB0WCA9IDA7XG4gICAgICB2YXIgbTEgPSAwO1xuICAgICAgdmFyIG0yID0gMDtcbiAgICAgIHZhciBpMSA9IDA7XG4gICAgICB2YXIgaTIgPSAwO1xuICAgICAgdmFyIGxpbmVhckVycm9yID0gMC4wO1xuICAgICAgdmFyIGFuZ3VsYXJFcnJvciA9IDAuMDtcbiAgICAgIHZhciBhY3RpdmUgPSBmYWxzZTtcbiAgICAgIHZhciBDMiA9IDAuMDtcbiAgICAgIHZhciBSMSA9IGIyTWF0MjIuRnJvbUFuZ2xlKGExKTtcbiAgICAgIHZhciBSMiA9IGIyTWF0MjIuRnJvbUFuZ2xlKGEyKTtcbiAgICAgIHRNYXQgPSBSMTtcbiAgICAgIHZhciByMVggPSB0aGlzLm1fbG9jYWxBbmNob3IxLnggLSB0aGlzLm1fbG9jYWxDZW50ZXJBLng7XG4gICAgICB2YXIgcjFZID0gdGhpcy5tX2xvY2FsQW5jaG9yMS55IC0gdGhpcy5tX2xvY2FsQ2VudGVyQS55O1xuICAgICAgdFggPSAodE1hdC5jb2wxLnggKiByMVggKyB0TWF0LmNvbDIueCAqIHIxWSk7XG4gICAgICByMVkgPSAodE1hdC5jb2wxLnkgKiByMVggKyB0TWF0LmNvbDIueSAqIHIxWSk7XG4gICAgICByMVggPSB0WDtcbiAgICAgIHRNYXQgPSBSMjtcbiAgICAgIHZhciByMlggPSB0aGlzLm1fbG9jYWxBbmNob3IyLnggLSB0aGlzLm1fbG9jYWxDZW50ZXJCLng7XG4gICAgICB2YXIgcjJZID0gdGhpcy5tX2xvY2FsQW5jaG9yMi55IC0gdGhpcy5tX2xvY2FsQ2VudGVyQi55O1xuICAgICAgdFggPSAodE1hdC5jb2wxLnggKiByMlggKyB0TWF0LmNvbDIueCAqIHIyWSk7XG4gICAgICByMlkgPSAodE1hdC5jb2wxLnkgKiByMlggKyB0TWF0LmNvbDIueSAqIHIyWSk7XG4gICAgICByMlggPSB0WDtcbiAgICAgIHZhciBkWCA9IGMyLnggKyByMlggLSBjMS54IC0gcjFYO1xuICAgICAgdmFyIGRZID0gYzIueSArIHIyWSAtIGMxLnkgLSByMVk7XG4gICAgICBpZiAodGhpcy5tX2VuYWJsZUxpbWl0KSB7XG4gICAgICAgICB0aGlzLm1fYXhpcyA9IGIyTWF0aC5NdWxNVihSMSwgdGhpcy5tX2xvY2FsWEF4aXMxKTtcbiAgICAgICAgIHRoaXMubV9hMSA9IChkWCArIHIxWCkgKiB0aGlzLm1fYXhpcy55IC0gKGRZICsgcjFZKSAqIHRoaXMubV9heGlzLng7XG4gICAgICAgICB0aGlzLm1fYTIgPSByMlggKiB0aGlzLm1fYXhpcy55IC0gcjJZICogdGhpcy5tX2F4aXMueDtcbiAgICAgICAgIHZhciB0cmFuc2xhdGlvbiA9IHRoaXMubV9heGlzLnggKiBkWCArIHRoaXMubV9heGlzLnkgKiBkWTtcbiAgICAgICAgIGlmIChiMk1hdGguQWJzKHRoaXMubV91cHBlclRyYW5zbGF0aW9uIC0gdGhpcy5tX2xvd2VyVHJhbnNsYXRpb24pIDwgMi4wICogYjJTZXR0aW5ncy5iMl9saW5lYXJTbG9wKSB7XG4gICAgICAgICAgICBDMiA9IGIyTWF0aC5DbGFtcCh0cmFuc2xhdGlvbiwgKC1iMlNldHRpbmdzLmIyX21heExpbmVhckNvcnJlY3Rpb24pLCBiMlNldHRpbmdzLmIyX21heExpbmVhckNvcnJlY3Rpb24pO1xuICAgICAgICAgICAgbGluZWFyRXJyb3IgPSBiMk1hdGguQWJzKHRyYW5zbGF0aW9uKTtcbiAgICAgICAgICAgIGFjdGl2ZSA9IHRydWU7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIGlmICh0cmFuc2xhdGlvbiA8PSB0aGlzLm1fbG93ZXJUcmFuc2xhdGlvbikge1xuICAgICAgICAgICAgQzIgPSBiMk1hdGguQ2xhbXAodHJhbnNsYXRpb24gLSB0aGlzLm1fbG93ZXJUcmFuc2xhdGlvbiArIGIyU2V0dGluZ3MuYjJfbGluZWFyU2xvcCwgKC1iMlNldHRpbmdzLmIyX21heExpbmVhckNvcnJlY3Rpb24pLCAwLjApO1xuICAgICAgICAgICAgbGluZWFyRXJyb3IgPSB0aGlzLm1fbG93ZXJUcmFuc2xhdGlvbiAtIHRyYW5zbGF0aW9uO1xuICAgICAgICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2UgaWYgKHRyYW5zbGF0aW9uID49IHRoaXMubV91cHBlclRyYW5zbGF0aW9uKSB7XG4gICAgICAgICAgICBDMiA9IGIyTWF0aC5DbGFtcCh0cmFuc2xhdGlvbiAtIHRoaXMubV91cHBlclRyYW5zbGF0aW9uICsgYjJTZXR0aW5ncy5iMl9saW5lYXJTbG9wLCAwLjAsIGIyU2V0dGluZ3MuYjJfbWF4TGluZWFyQ29ycmVjdGlvbik7XG4gICAgICAgICAgICBsaW5lYXJFcnJvciA9IHRyYW5zbGF0aW9uIC0gdGhpcy5tX3VwcGVyVHJhbnNsYXRpb247XG4gICAgICAgICAgICBhY3RpdmUgPSB0cnVlO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5tX3BlcnAgPSBiMk1hdGguTXVsTVYoUjEsIHRoaXMubV9sb2NhbFlBeGlzMSk7XG4gICAgICB0aGlzLm1fczEgPSAoZFggKyByMVgpICogdGhpcy5tX3BlcnAueSAtIChkWSArIHIxWSkgKiB0aGlzLm1fcGVycC54O1xuICAgICAgdGhpcy5tX3MyID0gcjJYICogdGhpcy5tX3BlcnAueSAtIHIyWSAqIHRoaXMubV9wZXJwLng7XG4gICAgICB2YXIgaW1wdWxzZSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHZhciBDMSA9IHRoaXMubV9wZXJwLnggKiBkWCArIHRoaXMubV9wZXJwLnkgKiBkWTtcbiAgICAgIGxpbmVhckVycm9yID0gYjJNYXRoLk1heChsaW5lYXJFcnJvciwgYjJNYXRoLkFicyhDMSkpO1xuICAgICAgYW5ndWxhckVycm9yID0gMC4wO1xuICAgICAgaWYgKGFjdGl2ZSkge1xuICAgICAgICAgbTEgPSB0aGlzLm1faW52TWFzc0E7XG4gICAgICAgICBtMiA9IHRoaXMubV9pbnZNYXNzQjtcbiAgICAgICAgIGkxID0gdGhpcy5tX2ludklBO1xuICAgICAgICAgaTIgPSB0aGlzLm1faW52SUI7XG4gICAgICAgICB0aGlzLm1fSy5jb2wxLnggPSBtMSArIG0yICsgaTEgKiB0aGlzLm1fczEgKiB0aGlzLm1fczEgKyBpMiAqIHRoaXMubV9zMiAqIHRoaXMubV9zMjtcbiAgICAgICAgIHRoaXMubV9LLmNvbDEueSA9IGkxICogdGhpcy5tX3MxICogdGhpcy5tX2ExICsgaTIgKiB0aGlzLm1fczIgKiB0aGlzLm1fYTI7XG4gICAgICAgICB0aGlzLm1fSy5jb2wyLnggPSB0aGlzLm1fSy5jb2wxLnk7XG4gICAgICAgICB0aGlzLm1fSy5jb2wyLnkgPSBtMSArIG0yICsgaTEgKiB0aGlzLm1fYTEgKiB0aGlzLm1fYTEgKyBpMiAqIHRoaXMubV9hMiAqIHRoaXMubV9hMjtcbiAgICAgICAgIHRoaXMubV9LLlNvbHZlKGltcHVsc2UsICgtQzEpLCAoLUMyKSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIG0xID0gdGhpcy5tX2ludk1hc3NBO1xuICAgICAgICAgbTIgPSB0aGlzLm1faW52TWFzc0I7XG4gICAgICAgICBpMSA9IHRoaXMubV9pbnZJQTtcbiAgICAgICAgIGkyID0gdGhpcy5tX2ludklCO1xuICAgICAgICAgdmFyIGsxMSA9IG0xICsgbTIgKyBpMSAqIHRoaXMubV9zMSAqIHRoaXMubV9zMSArIGkyICogdGhpcy5tX3MyICogdGhpcy5tX3MyO1xuICAgICAgICAgdmFyIGltcHVsc2UxID0gMDtcbiAgICAgICAgIGlmIChrMTEgIT0gMC4wKSB7XG4gICAgICAgICAgICBpbXB1bHNlMSA9ICgoLUMxKSkgLyBrMTE7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGltcHVsc2UxID0gMC4wO1xuICAgICAgICAgfVxuICAgICAgICAgaW1wdWxzZS54ID0gaW1wdWxzZTE7XG4gICAgICAgICBpbXB1bHNlLnkgPSAwLjA7XG4gICAgICB9XG4gICAgICB2YXIgUFggPSBpbXB1bHNlLnggKiB0aGlzLm1fcGVycC54ICsgaW1wdWxzZS55ICogdGhpcy5tX2F4aXMueDtcbiAgICAgIHZhciBQWSA9IGltcHVsc2UueCAqIHRoaXMubV9wZXJwLnkgKyBpbXB1bHNlLnkgKiB0aGlzLm1fYXhpcy55O1xuICAgICAgdmFyIEwxID0gaW1wdWxzZS54ICogdGhpcy5tX3MxICsgaW1wdWxzZS55ICogdGhpcy5tX2ExO1xuICAgICAgdmFyIEwyID0gaW1wdWxzZS54ICogdGhpcy5tX3MyICsgaW1wdWxzZS55ICogdGhpcy5tX2EyO1xuICAgICAgYzEueCAtPSB0aGlzLm1faW52TWFzc0EgKiBQWDtcbiAgICAgIGMxLnkgLT0gdGhpcy5tX2ludk1hc3NBICogUFk7XG4gICAgICBhMSAtPSB0aGlzLm1faW52SUEgKiBMMTtcbiAgICAgIGMyLnggKz0gdGhpcy5tX2ludk1hc3NCICogUFg7XG4gICAgICBjMi55ICs9IHRoaXMubV9pbnZNYXNzQiAqIFBZO1xuICAgICAgYTIgKz0gdGhpcy5tX2ludklCICogTDI7XG4gICAgICBiQS5tX3N3ZWVwLmEgPSBhMTtcbiAgICAgIGJCLm1fc3dlZXAuYSA9IGEyO1xuICAgICAgYkEuU3luY2hyb25pemVUcmFuc2Zvcm0oKTtcbiAgICAgIGJCLlN5bmNocm9uaXplVHJhbnNmb3JtKCk7XG4gICAgICByZXR1cm4gbGluZWFyRXJyb3IgPD0gYjJTZXR0aW5ncy5iMl9saW5lYXJTbG9wICYmIGFuZ3VsYXJFcnJvciA8PSBiMlNldHRpbmdzLmIyX2FuZ3VsYXJTbG9wO1xuICAgfVxuICAgQm94MkQuaW5oZXJpdChiMkxpbmVKb2ludERlZiwgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnREZWYpO1xuICAgYjJMaW5lSm9pbnREZWYucHJvdG90eXBlLl9fc3VwZXIgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludERlZi5wcm90b3R5cGU7XG4gICBiMkxpbmVKb2ludERlZi5iMkxpbmVKb2ludERlZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50RGVmLmIySm9pbnREZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLmxvY2FsQXhpc0EgPSBuZXcgYjJWZWMyKCk7XG4gICB9O1xuICAgYjJMaW5lSm9pbnREZWYucHJvdG90eXBlLmIyTGluZUpvaW50RGVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fX3N1cGVyLmIySm9pbnREZWYuY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMudHlwZSA9IGIySm9pbnQuZV9saW5lSm9pbnQ7XG4gICAgICB0aGlzLmxvY2FsQXhpc0EuU2V0KDEuMCwgMC4wKTtcbiAgICAgIHRoaXMuZW5hYmxlTGltaXQgPSBmYWxzZTtcbiAgICAgIHRoaXMubG93ZXJUcmFuc2xhdGlvbiA9IDAuMDtcbiAgICAgIHRoaXMudXBwZXJUcmFuc2xhdGlvbiA9IDAuMDtcbiAgICAgIHRoaXMuZW5hYmxlTW90b3IgPSBmYWxzZTtcbiAgICAgIHRoaXMubWF4TW90b3JGb3JjZSA9IDAuMDtcbiAgICAgIHRoaXMubW90b3JTcGVlZCA9IDAuMDtcbiAgIH1cbiAgIGIyTGluZUpvaW50RGVmLnByb3RvdHlwZS5Jbml0aWFsaXplID0gZnVuY3Rpb24gKGJBLCBiQiwgYW5jaG9yLCBheGlzKSB7XG4gICAgICB0aGlzLmJvZHlBID0gYkE7XG4gICAgICB0aGlzLmJvZHlCID0gYkI7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQSA9IHRoaXMuYm9keUEuR2V0TG9jYWxQb2ludChhbmNob3IpO1xuICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSB0aGlzLmJvZHlCLkdldExvY2FsUG9pbnQoYW5jaG9yKTtcbiAgICAgIHRoaXMubG9jYWxBeGlzQSA9IHRoaXMuYm9keUEuR2V0TG9jYWxWZWN0b3IoYXhpcyk7XG4gICB9XG4gICBCb3gyRC5pbmhlcml0KGIyTW91c2VKb2ludCwgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQpO1xuICAgYjJNb3VzZUpvaW50LnByb3RvdHlwZS5fX3N1cGVyID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQucHJvdG90eXBlO1xuICAgYjJNb3VzZUpvaW50LmIyTW91c2VKb2ludCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LmIySm9pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIHRoaXMuSyA9IG5ldyBiMk1hdDIyKCk7XG4gICAgICB0aGlzLksxID0gbmV3IGIyTWF0MjIoKTtcbiAgICAgIHRoaXMuSzIgPSBuZXcgYjJNYXQyMigpO1xuICAgICAgdGhpcy5tX2xvY2FsQW5jaG9yID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX3RhcmdldCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9pbXB1bHNlID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX21hc3MgPSBuZXcgYjJNYXQyMigpO1xuICAgICAgdGhpcy5tX0MgPSBuZXcgYjJWZWMyKCk7XG4gICB9O1xuICAgYjJNb3VzZUpvaW50LnByb3RvdHlwZS5HZXRBbmNob3JBID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV90YXJnZXQ7XG4gICB9XG4gICBiMk1vdXNlSm9pbnQucHJvdG90eXBlLkdldEFuY2hvckIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2JvZHlCLkdldFdvcmxkUG9pbnQodGhpcy5tX2xvY2FsQW5jaG9yKTtcbiAgIH1cbiAgIGIyTW91c2VKb2ludC5wcm90b3R5cGUuR2V0UmVhY3Rpb25Gb3JjZSA9IGZ1bmN0aW9uIChpbnZfZHQpIHtcbiAgICAgIGlmIChpbnZfZHQgPT09IHVuZGVmaW5lZCkgaW52X2R0ID0gMDtcbiAgICAgIHJldHVybiBuZXcgYjJWZWMyKGludl9kdCAqIHRoaXMubV9pbXB1bHNlLngsIGludl9kdCAqIHRoaXMubV9pbXB1bHNlLnkpO1xuICAgfVxuICAgYjJNb3VzZUpvaW50LnByb3RvdHlwZS5HZXRSZWFjdGlvblRvcnF1ZSA9IGZ1bmN0aW9uIChpbnZfZHQpIHtcbiAgICAgIGlmIChpbnZfZHQgPT09IHVuZGVmaW5lZCkgaW52X2R0ID0gMDtcbiAgICAgIHJldHVybiAwLjA7XG4gICB9XG4gICBiMk1vdXNlSm9pbnQucHJvdG90eXBlLkdldFRhcmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fdGFyZ2V0O1xuICAgfVxuICAgYjJNb3VzZUpvaW50LnByb3RvdHlwZS5TZXRUYXJnZXQgPSBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICBpZiAodGhpcy5tX2JvZHlCLklzQXdha2UoKSA9PSBmYWxzZSkge1xuICAgICAgICAgdGhpcy5tX2JvZHlCLlNldEF3YWtlKHRydWUpO1xuICAgICAgfVxuICAgICAgdGhpcy5tX3RhcmdldCA9IHRhcmdldDtcbiAgIH1cbiAgIGIyTW91c2VKb2ludC5wcm90b3R5cGUuR2V0TWF4Rm9yY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX21heEZvcmNlO1xuICAgfVxuICAgYjJNb3VzZUpvaW50LnByb3RvdHlwZS5TZXRNYXhGb3JjZSA9IGZ1bmN0aW9uIChtYXhGb3JjZSkge1xuICAgICAgaWYgKG1heEZvcmNlID09PSB1bmRlZmluZWQpIG1heEZvcmNlID0gMDtcbiAgICAgIHRoaXMubV9tYXhGb3JjZSA9IG1heEZvcmNlO1xuICAgfVxuICAgYjJNb3VzZUpvaW50LnByb3RvdHlwZS5HZXRGcmVxdWVuY3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2ZyZXF1ZW5jeUh6O1xuICAgfVxuICAgYjJNb3VzZUpvaW50LnByb3RvdHlwZS5TZXRGcmVxdWVuY3kgPSBmdW5jdGlvbiAoaHopIHtcbiAgICAgIGlmIChoeiA9PT0gdW5kZWZpbmVkKSBoeiA9IDA7XG4gICAgICB0aGlzLm1fZnJlcXVlbmN5SHogPSBoejtcbiAgIH1cbiAgIGIyTW91c2VKb2ludC5wcm90b3R5cGUuR2V0RGFtcGluZ1JhdGlvID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9kYW1waW5nUmF0aW87XG4gICB9XG4gICBiMk1vdXNlSm9pbnQucHJvdG90eXBlLlNldERhbXBpbmdSYXRpbyA9IGZ1bmN0aW9uIChyYXRpbykge1xuICAgICAgaWYgKHJhdGlvID09PSB1bmRlZmluZWQpIHJhdGlvID0gMDtcbiAgICAgIHRoaXMubV9kYW1waW5nUmF0aW8gPSByYXRpbztcbiAgIH1cbiAgIGIyTW91c2VKb2ludC5wcm90b3R5cGUuYjJNb3VzZUpvaW50ID0gZnVuY3Rpb24gKGRlZikge1xuICAgICAgdGhpcy5fX3N1cGVyLmIySm9pbnQuY2FsbCh0aGlzLCBkZWYpO1xuICAgICAgdGhpcy5tX3RhcmdldC5TZXRWKGRlZi50YXJnZXQpO1xuICAgICAgdmFyIHRYID0gdGhpcy5tX3RhcmdldC54IC0gdGhpcy5tX2JvZHlCLm1feGYucG9zaXRpb24ueDtcbiAgICAgIHZhciB0WSA9IHRoaXMubV90YXJnZXQueSAtIHRoaXMubV9ib2R5Qi5tX3hmLnBvc2l0aW9uLnk7XG4gICAgICB2YXIgdE1hdCA9IHRoaXMubV9ib2R5Qi5tX3hmLlI7XG4gICAgICB0aGlzLm1fbG9jYWxBbmNob3IueCA9ICh0WCAqIHRNYXQuY29sMS54ICsgdFkgKiB0TWF0LmNvbDEueSk7XG4gICAgICB0aGlzLm1fbG9jYWxBbmNob3IueSA9ICh0WCAqIHRNYXQuY29sMi54ICsgdFkgKiB0TWF0LmNvbDIueSk7XG4gICAgICB0aGlzLm1fbWF4Rm9yY2UgPSBkZWYubWF4Rm9yY2U7XG4gICAgICB0aGlzLm1faW1wdWxzZS5TZXRaZXJvKCk7XG4gICAgICB0aGlzLm1fZnJlcXVlbmN5SHogPSBkZWYuZnJlcXVlbmN5SHo7XG4gICAgICB0aGlzLm1fZGFtcGluZ1JhdGlvID0gZGVmLmRhbXBpbmdSYXRpbztcbiAgICAgIHRoaXMubV9iZXRhID0gMC4wO1xuICAgICAgdGhpcy5tX2dhbW1hID0gMC4wO1xuICAgfVxuICAgYjJNb3VzZUpvaW50LnByb3RvdHlwZS5Jbml0VmVsb2NpdHlDb25zdHJhaW50cyA9IGZ1bmN0aW9uIChzdGVwKSB7XG4gICAgICB2YXIgYiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHZhciBtYXNzID0gYi5HZXRNYXNzKCk7XG4gICAgICB2YXIgb21lZ2EgPSAyLjAgKiBNYXRoLlBJICogdGhpcy5tX2ZyZXF1ZW5jeUh6O1xuICAgICAgdmFyIGQgPSAyLjAgKiBtYXNzICogdGhpcy5tX2RhbXBpbmdSYXRpbyAqIG9tZWdhO1xuICAgICAgdmFyIGsgPSBtYXNzICogb21lZ2EgKiBvbWVnYTtcbiAgICAgIHRoaXMubV9nYW1tYSA9IHN0ZXAuZHQgKiAoZCArIHN0ZXAuZHQgKiBrKTtcbiAgICAgIHRoaXMubV9nYW1tYSA9IHRoaXMubV9nYW1tYSAhPSAwID8gMSAvIHRoaXMubV9nYW1tYSA6IDAuMDtcbiAgICAgIHRoaXMubV9iZXRhID0gc3RlcC5kdCAqIGsgKiB0aGlzLm1fZ2FtbWE7XG4gICAgICB2YXIgdE1hdDt0TWF0ID0gYi5tX3hmLlI7XG4gICAgICB2YXIgclggPSB0aGlzLm1fbG9jYWxBbmNob3IueCAtIGIubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgdmFyIHJZID0gdGhpcy5tX2xvY2FsQW5jaG9yLnkgLSBiLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgIHZhciB0WCA9ICh0TWF0LmNvbDEueCAqIHJYICsgdE1hdC5jb2wyLnggKiByWSk7clkgPSAodE1hdC5jb2wxLnkgKiByWCArIHRNYXQuY29sMi55ICogclkpO1xuICAgICAgclggPSB0WDtcbiAgICAgIHZhciBpbnZNYXNzID0gYi5tX2ludk1hc3M7XG4gICAgICB2YXIgaW52SSA9IGIubV9pbnZJO3RoaXMuSzEuY29sMS54ID0gaW52TWFzcztcbiAgICAgIHRoaXMuSzEuY29sMi54ID0gMC4wO1xuICAgICAgdGhpcy5LMS5jb2wxLnkgPSAwLjA7XG4gICAgICB0aGlzLksxLmNvbDIueSA9IGludk1hc3M7XG4gICAgICB0aGlzLksyLmNvbDEueCA9IGludkkgKiByWSAqIHJZO1xuICAgICAgdGhpcy5LMi5jb2wyLnggPSAoLWludkkgKiByWCAqIHJZKTtcbiAgICAgIHRoaXMuSzIuY29sMS55ID0gKC1pbnZJICogclggKiByWSk7XG4gICAgICB0aGlzLksyLmNvbDIueSA9IGludkkgKiByWCAqIHJYO1xuICAgICAgdGhpcy5LLlNldE0odGhpcy5LMSk7XG4gICAgICB0aGlzLksuQWRkTSh0aGlzLksyKTtcbiAgICAgIHRoaXMuSy5jb2wxLnggKz0gdGhpcy5tX2dhbW1hO1xuICAgICAgdGhpcy5LLmNvbDIueSArPSB0aGlzLm1fZ2FtbWE7XG4gICAgICB0aGlzLksuR2V0SW52ZXJzZSh0aGlzLm1fbWFzcyk7XG4gICAgICB0aGlzLm1fQy54ID0gYi5tX3N3ZWVwLmMueCArIHJYIC0gdGhpcy5tX3RhcmdldC54O1xuICAgICAgdGhpcy5tX0MueSA9IGIubV9zd2VlcC5jLnkgKyByWSAtIHRoaXMubV90YXJnZXQueTtcbiAgICAgIGIubV9hbmd1bGFyVmVsb2NpdHkgKj0gMC45ODtcbiAgICAgIHRoaXMubV9pbXB1bHNlLnggKj0gc3RlcC5kdFJhdGlvO1xuICAgICAgdGhpcy5tX2ltcHVsc2UueSAqPSBzdGVwLmR0UmF0aW87XG4gICAgICBiLm1fbGluZWFyVmVsb2NpdHkueCArPSBpbnZNYXNzICogdGhpcy5tX2ltcHVsc2UueDtcbiAgICAgIGIubV9saW5lYXJWZWxvY2l0eS55ICs9IGludk1hc3MgKiB0aGlzLm1faW1wdWxzZS55O1xuICAgICAgYi5tX2FuZ3VsYXJWZWxvY2l0eSArPSBpbnZJICogKHJYICogdGhpcy5tX2ltcHVsc2UueSAtIHJZICogdGhpcy5tX2ltcHVsc2UueCk7XG4gICB9XG4gICBiMk1vdXNlSm9pbnQucHJvdG90eXBlLlNvbHZlVmVsb2NpdHlDb25zdHJhaW50cyA9IGZ1bmN0aW9uIChzdGVwKSB7XG4gICAgICB2YXIgYiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIHRYID0gMDtcbiAgICAgIHZhciB0WSA9IDA7XG4gICAgICB0TWF0ID0gYi5tX3hmLlI7XG4gICAgICB2YXIgclggPSB0aGlzLm1fbG9jYWxBbmNob3IueCAtIGIubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgdmFyIHJZID0gdGhpcy5tX2xvY2FsQW5jaG9yLnkgLSBiLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgIHRYID0gKHRNYXQuY29sMS54ICogclggKyB0TWF0LmNvbDIueCAqIHJZKTtcbiAgICAgIHJZID0gKHRNYXQuY29sMS55ICogclggKyB0TWF0LmNvbDIueSAqIHJZKTtcbiAgICAgIHJYID0gdFg7XG4gICAgICB2YXIgQ2RvdFggPSBiLm1fbGluZWFyVmVsb2NpdHkueCArICgoLWIubV9hbmd1bGFyVmVsb2NpdHkgKiByWSkpO1xuICAgICAgdmFyIENkb3RZID0gYi5tX2xpbmVhclZlbG9jaXR5LnkgKyAoYi5tX2FuZ3VsYXJWZWxvY2l0eSAqIHJYKTtcbiAgICAgIHRNYXQgPSB0aGlzLm1fbWFzcztcbiAgICAgIHRYID0gQ2RvdFggKyB0aGlzLm1fYmV0YSAqIHRoaXMubV9DLnggKyB0aGlzLm1fZ2FtbWEgKiB0aGlzLm1faW1wdWxzZS54O1xuICAgICAgdFkgPSBDZG90WSArIHRoaXMubV9iZXRhICogdGhpcy5tX0MueSArIHRoaXMubV9nYW1tYSAqIHRoaXMubV9pbXB1bHNlLnk7XG4gICAgICB2YXIgaW1wdWxzZVggPSAoLSh0TWF0LmNvbDEueCAqIHRYICsgdE1hdC5jb2wyLnggKiB0WSkpO1xuICAgICAgdmFyIGltcHVsc2VZID0gKC0odE1hdC5jb2wxLnkgKiB0WCArIHRNYXQuY29sMi55ICogdFkpKTtcbiAgICAgIHZhciBvbGRJbXB1bHNlWCA9IHRoaXMubV9pbXB1bHNlLng7XG4gICAgICB2YXIgb2xkSW1wdWxzZVkgPSB0aGlzLm1faW1wdWxzZS55O1xuICAgICAgdGhpcy5tX2ltcHVsc2UueCArPSBpbXB1bHNlWDtcbiAgICAgIHRoaXMubV9pbXB1bHNlLnkgKz0gaW1wdWxzZVk7XG4gICAgICB2YXIgbWF4SW1wdWxzZSA9IHN0ZXAuZHQgKiB0aGlzLm1fbWF4Rm9yY2U7XG4gICAgICBpZiAodGhpcy5tX2ltcHVsc2UuTGVuZ3RoU3F1YXJlZCgpID4gbWF4SW1wdWxzZSAqIG1heEltcHVsc2UpIHtcbiAgICAgICAgIHRoaXMubV9pbXB1bHNlLk11bHRpcGx5KG1heEltcHVsc2UgLyB0aGlzLm1faW1wdWxzZS5MZW5ndGgoKSk7XG4gICAgICB9XG4gICAgICBpbXB1bHNlWCA9IHRoaXMubV9pbXB1bHNlLnggLSBvbGRJbXB1bHNlWDtcbiAgICAgIGltcHVsc2VZID0gdGhpcy5tX2ltcHVsc2UueSAtIG9sZEltcHVsc2VZO1xuICAgICAgYi5tX2xpbmVhclZlbG9jaXR5LnggKz0gYi5tX2ludk1hc3MgKiBpbXB1bHNlWDtcbiAgICAgIGIubV9saW5lYXJWZWxvY2l0eS55ICs9IGIubV9pbnZNYXNzICogaW1wdWxzZVk7XG4gICAgICBiLm1fYW5ndWxhclZlbG9jaXR5ICs9IGIubV9pbnZJICogKHJYICogaW1wdWxzZVkgLSByWSAqIGltcHVsc2VYKTtcbiAgIH1cbiAgIGIyTW91c2VKb2ludC5wcm90b3R5cGUuU29sdmVQb3NpdGlvbkNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKGJhdW1nYXJ0ZSkge1xuICAgICAgaWYgKGJhdW1nYXJ0ZSA9PT0gdW5kZWZpbmVkKSBiYXVtZ2FydGUgPSAwO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICB9XG4gICBCb3gyRC5pbmhlcml0KGIyTW91c2VKb2ludERlZiwgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnREZWYpO1xuICAgYjJNb3VzZUpvaW50RGVmLnByb3RvdHlwZS5fX3N1cGVyID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnREZWYucHJvdG90eXBlO1xuICAgYjJNb3VzZUpvaW50RGVmLmIyTW91c2VKb2ludERlZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50RGVmLmIySm9pbnREZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIHRoaXMudGFyZ2V0ID0gbmV3IGIyVmVjMigpO1xuICAgfTtcbiAgIGIyTW91c2VKb2ludERlZi5wcm90b3R5cGUuYjJNb3VzZUpvaW50RGVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fX3N1cGVyLmIySm9pbnREZWYuY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMudHlwZSA9IGIySm9pbnQuZV9tb3VzZUpvaW50O1xuICAgICAgdGhpcy5tYXhGb3JjZSA9IDAuMDtcbiAgICAgIHRoaXMuZnJlcXVlbmN5SHogPSA1LjA7XG4gICAgICB0aGlzLmRhbXBpbmdSYXRpbyA9IDAuNztcbiAgIH1cbiAgIEJveDJELmluaGVyaXQoYjJQcmlzbWF0aWNKb2ludCwgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQpO1xuICAgYjJQcmlzbWF0aWNKb2ludC5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LnByb3RvdHlwZTtcbiAgIGIyUHJpc21hdGljSm9pbnQuYjJQcmlzbWF0aWNKb2ludCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LmIySm9pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIHRoaXMubV9sb2NhbEFuY2hvcjEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fbG9jYWxBbmNob3IyID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX2xvY2FsWEF4aXMxID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX2xvY2FsWUF4aXMxID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX2F4aXMgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fcGVycCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9LID0gbmV3IGIyTWF0MzMoKTtcbiAgICAgIHRoaXMubV9pbXB1bHNlID0gbmV3IGIyVmVjMygpO1xuICAgfTtcbiAgIGIyUHJpc21hdGljSm9pbnQucHJvdG90eXBlLkdldEFuY2hvckEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2JvZHlBLkdldFdvcmxkUG9pbnQodGhpcy5tX2xvY2FsQW5jaG9yMSk7XG4gICB9XG4gICBiMlByaXNtYXRpY0pvaW50LnByb3RvdHlwZS5HZXRBbmNob3JCID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5Qi5HZXRXb3JsZFBvaW50KHRoaXMubV9sb2NhbEFuY2hvcjIpO1xuICAgfVxuICAgYjJQcmlzbWF0aWNKb2ludC5wcm90b3R5cGUuR2V0UmVhY3Rpb25Gb3JjZSA9IGZ1bmN0aW9uIChpbnZfZHQpIHtcbiAgICAgIGlmIChpbnZfZHQgPT09IHVuZGVmaW5lZCkgaW52X2R0ID0gMDtcbiAgICAgIHJldHVybiBuZXcgYjJWZWMyKGludl9kdCAqICh0aGlzLm1faW1wdWxzZS54ICogdGhpcy5tX3BlcnAueCArICh0aGlzLm1fbW90b3JJbXB1bHNlICsgdGhpcy5tX2ltcHVsc2UueikgKiB0aGlzLm1fYXhpcy54KSwgaW52X2R0ICogKHRoaXMubV9pbXB1bHNlLnggKiB0aGlzLm1fcGVycC55ICsgKHRoaXMubV9tb3RvckltcHVsc2UgKyB0aGlzLm1faW1wdWxzZS56KSAqIHRoaXMubV9heGlzLnkpKTtcbiAgIH1cbiAgIGIyUHJpc21hdGljSm9pbnQucHJvdG90eXBlLkdldFJlYWN0aW9uVG9ycXVlID0gZnVuY3Rpb24gKGludl9kdCkge1xuICAgICAgaWYgKGludl9kdCA9PT0gdW5kZWZpbmVkKSBpbnZfZHQgPSAwO1xuICAgICAgcmV0dXJuIGludl9kdCAqIHRoaXMubV9pbXB1bHNlLnk7XG4gICB9XG4gICBiMlByaXNtYXRpY0pvaW50LnByb3RvdHlwZS5HZXRKb2ludFRyYW5zbGF0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGJBID0gdGhpcy5tX2JvZHlBO1xuICAgICAgdmFyIGJCID0gdGhpcy5tX2JvZHlCO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB2YXIgcDEgPSBiQS5HZXRXb3JsZFBvaW50KHRoaXMubV9sb2NhbEFuY2hvcjEpO1xuICAgICAgdmFyIHAyID0gYkIuR2V0V29ybGRQb2ludCh0aGlzLm1fbG9jYWxBbmNob3IyKTtcbiAgICAgIHZhciBkWCA9IHAyLnggLSBwMS54O1xuICAgICAgdmFyIGRZID0gcDIueSAtIHAxLnk7XG4gICAgICB2YXIgYXhpcyA9IGJBLkdldFdvcmxkVmVjdG9yKHRoaXMubV9sb2NhbFhBeGlzMSk7XG4gICAgICB2YXIgdHJhbnNsYXRpb24gPSBheGlzLnggKiBkWCArIGF4aXMueSAqIGRZO1xuICAgICAgcmV0dXJuIHRyYW5zbGF0aW9uO1xuICAgfVxuICAgYjJQcmlzbWF0aWNKb2ludC5wcm90b3R5cGUuR2V0Sm9pbnRTcGVlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9ib2R5QTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdE1hdCA9IGJBLm1feGYuUjtcbiAgICAgIHZhciByMVggPSB0aGlzLm1fbG9jYWxBbmNob3IxLnggLSBiQS5tX3N3ZWVwLmxvY2FsQ2VudGVyLng7XG4gICAgICB2YXIgcjFZID0gdGhpcy5tX2xvY2FsQW5jaG9yMS55IC0gYkEubV9zd2VlcC5sb2NhbENlbnRlci55O1xuICAgICAgdmFyIHRYID0gKHRNYXQuY29sMS54ICogcjFYICsgdE1hdC5jb2wyLnggKiByMVkpO1xuICAgICAgcjFZID0gKHRNYXQuY29sMS55ICogcjFYICsgdE1hdC5jb2wyLnkgKiByMVkpO1xuICAgICAgcjFYID0gdFg7XG4gICAgICB0TWF0ID0gYkIubV94Zi5SO1xuICAgICAgdmFyIHIyWCA9IHRoaXMubV9sb2NhbEFuY2hvcjIueCAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgIHZhciByMlkgPSB0aGlzLm1fbG9jYWxBbmNob3IyLnkgLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHIyWCArIHRNYXQuY29sMi54ICogcjJZKTtcbiAgICAgIHIyWSA9ICh0TWF0LmNvbDEueSAqIHIyWCArIHRNYXQuY29sMi55ICogcjJZKTtcbiAgICAgIHIyWCA9IHRYO1xuICAgICAgdmFyIHAxWCA9IGJBLm1fc3dlZXAuYy54ICsgcjFYO1xuICAgICAgdmFyIHAxWSA9IGJBLm1fc3dlZXAuYy55ICsgcjFZO1xuICAgICAgdmFyIHAyWCA9IGJCLm1fc3dlZXAuYy54ICsgcjJYO1xuICAgICAgdmFyIHAyWSA9IGJCLm1fc3dlZXAuYy55ICsgcjJZO1xuICAgICAgdmFyIGRYID0gcDJYIC0gcDFYO1xuICAgICAgdmFyIGRZID0gcDJZIC0gcDFZO1xuICAgICAgdmFyIGF4aXMgPSBiQS5HZXRXb3JsZFZlY3Rvcih0aGlzLm1fbG9jYWxYQXhpczEpO1xuICAgICAgdmFyIHYxID0gYkEubV9saW5lYXJWZWxvY2l0eTtcbiAgICAgIHZhciB2MiA9IGJCLm1fbGluZWFyVmVsb2NpdHk7XG4gICAgICB2YXIgdzEgPSBiQS5tX2FuZ3VsYXJWZWxvY2l0eTtcbiAgICAgIHZhciB3MiA9IGJCLm1fYW5ndWxhclZlbG9jaXR5O1xuICAgICAgdmFyIHNwZWVkID0gKGRYICogKCgtdzEgKiBheGlzLnkpKSArIGRZICogKHcxICogYXhpcy54KSkgKyAoYXhpcy54ICogKCgodjIueCArICgoLXcyICogcjJZKSkpIC0gdjEueCkgLSAoKC13MSAqIHIxWSkpKSArIGF4aXMueSAqICgoKHYyLnkgKyAodzIgKiByMlgpKSAtIHYxLnkpIC0gKHcxICogcjFYKSkpO1xuICAgICAgcmV0dXJuIHNwZWVkO1xuICAgfVxuICAgYjJQcmlzbWF0aWNKb2ludC5wcm90b3R5cGUuSXNMaW1pdEVuYWJsZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2VuYWJsZUxpbWl0O1xuICAgfVxuICAgYjJQcmlzbWF0aWNKb2ludC5wcm90b3R5cGUuRW5hYmxlTGltaXQgPSBmdW5jdGlvbiAoZmxhZykge1xuICAgICAgdGhpcy5tX2JvZHlBLlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5tX2JvZHlCLlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5tX2VuYWJsZUxpbWl0ID0gZmxhZztcbiAgIH1cbiAgIGIyUHJpc21hdGljSm9pbnQucHJvdG90eXBlLkdldExvd2VyTGltaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2xvd2VyVHJhbnNsYXRpb247XG4gICB9XG4gICBiMlByaXNtYXRpY0pvaW50LnByb3RvdHlwZS5HZXRVcHBlckxpbWl0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV91cHBlclRyYW5zbGF0aW9uO1xuICAgfVxuICAgYjJQcmlzbWF0aWNKb2ludC5wcm90b3R5cGUuU2V0TGltaXRzID0gZnVuY3Rpb24gKGxvd2VyLCB1cHBlcikge1xuICAgICAgaWYgKGxvd2VyID09PSB1bmRlZmluZWQpIGxvd2VyID0gMDtcbiAgICAgIGlmICh1cHBlciA9PT0gdW5kZWZpbmVkKSB1cHBlciA9IDA7XG4gICAgICB0aGlzLm1fYm9keUEuU2V0QXdha2UodHJ1ZSk7XG4gICAgICB0aGlzLm1fYm9keUIuU2V0QXdha2UodHJ1ZSk7XG4gICAgICB0aGlzLm1fbG93ZXJUcmFuc2xhdGlvbiA9IGxvd2VyO1xuICAgICAgdGhpcy5tX3VwcGVyVHJhbnNsYXRpb24gPSB1cHBlcjtcbiAgIH1cbiAgIGIyUHJpc21hdGljSm9pbnQucHJvdG90eXBlLklzTW90b3JFbmFibGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9lbmFibGVNb3RvcjtcbiAgIH1cbiAgIGIyUHJpc21hdGljSm9pbnQucHJvdG90eXBlLkVuYWJsZU1vdG9yID0gZnVuY3Rpb24gKGZsYWcpIHtcbiAgICAgIHRoaXMubV9ib2R5QS5TZXRBd2FrZSh0cnVlKTtcbiAgICAgIHRoaXMubV9ib2R5Qi5TZXRBd2FrZSh0cnVlKTtcbiAgICAgIHRoaXMubV9lbmFibGVNb3RvciA9IGZsYWc7XG4gICB9XG4gICBiMlByaXNtYXRpY0pvaW50LnByb3RvdHlwZS5TZXRNb3RvclNwZWVkID0gZnVuY3Rpb24gKHNwZWVkKSB7XG4gICAgICBpZiAoc3BlZWQgPT09IHVuZGVmaW5lZCkgc3BlZWQgPSAwO1xuICAgICAgdGhpcy5tX2JvZHlBLlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5tX2JvZHlCLlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5tX21vdG9yU3BlZWQgPSBzcGVlZDtcbiAgIH1cbiAgIGIyUHJpc21hdGljSm9pbnQucHJvdG90eXBlLkdldE1vdG9yU3BlZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX21vdG9yU3BlZWQ7XG4gICB9XG4gICBiMlByaXNtYXRpY0pvaW50LnByb3RvdHlwZS5TZXRNYXhNb3RvckZvcmNlID0gZnVuY3Rpb24gKGZvcmNlKSB7XG4gICAgICBpZiAoZm9yY2UgPT09IHVuZGVmaW5lZCkgZm9yY2UgPSAwO1xuICAgICAgdGhpcy5tX2JvZHlBLlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5tX2JvZHlCLlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5tX21heE1vdG9yRm9yY2UgPSBmb3JjZTtcbiAgIH1cbiAgIGIyUHJpc21hdGljSm9pbnQucHJvdG90eXBlLkdldE1vdG9yRm9yY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX21vdG9ySW1wdWxzZTtcbiAgIH1cbiAgIGIyUHJpc21hdGljSm9pbnQucHJvdG90eXBlLmIyUHJpc21hdGljSm9pbnQgPSBmdW5jdGlvbiAoZGVmKSB7XG4gICAgICB0aGlzLl9fc3VwZXIuYjJKb2ludC5jYWxsKHRoaXMsIGRlZik7XG4gICAgICB2YXIgdE1hdDtcbiAgICAgIHZhciB0WCA9IDA7XG4gICAgICB2YXIgdFkgPSAwO1xuICAgICAgdGhpcy5tX2xvY2FsQW5jaG9yMS5TZXRWKGRlZi5sb2NhbEFuY2hvckEpO1xuICAgICAgdGhpcy5tX2xvY2FsQW5jaG9yMi5TZXRWKGRlZi5sb2NhbEFuY2hvckIpO1xuICAgICAgdGhpcy5tX2xvY2FsWEF4aXMxLlNldFYoZGVmLmxvY2FsQXhpc0EpO1xuICAgICAgdGhpcy5tX2xvY2FsWUF4aXMxLnggPSAoLXRoaXMubV9sb2NhbFhBeGlzMS55KTtcbiAgICAgIHRoaXMubV9sb2NhbFlBeGlzMS55ID0gdGhpcy5tX2xvY2FsWEF4aXMxLng7XG4gICAgICB0aGlzLm1fcmVmQW5nbGUgPSBkZWYucmVmZXJlbmNlQW5nbGU7XG4gICAgICB0aGlzLm1faW1wdWxzZS5TZXRaZXJvKCk7XG4gICAgICB0aGlzLm1fbW90b3JNYXNzID0gMC4wO1xuICAgICAgdGhpcy5tX21vdG9ySW1wdWxzZSA9IDAuMDtcbiAgICAgIHRoaXMubV9sb3dlclRyYW5zbGF0aW9uID0gZGVmLmxvd2VyVHJhbnNsYXRpb247XG4gICAgICB0aGlzLm1fdXBwZXJUcmFuc2xhdGlvbiA9IGRlZi51cHBlclRyYW5zbGF0aW9uO1xuICAgICAgdGhpcy5tX21heE1vdG9yRm9yY2UgPSBkZWYubWF4TW90b3JGb3JjZTtcbiAgICAgIHRoaXMubV9tb3RvclNwZWVkID0gZGVmLm1vdG9yU3BlZWQ7XG4gICAgICB0aGlzLm1fZW5hYmxlTGltaXQgPSBkZWYuZW5hYmxlTGltaXQ7XG4gICAgICB0aGlzLm1fZW5hYmxlTW90b3IgPSBkZWYuZW5hYmxlTW90b3I7XG4gICAgICB0aGlzLm1fbGltaXRTdGF0ZSA9IGIySm9pbnQuZV9pbmFjdGl2ZUxpbWl0O1xuICAgICAgdGhpcy5tX2F4aXMuU2V0WmVybygpO1xuICAgICAgdGhpcy5tX3BlcnAuU2V0WmVybygpO1xuICAgfVxuICAgYjJQcmlzbWF0aWNKb2ludC5wcm90b3R5cGUuSW5pdFZlbG9jaXR5Q29uc3RyYWludHMgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgdmFyIGJBID0gdGhpcy5tX2JvZHlBO1xuICAgICAgdmFyIGJCID0gdGhpcy5tX2JvZHlCO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB2YXIgdFggPSAwO1xuICAgICAgdGhpcy5tX2xvY2FsQ2VudGVyQS5TZXRWKGJBLkdldExvY2FsQ2VudGVyKCkpO1xuICAgICAgdGhpcy5tX2xvY2FsQ2VudGVyQi5TZXRWKGJCLkdldExvY2FsQ2VudGVyKCkpO1xuICAgICAgdmFyIHhmMSA9IGJBLkdldFRyYW5zZm9ybSgpO1xuICAgICAgdmFyIHhmMiA9IGJCLkdldFRyYW5zZm9ybSgpO1xuICAgICAgdE1hdCA9IGJBLm1feGYuUjtcbiAgICAgIHZhciByMVggPSB0aGlzLm1fbG9jYWxBbmNob3IxLnggLSB0aGlzLm1fbG9jYWxDZW50ZXJBLng7XG4gICAgICB2YXIgcjFZID0gdGhpcy5tX2xvY2FsQW5jaG9yMS55IC0gdGhpcy5tX2xvY2FsQ2VudGVyQS55O1xuICAgICAgdFggPSAodE1hdC5jb2wxLnggKiByMVggKyB0TWF0LmNvbDIueCAqIHIxWSk7XG4gICAgICByMVkgPSAodE1hdC5jb2wxLnkgKiByMVggKyB0TWF0LmNvbDIueSAqIHIxWSk7XG4gICAgICByMVggPSB0WDtcbiAgICAgIHRNYXQgPSBiQi5tX3hmLlI7XG4gICAgICB2YXIgcjJYID0gdGhpcy5tX2xvY2FsQW5jaG9yMi54IC0gdGhpcy5tX2xvY2FsQ2VudGVyQi54O1xuICAgICAgdmFyIHIyWSA9IHRoaXMubV9sb2NhbEFuY2hvcjIueSAtIHRoaXMubV9sb2NhbENlbnRlckIueTtcbiAgICAgIHRYID0gKHRNYXQuY29sMS54ICogcjJYICsgdE1hdC5jb2wyLnggKiByMlkpO1xuICAgICAgcjJZID0gKHRNYXQuY29sMS55ICogcjJYICsgdE1hdC5jb2wyLnkgKiByMlkpO1xuICAgICAgcjJYID0gdFg7XG4gICAgICB2YXIgZFggPSBiQi5tX3N3ZWVwLmMueCArIHIyWCAtIGJBLm1fc3dlZXAuYy54IC0gcjFYO1xuICAgICAgdmFyIGRZID0gYkIubV9zd2VlcC5jLnkgKyByMlkgLSBiQS5tX3N3ZWVwLmMueSAtIHIxWTtcbiAgICAgIHRoaXMubV9pbnZNYXNzQSA9IGJBLm1faW52TWFzcztcbiAgICAgIHRoaXMubV9pbnZNYXNzQiA9IGJCLm1faW52TWFzcztcbiAgICAgIHRoaXMubV9pbnZJQSA9IGJBLm1faW52STtcbiAgICAgIHRoaXMubV9pbnZJQiA9IGJCLm1faW52STsge1xuICAgICAgICAgdGhpcy5tX2F4aXMuU2V0VihiMk1hdGguTXVsTVYoeGYxLlIsIHRoaXMubV9sb2NhbFhBeGlzMSkpO1xuICAgICAgICAgdGhpcy5tX2ExID0gKGRYICsgcjFYKSAqIHRoaXMubV9heGlzLnkgLSAoZFkgKyByMVkpICogdGhpcy5tX2F4aXMueDtcbiAgICAgICAgIHRoaXMubV9hMiA9IHIyWCAqIHRoaXMubV9heGlzLnkgLSByMlkgKiB0aGlzLm1fYXhpcy54O1xuICAgICAgICAgdGhpcy5tX21vdG9yTWFzcyA9IHRoaXMubV9pbnZNYXNzQSArIHRoaXMubV9pbnZNYXNzQiArIHRoaXMubV9pbnZJQSAqIHRoaXMubV9hMSAqIHRoaXMubV9hMSArIHRoaXMubV9pbnZJQiAqIHRoaXMubV9hMiAqIHRoaXMubV9hMjtcbiAgICAgICAgIGlmICh0aGlzLm1fbW90b3JNYXNzID4gTnVtYmVyLk1JTl9WQUxVRSkgdGhpcy5tX21vdG9yTWFzcyA9IDEuMCAvIHRoaXMubV9tb3Rvck1hc3M7XG4gICAgICB9IHtcbiAgICAgICAgIHRoaXMubV9wZXJwLlNldFYoYjJNYXRoLk11bE1WKHhmMS5SLCB0aGlzLm1fbG9jYWxZQXhpczEpKTtcbiAgICAgICAgIHRoaXMubV9zMSA9IChkWCArIHIxWCkgKiB0aGlzLm1fcGVycC55IC0gKGRZICsgcjFZKSAqIHRoaXMubV9wZXJwLng7XG4gICAgICAgICB0aGlzLm1fczIgPSByMlggKiB0aGlzLm1fcGVycC55IC0gcjJZICogdGhpcy5tX3BlcnAueDtcbiAgICAgICAgIHZhciBtMSA9IHRoaXMubV9pbnZNYXNzQTtcbiAgICAgICAgIHZhciBtMiA9IHRoaXMubV9pbnZNYXNzQjtcbiAgICAgICAgIHZhciBpMSA9IHRoaXMubV9pbnZJQTtcbiAgICAgICAgIHZhciBpMiA9IHRoaXMubV9pbnZJQjtcbiAgICAgICAgIHRoaXMubV9LLmNvbDEueCA9IG0xICsgbTIgKyBpMSAqIHRoaXMubV9zMSAqIHRoaXMubV9zMSArIGkyICogdGhpcy5tX3MyICogdGhpcy5tX3MyO1xuICAgICAgICAgdGhpcy5tX0suY29sMS55ID0gaTEgKiB0aGlzLm1fczEgKyBpMiAqIHRoaXMubV9zMjtcbiAgICAgICAgIHRoaXMubV9LLmNvbDEueiA9IGkxICogdGhpcy5tX3MxICogdGhpcy5tX2ExICsgaTIgKiB0aGlzLm1fczIgKiB0aGlzLm1fYTI7XG4gICAgICAgICB0aGlzLm1fSy5jb2wyLnggPSB0aGlzLm1fSy5jb2wxLnk7XG4gICAgICAgICB0aGlzLm1fSy5jb2wyLnkgPSBpMSArIGkyO1xuICAgICAgICAgdGhpcy5tX0suY29sMi56ID0gaTEgKiB0aGlzLm1fYTEgKyBpMiAqIHRoaXMubV9hMjtcbiAgICAgICAgIHRoaXMubV9LLmNvbDMueCA9IHRoaXMubV9LLmNvbDEuejtcbiAgICAgICAgIHRoaXMubV9LLmNvbDMueSA9IHRoaXMubV9LLmNvbDIuejtcbiAgICAgICAgIHRoaXMubV9LLmNvbDMueiA9IG0xICsgbTIgKyBpMSAqIHRoaXMubV9hMSAqIHRoaXMubV9hMSArIGkyICogdGhpcy5tX2EyICogdGhpcy5tX2EyO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMubV9lbmFibGVMaW1pdCkge1xuICAgICAgICAgdmFyIGpvaW50VHJhbnNpdGlvbiA9IHRoaXMubV9heGlzLnggKiBkWCArIHRoaXMubV9heGlzLnkgKiBkWTtcbiAgICAgICAgIGlmIChiMk1hdGguQWJzKHRoaXMubV91cHBlclRyYW5zbGF0aW9uIC0gdGhpcy5tX2xvd2VyVHJhbnNsYXRpb24pIDwgMi4wICogYjJTZXR0aW5ncy5iMl9saW5lYXJTbG9wKSB7XG4gICAgICAgICAgICB0aGlzLm1fbGltaXRTdGF0ZSA9IGIySm9pbnQuZV9lcXVhbExpbWl0cztcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2UgaWYgKGpvaW50VHJhbnNpdGlvbiA8PSB0aGlzLm1fbG93ZXJUcmFuc2xhdGlvbikge1xuICAgICAgICAgICAgaWYgKHRoaXMubV9saW1pdFN0YXRlICE9IGIySm9pbnQuZV9hdExvd2VyTGltaXQpIHtcbiAgICAgICAgICAgICAgIHRoaXMubV9saW1pdFN0YXRlID0gYjJKb2ludC5lX2F0TG93ZXJMaW1pdDtcbiAgICAgICAgICAgICAgIHRoaXMubV9pbXB1bHNlLnogPSAwLjA7XG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIGlmIChqb2ludFRyYW5zaXRpb24gPj0gdGhpcy5tX3VwcGVyVHJhbnNsYXRpb24pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1fbGltaXRTdGF0ZSAhPSBiMkpvaW50LmVfYXRVcHBlckxpbWl0KSB7XG4gICAgICAgICAgICAgICB0aGlzLm1fbGltaXRTdGF0ZSA9IGIySm9pbnQuZV9hdFVwcGVyTGltaXQ7XG4gICAgICAgICAgICAgICB0aGlzLm1faW1wdWxzZS56ID0gMC4wO1xuICAgICAgICAgICAgfVxuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm1fbGltaXRTdGF0ZSA9IGIySm9pbnQuZV9pbmFjdGl2ZUxpbWl0O1xuICAgICAgICAgICAgdGhpcy5tX2ltcHVsc2UueiA9IDAuMDtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdGhpcy5tX2xpbWl0U3RhdGUgPSBiMkpvaW50LmVfaW5hY3RpdmVMaW1pdDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm1fZW5hYmxlTW90b3IgPT0gZmFsc2UpIHtcbiAgICAgICAgIHRoaXMubV9tb3RvckltcHVsc2UgPSAwLjA7XG4gICAgICB9XG4gICAgICBpZiAoc3RlcC53YXJtU3RhcnRpbmcpIHtcbiAgICAgICAgIHRoaXMubV9pbXB1bHNlLnggKj0gc3RlcC5kdFJhdGlvO1xuICAgICAgICAgdGhpcy5tX2ltcHVsc2UueSAqPSBzdGVwLmR0UmF0aW87XG4gICAgICAgICB0aGlzLm1fbW90b3JJbXB1bHNlICo9IHN0ZXAuZHRSYXRpbztcbiAgICAgICAgIHZhciBQWCA9IHRoaXMubV9pbXB1bHNlLnggKiB0aGlzLm1fcGVycC54ICsgKHRoaXMubV9tb3RvckltcHVsc2UgKyB0aGlzLm1faW1wdWxzZS56KSAqIHRoaXMubV9heGlzLng7XG4gICAgICAgICB2YXIgUFkgPSB0aGlzLm1faW1wdWxzZS54ICogdGhpcy5tX3BlcnAueSArICh0aGlzLm1fbW90b3JJbXB1bHNlICsgdGhpcy5tX2ltcHVsc2UueikgKiB0aGlzLm1fYXhpcy55O1xuICAgICAgICAgdmFyIEwxID0gdGhpcy5tX2ltcHVsc2UueCAqIHRoaXMubV9zMSArIHRoaXMubV9pbXB1bHNlLnkgKyAodGhpcy5tX21vdG9ySW1wdWxzZSArIHRoaXMubV9pbXB1bHNlLnopICogdGhpcy5tX2ExO1xuICAgICAgICAgdmFyIEwyID0gdGhpcy5tX2ltcHVsc2UueCAqIHRoaXMubV9zMiArIHRoaXMubV9pbXB1bHNlLnkgKyAodGhpcy5tX21vdG9ySW1wdWxzZSArIHRoaXMubV9pbXB1bHNlLnopICogdGhpcy5tX2EyO1xuICAgICAgICAgYkEubV9saW5lYXJWZWxvY2l0eS54IC09IHRoaXMubV9pbnZNYXNzQSAqIFBYO1xuICAgICAgICAgYkEubV9saW5lYXJWZWxvY2l0eS55IC09IHRoaXMubV9pbnZNYXNzQSAqIFBZO1xuICAgICAgICAgYkEubV9hbmd1bGFyVmVsb2NpdHkgLT0gdGhpcy5tX2ludklBICogTDE7XG4gICAgICAgICBiQi5tX2xpbmVhclZlbG9jaXR5LnggKz0gdGhpcy5tX2ludk1hc3NCICogUFg7XG4gICAgICAgICBiQi5tX2xpbmVhclZlbG9jaXR5LnkgKz0gdGhpcy5tX2ludk1hc3NCICogUFk7XG4gICAgICAgICBiQi5tX2FuZ3VsYXJWZWxvY2l0eSArPSB0aGlzLm1faW52SUIgKiBMMjtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdGhpcy5tX2ltcHVsc2UuU2V0WmVybygpO1xuICAgICAgICAgdGhpcy5tX21vdG9ySW1wdWxzZSA9IDAuMDtcbiAgICAgIH1cbiAgIH1cbiAgIGIyUHJpc21hdGljSm9pbnQucHJvdG90eXBlLlNvbHZlVmVsb2NpdHlDb25zdHJhaW50cyA9IGZ1bmN0aW9uIChzdGVwKSB7XG4gICAgICB2YXIgYkEgPSB0aGlzLm1fYm9keUE7XG4gICAgICB2YXIgYkIgPSB0aGlzLm1fYm9keUI7XG4gICAgICB2YXIgdjEgPSBiQS5tX2xpbmVhclZlbG9jaXR5O1xuICAgICAgdmFyIHcxID0gYkEubV9hbmd1bGFyVmVsb2NpdHk7XG4gICAgICB2YXIgdjIgPSBiQi5tX2xpbmVhclZlbG9jaXR5O1xuICAgICAgdmFyIHcyID0gYkIubV9hbmd1bGFyVmVsb2NpdHk7XG4gICAgICB2YXIgUFggPSAwO1xuICAgICAgdmFyIFBZID0gMDtcbiAgICAgIHZhciBMMSA9IDA7XG4gICAgICB2YXIgTDIgPSAwO1xuICAgICAgaWYgKHRoaXMubV9lbmFibGVNb3RvciAmJiB0aGlzLm1fbGltaXRTdGF0ZSAhPSBiMkpvaW50LmVfZXF1YWxMaW1pdHMpIHtcbiAgICAgICAgIHZhciBDZG90ID0gdGhpcy5tX2F4aXMueCAqICh2Mi54IC0gdjEueCkgKyB0aGlzLm1fYXhpcy55ICogKHYyLnkgLSB2MS55KSArIHRoaXMubV9hMiAqIHcyIC0gdGhpcy5tX2ExICogdzE7XG4gICAgICAgICB2YXIgaW1wdWxzZSA9IHRoaXMubV9tb3Rvck1hc3MgKiAodGhpcy5tX21vdG9yU3BlZWQgLSBDZG90KTtcbiAgICAgICAgIHZhciBvbGRJbXB1bHNlID0gdGhpcy5tX21vdG9ySW1wdWxzZTtcbiAgICAgICAgIHZhciBtYXhJbXB1bHNlID0gc3RlcC5kdCAqIHRoaXMubV9tYXhNb3RvckZvcmNlO1xuICAgICAgICAgdGhpcy5tX21vdG9ySW1wdWxzZSA9IGIyTWF0aC5DbGFtcCh0aGlzLm1fbW90b3JJbXB1bHNlICsgaW1wdWxzZSwgKC1tYXhJbXB1bHNlKSwgbWF4SW1wdWxzZSk7XG4gICAgICAgICBpbXB1bHNlID0gdGhpcy5tX21vdG9ySW1wdWxzZSAtIG9sZEltcHVsc2U7XG4gICAgICAgICBQWCA9IGltcHVsc2UgKiB0aGlzLm1fYXhpcy54O1xuICAgICAgICAgUFkgPSBpbXB1bHNlICogdGhpcy5tX2F4aXMueTtcbiAgICAgICAgIEwxID0gaW1wdWxzZSAqIHRoaXMubV9hMTtcbiAgICAgICAgIEwyID0gaW1wdWxzZSAqIHRoaXMubV9hMjtcbiAgICAgICAgIHYxLnggLT0gdGhpcy5tX2ludk1hc3NBICogUFg7XG4gICAgICAgICB2MS55IC09IHRoaXMubV9pbnZNYXNzQSAqIFBZO1xuICAgICAgICAgdzEgLT0gdGhpcy5tX2ludklBICogTDE7XG4gICAgICAgICB2Mi54ICs9IHRoaXMubV9pbnZNYXNzQiAqIFBYO1xuICAgICAgICAgdjIueSArPSB0aGlzLm1faW52TWFzc0IgKiBQWTtcbiAgICAgICAgIHcyICs9IHRoaXMubV9pbnZJQiAqIEwyO1xuICAgICAgfVxuICAgICAgdmFyIENkb3QxWCA9IHRoaXMubV9wZXJwLnggKiAodjIueCAtIHYxLngpICsgdGhpcy5tX3BlcnAueSAqICh2Mi55IC0gdjEueSkgKyB0aGlzLm1fczIgKiB3MiAtIHRoaXMubV9zMSAqIHcxO1xuICAgICAgdmFyIENkb3QxWSA9IHcyIC0gdzE7XG4gICAgICBpZiAodGhpcy5tX2VuYWJsZUxpbWl0ICYmIHRoaXMubV9saW1pdFN0YXRlICE9IGIySm9pbnQuZV9pbmFjdGl2ZUxpbWl0KSB7XG4gICAgICAgICB2YXIgQ2RvdDIgPSB0aGlzLm1fYXhpcy54ICogKHYyLnggLSB2MS54KSArIHRoaXMubV9heGlzLnkgKiAodjIueSAtIHYxLnkpICsgdGhpcy5tX2EyICogdzIgLSB0aGlzLm1fYTEgKiB3MTtcbiAgICAgICAgIHZhciBmMSA9IHRoaXMubV9pbXB1bHNlLkNvcHkoKTtcbiAgICAgICAgIHZhciBkZiA9IHRoaXMubV9LLlNvbHZlMzMobmV3IGIyVmVjMygpLCAoLUNkb3QxWCksICgtQ2RvdDFZKSwgKC1DZG90MikpO1xuICAgICAgICAgdGhpcy5tX2ltcHVsc2UuQWRkKGRmKTtcbiAgICAgICAgIGlmICh0aGlzLm1fbGltaXRTdGF0ZSA9PSBiMkpvaW50LmVfYXRMb3dlckxpbWl0KSB7XG4gICAgICAgICAgICB0aGlzLm1faW1wdWxzZS56ID0gYjJNYXRoLk1heCh0aGlzLm1faW1wdWxzZS56LCAwLjApO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSBpZiAodGhpcy5tX2xpbWl0U3RhdGUgPT0gYjJKb2ludC5lX2F0VXBwZXJMaW1pdCkge1xuICAgICAgICAgICAgdGhpcy5tX2ltcHVsc2UueiA9IGIyTWF0aC5NaW4odGhpcy5tX2ltcHVsc2UueiwgMC4wKTtcbiAgICAgICAgIH1cbiAgICAgICAgIHZhciBiWCA9ICgtQ2RvdDFYKSAtICh0aGlzLm1faW1wdWxzZS56IC0gZjEueikgKiB0aGlzLm1fSy5jb2wzLng7XG4gICAgICAgICB2YXIgYlkgPSAoLUNkb3QxWSkgLSAodGhpcy5tX2ltcHVsc2UueiAtIGYxLnopICogdGhpcy5tX0suY29sMy55O1xuICAgICAgICAgdmFyIGYyciA9IHRoaXMubV9LLlNvbHZlMjIobmV3IGIyVmVjMigpLCBiWCwgYlkpO1xuICAgICAgICAgZjJyLnggKz0gZjEueDtcbiAgICAgICAgIGYyci55ICs9IGYxLnk7XG4gICAgICAgICB0aGlzLm1faW1wdWxzZS54ID0gZjJyLng7XG4gICAgICAgICB0aGlzLm1faW1wdWxzZS55ID0gZjJyLnk7XG4gICAgICAgICBkZi54ID0gdGhpcy5tX2ltcHVsc2UueCAtIGYxLng7XG4gICAgICAgICBkZi55ID0gdGhpcy5tX2ltcHVsc2UueSAtIGYxLnk7XG4gICAgICAgICBkZi56ID0gdGhpcy5tX2ltcHVsc2UueiAtIGYxLno7XG4gICAgICAgICBQWCA9IGRmLnggKiB0aGlzLm1fcGVycC54ICsgZGYueiAqIHRoaXMubV9heGlzLng7XG4gICAgICAgICBQWSA9IGRmLnggKiB0aGlzLm1fcGVycC55ICsgZGYueiAqIHRoaXMubV9heGlzLnk7XG4gICAgICAgICBMMSA9IGRmLnggKiB0aGlzLm1fczEgKyBkZi55ICsgZGYueiAqIHRoaXMubV9hMTtcbiAgICAgICAgIEwyID0gZGYueCAqIHRoaXMubV9zMiArIGRmLnkgKyBkZi56ICogdGhpcy5tX2EyO1xuICAgICAgICAgdjEueCAtPSB0aGlzLm1faW52TWFzc0EgKiBQWDtcbiAgICAgICAgIHYxLnkgLT0gdGhpcy5tX2ludk1hc3NBICogUFk7XG4gICAgICAgICB3MSAtPSB0aGlzLm1faW52SUEgKiBMMTtcbiAgICAgICAgIHYyLnggKz0gdGhpcy5tX2ludk1hc3NCICogUFg7XG4gICAgICAgICB2Mi55ICs9IHRoaXMubV9pbnZNYXNzQiAqIFBZO1xuICAgICAgICAgdzIgKz0gdGhpcy5tX2ludklCICogTDI7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHZhciBkZjIgPSB0aGlzLm1fSy5Tb2x2ZTIyKG5ldyBiMlZlYzIoKSwgKC1DZG90MVgpLCAoLUNkb3QxWSkpO1xuICAgICAgICAgdGhpcy5tX2ltcHVsc2UueCArPSBkZjIueDtcbiAgICAgICAgIHRoaXMubV9pbXB1bHNlLnkgKz0gZGYyLnk7XG4gICAgICAgICBQWCA9IGRmMi54ICogdGhpcy5tX3BlcnAueDtcbiAgICAgICAgIFBZID0gZGYyLnggKiB0aGlzLm1fcGVycC55O1xuICAgICAgICAgTDEgPSBkZjIueCAqIHRoaXMubV9zMSArIGRmMi55O1xuICAgICAgICAgTDIgPSBkZjIueCAqIHRoaXMubV9zMiArIGRmMi55O1xuICAgICAgICAgdjEueCAtPSB0aGlzLm1faW52TWFzc0EgKiBQWDtcbiAgICAgICAgIHYxLnkgLT0gdGhpcy5tX2ludk1hc3NBICogUFk7XG4gICAgICAgICB3MSAtPSB0aGlzLm1faW52SUEgKiBMMTtcbiAgICAgICAgIHYyLnggKz0gdGhpcy5tX2ludk1hc3NCICogUFg7XG4gICAgICAgICB2Mi55ICs9IHRoaXMubV9pbnZNYXNzQiAqIFBZO1xuICAgICAgICAgdzIgKz0gdGhpcy5tX2ludklCICogTDI7XG4gICAgICB9XG4gICAgICBiQS5tX2xpbmVhclZlbG9jaXR5LlNldFYodjEpO1xuICAgICAgYkEubV9hbmd1bGFyVmVsb2NpdHkgPSB3MTtcbiAgICAgIGJCLm1fbGluZWFyVmVsb2NpdHkuU2V0Vih2Mik7XG4gICAgICBiQi5tX2FuZ3VsYXJWZWxvY2l0eSA9IHcyO1xuICAgfVxuICAgYjJQcmlzbWF0aWNKb2ludC5wcm90b3R5cGUuU29sdmVQb3NpdGlvbkNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKGJhdW1nYXJ0ZSkge1xuICAgICAgaWYgKGJhdW1nYXJ0ZSA9PT0gdW5kZWZpbmVkKSBiYXVtZ2FydGUgPSAwO1xuICAgICAgdmFyIGxpbWl0QyA9IDA7XG4gICAgICB2YXIgb2xkTGltaXRJbXB1bHNlID0gMDtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9ib2R5QTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHZhciBjMSA9IGJBLm1fc3dlZXAuYztcbiAgICAgIHZhciBhMSA9IGJBLm1fc3dlZXAuYTtcbiAgICAgIHZhciBjMiA9IGJCLm1fc3dlZXAuYztcbiAgICAgIHZhciBhMiA9IGJCLm1fc3dlZXAuYTtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIHRYID0gMDtcbiAgICAgIHZhciBtMSA9IDA7XG4gICAgICB2YXIgbTIgPSAwO1xuICAgICAgdmFyIGkxID0gMDtcbiAgICAgIHZhciBpMiA9IDA7XG4gICAgICB2YXIgbGluZWFyRXJyb3IgPSAwLjA7XG4gICAgICB2YXIgYW5ndWxhckVycm9yID0gMC4wO1xuICAgICAgdmFyIGFjdGl2ZSA9IGZhbHNlO1xuICAgICAgdmFyIEMyID0gMC4wO1xuICAgICAgdmFyIFIxID0gYjJNYXQyMi5Gcm9tQW5nbGUoYTEpO1xuICAgICAgdmFyIFIyID0gYjJNYXQyMi5Gcm9tQW5nbGUoYTIpO1xuICAgICAgdE1hdCA9IFIxO1xuICAgICAgdmFyIHIxWCA9IHRoaXMubV9sb2NhbEFuY2hvcjEueCAtIHRoaXMubV9sb2NhbENlbnRlckEueDtcbiAgICAgIHZhciByMVkgPSB0aGlzLm1fbG9jYWxBbmNob3IxLnkgLSB0aGlzLm1fbG9jYWxDZW50ZXJBLnk7XG4gICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHIxWCArIHRNYXQuY29sMi54ICogcjFZKTtcbiAgICAgIHIxWSA9ICh0TWF0LmNvbDEueSAqIHIxWCArIHRNYXQuY29sMi55ICogcjFZKTtcbiAgICAgIHIxWCA9IHRYO1xuICAgICAgdE1hdCA9IFIyO1xuICAgICAgdmFyIHIyWCA9IHRoaXMubV9sb2NhbEFuY2hvcjIueCAtIHRoaXMubV9sb2NhbENlbnRlckIueDtcbiAgICAgIHZhciByMlkgPSB0aGlzLm1fbG9jYWxBbmNob3IyLnkgLSB0aGlzLm1fbG9jYWxDZW50ZXJCLnk7XG4gICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHIyWCArIHRNYXQuY29sMi54ICogcjJZKTtcbiAgICAgIHIyWSA9ICh0TWF0LmNvbDEueSAqIHIyWCArIHRNYXQuY29sMi55ICogcjJZKTtcbiAgICAgIHIyWCA9IHRYO1xuICAgICAgdmFyIGRYID0gYzIueCArIHIyWCAtIGMxLnggLSByMVg7XG4gICAgICB2YXIgZFkgPSBjMi55ICsgcjJZIC0gYzEueSAtIHIxWTtcbiAgICAgIGlmICh0aGlzLm1fZW5hYmxlTGltaXQpIHtcbiAgICAgICAgIHRoaXMubV9heGlzID0gYjJNYXRoLk11bE1WKFIxLCB0aGlzLm1fbG9jYWxYQXhpczEpO1xuICAgICAgICAgdGhpcy5tX2ExID0gKGRYICsgcjFYKSAqIHRoaXMubV9heGlzLnkgLSAoZFkgKyByMVkpICogdGhpcy5tX2F4aXMueDtcbiAgICAgICAgIHRoaXMubV9hMiA9IHIyWCAqIHRoaXMubV9heGlzLnkgLSByMlkgKiB0aGlzLm1fYXhpcy54O1xuICAgICAgICAgdmFyIHRyYW5zbGF0aW9uID0gdGhpcy5tX2F4aXMueCAqIGRYICsgdGhpcy5tX2F4aXMueSAqIGRZO1xuICAgICAgICAgaWYgKGIyTWF0aC5BYnModGhpcy5tX3VwcGVyVHJhbnNsYXRpb24gLSB0aGlzLm1fbG93ZXJUcmFuc2xhdGlvbikgPCAyLjAgKiBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3ApIHtcbiAgICAgICAgICAgIEMyID0gYjJNYXRoLkNsYW1wKHRyYW5zbGF0aW9uLCAoLWIyU2V0dGluZ3MuYjJfbWF4TGluZWFyQ29ycmVjdGlvbiksIGIyU2V0dGluZ3MuYjJfbWF4TGluZWFyQ29ycmVjdGlvbik7XG4gICAgICAgICAgICBsaW5lYXJFcnJvciA9IGIyTWF0aC5BYnModHJhbnNsYXRpb24pO1xuICAgICAgICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2UgaWYgKHRyYW5zbGF0aW9uIDw9IHRoaXMubV9sb3dlclRyYW5zbGF0aW9uKSB7XG4gICAgICAgICAgICBDMiA9IGIyTWF0aC5DbGFtcCh0cmFuc2xhdGlvbiAtIHRoaXMubV9sb3dlclRyYW5zbGF0aW9uICsgYjJTZXR0aW5ncy5iMl9saW5lYXJTbG9wLCAoLWIyU2V0dGluZ3MuYjJfbWF4TGluZWFyQ29ycmVjdGlvbiksIDAuMCk7XG4gICAgICAgICAgICBsaW5lYXJFcnJvciA9IHRoaXMubV9sb3dlclRyYW5zbGF0aW9uIC0gdHJhbnNsYXRpb247XG4gICAgICAgICAgICBhY3RpdmUgPSB0cnVlO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSBpZiAodHJhbnNsYXRpb24gPj0gdGhpcy5tX3VwcGVyVHJhbnNsYXRpb24pIHtcbiAgICAgICAgICAgIEMyID0gYjJNYXRoLkNsYW1wKHRyYW5zbGF0aW9uIC0gdGhpcy5tX3VwcGVyVHJhbnNsYXRpb24gKyBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3AsIDAuMCwgYjJTZXR0aW5ncy5iMl9tYXhMaW5lYXJDb3JyZWN0aW9uKTtcbiAgICAgICAgICAgIGxpbmVhckVycm9yID0gdHJhbnNsYXRpb24gLSB0aGlzLm1fdXBwZXJUcmFuc2xhdGlvbjtcbiAgICAgICAgICAgIGFjdGl2ZSA9IHRydWU7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLm1fcGVycCA9IGIyTWF0aC5NdWxNVihSMSwgdGhpcy5tX2xvY2FsWUF4aXMxKTtcbiAgICAgIHRoaXMubV9zMSA9IChkWCArIHIxWCkgKiB0aGlzLm1fcGVycC55IC0gKGRZICsgcjFZKSAqIHRoaXMubV9wZXJwLng7XG4gICAgICB0aGlzLm1fczIgPSByMlggKiB0aGlzLm1fcGVycC55IC0gcjJZICogdGhpcy5tX3BlcnAueDtcbiAgICAgIHZhciBpbXB1bHNlID0gbmV3IGIyVmVjMygpO1xuICAgICAgdmFyIEMxWCA9IHRoaXMubV9wZXJwLnggKiBkWCArIHRoaXMubV9wZXJwLnkgKiBkWTtcbiAgICAgIHZhciBDMVkgPSBhMiAtIGExIC0gdGhpcy5tX3JlZkFuZ2xlO1xuICAgICAgbGluZWFyRXJyb3IgPSBiMk1hdGguTWF4KGxpbmVhckVycm9yLCBiMk1hdGguQWJzKEMxWCkpO1xuICAgICAgYW5ndWxhckVycm9yID0gYjJNYXRoLkFicyhDMVkpO1xuICAgICAgaWYgKGFjdGl2ZSkge1xuICAgICAgICAgbTEgPSB0aGlzLm1faW52TWFzc0E7XG4gICAgICAgICBtMiA9IHRoaXMubV9pbnZNYXNzQjtcbiAgICAgICAgIGkxID0gdGhpcy5tX2ludklBO1xuICAgICAgICAgaTIgPSB0aGlzLm1faW52SUI7XG4gICAgICAgICB0aGlzLm1fSy5jb2wxLnggPSBtMSArIG0yICsgaTEgKiB0aGlzLm1fczEgKiB0aGlzLm1fczEgKyBpMiAqIHRoaXMubV9zMiAqIHRoaXMubV9zMjtcbiAgICAgICAgIHRoaXMubV9LLmNvbDEueSA9IGkxICogdGhpcy5tX3MxICsgaTIgKiB0aGlzLm1fczI7XG4gICAgICAgICB0aGlzLm1fSy5jb2wxLnogPSBpMSAqIHRoaXMubV9zMSAqIHRoaXMubV9hMSArIGkyICogdGhpcy5tX3MyICogdGhpcy5tX2EyO1xuICAgICAgICAgdGhpcy5tX0suY29sMi54ID0gdGhpcy5tX0suY29sMS55O1xuICAgICAgICAgdGhpcy5tX0suY29sMi55ID0gaTEgKyBpMjtcbiAgICAgICAgIHRoaXMubV9LLmNvbDIueiA9IGkxICogdGhpcy5tX2ExICsgaTIgKiB0aGlzLm1fYTI7XG4gICAgICAgICB0aGlzLm1fSy5jb2wzLnggPSB0aGlzLm1fSy5jb2wxLno7XG4gICAgICAgICB0aGlzLm1fSy5jb2wzLnkgPSB0aGlzLm1fSy5jb2wyLno7XG4gICAgICAgICB0aGlzLm1fSy5jb2wzLnogPSBtMSArIG0yICsgaTEgKiB0aGlzLm1fYTEgKiB0aGlzLm1fYTEgKyBpMiAqIHRoaXMubV9hMiAqIHRoaXMubV9hMjtcbiAgICAgICAgIHRoaXMubV9LLlNvbHZlMzMoaW1wdWxzZSwgKC1DMVgpLCAoLUMxWSksICgtQzIpKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgbTEgPSB0aGlzLm1faW52TWFzc0E7XG4gICAgICAgICBtMiA9IHRoaXMubV9pbnZNYXNzQjtcbiAgICAgICAgIGkxID0gdGhpcy5tX2ludklBO1xuICAgICAgICAgaTIgPSB0aGlzLm1faW52SUI7XG4gICAgICAgICB2YXIgazExID0gbTEgKyBtMiArIGkxICogdGhpcy5tX3MxICogdGhpcy5tX3MxICsgaTIgKiB0aGlzLm1fczIgKiB0aGlzLm1fczI7XG4gICAgICAgICB2YXIgazEyID0gaTEgKiB0aGlzLm1fczEgKyBpMiAqIHRoaXMubV9zMjtcbiAgICAgICAgIHZhciBrMjIgPSBpMSArIGkyO1xuICAgICAgICAgdGhpcy5tX0suY29sMS5TZXQoazExLCBrMTIsIDAuMCk7XG4gICAgICAgICB0aGlzLm1fSy5jb2wyLlNldChrMTIsIGsyMiwgMC4wKTtcbiAgICAgICAgIHZhciBpbXB1bHNlMSA9IHRoaXMubV9LLlNvbHZlMjIobmV3IGIyVmVjMigpLCAoLUMxWCksICgtQzFZKSk7XG4gICAgICAgICBpbXB1bHNlLnggPSBpbXB1bHNlMS54O1xuICAgICAgICAgaW1wdWxzZS55ID0gaW1wdWxzZTEueTtcbiAgICAgICAgIGltcHVsc2UueiA9IDAuMDtcbiAgICAgIH1cbiAgICAgIHZhciBQWCA9IGltcHVsc2UueCAqIHRoaXMubV9wZXJwLnggKyBpbXB1bHNlLnogKiB0aGlzLm1fYXhpcy54O1xuICAgICAgdmFyIFBZID0gaW1wdWxzZS54ICogdGhpcy5tX3BlcnAueSArIGltcHVsc2UueiAqIHRoaXMubV9heGlzLnk7XG4gICAgICB2YXIgTDEgPSBpbXB1bHNlLnggKiB0aGlzLm1fczEgKyBpbXB1bHNlLnkgKyBpbXB1bHNlLnogKiB0aGlzLm1fYTE7XG4gICAgICB2YXIgTDIgPSBpbXB1bHNlLnggKiB0aGlzLm1fczIgKyBpbXB1bHNlLnkgKyBpbXB1bHNlLnogKiB0aGlzLm1fYTI7XG4gICAgICBjMS54IC09IHRoaXMubV9pbnZNYXNzQSAqIFBYO1xuICAgICAgYzEueSAtPSB0aGlzLm1faW52TWFzc0EgKiBQWTtcbiAgICAgIGExIC09IHRoaXMubV9pbnZJQSAqIEwxO1xuICAgICAgYzIueCArPSB0aGlzLm1faW52TWFzc0IgKiBQWDtcbiAgICAgIGMyLnkgKz0gdGhpcy5tX2ludk1hc3NCICogUFk7XG4gICAgICBhMiArPSB0aGlzLm1faW52SUIgKiBMMjtcbiAgICAgIGJBLm1fc3dlZXAuYSA9IGExO1xuICAgICAgYkIubV9zd2VlcC5hID0gYTI7XG4gICAgICBiQS5TeW5jaHJvbml6ZVRyYW5zZm9ybSgpO1xuICAgICAgYkIuU3luY2hyb25pemVUcmFuc2Zvcm0oKTtcbiAgICAgIHJldHVybiBsaW5lYXJFcnJvciA8PSBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3AgJiYgYW5ndWxhckVycm9yIDw9IGIyU2V0dGluZ3MuYjJfYW5ndWxhclNsb3A7XG4gICB9XG4gICBCb3gyRC5pbmhlcml0KGIyUHJpc21hdGljSm9pbnREZWYsIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50RGVmKTtcbiAgIGIyUHJpc21hdGljSm9pbnREZWYucHJvdG90eXBlLl9fc3VwZXIgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludERlZi5wcm90b3R5cGU7XG4gICBiMlByaXNtYXRpY0pvaW50RGVmLmIyUHJpc21hdGljSm9pbnREZWYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludERlZi5iMkpvaW50RGVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubG9jYWxBbmNob3JCID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5sb2NhbEF4aXNBID0gbmV3IGIyVmVjMigpO1xuICAgfTtcbiAgIGIyUHJpc21hdGljSm9pbnREZWYucHJvdG90eXBlLmIyUHJpc21hdGljSm9pbnREZWYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9fc3VwZXIuYjJKb2ludERlZi5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy50eXBlID0gYjJKb2ludC5lX3ByaXNtYXRpY0pvaW50O1xuICAgICAgdGhpcy5sb2NhbEF4aXNBLlNldCgxLjAsIDAuMCk7XG4gICAgICB0aGlzLnJlZmVyZW5jZUFuZ2xlID0gMC4wO1xuICAgICAgdGhpcy5lbmFibGVMaW1pdCA9IGZhbHNlO1xuICAgICAgdGhpcy5sb3dlclRyYW5zbGF0aW9uID0gMC4wO1xuICAgICAgdGhpcy51cHBlclRyYW5zbGF0aW9uID0gMC4wO1xuICAgICAgdGhpcy5lbmFibGVNb3RvciA9IGZhbHNlO1xuICAgICAgdGhpcy5tYXhNb3RvckZvcmNlID0gMC4wO1xuICAgICAgdGhpcy5tb3RvclNwZWVkID0gMC4wO1xuICAgfVxuICAgYjJQcmlzbWF0aWNKb2ludERlZi5wcm90b3R5cGUuSW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChiQSwgYkIsIGFuY2hvciwgYXhpcykge1xuICAgICAgdGhpcy5ib2R5QSA9IGJBO1xuICAgICAgdGhpcy5ib2R5QiA9IGJCO1xuICAgICAgdGhpcy5sb2NhbEFuY2hvckEgPSB0aGlzLmJvZHlBLkdldExvY2FsUG9pbnQoYW5jaG9yKTtcbiAgICAgIHRoaXMubG9jYWxBbmNob3JCID0gdGhpcy5ib2R5Qi5HZXRMb2NhbFBvaW50KGFuY2hvcik7XG4gICAgICB0aGlzLmxvY2FsQXhpc0EgPSB0aGlzLmJvZHlBLkdldExvY2FsVmVjdG9yKGF4aXMpO1xuICAgICAgdGhpcy5yZWZlcmVuY2VBbmdsZSA9IHRoaXMuYm9keUIuR2V0QW5nbGUoKSAtIHRoaXMuYm9keUEuR2V0QW5nbGUoKTtcbiAgIH1cbiAgIEJveDJELmluaGVyaXQoYjJQdWxsZXlKb2ludCwgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQpO1xuICAgYjJQdWxsZXlKb2ludC5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LnByb3RvdHlwZTtcbiAgIGIyUHVsbGV5Sm9pbnQuYjJQdWxsZXlKb2ludCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LmIySm9pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIHRoaXMubV9ncm91bmRBbmNob3IxID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX2dyb3VuZEFuY2hvcjIgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fbG9jYWxBbmNob3IxID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX2xvY2FsQW5jaG9yMiA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV91MSA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV91MiA9IG5ldyBiMlZlYzIoKTtcbiAgIH07XG4gICBiMlB1bGxleUpvaW50LnByb3RvdHlwZS5HZXRBbmNob3JBID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5QS5HZXRXb3JsZFBvaW50KHRoaXMubV9sb2NhbEFuY2hvcjEpO1xuICAgfVxuICAgYjJQdWxsZXlKb2ludC5wcm90b3R5cGUuR2V0QW5jaG9yQiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fYm9keUIuR2V0V29ybGRQb2ludCh0aGlzLm1fbG9jYWxBbmNob3IyKTtcbiAgIH1cbiAgIGIyUHVsbGV5Sm9pbnQucHJvdG90eXBlLkdldFJlYWN0aW9uRm9yY2UgPSBmdW5jdGlvbiAoaW52X2R0KSB7XG4gICAgICBpZiAoaW52X2R0ID09PSB1bmRlZmluZWQpIGludl9kdCA9IDA7XG4gICAgICByZXR1cm4gbmV3IGIyVmVjMihpbnZfZHQgKiB0aGlzLm1faW1wdWxzZSAqIHRoaXMubV91Mi54LCBpbnZfZHQgKiB0aGlzLm1faW1wdWxzZSAqIHRoaXMubV91Mi55KTtcbiAgIH1cbiAgIGIyUHVsbGV5Sm9pbnQucHJvdG90eXBlLkdldFJlYWN0aW9uVG9ycXVlID0gZnVuY3Rpb24gKGludl9kdCkge1xuICAgICAgaWYgKGludl9kdCA9PT0gdW5kZWZpbmVkKSBpbnZfZHQgPSAwO1xuICAgICAgcmV0dXJuIDAuMDtcbiAgIH1cbiAgIGIyUHVsbGV5Sm9pbnQucHJvdG90eXBlLkdldEdyb3VuZEFuY2hvckEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgYSA9IHRoaXMubV9ncm91bmQubV94Zi5wb3NpdGlvbi5Db3B5KCk7XG4gICAgICBhLkFkZCh0aGlzLm1fZ3JvdW5kQW5jaG9yMSk7XG4gICAgICByZXR1cm4gYTtcbiAgIH1cbiAgIGIyUHVsbGV5Sm9pbnQucHJvdG90eXBlLkdldEdyb3VuZEFuY2hvckIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgYSA9IHRoaXMubV9ncm91bmQubV94Zi5wb3NpdGlvbi5Db3B5KCk7XG4gICAgICBhLkFkZCh0aGlzLm1fZ3JvdW5kQW5jaG9yMik7XG4gICAgICByZXR1cm4gYTtcbiAgIH1cbiAgIGIyUHVsbGV5Sm9pbnQucHJvdG90eXBlLkdldExlbmd0aDEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcCA9IHRoaXMubV9ib2R5QS5HZXRXb3JsZFBvaW50KHRoaXMubV9sb2NhbEFuY2hvcjEpO1xuICAgICAgdmFyIHNYID0gdGhpcy5tX2dyb3VuZC5tX3hmLnBvc2l0aW9uLnggKyB0aGlzLm1fZ3JvdW5kQW5jaG9yMS54O1xuICAgICAgdmFyIHNZID0gdGhpcy5tX2dyb3VuZC5tX3hmLnBvc2l0aW9uLnkgKyB0aGlzLm1fZ3JvdW5kQW5jaG9yMS55O1xuICAgICAgdmFyIGRYID0gcC54IC0gc1g7XG4gICAgICB2YXIgZFkgPSBwLnkgLSBzWTtcbiAgICAgIHJldHVybiBNYXRoLnNxcnQoZFggKiBkWCArIGRZICogZFkpO1xuICAgfVxuICAgYjJQdWxsZXlKb2ludC5wcm90b3R5cGUuR2V0TGVuZ3RoMiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBwID0gdGhpcy5tX2JvZHlCLkdldFdvcmxkUG9pbnQodGhpcy5tX2xvY2FsQW5jaG9yMik7XG4gICAgICB2YXIgc1ggPSB0aGlzLm1fZ3JvdW5kLm1feGYucG9zaXRpb24ueCArIHRoaXMubV9ncm91bmRBbmNob3IyLng7XG4gICAgICB2YXIgc1kgPSB0aGlzLm1fZ3JvdW5kLm1feGYucG9zaXRpb24ueSArIHRoaXMubV9ncm91bmRBbmNob3IyLnk7XG4gICAgICB2YXIgZFggPSBwLnggLSBzWDtcbiAgICAgIHZhciBkWSA9IHAueSAtIHNZO1xuICAgICAgcmV0dXJuIE1hdGguc3FydChkWCAqIGRYICsgZFkgKiBkWSk7XG4gICB9XG4gICBiMlB1bGxleUpvaW50LnByb3RvdHlwZS5HZXRSYXRpbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fcmF0aW87XG4gICB9XG4gICBiMlB1bGxleUpvaW50LnByb3RvdHlwZS5iMlB1bGxleUpvaW50ID0gZnVuY3Rpb24gKGRlZikge1xuICAgICAgdGhpcy5fX3N1cGVyLmIySm9pbnQuY2FsbCh0aGlzLCBkZWYpO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB2YXIgdFggPSAwO1xuICAgICAgdmFyIHRZID0gMDtcbiAgICAgIHRoaXMubV9ncm91bmQgPSB0aGlzLm1fYm9keUEubV93b3JsZC5tX2dyb3VuZEJvZHk7XG4gICAgICB0aGlzLm1fZ3JvdW5kQW5jaG9yMS54ID0gZGVmLmdyb3VuZEFuY2hvckEueCAtIHRoaXMubV9ncm91bmQubV94Zi5wb3NpdGlvbi54O1xuICAgICAgdGhpcy5tX2dyb3VuZEFuY2hvcjEueSA9IGRlZi5ncm91bmRBbmNob3JBLnkgLSB0aGlzLm1fZ3JvdW5kLm1feGYucG9zaXRpb24ueTtcbiAgICAgIHRoaXMubV9ncm91bmRBbmNob3IyLnggPSBkZWYuZ3JvdW5kQW5jaG9yQi54IC0gdGhpcy5tX2dyb3VuZC5tX3hmLnBvc2l0aW9uLng7XG4gICAgICB0aGlzLm1fZ3JvdW5kQW5jaG9yMi55ID0gZGVmLmdyb3VuZEFuY2hvckIueSAtIHRoaXMubV9ncm91bmQubV94Zi5wb3NpdGlvbi55O1xuICAgICAgdGhpcy5tX2xvY2FsQW5jaG9yMS5TZXRWKGRlZi5sb2NhbEFuY2hvckEpO1xuICAgICAgdGhpcy5tX2xvY2FsQW5jaG9yMi5TZXRWKGRlZi5sb2NhbEFuY2hvckIpO1xuICAgICAgdGhpcy5tX3JhdGlvID0gZGVmLnJhdGlvO1xuICAgICAgdGhpcy5tX2NvbnN0YW50ID0gZGVmLmxlbmd0aEEgKyB0aGlzLm1fcmF0aW8gKiBkZWYubGVuZ3RoQjtcbiAgICAgIHRoaXMubV9tYXhMZW5ndGgxID0gYjJNYXRoLk1pbihkZWYubWF4TGVuZ3RoQSwgdGhpcy5tX2NvbnN0YW50IC0gdGhpcy5tX3JhdGlvICogYjJQdWxsZXlKb2ludC5iMl9taW5QdWxsZXlMZW5ndGgpO1xuICAgICAgdGhpcy5tX21heExlbmd0aDIgPSBiMk1hdGguTWluKGRlZi5tYXhMZW5ndGhCLCAodGhpcy5tX2NvbnN0YW50IC0gYjJQdWxsZXlKb2ludC5iMl9taW5QdWxsZXlMZW5ndGgpIC8gdGhpcy5tX3JhdGlvKTtcbiAgICAgIHRoaXMubV9pbXB1bHNlID0gMC4wO1xuICAgICAgdGhpcy5tX2xpbWl0SW1wdWxzZTEgPSAwLjA7XG4gICAgICB0aGlzLm1fbGltaXRJbXB1bHNlMiA9IDAuMDtcbiAgIH1cbiAgIGIyUHVsbGV5Sm9pbnQucHJvdG90eXBlLkluaXRWZWxvY2l0eUNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKHN0ZXApIHtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9ib2R5QTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdE1hdCA9IGJBLm1feGYuUjtcbiAgICAgIHZhciByMVggPSB0aGlzLm1fbG9jYWxBbmNob3IxLnggLSBiQS5tX3N3ZWVwLmxvY2FsQ2VudGVyLng7XG4gICAgICB2YXIgcjFZID0gdGhpcy5tX2xvY2FsQW5jaG9yMS55IC0gYkEubV9zd2VlcC5sb2NhbENlbnRlci55O1xuICAgICAgdmFyIHRYID0gKHRNYXQuY29sMS54ICogcjFYICsgdE1hdC5jb2wyLnggKiByMVkpO1xuICAgICAgcjFZID0gKHRNYXQuY29sMS55ICogcjFYICsgdE1hdC5jb2wyLnkgKiByMVkpO1xuICAgICAgcjFYID0gdFg7XG4gICAgICB0TWF0ID0gYkIubV94Zi5SO1xuICAgICAgdmFyIHIyWCA9IHRoaXMubV9sb2NhbEFuY2hvcjIueCAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgIHZhciByMlkgPSB0aGlzLm1fbG9jYWxBbmNob3IyLnkgLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHIyWCArIHRNYXQuY29sMi54ICogcjJZKTtcbiAgICAgIHIyWSA9ICh0TWF0LmNvbDEueSAqIHIyWCArIHRNYXQuY29sMi55ICogcjJZKTtcbiAgICAgIHIyWCA9IHRYO1xuICAgICAgdmFyIHAxWCA9IGJBLm1fc3dlZXAuYy54ICsgcjFYO1xuICAgICAgdmFyIHAxWSA9IGJBLm1fc3dlZXAuYy55ICsgcjFZO1xuICAgICAgdmFyIHAyWCA9IGJCLm1fc3dlZXAuYy54ICsgcjJYO1xuICAgICAgdmFyIHAyWSA9IGJCLm1fc3dlZXAuYy55ICsgcjJZO1xuICAgICAgdmFyIHMxWCA9IHRoaXMubV9ncm91bmQubV94Zi5wb3NpdGlvbi54ICsgdGhpcy5tX2dyb3VuZEFuY2hvcjEueDtcbiAgICAgIHZhciBzMVkgPSB0aGlzLm1fZ3JvdW5kLm1feGYucG9zaXRpb24ueSArIHRoaXMubV9ncm91bmRBbmNob3IxLnk7XG4gICAgICB2YXIgczJYID0gdGhpcy5tX2dyb3VuZC5tX3hmLnBvc2l0aW9uLnggKyB0aGlzLm1fZ3JvdW5kQW5jaG9yMi54O1xuICAgICAgdmFyIHMyWSA9IHRoaXMubV9ncm91bmQubV94Zi5wb3NpdGlvbi55ICsgdGhpcy5tX2dyb3VuZEFuY2hvcjIueTtcbiAgICAgIHRoaXMubV91MS5TZXQocDFYIC0gczFYLCBwMVkgLSBzMVkpO1xuICAgICAgdGhpcy5tX3UyLlNldChwMlggLSBzMlgsIHAyWSAtIHMyWSk7XG4gICAgICB2YXIgbGVuZ3RoMSA9IHRoaXMubV91MS5MZW5ndGgoKTtcbiAgICAgIHZhciBsZW5ndGgyID0gdGhpcy5tX3UyLkxlbmd0aCgpO1xuICAgICAgaWYgKGxlbmd0aDEgPiBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3ApIHtcbiAgICAgICAgIHRoaXMubV91MS5NdWx0aXBseSgxLjAgLyBsZW5ndGgxKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdGhpcy5tX3UxLlNldFplcm8oKTtcbiAgICAgIH1cbiAgICAgIGlmIChsZW5ndGgyID4gYjJTZXR0aW5ncy5iMl9saW5lYXJTbG9wKSB7XG4gICAgICAgICB0aGlzLm1fdTIuTXVsdGlwbHkoMS4wIC8gbGVuZ3RoMik7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV91Mi5TZXRaZXJvKCk7XG4gICAgICB9XG4gICAgICB2YXIgQyA9IHRoaXMubV9jb25zdGFudCAtIGxlbmd0aDEgLSB0aGlzLm1fcmF0aW8gKiBsZW5ndGgyO1xuICAgICAgaWYgKEMgPiAwLjApIHtcbiAgICAgICAgIHRoaXMubV9zdGF0ZSA9IGIySm9pbnQuZV9pbmFjdGl2ZUxpbWl0O1xuICAgICAgICAgdGhpcy5tX2ltcHVsc2UgPSAwLjA7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgIHRoaXMubV9zdGF0ZSA9IGIySm9pbnQuZV9hdFVwcGVyTGltaXQ7XG4gICAgICB9XG4gICAgICBpZiAobGVuZ3RoMSA8IHRoaXMubV9tYXhMZW5ndGgxKSB7XG4gICAgICAgICB0aGlzLm1fbGltaXRTdGF0ZTEgPSBiMkpvaW50LmVfaW5hY3RpdmVMaW1pdDtcbiAgICAgICAgIHRoaXMubV9saW1pdEltcHVsc2UxID0gMC4wO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICB0aGlzLm1fbGltaXRTdGF0ZTEgPSBiMkpvaW50LmVfYXRVcHBlckxpbWl0O1xuICAgICAgfVxuICAgICAgaWYgKGxlbmd0aDIgPCB0aGlzLm1fbWF4TGVuZ3RoMikge1xuICAgICAgICAgdGhpcy5tX2xpbWl0U3RhdGUyID0gYjJKb2ludC5lX2luYWN0aXZlTGltaXQ7XG4gICAgICAgICB0aGlzLm1fbGltaXRJbXB1bHNlMiA9IDAuMDtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdGhpcy5tX2xpbWl0U3RhdGUyID0gYjJKb2ludC5lX2F0VXBwZXJMaW1pdDtcbiAgICAgIH1cbiAgICAgIHZhciBjcjF1MSA9IHIxWCAqIHRoaXMubV91MS55IC0gcjFZICogdGhpcy5tX3UxLng7XG4gICAgICB2YXIgY3IydTIgPSByMlggKiB0aGlzLm1fdTIueSAtIHIyWSAqIHRoaXMubV91Mi54O1xuICAgICAgdGhpcy5tX2xpbWl0TWFzczEgPSBiQS5tX2ludk1hc3MgKyBiQS5tX2ludkkgKiBjcjF1MSAqIGNyMXUxO1xuICAgICAgdGhpcy5tX2xpbWl0TWFzczIgPSBiQi5tX2ludk1hc3MgKyBiQi5tX2ludkkgKiBjcjJ1MiAqIGNyMnUyO1xuICAgICAgdGhpcy5tX3B1bGxleU1hc3MgPSB0aGlzLm1fbGltaXRNYXNzMSArIHRoaXMubV9yYXRpbyAqIHRoaXMubV9yYXRpbyAqIHRoaXMubV9saW1pdE1hc3MyO1xuICAgICAgdGhpcy5tX2xpbWl0TWFzczEgPSAxLjAgLyB0aGlzLm1fbGltaXRNYXNzMTtcbiAgICAgIHRoaXMubV9saW1pdE1hc3MyID0gMS4wIC8gdGhpcy5tX2xpbWl0TWFzczI7XG4gICAgICB0aGlzLm1fcHVsbGV5TWFzcyA9IDEuMCAvIHRoaXMubV9wdWxsZXlNYXNzO1xuICAgICAgaWYgKHN0ZXAud2FybVN0YXJ0aW5nKSB7XG4gICAgICAgICB0aGlzLm1faW1wdWxzZSAqPSBzdGVwLmR0UmF0aW87XG4gICAgICAgICB0aGlzLm1fbGltaXRJbXB1bHNlMSAqPSBzdGVwLmR0UmF0aW87XG4gICAgICAgICB0aGlzLm1fbGltaXRJbXB1bHNlMiAqPSBzdGVwLmR0UmF0aW87XG4gICAgICAgICB2YXIgUDFYID0gKCgtdGhpcy5tX2ltcHVsc2UpIC0gdGhpcy5tX2xpbWl0SW1wdWxzZTEpICogdGhpcy5tX3UxLng7XG4gICAgICAgICB2YXIgUDFZID0gKCgtdGhpcy5tX2ltcHVsc2UpIC0gdGhpcy5tX2xpbWl0SW1wdWxzZTEpICogdGhpcy5tX3UxLnk7XG4gICAgICAgICB2YXIgUDJYID0gKCgtdGhpcy5tX3JhdGlvICogdGhpcy5tX2ltcHVsc2UpIC0gdGhpcy5tX2xpbWl0SW1wdWxzZTIpICogdGhpcy5tX3UyLng7XG4gICAgICAgICB2YXIgUDJZID0gKCgtdGhpcy5tX3JhdGlvICogdGhpcy5tX2ltcHVsc2UpIC0gdGhpcy5tX2xpbWl0SW1wdWxzZTIpICogdGhpcy5tX3UyLnk7XG4gICAgICAgICBiQS5tX2xpbmVhclZlbG9jaXR5LnggKz0gYkEubV9pbnZNYXNzICogUDFYO1xuICAgICAgICAgYkEubV9saW5lYXJWZWxvY2l0eS55ICs9IGJBLm1faW52TWFzcyAqIFAxWTtcbiAgICAgICAgIGJBLm1fYW5ndWxhclZlbG9jaXR5ICs9IGJBLm1faW52SSAqIChyMVggKiBQMVkgLSByMVkgKiBQMVgpO1xuICAgICAgICAgYkIubV9saW5lYXJWZWxvY2l0eS54ICs9IGJCLm1faW52TWFzcyAqIFAyWDtcbiAgICAgICAgIGJCLm1fbGluZWFyVmVsb2NpdHkueSArPSBiQi5tX2ludk1hc3MgKiBQMlk7XG4gICAgICAgICBiQi5tX2FuZ3VsYXJWZWxvY2l0eSArPSBiQi5tX2ludkkgKiAocjJYICogUDJZIC0gcjJZICogUDJYKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdGhpcy5tX2ltcHVsc2UgPSAwLjA7XG4gICAgICAgICB0aGlzLm1fbGltaXRJbXB1bHNlMSA9IDAuMDtcbiAgICAgICAgIHRoaXMubV9saW1pdEltcHVsc2UyID0gMC4wO1xuICAgICAgfVxuICAgfVxuICAgYjJQdWxsZXlKb2ludC5wcm90b3R5cGUuU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKHN0ZXApIHtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9ib2R5QTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdE1hdCA9IGJBLm1feGYuUjtcbiAgICAgIHZhciByMVggPSB0aGlzLm1fbG9jYWxBbmNob3IxLnggLSBiQS5tX3N3ZWVwLmxvY2FsQ2VudGVyLng7XG4gICAgICB2YXIgcjFZID0gdGhpcy5tX2xvY2FsQW5jaG9yMS55IC0gYkEubV9zd2VlcC5sb2NhbENlbnRlci55O1xuICAgICAgdmFyIHRYID0gKHRNYXQuY29sMS54ICogcjFYICsgdE1hdC5jb2wyLnggKiByMVkpO1xuICAgICAgcjFZID0gKHRNYXQuY29sMS55ICogcjFYICsgdE1hdC5jb2wyLnkgKiByMVkpO1xuICAgICAgcjFYID0gdFg7XG4gICAgICB0TWF0ID0gYkIubV94Zi5SO1xuICAgICAgdmFyIHIyWCA9IHRoaXMubV9sb2NhbEFuY2hvcjIueCAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgIHZhciByMlkgPSB0aGlzLm1fbG9jYWxBbmNob3IyLnkgLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHIyWCArIHRNYXQuY29sMi54ICogcjJZKTtcbiAgICAgIHIyWSA9ICh0TWF0LmNvbDEueSAqIHIyWCArIHRNYXQuY29sMi55ICogcjJZKTtcbiAgICAgIHIyWCA9IHRYO1xuICAgICAgdmFyIHYxWCA9IDA7XG4gICAgICB2YXIgdjFZID0gMDtcbiAgICAgIHZhciB2MlggPSAwO1xuICAgICAgdmFyIHYyWSA9IDA7XG4gICAgICB2YXIgUDFYID0gMDtcbiAgICAgIHZhciBQMVkgPSAwO1xuICAgICAgdmFyIFAyWCA9IDA7XG4gICAgICB2YXIgUDJZID0gMDtcbiAgICAgIHZhciBDZG90ID0gMDtcbiAgICAgIHZhciBpbXB1bHNlID0gMDtcbiAgICAgIHZhciBvbGRJbXB1bHNlID0gMDtcbiAgICAgIGlmICh0aGlzLm1fc3RhdGUgPT0gYjJKb2ludC5lX2F0VXBwZXJMaW1pdCkge1xuICAgICAgICAgdjFYID0gYkEubV9saW5lYXJWZWxvY2l0eS54ICsgKCgtYkEubV9hbmd1bGFyVmVsb2NpdHkgKiByMVkpKTtcbiAgICAgICAgIHYxWSA9IGJBLm1fbGluZWFyVmVsb2NpdHkueSArIChiQS5tX2FuZ3VsYXJWZWxvY2l0eSAqIHIxWCk7XG4gICAgICAgICB2MlggPSBiQi5tX2xpbmVhclZlbG9jaXR5LnggKyAoKC1iQi5tX2FuZ3VsYXJWZWxvY2l0eSAqIHIyWSkpO1xuICAgICAgICAgdjJZID0gYkIubV9saW5lYXJWZWxvY2l0eS55ICsgKGJCLm1fYW5ndWxhclZlbG9jaXR5ICogcjJYKTtcbiAgICAgICAgIENkb3QgPSAoLSh0aGlzLm1fdTEueCAqIHYxWCArIHRoaXMubV91MS55ICogdjFZKSkgLSB0aGlzLm1fcmF0aW8gKiAodGhpcy5tX3UyLnggKiB2MlggKyB0aGlzLm1fdTIueSAqIHYyWSk7XG4gICAgICAgICBpbXB1bHNlID0gdGhpcy5tX3B1bGxleU1hc3MgKiAoKC1DZG90KSk7XG4gICAgICAgICBvbGRJbXB1bHNlID0gdGhpcy5tX2ltcHVsc2U7XG4gICAgICAgICB0aGlzLm1faW1wdWxzZSA9IGIyTWF0aC5NYXgoMC4wLCB0aGlzLm1faW1wdWxzZSArIGltcHVsc2UpO1xuICAgICAgICAgaW1wdWxzZSA9IHRoaXMubV9pbXB1bHNlIC0gb2xkSW1wdWxzZTtcbiAgICAgICAgIFAxWCA9ICgtaW1wdWxzZSAqIHRoaXMubV91MS54KTtcbiAgICAgICAgIFAxWSA9ICgtaW1wdWxzZSAqIHRoaXMubV91MS55KTtcbiAgICAgICAgIFAyWCA9ICgtdGhpcy5tX3JhdGlvICogaW1wdWxzZSAqIHRoaXMubV91Mi54KTtcbiAgICAgICAgIFAyWSA9ICgtdGhpcy5tX3JhdGlvICogaW1wdWxzZSAqIHRoaXMubV91Mi55KTtcbiAgICAgICAgIGJBLm1fbGluZWFyVmVsb2NpdHkueCArPSBiQS5tX2ludk1hc3MgKiBQMVg7XG4gICAgICAgICBiQS5tX2xpbmVhclZlbG9jaXR5LnkgKz0gYkEubV9pbnZNYXNzICogUDFZO1xuICAgICAgICAgYkEubV9hbmd1bGFyVmVsb2NpdHkgKz0gYkEubV9pbnZJICogKHIxWCAqIFAxWSAtIHIxWSAqIFAxWCk7XG4gICAgICAgICBiQi5tX2xpbmVhclZlbG9jaXR5LnggKz0gYkIubV9pbnZNYXNzICogUDJYO1xuICAgICAgICAgYkIubV9saW5lYXJWZWxvY2l0eS55ICs9IGJCLm1faW52TWFzcyAqIFAyWTtcbiAgICAgICAgIGJCLm1fYW5ndWxhclZlbG9jaXR5ICs9IGJCLm1faW52SSAqIChyMlggKiBQMlkgLSByMlkgKiBQMlgpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMubV9saW1pdFN0YXRlMSA9PSBiMkpvaW50LmVfYXRVcHBlckxpbWl0KSB7XG4gICAgICAgICB2MVggPSBiQS5tX2xpbmVhclZlbG9jaXR5LnggKyAoKC1iQS5tX2FuZ3VsYXJWZWxvY2l0eSAqIHIxWSkpO1xuICAgICAgICAgdjFZID0gYkEubV9saW5lYXJWZWxvY2l0eS55ICsgKGJBLm1fYW5ndWxhclZlbG9jaXR5ICogcjFYKTtcbiAgICAgICAgIENkb3QgPSAoLSh0aGlzLm1fdTEueCAqIHYxWCArIHRoaXMubV91MS55ICogdjFZKSk7XG4gICAgICAgICBpbXB1bHNlID0gKC10aGlzLm1fbGltaXRNYXNzMSAqIENkb3QpO1xuICAgICAgICAgb2xkSW1wdWxzZSA9IHRoaXMubV9saW1pdEltcHVsc2UxO1xuICAgICAgICAgdGhpcy5tX2xpbWl0SW1wdWxzZTEgPSBiMk1hdGguTWF4KDAuMCwgdGhpcy5tX2xpbWl0SW1wdWxzZTEgKyBpbXB1bHNlKTtcbiAgICAgICAgIGltcHVsc2UgPSB0aGlzLm1fbGltaXRJbXB1bHNlMSAtIG9sZEltcHVsc2U7XG4gICAgICAgICBQMVggPSAoLWltcHVsc2UgKiB0aGlzLm1fdTEueCk7XG4gICAgICAgICBQMVkgPSAoLWltcHVsc2UgKiB0aGlzLm1fdTEueSk7XG4gICAgICAgICBiQS5tX2xpbmVhclZlbG9jaXR5LnggKz0gYkEubV9pbnZNYXNzICogUDFYO1xuICAgICAgICAgYkEubV9saW5lYXJWZWxvY2l0eS55ICs9IGJBLm1faW52TWFzcyAqIFAxWTtcbiAgICAgICAgIGJBLm1fYW5ndWxhclZlbG9jaXR5ICs9IGJBLm1faW52SSAqIChyMVggKiBQMVkgLSByMVkgKiBQMVgpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMubV9saW1pdFN0YXRlMiA9PSBiMkpvaW50LmVfYXRVcHBlckxpbWl0KSB7XG4gICAgICAgICB2MlggPSBiQi5tX2xpbmVhclZlbG9jaXR5LnggKyAoKC1iQi5tX2FuZ3VsYXJWZWxvY2l0eSAqIHIyWSkpO1xuICAgICAgICAgdjJZID0gYkIubV9saW5lYXJWZWxvY2l0eS55ICsgKGJCLm1fYW5ndWxhclZlbG9jaXR5ICogcjJYKTtcbiAgICAgICAgIENkb3QgPSAoLSh0aGlzLm1fdTIueCAqIHYyWCArIHRoaXMubV91Mi55ICogdjJZKSk7XG4gICAgICAgICBpbXB1bHNlID0gKC10aGlzLm1fbGltaXRNYXNzMiAqIENkb3QpO1xuICAgICAgICAgb2xkSW1wdWxzZSA9IHRoaXMubV9saW1pdEltcHVsc2UyO1xuICAgICAgICAgdGhpcy5tX2xpbWl0SW1wdWxzZTIgPSBiMk1hdGguTWF4KDAuMCwgdGhpcy5tX2xpbWl0SW1wdWxzZTIgKyBpbXB1bHNlKTtcbiAgICAgICAgIGltcHVsc2UgPSB0aGlzLm1fbGltaXRJbXB1bHNlMiAtIG9sZEltcHVsc2U7XG4gICAgICAgICBQMlggPSAoLWltcHVsc2UgKiB0aGlzLm1fdTIueCk7XG4gICAgICAgICBQMlkgPSAoLWltcHVsc2UgKiB0aGlzLm1fdTIueSk7XG4gICAgICAgICBiQi5tX2xpbmVhclZlbG9jaXR5LnggKz0gYkIubV9pbnZNYXNzICogUDJYO1xuICAgICAgICAgYkIubV9saW5lYXJWZWxvY2l0eS55ICs9IGJCLm1faW52TWFzcyAqIFAyWTtcbiAgICAgICAgIGJCLm1fYW5ndWxhclZlbG9jaXR5ICs9IGJCLm1faW52SSAqIChyMlggKiBQMlkgLSByMlkgKiBQMlgpO1xuICAgICAgfVxuICAgfVxuICAgYjJQdWxsZXlKb2ludC5wcm90b3R5cGUuU29sdmVQb3NpdGlvbkNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKGJhdW1nYXJ0ZSkge1xuICAgICAgaWYgKGJhdW1nYXJ0ZSA9PT0gdW5kZWZpbmVkKSBiYXVtZ2FydGUgPSAwO1xuICAgICAgdmFyIGJBID0gdGhpcy5tX2JvZHlBO1xuICAgICAgdmFyIGJCID0gdGhpcy5tX2JvZHlCO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB2YXIgczFYID0gdGhpcy5tX2dyb3VuZC5tX3hmLnBvc2l0aW9uLnggKyB0aGlzLm1fZ3JvdW5kQW5jaG9yMS54O1xuICAgICAgdmFyIHMxWSA9IHRoaXMubV9ncm91bmQubV94Zi5wb3NpdGlvbi55ICsgdGhpcy5tX2dyb3VuZEFuY2hvcjEueTtcbiAgICAgIHZhciBzMlggPSB0aGlzLm1fZ3JvdW5kLm1feGYucG9zaXRpb24ueCArIHRoaXMubV9ncm91bmRBbmNob3IyLng7XG4gICAgICB2YXIgczJZID0gdGhpcy5tX2dyb3VuZC5tX3hmLnBvc2l0aW9uLnkgKyB0aGlzLm1fZ3JvdW5kQW5jaG9yMi55O1xuICAgICAgdmFyIHIxWCA9IDA7XG4gICAgICB2YXIgcjFZID0gMDtcbiAgICAgIHZhciByMlggPSAwO1xuICAgICAgdmFyIHIyWSA9IDA7XG4gICAgICB2YXIgcDFYID0gMDtcbiAgICAgIHZhciBwMVkgPSAwO1xuICAgICAgdmFyIHAyWCA9IDA7XG4gICAgICB2YXIgcDJZID0gMDtcbiAgICAgIHZhciBsZW5ndGgxID0gMDtcbiAgICAgIHZhciBsZW5ndGgyID0gMDtcbiAgICAgIHZhciBDID0gMDtcbiAgICAgIHZhciBpbXB1bHNlID0gMDtcbiAgICAgIHZhciBvbGRJbXB1bHNlID0gMDtcbiAgICAgIHZhciBvbGRMaW1pdFBvc2l0aW9uSW1wdWxzZSA9IDA7XG4gICAgICB2YXIgdFggPSAwO1xuICAgICAgdmFyIGxpbmVhckVycm9yID0gMC4wO1xuICAgICAgaWYgKHRoaXMubV9zdGF0ZSA9PSBiMkpvaW50LmVfYXRVcHBlckxpbWl0KSB7XG4gICAgICAgICB0TWF0ID0gYkEubV94Zi5SO1xuICAgICAgICAgcjFYID0gdGhpcy5tX2xvY2FsQW5jaG9yMS54IC0gYkEubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgICAgcjFZID0gdGhpcy5tX2xvY2FsQW5jaG9yMS55IC0gYkEubV9zd2VlcC5sb2NhbENlbnRlci55O1xuICAgICAgICAgdFggPSAodE1hdC5jb2wxLnggKiByMVggKyB0TWF0LmNvbDIueCAqIHIxWSk7XG4gICAgICAgICByMVkgPSAodE1hdC5jb2wxLnkgKiByMVggKyB0TWF0LmNvbDIueSAqIHIxWSk7XG4gICAgICAgICByMVggPSB0WDtcbiAgICAgICAgIHRNYXQgPSBiQi5tX3hmLlI7XG4gICAgICAgICByMlggPSB0aGlzLm1fbG9jYWxBbmNob3IyLnggLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLng7XG4gICAgICAgICByMlkgPSB0aGlzLm1fbG9jYWxBbmNob3IyLnkgLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHIyWCArIHRNYXQuY29sMi54ICogcjJZKTtcbiAgICAgICAgIHIyWSA9ICh0TWF0LmNvbDEueSAqIHIyWCArIHRNYXQuY29sMi55ICogcjJZKTtcbiAgICAgICAgIHIyWCA9IHRYO1xuICAgICAgICAgcDFYID0gYkEubV9zd2VlcC5jLnggKyByMVg7XG4gICAgICAgICBwMVkgPSBiQS5tX3N3ZWVwLmMueSArIHIxWTtcbiAgICAgICAgIHAyWCA9IGJCLm1fc3dlZXAuYy54ICsgcjJYO1xuICAgICAgICAgcDJZID0gYkIubV9zd2VlcC5jLnkgKyByMlk7XG4gICAgICAgICB0aGlzLm1fdTEuU2V0KHAxWCAtIHMxWCwgcDFZIC0gczFZKTtcbiAgICAgICAgIHRoaXMubV91Mi5TZXQocDJYIC0gczJYLCBwMlkgLSBzMlkpO1xuICAgICAgICAgbGVuZ3RoMSA9IHRoaXMubV91MS5MZW5ndGgoKTtcbiAgICAgICAgIGxlbmd0aDIgPSB0aGlzLm1fdTIuTGVuZ3RoKCk7XG4gICAgICAgICBpZiAobGVuZ3RoMSA+IGIyU2V0dGluZ3MuYjJfbGluZWFyU2xvcCkge1xuICAgICAgICAgICAgdGhpcy5tX3UxLk11bHRpcGx5KDEuMCAvIGxlbmd0aDEpO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm1fdTEuU2V0WmVybygpO1xuICAgICAgICAgfVxuICAgICAgICAgaWYgKGxlbmd0aDIgPiBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3ApIHtcbiAgICAgICAgICAgIHRoaXMubV91Mi5NdWx0aXBseSgxLjAgLyBsZW5ndGgyKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tX3UyLlNldFplcm8oKTtcbiAgICAgICAgIH1cbiAgICAgICAgIEMgPSB0aGlzLm1fY29uc3RhbnQgLSBsZW5ndGgxIC0gdGhpcy5tX3JhdGlvICogbGVuZ3RoMjtcbiAgICAgICAgIGxpbmVhckVycm9yID0gYjJNYXRoLk1heChsaW5lYXJFcnJvciwgKC1DKSk7XG4gICAgICAgICBDID0gYjJNYXRoLkNsYW1wKEMgKyBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3AsICgtYjJTZXR0aW5ncy5iMl9tYXhMaW5lYXJDb3JyZWN0aW9uKSwgMC4wKTtcbiAgICAgICAgIGltcHVsc2UgPSAoLXRoaXMubV9wdWxsZXlNYXNzICogQyk7XG4gICAgICAgICBwMVggPSAoLWltcHVsc2UgKiB0aGlzLm1fdTEueCk7XG4gICAgICAgICBwMVkgPSAoLWltcHVsc2UgKiB0aGlzLm1fdTEueSk7XG4gICAgICAgICBwMlggPSAoLXRoaXMubV9yYXRpbyAqIGltcHVsc2UgKiB0aGlzLm1fdTIueCk7XG4gICAgICAgICBwMlkgPSAoLXRoaXMubV9yYXRpbyAqIGltcHVsc2UgKiB0aGlzLm1fdTIueSk7XG4gICAgICAgICBiQS5tX3N3ZWVwLmMueCArPSBiQS5tX2ludk1hc3MgKiBwMVg7XG4gICAgICAgICBiQS5tX3N3ZWVwLmMueSArPSBiQS5tX2ludk1hc3MgKiBwMVk7XG4gICAgICAgICBiQS5tX3N3ZWVwLmEgKz0gYkEubV9pbnZJICogKHIxWCAqIHAxWSAtIHIxWSAqIHAxWCk7XG4gICAgICAgICBiQi5tX3N3ZWVwLmMueCArPSBiQi5tX2ludk1hc3MgKiBwMlg7XG4gICAgICAgICBiQi5tX3N3ZWVwLmMueSArPSBiQi5tX2ludk1hc3MgKiBwMlk7XG4gICAgICAgICBiQi5tX3N3ZWVwLmEgKz0gYkIubV9pbnZJICogKHIyWCAqIHAyWSAtIHIyWSAqIHAyWCk7XG4gICAgICAgICBiQS5TeW5jaHJvbml6ZVRyYW5zZm9ybSgpO1xuICAgICAgICAgYkIuU3luY2hyb25pemVUcmFuc2Zvcm0oKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm1fbGltaXRTdGF0ZTEgPT0gYjJKb2ludC5lX2F0VXBwZXJMaW1pdCkge1xuICAgICAgICAgdE1hdCA9IGJBLm1feGYuUjtcbiAgICAgICAgIHIxWCA9IHRoaXMubV9sb2NhbEFuY2hvcjEueCAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgICAgIHIxWSA9IHRoaXMubV9sb2NhbEFuY2hvcjEueSAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgICAgIHRYID0gKHRNYXQuY29sMS54ICogcjFYICsgdE1hdC5jb2wyLnggKiByMVkpO1xuICAgICAgICAgcjFZID0gKHRNYXQuY29sMS55ICogcjFYICsgdE1hdC5jb2wyLnkgKiByMVkpO1xuICAgICAgICAgcjFYID0gdFg7XG4gICAgICAgICBwMVggPSBiQS5tX3N3ZWVwLmMueCArIHIxWDtcbiAgICAgICAgIHAxWSA9IGJBLm1fc3dlZXAuYy55ICsgcjFZO1xuICAgICAgICAgdGhpcy5tX3UxLlNldChwMVggLSBzMVgsIHAxWSAtIHMxWSk7XG4gICAgICAgICBsZW5ndGgxID0gdGhpcy5tX3UxLkxlbmd0aCgpO1xuICAgICAgICAgaWYgKGxlbmd0aDEgPiBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3ApIHtcbiAgICAgICAgICAgIHRoaXMubV91MS54ICo9IDEuMCAvIGxlbmd0aDE7XG4gICAgICAgICAgICB0aGlzLm1fdTEueSAqPSAxLjAgLyBsZW5ndGgxO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm1fdTEuU2V0WmVybygpO1xuICAgICAgICAgfVxuICAgICAgICAgQyA9IHRoaXMubV9tYXhMZW5ndGgxIC0gbGVuZ3RoMTtcbiAgICAgICAgIGxpbmVhckVycm9yID0gYjJNYXRoLk1heChsaW5lYXJFcnJvciwgKC1DKSk7XG4gICAgICAgICBDID0gYjJNYXRoLkNsYW1wKEMgKyBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3AsICgtYjJTZXR0aW5ncy5iMl9tYXhMaW5lYXJDb3JyZWN0aW9uKSwgMC4wKTtcbiAgICAgICAgIGltcHVsc2UgPSAoLXRoaXMubV9saW1pdE1hc3MxICogQyk7XG4gICAgICAgICBwMVggPSAoLWltcHVsc2UgKiB0aGlzLm1fdTEueCk7XG4gICAgICAgICBwMVkgPSAoLWltcHVsc2UgKiB0aGlzLm1fdTEueSk7XG4gICAgICAgICBiQS5tX3N3ZWVwLmMueCArPSBiQS5tX2ludk1hc3MgKiBwMVg7XG4gICAgICAgICBiQS5tX3N3ZWVwLmMueSArPSBiQS5tX2ludk1hc3MgKiBwMVk7XG4gICAgICAgICBiQS5tX3N3ZWVwLmEgKz0gYkEubV9pbnZJICogKHIxWCAqIHAxWSAtIHIxWSAqIHAxWCk7XG4gICAgICAgICBiQS5TeW5jaHJvbml6ZVRyYW5zZm9ybSgpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMubV9saW1pdFN0YXRlMiA9PSBiMkpvaW50LmVfYXRVcHBlckxpbWl0KSB7XG4gICAgICAgICB0TWF0ID0gYkIubV94Zi5SO1xuICAgICAgICAgcjJYID0gdGhpcy5tX2xvY2FsQW5jaG9yMi54IC0gYkIubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgICAgcjJZID0gdGhpcy5tX2xvY2FsQW5jaG9yMi55IC0gYkIubV9zd2VlcC5sb2NhbENlbnRlci55O1xuICAgICAgICAgdFggPSAodE1hdC5jb2wxLnggKiByMlggKyB0TWF0LmNvbDIueCAqIHIyWSk7XG4gICAgICAgICByMlkgPSAodE1hdC5jb2wxLnkgKiByMlggKyB0TWF0LmNvbDIueSAqIHIyWSk7XG4gICAgICAgICByMlggPSB0WDtcbiAgICAgICAgIHAyWCA9IGJCLm1fc3dlZXAuYy54ICsgcjJYO1xuICAgICAgICAgcDJZID0gYkIubV9zd2VlcC5jLnkgKyByMlk7XG4gICAgICAgICB0aGlzLm1fdTIuU2V0KHAyWCAtIHMyWCwgcDJZIC0gczJZKTtcbiAgICAgICAgIGxlbmd0aDIgPSB0aGlzLm1fdTIuTGVuZ3RoKCk7XG4gICAgICAgICBpZiAobGVuZ3RoMiA+IGIyU2V0dGluZ3MuYjJfbGluZWFyU2xvcCkge1xuICAgICAgICAgICAgdGhpcy5tX3UyLnggKj0gMS4wIC8gbGVuZ3RoMjtcbiAgICAgICAgICAgIHRoaXMubV91Mi55ICo9IDEuMCAvIGxlbmd0aDI7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubV91Mi5TZXRaZXJvKCk7XG4gICAgICAgICB9XG4gICAgICAgICBDID0gdGhpcy5tX21heExlbmd0aDIgLSBsZW5ndGgyO1xuICAgICAgICAgbGluZWFyRXJyb3IgPSBiMk1hdGguTWF4KGxpbmVhckVycm9yLCAoLUMpKTtcbiAgICAgICAgIEMgPSBiMk1hdGguQ2xhbXAoQyArIGIyU2V0dGluZ3MuYjJfbGluZWFyU2xvcCwgKC1iMlNldHRpbmdzLmIyX21heExpbmVhckNvcnJlY3Rpb24pLCAwLjApO1xuICAgICAgICAgaW1wdWxzZSA9ICgtdGhpcy5tX2xpbWl0TWFzczIgKiBDKTtcbiAgICAgICAgIHAyWCA9ICgtaW1wdWxzZSAqIHRoaXMubV91Mi54KTtcbiAgICAgICAgIHAyWSA9ICgtaW1wdWxzZSAqIHRoaXMubV91Mi55KTtcbiAgICAgICAgIGJCLm1fc3dlZXAuYy54ICs9IGJCLm1faW52TWFzcyAqIHAyWDtcbiAgICAgICAgIGJCLm1fc3dlZXAuYy55ICs9IGJCLm1faW52TWFzcyAqIHAyWTtcbiAgICAgICAgIGJCLm1fc3dlZXAuYSArPSBiQi5tX2ludkkgKiAocjJYICogcDJZIC0gcjJZICogcDJYKTtcbiAgICAgICAgIGJCLlN5bmNocm9uaXplVHJhbnNmb3JtKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbGluZWFyRXJyb3IgPCBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3A7XG4gICB9XG4gICBCb3gyRC5wb3N0RGVmcy5wdXNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMlB1bGxleUpvaW50LmIyX21pblB1bGxleUxlbmd0aCA9IDIuMDtcbiAgIH0pO1xuICAgQm94MkQuaW5oZXJpdChiMlB1bGxleUpvaW50RGVmLCBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludERlZik7XG4gICBiMlB1bGxleUpvaW50RGVmLnByb3RvdHlwZS5fX3N1cGVyID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnREZWYucHJvdG90eXBlO1xuICAgYjJQdWxsZXlKb2ludERlZi5iMlB1bGxleUpvaW50RGVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnREZWYuYjJKb2ludERlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgdGhpcy5ncm91bmRBbmNob3JBID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5ncm91bmRBbmNob3JCID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5sb2NhbEFuY2hvckEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQiA9IG5ldyBiMlZlYzIoKTtcbiAgIH07XG4gICBiMlB1bGxleUpvaW50RGVmLnByb3RvdHlwZS5iMlB1bGxleUpvaW50RGVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fX3N1cGVyLmIySm9pbnREZWYuY2FsbCh0aGlzKTtcbiAgICAgIHRoaXMudHlwZSA9IGIySm9pbnQuZV9wdWxsZXlKb2ludDtcbiAgICAgIHRoaXMuZ3JvdW5kQW5jaG9yQS5TZXQoKC0xLjApLCAxLjApO1xuICAgICAgdGhpcy5ncm91bmRBbmNob3JCLlNldCgxLjAsIDEuMCk7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQS5TZXQoKC0xLjApLCAwLjApO1xuICAgICAgdGhpcy5sb2NhbEFuY2hvckIuU2V0KDEuMCwgMC4wKTtcbiAgICAgIHRoaXMubGVuZ3RoQSA9IDAuMDtcbiAgICAgIHRoaXMubWF4TGVuZ3RoQSA9IDAuMDtcbiAgICAgIHRoaXMubGVuZ3RoQiA9IDAuMDtcbiAgICAgIHRoaXMubWF4TGVuZ3RoQiA9IDAuMDtcbiAgICAgIHRoaXMucmF0aW8gPSAxLjA7XG4gICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSB0cnVlO1xuICAgfVxuICAgYjJQdWxsZXlKb2ludERlZi5wcm90b3R5cGUuSW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChiQSwgYkIsIGdhQSwgZ2FCLCBhbmNob3JBLCBhbmNob3JCLCByKSB7XG4gICAgICBpZiAociA9PT0gdW5kZWZpbmVkKSByID0gMDtcbiAgICAgIHRoaXMuYm9keUEgPSBiQTtcbiAgICAgIHRoaXMuYm9keUIgPSBiQjtcbiAgICAgIHRoaXMuZ3JvdW5kQW5jaG9yQS5TZXRWKGdhQSk7XG4gICAgICB0aGlzLmdyb3VuZEFuY2hvckIuU2V0VihnYUIpO1xuICAgICAgdGhpcy5sb2NhbEFuY2hvckEgPSB0aGlzLmJvZHlBLkdldExvY2FsUG9pbnQoYW5jaG9yQSk7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQiA9IHRoaXMuYm9keUIuR2V0TG9jYWxQb2ludChhbmNob3JCKTtcbiAgICAgIHZhciBkMVggPSBhbmNob3JBLnggLSBnYUEueDtcbiAgICAgIHZhciBkMVkgPSBhbmNob3JBLnkgLSBnYUEueTtcbiAgICAgIHRoaXMubGVuZ3RoQSA9IE1hdGguc3FydChkMVggKiBkMVggKyBkMVkgKiBkMVkpO1xuICAgICAgdmFyIGQyWCA9IGFuY2hvckIueCAtIGdhQi54O1xuICAgICAgdmFyIGQyWSA9IGFuY2hvckIueSAtIGdhQi55O1xuICAgICAgdGhpcy5sZW5ndGhCID0gTWF0aC5zcXJ0KGQyWCAqIGQyWCArIGQyWSAqIGQyWSk7XG4gICAgICB0aGlzLnJhdGlvID0gcjtcbiAgICAgIHZhciBDID0gdGhpcy5sZW5ndGhBICsgdGhpcy5yYXRpbyAqIHRoaXMubGVuZ3RoQjtcbiAgICAgIHRoaXMubWF4TGVuZ3RoQSA9IEMgLSB0aGlzLnJhdGlvICogYjJQdWxsZXlKb2ludC5iMl9taW5QdWxsZXlMZW5ndGg7XG4gICAgICB0aGlzLm1heExlbmd0aEIgPSAoQyAtIGIyUHVsbGV5Sm9pbnQuYjJfbWluUHVsbGV5TGVuZ3RoKSAvIHRoaXMucmF0aW87XG4gICB9XG4gICBCb3gyRC5pbmhlcml0KGIyUmV2b2x1dGVKb2ludCwgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQpO1xuICAgYjJSZXZvbHV0ZUpvaW50LnByb3RvdHlwZS5fX3N1cGVyID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQucHJvdG90eXBlO1xuICAgYjJSZXZvbHV0ZUpvaW50LmIyUmV2b2x1dGVKb2ludCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50LmIySm9pbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIHRoaXMuSyA9IG5ldyBiMk1hdDIyKCk7XG4gICAgICB0aGlzLksxID0gbmV3IGIyTWF0MjIoKTtcbiAgICAgIHRoaXMuSzIgPSBuZXcgYjJNYXQyMigpO1xuICAgICAgdGhpcy5LMyA9IG5ldyBiMk1hdDIyKCk7XG4gICAgICB0aGlzLmltcHVsc2UzID0gbmV3IGIyVmVjMygpO1xuICAgICAgdGhpcy5pbXB1bHNlMiA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMucmVkdWNlZCA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9sb2NhbEFuY2hvcjEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLm1fbG9jYWxBbmNob3IyID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX2ltcHVsc2UgPSBuZXcgYjJWZWMzKCk7XG4gICAgICB0aGlzLm1fbWFzcyA9IG5ldyBiMk1hdDMzKCk7XG4gICB9O1xuICAgYjJSZXZvbHV0ZUpvaW50LnByb3RvdHlwZS5HZXRBbmNob3JBID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5QS5HZXRXb3JsZFBvaW50KHRoaXMubV9sb2NhbEFuY2hvcjEpO1xuICAgfVxuICAgYjJSZXZvbHV0ZUpvaW50LnByb3RvdHlwZS5HZXRBbmNob3JCID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5Qi5HZXRXb3JsZFBvaW50KHRoaXMubV9sb2NhbEFuY2hvcjIpO1xuICAgfVxuICAgYjJSZXZvbHV0ZUpvaW50LnByb3RvdHlwZS5HZXRSZWFjdGlvbkZvcmNlID0gZnVuY3Rpb24gKGludl9kdCkge1xuICAgICAgaWYgKGludl9kdCA9PT0gdW5kZWZpbmVkKSBpbnZfZHQgPSAwO1xuICAgICAgcmV0dXJuIG5ldyBiMlZlYzIoaW52X2R0ICogdGhpcy5tX2ltcHVsc2UueCwgaW52X2R0ICogdGhpcy5tX2ltcHVsc2UueSk7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnQucHJvdG90eXBlLkdldFJlYWN0aW9uVG9ycXVlID0gZnVuY3Rpb24gKGludl9kdCkge1xuICAgICAgaWYgKGludl9kdCA9PT0gdW5kZWZpbmVkKSBpbnZfZHQgPSAwO1xuICAgICAgcmV0dXJuIGludl9kdCAqIHRoaXMubV9pbXB1bHNlLno7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnQucHJvdG90eXBlLkdldEpvaW50QW5nbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2JvZHlCLm1fc3dlZXAuYSAtIHRoaXMubV9ib2R5QS5tX3N3ZWVwLmEgLSB0aGlzLm1fcmVmZXJlbmNlQW5nbGU7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnQucHJvdG90eXBlLkdldEpvaW50U3BlZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2JvZHlCLm1fYW5ndWxhclZlbG9jaXR5IC0gdGhpcy5tX2JvZHlBLm1fYW5ndWxhclZlbG9jaXR5O1xuICAgfVxuICAgYjJSZXZvbHV0ZUpvaW50LnByb3RvdHlwZS5Jc0xpbWl0RW5hYmxlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fZW5hYmxlTGltaXQ7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnQucHJvdG90eXBlLkVuYWJsZUxpbWl0ID0gZnVuY3Rpb24gKGZsYWcpIHtcbiAgICAgIHRoaXMubV9lbmFibGVMaW1pdCA9IGZsYWc7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnQucHJvdG90eXBlLkdldExvd2VyTGltaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2xvd2VyQW5nbGU7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnQucHJvdG90eXBlLkdldFVwcGVyTGltaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX3VwcGVyQW5nbGU7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnQucHJvdG90eXBlLlNldExpbWl0cyA9IGZ1bmN0aW9uIChsb3dlciwgdXBwZXIpIHtcbiAgICAgIGlmIChsb3dlciA9PT0gdW5kZWZpbmVkKSBsb3dlciA9IDA7XG4gICAgICBpZiAodXBwZXIgPT09IHVuZGVmaW5lZCkgdXBwZXIgPSAwO1xuICAgICAgdGhpcy5tX2xvd2VyQW5nbGUgPSBsb3dlcjtcbiAgICAgIHRoaXMubV91cHBlckFuZ2xlID0gdXBwZXI7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnQucHJvdG90eXBlLklzTW90b3JFbmFibGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5tX2JvZHlBLlNldEF3YWtlKHRydWUpO1xuICAgICAgdGhpcy5tX2JvZHlCLlNldEF3YWtlKHRydWUpO1xuICAgICAgcmV0dXJuIHRoaXMubV9lbmFibGVNb3RvcjtcbiAgIH1cbiAgIGIyUmV2b2x1dGVKb2ludC5wcm90b3R5cGUuRW5hYmxlTW90b3IgPSBmdW5jdGlvbiAoZmxhZykge1xuICAgICAgdGhpcy5tX2VuYWJsZU1vdG9yID0gZmxhZztcbiAgIH1cbiAgIGIyUmV2b2x1dGVKb2ludC5wcm90b3R5cGUuU2V0TW90b3JTcGVlZCA9IGZ1bmN0aW9uIChzcGVlZCkge1xuICAgICAgaWYgKHNwZWVkID09PSB1bmRlZmluZWQpIHNwZWVkID0gMDtcbiAgICAgIHRoaXMubV9ib2R5QS5TZXRBd2FrZSh0cnVlKTtcbiAgICAgIHRoaXMubV9ib2R5Qi5TZXRBd2FrZSh0cnVlKTtcbiAgICAgIHRoaXMubV9tb3RvclNwZWVkID0gc3BlZWQ7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnQucHJvdG90eXBlLkdldE1vdG9yU3BlZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX21vdG9yU3BlZWQ7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnQucHJvdG90eXBlLlNldE1heE1vdG9yVG9ycXVlID0gZnVuY3Rpb24gKHRvcnF1ZSkge1xuICAgICAgaWYgKHRvcnF1ZSA9PT0gdW5kZWZpbmVkKSB0b3JxdWUgPSAwO1xuICAgICAgdGhpcy5tX21heE1vdG9yVG9ycXVlID0gdG9ycXVlO1xuICAgfVxuICAgYjJSZXZvbHV0ZUpvaW50LnByb3RvdHlwZS5HZXRNb3RvclRvcnF1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fbWF4TW90b3JUb3JxdWU7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnQucHJvdG90eXBlLmIyUmV2b2x1dGVKb2ludCA9IGZ1bmN0aW9uIChkZWYpIHtcbiAgICAgIHRoaXMuX19zdXBlci5iMkpvaW50LmNhbGwodGhpcywgZGVmKTtcbiAgICAgIHRoaXMubV9sb2NhbEFuY2hvcjEuU2V0VihkZWYubG9jYWxBbmNob3JBKTtcbiAgICAgIHRoaXMubV9sb2NhbEFuY2hvcjIuU2V0VihkZWYubG9jYWxBbmNob3JCKTtcbiAgICAgIHRoaXMubV9yZWZlcmVuY2VBbmdsZSA9IGRlZi5yZWZlcmVuY2VBbmdsZTtcbiAgICAgIHRoaXMubV9pbXB1bHNlLlNldFplcm8oKTtcbiAgICAgIHRoaXMubV9tb3RvckltcHVsc2UgPSAwLjA7XG4gICAgICB0aGlzLm1fbG93ZXJBbmdsZSA9IGRlZi5sb3dlckFuZ2xlO1xuICAgICAgdGhpcy5tX3VwcGVyQW5nbGUgPSBkZWYudXBwZXJBbmdsZTtcbiAgICAgIHRoaXMubV9tYXhNb3RvclRvcnF1ZSA9IGRlZi5tYXhNb3RvclRvcnF1ZTtcbiAgICAgIHRoaXMubV9tb3RvclNwZWVkID0gZGVmLm1vdG9yU3BlZWQ7XG4gICAgICB0aGlzLm1fZW5hYmxlTGltaXQgPSBkZWYuZW5hYmxlTGltaXQ7XG4gICAgICB0aGlzLm1fZW5hYmxlTW90b3IgPSBkZWYuZW5hYmxlTW90b3I7XG4gICAgICB0aGlzLm1fbGltaXRTdGF0ZSA9IGIySm9pbnQuZV9pbmFjdGl2ZUxpbWl0O1xuICAgfVxuICAgYjJSZXZvbHV0ZUpvaW50LnByb3RvdHlwZS5Jbml0VmVsb2NpdHlDb25zdHJhaW50cyA9IGZ1bmN0aW9uIChzdGVwKSB7XG4gICAgICB2YXIgYkEgPSB0aGlzLm1fYm9keUE7XG4gICAgICB2YXIgYkIgPSB0aGlzLm1fYm9keUI7XG4gICAgICB2YXIgdE1hdDtcbiAgICAgIHZhciB0WCA9IDA7XG4gICAgICBpZiAodGhpcy5tX2VuYWJsZU1vdG9yIHx8IHRoaXMubV9lbmFibGVMaW1pdCkge31cbiAgICAgIHRNYXQgPSBiQS5tX3hmLlI7XG4gICAgICB2YXIgcjFYID0gdGhpcy5tX2xvY2FsQW5jaG9yMS54IC0gYkEubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgdmFyIHIxWSA9IHRoaXMubV9sb2NhbEFuY2hvcjEueSAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgIHRYID0gKHRNYXQuY29sMS54ICogcjFYICsgdE1hdC5jb2wyLnggKiByMVkpO1xuICAgICAgcjFZID0gKHRNYXQuY29sMS55ICogcjFYICsgdE1hdC5jb2wyLnkgKiByMVkpO1xuICAgICAgcjFYID0gdFg7XG4gICAgICB0TWF0ID0gYkIubV94Zi5SO1xuICAgICAgdmFyIHIyWCA9IHRoaXMubV9sb2NhbEFuY2hvcjIueCAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgIHZhciByMlkgPSB0aGlzLm1fbG9jYWxBbmNob3IyLnkgLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHIyWCArIHRNYXQuY29sMi54ICogcjJZKTtcbiAgICAgIHIyWSA9ICh0TWF0LmNvbDEueSAqIHIyWCArIHRNYXQuY29sMi55ICogcjJZKTtcbiAgICAgIHIyWCA9IHRYO1xuICAgICAgdmFyIG0xID0gYkEubV9pbnZNYXNzO1xuICAgICAgdmFyIG0yID0gYkIubV9pbnZNYXNzO1xuICAgICAgdmFyIGkxID0gYkEubV9pbnZJO1xuICAgICAgdmFyIGkyID0gYkIubV9pbnZJO1xuICAgICAgdGhpcy5tX21hc3MuY29sMS54ID0gbTEgKyBtMiArIHIxWSAqIHIxWSAqIGkxICsgcjJZICogcjJZICogaTI7XG4gICAgICB0aGlzLm1fbWFzcy5jb2wyLnggPSAoLXIxWSAqIHIxWCAqIGkxKSAtIHIyWSAqIHIyWCAqIGkyO1xuICAgICAgdGhpcy5tX21hc3MuY29sMy54ID0gKC1yMVkgKiBpMSkgLSByMlkgKiBpMjtcbiAgICAgIHRoaXMubV9tYXNzLmNvbDEueSA9IHRoaXMubV9tYXNzLmNvbDIueDtcbiAgICAgIHRoaXMubV9tYXNzLmNvbDIueSA9IG0xICsgbTIgKyByMVggKiByMVggKiBpMSArIHIyWCAqIHIyWCAqIGkyO1xuICAgICAgdGhpcy5tX21hc3MuY29sMy55ID0gcjFYICogaTEgKyByMlggKiBpMjtcbiAgICAgIHRoaXMubV9tYXNzLmNvbDEueiA9IHRoaXMubV9tYXNzLmNvbDMueDtcbiAgICAgIHRoaXMubV9tYXNzLmNvbDIueiA9IHRoaXMubV9tYXNzLmNvbDMueTtcbiAgICAgIHRoaXMubV9tYXNzLmNvbDMueiA9IGkxICsgaTI7XG4gICAgICB0aGlzLm1fbW90b3JNYXNzID0gMS4wIC8gKGkxICsgaTIpO1xuICAgICAgaWYgKHRoaXMubV9lbmFibGVNb3RvciA9PSBmYWxzZSkge1xuICAgICAgICAgdGhpcy5tX21vdG9ySW1wdWxzZSA9IDAuMDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm1fZW5hYmxlTGltaXQpIHtcbiAgICAgICAgIHZhciBqb2ludEFuZ2xlID0gYkIubV9zd2VlcC5hIC0gYkEubV9zd2VlcC5hIC0gdGhpcy5tX3JlZmVyZW5jZUFuZ2xlO1xuICAgICAgICAgaWYgKGIyTWF0aC5BYnModGhpcy5tX3VwcGVyQW5nbGUgLSB0aGlzLm1fbG93ZXJBbmdsZSkgPCAyLjAgKiBiMlNldHRpbmdzLmIyX2FuZ3VsYXJTbG9wKSB7XG4gICAgICAgICAgICB0aGlzLm1fbGltaXRTdGF0ZSA9IGIySm9pbnQuZV9lcXVhbExpbWl0cztcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2UgaWYgKGpvaW50QW5nbGUgPD0gdGhpcy5tX2xvd2VyQW5nbGUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1fbGltaXRTdGF0ZSAhPSBiMkpvaW50LmVfYXRMb3dlckxpbWl0KSB7XG4gICAgICAgICAgICAgICB0aGlzLm1faW1wdWxzZS56ID0gMC4wO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5tX2xpbWl0U3RhdGUgPSBiMkpvaW50LmVfYXRMb3dlckxpbWl0O1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSBpZiAoam9pbnRBbmdsZSA+PSB0aGlzLm1fdXBwZXJBbmdsZSkge1xuICAgICAgICAgICAgaWYgKHRoaXMubV9saW1pdFN0YXRlICE9IGIySm9pbnQuZV9hdFVwcGVyTGltaXQpIHtcbiAgICAgICAgICAgICAgIHRoaXMubV9pbXB1bHNlLnogPSAwLjA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm1fbGltaXRTdGF0ZSA9IGIySm9pbnQuZV9hdFVwcGVyTGltaXQ7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubV9saW1pdFN0YXRlID0gYjJKb2ludC5lX2luYWN0aXZlTGltaXQ7XG4gICAgICAgICAgICB0aGlzLm1faW1wdWxzZS56ID0gMC4wO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICB0aGlzLm1fbGltaXRTdGF0ZSA9IGIySm9pbnQuZV9pbmFjdGl2ZUxpbWl0O1xuICAgICAgfVxuICAgICAgaWYgKHN0ZXAud2FybVN0YXJ0aW5nKSB7XG4gICAgICAgICB0aGlzLm1faW1wdWxzZS54ICo9IHN0ZXAuZHRSYXRpbztcbiAgICAgICAgIHRoaXMubV9pbXB1bHNlLnkgKj0gc3RlcC5kdFJhdGlvO1xuICAgICAgICAgdGhpcy5tX21vdG9ySW1wdWxzZSAqPSBzdGVwLmR0UmF0aW87XG4gICAgICAgICB2YXIgUFggPSB0aGlzLm1faW1wdWxzZS54O1xuICAgICAgICAgdmFyIFBZID0gdGhpcy5tX2ltcHVsc2UueTtcbiAgICAgICAgIGJBLm1fbGluZWFyVmVsb2NpdHkueCAtPSBtMSAqIFBYO1xuICAgICAgICAgYkEubV9saW5lYXJWZWxvY2l0eS55IC09IG0xICogUFk7XG4gICAgICAgICBiQS5tX2FuZ3VsYXJWZWxvY2l0eSAtPSBpMSAqICgocjFYICogUFkgLSByMVkgKiBQWCkgKyB0aGlzLm1fbW90b3JJbXB1bHNlICsgdGhpcy5tX2ltcHVsc2Uueik7XG4gICAgICAgICBiQi5tX2xpbmVhclZlbG9jaXR5LnggKz0gbTIgKiBQWDtcbiAgICAgICAgIGJCLm1fbGluZWFyVmVsb2NpdHkueSArPSBtMiAqIFBZO1xuICAgICAgICAgYkIubV9hbmd1bGFyVmVsb2NpdHkgKz0gaTIgKiAoKHIyWCAqIFBZIC0gcjJZICogUFgpICsgdGhpcy5tX21vdG9ySW1wdWxzZSArIHRoaXMubV9pbXB1bHNlLnopO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICB0aGlzLm1faW1wdWxzZS5TZXRaZXJvKCk7XG4gICAgICAgICB0aGlzLm1fbW90b3JJbXB1bHNlID0gMC4wO1xuICAgICAgfVxuICAgfVxuICAgYjJSZXZvbHV0ZUpvaW50LnByb3RvdHlwZS5Tb2x2ZVZlbG9jaXR5Q29uc3RyYWludHMgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgdmFyIGJBID0gdGhpcy5tX2JvZHlBO1xuICAgICAgdmFyIGJCID0gdGhpcy5tX2JvZHlCO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB2YXIgdFggPSAwO1xuICAgICAgdmFyIG5ld0ltcHVsc2UgPSAwO1xuICAgICAgdmFyIHIxWCA9IDA7XG4gICAgICB2YXIgcjFZID0gMDtcbiAgICAgIHZhciByMlggPSAwO1xuICAgICAgdmFyIHIyWSA9IDA7XG4gICAgICB2YXIgdjEgPSBiQS5tX2xpbmVhclZlbG9jaXR5O1xuICAgICAgdmFyIHcxID0gYkEubV9hbmd1bGFyVmVsb2NpdHk7XG4gICAgICB2YXIgdjIgPSBiQi5tX2xpbmVhclZlbG9jaXR5O1xuICAgICAgdmFyIHcyID0gYkIubV9hbmd1bGFyVmVsb2NpdHk7XG4gICAgICB2YXIgbTEgPSBiQS5tX2ludk1hc3M7XG4gICAgICB2YXIgbTIgPSBiQi5tX2ludk1hc3M7XG4gICAgICB2YXIgaTEgPSBiQS5tX2ludkk7XG4gICAgICB2YXIgaTIgPSBiQi5tX2ludkk7XG4gICAgICBpZiAodGhpcy5tX2VuYWJsZU1vdG9yICYmIHRoaXMubV9saW1pdFN0YXRlICE9IGIySm9pbnQuZV9lcXVhbExpbWl0cykge1xuICAgICAgICAgdmFyIENkb3QgPSB3MiAtIHcxIC0gdGhpcy5tX21vdG9yU3BlZWQ7XG4gICAgICAgICB2YXIgaW1wdWxzZSA9IHRoaXMubV9tb3Rvck1hc3MgKiAoKC1DZG90KSk7XG4gICAgICAgICB2YXIgb2xkSW1wdWxzZSA9IHRoaXMubV9tb3RvckltcHVsc2U7XG4gICAgICAgICB2YXIgbWF4SW1wdWxzZSA9IHN0ZXAuZHQgKiB0aGlzLm1fbWF4TW90b3JUb3JxdWU7XG4gICAgICAgICB0aGlzLm1fbW90b3JJbXB1bHNlID0gYjJNYXRoLkNsYW1wKHRoaXMubV9tb3RvckltcHVsc2UgKyBpbXB1bHNlLCAoLW1heEltcHVsc2UpLCBtYXhJbXB1bHNlKTtcbiAgICAgICAgIGltcHVsc2UgPSB0aGlzLm1fbW90b3JJbXB1bHNlIC0gb2xkSW1wdWxzZTtcbiAgICAgICAgIHcxIC09IGkxICogaW1wdWxzZTtcbiAgICAgICAgIHcyICs9IGkyICogaW1wdWxzZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm1fZW5hYmxlTGltaXQgJiYgdGhpcy5tX2xpbWl0U3RhdGUgIT0gYjJKb2ludC5lX2luYWN0aXZlTGltaXQpIHtcbiAgICAgICAgIHRNYXQgPSBiQS5tX3hmLlI7XG4gICAgICAgICByMVggPSB0aGlzLm1fbG9jYWxBbmNob3IxLnggLSBiQS5tX3N3ZWVwLmxvY2FsQ2VudGVyLng7XG4gICAgICAgICByMVkgPSB0aGlzLm1fbG9jYWxBbmNob3IxLnkgLSBiQS5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHIxWCArIHRNYXQuY29sMi54ICogcjFZKTtcbiAgICAgICAgIHIxWSA9ICh0TWF0LmNvbDEueSAqIHIxWCArIHRNYXQuY29sMi55ICogcjFZKTtcbiAgICAgICAgIHIxWCA9IHRYO1xuICAgICAgICAgdE1hdCA9IGJCLm1feGYuUjtcbiAgICAgICAgIHIyWCA9IHRoaXMubV9sb2NhbEFuY2hvcjIueCAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgICAgIHIyWSA9IHRoaXMubV9sb2NhbEFuY2hvcjIueSAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgICAgIHRYID0gKHRNYXQuY29sMS54ICogcjJYICsgdE1hdC5jb2wyLnggKiByMlkpO1xuICAgICAgICAgcjJZID0gKHRNYXQuY29sMS55ICogcjJYICsgdE1hdC5jb2wyLnkgKiByMlkpO1xuICAgICAgICAgcjJYID0gdFg7XG4gICAgICAgICB2YXIgQ2RvdDFYID0gdjIueCArICgoLXcyICogcjJZKSkgLSB2MS54IC0gKCgtdzEgKiByMVkpKTtcbiAgICAgICAgIHZhciBDZG90MVkgPSB2Mi55ICsgKHcyICogcjJYKSAtIHYxLnkgLSAodzEgKiByMVgpO1xuICAgICAgICAgdmFyIENkb3QyID0gdzIgLSB3MTtcbiAgICAgICAgIHRoaXMubV9tYXNzLlNvbHZlMzModGhpcy5pbXB1bHNlMywgKC1DZG90MVgpLCAoLUNkb3QxWSksICgtQ2RvdDIpKTtcbiAgICAgICAgIGlmICh0aGlzLm1fbGltaXRTdGF0ZSA9PSBiMkpvaW50LmVfZXF1YWxMaW1pdHMpIHtcbiAgICAgICAgICAgIHRoaXMubV9pbXB1bHNlLkFkZCh0aGlzLmltcHVsc2UzKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2UgaWYgKHRoaXMubV9saW1pdFN0YXRlID09IGIySm9pbnQuZV9hdExvd2VyTGltaXQpIHtcbiAgICAgICAgICAgIG5ld0ltcHVsc2UgPSB0aGlzLm1faW1wdWxzZS56ICsgdGhpcy5pbXB1bHNlMy56O1xuICAgICAgICAgICAgaWYgKG5ld0ltcHVsc2UgPCAwLjApIHtcbiAgICAgICAgICAgICAgIHRoaXMubV9tYXNzLlNvbHZlMjIodGhpcy5yZWR1Y2VkLCAoLUNkb3QxWCksICgtQ2RvdDFZKSk7XG4gICAgICAgICAgICAgICB0aGlzLmltcHVsc2UzLnggPSB0aGlzLnJlZHVjZWQueDtcbiAgICAgICAgICAgICAgIHRoaXMuaW1wdWxzZTMueSA9IHRoaXMucmVkdWNlZC55O1xuICAgICAgICAgICAgICAgdGhpcy5pbXB1bHNlMy56ID0gKC10aGlzLm1faW1wdWxzZS56KTtcbiAgICAgICAgICAgICAgIHRoaXMubV9pbXB1bHNlLnggKz0gdGhpcy5yZWR1Y2VkLng7XG4gICAgICAgICAgICAgICB0aGlzLm1faW1wdWxzZS55ICs9IHRoaXMucmVkdWNlZC55O1xuICAgICAgICAgICAgICAgdGhpcy5tX2ltcHVsc2UueiA9IDAuMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2UgaWYgKHRoaXMubV9saW1pdFN0YXRlID09IGIySm9pbnQuZV9hdFVwcGVyTGltaXQpIHtcbiAgICAgICAgICAgIG5ld0ltcHVsc2UgPSB0aGlzLm1faW1wdWxzZS56ICsgdGhpcy5pbXB1bHNlMy56O1xuICAgICAgICAgICAgaWYgKG5ld0ltcHVsc2UgPiAwLjApIHtcbiAgICAgICAgICAgICAgIHRoaXMubV9tYXNzLlNvbHZlMjIodGhpcy5yZWR1Y2VkLCAoLUNkb3QxWCksICgtQ2RvdDFZKSk7XG4gICAgICAgICAgICAgICB0aGlzLmltcHVsc2UzLnggPSB0aGlzLnJlZHVjZWQueDtcbiAgICAgICAgICAgICAgIHRoaXMuaW1wdWxzZTMueSA9IHRoaXMucmVkdWNlZC55O1xuICAgICAgICAgICAgICAgdGhpcy5pbXB1bHNlMy56ID0gKC10aGlzLm1faW1wdWxzZS56KTtcbiAgICAgICAgICAgICAgIHRoaXMubV9pbXB1bHNlLnggKz0gdGhpcy5yZWR1Y2VkLng7XG4gICAgICAgICAgICAgICB0aGlzLm1faW1wdWxzZS55ICs9IHRoaXMucmVkdWNlZC55O1xuICAgICAgICAgICAgICAgdGhpcy5tX2ltcHVsc2UueiA9IDAuMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgIH1cbiAgICAgICAgIHYxLnggLT0gbTEgKiB0aGlzLmltcHVsc2UzLng7XG4gICAgICAgICB2MS55IC09IG0xICogdGhpcy5pbXB1bHNlMy55O1xuICAgICAgICAgdzEgLT0gaTEgKiAocjFYICogdGhpcy5pbXB1bHNlMy55IC0gcjFZICogdGhpcy5pbXB1bHNlMy54ICsgdGhpcy5pbXB1bHNlMy56KTtcbiAgICAgICAgIHYyLnggKz0gbTIgKiB0aGlzLmltcHVsc2UzLng7XG4gICAgICAgICB2Mi55ICs9IG0yICogdGhpcy5pbXB1bHNlMy55O1xuICAgICAgICAgdzIgKz0gaTIgKiAocjJYICogdGhpcy5pbXB1bHNlMy55IC0gcjJZICogdGhpcy5pbXB1bHNlMy54ICsgdGhpcy5pbXB1bHNlMy56KTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgdE1hdCA9IGJBLm1feGYuUjtcbiAgICAgICAgIHIxWCA9IHRoaXMubV9sb2NhbEFuY2hvcjEueCAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgICAgIHIxWSA9IHRoaXMubV9sb2NhbEFuY2hvcjEueSAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgICAgIHRYID0gKHRNYXQuY29sMS54ICogcjFYICsgdE1hdC5jb2wyLnggKiByMVkpO1xuICAgICAgICAgcjFZID0gKHRNYXQuY29sMS55ICogcjFYICsgdE1hdC5jb2wyLnkgKiByMVkpO1xuICAgICAgICAgcjFYID0gdFg7XG4gICAgICAgICB0TWF0ID0gYkIubV94Zi5SO1xuICAgICAgICAgcjJYID0gdGhpcy5tX2xvY2FsQW5jaG9yMi54IC0gYkIubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgICAgcjJZID0gdGhpcy5tX2xvY2FsQW5jaG9yMi55IC0gYkIubV9zd2VlcC5sb2NhbENlbnRlci55O1xuICAgICAgICAgdFggPSAodE1hdC5jb2wxLnggKiByMlggKyB0TWF0LmNvbDIueCAqIHIyWSk7XG4gICAgICAgICByMlkgPSAodE1hdC5jb2wxLnkgKiByMlggKyB0TWF0LmNvbDIueSAqIHIyWSk7XG4gICAgICAgICByMlggPSB0WDtcbiAgICAgICAgIHZhciBDZG90WCA9IHYyLnggKyAoKC13MiAqIHIyWSkpIC0gdjEueCAtICgoLXcxICogcjFZKSk7XG4gICAgICAgICB2YXIgQ2RvdFkgPSB2Mi55ICsgKHcyICogcjJYKSAtIHYxLnkgLSAodzEgKiByMVgpO1xuICAgICAgICAgdGhpcy5tX21hc3MuU29sdmUyMih0aGlzLmltcHVsc2UyLCAoLUNkb3RYKSwgKC1DZG90WSkpO1xuICAgICAgICAgdGhpcy5tX2ltcHVsc2UueCArPSB0aGlzLmltcHVsc2UyLng7XG4gICAgICAgICB0aGlzLm1faW1wdWxzZS55ICs9IHRoaXMuaW1wdWxzZTIueTtcbiAgICAgICAgIHYxLnggLT0gbTEgKiB0aGlzLmltcHVsc2UyLng7XG4gICAgICAgICB2MS55IC09IG0xICogdGhpcy5pbXB1bHNlMi55O1xuICAgICAgICAgdzEgLT0gaTEgKiAocjFYICogdGhpcy5pbXB1bHNlMi55IC0gcjFZICogdGhpcy5pbXB1bHNlMi54KTtcbiAgICAgICAgIHYyLnggKz0gbTIgKiB0aGlzLmltcHVsc2UyLng7XG4gICAgICAgICB2Mi55ICs9IG0yICogdGhpcy5pbXB1bHNlMi55O1xuICAgICAgICAgdzIgKz0gaTIgKiAocjJYICogdGhpcy5pbXB1bHNlMi55IC0gcjJZICogdGhpcy5pbXB1bHNlMi54KTtcbiAgICAgIH1cbiAgICAgIGJBLm1fbGluZWFyVmVsb2NpdHkuU2V0Vih2MSk7XG4gICAgICBiQS5tX2FuZ3VsYXJWZWxvY2l0eSA9IHcxO1xuICAgICAgYkIubV9saW5lYXJWZWxvY2l0eS5TZXRWKHYyKTtcbiAgICAgIGJCLm1fYW5ndWxhclZlbG9jaXR5ID0gdzI7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnQucHJvdG90eXBlLlNvbHZlUG9zaXRpb25Db25zdHJhaW50cyA9IGZ1bmN0aW9uIChiYXVtZ2FydGUpIHtcbiAgICAgIGlmIChiYXVtZ2FydGUgPT09IHVuZGVmaW5lZCkgYmF1bWdhcnRlID0gMDtcbiAgICAgIHZhciBvbGRMaW1pdEltcHVsc2UgPSAwO1xuICAgICAgdmFyIEMgPSAwO1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB2YXIgYkEgPSB0aGlzLm1fYm9keUE7XG4gICAgICB2YXIgYkIgPSB0aGlzLm1fYm9keUI7XG4gICAgICB2YXIgYW5ndWxhckVycm9yID0gMC4wO1xuICAgICAgdmFyIHBvc2l0aW9uRXJyb3IgPSAwLjA7XG4gICAgICB2YXIgdFggPSAwO1xuICAgICAgdmFyIGltcHVsc2VYID0gMDtcbiAgICAgIHZhciBpbXB1bHNlWSA9IDA7XG4gICAgICBpZiAodGhpcy5tX2VuYWJsZUxpbWl0ICYmIHRoaXMubV9saW1pdFN0YXRlICE9IGIySm9pbnQuZV9pbmFjdGl2ZUxpbWl0KSB7XG4gICAgICAgICB2YXIgYW5nbGUgPSBiQi5tX3N3ZWVwLmEgLSBiQS5tX3N3ZWVwLmEgLSB0aGlzLm1fcmVmZXJlbmNlQW5nbGU7XG4gICAgICAgICB2YXIgbGltaXRJbXB1bHNlID0gMC4wO1xuICAgICAgICAgaWYgKHRoaXMubV9saW1pdFN0YXRlID09IGIySm9pbnQuZV9lcXVhbExpbWl0cykge1xuICAgICAgICAgICAgQyA9IGIyTWF0aC5DbGFtcChhbmdsZSAtIHRoaXMubV9sb3dlckFuZ2xlLCAoLWIyU2V0dGluZ3MuYjJfbWF4QW5ndWxhckNvcnJlY3Rpb24pLCBiMlNldHRpbmdzLmIyX21heEFuZ3VsYXJDb3JyZWN0aW9uKTtcbiAgICAgICAgICAgIGxpbWl0SW1wdWxzZSA9ICgtdGhpcy5tX21vdG9yTWFzcyAqIEMpO1xuICAgICAgICAgICAgYW5ndWxhckVycm9yID0gYjJNYXRoLkFicyhDKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2UgaWYgKHRoaXMubV9saW1pdFN0YXRlID09IGIySm9pbnQuZV9hdExvd2VyTGltaXQpIHtcbiAgICAgICAgICAgIEMgPSBhbmdsZSAtIHRoaXMubV9sb3dlckFuZ2xlO1xuICAgICAgICAgICAgYW5ndWxhckVycm9yID0gKC1DKTtcbiAgICAgICAgICAgIEMgPSBiMk1hdGguQ2xhbXAoQyArIGIyU2V0dGluZ3MuYjJfYW5ndWxhclNsb3AsICgtYjJTZXR0aW5ncy5iMl9tYXhBbmd1bGFyQ29ycmVjdGlvbiksIDAuMCk7XG4gICAgICAgICAgICBsaW1pdEltcHVsc2UgPSAoLXRoaXMubV9tb3Rvck1hc3MgKiBDKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2UgaWYgKHRoaXMubV9saW1pdFN0YXRlID09IGIySm9pbnQuZV9hdFVwcGVyTGltaXQpIHtcbiAgICAgICAgICAgIEMgPSBhbmdsZSAtIHRoaXMubV91cHBlckFuZ2xlO1xuICAgICAgICAgICAgYW5ndWxhckVycm9yID0gQztcbiAgICAgICAgICAgIEMgPSBiMk1hdGguQ2xhbXAoQyAtIGIyU2V0dGluZ3MuYjJfYW5ndWxhclNsb3AsIDAuMCwgYjJTZXR0aW5ncy5iMl9tYXhBbmd1bGFyQ29ycmVjdGlvbik7XG4gICAgICAgICAgICBsaW1pdEltcHVsc2UgPSAoLXRoaXMubV9tb3Rvck1hc3MgKiBDKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGJBLm1fc3dlZXAuYSAtPSBiQS5tX2ludkkgKiBsaW1pdEltcHVsc2U7XG4gICAgICAgICBiQi5tX3N3ZWVwLmEgKz0gYkIubV9pbnZJICogbGltaXRJbXB1bHNlO1xuICAgICAgICAgYkEuU3luY2hyb25pemVUcmFuc2Zvcm0oKTtcbiAgICAgICAgIGJCLlN5bmNocm9uaXplVHJhbnNmb3JtKCk7XG4gICAgICB9IHtcbiAgICAgICAgIHRNYXQgPSBiQS5tX3hmLlI7XG4gICAgICAgICB2YXIgcjFYID0gdGhpcy5tX2xvY2FsQW5jaG9yMS54IC0gYkEubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgICAgdmFyIHIxWSA9IHRoaXMubV9sb2NhbEFuY2hvcjEueSAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgICAgIHRYID0gKHRNYXQuY29sMS54ICogcjFYICsgdE1hdC5jb2wyLnggKiByMVkpO1xuICAgICAgICAgcjFZID0gKHRNYXQuY29sMS55ICogcjFYICsgdE1hdC5jb2wyLnkgKiByMVkpO1xuICAgICAgICAgcjFYID0gdFg7XG4gICAgICAgICB0TWF0ID0gYkIubV94Zi5SO1xuICAgICAgICAgdmFyIHIyWCA9IHRoaXMubV9sb2NhbEFuY2hvcjIueCAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgICAgIHZhciByMlkgPSB0aGlzLm1fbG9jYWxBbmNob3IyLnkgLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHIyWCArIHRNYXQuY29sMi54ICogcjJZKTtcbiAgICAgICAgIHIyWSA9ICh0TWF0LmNvbDEueSAqIHIyWCArIHRNYXQuY29sMi55ICogcjJZKTtcbiAgICAgICAgIHIyWCA9IHRYO1xuICAgICAgICAgdmFyIENYID0gYkIubV9zd2VlcC5jLnggKyByMlggLSBiQS5tX3N3ZWVwLmMueCAtIHIxWDtcbiAgICAgICAgIHZhciBDWSA9IGJCLm1fc3dlZXAuYy55ICsgcjJZIC0gYkEubV9zd2VlcC5jLnkgLSByMVk7XG4gICAgICAgICB2YXIgQ0xlbmd0aFNxdWFyZWQgPSBDWCAqIENYICsgQ1kgKiBDWTtcbiAgICAgICAgIHZhciBDTGVuZ3RoID0gTWF0aC5zcXJ0KENMZW5ndGhTcXVhcmVkKTtcbiAgICAgICAgIHBvc2l0aW9uRXJyb3IgPSBDTGVuZ3RoO1xuICAgICAgICAgdmFyIGludk1hc3MxID0gYkEubV9pbnZNYXNzO1xuICAgICAgICAgdmFyIGludk1hc3MyID0gYkIubV9pbnZNYXNzO1xuICAgICAgICAgdmFyIGludkkxID0gYkEubV9pbnZJO1xuICAgICAgICAgdmFyIGludkkyID0gYkIubV9pbnZJO1xuICAgICAgICAgdmFyIGtfYWxsb3dlZFN0cmV0Y2ggPSAxMC4wICogYjJTZXR0aW5ncy5iMl9saW5lYXJTbG9wO1xuICAgICAgICAgaWYgKENMZW5ndGhTcXVhcmVkID4ga19hbGxvd2VkU3RyZXRjaCAqIGtfYWxsb3dlZFN0cmV0Y2gpIHtcbiAgICAgICAgICAgIHZhciB1WCA9IENYIC8gQ0xlbmd0aDtcbiAgICAgICAgICAgIHZhciB1WSA9IENZIC8gQ0xlbmd0aDtcbiAgICAgICAgICAgIHZhciBrID0gaW52TWFzczEgKyBpbnZNYXNzMjtcbiAgICAgICAgICAgIHZhciBtID0gMS4wIC8gaztcbiAgICAgICAgICAgIGltcHVsc2VYID0gbSAqICgoLUNYKSk7XG4gICAgICAgICAgICBpbXB1bHNlWSA9IG0gKiAoKC1DWSkpO1xuICAgICAgICAgICAgdmFyIGtfYmV0YSA9IDAuNTtcbiAgICAgICAgICAgIGJBLm1fc3dlZXAuYy54IC09IGtfYmV0YSAqIGludk1hc3MxICogaW1wdWxzZVg7XG4gICAgICAgICAgICBiQS5tX3N3ZWVwLmMueSAtPSBrX2JldGEgKiBpbnZNYXNzMSAqIGltcHVsc2VZO1xuICAgICAgICAgICAgYkIubV9zd2VlcC5jLnggKz0ga19iZXRhICogaW52TWFzczIgKiBpbXB1bHNlWDtcbiAgICAgICAgICAgIGJCLm1fc3dlZXAuYy55ICs9IGtfYmV0YSAqIGludk1hc3MyICogaW1wdWxzZVk7XG4gICAgICAgICAgICBDWCA9IGJCLm1fc3dlZXAuYy54ICsgcjJYIC0gYkEubV9zd2VlcC5jLnggLSByMVg7XG4gICAgICAgICAgICBDWSA9IGJCLm1fc3dlZXAuYy55ICsgcjJZIC0gYkEubV9zd2VlcC5jLnkgLSByMVk7XG4gICAgICAgICB9XG4gICAgICAgICB0aGlzLksxLmNvbDEueCA9IGludk1hc3MxICsgaW52TWFzczI7XG4gICAgICAgICB0aGlzLksxLmNvbDIueCA9IDAuMDtcbiAgICAgICAgIHRoaXMuSzEuY29sMS55ID0gMC4wO1xuICAgICAgICAgdGhpcy5LMS5jb2wyLnkgPSBpbnZNYXNzMSArIGludk1hc3MyO1xuICAgICAgICAgdGhpcy5LMi5jb2wxLnggPSBpbnZJMSAqIHIxWSAqIHIxWTtcbiAgICAgICAgIHRoaXMuSzIuY29sMi54ID0gKC1pbnZJMSAqIHIxWCAqIHIxWSk7XG4gICAgICAgICB0aGlzLksyLmNvbDEueSA9ICgtaW52STEgKiByMVggKiByMVkpO1xuICAgICAgICAgdGhpcy5LMi5jb2wyLnkgPSBpbnZJMSAqIHIxWCAqIHIxWDtcbiAgICAgICAgIHRoaXMuSzMuY29sMS54ID0gaW52STIgKiByMlkgKiByMlk7XG4gICAgICAgICB0aGlzLkszLmNvbDIueCA9ICgtaW52STIgKiByMlggKiByMlkpO1xuICAgICAgICAgdGhpcy5LMy5jb2wxLnkgPSAoLWludkkyICogcjJYICogcjJZKTtcbiAgICAgICAgIHRoaXMuSzMuY29sMi55ID0gaW52STIgKiByMlggKiByMlg7XG4gICAgICAgICB0aGlzLksuU2V0TSh0aGlzLksxKTtcbiAgICAgICAgIHRoaXMuSy5BZGRNKHRoaXMuSzIpO1xuICAgICAgICAgdGhpcy5LLkFkZE0odGhpcy5LMyk7XG4gICAgICAgICB0aGlzLksuU29sdmUoYjJSZXZvbHV0ZUpvaW50LnRJbXB1bHNlLCAoLUNYKSwgKC1DWSkpO1xuICAgICAgICAgaW1wdWxzZVggPSBiMlJldm9sdXRlSm9pbnQudEltcHVsc2UueDtcbiAgICAgICAgIGltcHVsc2VZID0gYjJSZXZvbHV0ZUpvaW50LnRJbXB1bHNlLnk7XG4gICAgICAgICBiQS5tX3N3ZWVwLmMueCAtPSBiQS5tX2ludk1hc3MgKiBpbXB1bHNlWDtcbiAgICAgICAgIGJBLm1fc3dlZXAuYy55IC09IGJBLm1faW52TWFzcyAqIGltcHVsc2VZO1xuICAgICAgICAgYkEubV9zd2VlcC5hIC09IGJBLm1faW52SSAqIChyMVggKiBpbXB1bHNlWSAtIHIxWSAqIGltcHVsc2VYKTtcbiAgICAgICAgIGJCLm1fc3dlZXAuYy54ICs9IGJCLm1faW52TWFzcyAqIGltcHVsc2VYO1xuICAgICAgICAgYkIubV9zd2VlcC5jLnkgKz0gYkIubV9pbnZNYXNzICogaW1wdWxzZVk7XG4gICAgICAgICBiQi5tX3N3ZWVwLmEgKz0gYkIubV9pbnZJICogKHIyWCAqIGltcHVsc2VZIC0gcjJZICogaW1wdWxzZVgpO1xuICAgICAgICAgYkEuU3luY2hyb25pemVUcmFuc2Zvcm0oKTtcbiAgICAgICAgIGJCLlN5bmNocm9uaXplVHJhbnNmb3JtKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcG9zaXRpb25FcnJvciA8PSBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3AgJiYgYW5ndWxhckVycm9yIDw9IGIyU2V0dGluZ3MuYjJfYW5ndWxhclNsb3A7XG4gICB9XG4gICBCb3gyRC5wb3N0RGVmcy5wdXNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMlJldm9sdXRlSm9pbnQudEltcHVsc2UgPSBuZXcgYjJWZWMyKCk7XG4gICB9KTtcbiAgIEJveDJELmluaGVyaXQoYjJSZXZvbHV0ZUpvaW50RGVmLCBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludERlZik7XG4gICBiMlJldm9sdXRlSm9pbnREZWYucHJvdG90eXBlLl9fc3VwZXIgPSBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludERlZi5wcm90b3R5cGU7XG4gICBiMlJldm9sdXRlSm9pbnREZWYuYjJSZXZvbHV0ZUpvaW50RGVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnREZWYuYjJKb2ludERlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgdGhpcy5sb2NhbEFuY2hvckEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQiA9IG5ldyBiMlZlYzIoKTtcbiAgIH07XG4gICBiMlJldm9sdXRlSm9pbnREZWYucHJvdG90eXBlLmIyUmV2b2x1dGVKb2ludERlZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX19zdXBlci5iMkpvaW50RGVmLmNhbGwodGhpcyk7XG4gICAgICB0aGlzLnR5cGUgPSBiMkpvaW50LmVfcmV2b2x1dGVKb2ludDtcbiAgICAgIHRoaXMubG9jYWxBbmNob3JBLlNldCgwLjAsIDAuMCk7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQi5TZXQoMC4wLCAwLjApO1xuICAgICAgdGhpcy5yZWZlcmVuY2VBbmdsZSA9IDAuMDtcbiAgICAgIHRoaXMubG93ZXJBbmdsZSA9IDAuMDtcbiAgICAgIHRoaXMudXBwZXJBbmdsZSA9IDAuMDtcbiAgICAgIHRoaXMubWF4TW90b3JUb3JxdWUgPSAwLjA7XG4gICAgICB0aGlzLm1vdG9yU3BlZWQgPSAwLjA7XG4gICAgICB0aGlzLmVuYWJsZUxpbWl0ID0gZmFsc2U7XG4gICAgICB0aGlzLmVuYWJsZU1vdG9yID0gZmFsc2U7XG4gICB9XG4gICBiMlJldm9sdXRlSm9pbnREZWYucHJvdG90eXBlLkluaXRpYWxpemUgPSBmdW5jdGlvbiAoYkEsIGJCLCBhbmNob3IpIHtcbiAgICAgIHRoaXMuYm9keUEgPSBiQTtcbiAgICAgIHRoaXMuYm9keUIgPSBiQjtcbiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gdGhpcy5ib2R5QS5HZXRMb2NhbFBvaW50KGFuY2hvcik7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQiA9IHRoaXMuYm9keUIuR2V0TG9jYWxQb2ludChhbmNob3IpO1xuICAgICAgdGhpcy5yZWZlcmVuY2VBbmdsZSA9IHRoaXMuYm9keUIuR2V0QW5nbGUoKSAtIHRoaXMuYm9keUEuR2V0QW5nbGUoKTtcbiAgIH1cbiAgIEJveDJELmluaGVyaXQoYjJXZWxkSm9pbnQsIEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50KTtcbiAgIGIyV2VsZEpvaW50LnByb3RvdHlwZS5fX3N1cGVyID0gQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnQucHJvdG90eXBlO1xuICAgYjJXZWxkSm9pbnQuYjJXZWxkSm9pbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludC5iMkpvaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLm1fbG9jYWxBbmNob3JBID0gbmV3IGIyVmVjMigpO1xuICAgICAgdGhpcy5tX2xvY2FsQW5jaG9yQiA9IG5ldyBiMlZlYzIoKTtcbiAgICAgIHRoaXMubV9pbXB1bHNlID0gbmV3IGIyVmVjMygpO1xuICAgICAgdGhpcy5tX21hc3MgPSBuZXcgYjJNYXQzMygpO1xuICAgfTtcbiAgIGIyV2VsZEpvaW50LnByb3RvdHlwZS5HZXRBbmNob3JBID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9ib2R5QS5HZXRXb3JsZFBvaW50KHRoaXMubV9sb2NhbEFuY2hvckEpO1xuICAgfVxuICAgYjJXZWxkSm9pbnQucHJvdG90eXBlLkdldEFuY2hvckIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2JvZHlCLkdldFdvcmxkUG9pbnQodGhpcy5tX2xvY2FsQW5jaG9yQik7XG4gICB9XG4gICBiMldlbGRKb2ludC5wcm90b3R5cGUuR2V0UmVhY3Rpb25Gb3JjZSA9IGZ1bmN0aW9uIChpbnZfZHQpIHtcbiAgICAgIGlmIChpbnZfZHQgPT09IHVuZGVmaW5lZCkgaW52X2R0ID0gMDtcbiAgICAgIHJldHVybiBuZXcgYjJWZWMyKGludl9kdCAqIHRoaXMubV9pbXB1bHNlLngsIGludl9kdCAqIHRoaXMubV9pbXB1bHNlLnkpO1xuICAgfVxuICAgYjJXZWxkSm9pbnQucHJvdG90eXBlLkdldFJlYWN0aW9uVG9ycXVlID0gZnVuY3Rpb24gKGludl9kdCkge1xuICAgICAgaWYgKGludl9kdCA9PT0gdW5kZWZpbmVkKSBpbnZfZHQgPSAwO1xuICAgICAgcmV0dXJuIGludl9kdCAqIHRoaXMubV9pbXB1bHNlLno7XG4gICB9XG4gICBiMldlbGRKb2ludC5wcm90b3R5cGUuYjJXZWxkSm9pbnQgPSBmdW5jdGlvbiAoZGVmKSB7XG4gICAgICB0aGlzLl9fc3VwZXIuYjJKb2ludC5jYWxsKHRoaXMsIGRlZik7XG4gICAgICB0aGlzLm1fbG9jYWxBbmNob3JBLlNldFYoZGVmLmxvY2FsQW5jaG9yQSk7XG4gICAgICB0aGlzLm1fbG9jYWxBbmNob3JCLlNldFYoZGVmLmxvY2FsQW5jaG9yQik7XG4gICAgICB0aGlzLm1fcmVmZXJlbmNlQW5nbGUgPSBkZWYucmVmZXJlbmNlQW5nbGU7XG4gICAgICB0aGlzLm1faW1wdWxzZS5TZXRaZXJvKCk7XG4gICAgICB0aGlzLm1fbWFzcyA9IG5ldyBiMk1hdDMzKCk7XG4gICB9XG4gICBiMldlbGRKb2ludC5wcm90b3R5cGUuSW5pdFZlbG9jaXR5Q29uc3RyYWludHMgPSBmdW5jdGlvbiAoc3RlcCkge1xuICAgICAgdmFyIHRNYXQ7XG4gICAgICB2YXIgdFggPSAwO1xuICAgICAgdmFyIGJBID0gdGhpcy5tX2JvZHlBO1xuICAgICAgdmFyIGJCID0gdGhpcy5tX2JvZHlCO1xuICAgICAgdE1hdCA9IGJBLm1feGYuUjtcbiAgICAgIHZhciByQVggPSB0aGlzLm1fbG9jYWxBbmNob3JBLnggLSBiQS5tX3N3ZWVwLmxvY2FsQ2VudGVyLng7XG4gICAgICB2YXIgckFZID0gdGhpcy5tX2xvY2FsQW5jaG9yQS55IC0gYkEubV9zd2VlcC5sb2NhbENlbnRlci55O1xuICAgICAgdFggPSAodE1hdC5jb2wxLnggKiByQVggKyB0TWF0LmNvbDIueCAqIHJBWSk7XG4gICAgICByQVkgPSAodE1hdC5jb2wxLnkgKiByQVggKyB0TWF0LmNvbDIueSAqIHJBWSk7XG4gICAgICByQVggPSB0WDtcbiAgICAgIHRNYXQgPSBiQi5tX3hmLlI7XG4gICAgICB2YXIgckJYID0gdGhpcy5tX2xvY2FsQW5jaG9yQi54IC0gYkIubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgdmFyIHJCWSA9IHRoaXMubV9sb2NhbEFuY2hvckIueSAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgIHRYID0gKHRNYXQuY29sMS54ICogckJYICsgdE1hdC5jb2wyLnggKiByQlkpO1xuICAgICAgckJZID0gKHRNYXQuY29sMS55ICogckJYICsgdE1hdC5jb2wyLnkgKiByQlkpO1xuICAgICAgckJYID0gdFg7XG4gICAgICB2YXIgbUEgPSBiQS5tX2ludk1hc3M7XG4gICAgICB2YXIgbUIgPSBiQi5tX2ludk1hc3M7XG4gICAgICB2YXIgaUEgPSBiQS5tX2ludkk7XG4gICAgICB2YXIgaUIgPSBiQi5tX2ludkk7XG4gICAgICB0aGlzLm1fbWFzcy5jb2wxLnggPSBtQSArIG1CICsgckFZICogckFZICogaUEgKyByQlkgKiByQlkgKiBpQjtcbiAgICAgIHRoaXMubV9tYXNzLmNvbDIueCA9ICgtckFZICogckFYICogaUEpIC0gckJZICogckJYICogaUI7XG4gICAgICB0aGlzLm1fbWFzcy5jb2wzLnggPSAoLXJBWSAqIGlBKSAtIHJCWSAqIGlCO1xuICAgICAgdGhpcy5tX21hc3MuY29sMS55ID0gdGhpcy5tX21hc3MuY29sMi54O1xuICAgICAgdGhpcy5tX21hc3MuY29sMi55ID0gbUEgKyBtQiArIHJBWCAqIHJBWCAqIGlBICsgckJYICogckJYICogaUI7XG4gICAgICB0aGlzLm1fbWFzcy5jb2wzLnkgPSByQVggKiBpQSArIHJCWCAqIGlCO1xuICAgICAgdGhpcy5tX21hc3MuY29sMS56ID0gdGhpcy5tX21hc3MuY29sMy54O1xuICAgICAgdGhpcy5tX21hc3MuY29sMi56ID0gdGhpcy5tX21hc3MuY29sMy55O1xuICAgICAgdGhpcy5tX21hc3MuY29sMy56ID0gaUEgKyBpQjtcbiAgICAgIGlmIChzdGVwLndhcm1TdGFydGluZykge1xuICAgICAgICAgdGhpcy5tX2ltcHVsc2UueCAqPSBzdGVwLmR0UmF0aW87XG4gICAgICAgICB0aGlzLm1faW1wdWxzZS55ICo9IHN0ZXAuZHRSYXRpbztcbiAgICAgICAgIHRoaXMubV9pbXB1bHNlLnogKj0gc3RlcC5kdFJhdGlvO1xuICAgICAgICAgYkEubV9saW5lYXJWZWxvY2l0eS54IC09IG1BICogdGhpcy5tX2ltcHVsc2UueDtcbiAgICAgICAgIGJBLm1fbGluZWFyVmVsb2NpdHkueSAtPSBtQSAqIHRoaXMubV9pbXB1bHNlLnk7XG4gICAgICAgICBiQS5tX2FuZ3VsYXJWZWxvY2l0eSAtPSBpQSAqIChyQVggKiB0aGlzLm1faW1wdWxzZS55IC0gckFZICogdGhpcy5tX2ltcHVsc2UueCArIHRoaXMubV9pbXB1bHNlLnopO1xuICAgICAgICAgYkIubV9saW5lYXJWZWxvY2l0eS54ICs9IG1CICogdGhpcy5tX2ltcHVsc2UueDtcbiAgICAgICAgIGJCLm1fbGluZWFyVmVsb2NpdHkueSArPSBtQiAqIHRoaXMubV9pbXB1bHNlLnk7XG4gICAgICAgICBiQi5tX2FuZ3VsYXJWZWxvY2l0eSArPSBpQiAqIChyQlggKiB0aGlzLm1faW1wdWxzZS55IC0gckJZICogdGhpcy5tX2ltcHVsc2UueCArIHRoaXMubV9pbXB1bHNlLnopO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICB0aGlzLm1faW1wdWxzZS5TZXRaZXJvKCk7XG4gICAgICB9XG4gICB9XG4gICBiMldlbGRKb2ludC5wcm90b3R5cGUuU29sdmVWZWxvY2l0eUNvbnN0cmFpbnRzID0gZnVuY3Rpb24gKHN0ZXApIHtcbiAgICAgIHZhciB0TWF0O1xuICAgICAgdmFyIHRYID0gMDtcbiAgICAgIHZhciBiQSA9IHRoaXMubV9ib2R5QTtcbiAgICAgIHZhciBiQiA9IHRoaXMubV9ib2R5QjtcbiAgICAgIHZhciB2QSA9IGJBLm1fbGluZWFyVmVsb2NpdHk7XG4gICAgICB2YXIgd0EgPSBiQS5tX2FuZ3VsYXJWZWxvY2l0eTtcbiAgICAgIHZhciB2QiA9IGJCLm1fbGluZWFyVmVsb2NpdHk7XG4gICAgICB2YXIgd0IgPSBiQi5tX2FuZ3VsYXJWZWxvY2l0eTtcbiAgICAgIHZhciBtQSA9IGJBLm1faW52TWFzcztcbiAgICAgIHZhciBtQiA9IGJCLm1faW52TWFzcztcbiAgICAgIHZhciBpQSA9IGJBLm1faW52STtcbiAgICAgIHZhciBpQiA9IGJCLm1faW52STtcbiAgICAgIHRNYXQgPSBiQS5tX3hmLlI7XG4gICAgICB2YXIgckFYID0gdGhpcy5tX2xvY2FsQW5jaG9yQS54IC0gYkEubV9zd2VlcC5sb2NhbENlbnRlci54O1xuICAgICAgdmFyIHJBWSA9IHRoaXMubV9sb2NhbEFuY2hvckEueSAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueTtcbiAgICAgIHRYID0gKHRNYXQuY29sMS54ICogckFYICsgdE1hdC5jb2wyLnggKiByQVkpO1xuICAgICAgckFZID0gKHRNYXQuY29sMS55ICogckFYICsgdE1hdC5jb2wyLnkgKiByQVkpO1xuICAgICAgckFYID0gdFg7XG4gICAgICB0TWF0ID0gYkIubV94Zi5SO1xuICAgICAgdmFyIHJCWCA9IHRoaXMubV9sb2NhbEFuY2hvckIueCAtIGJCLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgIHZhciByQlkgPSB0aGlzLm1fbG9jYWxBbmNob3JCLnkgLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHJCWCArIHRNYXQuY29sMi54ICogckJZKTtcbiAgICAgIHJCWSA9ICh0TWF0LmNvbDEueSAqIHJCWCArIHRNYXQuY29sMi55ICogckJZKTtcbiAgICAgIHJCWCA9IHRYO1xuICAgICAgdmFyIENkb3QxWCA9IHZCLnggLSB3QiAqIHJCWSAtIHZBLnggKyB3QSAqIHJBWTtcbiAgICAgIHZhciBDZG90MVkgPSB2Qi55ICsgd0IgKiByQlggLSB2QS55IC0gd0EgKiByQVg7XG4gICAgICB2YXIgQ2RvdDIgPSB3QiAtIHdBO1xuICAgICAgdmFyIGltcHVsc2UgPSBuZXcgYjJWZWMzKCk7XG4gICAgICB0aGlzLm1fbWFzcy5Tb2x2ZTMzKGltcHVsc2UsICgtQ2RvdDFYKSwgKC1DZG90MVkpLCAoLUNkb3QyKSk7XG4gICAgICB0aGlzLm1faW1wdWxzZS5BZGQoaW1wdWxzZSk7XG4gICAgICB2QS54IC09IG1BICogaW1wdWxzZS54O1xuICAgICAgdkEueSAtPSBtQSAqIGltcHVsc2UueTtcbiAgICAgIHdBIC09IGlBICogKHJBWCAqIGltcHVsc2UueSAtIHJBWSAqIGltcHVsc2UueCArIGltcHVsc2Uueik7XG4gICAgICB2Qi54ICs9IG1CICogaW1wdWxzZS54O1xuICAgICAgdkIueSArPSBtQiAqIGltcHVsc2UueTtcbiAgICAgIHdCICs9IGlCICogKHJCWCAqIGltcHVsc2UueSAtIHJCWSAqIGltcHVsc2UueCArIGltcHVsc2Uueik7XG4gICAgICBiQS5tX2FuZ3VsYXJWZWxvY2l0eSA9IHdBO1xuICAgICAgYkIubV9hbmd1bGFyVmVsb2NpdHkgPSB3QjtcbiAgIH1cbiAgIGIyV2VsZEpvaW50LnByb3RvdHlwZS5Tb2x2ZVBvc2l0aW9uQ29uc3RyYWludHMgPSBmdW5jdGlvbiAoYmF1bWdhcnRlKSB7XG4gICAgICBpZiAoYmF1bWdhcnRlID09PSB1bmRlZmluZWQpIGJhdW1nYXJ0ZSA9IDA7XG4gICAgICB2YXIgdE1hdDtcbiAgICAgIHZhciB0WCA9IDA7XG4gICAgICB2YXIgYkEgPSB0aGlzLm1fYm9keUE7XG4gICAgICB2YXIgYkIgPSB0aGlzLm1fYm9keUI7XG4gICAgICB0TWF0ID0gYkEubV94Zi5SO1xuICAgICAgdmFyIHJBWCA9IHRoaXMubV9sb2NhbEFuY2hvckEueCAtIGJBLm1fc3dlZXAubG9jYWxDZW50ZXIueDtcbiAgICAgIHZhciByQVkgPSB0aGlzLm1fbG9jYWxBbmNob3JBLnkgLSBiQS5tX3N3ZWVwLmxvY2FsQ2VudGVyLnk7XG4gICAgICB0WCA9ICh0TWF0LmNvbDEueCAqIHJBWCArIHRNYXQuY29sMi54ICogckFZKTtcbiAgICAgIHJBWSA9ICh0TWF0LmNvbDEueSAqIHJBWCArIHRNYXQuY29sMi55ICogckFZKTtcbiAgICAgIHJBWCA9IHRYO1xuICAgICAgdE1hdCA9IGJCLm1feGYuUjtcbiAgICAgIHZhciByQlggPSB0aGlzLm1fbG9jYWxBbmNob3JCLnggLSBiQi5tX3N3ZWVwLmxvY2FsQ2VudGVyLng7XG4gICAgICB2YXIgckJZID0gdGhpcy5tX2xvY2FsQW5jaG9yQi55IC0gYkIubV9zd2VlcC5sb2NhbENlbnRlci55O1xuICAgICAgdFggPSAodE1hdC5jb2wxLnggKiByQlggKyB0TWF0LmNvbDIueCAqIHJCWSk7XG4gICAgICByQlkgPSAodE1hdC5jb2wxLnkgKiByQlggKyB0TWF0LmNvbDIueSAqIHJCWSk7XG4gICAgICByQlggPSB0WDtcbiAgICAgIHZhciBtQSA9IGJBLm1faW52TWFzcztcbiAgICAgIHZhciBtQiA9IGJCLm1faW52TWFzcztcbiAgICAgIHZhciBpQSA9IGJBLm1faW52STtcbiAgICAgIHZhciBpQiA9IGJCLm1faW52STtcbiAgICAgIHZhciBDMVggPSBiQi5tX3N3ZWVwLmMueCArIHJCWCAtIGJBLm1fc3dlZXAuYy54IC0gckFYO1xuICAgICAgdmFyIEMxWSA9IGJCLm1fc3dlZXAuYy55ICsgckJZIC0gYkEubV9zd2VlcC5jLnkgLSByQVk7XG4gICAgICB2YXIgQzIgPSBiQi5tX3N3ZWVwLmEgLSBiQS5tX3N3ZWVwLmEgLSB0aGlzLm1fcmVmZXJlbmNlQW5nbGU7XG4gICAgICB2YXIga19hbGxvd2VkU3RyZXRjaCA9IDEwLjAgKiBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3A7XG4gICAgICB2YXIgcG9zaXRpb25FcnJvciA9IE1hdGguc3FydChDMVggKiBDMVggKyBDMVkgKiBDMVkpO1xuICAgICAgdmFyIGFuZ3VsYXJFcnJvciA9IGIyTWF0aC5BYnMoQzIpO1xuICAgICAgaWYgKHBvc2l0aW9uRXJyb3IgPiBrX2FsbG93ZWRTdHJldGNoKSB7XG4gICAgICAgICBpQSAqPSAxLjA7XG4gICAgICAgICBpQiAqPSAxLjA7XG4gICAgICB9XG4gICAgICB0aGlzLm1fbWFzcy5jb2wxLnggPSBtQSArIG1CICsgckFZICogckFZICogaUEgKyByQlkgKiByQlkgKiBpQjtcbiAgICAgIHRoaXMubV9tYXNzLmNvbDIueCA9ICgtckFZICogckFYICogaUEpIC0gckJZICogckJYICogaUI7XG4gICAgICB0aGlzLm1fbWFzcy5jb2wzLnggPSAoLXJBWSAqIGlBKSAtIHJCWSAqIGlCO1xuICAgICAgdGhpcy5tX21hc3MuY29sMS55ID0gdGhpcy5tX21hc3MuY29sMi54O1xuICAgICAgdGhpcy5tX21hc3MuY29sMi55ID0gbUEgKyBtQiArIHJBWCAqIHJBWCAqIGlBICsgckJYICogckJYICogaUI7XG4gICAgICB0aGlzLm1fbWFzcy5jb2wzLnkgPSByQVggKiBpQSArIHJCWCAqIGlCO1xuICAgICAgdGhpcy5tX21hc3MuY29sMS56ID0gdGhpcy5tX21hc3MuY29sMy54O1xuICAgICAgdGhpcy5tX21hc3MuY29sMi56ID0gdGhpcy5tX21hc3MuY29sMy55O1xuICAgICAgdGhpcy5tX21hc3MuY29sMy56ID0gaUEgKyBpQjtcbiAgICAgIHZhciBpbXB1bHNlID0gbmV3IGIyVmVjMygpO1xuICAgICAgdGhpcy5tX21hc3MuU29sdmUzMyhpbXB1bHNlLCAoLUMxWCksICgtQzFZKSwgKC1DMikpO1xuICAgICAgYkEubV9zd2VlcC5jLnggLT0gbUEgKiBpbXB1bHNlLng7XG4gICAgICBiQS5tX3N3ZWVwLmMueSAtPSBtQSAqIGltcHVsc2UueTtcbiAgICAgIGJBLm1fc3dlZXAuYSAtPSBpQSAqIChyQVggKiBpbXB1bHNlLnkgLSByQVkgKiBpbXB1bHNlLnggKyBpbXB1bHNlLnopO1xuICAgICAgYkIubV9zd2VlcC5jLnggKz0gbUIgKiBpbXB1bHNlLng7XG4gICAgICBiQi5tX3N3ZWVwLmMueSArPSBtQiAqIGltcHVsc2UueTtcbiAgICAgIGJCLm1fc3dlZXAuYSArPSBpQiAqIChyQlggKiBpbXB1bHNlLnkgLSByQlkgKiBpbXB1bHNlLnggKyBpbXB1bHNlLnopO1xuICAgICAgYkEuU3luY2hyb25pemVUcmFuc2Zvcm0oKTtcbiAgICAgIGJCLlN5bmNocm9uaXplVHJhbnNmb3JtKCk7XG4gICAgICByZXR1cm4gcG9zaXRpb25FcnJvciA8PSBiMlNldHRpbmdzLmIyX2xpbmVhclNsb3AgJiYgYW5ndWxhckVycm9yIDw9IGIyU2V0dGluZ3MuYjJfYW5ndWxhclNsb3A7XG4gICB9XG4gICBCb3gyRC5pbmhlcml0KGIyV2VsZEpvaW50RGVmLCBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJKb2ludERlZik7XG4gICBiMldlbGRKb2ludERlZi5wcm90b3R5cGUuX19zdXBlciA9IEJveDJELkR5bmFtaWNzLkpvaW50cy5iMkpvaW50RGVmLnByb3RvdHlwZTtcbiAgIGIyV2VsZEpvaW50RGVmLmIyV2VsZEpvaW50RGVmID0gZnVuY3Rpb24gKCkge1xuICAgICAgQm94MkQuRHluYW1pY3MuSm9pbnRzLmIySm9pbnREZWYuYjJKb2ludERlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgdGhpcy5sb2NhbEFuY2hvckEgPSBuZXcgYjJWZWMyKCk7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQiA9IG5ldyBiMlZlYzIoKTtcbiAgIH07XG4gICBiMldlbGRKb2ludERlZi5wcm90b3R5cGUuYjJXZWxkSm9pbnREZWYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9fc3VwZXIuYjJKb2ludERlZi5jYWxsKHRoaXMpO1xuICAgICAgdGhpcy50eXBlID0gYjJKb2ludC5lX3dlbGRKb2ludDtcbiAgICAgIHRoaXMucmVmZXJlbmNlQW5nbGUgPSAwLjA7XG4gICB9XG4gICBiMldlbGRKb2ludERlZi5wcm90b3R5cGUuSW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChiQSwgYkIsIGFuY2hvcikge1xuICAgICAgdGhpcy5ib2R5QSA9IGJBO1xuICAgICAgdGhpcy5ib2R5QiA9IGJCO1xuICAgICAgdGhpcy5sb2NhbEFuY2hvckEuU2V0Vih0aGlzLmJvZHlBLkdldExvY2FsUG9pbnQoYW5jaG9yKSk7XG4gICAgICB0aGlzLmxvY2FsQW5jaG9yQi5TZXRWKHRoaXMuYm9keUIuR2V0TG9jYWxQb2ludChhbmNob3IpKTtcbiAgICAgIHRoaXMucmVmZXJlbmNlQW5nbGUgPSB0aGlzLmJvZHlCLkdldEFuZ2xlKCkgLSB0aGlzLmJvZHlBLkdldEFuZ2xlKCk7XG4gICB9XG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcbiAgIHZhciBiMkRlYnVnRHJhdyA9IEJveDJELkR5bmFtaWNzLmIyRGVidWdEcmF3O1xuICAgYjJEZWJ1Z0RyYXcuYjJEZWJ1Z0RyYXcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1fZHJhd1NjYWxlID0gMS4wO1xuICAgICAgdGhpcy5tX2xpbmVUaGlja25lc3MgPSAxLjA7XG4gICAgICB0aGlzLm1fYWxwaGEgPSAxLjA7XG4gICAgICB0aGlzLm1fZmlsbEFscGhhID0gMS4wO1xuICAgICAgdGhpcy5tX3hmb3JtU2NhbGUgPSAxLjA7XG4gICAgICB2YXIgX190aGlzID0gdGhpcztcbiAgICAgIC8vI1dPUktBUk9VTkRcbiAgICAgIHRoaXMubV9zcHJpdGUgPSB7XG4gICAgICAgICBncmFwaGljczoge1xuICAgICAgICAgICAgY2xlYXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgIF9fdGhpcy5tX2N0eC5jbGVhclJlY3QoMCwgMCwgX190aGlzLm1fY3R4LmNhbnZhcy53aWR0aCwgX190aGlzLm1fY3R4LmNhbnZhcy5oZWlnaHQpXG4gICAgICAgICAgICB9XG4gICAgICAgICB9XG4gICAgICB9O1xuICAgfTtcbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5fY29sb3IgPSBmdW5jdGlvbiAoY29sb3IsIGFscGhhKSB7XG4gICAgICByZXR1cm4gXCJyZ2JhKFwiICsgKChjb2xvciAmIDB4RkYwMDAwKSA+PiAxNikgKyBcIixcIiArICgoY29sb3IgJiAweEZGMDApID4+IDgpICsgXCIsXCIgKyAoY29sb3IgJiAweEZGKSArIFwiLFwiICsgYWxwaGEgKyBcIilcIjtcbiAgIH07XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuYjJEZWJ1Z0RyYXcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLm1fZHJhd0ZsYWdzID0gMDtcbiAgIH07XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuU2V0RmxhZ3MgPSBmdW5jdGlvbiAoZmxhZ3MpIHtcbiAgICAgIGlmIChmbGFncyA9PT0gdW5kZWZpbmVkKSBmbGFncyA9IDA7XG4gICAgICB0aGlzLm1fZHJhd0ZsYWdzID0gZmxhZ3M7XG4gICB9O1xuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLkdldEZsYWdzID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9kcmF3RmxhZ3M7XG4gICB9O1xuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLkFwcGVuZEZsYWdzID0gZnVuY3Rpb24gKGZsYWdzKSB7XG4gICAgICBpZiAoZmxhZ3MgPT09IHVuZGVmaW5lZCkgZmxhZ3MgPSAwO1xuICAgICAgdGhpcy5tX2RyYXdGbGFncyB8PSBmbGFncztcbiAgIH07XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuQ2xlYXJGbGFncyA9IGZ1bmN0aW9uIChmbGFncykge1xuICAgICAgaWYgKGZsYWdzID09PSB1bmRlZmluZWQpIGZsYWdzID0gMDtcbiAgICAgIHRoaXMubV9kcmF3RmxhZ3MgJj0gfmZsYWdzO1xuICAgfTtcbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5TZXRTcHJpdGUgPSBmdW5jdGlvbiAoc3ByaXRlKSB7XG4gICAgICB0aGlzLm1fY3R4ID0gc3ByaXRlO1xuICAgfTtcbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5HZXRTcHJpdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2N0eDtcbiAgIH07XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuU2V0RHJhd1NjYWxlID0gZnVuY3Rpb24gKGRyYXdTY2FsZSkge1xuICAgICAgaWYgKGRyYXdTY2FsZSA9PT0gdW5kZWZpbmVkKSBkcmF3U2NhbGUgPSAwO1xuICAgICAgdGhpcy5tX2RyYXdTY2FsZSA9IGRyYXdTY2FsZTtcbiAgIH07XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuR2V0RHJhd1NjYWxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV9kcmF3U2NhbGU7XG4gICB9O1xuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLlNldExpbmVUaGlja25lc3MgPSBmdW5jdGlvbiAobGluZVRoaWNrbmVzcykge1xuICAgICAgaWYgKGxpbmVUaGlja25lc3MgPT09IHVuZGVmaW5lZCkgbGluZVRoaWNrbmVzcyA9IDA7XG4gICAgICB0aGlzLm1fbGluZVRoaWNrbmVzcyA9IGxpbmVUaGlja25lc3M7XG4gICAgICB0aGlzLm1fY3R4LnN0cm9rZVdpZHRoID0gbGluZVRoaWNrbmVzcztcbiAgIH07XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuR2V0TGluZVRoaWNrbmVzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fbGluZVRoaWNrbmVzcztcbiAgIH07XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuU2V0QWxwaGEgPSBmdW5jdGlvbiAoYWxwaGEpIHtcbiAgICAgIGlmIChhbHBoYSA9PT0gdW5kZWZpbmVkKSBhbHBoYSA9IDA7XG4gICAgICB0aGlzLm1fYWxwaGEgPSBhbHBoYTtcbiAgIH07XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuR2V0QWxwaGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tX2FscGhhO1xuICAgfTtcbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5TZXRGaWxsQWxwaGEgPSBmdW5jdGlvbiAoYWxwaGEpIHtcbiAgICAgIGlmIChhbHBoYSA9PT0gdW5kZWZpbmVkKSBhbHBoYSA9IDA7XG4gICAgICB0aGlzLm1fZmlsbEFscGhhID0gYWxwaGE7XG4gICB9O1xuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLkdldEZpbGxBbHBoYSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1fZmlsbEFscGhhO1xuICAgfTtcbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5TZXRYRm9ybVNjYWxlID0gZnVuY3Rpb24gKHhmb3JtU2NhbGUpIHtcbiAgICAgIGlmICh4Zm9ybVNjYWxlID09PSB1bmRlZmluZWQpIHhmb3JtU2NhbGUgPSAwO1xuICAgICAgdGhpcy5tX3hmb3JtU2NhbGUgPSB4Zm9ybVNjYWxlO1xuICAgfTtcbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5HZXRYRm9ybVNjYWxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMubV94Zm9ybVNjYWxlO1xuICAgfTtcbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5EcmF3UG9seWdvbiA9IGZ1bmN0aW9uICh2ZXJ0aWNlcywgdmVydGV4Q291bnQsIGNvbG9yKSB7XG4gICAgICBpZiAoIXZlcnRleENvdW50KSByZXR1cm47XG4gICAgICB2YXIgcyA9IHRoaXMubV9jdHg7XG4gICAgICB2YXIgZHJhd1NjYWxlID0gdGhpcy5tX2RyYXdTY2FsZTtcbiAgICAgIHMuYmVnaW5QYXRoKCk7XG4gICAgICBzLnN0cm9rZVN0eWxlID0gdGhpcy5fY29sb3IoY29sb3IuY29sb3IsIHRoaXMubV9hbHBoYSk7XG4gICAgICBzLm1vdmVUbyh2ZXJ0aWNlc1swXS54ICogZHJhd1NjYWxlLCB2ZXJ0aWNlc1swXS55ICogZHJhd1NjYWxlKTtcbiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdmVydGV4Q291bnQ7IGkrKykge1xuICAgICAgICAgcy5saW5lVG8odmVydGljZXNbaV0ueCAqIGRyYXdTY2FsZSwgdmVydGljZXNbaV0ueSAqIGRyYXdTY2FsZSk7XG4gICAgICB9XG4gICAgICBzLmxpbmVUbyh2ZXJ0aWNlc1swXS54ICogZHJhd1NjYWxlLCB2ZXJ0aWNlc1swXS55ICogZHJhd1NjYWxlKTtcbiAgICAgIHMuY2xvc2VQYXRoKCk7XG4gICAgICBzLnN0cm9rZSgpO1xuICAgfTtcbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5EcmF3U29saWRQb2x5Z29uID0gZnVuY3Rpb24gKHZlcnRpY2VzLCB2ZXJ0ZXhDb3VudCwgY29sb3IpIHtcbiAgICAgIGlmICghdmVydGV4Q291bnQpIHJldHVybjtcbiAgICAgIHZhciBzID0gdGhpcy5tX2N0eDtcbiAgICAgIHZhciBkcmF3U2NhbGUgPSB0aGlzLm1fZHJhd1NjYWxlO1xuICAgICAgcy5iZWdpblBhdGgoKTtcbiAgICAgIHMuc3Ryb2tlU3R5bGUgPSB0aGlzLl9jb2xvcihjb2xvci5jb2xvciwgdGhpcy5tX2FscGhhKTtcbiAgICAgIHMuZmlsbFN0eWxlID0gdGhpcy5fY29sb3IoY29sb3IuY29sb3IsIHRoaXMubV9maWxsQWxwaGEpO1xuICAgICAgcy5tb3ZlVG8odmVydGljZXNbMF0ueCAqIGRyYXdTY2FsZSwgdmVydGljZXNbMF0ueSAqIGRyYXdTY2FsZSk7XG4gICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHZlcnRleENvdW50OyBpKyspIHtcbiAgICAgICAgIHMubGluZVRvKHZlcnRpY2VzW2ldLnggKiBkcmF3U2NhbGUsIHZlcnRpY2VzW2ldLnkgKiBkcmF3U2NhbGUpO1xuICAgICAgfVxuICAgICAgcy5saW5lVG8odmVydGljZXNbMF0ueCAqIGRyYXdTY2FsZSwgdmVydGljZXNbMF0ueSAqIGRyYXdTY2FsZSk7XG4gICAgICBzLmNsb3NlUGF0aCgpO1xuICAgICAgcy5maWxsKCk7XG4gICAgICBzLnN0cm9rZSgpO1xuICAgfTtcbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5EcmF3Q2lyY2xlID0gZnVuY3Rpb24gKGNlbnRlciwgcmFkaXVzLCBjb2xvcikge1xuICAgICAgaWYgKCFyYWRpdXMpIHJldHVybjtcbiAgICAgIHZhciBzID0gdGhpcy5tX2N0eDtcbiAgICAgIHZhciBkcmF3U2NhbGUgPSB0aGlzLm1fZHJhd1NjYWxlO1xuICAgICAgcy5iZWdpblBhdGgoKTtcbiAgICAgIHMuc3Ryb2tlU3R5bGUgPSB0aGlzLl9jb2xvcihjb2xvci5jb2xvciwgdGhpcy5tX2FscGhhKTtcbiAgICAgIHMuYXJjKGNlbnRlci54ICogZHJhd1NjYWxlLCBjZW50ZXIueSAqIGRyYXdTY2FsZSwgcmFkaXVzICogZHJhd1NjYWxlLCAwLCBNYXRoLlBJICogMiwgdHJ1ZSk7XG4gICAgICBzLmNsb3NlUGF0aCgpO1xuICAgICAgcy5zdHJva2UoKTtcbiAgIH07XG4gICBiMkRlYnVnRHJhdy5wcm90b3R5cGUuRHJhd1NvbGlkQ2lyY2xlID0gZnVuY3Rpb24gKGNlbnRlciwgcmFkaXVzLCBheGlzLCBjb2xvcikge1xuICAgICAgaWYgKCFyYWRpdXMpIHJldHVybjtcbiAgICAgIHZhciBzID0gdGhpcy5tX2N0eCxcbiAgICAgICAgIGRyYXdTY2FsZSA9IHRoaXMubV9kcmF3U2NhbGUsXG4gICAgICAgICBjeCA9IGNlbnRlci54ICogZHJhd1NjYWxlLFxuICAgICAgICAgY3kgPSBjZW50ZXIueSAqIGRyYXdTY2FsZTtcbiAgICAgIHMubW92ZVRvKDAsIDApO1xuICAgICAgcy5iZWdpblBhdGgoKTtcbiAgICAgIHMuc3Ryb2tlU3R5bGUgPSB0aGlzLl9jb2xvcihjb2xvci5jb2xvciwgdGhpcy5tX2FscGhhKTtcbiAgICAgIHMuZmlsbFN0eWxlID0gdGhpcy5fY29sb3IoY29sb3IuY29sb3IsIHRoaXMubV9maWxsQWxwaGEpO1xuICAgICAgcy5hcmMoY3gsIGN5LCByYWRpdXMgKiBkcmF3U2NhbGUsIDAsIE1hdGguUEkgKiAyLCB0cnVlKTtcbiAgICAgIHMubW92ZVRvKGN4LCBjeSk7XG4gICAgICBzLmxpbmVUbygoY2VudGVyLnggKyBheGlzLnggKiByYWRpdXMpICogZHJhd1NjYWxlLCAoY2VudGVyLnkgKyBheGlzLnkgKiByYWRpdXMpICogZHJhd1NjYWxlKTtcbiAgICAgIHMuY2xvc2VQYXRoKCk7XG4gICAgICBzLmZpbGwoKTtcbiAgICAgIHMuc3Ryb2tlKCk7XG4gICB9O1xuICAgYjJEZWJ1Z0RyYXcucHJvdG90eXBlLkRyYXdTZWdtZW50ID0gZnVuY3Rpb24gKHAxLCBwMiwgY29sb3IpIHtcbiAgICAgIHZhciBzID0gdGhpcy5tX2N0eCxcbiAgICAgICAgIGRyYXdTY2FsZSA9IHRoaXMubV9kcmF3U2NhbGU7XG4gICAgICBzLnN0cm9rZVN0eWxlID0gdGhpcy5fY29sb3IoY29sb3IuY29sb3IsIHRoaXMubV9hbHBoYSk7XG4gICAgICBzLmJlZ2luUGF0aCgpO1xuICAgICAgcy5tb3ZlVG8ocDEueCAqIGRyYXdTY2FsZSwgcDEueSAqIGRyYXdTY2FsZSk7XG4gICAgICBzLmxpbmVUbyhwMi54ICogZHJhd1NjYWxlLCBwMi55ICogZHJhd1NjYWxlKTtcbiAgICAgIHMuY2xvc2VQYXRoKCk7XG4gICAgICBzLnN0cm9rZSgpO1xuICAgfTtcbiAgIGIyRGVidWdEcmF3LnByb3RvdHlwZS5EcmF3VHJhbnNmb3JtID0gZnVuY3Rpb24gKHhmKSB7XG4gICAgICB2YXIgcyA9IHRoaXMubV9jdHgsXG4gICAgICAgICBkcmF3U2NhbGUgPSB0aGlzLm1fZHJhd1NjYWxlO1xuICAgICAgcy5iZWdpblBhdGgoKTtcbiAgICAgIHMuc3Ryb2tlU3R5bGUgPSB0aGlzLl9jb2xvcigweGZmMDAwMCwgdGhpcy5tX2FscGhhKTtcbiAgICAgIHMubW92ZVRvKHhmLnBvc2l0aW9uLnggKiBkcmF3U2NhbGUsIHhmLnBvc2l0aW9uLnkgKiBkcmF3U2NhbGUpO1xuICAgICAgcy5saW5lVG8oKHhmLnBvc2l0aW9uLnggKyB0aGlzLm1feGZvcm1TY2FsZSAqIHhmLlIuY29sMS54KSAqIGRyYXdTY2FsZSwgKHhmLnBvc2l0aW9uLnkgKyB0aGlzLm1feGZvcm1TY2FsZSAqIHhmLlIuY29sMS55KSAqIGRyYXdTY2FsZSk7XG5cbiAgICAgIHMuc3Ryb2tlU3R5bGUgPSB0aGlzLl9jb2xvcigweGZmMDAsIHRoaXMubV9hbHBoYSk7XG4gICAgICBzLm1vdmVUbyh4Zi5wb3NpdGlvbi54ICogZHJhd1NjYWxlLCB4Zi5wb3NpdGlvbi55ICogZHJhd1NjYWxlKTtcbiAgICAgIHMubGluZVRvKCh4Zi5wb3NpdGlvbi54ICsgdGhpcy5tX3hmb3JtU2NhbGUgKiB4Zi5SLmNvbDIueCkgKiBkcmF3U2NhbGUsICh4Zi5wb3NpdGlvbi55ICsgdGhpcy5tX3hmb3JtU2NhbGUgKiB4Zi5SLmNvbDIueSkgKiBkcmF3U2NhbGUpO1xuICAgICAgcy5jbG9zZVBhdGgoKTtcbiAgICAgIHMuc3Ryb2tlKCk7XG4gICB9O1xufSkoKTtcbnZhciBpO1xuZm9yIChpID0gMDsgaSA8IEJveDJELnBvc3REZWZzLmxlbmd0aDsgKytpKSBCb3gyRC5wb3N0RGVmc1tpXSgpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJveDJEIiwiUS5TcHJpdGUuZXh0ZW5kKFwiQ2hhcmFjdGVyXCIsIHtcbiAgaW5pdDogZnVuY3Rpb24ocCkge1xuICAgIHRoaXMuX3N1cGVyKHAsIHtcbiAgICAgIHNoZWV0OiBwLmNoYXJhY3RlcixcbiAgICAgIHNwcml0ZTogcC5jaGFyYWN0ZXIsXG4gICAgICBpc0NvbnRyb2xsZWQ6IGZhbHNlLFxuICAgICAgZGlyZWN0aW9uOiBcInJpZ2h0XCIsXG4gICAgICBwb2ludHM6IFtbLTQwLCAtNDBdLCBbNDAsIC00MF0sIFs0MCwgMTUwXSwgWy00MCwgMTUwXV0sXG4gICAgICB0eXBlOiBRLlNQUklURV9OUEMsXG4gICAgICBjb2xsaXNpb25NYXNrOiBRLlNQUklURV9ERUZBVUxUIHwgUS5TUFJJVEVfSU5URVJBQ1RJVkUgfCBRLlNQUklURV9XRUFQT04sXG4gICAgICBjYW5Vc2U6IDAsXG4gICAgICBjeDogNDAsXG4gICAgfSk7XG5cbiAgICB0aGlzLmFkZCgnMmQsIGFuaW1hdGlvbicpO1xuICAgIHRoaXMub24oXCJ0b3VjaFwiKTtcbiAgICB0aGlzLm9uKFwic2Vuc29yXCIpO1xuICAgIHRoaXMub24oXCJhdHRhY2tlZFwiKTtcbiAgICB0aGlzLnAuc2hlZXQgPSB0aGlzLnAuc3ByaXRlICsgXCJXYWxrXCI7XG4gIH0sXG5cbiAgdG91Y2g6IGZ1bmN0aW9uKCkge1xuICAgIFEoXCJDaGFyYWN0ZXJcIikuaW52b2tlKFwic3RvcENvbnRyb2xcIiwgZmFsc2UpO1xuICAgIHRoaXMucC50eXBlID0gUS5TUFJJVEVfUExBWUVSO1xuICAgIHRoaXMucC5jb250cm9sbGVkID0gdHJ1ZTtcbiAgICBRLnN0YWdlKCkuZm9sbG93KHRoaXMpO1xuICB9LFxuXG4gIHNlbnNvcjogZnVuY3Rpb24oc2Vuc29yKSB7XG4gICAgdGhpcy5zZW5zb3IgPSBzZW5zb3I7XG4gICAgdGhpcy5wLmNhblVzZSA9IDEvNTtcbiAgfSxcblxuICBzdG9wQ29udHJvbDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wLnR5cGUgPSBRLlNQUklURV9OUEM7XG4gICAgdGhpcy5wLmNvbnRyb2xsZWQgPSBmYWxzZTtcbiAgfSxcblxuICBzdGVwOiBmdW5jdGlvbihkdCkge1xuICAgIGlmKCF0aGlzLnAuY29udHJvbGxlZCkge1xuICAgICAgdGhpcy5wbGF5KFwic3RhbmRfXCIgKyB0aGlzLnAuZGlyZWN0aW9uKTtcbiAgICAgIHJldHVybjtcbiAgICB9O1xuXG4gICAgdGhpcy5wLmNhblVzZSAtPSBkdDtcblxuICAgIGlmKHRoaXMucC5hdHRhY2tpbmcpIHJldHVybjtcbiAgICBpZihRLmlucHV0c1tcImxlZnRcIl0pIHtcbiAgICAgIHRoaXMucC5zaGVldCA9IHRoaXMucC5zcHJpdGUgKyBcIldhbGtcIjtcbiAgICAgIHRoaXMucC5kaXJlY3Rpb24gPSBcImxlZnRcIjtcbiAgICAgIHRoaXMucGxheShcIndhbGtfbGVmdFwiKTtcbiAgICAgIHRoaXMucC52eCA9IC0yMDA7XG4gICAgfSBlbHNlIGlmKFEuaW5wdXRzW1wicmlnaHRcIl0pIHtcbiAgICAgIHRoaXMucC5zaGVldCA9IHRoaXMucC5zcHJpdGUgKyBcIldhbGtcIjtcbiAgICAgIHRoaXMucC5kaXJlY3Rpb24gPSBcInJpZ2h0XCI7XG4gICAgICB0aGlzLnBsYXkoXCJ3YWxrX3JpZ2h0XCIpO1xuICAgICAgdGhpcy5wLnZ4ID0gMjAwO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnBsYXkoXCJzdGFuZF9cIiArIHRoaXMucC5kaXJlY3Rpb24pO1xuICAgICAgdGhpcy5wLnZ4ID0gMDtcbiAgICB9XG5cbiAgICBpZih0aGlzLnAuY2FuVXNlID4gMCAmJiBRLmlucHV0c1tcImFjdGlvblwiXSkge1xuICAgICAgdGhpcy5zZW5zb3IudXNlKCk7XG4gICAgICBpZih0aGlzLnNlbnNvci5wLnNwcml0ZSA9PT0gXCJLaXRjaGVuVGFibGVcIikge1xuICAgICAgICB0aGlzLnAuc2hlZXQgPSB0aGlzLnAuc3ByaXRlICsgXCJBdHRhY2tGcnVpdEJvd2xcIjtcbiAgICAgICAgdGhpcy5wbGF5KFwiYXR0YWNrX2ZydWl0X2Jvd2xcIik7XG4gICAgICAgIHRoaXMucC5hdHRhY2tpbmcgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBhdHRhY2tlZDogZnVuY3Rpb24oKSB7XG4gICAgY29uc29sZS5sb2coXCJzd2FwXCIpO1xuICAgIHRoaXMucC5hdHRhY2tpbmcgPSBmYWxzZTtcbiAgICB0aGlzLnAuc2hlZXQgPSB0aGlzLnAuc3ByaXRlICsgXCJXYWxrXCI7XG4gICAgdGhpcy5wbGF5KFwic3RhbmRfXCIgKyB0aGlzLnAuZGlyZWN0aW9uKTtcbiAgfSxcbn0pO1xuIiwiUS5TcHJpdGUuZXh0ZW5kKFwiRGVjb3JhdGlvblwiLHtcbiAgaW5pdDogZnVuY3Rpb24ocCkge1xuICAgIHRoaXMuX3N1cGVyKHAsIHtcbiAgICAgIGFzc2V0OiBwLmltYWdlLFxuICAgICAgdHlwZTogUS5TUFJJVEVfTk9ORSxcbiAgICAgIGNvbGxpc2lvbk1hc2s6IFEuU1BSSVRFX05PTkUsXG4gICAgICB2aXNpYmxlT25seTogdHJ1ZSxcbiAgICAgIGdyYXZpdHk6IDAsXG4gICAgfSk7XG4gIH1cbn0pO1xuIiwiUS5TcHJpdGUuZXh0ZW5kKFwiSW50ZXJhY3RpdmVcIix7XG4gIGluaXQ6IGZ1bmN0aW9uKHApIHtcbiAgICB0aGlzLl9zdXBlcihwLCB7XG4gICAgICBzcHJpdGU6IHAucHJvcCxcbiAgICAgIHNoZWV0OiBwLnByb3AsXG4gICAgICBzZW5zb3I6IHRydWUsXG4gICAgICB0eXBlOiBRLlNQUklURV9JTlRFUkFDVElWRSxcbiAgICAgIGNvbGxpc2lvbk1hc2s6IFEuU1BSSVRFX05PTkUgfCBRLlNQUklURV9QTEFZRVIsXG4gICAgICBncmF2aXR5OiAwLFxuICAgICAgdXNhYmxlOiB0cnVlLFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGQoJ2FuaW1hdGlvbicpO1xuICAgIHRoaXMucGxheShcIm5vcm1hbFwiKTtcbiAgICB0aGlzLm9uKFwic2Vuc29yXCIpO1xuICB9LFxuXG4gIHVzZTogZnVuY3Rpb24oKSB7XG4gICAgaWYoIXRoaXMucC51c2FibGUpIHJldHVybjtcbiAgICB0aGlzLnAudXNhYmxlID0gZmFsc2U7XG4gICAgdGhpcy5wbGF5KFwiaW50ZXJhY3RcIik7XG4gIH0sXG5cbiAgc2Vuc29yOiBmdW5jdGlvbihzZW5zZWQpIHtcbiAgICBpZih0aGlzLnAudXNhYmxlKSBzZW5zZWQudHJpZ2dlcihcInNlbnNvclwiLCB0aGlzKTtcbiAgfVxufSk7XG4iLCJ2YXIgbGV2ZWxzID0gW1xuICB7dGl0bGU6IFwiQW4gVW5jb252ZW50aW9uYWwgRGVhdGhcIiwgbmFtZTogXCJ0ZXN0XCJ9LFxuXVxuXG4vLyBMZXZlbCBCdWlsZGVyXG5mb3IoaSBpbiBsZXZlbHMpIHtcbiAgKGZ1bmN0aW9uKGxldmVsLCBuZXh0TGV2ZWwsIGxldmVsTnVtYmVyKSB7XG4gICAgUS5zY2VuZShsZXZlbC5uYW1lLGZ1bmN0aW9uKHN0YWdlKSB7XG4gICAgICBRLnN0YWdlVE1YKGxldmVsLm5hbWUgKyBcIi50bXhcIixzdGFnZSk7XG4gICAgICBpZihuZXh0TGV2ZWwpIHtcbiAgICAgICAgdGhpcy5uZXh0U2NlbmUgPSBuZXh0TGV2ZWwubmFtZTtcbiAgICAgIH1cblxuICAgICAgdmFyIGh1ZCA9IFEuc3RhZ2VTY2VuZShcImxldmVsT3ZlcmxheVwiLCAxLCB7dGl0bGU6IGxldmVsLnRpdGxlLCBudW1iZXI6IHBhcnNlSW50KGxldmVsTnVtYmVyKSsxfSk7XG4gICAgICB0aGlzLnBsYXllckZhaWxzID0gMDtcbiAgICAgIHRoaXMucGxheWVyU3RhcnRlZCA9IGZ1bmN0aW9uKCkgeyBodWQucnVuVGltZXIgPSB0cnVlOyB9O1xuICAgICAgdGhpcy5wbGF5ZXJFbmRlZCA9IGZ1bmN0aW9uKCkgeyBodWQucnVuVGltZXIgPSBmYWxzZTsgfTtcbiAgICAgIHRoaXMucGxheWVyRG91YmxlSnVtcCA9IGZ1bmN0aW9uKCkgeyBodWQucGxheWVyRG91YmxlSnVtcHMrKzsgfTtcbiAgICAgIHRoaXMucGxheWVyVGhyb3cgPSBmdW5jdGlvbigpIHsgaHVkLnBsYXllclRocm93cysrOyB9O1xuICAgICAgdGhpcy5wbGF5ZXJTd2FwID0gZnVuY3Rpb24oKSB7IGh1ZC5wbGF5ZXJTd2FwcysrOyB9O1xuICAgICAgdGhpcy5sZXZlbFN0YXRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGltZTogaHVkLmVsYXBzZWRUaW1lLFxuICAgICAgICAgIGRvdWJsZUp1bXBzOiBodWQucGxheWVyRG91YmxlSnVtcHMsXG4gICAgICAgICAgYm90VGhyb3dzOiBodWQucGxheWVyVGhyb3dzLFxuICAgICAgICAgIHN3YXBzOiBodWQucGxheWVyU3dhcHMsXG4gICAgICAgICAgZ29hbHM6IGxldmVsLFxuICAgICAgICB9O1xuICAgICAgfTtcblxuICAgICAgc3RhZ2UuYWRkKFwidmlld3BvcnRcIik7XG4gICAgICBzdGFnZS52aWV3cG9ydC5zY2FsZSA9IDAuNTtcbiAgICAgIHN0YWdlLnZpZXdwb3J0LmNlbnRlck9uKDgwMCwgNTAwKTtcbiAgICB9KTtcbiAgfSkobGV2ZWxzW2ldLCBsZXZlbHNbcGFyc2VJbnQoaSkrMV0sIGkpXG59XG5cblEuc2NlbmUoJ2ZhaWxMZXZlbCcsZnVuY3Rpb24oc3RhZ2UpIHtcbiAgdmFyIGNvbnRhaW5lciA9IHN0YWdlLmluc2VydChuZXcgUS5VSS5Db250YWluZXIoeyB4OiBRLndpZHRoLzIsIHk6IFEuaGVpZ2h0LzIsIGZpbGw6IFwiI0RCRTVFNlwiLCBzaGFkb3c6IHRydWUsIHNoYWRvd0NvbG9yOiBcInJnYmEoMTE4LDEyMSwxMjEsIDAuNSlcIiB9KSk7XG5cbiAgdmFyIGJ1dHRvbiA9IGNvbnRhaW5lci5pbnNlcnQobmV3IFEuVUkuQnV0dG9uKHsgeDogMCwgeTogMCwgZmlsbDogXCIjRkZGRkZGXCIsIGxhYmVsOiBcIlRyeSBBZ2FpblwiIH0pKSAgICAgICAgIFxuICB2YXIgbGFiZWwgPSBjb250YWluZXIuaW5zZXJ0KG5ldyBRLlVJLlRleHQoe3g6MTAsIHk6IC0xMCAtIGJ1dHRvbi5wLmgsIGxhYmVsOiBzdGFnZS5vcHRpb25zLmxhYmVsIH0pKTtcblxuICB2YXIgY29udGludWVDYiA9IGZ1bmN0aW9uKCkge1xuICAgIFEuY2xlYXJTdGFnZXMoKTtcbiAgICBRLnN0YWdlU2NlbmUoc3RhZ2Uub3B0aW9ucy5sZXZlbCk7XG4gIH07XG4gIFEuaW5wdXQub24oXCJjb25maXJtXCIsIGNvbnRpbnVlQ2IpO1xuICBidXR0b24ub24oXCJjbGlja1wiLCBjb250aW51ZUNiKTtcblxuICBjb250YWluZXIuZml0KDIwKTtcbn0pO1xuXG5RLnNjZW5lKCd3aW5MZXZlbCcsZnVuY3Rpb24oc3RhZ2UpIHtcbiAgdmFyIGNvbnRhaW5lciA9IHN0YWdlLmluc2VydChuZXcgUS5VSS5Db250YWluZXIoeyB4OiBRLndpZHRoLzIsIHk6IFEuaGVpZ2h0LzIgKyA1NSwgZmlsbDogXCIjREJFNUU2XCIsIHNoYWRvdzogdHJ1ZSwgc2hhZG93Q29sb3I6IFwicmdiYSgxMTgsMTIxLDEyMSwgMC41KVwiIH0pKTtcblxuICB2YXIgYnV0dG9uID0gY29udGFpbmVyLmluc2VydChuZXcgUS5VSS5CdXR0b24oeyB4OiAwLCB5OiAwLCBmaWxsOiBcIiNGRkZGRkZcIiwgbGFiZWw6IFwiTmV4dCBMZXZlbFwiIH0pKSAgICAgICAgIFxuICB2YXIgc3dhcHMgPSBjb250YWluZXIuaW5zZXJ0KG5ldyBRLlVJLlRleHQoe3g6MCwgeTogLTEwIC0gYnV0dG9uLnAuaCwgbGFiZWw6IFwiU3dhcHM6IFwiICsgc3RhZ2Uub3B0aW9ucy5sZXZlbFN0YXRzLnN3YXBzLCBzaXplOiAxNiB9KSk7XG4gIHZhciBkanMgPSBjb250YWluZXIuaW5zZXJ0KG5ldyBRLlVJLlRleHQoe3g6MCwgeTogLTYgLSBzd2Fwcy5wLmggKyBzd2Fwcy5wLnksIGxhYmVsOiBcIkRvdWJsZSBKdW1wczogXCIgKyBzdGFnZS5vcHRpb25zLmxldmVsU3RhdHMuZG91YmxlSnVtcHMsIHNpemU6IDE2IH0pKTtcbiAgdmFyIGJ0aHJvd3MgPSBjb250YWluZXIuaW5zZXJ0KG5ldyBRLlVJLlRleHQoe3g6MCwgeTogLTYgLSBkanMucC5oICsgZGpzLnAueSwgbGFiZWw6IFwiVGhyb3dzOiBcIiArIHN0YWdlLm9wdGlvbnMubGV2ZWxTdGF0cy5ib3RUaHJvd3MsIHNpemU6IDE2IH0pKTtcbiAgdmFyIHRpbWUgPSBjb250YWluZXIuaW5zZXJ0KG5ldyBRLlVJLlRleHQoe3g6MCwgeTogLTEwIC0gYnRocm93cy5wLmggKyBidGhyb3dzLnAueSwgbGFiZWw6IFwiVGltZTogXCIgKyBwYXJzZUZsb2F0KHN0YWdlLm9wdGlvbnMubGV2ZWxTdGF0cy50aW1lKS50b0ZpeGVkKDIpLCBzaXplOiAyMCB9KSk7XG5cbiAgdmFyIHR3b1N0YXIgPSBuZXcgUS5TcHJpdGUoeyB4OiAwLCB5OiAtMTYgLSB0aW1lLnAuaCArIHRpbWUucC55LCBzaGVldDogJ3N0YXInLCBvcGFjaXR5OiAwLjQsIHNjYWxlOiAxLjV9KTtcbiAgdmFyIG9uZVN0YXIgPSBuZXcgUS5TcHJpdGUoeyB4OiAtKHR3b1N0YXIucC53LzEuNCkgLSAyLCB5OiAtMTYgLSB0aW1lLnAuaCArIHRpbWUucC55LCBzaGVldDogJ3N0YXInLCBvcGFjaXR5OiAwLjQsIHNjYWxlOiAxLjV9KTtcbiAgdmFyIHRocmVlU3RhciA9IG5ldyBRLlNwcml0ZSh7IHg6ICh0d29TdGFyLnAudy8xLjQpICsgMiwgeTogLTE2IC0gdGltZS5wLmggKyB0aW1lLnAueSwgc2hlZXQ6ICdzdGFyJywgb3BhY2l0eTogMC40LCBzY2FsZTogMS41fSk7XG4gIG9uZVN0YXIuYWRkKFwiYW5pbWF0aW9uXCIpO1xuICB0d29TdGFyLmFkZChcImFuaW1hdGlvblwiKTtcbiAgdGhyZWVTdGFyLmFkZChcImFuaW1hdGlvblwiKTtcblxuICBjb250YWluZXIuaW5zZXJ0KG9uZVN0YXIpO1xuICBjb250YWluZXIuaW5zZXJ0KHR3b1N0YXIpO1xuICBjb250YWluZXIuaW5zZXJ0KHRocmVlU3Rhcik7XG5cbiAgaWYoc3RhZ2Uub3B0aW9ucy5sZXZlbFN0YXRzLnRpbWUgPCBzdGFnZS5vcHRpb25zLmxldmVsU3RhdHMuZ29hbHMub25lU3RhclRpbWUpIHtcbiAgICBvbmVTdGFyLnAub3BhY2l0eSA9IDE7XG4gIH1cbiAgaWYoc3RhZ2Uub3B0aW9ucy5sZXZlbFN0YXRzLnRpbWUgPCBzdGFnZS5vcHRpb25zLmxldmVsU3RhdHMuZ29hbHMudHdvU3RhclRpbWUpIHtcbiAgICB0d29TdGFyLnAub3BhY2l0eSA9IDE7XG4gIH1cbiAgaWYoc3RhZ2Uub3B0aW9ucy5sZXZlbFN0YXRzLnRpbWUgPCBzdGFnZS5vcHRpb25zLmxldmVsU3RhdHMuZ29hbHMudGhyZWVTdGFyVGltZSkge1xuICAgIHRocmVlU3Rhci5wLm9wYWNpdHkgPSAxO1xuICB9XG5cbiAgdmFyIGNvbnRpbnVlQ2IgPSBmdW5jdGlvbigpIHtcbiAgICBRLmNsZWFyU3RhZ2VzKCk7XG4gICAgUS5zdGFnZVNjZW5lKHN0YWdlLm9wdGlvbnMubGV2ZWwpO1xuICB9O1xuICBRLmlucHV0Lm9uKFwiY29uZmlybVwiLCBjb250aW51ZUNiKTtcbiAgYnV0dG9uLm9uKFwiY2xpY2tcIiwgY29udGludWVDYik7XG5cbiAgY29udGFpbmVyLmZpdCgyMCk7XG59KTtcblxuUS5zY2VuZSgnbGV2ZWxPdmVybGF5JyxmdW5jdGlvbihzdGFnZSkge1xuICB2YXIgdGl0bGUgPSBzdGFnZS5pbnNlcnQobmV3IFEuVUkuVGV4dCh7XG4gICAgeDogUS53aWR0aCAvIDIsXG4gICAgeTogUS5oZWlnaHQgLyAzLFxuICAgIC8vIGxhYmVsOiBcIkxldmVsIFwiICsgc3RhZ2Uub3B0aW9ucy5udW1iZXIgKyBcIiDigJQgXCIgKyBzdGFnZS5vcHRpb25zLnRpdGxlKyBcIi4uLlwiLFxuICAgIGxhYmVsOiBzdGFnZS5vcHRpb25zLnRpdGxlLFxuICAgIGNvbG9yOiBcIiNGRkZGRkZcIixcbiAgICBvdXRsaW5lQ29sb3I6IFwiIzU0NUU1RVwiLFxuICAgIG91dGxpbmVXaWR0aDogNyxcbiAgICBzaXplOiAzMixcbiAgICBvcGFjaXR5OiAwXG4gIH0pKTtcbiAgdGl0bGUuYWRkKFwidHdlZW5cIik7XG5cbiAgc2V0VGltZW91dChmdW5jdGlvbigpIHsgdGl0bGUuYW5pbWF0ZSh7b3BhY2l0eTogMX0sIDAuNzUpfSwgNTAwKTtcbiAgc2V0VGltZW91dChmdW5jdGlvbigpIHsgdGl0bGUuYW5pbWF0ZSh7b3BhY2l0eTogMH0sIDAuNzUpfSwgNDAwMCk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBsZXZlbHM7XG4iLCJ2YXIgbGV2ZWxzID0gcmVxdWlyZSgnLi9sZXZlbHMnKTtcblxudmFyIGZpbGVzID0gW1xuICBcInRpbGVzLnBuZ1wiLFxuICBcImppbS5qc29uXCIsXG4gIFwiamltLnBuZ1wiLFxuICBcImplbi5qc29uXCIsXG4gIFwiamVuLnBuZ1wiLFxuICBcInRhYmxlLmpzb25cIixcbiAgXCJ0YWJsZS5wbmdcIixcbl07XG5cbmZvcihpIGluIGxldmVscykge1xuICBmaWxlcy5wdXNoKGxldmVsc1tpXS5uYW1lICsgXCIudG14XCIpO1xufVxuXG5RLmxvYWRUTVgoZmlsZXMuam9pbihcIiwgXCIpLCBmdW5jdGlvbigpIHtcbiAgUS5jb21waWxlU2hlZXRzKFwiamltLnBuZ1wiLFwiamltLmpzb25cIik7XG4gIFEuY29tcGlsZVNoZWV0cyhcImplbi5wbmdcIixcImplbi5qc29uXCIpO1xuICBRLmNvbXBpbGVTaGVldHMoXCJ0YWJsZS5wbmdcIixcInRhYmxlLmpzb25cIik7XG5cbiAgUS5hbmltYXRpb25zKFwiSmltXCIsIHtcbiAgICB3YWxrX3JpZ2h0OiB7IGZyYW1lczogWzAsMSwyLDMsNCw1LDYsNyw4LDksMTBdLCByYXRlOiAxLzEyLCBmbGlwOiBmYWxzZSwgbG9vcDogdHJ1ZSB9LFxuICAgIHdhbGtfbGVmdDogeyBmcmFtZXM6IFswLDEsMiwzLDQsNSw2LDcsOCw5LDEwXSwgcmF0ZTogMS8xMiwgZmxpcDogXCJ4XCIsIGxvb3A6IHRydWUgfSxcbiAgICBzdGFuZF9yaWdodDogeyBmcmFtZXM6IFs4LDldLCByYXRlOiA5OSwgZmxpcDogZmFsc2UsIGxvb3A6IHRydWUgfSxcbiAgICBzdGFuZF9sZWZ0OiB7IGZyYW1lczogWzgsOV0sIHJhdGU6IDk5LCBmbGlwOlwieFwiLCBsb29wOiB0cnVlIH0sXG4gICAgYXR0YWNrX2ZydWl0X2Jvd2w6IHsgZnJhbWVzOiBbMCwxLDIsMyw0LDUsNiw3LDgsOSwxMCwxMSwxMiwxMywxNF0sIHJhdGU6IDEvMTIsIGZsaXA6IGZhbHNlLCBsb29wOiBmYWxzZSwgdHJpZ2dlcjogXCJhdHRhY2tlZFwiIH0sXG4gIH0pO1xuXG4gIFEuYW5pbWF0aW9ucyhcIkplblwiLCB7XG4gICAgd2Fsa19yaWdodDogeyBmcmFtZXM6IFswLDEsMiwzLDQsNSw2LDcsOCw5LDEwXSwgcmF0ZTogMS8xMiwgZmxpcDogZmFsc2UsIGxvb3A6IHRydWUgfSxcbiAgICB3YWxrX2xlZnQ6IHsgZnJhbWVzOiBbMCwxLDIsMyw0LDUsNiw3LDgsOSwxMF0sIHJhdGU6IDEvMTIsIGZsaXA6IFwieFwiLCBsb29wOiB0cnVlIH0sXG4gICAgc3RhbmRfcmlnaHQ6IHsgZnJhbWVzOiBbOCw5XSwgcmF0ZTogOTksIGZsaXA6IGZhbHNlLCBsb29wOiB0cnVlIH0sXG4gICAgc3RhbmRfbGVmdDogeyBmcmFtZXM6IFs4LDldLCByYXRlOiA5OSwgZmxpcDpcInhcIiwgbG9vcDogdHJ1ZSB9LFxuICB9KTtcblxuICBRLmFuaW1hdGlvbnMoXCJLaXRjaGVuVGFibGVcIiwge1xuICAgIG5vcm1hbDogeyBmcmFtZXM6IFswXSwgcmF0ZTogMS8xMiwgZmxpcDogZmFsc2UsIGxvb3A6IHRydWUgfSxcbiAgICBpbnRlcmFjdDogeyBmcmFtZXM6IFswLDEsMiwzLDQsNSw2LDcsOCw5LDEwLDExLDEyLDEzLDE0XSwgcmF0ZTogMS8xMiwgZmxpcDogZmFsc2UsIGxvb3A6IGZhbHNlIH0sXG4gICAgdXNlZDogeyBmcmFtZXM6IFsxNF0sIHJhdGU6IDEvMTIsIGZsaXA6IGZhbHNlIH0sXG4gIH0pO1xuXG5cbiAgUS5zdGFnZVNjZW5lKGxldmVsc1swXS5uYW1lKTtcbn0pO1xuIl19
